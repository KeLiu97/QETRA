originalTitle,body,reformulatedTitle
delete map[key] in go?," I have a map: How do I delete sessions[key]? I tried: That didn't work.Update (November 2011):The special syntax for deleting map entries is removed in Go version 1:Go 1 will remove the special map assignment and introduce a new built-in function, delete: delete(m, x) will delete the map entry retrieved by the expression m[x]. ... <code>  var sessions = map[string] chan int{} sessions[key] = nil,false;",Delete key in map
How to efficiently concatenate strings in Go?," In Go, a string is a primitive type, which means it is read-only, and every manipulation of it will create a new string.So if I want to concatenate strings many times without knowing the length of the resulting string, what's the best way to do it?The naive way would be: but that does not seem very efficient. <code>  var s stringfor i := 0; i < 1000; i++ { s += getShortStringFromSomewhere()}return s",How to efficiently concatenate strings in go
How to efficiently concatenate strings," In Go, a string is a primitive type, which means it is read-only, and every manipulation of it will create a new string.So if I want to concatenate strings many times without knowing the length of the resulting string, what's the best way to do it?The naive way would be: but that does not seem very efficient. <code>  var s stringfor i := 0; i < 1000; i++ { s += getShortStringFromSomewhere()}return s",How to efficiently concatenate strings in go
Google Go: notwithstanding keyword, What does the notwithstanding keyword mean in Google Go? <code> ,notwithstanding keyword
Go - Pointer to map," Having some maps defined as: I would want a variable that points to the address of the maps (to don't copy all variable). I tried it using: but at using valueTo[number], it showsinternal compiler error: var without type, init: newHow to get it?Edit The error was showed by another problem. <code>  var valueToSomeType = map[uint8]someType{...}var nameToSomeType = map[string]someType{...} valueTo := &valueToSomeTypenameTo := &nameToSomeType",Pointer to a map
How to add GO support to Geany," I am trying to make syntax hightlighting and building options work for Geany, any advice? <code> ",How to add Go support to Geany
Getting standard input in golang," How do I use the fmt.Scanf function in Go to get an integer input from the standard input?If this can't be done using fmt.Scanf, what's the best way to read a single integer? <code> ",Reading an integer from standard input
Readng an integer from standard input in golang," How do I use the fmt.Scanf function in Go to get an integer input from the standard input?If this can't be done using fmt.Scanf, what's the best way to read a single integer? <code> ",Reading an integer from standard input
Reading an integer from standard input in golang," How do I use the fmt.Scanf function in Go to get an integer input from the standard input?If this can't be done using fmt.Scanf, what's the best way to read a single integer? <code> ",Reading an integer from standard input
Reading an integer from standard input in Golang," How do I use the fmt.Scanf function in Go to get an integer input from the standard input?If this can't be done using fmt.Scanf, what's the best way to read a single integer? <code> ",Reading an integer from standard input
Casting back to more specialised template," I'm writing a game in go. In C++ I would store all my entity classes in an array of the BaseEntity class. If an entity needed to move about in the world it would be a PhysEntity which is derived from a BaseEntity, but with added methods. I tried to imitate this is go: This will not compile as it cant tell that 'entity' was a PhysEntity. What is a suitable alternative to this method? <code>  package maintype Entity interface { a() string}type PhysEntity interface { Entity b() string}type BaseEntity struct { }func (e *BaseEntity) a() string { return ""Hello "" }type BasePhysEntity struct { BaseEntity }func (e *BasePhysEntity) b() string { return "" World!"" }func main() { physEnt := PhysEntity(new(BasePhysEntity)) entity := Entity(physEnt) print(entity.a()) original := PhysEntity(entity)// ERROR on line above: cannot convert physEnt (type PhysEntity) to type Entity: println(original.b())}",Casting back to more specialised interface
Is where libCURL bindings for Go language," I have searched web for libCURL bindings for Go language, but failed to find any... I also checked curl.haxx.se list of bindings with no success for Go. Are there any such project on net?If such binding don't exists are where any alternative libraries or maybe you could provide some hints how I could implement my own bindings of libCURL?Thanks <code> ",Are there libCURL bindings for the Go language
Append to file with io/ioutil?," So I can read from a local file like so: And I can write to a local file But how can I append to a file? Is there a built in method? <code>  data, error := ioutil.ReadFile(name) ioutil.WriteFile(filename, content, permission)",Append to a file in Go
what should be the values of GOPATH and GOROOT?, I'm trying to install doozer like this: I get these errors.  <code>  $ goinstall github.com/ha/doozer goinstall: os: go/build: package could not be found locallygoinstall: fmt: go/build: package could not be found locallygoinstall: io: go/build: package could not be found locallygoinstall: reflect: go/build: package could not be found locallygoinstall: math: go/build: package could not be found locallygoinstall: rand: go/build: package could not be found locallygoinstall: url: go/build: package could not be found locallygoinstall: net: go/build: package could not be found locallygoinstall: sync: go/build: package could not be found locallygoinstall: runtime: go/build: package could not be found locallygoinstall: strings: go/build: package could not be found locallygoinstall: sort: go/build: package could not be found locallygoinstall: strconv: go/build: package could not be found locallygoinstall: bytes: go/build: package could not be found locallygoinstall: log: go/build: package could not be found locallygoinstall: encoding/binary: go/build: package could not be found locally,What should be the values of GOPATH and GOROOT?
How to decode json with type convert from string to float64 in golang?," I need to decode a JSON string with the float number like: I use the Golang code below: When I run it, get the result: I want to know how to decode the JSON string with type convert. <code>  {""name"":""Galaxy Nexus"", ""price"":""3460.00""} package mainimport ( ""encoding/json"" ""fmt"")type Product struct { Name string Price float64}func main() { s := `{""name"":""Galaxy Nexus"", ""price"":""3460.00""}` var pro Product err := json.Unmarshal([]byte(s), &pro) if err == nil { fmt.Printf(""%+v\n"", pro) } else { fmt.Println(err) fmt.Printf(""%+v\n"", pro) }} json: cannot unmarshal string into Go value of type float64{Name:Galaxy Nexus Price:0}",How to decode JSON with type convert from string to float64
How to decode JSON with type convert from string to float64 in Golang?," I need to decode a JSON string with the float number like: I use the Golang code below: When I run it, get the result: I want to know how to decode the JSON string with type convert. <code>  {""name"":""Galaxy Nexus"", ""price"":""3460.00""} package mainimport ( ""encoding/json"" ""fmt"")type Product struct { Name string Price float64}func main() { s := `{""name"":""Galaxy Nexus"", ""price"":""3460.00""}` var pro Product err := json.Unmarshal([]byte(s), &pro) if err == nil { fmt.Printf(""%+v\n"", pro) } else { fmt.Println(err) fmt.Printf(""%+v\n"", pro) }} json: cannot unmarshal string into Go value of type float64{Name:Galaxy Nexus Price:0}",How to decode JSON with type convert from string to float64
Golang: transfer var into anonymous function," I am having trouble transferring a variable into an anonymous function. Is there a solution? exec(i) where i always = 11  <code>  import ""github.com/lxn/walk""***var openAction [12]*walk.Actionfor i := 0; i < 12; i++ { openBmp, err := walk.NewBitmapFromFile(_films[i][0]) if err != nil { log.Printf(""Open bitmap for buildBody() :%v\n"", err) } openAction[i] = walk.NewAction() openAction[i].SetImage(openBmp) openAction[i].SetText(_films[i][2]) openAction[i].Triggered().Attach( func(){ exec(i) }) mw.ToolBar().Actions().Add(openAction[i])}",Go: transfer var into anonymous function
Converting a 50 digit string to an integer in Go," How do you convert a long string of digits (50 digits) into an integer in Go?I am getting the output for the code below: err = strconv.ParseInt: parsing ""37107287533902102798797998220837590246510135740250 "": value out of rangeIt seems to be able to convert numbers only up to 2147483647. <code>  number = 2147483647 package mainimport ""fmt""import ""io/ioutil""import ""strings""import ""strconv""var ( number int64)func main() { fData,err := ioutil.ReadFile(""one-hundred_50.txt"") if err != nil { fmt.Println(""Err is "",err) } strbuffer := string(fData) lines := strings.Split(strbuffer, ""\n"") for i, line := range lines { fmt.Printf(""%d: %s\n"", i, line) number, err := strconv.Atoi(line) fmt.Println(""number = "", number) fmt.Println(""err = "", err) } }","Using big integer values in Go? (ParseInt only converts up to ""2147483647""?)"
"Using big integer values in Go? (ParseInt only coverts up to ""2147483647""?)"," How do you convert a long string of digits (50 digits) into an integer in Go?I am getting the output for the code below: err = strconv.ParseInt: parsing ""37107287533902102798797998220837590246510135740250 "": value out of rangeIt seems to be able to convert numbers only up to 2147483647. <code>  number = 2147483647 package mainimport ""fmt""import ""io/ioutil""import ""strings""import ""strconv""var ( number int64)func main() { fData,err := ioutil.ReadFile(""one-hundred_50.txt"") if err != nil { fmt.Println(""Err is "",err) } strbuffer := string(fData) lines := strings.Split(strbuffer, ""\n"") for i, line := range lines { fmt.Printf(""%d: %s\n"", i, line) number, err := strconv.Atoi(line) fmt.Println(""number = "", number) fmt.Println(""err = "", err) } }","Using big integer values in Go? (ParseInt only converts up to ""2147483647""?)"
Partly JSON unmarshal into a map[string][]byte in Go," My websocket server will receive and unmarshal JSON data. This data will always be wrapped in an object with key/value pairs. The key-string will act as value identifier, telling the Go server what kind of value it is. By knowing what type of value, I can then proceed to JSON unmarshal the value into the correct type of struct.Each json-object might contain multiple key/value pairs.Example JSON: Is there any easy way using the ""encoding/json"" package to do this? Thanks for any kind of suggestion/help! <code>  { ""sendMsg"":{""user"":""ANisus"",""msg"":""Trying to send a message""}, ""say"":""Hello""} package mainimport ( ""encoding/json"" ""fmt"")// the struct for the value of a ""sendMsg""-commandtype sendMsg struct { user string msg string}// The type for the value of a ""say""-commandtype say stringfunc main(){ data := []byte(`{""sendMsg"":{""user"":""ANisus"",""msg"":""Trying to send a message""},""say"":""Hello""}`) // This won't work because json.MapObject([]byte) doesn't exist objmap, err := json.MapObject(data) // This is what I wish the objmap to contain //var objmap = map[string][]byte { // ""sendMsg"": []byte(`{""user"":""ANisus"",""msg"":""Trying to send a message""}`), // ""say"": []byte(`""hello""`), //} fmt.Printf(""%v"", objmap)}",Partly JSON unmarshal into a map in Go
What's the recommended way to connect to mysql from Go?," I am looking for a reliable solution to connect to a MySQL database from Go. I've seen some libraries around but it is difficult to determine the different states of completeness and current maintenance. I don't have complicated needs, but I'd like to know what people are relying on, or what's the most standard solution to connect to MySQL. <code> ",What's the recommended way to connect to MySQL from Go?
Golang : What's the recommended way to connect to mysql from Go?," I am looking for a reliable solution to connect to a MySQL database from Go. I've seen some libraries around but it is difficult to determine the different states of completeness and current maintenance. I don't have complicated needs, but I'd like to know what people are relying on, or what's the most standard solution to connect to MySQL. <code> ",What's the recommended way to connect to MySQL from Go?
What's the recommended way to connect to mysql from Go?," I am looking for a reliable solution to connect to a MySQL database from Go. I've seen some libraries around but it is difficult to determine the different states of completeness and current maintenance. I don't have complicated needs, but I'd like to know what people are relying on, or what's the most standard solution to connect to MySQL. <code> ",What's the recommended way to connect to MySQL from Go?
Idiomatic way to cast multiple return values in Go," What is the idiomatic way to cast multiple return values in Go?Can you do it in a single line, or do you need to use temporary variables such as I've done in my example below? By the way, is it called casting when it comes to interfaces? <code>  package mainimport ""fmt""func oneRet() interface{} { return ""Hello""}func twoRet() (interface{}, error) { return ""Hejsan"", nil}func main() { // With one return value, you can simply do this str1 := oneRet().(string) fmt.Println(""String 1: "" + str1) // It is not as easy with two return values //str2, err := twoRet().(string) // Not possible // Do I really have to use a temp variable instead? temp, err := twoRet() str2 := temp.(string) fmt.Println(""String 2: "" + str2 ) if err != nil { panic(""unreachable"") } } i := interface.(int)",Idiomatic way to do conversion/type assertion on multiple return values in Go
Terminating a Process Started with os.exec in Golang," Is there a way to terminate a process started with os.exec in Golang? For example (from http://golang.org/pkg/os/exec/#example_Cmd_Start), Is there a way to terminate that process ahead of time, perhaps after 3 seconds?Thanks in advance <code>  cmd := exec.Command(""sleep"", ""5"")err := cmd.Start()if err != nil { log.Fatal(err)}log.Printf(""Waiting for command to finish..."")err = cmd.Wait()log.Printf(""Command finished with error: %v"", err)",Terminating a Process Started with os/exec in Golang
Golang - What is channel buffer size?," I'm trying to create an asynchronous channel and I've been looking at http://golang.org/ref/spec#Making_slices_maps_and_channels. What does it mean that the buffer size is 10? What specifically does the buffer size represent/limit? <code>  c := make(chan int, 10) // channel with a buffer size of 10",What is channel buffer size?
Golang/mgo: Why does mgo not return the ID of inserted document?," According to the documentation (http://godoc.org/launchpad.net/mgo/v2) you can obtain the ID of your ""Upserted"" document if you use the Upsert method.There is also an Insert method that does not provide this functionality.Why is that? What if I want to perform an Insert instead of an Upsert? (or wouldn't ever be any valid reason to want to do that? I'm starting to wonder.) <code> ",Why does mgo not return the ID of inserted document?
Writing a Python extension in Go (golang)," I currently use Cython to link C and Python, and get speedup in slow bits of python code. However, I'd like to use goroutines to implement a really slow (and very parallelizable) bit of code, but it must be callable from python. (I've already seen this question)I'm (sort of) happy to go via C (or Cython) to set up data structures etc if necessary, but avoiding this extra layer would be good from a bug fix/avoidance point of view.What is the simplest way to do this without having to reinvent any wheels? <code> ",Writing a Python extension in Go (Golang)
How to execute a simple Windows DOS command in Golang?," How to run a simple Windows command?This command: .. outputs this message: del: executable file not found in %path%What am I doing wrong? <code>  exec.Command(""del"", ""c:\\aaa.txt"")",How to execute a simple Windows command in Golang?
go language - else logic," Here is the program to find the factorial of a number in Go: The output for this function when called on input 5 is 120. However, if I add an else statement I get an error. Error : function ends without a return statementI added a return at the end : and I get back the expected output of 120.Why would the second case cause an error? Why in the third case even though the function never reaches the last return 1, it computes the correct output? <code>  func factorial(x uint) uint { if x == 0 { return 1 } return x * (factorial(x - 1))} func factorial(x uint) uint { if x == 0 { return 1 } else { return x * (factorial(x - 1)) }} func factorial(x uint) uint { if x == 0 { return 1 } else { return x * (factorial(x - 1)) } fmt.Println(""this never executes"") return 1}",Go code doesn't compile without an unreachable return statement
Golang code doesn't compile without an unreachable return statement," Here is the program to find the factorial of a number in Go: The output for this function when called on input 5 is 120. However, if I add an else statement I get an error. Error : function ends without a return statementI added a return at the end : and I get back the expected output of 120.Why would the second case cause an error? Why in the third case even though the function never reaches the last return 1, it computes the correct output? <code>  func factorial(x uint) uint { if x == 0 { return 1 } return x * (factorial(x - 1))} func factorial(x uint) uint { if x == 0 { return 1 } else { return x * (factorial(x - 1)) }} func factorial(x uint) uint { if x == 0 { return 1 } else { return x * (factorial(x - 1)) } fmt.Println(""this never executes"") return 1}",Go code doesn't compile without an unreachable return statement
How to avoid parallel processing in golang," I seem to be having a queer problem while getting user input within a for loop in go. Here is my code What happens when I run this code is this : What I notice is that each iteration of the loop happens twice, Could this be because Go is using parallelism by default and causing both processors to run the code within a for loop?  <code>  package mainimport ""fmt""func main() { var num int for i := 0; i < 10; i++ { fmt.Printf(""Debug: i : %d "", i) fmt.Scanf(""%d"", &num) fmt.Println(num) }} Debug: i : 0Enter next number11Debug: i : 1Enter next number1Debug: i : 2Enter next number22Debug: i : 3Enter next number2Debug: i : 4Enter next number33Debug: i : 5Enter next number3Debug: i : 6Enter next number44Debug: i : 7Enter next number4Debug: i : 8Enter next number55Debug: i : 9Enter next number5",How do I use fmt.Scanf in Go
Go - Parsing date/time strings which are not 'standard' formats," How do I parse non-standard date/time strings in Go. In example if I wanted to convert the string 10/15/1983 into a time.Time? The time.Parse() function supposedly allows you to specify a format.http://play.golang.org/p/v5DbowXt1x This results in a panic.panic: parsing time ""10/15/1983"" as ""10/15/1983"": cannot parse """" as ""0/""Logically that makes sense because how is it supposed to know which is the day and which is the month.Other languages have a function similar to the following:parse(""mm/dd/yyyy"", ""10/15/1983"")I cannot find such a function in the Go docs, is my only choice to regex? <code>  package mainimport ""fmt""import ""time""func main() { test, err := time.Parse(""10/15/1983"", ""10/15/1983"") if err != nil { panic(err) } fmt.Println(test)}",Parsing date/time strings which are not 'standard' formats
How to call function from another file in go language?," I want to call function from another file in Go. Can any one help?test1.go test2.go How to call demo in test2 from test1? <code>  package mainfunc main() { demo()} package mainimport ""fmt""func main() {}func demo() { fmt.Println(""HI"")}",How to call function from another file in Go
Go file names starting with underline character," I wanted a specific file to appear at the top of my file list in my editor, so I prefixed it with _. This is how it looks: I know about Go's file naming conventions using _test, _unix etc, however, since _func does not match a specific architecture or is a test case, why doesn't it count as source file?When I import this package, functions defined in this file are not available. <code>  mypkg _func.go a.go b.go",Go file names starting with underscore character
Gracefull restart to keep connections open. Golang," I am sure I saw some open source server written in Go that was able to restart and keep connections open.I can't find it to learn that technique.I know apache.httpd has apachectl graceful that restarts and keeps connections open.How does it done in general and in Go?I thought it must fork and 1 exit, 2 exec(new go app) and link connections by Fd.But in Go I can find only ForkExec function. I think Fork is required.Also syscall package is not very well documented. <code> ",Graceful restart to keep connections open
Why to create slice with make in GO?," What is the difference between var a [4]int and b := make([]int, 4)? The b can be extended, but not a, right? But if I know that I need really i.e. 4 elements, then is an array faster then a slice?Is there any performance difference between var d []int and e := make([]int)? Would f := make([]int, 5) provide more performance than without the length for the first i.e. 5 elements? Would this c := make([]int, 5, 10) not allocate more memory than I can access?  <code> ",Why use make() to create a slice in Go?
Interfaces and Fields in Go," I started looking into Go after playing around with structural typing in other languages like Scala and OCaml, and I'm trying map some of the idiomatic techniques between the languages. Consider the following types Let's say we'd like to write a method which operates on both of these types to compute their polar coordinate representations, func ConvertXYToPolar(point XYPoint) PolarPoint. If the CartesianPoint and CoordinatePoint types defined getter and setter methods for the x and y fields we could define XYPoint as a common interface with those methods, allowing us to operate on both types, but as it stands, interfaces cannot declare fields, only methods.Based on this, I have a few questions:What is the idiomatic way of handling this in Go?Can it be done without modifying the existing types?Can we retain type safety, i.e. avoid defining ConvertXYToPolar without using the empty interface type as the parameter and manually converting?If interfaces and implicit interface satisfaction are the primary tools for polymorphism in Go, is the forbiddence of fields in interface definitions limiting?Are getter/setter methods commonly defined on structs to circumvent this limitation?Is there a compelling reason behind the design decision not to support fields in interface definitions?I find the simplicity of embedded types, implicit interface satisfaction, and interface-based polymorphism to be a very simple and appealing combination of techniques to promote code reusability and maintainability, but forbidding fields in interface definitions makes Go's structural typing capabilities somewhat limited from my perspective. Am I missing a simple solution? <code>  type CoordinatePoint struct { x int y int // Other methods and fields that aren't relevant}type CartesianPoint struct { x int y int // Other methods and fields that aren't relevant}",Structural typing and polymorphism in Go - Writing a method that can operate on two types having the same fields
Structural typing and polymorphism in Go - Writing a method which can operate on two types with the same fields," I started looking into Go after playing around with structural typing in other languages like Scala and OCaml, and I'm trying map some of the idiomatic techniques between the languages. Consider the following types Let's say we'd like to write a method which operates on both of these types to compute their polar coordinate representations, func ConvertXYToPolar(point XYPoint) PolarPoint. If the CartesianPoint and CoordinatePoint types defined getter and setter methods for the x and y fields we could define XYPoint as a common interface with those methods, allowing us to operate on both types, but as it stands, interfaces cannot declare fields, only methods.Based on this, I have a few questions:What is the idiomatic way of handling this in Go?Can it be done without modifying the existing types?Can we retain type safety, i.e. avoid defining ConvertXYToPolar without using the empty interface type as the parameter and manually converting?If interfaces and implicit interface satisfaction are the primary tools for polymorphism in Go, is the forbiddence of fields in interface definitions limiting?Are getter/setter methods commonly defined on structs to circumvent this limitation?Is there a compelling reason behind the design decision not to support fields in interface definitions?I find the simplicity of embedded types, implicit interface satisfaction, and interface-based polymorphism to be a very simple and appealing combination of techniques to promote code reusability and maintainability, but forbidding fields in interface definitions makes Go's structural typing capabilities somewhat limited from my perspective. Am I missing a simple solution? <code>  type CoordinatePoint struct { x int y int // Other methods and fields that aren't relevant}type CartesianPoint struct { x int y int // Other methods and fields that aren't relevant}",Structural typing and polymorphism in Go - Writing a method that can operate on two types having the same fields
How to Convert JSON to CSV in Golang?," How can I fix the error?http://play.golang.org/p/0UMnUZOUHw Error: <code>  // JSON to CSV in Golangpackage mainimport ( ""encoding/csv"" ""encoding/json"" ""fmt"" ""io/ioutil"" ""os"")type Json struct { RecordID int64 `json:""recordId""` DOJ string `json:""Date of joining""` EmpID string `json:""Employee ID""`}func main() { // reading data from JSON File data, err := ioutil.ReadFile(""./people.json"") if err != nil { fmt.Println(err) } // Unmarshal JSON data var d []Json err = json.Unmarshal([]byte(data), &d) if err != nil { fmt.Println(err) } // Create a csv file f, _ := os.Create(""./people.csv"") defer f.Close() // Write Unmarshaled json data to CSV file w := csv.NewWriter(f) // How to proceed further? /* I am getting errors if i use below for _,obj := range d { var record []interface{} record = append(record, obj.RecordID) record = append(record, obj.DOJ) record = append(record, obj.EmpID) w.Write(record) } */} cannot use record (type []interface {}) as type []string in function argument",How to Convert JSON to CSV?
GO lang Month to int," Situation:When I call time functions like Second(), Year() etc., I get a result of tye int. But when I call Month(), I get a result of type Month.I found the following in the online docs: .. but I don't quite understand it.Problem:My code has the following error because m is not an int: invalid operation: m / time.Month(10) + offset (mismatched types time.Month and int)Question:How to get an int from Month()? <code>  type Month int...func (m Month) String() string",Month to int in Go
Golang: int16 to byte array, I'm trying to convert a int16 to a byte array but i cant seem to get it to work.Here is what i've got right now: Also if someone wonder the array needs to be a length of 2. <code>  int16 i := 41a := []byte(string(i))//this line is wrong,int16 to byte array
Webserver for Go (golang) webservices: using NGINX or not?," I am writing some webservices returning JSON data, which have lots of users.What are the benefits of using Nginx in front my server compared to just using the go http server? <code> ",What are the benefits of using Nginx in front of a webserver for Go?
Golang operator difference between := vs =," What is the difference between the = and := operators, and what are the use cases for them? They both seem to be for an assignment? <code> ",Difference between := and = operators in Go
Why do we need constant time *single byte* comparison function?," Looking at Go standard library, there's a ConstantTimeByteEq function that looks like this: Now, I understand the need for constant time string (array, etc.) comparison, as a regular algorithm could short-circuit after the first unequal element. But in this case, isn't a regular comparison of two fixed-sized integers a constant time operation at the CPU level already? <code>  func ConstantTimeByteEq(x, y uint8) int { z := ^(x ^ y) z &= z >> 4 z &= z >> 2 z &= z >> 1 return int(z)}",Why do we need a constant time *single byte* comparison function?
How can we trucate float64 type to a paticular precision in golang?," I had to write the program above to decrease the precision of a go float64 variable to 2. In this case I was using both strconv and fmt. Is there some other logical method by which it can be done? <code>  package mainimport ( ""fmt"" ""strconv"" )func main() { k := 10/3.0 i := fmt.Sprintf(""%.2f"", k) f,_ := strconv.ParseFloat(i, 2) fmt.Println(f)}",How can we truncate float64 type to a particular precision?
How can we truncate float64 type to a particular precision in golang?," I had to write the program above to decrease the precision of a go float64 variable to 2. In this case I was using both strconv and fmt. Is there some other logical method by which it can be done? <code>  package mainimport ( ""fmt"" ""strconv"" )func main() { k := 10/3.0 i := fmt.Sprintf(""%.2f"", k) f,_ := strconv.ParseFloat(i, 2) fmt.Println(f)}",How can we truncate float64 type to a particular precision?
golang: confusing output on fizzbuzz with switch case statement," Here the famous ""fizz buzz"" program in Go using switch/case and if/else conditionals. The problem is that using switch/case is generating unexpected output while if/else (with same conditions) works fine. I know that switch/case in golang is different than other C-family languages, but what's wrong with this code fragment? } <code>  func main() {const ( FIZZ = 3 BUZZ = 5)//section with switch/case gives unexpected outputfor i := 1; i <= 30; i++ { switch { case i % FIZZ == 0: fmt.Printf(""%d fizz\t"", i%3) fallthrough case i % BUZZ == 0: fmt.Printf(""%d buzz\t"", i%5) } fmt.Printf(""\t%d\n"", i)}fmt.Printf(""now towards the if/else\n"")//section with if/else works as expectedfor i := 1; i <= 30; i++ { if i % FIZZ == 0 { fmt.Printf(""%d fizz\t"", i%3) } if i % BUZZ == 0 { fmt.Printf(""%d buzz\t"", i%5) } fmt.Printf(""\t%d\n"", i)}",Confusing output on fizzbuzz with switch case statement
Not buffered http.ResponseWritter in golang," I'm writing a simple web app in Go and I want my responses to be streamed to the client (i.e. not buffered and sent in blocks once the request is fully processed) : From the client point of view, the two lines will be sent at the same time. Any suggestions are appreciated :)Edit after @dystroy answerIt's possible to flush after each write I personally make, but in my use case it's not enough: I want the output of my cmd to be flushed as well. Anyway to ""autoflush"" the ResponseWritter ?SolutionI found help on golang's mailing list. There is 2 way to achieve this: using hijacker that allow to take over the underlying TCP connection of HTTP, or piping the stdout and stderr of the command in a go routine that will write and flush : Last updateEven nicer: http://play.golang.org/p/PpbPyXbtEs <code>  func handle(res http.ResponseWriter, req *http.Request) { fmt.Fprintf(res, ""sending first line of data"") sleep(10) //not real code fmt.Fprintf(res, ""sending second line of data"")} cmd := exec.Command(""a long command that outputs lots of lines"")cmd.Stdout = res //where res is a http.ResponseWrittercmd.Stderr = reserr := cmd.Run() pipeReader, pipeWriter := io.Pipe()cmd.Stdout = pipeWritercmd.Stderr = pipeWritergo writeCmdOutput(res, pipeReader)err := cmd.Run()pipeWriter.Close()//---------------------func writeCmdOutput(res http.ResponseWriter, pipeReader *io.PipeReader) { buffer := make([]byte, BUF_LEN) for { n, err := pipeReader.Read(buffer) if err != nil { pipeReader.Close() break } data := buffer[0:n] res.Write(data) if f, ok := res.(http.Flusher); ok { f.Flush() } //reset buffer for i := 0; i < n; i++ { buffer[i] = 0 } } }",Not buffered http.ResponseWritter in Golang
Building and linking from a go binary," My problem is the following:I have a go binary on a machineFrom that binary I need to compile an external .go fileOnce compiled, I need to link the compiled go file into the current binary so I can use the just-compiled go code.Do you think that's possible ?I did a few researches and it does not seem to be possible, but I might have overlooked something.Thanks :)The first go binary would contain something like <code>  func main() { // Here I need to compile an external go file (or package) which contains // The definition of runFoo() // Once the file/package is compiled and linked I need to call the compiled code runFoo() // Continue the execution process normally here}",Building and linking dynamically from a go binary
Unpack golang slices on assignment?," Is there an elegant way in Go to do multiple assignments from arrays like in Python? Here is a Python example of what I'm trying to do (split a string and then assign the resulting array into two variables). My current solution is: I'm can see this getting messy in some constructs. The practical example I'm currently facing is a bookmark file parsing and assigning to a map: Now I have a useless variable x sitting around. I'd like to do something like: but that's invalid. <code>  python:>>> a, b = ""foo;bar"".split("";"") x := strings.Split(""foo;bar"", "";"")a, b := x[0], x[1] bookmark := make(map[string]string)x := strings.Split(""foo\thttps://bar"", ""\t"")name, link := x[0], x[1]bookmark[name] = link bookmark := make(map[string]string)name, line := strings.Split(""foo\thttps://bar"", ""\t"")bookmark[name] = link",Unpack slices on assignment?
Unpack Golang slices on assignment?," Is there an elegant way in Go to do multiple assignments from arrays like in Python? Here is a Python example of what I'm trying to do (split a string and then assign the resulting array into two variables). My current solution is: I'm can see this getting messy in some constructs. The practical example I'm currently facing is a bookmark file parsing and assigning to a map: Now I have a useless variable x sitting around. I'd like to do something like: but that's invalid. <code>  python:>>> a, b = ""foo;bar"".split("";"") x := strings.Split(""foo;bar"", "";"")a, b := x[0], x[1] bookmark := make(map[string]string)x := strings.Split(""foo\thttps://bar"", ""\t"")name, link := x[0], x[1]bookmark[name] = link bookmark := make(map[string]string)name, line := strings.Split(""foo\thttps://bar"", ""\t"")bookmark[name] = link",Unpack slices on assignment?
Why html/template doesn't show all html conditional comments?," I have a simple Go HTML template which contains HTML conditional comments: This produces: Why does html/template remove those conditional comments after compiling? <code>  package mainimport ( ""html/template"" ""os"")var body = `<!doctype html><html> <head> <!--[if !IE]><!--><script src=""http://code.jquery.com/jquery-2.0.3.min.js""></script><!--<![endif]--> <!--[if gte IE 9]><script src=""http://code.jquery.com/jquery-2.0.3.min.js""></script><![endif]--> <!--[if lt IE 9]><script src=""http://code.jquery.com/jquery-1.10.2.min.js""></script><![endif]--> </head></html>`func main() { tmp := template.Must(template.New(""tmp"").Parse(body)) tmp.Execute(os.Stdout, nil)} <!doctype html><html> <head> <script src=""http://code.jquery.com/jquery-2.0.3.min.js""></script> </head></html>",Why doesn't html/template show all html conditional comments?
How to test a collection of functions by reflection?," I have to write unit tests for several functions with similar signature and return values (an object and an error), which must pass similar test conditions.I would like to avoid writing: (See this go playground example for a more complete context)(yes, go playground doesn't support yet go test, only go run, and issue 6511 is there to request that feature)How would you use reflection (reflect package) in order to write only one test which would:call each function in turn?test their return value?I have seen:""How to properly use .Call in reflect package, Golang?"", using Value.Call""Selecting a function from a list of functions in Golang""But I miss a complete example for calling functions and using the returned values in a test. <code>  func TestFunc1(t *testing.T) { // tests on return values}func TestFunc2(t *testing.T) { // tests identical for Func1}func TestFunc3(t *testing.T) { // tests identical for Func1}...",How to test a collection of functions by reflection in Go?
Simple way to copy a file in golang, Is there any simple/fast way to copy a file in Go?I couldn't find a fast way in the Doc's and searching the internet doesn't help as well.  <code> ,Simple way to copy a file
Simple way to copy a file in Golang, Is there any simple/fast way to copy a file in Go?I couldn't find a fast way in the Doc's and searching the internet doesn't help as well.  <code> ,Simple way to copy a file
Go: Get an io.ByteReader from a net.Conn," I am connecting to a TCP/IP server using Go code similar to: Now I need to use binary.ReadVariant which takes an io.ByteReader, so trying to write code like this: Gives me an error like: How can I make this work? <code>  conn, err := net.Dial(""tcp"", host+"":""+strconv.Itoa(port)) var length int64var err errorlength, err = binary.ReadVarint(conn) ./main.go:67: cannot use conn (type net.Conn) as type io.ByteReader in function argument: net.Conn does not implement io.ByteReader (missing ReadByte method)",Get an io.ByteReader from a net.Conn
Is it possible to retreiving a column value by name using GoLang database.sql," All of the examples I've seen for using sql.Row, access return values from queries by position:sql.Rows.scan() requires a correctly typed variable correctly positioned in the scan() arguments corresponding to the appropriate column, to retrieve each column value returned, such as in the following example: Example Based on GoDocs (with small mod): &name and &age must be positioned correctly (columns 0 and 1) for Rows.Scan() to retrieve the correct values with the correct types.Over my years of development for production systems, I have come to studiously avoid this practice because it's not robust: A database change in the layout of the columns will easily break your code if it's based on column positions. It is far more robust to use column names for retrieving values - this insulates you from changes to the database that add or remove columns that screw up your position based code. For example, in Delphi and C#, all dataSets, including columns returning values from queries, support FieldByName('age').asInteger or fields['age'].value, etc. Any way to accomplish this in Go? If not, this is a big drawback in Go database support and a serious disappointment - not at all safe, as mentioned.Edit:Also (perhaps this is a new question): The examples I've seen seem to require you to retrieve all the columns returned by the query, or the positions of the columns will be skewed. Suppose there is utility query in a locked-down database that I cannot modify or add to, and it retrieves several columns, but I only need one of them for my current task. Based on the current sql.Rows.Scan() model, I have to retrieve all the values from the query in my application code, even though I don't need them, whereas if I could query ""columnByName"" that would not be necessary - I could just bring into my application code the data I need. Any work-around for this? <code>  rows, err := db.Query(""SELECT name,age FROM users WHERE age>=50"")if err != nil { log.Fatal(err)}for rows.Next() { var name string var age int if err := rows.Scan(&name,&age); err != nil { log.Fatal(err) } fmt.Printf(""%s is %d\n"", name, age)}if err := rows.Err(); err != nil { log.Fatal(err)} ",Is it possible to retrieve a column value by name using GoLang database/sql
Is it possible to retreive a column value by name using GoLang database.sql," All of the examples I've seen for using sql.Row, access return values from queries by position:sql.Rows.scan() requires a correctly typed variable correctly positioned in the scan() arguments corresponding to the appropriate column, to retrieve each column value returned, such as in the following example: Example Based on GoDocs (with small mod): &name and &age must be positioned correctly (columns 0 and 1) for Rows.Scan() to retrieve the correct values with the correct types.Over my years of development for production systems, I have come to studiously avoid this practice because it's not robust: A database change in the layout of the columns will easily break your code if it's based on column positions. It is far more robust to use column names for retrieving values - this insulates you from changes to the database that add or remove columns that screw up your position based code. For example, in Delphi and C#, all dataSets, including columns returning values from queries, support FieldByName('age').asInteger or fields['age'].value, etc. Any way to accomplish this in Go? If not, this is a big drawback in Go database support and a serious disappointment - not at all safe, as mentioned.Edit:Also (perhaps this is a new question): The examples I've seen seem to require you to retrieve all the columns returned by the query, or the positions of the columns will be skewed. Suppose there is utility query in a locked-down database that I cannot modify or add to, and it retrieves several columns, but I only need one of them for my current task. Based on the current sql.Rows.Scan() model, I have to retrieve all the values from the query in my application code, even though I don't need them, whereas if I could query ""columnByName"" that would not be necessary - I could just bring into my application code the data I need. Any work-around for this? <code>  rows, err := db.Query(""SELECT name,age FROM users WHERE age>=50"")if err != nil { log.Fatal(err)}for rows.Next() { var name string var age int if err := rows.Scan(&name,&age); err != nil { log.Fatal(err) } fmt.Printf(""%s is %d\n"", name, age)}if err := rows.Err(); err != nil { log.Fatal(err)} ",Is it possible to retrieve a column value by name using GoLang database/sql
Is it possible to retreive a column value by name using GoLang database/sql," All of the examples I've seen for using sql.Row, access return values from queries by position:sql.Rows.scan() requires a correctly typed variable correctly positioned in the scan() arguments corresponding to the appropriate column, to retrieve each column value returned, such as in the following example: Example Based on GoDocs (with small mod): &name and &age must be positioned correctly (columns 0 and 1) for Rows.Scan() to retrieve the correct values with the correct types.Over my years of development for production systems, I have come to studiously avoid this practice because it's not robust: A database change in the layout of the columns will easily break your code if it's based on column positions. It is far more robust to use column names for retrieving values - this insulates you from changes to the database that add or remove columns that screw up your position based code. For example, in Delphi and C#, all dataSets, including columns returning values from queries, support FieldByName('age').asInteger or fields['age'].value, etc. Any way to accomplish this in Go? If not, this is a big drawback in Go database support and a serious disappointment - not at all safe, as mentioned.Edit:Also (perhaps this is a new question): The examples I've seen seem to require you to retrieve all the columns returned by the query, or the positions of the columns will be skewed. Suppose there is utility query in a locked-down database that I cannot modify or add to, and it retrieves several columns, but I only need one of them for my current task. Based on the current sql.Rows.Scan() model, I have to retrieve all the values from the query in my application code, even though I don't need them, whereas if I could query ""columnByName"" that would not be necessary - I could just bring into my application code the data I need. Any work-around for this? <code>  rows, err := db.Query(""SELECT name,age FROM users WHERE age>=50"")if err != nil { log.Fatal(err)}for rows.Next() { var name string var age int if err := rows.Scan(&name,&age); err != nil { log.Fatal(err) } fmt.Printf(""%s is %d\n"", name, age)}if err := rows.Err(); err != nil { log.Fatal(err)} ",Is it possible to retrieve a column value by name using GoLang database/sql
The last element of a slice," What is the Go way for extracting the last element of a slice? The solution above works, but seems awkward. <code>  var slice []intslice = append(slice, 2)slice = append(slice, 7)slice[len(slice)-1:][0] // Retrieves the last element",How to get the last element of a slice?
How to get the last element of a slice in Golang?," What is the Go way for extracting the last element of a slice? The solution above works, but seems awkward. <code>  var slice []intslice = append(slice, 2)slice = append(slice, 7)slice[len(slice)-1:][0] // Retrieves the last element",How to get the last element of a slice?
Check if string is int golang," How can I check if a string value is an integer or not in Go?Something like Note: I know that strconv.Atoi returns an error, but is there any other function to do this?The problem with strconv.Atoi is that it will return 7 for ""a7"" <code>  v := ""4""if isInt(v) { fmt.Println(""We have an int, we can safely cast this with strconv"")}",Check if string is int
Golang reflection: Set fields of non-ptr Interface," I am trying to implement a method that changes the value of fields in an object that can have an arbitrary structure. The traversion of the fields is no problem when I have the pointer to a struct. But I can not manage to change the fields when I have an interface that does not wrap a pointer to a struct but the struct itself, in short: In long: http://play.golang.org/p/OsnCPvOx8FI have read The Laws of Reflection so I am aware that I may only modify fields when I have a pointer to a struct. So my question is now: How do I get the pointer to the data of the struct?UPDATE:I got it working using basically y := reflect.New(reflect.TypeOf(x)) so the values of y are settable now. For an extensive example see this: https://gist.github.com/hvoecking/10772475 <code>  // The following doesn't workvar x interface{} = A{Str: ""Hello""}// This panics: reflect: call of reflect.Value.Field on ptr Valuereflect.ValueOf(&x).Field(0).SetString(""Bye"")// This panics: reflect: call of reflect.Value.Field on interface Valuereflect.ValueOf(&x).Elem().Field(0).SetString(""Bye"")// This panics: reflect: reflect.Value.SetString using unaddressable valuereflect.ValueOf(&x).Elem().Elem().Field(0).SetString(""Bye"")// This prints `false`. But I want this to be settablefmt.Println(reflect.ValueOf(&x).Elem().Elem().Field(0).CanSet())// This worksvar z interface{} = &A{Str: ""Hello""}// This prints `true`fmt.Println(reflect.ValueOf(z).Elem().Field(0).CanSet())",Golang reflection: Can't set fields of interface wrapping a struct
sort golang map values by keys," When iterating through the returned map in the code, returned by the topic function, the keys are not appearing in order.How can I get the keys to be in order / sort the map so that the keys are in order and the values correspond?Here is the code. <code> ","Collect values in order, each containing a map"
Sort Go map values by keys," When iterating through the returned map in the code, returned by the topic function, the keys are not appearing in order.How can I get the keys to be in order / sort the map so that the keys are in order and the values correspond?Here is the code. <code> ","Collect values in order, each containing a map"
How can I dump all a Go process's stacks?," A Go process is running. I want todump a stack trace for each of its goroutinesfrom the outside, without depending on anything I add to its source codewithout killing it.How can I do that?This should be easy -- the feature was requested: https://code.google.com/p/go/issues/detail?id=2516 and, according to the conclusion of that thread, implemented. That was over two years ago. But neither the issue thread nor the commit contains any hint as to how to invoke this feature.The feature request mentioned SIGQUIT as the signal the JVM accepts to invoke the corresponding feature there. But SIGQUIT isn't the answer; on go1.2 at least, SIGQUIT does #1 and #2 but also kills the process.Someone asked a related question here a while ago: How to dump goroutine stacktraces?but they didn't clearly ask for #2 or #3, none of the answers meet #2, and they accepted an answer that doesn't meet #2. So this is a different question. <code> ",How can I dump all a Go process's stacks without killing it?
How can I pass a slice as a list?," I have a function func more(... t). I'm wondering if it's possible to use a slice to populate a list of arguments ... . I'm trying to solve the following program. Basically to mimic a normal shell which receives the command as a string. Command function requires a ""list"" of arguments and I don't see how I can convert a string into a such list  <code>  import ""os/exec"" import ""strings"" func main(){ plainCommand := ""echo hello world"" sliceA := strings.Fields(plainCommand) cmd := exec.Command(sliceA) }",How can I pass a slice as a variadic input?
GOLANG saving enums to a database," I'm new to Go and I'm trying to write a little program to save enumerated values to a database.The way I declare my values is as follows: I use these values in my struct like this: I use gorp for my database stuff, but I guess the use of gorp isn't relevant to my problem. I put stuff in my DB like this: but when I try to retrieve stuff I get the following error: When I use int64 as the type for the const(...) and for the File.Type field, everything works fine, but I'm new to Go and want to understand the problem.The way I see it, I have two problems:Why can't Go convert this stuff successfully? I looked at the source code of the Go reflection and sql packages and there are methods for this kind of conversion, but they seem to fail. Is this a bug? What is the problem?I figured out, that one can implement the sql.Scanner interface by implementing the following method: I tried to implement the method and I even was able to get the right value from src and convert it to a FileType, but I was confused if I should implement the method for ""(f *FileType) or (f FileType). Either way the method gets invoked, however I'm not able to overwrite f (or at least the update gets lost later) and the File instances read from the DB always had a ""0"" as value for File.Type.Do you have any ideas on those two points? <code>  type FileType int64const ( movie FileType = iota music book etc) type File struct { Name string Type FileType Size int64} dbmap.Insert(&File{""MyBook.pdf"",movie,1000}) dbmap.Select(&dbFiles, ""select * from Files"") panic: reflect.Set: value of type int64 is not assignable to type main.FileType Scan(src interface{}) error",Saving enumerated values to a database
Load package dynamically in golang," Is it possible to load a specific package during runtime? I want to have a kind of plugins where each one has the same functions than the others but with different behaviour, and depending on the configuration file, load one or other. <code> ",Load package dynamically
Golang - Capitals in struct fields," I'm using this library to access CouchDB (cloudant to be specific) ""github.com/mikebell-org/go-couchdb"" and I've noticed a problem. When I go to add a file to the database and pass in a struct, only the fields of the struct which started with a capital letter get added. For example In this case, only the ""age"" field got updated and inserted into my database.I've noticed this problem in another case also - when I'm doing something like this : in this case, only Name would be printed out : Why is this? and If I would like to have a field with a lowercase and be inside the database, is that possible? <code>  type Person struct { name string Age int}func main() { db, _ := couchdb.Database(host, database, username, password) joe := Person{ name: ""mike"", Age: 190, } m, _ := db.PostDocument(joe)} type Sample struct { Name string age int }joe := Sample{ Name: ""xx"", age: 23,}byt, _ := json.Marshal(joe)post_data := strings.NewReader(string(byt))fmt.Println(post_data) output : &{{""Name"":""xx""} 0 -1}",Capitals in struct fields
GO: multiple-value in single-value context ERROR," I got this error while compiling my GO code: I'm trying to create a function that takes in variable number of ints and prints each variable on a line.GO: Hmm what's wrong? <code>  multiple-value fmt.Println() in single-value context package main import ( ""fmt"")func main() { slice := []int{1,3,4,5} vf(slice...)}func vf(a ...int) int { if len(a)==0 { return 0 } var x int for _, v := range a { x = fmt.Println(v) } return x}",Multiple-value in single-value context ERROR
Decompiling compiled programe with golang, I have built a simple executable program with Go. I've compiled the code into a static binary program.I want to decompile the output binary file and get the Go source code.Is this possible or not? <code> ,Decompiling a compiled program with Go
Decompiling a compiled program with golang, I have built a simple executable program with Go. I've compiled the code into a static binary program.I want to decompile the output binary file and get the Go source code.Is this possible or not? <code> ,Decompiling a compiled program with Go
Benefits of os.LockOSThread in golang," Golang supports LockOSThread() to make current goroutine exclusively tied to current OS thread, and it can also UnlockOSThread().Are there any use cases that benefit from this feature? <code> ",Benefits of runtime.LockOSThread in Golang
Benefits of runtime.LockOSThread in golang," Golang supports LockOSThread() to make current goroutine exclusively tied to current OS thread, and it can also UnlockOSThread().Are there any use cases that benefit from this feature? <code> ",Benefits of runtime.LockOSThread in Golang
How to write a simple custom http server in Go?," I am new to Go and trying to write a custom HTTP server. I'm getting a compilation error. How can I implement the ServeHTTP method in my code?My Code: Error while compiling: <code>  package mainimport ( ""net/http"" ""fmt"" ""io"" ""time"")func myHandler(w http.ResponseWriter, req *http.Request) { io.WriteString(w, ""hello, world!\n"")}func main() { // Custom http server s := &http.Server{ Addr: "":8080"", Handler: myHandler, ReadTimeout: 10 * time.Second, WriteTimeout: 10 * time.Second, MaxHeaderBytes: 1 << 20, } err := s.ListenAndServe() if err != nil { fmt.Printf(""Server failed: "", err.Error()) }} .\hello.go:21: cannot use myHandler (type func(http.ResponseWriter, *http.Request)) as type http.Handler in field value: func(http.ResponseWriter, *http.Request) does not implement http.Handler (missing ServeHTTP method)",How to write a simple custom HTTP server in Go?
Arithmetic operation in go-template," I am trying to achieve a very simple thing in a Go template and failing!The range action allows me to iterate through an array along with its zero-based index, as so: However, I am trying to output indices that start counting from 1. My first attempt failed: This throws an illegal number syntax: ""+"" error.I looked into the go-lang official documentation and did not find anything particular regarding the arithmetic operation inside the template. What am I missing? <code>  {{range $index, $element := .Pages}} Number: {{$index}}, Text: {{element}}{{end}} Number: {{$index + 1}}",Arithmetic in Go templates
Why does golang handle closures differently in goroutines," Consider the following Go code (also on the Go Playground): This code produces the following output: Assuming this isn't some odd compiler bug, I'm curious why a) the value of s is interpreted differently in the goroutine version then in the regular func call and b) and why assigning it to a local variable inside the loop works in both cases. <code>  package mainimport ""fmt""import ""time""func main() { for _, s := range []string{""foo"", ""bar""} { x := s func() { fmt.Printf(""s: %s\n"", s) fmt.Printf(""x: %s\n"", x) }() } fmt.Println() for _, s := range []string{""foo"", ""bar""} { x := s go func() { fmt.Printf(""s: %s\n"", s) fmt.Printf(""x: %s\n"", x) }() } time.Sleep(time.Second)} s: foox: foos: barx: bars: barx: foos: barx: bar",Why does Go handle closures differently in goroutines?
Why does golang handle closures differently in goroutines?," Consider the following Go code (also on the Go Playground): This code produces the following output: Assuming this isn't some odd compiler bug, I'm curious why a) the value of s is interpreted differently in the goroutine version then in the regular func call and b) and why assigning it to a local variable inside the loop works in both cases. <code>  package mainimport ""fmt""import ""time""func main() { for _, s := range []string{""foo"", ""bar""} { x := s func() { fmt.Printf(""s: %s\n"", s) fmt.Printf(""x: %s\n"", x) }() } fmt.Println() for _, s := range []string{""foo"", ""bar""} { x := s go func() { fmt.Printf(""s: %s\n"", s) fmt.Printf(""x: %s\n"", x) }() } time.Sleep(time.Second)} s: foox: foos: barx: bars: barx: foos: barx: bar",Why does Go handle closures differently in goroutines?
Why does Golang handle closures differently in goroutines?," Consider the following Go code (also on the Go Playground): This code produces the following output: Assuming this isn't some odd compiler bug, I'm curious why a) the value of s is interpreted differently in the goroutine version then in the regular func call and b) and why assigning it to a local variable inside the loop works in both cases. <code>  package mainimport ""fmt""import ""time""func main() { for _, s := range []string{""foo"", ""bar""} { x := s func() { fmt.Printf(""s: %s\n"", s) fmt.Printf(""x: %s\n"", x) }() } fmt.Println() for _, s := range []string{""foo"", ""bar""} { x := s go func() { fmt.Printf(""s: %s\n"", s) fmt.Printf(""x: %s\n"", x) }() } time.Sleep(time.Second)} s: foox: foos: barx: bars: barx: foos: barx: bar",Why does Go handle closures differently in goroutines?
golang: get current scope of function name," For tracing purpose, I'd like to print out current function name, like the __FUNCTION__ macro in gcc.So that when I have a function it will automatically print out Entering foo()... or something like that.  <code>  func foo () { trace()}",How to get the current function name
"Of golang, database/sql, and injection", Building my first web-app and want to understand SQL injection better (https://github.com/astaxie/build-web-application-with-golang/blob/master/en/eBook/09.4.md).How much protection against SQL injection do I get from just always using the 'database/sql' library and constructing queries using '?' instead of concatting strings? What kind of SQL injection attacks will I still have to worry about in that case? <code> ,"How can I prevent SQL injection attacks in Go while using ""database/sql""?"
"Golang : cannot use errors.New(""something wrong"") (type error) as type error in return argument"," i have the following code (http://play.golang.org/p/47rvtGqGFn). it works on playground but fail on my system in playground it return something i expected : But when I run ""go install"" on my system, I get compiler error : I feel this is really weird. I have upgrade my Go installation from 1.3.2 to 1.3.3 but still i get the same error. What could possibly wrong with my system?UPDATE:Here's my local code : I found that when i run this code, I get the error. But when I write a new fresh package and just write the exactly the same code as i did in the plaground. it works. I don't understand why this is happening. any advice guys? <code>  package mainimport ( ""log"" ""errors"" )func main() { j := &JustForTest{} a, err := j.Test(3) if err != nil { log.Println(err) } log.Println(a)}type JustForTest struct {}func (j *JustForTest) Test(i int) (string, error) { if i < 5 { return ""fail"", errors.New(""something wrong"") } return ""success"", nil} 2009/11/10 23:00:00 something wrong2009/11/10 23:00:00 fail ../warehouse/warehouse.go:32: cannot convert nil to type error../warehouse/warehouse.go:83: cannot use errors.New(""something wrong"") (type error) as type error in return argument../warehouse/warehouse.go:85: cannot use nil as type error in return argument package warehouseimport ( ""net/http"" ""path"" ""log"" ""errors"")func Route(w http.ResponseWriter, r *http.Request) { uri := path.Dir(r.URL.Path) base := path.Base(r.URL.Path) if uri == ""/"" || (uri == ""/products"" && base != ""products"") { uri = path.Join(uri, base) } // initiate all types warehouse := Warehouse{} inventory := Inventory{} // check the request method if r.Method == ""GET"" { switch uri { case ""/warehouse"": j := &JustForTest{} // This is the troubled code a, err := j.Test(3) if err != nil { log.Println(err) } log.Println(a) ... }} type JustForTest struct {}func (j *JustForTest) Test(i int) (string, error) { if i < 5 { return ""fail"", errors.New(""something wrong"") } return ""success"", nil}","Cannot use errors.New(""something wrong"") (type error) as type error in return argument"
"Cannot use errors.New(""something wrong"") (type error) as type error in return argument"," i have the following code (http://play.golang.org/p/47rvtGqGFn). it works on playground but fail on my system in playground it return something i expected : But when I run ""go install"" on my system, I get compiler error : I feel this is really weird. I have upgrade my Go installation from 1.3.2 to 1.3.3 but still i get the same error. What could possibly wrong with my system?UPDATE:Here's my local code : I found that when i run this code, I get the error. But when I write a new fresh package and just write the exactly the same code as i did in the plaground. it works. I don't understand why this is happening. any advice guys? <code>  package mainimport ( ""log"" ""errors"" )func main() { j := &JustForTest{} a, err := j.Test(3) if err != nil { log.Println(err) } log.Println(a)}type JustForTest struct {}func (j *JustForTest) Test(i int) (string, error) { if i < 5 { return ""fail"", errors.New(""something wrong"") } return ""success"", nil} 2009/11/10 23:00:00 something wrong2009/11/10 23:00:00 fail ../warehouse/warehouse.go:32: cannot convert nil to type error../warehouse/warehouse.go:83: cannot use errors.New(""something wrong"") (type error) as type error in return argument../warehouse/warehouse.go:85: cannot use nil as type error in return argument package warehouseimport ( ""net/http"" ""path"" ""log"" ""errors"")func Route(w http.ResponseWriter, r *http.Request) { uri := path.Dir(r.URL.Path) base := path.Base(r.URL.Path) if uri == ""/"" || (uri == ""/products"" && base != ""products"") { uri = path.Join(uri, base) } // initiate all types warehouse := Warehouse{} inventory := Inventory{} // check the request method if r.Method == ""GET"" { switch uri { case ""/warehouse"": j := &JustForTest{} // This is the troubled code a, err := j.Test(3) if err != nil { log.Println(err) } log.Println(a) ... }} type JustForTest struct {}func (j *JustForTest) Test(i int) (string, error) { if i < 5 { return ""fail"", errors.New(""something wrong"") } return ""success"", nil}","Cannot use errors.New(""something wrong"") (type error) as type error in return argument"
Go: convert uint64 to int64 without loss of information," The problem with the following code: is that y is -1. Without loss of information, is the only way to convert between these two number types to use an encoder and decoder? Note, I am not attempting a straight numeric conversion in your typical case. I am more concerned with maintaining the statistical properties of a random number generator. <code>  var x uint64 = 18446744073709551615var y int64 = int64(x) buff bytes.BufferEncoder(buff).encode(x)Decoder(buff).decode(y)",Convert uint64 to int64 without loss of information
How to get memory size of variable? Go(lang)," Does anybody know how to get memory size of the variable (int, string, []struct, etc) and print it? Is it possible? <code>  var i int = 1//I want to get something like this:fmt.Println(""Size of i is: %?"", i)//Also, it would be nice if I could store the value into a string",How to get memory size of variable?
golang map[interface {}]interface {}," From a source I cannot influence I am given data in a map, which arrives as map[interface {}]interface {}.I need to process the contained data, preferably as map[string]string (the data within is perfectly suitable for that).I need to generate a list of the keys from the data as well, as those are not known beforehand.Most similar questions I could find on the web say more or less, that this is impossible, but if my map is m, fmt.Println(m) shows the data is there, readable as map[k0:v0 K1:v1 k2:v2 ... ].How can I do what fmt.Println is able to do? <code> ",Convert map[interface {}]interface {} to map[string]string
URL Builder/Query builder in GoLang," I am interested in dynamically taking arguments from the user as input through a browser or a CLI to pass in those parameters to the REST API call and hence construct the URL dynamically using Go which is going to ultimately fetch me some JSON data. I want to know some techniques in Go which could help me do that. One ideal way I thought was to use a map and populate it with arguments keys and corresponding values and iterate over it and append it to the URL string. But when it comes to dynamically taking the arguments and populating the map, I am not very sure how to do that in Go. Can someone help me out with some code snippet in Go?Request example: <code>  http://<IP>:port?api=fetchJsonData&arg1=val1&arg2=val2&arg3=val3.....&argn=valn",URL Builder/Query builder in Go
GoLang templates: Range example," The Go documentation on the text/template package is so abstract that I'm having trouble figuring out how to actually range over a slice of objects. Here's my attempt so far (This outputs nothing for me): <code>  package mainimport ( ""os"" templ ""text/template"")type Context struct { people []Person}type Person struct { Name string //exported field since it begins with a capital letter Senior bool}func main() { // Range example tRange := templ.New(""Range Example"") ctx2 := Context{people: []Person{Person{Name: ""Mary"", Senior: false}, Person{Name: ""Joseph"", Senior: true}}} tRange = templ.Must( tRange.Parse(`{{range $i, $x := $.people}} Name={{$x.Name}} Senior={{$x.Senior}} {{end}}`)) tRange.Execute(os.Stdout, ctx2)}",Concrete range example
Go templates: Range example," The Go documentation on the text/template package is so abstract that I'm having trouble figuring out how to actually range over a slice of objects. Here's my attempt so far (This outputs nothing for me): <code>  package mainimport ( ""os"" templ ""text/template"")type Context struct { people []Person}type Person struct { Name string //exported field since it begins with a capital letter Senior bool}func main() { // Range example tRange := templ.New(""Range Example"") ctx2 := Context{people: []Person{Person{Name: ""Mary"", Senior: false}, Person{Name: ""Joseph"", Senior: true}}} tRange = templ.Must( tRange.Parse(`{{range $i, $x := $.people}} Name={{$x.Name}} Senior={{$x.Senior}} {{end}}`)) tRange.Execute(os.Stdout, ctx2)}",Concrete range example
golang refrence struct in same package in another file," How to reference MyStruct in another file in the same package or folder?Currently I get undefined: MyStruct when go build lib/file_2.go. I can run go install with no error, should I just ignore the build error?These are my files:lib/file_1.go lib/file_2.go Thanks <code>  ...package lib...type MyStruct struct{}.... ...package lib...{m MyStruct}....",golang reference struct in same package in another file
why can not convert [Size]byte to string in Go?," I have a sized byte array that I got after doing md5.Sum(). The error: I find the solution at this problemChange to: But why can not use it like this? <code>  data := []byte(""testing"")var pass string var b [16]byteb = md5.Sum(data)pass = string(b) cannot convert b (type [16]byte) to type string pass = string(b[:]) pass = string(b)",Why can not convert [Size]byte to string in Go?
Golang multiple files in main package," I have a single file in the main package called main.go. Because the code isn't reusable I want to separate part of the code in a different file but in the same package.How do I split the contents of main.go into multiple files without creating a separate package?I want a directory structure like this: File: bar.go File: main.go When I run go run main.go, it gives me: <code>  ls foo# output:main.gobar.go package mainimport ""fmt""func Bar() { fmt.Println(""Bar"")} package mainfunc main() { Bar()} # command-line-arguments./main.go:4:2: undefined: Bar","How can I ""go run"" a project with multiple files in the main package?"
Golang: How do go's len() and make() functions work?," How do go's len() and make() functions work? Since the language lacks support for both generics and function overloading I don't see how func len(v Type) int is possible. The same goes for func make(Type, size IntegerType) Type.I can't seem to find the function in the go source, the closest I've managed to find is this <code> ",How do go's len() and make() functions work?
How do o's len() and make() functions work?," How do go's len() and make() functions work? Since the language lacks support for both generics and function overloading I don't see how func len(v Type) int is possible. The same goes for func make(Type, size IntegerType) Type.I can't seem to find the function in the go source, the closest I've managed to find is this <code> ",How do go's len() and make() functions work?
How to unmarshal json into interface{} in golang?," I'm a newbie in Go and now I have a problem. I have a type called Message, it is a struct like this: I also have a type called CreateMessage like this: And I have a JSON string like {""cmd"":""create"",""data"":{""conf"":{""a"":1},""info"":{""b"":2}}}. When I use json.Unmarshal to decode that into a Message variable, the answer is {Cmd:create Data:map[conf:map[a:1] info:map[b:2]]}.So could I decode the JSON into a Message struct and change its Data's interface{} to type CreateMessage according to the Cmd?I tried to convert Data directly into type CreateMessage but the complier told me that Data is a map[sting]interface{} type. <code>  type Message struct { Cmd string `json:""cmd""` Data interface{} `json:""data""`} type CreateMessage struct { Conf map[string]int `json:""conf""` Info map[string]int `json:""info""`}",How to unmarshal JSON into interface{} in Go?
With golang webserver where does the root of the website map onto the filesystem>," Where is the filesystem ""root"" of a Go net/http webserver. It doesn't seem to be in the directory the executable is in.By ""root"" I mean the directory I would use for, say, the src attribute of an img, without any path. I don't plan to do this, but it would help me understand the structure if I knew. <code> ",With Go's webserver where does the root of the website map onto the filesystem?
With golang webserver where does the root of the website map onto the filesystem?," Where is the filesystem ""root"" of a Go net/http webserver. It doesn't seem to be in the directory the executable is in.By ""root"" I mean the directory I would use for, say, the src attribute of an img, without any path. I don't plan to do this, but it would help me understand the structure if I knew. <code> ",With Go's webserver where does the root of the website map onto the filesystem?
What's the golang equivilant of converting any JSON to standard dict in Python?," In Python you can do something like this: And now data is a dict or hash table (also, I did not need to define beforehand the structure of the dict), and I can access values of keys by doing data[""entities""], data[""entities""][""Q12""], etc.How would I do this in golang? So far I have this: Which gives me the compile error: invalid operation: data[""entities""] (index of type interface {})So what type should var data be? And do I need to define a structure to the JSON beforehand or is it possible to handle any JSON file/stream without modifying the code? <code>  r = requests.get(""http://wikidata.org/w/api.php"", params=params)data = r.json() resp, err := http.Get(""http://wikidata.org/w/api.php?""+v.Encode())if err != nil { // handle error}defer resp.Body.Close()decoder := json.NewDecoder(resp.Body)var data interface{}decodeErr := decoder.Decode(&data)if decodeErr != nil { // handle error}fmt.Println(data[""entities""], data[""entities""][""Q""+id])",What's the golang equivalent of converting any JSON to standard dict in Python?
Whats wrong with this golang code?," While SayHello() executes as expected, the goroutine prints nothing.  <code>  package mainimport ""fmt""func SayHello() { for i := 0; i < 10 ; i++ { fmt.Print(i, "" "") }}func main() { SayHello() go SayHello()}",No output from goroutine
What's wrong with this golang code?," While SayHello() executes as expected, the goroutine prints nothing.  <code>  package mainimport ""fmt""func SayHello() { for i := 0; i < 10 ; i++ { fmt.Print(i, "" "") }}func main() { SayHello() go SayHello()}",No output from goroutine
No output when use threads in Golang," While SayHello() executes as expected, the goroutine prints nothing.  <code>  package mainimport ""fmt""func SayHello() { for i := 0; i < 10 ; i++ { fmt.Print(i, "" "") }}func main() { SayHello() go SayHello()}",No output from goroutine
No output from goroutine in Go," While SayHello() executes as expected, the goroutine prints nothing.  <code>  package mainimport ""fmt""func SayHello() { for i := 0; i < 10 ; i++ { fmt.Print(i, "" "") }}func main() { SayHello() go SayHello()}",No output from goroutine
mgo convert bson.objectId to string in html template," I know this problem maybe duplicate to this one. But it hasn't get a satisfied answer till now. And I really want to draw some attention to get a solution as soon as possible. So I beg you not to close this issue unless you have the solution and answered it in the previous one :-)I will describe the issue for convince:I have a data structure that was stored in mongodb, as known, the _id of mongodb is a bson.ObjectId type, I could retrieve that with sort of like this: Then I got a slice of Data by finding with specific query condition, and use that slice in http/template to render for front-end view. In order to manipulate every item in the slice, I want to use the Id field, but When using that with: That Only gives a sort of string like ObjectIdHex(""550146d1b51bc1c208d1924d"") instead of 550146d1b51bc1c208d1924d which is nice and easy to use. In the duplicate issue. The op have said that He found a way to resolve this by ""adding a Id_String"" to the original data structure. But I really don't know how to do this? Is that mean assign it after retrieval ? Since I use a slice to store the data retrieved, And data in a slice couldn't be changed easily. It will be more complex to do that than do the job in the front-end using jquery. But doing that just depress me with my beloved Go :-(. So is There a better way to do that?  <code>  type Data struct { Id bson.ObjectId `bson:""_id,omitempty""` Content string `bson:""content""`} {{range $key, $value := .DataSlice}} <td>{{$value.Id}}</td>{{end}}",mgo convert bson.objectId to string(hex) in html template
"hiding nil values, understanding why golang fails here"," I fail to understand how to correctly assure that something is not nil in this case: The only way I found to check if that value is actually nil is by using reflection.Is this really wanted behaviour? Or do I fail to see some major mistake in my code?Play link here <code>  package maintype shower interface { getWater() []shower}type display struct { SubDisplay *display}func (d display) getWater() []shower { return []shower{display{}, d.SubDisplay}}func main() { // SubDisplay will be initialized with null s := display{} // water := []shower{nil} water := s.getWater() for _, x := range water { if x == nil { panic(""everything ok, nil found"") } // First iteration display{} is not nil and will // therefore work, on the second iteration // x is nil, and getWater panics. x.getWater() }}","Hiding nil values, understanding why Go fails here"
"Hiding nil values, understanding why golang fails here"," I fail to understand how to correctly assure that something is not nil in this case: The only way I found to check if that value is actually nil is by using reflection.Is this really wanted behaviour? Or do I fail to see some major mistake in my code?Play link here <code>  package maintype shower interface { getWater() []shower}type display struct { SubDisplay *display}func (d display) getWater() []shower { return []shower{display{}, d.SubDisplay}}func main() { // SubDisplay will be initialized with null s := display{} // water := []shower{nil} water := s.getWater() for _, x := range water { if x == nil { panic(""everything ok, nil found"") } // First iteration display{} is not nil and will // therefore work, on the second iteration // x is nil, and getWater panics. x.getWater() }}","Hiding nil values, understanding why Go fails here"
Go: How can I print to an actual printer," I have a messaging server written in Go. Now I have a requirement that some messages need to be printed out on paper by the server.How can I implement this in Go? I'm having a real hard time finding anything on the subject.The app will be running on Windows machines and needs to be able to print UTF8 encoded text in a fixed width font. So no fancy formatting (bold text, color etc) is needed.I'm rather completely in the dark on how to go about this... Can someone shed some light on this for me and point me in the right direction? <code> ",How can I print to an actual printer?
accessing the underlying socket of a net/http response," I'm new to Go and evaluating it for a project.I'm trying to write a custom handler to serve files with net/http.I can't use the default http.FileServer() handler because I need to have access to the underlying socket (the internal net.Conn) so I can perform some informational platform specific ""syscall"" calls on it (mainly TCP_INFO).More precisly: I need to access the underlying socket of the http.ResponseWriter in the handler function: used in Is there a way to this. I looked at how websocket.Upgrade does this but it uses Hijack() which is 'too much' because then I have to code 'speaking http' over the raw tcp socket I get. I just want a reference to the socket and not taking over completely. <code>  func myHandler(w http.ResponseWriter, r *http.Request) {...// I need the net.Conn of w...} http.HandleFunc(""/"", myHandler)",Accessing the underlying socket of a net/http response
Big performance difference between 2D slices and linear array in Go," I was doing some performance experimentation in Go with matrix multiplication and ran into some unexpected results.Version 1: From the linear array i create multiple slices that represent the matrix rows.Version 2: In this version I simply use a linear array and index into it from the multiplication.Multiplying 2 2048x2048 matrices give the following execution time: Version 2 is almost twice as fast.I used the approach below to take the measurements: I am aware using slices give another layer of indirection which could impact the cache performance, however I didn't expect it would be such a big difference. Unfortunately I haven't found any good tool, that works with Mac, that can analyse cache efficiency in Go, so I can't say for sure if this is what's causing the performance difference.So I guess I'm asking is this expected behavior or is there something I'm missing?Software and hardware:Go version 1.4.2 darwin/amd64; OS X 10.10.3; 2 GHz quad-core i7. <code>  func newMatrix(n int) [][]int { m := make([][]int, n) buf := make([]int, n*n) for i := range m { m[i] = buf[i*n : (i+1)*n] } return m}func mult1(m1, m2, res [][]int) [][]int { for i := range m1 { for k := range m1[0] { for j := range m2[0] { res[i][j] += m1[i][k] * m2[k][j] } } } return res} func mult2(m1, m2, res []int, n int) []int { for i := 0; i < n; i++ { for k := 0; k < n; k++ { for j := 0; j < n; j++ { res[i*n+j] += m1[i*n+k] * m2[k*n+j] } } } return res} version 1: 35.550813801s version 2: 19.090223468s start := time.Now()mult(m1, m2, m3)stop := time.Now()",Go: Unexpected performance when accessing an array through slice of slices (2D slice)
Performance difference between 2D slices and linear array in Go," I was doing some performance experimentation in Go with matrix multiplication and ran into some unexpected results.Version 1: From the linear array i create multiple slices that represent the matrix rows.Version 2: In this version I simply use a linear array and index into it from the multiplication.Multiplying 2 2048x2048 matrices give the following execution time: Version 2 is almost twice as fast.I used the approach below to take the measurements: I am aware using slices give another layer of indirection which could impact the cache performance, however I didn't expect it would be such a big difference. Unfortunately I haven't found any good tool, that works with Mac, that can analyse cache efficiency in Go, so I can't say for sure if this is what's causing the performance difference.So I guess I'm asking is this expected behavior or is there something I'm missing?Software and hardware:Go version 1.4.2 darwin/amd64; OS X 10.10.3; 2 GHz quad-core i7. <code>  func newMatrix(n int) [][]int { m := make([][]int, n) buf := make([]int, n*n) for i := range m { m[i] = buf[i*n : (i+1)*n] } return m}func mult1(m1, m2, res [][]int) [][]int { for i := range m1 { for k := range m1[0] { for j := range m2[0] { res[i][j] += m1[i][k] * m2[k][j] } } } return res} func mult2(m1, m2, res []int, n int) []int { for i := 0; i < n; i++ { for k := 0; k < n; k++ { for j := 0; j < n; j++ { res[i*n+j] += m1[i*n+k] * m2[k*n+j] } } } return res} version 1: 35.550813801s version 2: 19.090223468s start := time.Now()mult(m1, m2, m3)stop := time.Now()",Go: Unexpected performance when accessing an array through slice of slices (2D slice)
Performance difference between 2D slices and linear array in Go," I was doing some performance experimentation in Go with matrix multiplication and ran into some unexpected results.Version 1: From the linear array i create multiple slices that represent the matrix rows.Version 2: In this version I simply use a linear array and index into it from the multiplication.Multiplying 2 2048x2048 matrices give the following execution time: Version 2 is almost twice as fast.I used the approach below to take the measurements: I am aware using slices give another layer of indirection which could impact the cache performance, however I didn't expect it would be such a big difference. Unfortunately I haven't found any good tool, that works with Mac, that can analyse cache efficiency in Go, so I can't say for sure if this is what's causing the performance difference.So I guess I'm asking is this expected behavior or is there something I'm missing?Software and hardware:Go version 1.4.2 darwin/amd64; OS X 10.10.3; 2 GHz quad-core i7. <code>  func newMatrix(n int) [][]int { m := make([][]int, n) buf := make([]int, n*n) for i := range m { m[i] = buf[i*n : (i+1)*n] } return m}func mult1(m1, m2, res [][]int) [][]int { for i := range m1 { for k := range m1[0] { for j := range m2[0] { res[i][j] += m1[i][k] * m2[k][j] } } } return res} func mult2(m1, m2, res []int, n int) []int { for i := 0; i < n; i++ { for k := 0; k < n; k++ { for j := 0; j < n; j++ { res[i*n+j] += m1[i*n+k] * m2[k*n+j] } } } return res} version 1: 35.550813801s version 2: 19.090223468s start := time.Now()mult(m1, m2, m3)stop := time.Now()",Go: Unexpected performance when accessing an array through slice of slices (2D slice)
Performance of multiplying matrices stored as 1D and 2D arrays in Go," I was doing some performance experimentation in Go with matrix multiplication and ran into some unexpected results.Version 1: From the linear array i create multiple slices that represent the matrix rows.Version 2: In this version I simply use a linear array and index into it from the multiplication.Multiplying 2 2048x2048 matrices give the following execution time: Version 2 is almost twice as fast.I used the approach below to take the measurements: I am aware using slices give another layer of indirection which could impact the cache performance, however I didn't expect it would be such a big difference. Unfortunately I haven't found any good tool, that works with Mac, that can analyse cache efficiency in Go, so I can't say for sure if this is what's causing the performance difference.So I guess I'm asking is this expected behavior or is there something I'm missing?Software and hardware:Go version 1.4.2 darwin/amd64; OS X 10.10.3; 2 GHz quad-core i7. <code>  func newMatrix(n int) [][]int { m := make([][]int, n) buf := make([]int, n*n) for i := range m { m[i] = buf[i*n : (i+1)*n] } return m}func mult1(m1, m2, res [][]int) [][]int { for i := range m1 { for k := range m1[0] { for j := range m2[0] { res[i][j] += m1[i][k] * m2[k][j] } } } return res} func mult2(m1, m2, res []int, n int) []int { for i := 0; i < n; i++ { for k := 0; k < n; k++ { for j := 0; j < n; j++ { res[i*n+j] += m1[i*n+k] * m2[k*n+j] } } } return res} version 1: 35.550813801s version 2: 19.090223468s start := time.Now()mult(m1, m2, m3)stop := time.Now()",Go: Unexpected performance when accessing an array through slice of slices (2D slice)
Performance difference when multiplying matrices stored as 1D and 2D arrays in Go," I was doing some performance experimentation in Go with matrix multiplication and ran into some unexpected results.Version 1: From the linear array i create multiple slices that represent the matrix rows.Version 2: In this version I simply use a linear array and index into it from the multiplication.Multiplying 2 2048x2048 matrices give the following execution time: Version 2 is almost twice as fast.I used the approach below to take the measurements: I am aware using slices give another layer of indirection which could impact the cache performance, however I didn't expect it would be such a big difference. Unfortunately I haven't found any good tool, that works with Mac, that can analyse cache efficiency in Go, so I can't say for sure if this is what's causing the performance difference.So I guess I'm asking is this expected behavior or is there something I'm missing?Software and hardware:Go version 1.4.2 darwin/amd64; OS X 10.10.3; 2 GHz quad-core i7. <code>  func newMatrix(n int) [][]int { m := make([][]int, n) buf := make([]int, n*n) for i := range m { m[i] = buf[i*n : (i+1)*n] } return m}func mult1(m1, m2, res [][]int) [][]int { for i := range m1 { for k := range m1[0] { for j := range m2[0] { res[i][j] += m1[i][k] * m2[k][j] } } } return res} func mult2(m1, m2, res []int, n int) []int { for i := 0; i < n; i++ { for k := 0; k < n; k++ { for j := 0; j < n; j++ { res[i*n+j] += m1[i*n+k] * m2[k*n+j] } } } return res} version 1: 35.550813801s version 2: 19.090223468s start := time.Now()mult(m1, m2, m3)stop := time.Now()",Go: Unexpected performance when accessing an array through slice of slices (2D slice)
Performance difference when multiplying matrices using 2D and 1D slices in Go," I was doing some performance experimentation in Go with matrix multiplication and ran into some unexpected results.Version 1: From the linear array i create multiple slices that represent the matrix rows.Version 2: In this version I simply use a linear array and index into it from the multiplication.Multiplying 2 2048x2048 matrices give the following execution time: Version 2 is almost twice as fast.I used the approach below to take the measurements: I am aware using slices give another layer of indirection which could impact the cache performance, however I didn't expect it would be such a big difference. Unfortunately I haven't found any good tool, that works with Mac, that can analyse cache efficiency in Go, so I can't say for sure if this is what's causing the performance difference.So I guess I'm asking is this expected behavior or is there something I'm missing?Software and hardware:Go version 1.4.2 darwin/amd64; OS X 10.10.3; 2 GHz quad-core i7. <code>  func newMatrix(n int) [][]int { m := make([][]int, n) buf := make([]int, n*n) for i := range m { m[i] = buf[i*n : (i+1)*n] } return m}func mult1(m1, m2, res [][]int) [][]int { for i := range m1 { for k := range m1[0] { for j := range m2[0] { res[i][j] += m1[i][k] * m2[k][j] } } } return res} func mult2(m1, m2, res []int, n int) []int { for i := 0; i < n; i++ { for k := 0; k < n; k++ { for j := 0; j < n; j++ { res[i*n+j] += m1[i*n+k] * m2[k*n+j] } } } return res} version 1: 35.550813801s version 2: 19.090223468s start := time.Now()mult(m1, m2, m3)stop := time.Now()",Go: Unexpected performance when accessing an array through slice of slices (2D slice)
Performance difference when accessing a linear array through 2D slice and 1D slice in Go," I was doing some performance experimentation in Go with matrix multiplication and ran into some unexpected results.Version 1: From the linear array i create multiple slices that represent the matrix rows.Version 2: In this version I simply use a linear array and index into it from the multiplication.Multiplying 2 2048x2048 matrices give the following execution time: Version 2 is almost twice as fast.I used the approach below to take the measurements: I am aware using slices give another layer of indirection which could impact the cache performance, however I didn't expect it would be such a big difference. Unfortunately I haven't found any good tool, that works with Mac, that can analyse cache efficiency in Go, so I can't say for sure if this is what's causing the performance difference.So I guess I'm asking is this expected behavior or is there something I'm missing?Software and hardware:Go version 1.4.2 darwin/amd64; OS X 10.10.3; 2 GHz quad-core i7. <code>  func newMatrix(n int) [][]int { m := make([][]int, n) buf := make([]int, n*n) for i := range m { m[i] = buf[i*n : (i+1)*n] } return m}func mult1(m1, m2, res [][]int) [][]int { for i := range m1 { for k := range m1[0] { for j := range m2[0] { res[i][j] += m1[i][k] * m2[k][j] } } } return res} func mult2(m1, m2, res []int, n int) []int { for i := 0; i < n; i++ { for k := 0; k < n; k++ { for j := 0; j < n; j++ { res[i*n+j] += m1[i*n+k] * m2[k*n+j] } } } return res} version 1: 35.550813801s version 2: 19.090223468s start := time.Now()mult(m1, m2, m3)stop := time.Now()",Go: Unexpected performance when accessing an array through slice of slices (2D slice)
Go Performance: Accessing a linear array through 2D slice and regular slice when multiplying matrices," I was doing some performance experimentation in Go with matrix multiplication and ran into some unexpected results.Version 1: From the linear array i create multiple slices that represent the matrix rows.Version 2: In this version I simply use a linear array and index into it from the multiplication.Multiplying 2 2048x2048 matrices give the following execution time: Version 2 is almost twice as fast.I used the approach below to take the measurements: I am aware using slices give another layer of indirection which could impact the cache performance, however I didn't expect it would be such a big difference. Unfortunately I haven't found any good tool, that works with Mac, that can analyse cache efficiency in Go, so I can't say for sure if this is what's causing the performance difference.So I guess I'm asking is this expected behavior or is there something I'm missing?Software and hardware:Go version 1.4.2 darwin/amd64; OS X 10.10.3; 2 GHz quad-core i7. <code>  func newMatrix(n int) [][]int { m := make([][]int, n) buf := make([]int, n*n) for i := range m { m[i] = buf[i*n : (i+1)*n] } return m}func mult1(m1, m2, res [][]int) [][]int { for i := range m1 { for k := range m1[0] { for j := range m2[0] { res[i][j] += m1[i][k] * m2[k][j] } } } return res} func mult2(m1, m2, res []int, n int) []int { for i := 0; i < n; i++ { for k := 0; k < n; k++ { for j := 0; j < n; j++ { res[i*n+j] += m1[i*n+k] * m2[k*n+j] } } } return res} version 1: 35.550813801s version 2: 19.090223468s start := time.Now()mult(m1, m2, m3)stop := time.Now()",Go: Unexpected performance when accessing an array through slice of slices (2D slice)
Go: Performance difference when accessing a linear array through slice of slices and regular slice," I was doing some performance experimentation in Go with matrix multiplication and ran into some unexpected results.Version 1: From the linear array i create multiple slices that represent the matrix rows.Version 2: In this version I simply use a linear array and index into it from the multiplication.Multiplying 2 2048x2048 matrices give the following execution time: Version 2 is almost twice as fast.I used the approach below to take the measurements: I am aware using slices give another layer of indirection which could impact the cache performance, however I didn't expect it would be such a big difference. Unfortunately I haven't found any good tool, that works with Mac, that can analyse cache efficiency in Go, so I can't say for sure if this is what's causing the performance difference.So I guess I'm asking is this expected behavior or is there something I'm missing?Software and hardware:Go version 1.4.2 darwin/amd64; OS X 10.10.3; 2 GHz quad-core i7. <code>  func newMatrix(n int) [][]int { m := make([][]int, n) buf := make([]int, n*n) for i := range m { m[i] = buf[i*n : (i+1)*n] } return m}func mult1(m1, m2, res [][]int) [][]int { for i := range m1 { for k := range m1[0] { for j := range m2[0] { res[i][j] += m1[i][k] * m2[k][j] } } } return res} func mult2(m1, m2, res []int, n int) []int { for i := 0; i < n; i++ { for k := 0; k < n; k++ { for j := 0; j < n; j++ { res[i*n+j] += m1[i*n+k] * m2[k*n+j] } } } return res} version 1: 35.550813801s version 2: 19.090223468s start := time.Now()mult(m1, m2, m3)stop := time.Now()",Go: Unexpected performance when accessing an array through slice of slices (2D slice)
Go: Performance difference when accessing an array through slice of slices and a regular slice," I was doing some performance experimentation in Go with matrix multiplication and ran into some unexpected results.Version 1: From the linear array i create multiple slices that represent the matrix rows.Version 2: In this version I simply use a linear array and index into it from the multiplication.Multiplying 2 2048x2048 matrices give the following execution time: Version 2 is almost twice as fast.I used the approach below to take the measurements: I am aware using slices give another layer of indirection which could impact the cache performance, however I didn't expect it would be such a big difference. Unfortunately I haven't found any good tool, that works with Mac, that can analyse cache efficiency in Go, so I can't say for sure if this is what's causing the performance difference.So I guess I'm asking is this expected behavior or is there something I'm missing?Software and hardware:Go version 1.4.2 darwin/amd64; OS X 10.10.3; 2 GHz quad-core i7. <code>  func newMatrix(n int) [][]int { m := make([][]int, n) buf := make([]int, n*n) for i := range m { m[i] = buf[i*n : (i+1)*n] } return m}func mult1(m1, m2, res [][]int) [][]int { for i := range m1 { for k := range m1[0] { for j := range m2[0] { res[i][j] += m1[i][k] * m2[k][j] } } } return res} func mult2(m1, m2, res []int, n int) []int { for i := 0; i < n; i++ { for k := 0; k < n; k++ { for j := 0; j < n; j++ { res[i*n+j] += m1[i*n+k] * m2[k*n+j] } } } return res} version 1: 35.550813801s version 2: 19.090223468s start := time.Now()mult(m1, m2, m3)stop := time.Now()",Go: Unexpected performance when accessing an array through slice of slices (2D slice)
Go: Unexpected performance difference when accessing an array through slice of slices (2D) and 1D slice," I was doing some performance experimentation in Go with matrix multiplication and ran into some unexpected results.Version 1: From the linear array i create multiple slices that represent the matrix rows.Version 2: In this version I simply use a linear array and index into it from the multiplication.Multiplying 2 2048x2048 matrices give the following execution time: Version 2 is almost twice as fast.I used the approach below to take the measurements: I am aware using slices give another layer of indirection which could impact the cache performance, however I didn't expect it would be such a big difference. Unfortunately I haven't found any good tool, that works with Mac, that can analyse cache efficiency in Go, so I can't say for sure if this is what's causing the performance difference.So I guess I'm asking is this expected behavior or is there something I'm missing?Software and hardware:Go version 1.4.2 darwin/amd64; OS X 10.10.3; 2 GHz quad-core i7. <code>  func newMatrix(n int) [][]int { m := make([][]int, n) buf := make([]int, n*n) for i := range m { m[i] = buf[i*n : (i+1)*n] } return m}func mult1(m1, m2, res [][]int) [][]int { for i := range m1 { for k := range m1[0] { for j := range m2[0] { res[i][j] += m1[i][k] * m2[k][j] } } } return res} func mult2(m1, m2, res []int, n int) []int { for i := 0; i < n; i++ { for k := 0; k < n; k++ { for j := 0; j < n; j++ { res[i*n+j] += m1[i*n+k] * m2[k*n+j] } } } return res} version 1: 35.550813801s version 2: 19.090223468s start := time.Now()mult(m1, m2, m3)stop := time.Now()",Go: Unexpected performance when accessing an array through slice of slices (2D slice)
Convert nil interface to pointer of something in go-lang?," In the following code piece, trying to convert a nil interface to a pointer of something fails with the following error: interface conversion: interface is nil, not *main.Node Play link here: https://play.golang.org/p/2cgyfUStCIWhy does this fail exactly? It's entirely possible to do , so I'm wondering how can you achieve a similar effect starting from a nil interface. <code>  type Nexter interface { Next() Nexter}type Node struct { next Nexter}func (n *Node) Next() Nexter {...}func main() { var p Nexter var n *Node fmt.Println(n == nil) // will print true n = p.(*Node) // will fail} n = (*Node)(nil)",Convert nil interface to pointer of something in Golang?
Golang: Get signal origin," I'm using Go to launch a couple of scripts and when they have some problems they use the ""alert"" signal, I know Go can capture those signals but I need to know the PID that originated the Signal. in C to the signal handler is passed a structure to know the pid who originated the signal but in Go looks like is not the case the example below (extracted from the signal doc) send me the signal who originated the call but not any useful info (like the pid) <code>  package mainimport ( ""fmt"" ""os"" ""os/signal"")func main() { c := make(chan os.Signal, 1) signal.Notify(c, os.Interrupt, os.Kill) s := <-c fmt.Println(""Got signal:"", s) fmt.Printf(""%+v\n"",s)}",Go: Get signal origin
How to implement an abstract class in Go?," How to implement an abstract class in Go? As Go doesn't allow us to have fields in interfaces, that would be a stateless object. So, in other words, is it possible to have some kind of default implementation for a method in Go?Consider an example: This won't compile as it's not possible to use interface as a receiver. In fact, I have already answered my question (see the answer below). However, is it an idiomatic way to implement such logic? Are there any reasons not to have a default implementation besides language's simplicity? <code>  type Daemon interface { start(time.Duration) doWork()}func (daemon *Daemon) start(duration time.Duration) { ticker := time.NewTicker(duration) // this will call daemon.doWork() periodically go func() { for { <- ticker.C daemon.doWork() } }()}type ConcreteDaemonA struct { foo int }type ConcreteDaemonB struct { bar int }func (daemon *ConcreteDaemonA) doWork() { daemon.foo++ fmt.Println(""A: "", daemon.foo)}func (daemon *ConcreteDaemonB) doWork() { daemon.bar-- fmt.Println(""B: "", daemon.bar)}func main() { dA := new(ConcreteDaemonA) dB := new(ConcreteDaemonB) start(dA, 1 * time.Second) start(dB, 5 * time.Second) time.Sleep(100 * time.Second)}",How to implement an abstract class in Go?
How to implement an abstract class?," How to implement an abstract class in Go? As Go doesn't allow us to have fields in interfaces, that would be a stateless object. So, in other words, is it possible to have some kind of default implementation for a method in Go?Consider an example: This won't compile as it's not possible to use interface as a receiver. In fact, I have already answered my question (see the answer below). However, is it an idiomatic way to implement such logic? Are there any reasons not to have a default implementation besides language's simplicity? <code>  type Daemon interface { start(time.Duration) doWork()}func (daemon *Daemon) start(duration time.Duration) { ticker := time.NewTicker(duration) // this will call daemon.doWork() periodically go func() { for { <- ticker.C daemon.doWork() } }()}type ConcreteDaemonA struct { foo int }type ConcreteDaemonB struct { bar int }func (daemon *ConcreteDaemonA) doWork() { daemon.foo++ fmt.Println(""A: "", daemon.foo)}func (daemon *ConcreteDaemonB) doWork() { daemon.bar-- fmt.Println(""B: "", daemon.bar)}func main() { dA := new(ConcreteDaemonA) dB := new(ConcreteDaemonB) start(dA, 1 * time.Second) start(dB, 5 * time.Second) time.Sleep(100 * time.Second)}",How to implement an abstract class in Go?
Golang: Confused about custom types in SQL when sql.DB.Exec," Having this table structure: I have this (not complete) code working fine: So my question is: Why do I need to use pointer reference (&eqi.Status) on db.Exec?Both sql.NullString and my custom StatusEnum are not implemented in github.com/go-sql-driver/mysql, so why the difference?If I don't use the pointer reference (eqi.Status), I'm getting this error (throwing in database/sql/convert.go): I was trying to implement some other interfaces I've found with no luck.I have other custom types implemented with sql.Scanner and sql.driver.Valuer interfaces, but the problem is the same.I was guessing about struct and type inheritance differentiation, but I couldn't get any hint on that... :(Please help to understand what's going on. Thanks!!! :) <code>  CREATE TABLE `tableName` ( `Id` int unsigned NOT NULL AUTO_INCREMENT PRIMARY KEY, `Status` enum('pending','rejected','sent','invalid') NOT NULL, `Body` varchar(255) NULL) ENGINE='MyISAM' COLLATE 'utf8_general_ci'; type StatusEnum stringconst ( STATUS_PENDING StatusEnum = ""pending"" STATUS_REJECTED StatusEnum = ""rejected"" STATUS_SENT StatusEnum = ""sent"" STATUS_INVALID StatusEnum = ""invalid"")func (s *StatusEnum) Scan(src interface{}) error { if src == nil { return errors.New(""This field cannot be NULL"") } if stringStatus, ok := src.([]byte); ok { *s = StatusEnum(string(stringStatus[:])) return nil } return errors.New(""Cannot convert enum to string"")}func (s *StatusEnum) Value() (driver.Value, error) { return []byte(*s), nil}type EmailQueue struct { Id uint64 Status StatusEnum Body sql.NullString}func Save (db *sql.DB) error { _, err = db.Exec( ""UPDATE `tableName` SET `Status` = ?, `Body` = ? WHERE `id` = ?"", &eqi.Status, eqi.Body, eqi.Id, ) return err} sql: converting Exec argument #0's type: unsupported type emailqueue.StatusEnum, a string",Confused about custom types in SQL when sql.DB.Exec
Go-lang: How to convert slice to fixed size array?, I want to convert a fixed size array from a slice: But this results in: How to convert a slice into a fixed size array? <code>  func gen(bricks []Brick) { if len(bricks) == 16 { if check(Sculpture{bricks}) { var b [16]Brick = bricks[0:16]; } }} cannot use bricks[0:16] (type []Brick) as type [16]Brick in assignment,How to convert slice to fixed size array?
go program throwing error while executing," I am new to Go programming language. Below is my code. when I executed the code i got below error I tried to add websocket package in GOPATH by go get command but that is also throwing below error Could you please help me in resolving this error. <code>  package mainimport ( ""code.google.com/p/go.net/websocket"" ""fmt"" ""net/http"" ""strconv"")var add := ""12345""func EchoLengthServer(ws *webscoket.Conn) { var msg string for { websocket.Message.Receive(ws, &msg) fmt.Println(""Got Message"", msg) length := len(msg) if err := websocket.Message.Send(ws, strconv.FormatInt(int64(length), 10)); err != nil { fmt.Println(""can't send message length"") break } }}func websocketListen() { http.Handle(""/length"", websocket.Handler(EchoLengthServer)) err := http.ListenAndServe(addr, nil) if err != nil { panic(""ListenAndServe:"" + err.Error()) }} [rajkumar@localhost ch4-DesigningAPI]$ go run WebSockets.go WebSockets.go:6:3: cannot find package ""code.google.com/p/go.net/websocket"" in any of: /usr/local/go/src/code.google.com/p/go.net/websocket (from $GOROOT) /home/rajkumar/GOPackages/src/code.google.com/p/go.net/websocket (from $GOPATH) [rajkumar@localhost ch4-DesigningAPI]$ go get code.google.com/p/go.net/websocketgo: missing Mercurial command. See http://golang.org/s/gogetcmdpackage code.google.com/p/go.net/websocket: exec: ""hg"": executable file not found in $PATH","go program throwing error cannot find package ""code.google.com/p/go.net/websocket"""
Handling Custom BSON Marshaling (Golang & mgo)," I have a number of structs that require custom marshalling. When I was testing I was using JSON and the standard JSON marshaller. As it doesn't marshal unexported fields, I needed to write a custom MarshalJSON function, which worked perfectly. When I called json.Marshal on the parent struct containing the ones that needed custom marshalling as fields, it worked fine.Now I need to marshal everything to BSON for some MongoDB work, and I can't find any documentation about how to write custom BSON marshalling. Can anyone tell me how to do the equivalent for BSON/mgo for what I've demonstrated below?currency.go (the important parts) product.go (again, just the relevant parts) When I call json.Marshal(p) where p is a Product, it produces the output I want without the need for the pattern (not sure of the name) where you create a struct which is just a clone with all exported fields.In my opinion using the inline method I've used greatly simplifies the API and stops you having extra structs that clutter things up. <code>  type Currency struct { value decimal.Decimal //The actual value of the currency. currencyCode string //The ISO currency code.}/*MarshalJSON implements json.Marshaller.*/func (c Currency) MarshalJSON() ([]byte, error) { f, _ := c.Value().Float64() return json.Marshal(struct { Value float64 `json:""value"" bson:""value""` CurrencyCode string `json:""currencyCode"" bson:""currencyCode""` }{ Value: f, CurrencyCode: c.CurrencyCode(), })}/*UnmarshalJSON implements json.Unmarshaller.*/func (c *Currency) UnmarshalJSON(b []byte) error { decoded := new(struct { Value float64 `json:""value"" bson:""value""` CurrencyCode string `json:""currencyCode"" bson:""currencyCode""` }) jsonErr := json.Unmarshal(b, decoded) if jsonErr == nil { c.value = decimal.NewFromFloat(decoded.Value) c.currencyCode = decoded.CurrencyCode return nil } else { return jsonErr }} type Product struct { Name string Code string Price currency.Currency}",Handling Custom BSON Marshaling
"Go: ""tail -f""-like generator"," I had this convenient function in Python: It does something similar to UNIX tail -f: you get last lines of a file as they come. It's convenient because you can get the generator without blocking and pass it to another function.Then I had to do the same thing in Go. I'm new to this language, so I'm not sure whether what I did is idiomatic/correct enough for Go. Here is the code: Is there any cleaner way to do this in Go? I have a feeling that using an asynchronous call for such a thing is an overkill, and it really bothers me. <code>  def follow(path): with open(self.path) as lines: lines.seek(0, 2) # seek to EOF while True: line = lines.readline() if not line: time.sleep(0.1) continue yield line func Follow(fileName string) chan string { out_chan := make(chan string) file, err := os.Open(fileName) if err != nil { log.Fatal(err) } file.Seek(0, os.SEEK_END) bf := bufio.NewReader(file) go func() { for { line, _, _ := bf.ReadLine() if len(line) == 0 { time.Sleep(10 * time.Millisecond) } else { out_chan <- string(line) } } defer file.Close() close(out_chan) }() return out_chan}","""tail -f""-like generator"
Server Side Events Golang," I would like to do some one way streaming of data and am experimenting with SSE vs Websockets.Using SSE form a golang server I'm finding it confusing on how to notify the client when sessions are finished. (eg the server has finished sending the events or the server suddenly goes offline or client looses connectivity)One thing I need is to reliably know when these disconnect situations. Without using timeouts etc.My experiments so far , when I take the server offline the client gets EOF. But I'm having trouble trying to figure out how to signal from the server to the client that a connection is closed / finished and then how to handle / read it? Is EOF a reliable way to determine a closed / error / finished state?Many of the examples with SSE fail to show client good client connection handling.Would this be easier with Websockets?Any experiences suggestions most appreciated.Thanks <code> ",server-sent events Golang
Golang HTTP integration tests," I have a small service written in Go. I'm already testing it with httptest et al, but, I'm mocking the database and etc...What I would like to do:Start up the very same server I use in production with an empty databaseRun tests against it using HTTPGet the coverage of those testsThe empty database part is not a problem, since I made everything configurable via environment variables.Make requests to it is also not the problem, as it is just standard Go code...The problem is: I don't know how to start the server in a way that I could measure the coverage of it (and it's sub-packages). Also, the main server code is inside a main function... I don't even know if I can call it from somewhere else (I tried the standard way, but not with reflection and stuff like that).I'm kind of new using Go, so, this I might be talking nonsense. <code> ",HTTP integration tests
Golang - Reuse a function across multiple structs to satisfy an interface," Is there anyway that you can use the same function across multiple structs to satisfy an interface?For example: Because Wolf and Beagle share the exact same function, is there anyway to write that function once, then share it between the two structs so that they both satisfy Animal? <code>  package mainimport ""fmt""type Animal interface { Speak() string}type Dog struct {}func (d Dog) Speak() string { return ""Woof!""}type Wolf struct {}func (w Wolf) Speak() string { return ""HOWWWWWWWWL""}type Beagle struct {}func (b Beagle) Speak() string { return ""HOWWWWWWWWL""}type Cat struct {}func (c Cat) Speak() string { return ""Meow""}func main() { var a Animal a = Wolf{} fmt.Println(a.Speak())}",Reuse a function across multiple structs to satisfy an interface
How is channel block works in Go Language," I'm learning the Go language. Here is an example I've come across. Can someone please explain what is happening here? Output: If I comment out the default section the output becomes: How does the presence of the default case change the way channel blocking works? <code>  package mainimport ""time""import ""fmt""func main() { c1 := make(chan string) c2 := make(chan string) go func() { time.Sleep(time.Second * 1) c1 <- ""one"" }() go func() { time.Sleep(time.Second * 2) c2 <- ""two"" }() for i := 0; i < 2; i++ { select { case msg1 := <-c1: fmt.Println(""received"", msg1) case msg2 := <-c2: fmt.Println(""received"", msg2) default: fmt.Println(""Default"") } }} DefaultDefaultProgram Exited //default:// fmt.Println(""Default"") received onereceived twoProgram exited.",How does channel blocking work in Go?
"Why do I get a ""cannot assign"" error wnen setting value to a struct as a value in a map?"," New to Go. Encountered this error and have had no luck finding the cause or the rationale for it:If I create a struct, I can obviously assign and re-assign the values no problem: but if the struct is one value in a map: I get cannot assign to p[""HM""].age. That's it, no other info. http://play.golang.org/p/VRlSItd4ePI found a way around this - creating an incrementAge func on Person, which can be called and the result assigned to the map key, eg p[""HM""] = p[""HM""].incrementAge().But, my question is, what is the reason for this ""cannot assign"" error, and why shouldn't I be allowed to assign the struct value directly? <code>  type Person struct { name string age int}func main() { x := Person{""Andy Capp"", 98} x.age = 99 fmt.Printf(""age: %d\n"", x.age)} type Person struct { name string age int }type People map[string]Personfunc main() { p := make(People) p[""HM""] = Person{""Hank McNamara"", 39} p[""HM""].age = p[""HM""].age + 1 fmt.Printf(""age: %d\n"", p[""HM""].age)}","Why do I get a ""cannot assign"" error when setting value to a struct as a value in a map?"
Golang : convert time.Time to string," I'm trying to add some values from my database to a []string in Go. Some of these are timestamps.I get the error: cannot use U.Created_date (type time.Time) as type string in array elementCan I convert time.Time to string? - EDITI added the following. It works now, thanks. <code>  type UsersSession struct { Userid int Timestamp time.Time Created_date time.Time}type Users struct { Name string Email string Country string Created_date time.Time Id int Hash string IP string} var usersArray = [][]string{}rows, err := db.Query(""SELECT u.id, u.hash, u.name, u.email, u.country, u.IP, u.created_date, us.timestamp, us.created_date FROM usersSession AS us LEFT JOIN users AS u ON u.id = us.userid WHERE us.timestamp + interval 30 minute >= now()"")U := Users{}US := UsersSession{}for rows.Next() { err = rows.Scan(&U.Id, &U.Hash, &U.Name, &U.Email, &U.Country, &U.IP, &U.Created_date, &US.Timestamp, &US.Created_date) checkErr(err) userid_string := strconv.Itoa(U.Id) user := []string{userid_string, U.Hash, U.Name, U.Email, U.Country, U.IP, U.Created_date, US.Timestamp, US.Created_date} // ------------- // ^ this is where the error occurs // cannot use U.Created_date (type time.Time) as type string in array element (for US.Created_date and US.Timestamp aswell) // ------------- usersArray = append(usersArray, user) log.Print(""usersArray: "", usersArray)} userCreatedDate := U.Created_date.Format(""2006-01-02 15:04:05"")userSessionCreatedDate := US.Created_date.Format(""2006-01-02 15:04:05"")userSessionTimestamp := US.Timestamp.Format(""2006-01-02 15:04:05"")",Convert time.Time to string
Golang: convert time.Time to string," I'm trying to add some values from my database to a []string in Go. Some of these are timestamps.I get the error: cannot use U.Created_date (type time.Time) as type string in array elementCan I convert time.Time to string? - EDITI added the following. It works now, thanks. <code>  type UsersSession struct { Userid int Timestamp time.Time Created_date time.Time}type Users struct { Name string Email string Country string Created_date time.Time Id int Hash string IP string} var usersArray = [][]string{}rows, err := db.Query(""SELECT u.id, u.hash, u.name, u.email, u.country, u.IP, u.created_date, us.timestamp, us.created_date FROM usersSession AS us LEFT JOIN users AS u ON u.id = us.userid WHERE us.timestamp + interval 30 minute >= now()"")U := Users{}US := UsersSession{}for rows.Next() { err = rows.Scan(&U.Id, &U.Hash, &U.Name, &U.Email, &U.Country, &U.IP, &U.Created_date, &US.Timestamp, &US.Created_date) checkErr(err) userid_string := strconv.Itoa(U.Id) user := []string{userid_string, U.Hash, U.Name, U.Email, U.Country, U.IP, U.Created_date, US.Timestamp, US.Created_date} // ------------- // ^ this is where the error occurs // cannot use U.Created_date (type time.Time) as type string in array element (for US.Created_date and US.Timestamp aswell) // ------------- usersArray = append(usersArray, user) log.Print(""usersArray: "", usersArray)} userCreatedDate := U.Created_date.Format(""2006-01-02 15:04:05"")userSessionCreatedDate := US.Created_date.Format(""2006-01-02 15:04:05"")userSessionTimestamp := US.Timestamp.Format(""2006-01-02 15:04:05"")",Convert time.Time to string
golang - write struct to csv file," What is an idiomatic golang way to dump the struct into a csv file provided? I am inside a func where my struct is passed as interface{}: Why interface{}? - reading data from JSON and there could be a few different structs returned, so trying to write a generic enough function.an example of my types: <code>  func decode_and_csv(my_response *http.Response, my_struct interface{}) type Location []struct { Name string `json: ""Name""` Region string `json: ""Region""` Type string `json: ""Type""`}",Write struct to csv file
Is there any harm in creating a transaction for every select?," I have stored procedures that create temp tables. I would like to then execute a query that joins with these temp tables.The problem is that with Golang's database/sql design, the only way to ensure you get the same connection for subsequent queries is to create a transaction.Am I asking for trouble if I wrap the majority of my SELECTs in a transaction for the purpose of accessing a temp table? I understand that I will lose some performance/scalability because I'll be holding onto connections from the pool rather than allowing them to go back between queries. But I'm wondering if I'll start seeing locking or other serious issues with this strategy.The reason I need to do this is because the MySQL execution plan for many of my tables is very poor (I'm doing several joins across large tables). I'd like to execute some intermediate queries and store their results in temp tables to avoid this issue. <code> ",Is there any way to use MySQL Temp Tables in Go?
Handle optional JSON field in http request body in Golang," I have a struct like this: Then I have some value (could be default, which means I do not need to update this value) to feed in as HTTP request data. I noticed the generated JSON body will always contains all three fields (name, age and email), even if I don't need to update all of them. Like this: Is there a way to Marshal so that the JSON body contains not all fields with the same struct? Example: <code>  type MyStruct struct { Name string `json:""name""` Age int `json:""age""` Email string `json:""email""`} { ""name"":""Kevin"", ""age"":10, ""email"":""""} { ""name"":""kevin""}",Handle optional JSON field in HTTP request body
How to read binary data in Go produced by Python?," I'm trying to figure out the best way to read a packed binary file in Go that was produced by Python like the following: I have been tinkering with some of the examples I've seen on Github.com and a few other sources but I can't seem to get anything working correctly (update shows working method). What is the idiomatic way to do this sort of thing in Go? This is one of several attemptsUPDATE and WORKING <code>  import structf = open('tst.bin', 'wb')fmt = 'iih' #please note this is packed binary: 4byte int, 4byte int, 2byte intf.write(struct.pack(fmt,4, 185765, 1020))f.write(struct.pack(fmt,4, 185765, 1022))f.close() package main import ( ""fmt"" ""os"" ""encoding/binary"" ""io"" ) func main() { fp, err := os.Open(""tst.bin"") if err != nil { panic(err) } defer fp.Close() lineBuf := make([]byte, 10) //4 byte int, 4 byte int, 2 byte int per line for true { _, err := fp.Read(lineBuf) if err == io.EOF{ break } aVal := int32(binary.LittleEndian.Uint32(lineBuf[0:4])) // same as: int32(uint32(b[0]) | uint32(b[1])<<8 | uint32(b[2])<<16 | uint32(b[3])<<24) bVal := int32(binary.LittleEndian.Uint32(lineBuf[4:8])) cVal := int16(binary.LittleEndian.Uint16(lineBuf[8:10])) //same as: int16(uint32(b[0]) | uint32(b[1])<<8) fmt.Println(aVal, bVal, cVal) } }",How to read packed binary data in Go?
Inheritance in Golang," Why doesn't Go have Type Inheritance. (The concept that when a class of an objects is defined, any subclass that is defined can inherit the definitions of one or more general classes) <code> ",Inheritance in Go
Convert sql datetime string to Time format," I just cant manage to parse an SQL datetime (MySQL) value into a time.Time value. I cant find the layout fitting sql datetime. And also not really understand how this works.I do imagine I'am not the first struggling with this, though i cant really find how I should make this work.Input: Desired output: Code <code>  2015-12-23 00:00:00 1450825200 time, err := time.Parse(time.SomeSqlDateTimeLayout, ""2015-12-23 00:00:00"")timestamp := time.Unix()",Convert a MySQL datetime string to time.Time format
Convert sql datetime string to Time format [GO]," I just cant manage to parse an SQL datetime (MySQL) value into a time.Time value. I cant find the layout fitting sql datetime. And also not really understand how this works.I do imagine I'am not the first struggling with this, though i cant really find how I should make this work.Input: Desired output: Code <code>  2015-12-23 00:00:00 1450825200 time, err := time.Parse(time.SomeSqlDateTimeLayout, ""2015-12-23 00:00:00"")timestamp := time.Unix()",Convert a MySQL datetime string to time.Time format
how to verify the token in jwt-go library?," I am using the jwt-go library in golang, and using the HS512 algorithm for signing the token. I want to make sure the token is valid and the example in the docs is like this: I understand that myToken is the string token and the keyFunc gets passed the parsed token, but I don't understand what myLookupKey function is supposed to do?, and token.Header doesn't have a kid value when i print it to console and even thought the token has all the data I put in it, token.Valid is always false. Is this a bug? How do I verify the token is valid? <code>  token, err := jwt.Parse(myToken, func(token *jwt.Token) (interface{}, error) { return myLookupKey(token.Header[""kid""])})if err == nil && token.Valid { fmt.Println(""Your token is valid. I like your style."")} else { fmt.Println(""This token is terrible! I cannot accept this."")}",How to verify a JSON Web Token with the jwt-go library?
Combile URL paths," Is there a way in Go to combine URL paths similarly as we can do with filepaths using path.Join()?For example see e.g. Combine absolute path and relative path to get a new absolute path. When I use path.Join(""http://foo"", ""bar""), I get http:/foo/bar. See in Golang Playground. <code> ",Combine URL paths with path.Join()
Should a go constructor return an error or a nil value?," Given the a constructor function such as Should this function include sanity checks, such as &name == nil, or len(name) == 0? If this function should contain sanity checks, what value should be returned from the constructor? A nil value, or an error (errors.New(...))? An example is included below.  <code>  func NewSomething(name, color string) *Something { s := Something{name, color} return &s} func NewSomething(name, color string) *Something { if &name == nil || len(name) == 0 { return nil } if &color== nil || len(color) == 0 { return nil } s := Something{name, color} return &s}","Should a ""constructor"" function return an error or a null value?"
How to retrieve Form data (as array) in Golang?," I'm a PHP Dev. But currently moving to Golang... I'm trying to retrieve data from a Form (Post method): In PHP I would simple use this to get the data: BUT in go... either I get one by one or the whole thing but not the Contact[] Array only such as PHPI thought about 2 solutions:1) Get one by one: Note that the map keys are the whole: ""Contact[Name]""...2) Range whole map r.Form and ""parse|obtain"" those values with Prefix ""Contact["" and then replacing ""Contact["" and ""]"" with empty string so I can get the Form array Key only such the PHP ExampleI went for this work around by my own but... ranging over the whole form may not be a good idea (?) Both solutions give me the same output... But in the 2nd example I don't necessarily need to know the keys of ""Contact[]""I know... I may just forget about that ""Form Array"" and use name=""Email"" on my inputs and retrieve one by one but... I've passing through some scenarios where I use ONE form that contain more than 2 arrays of data and do different things with each one, like ORMsQuestion 1: Is there a easier way to get my Form Array as an actual map in Golang like PHP does?Question 2: Should I retrieve the data one by one (Tedious as much and I may change the Form data at some point and recompile...) or iterate the whole thing as I've done in the 2nd example.Sorry for my bad English... Thanks in advance! <code>  <!-- A really SIMPLE form --><form class="""" action=""/Contact"" method=""post""> <input type=""text"" name=""Contact[Name]"" value=""Something""> <input type=""text"" name=""Contact[Email]"" value=""Else""> <textarea name=""Contact[Message]"">For this message</textarea> <button type=""submit"">Submit</button></form> <?php print_r($_POST[""Contact""])?>// Output would be something like this:Array( [Name] => Something [Email] => Else [Message] => For this message) // r := *http.Requesterr := r.ParseForm()if err != nil { w.Write([]byte(err.Error())) return}contact := make(map[string]string)contact[""Name""] = r.PostFormValue(""Contact[Name]"")contact[""Email""] = r.PostFormValue(""Contact[Email]"")contact[""Message""] = r.PostFormValue(""Contact[Message]"")fmt.Println(contact)// Outputmap[Name:Something Email:Else Message:For this Message] // ContactPost process the form sent by the userfunc ContactPost(w http.ResponseWriter, r *http.Request, ps httprouter.Params) { err := r.ParseForm() if err != nil { w.Write([]byte(err.Error())) return } contact := make(map[string]string) for i := range r.Form { if strings.HasPrefix(i, ""Contact["") { rp := strings.NewReplacer(""Contact["", """", ""]"", """") contact[rp.Replace(i)] = r.Form.Get(i) } } w.Write([]byte(fmt.Sprint(contact)))}//Outputmap[Name:Something Email:Else Message:For this Message]",How to retrieve form-data as map (like PHP and Ruby) in Go (Golang)
How to retrieve Form data (as array)," I'm a PHP Dev. But currently moving to Golang... I'm trying to retrieve data from a Form (Post method): In PHP I would simple use this to get the data: BUT in go... either I get one by one or the whole thing but not the Contact[] Array only such as PHPI thought about 2 solutions:1) Get one by one: Note that the map keys are the whole: ""Contact[Name]""...2) Range whole map r.Form and ""parse|obtain"" those values with Prefix ""Contact["" and then replacing ""Contact["" and ""]"" with empty string so I can get the Form array Key only such the PHP ExampleI went for this work around by my own but... ranging over the whole form may not be a good idea (?) Both solutions give me the same output... But in the 2nd example I don't necessarily need to know the keys of ""Contact[]""I know... I may just forget about that ""Form Array"" and use name=""Email"" on my inputs and retrieve one by one but... I've passing through some scenarios where I use ONE form that contain more than 2 arrays of data and do different things with each one, like ORMsQuestion 1: Is there a easier way to get my Form Array as an actual map in Golang like PHP does?Question 2: Should I retrieve the data one by one (Tedious as much and I may change the Form data at some point and recompile...) or iterate the whole thing as I've done in the 2nd example.Sorry for my bad English... Thanks in advance! <code>  <!-- A really SIMPLE form --><form class="""" action=""/Contact"" method=""post""> <input type=""text"" name=""Contact[Name]"" value=""Something""> <input type=""text"" name=""Contact[Email]"" value=""Else""> <textarea name=""Contact[Message]"">For this message</textarea> <button type=""submit"">Submit</button></form> <?php print_r($_POST[""Contact""])?>// Output would be something like this:Array( [Name] => Something [Email] => Else [Message] => For this message) // r := *http.Requesterr := r.ParseForm()if err != nil { w.Write([]byte(err.Error())) return}contact := make(map[string]string)contact[""Name""] = r.PostFormValue(""Contact[Name]"")contact[""Email""] = r.PostFormValue(""Contact[Email]"")contact[""Message""] = r.PostFormValue(""Contact[Message]"")fmt.Println(contact)// Outputmap[Name:Something Email:Else Message:For this Message] // ContactPost process the form sent by the userfunc ContactPost(w http.ResponseWriter, r *http.Request, ps httprouter.Params) { err := r.ParseForm() if err != nil { w.Write([]byte(err.Error())) return } contact := make(map[string]string) for i := range r.Form { if strings.HasPrefix(i, ""Contact["") { rp := strings.NewReplacer(""Contact["", """", ""]"", """") contact[rp.Replace(i)] = r.Form.Get(i) } } w.Write([]byte(fmt.Sprint(contact)))}//Outputmap[Name:Something Email:Else Message:For this Message]",How to retrieve form-data as map (like PHP and Ruby) in Go (Golang)
golang how to get the value type of a pointer thru an interface," This playground illustrates my question.Basically I have a function that accepts an empty interface as argument. I want to pass anything in and print information on the types and values. It works as expected except when I pass a pointer to a custom type (in my example, of underlying struct type). I am not entirely sure how the reflection model is structured at that point. Since the function signature specifies an interface{} argument when I call reflect.Indirect(v).Kind() it naturally returns interface but I want to know the type when the function is called.Below is the same code from playground: <code>  package mainimport ( ""fmt"" ""reflect"")func main() { var s interface{} s = CustomStruct{} PrintReflectionInfo(s) PrintReflectionInfo(&s)}type CustomStruct struct {}func PrintReflectionInfo(v interface{}) { // expect CustomStruct if non pointer fmt.Println(""Actual type is:"", reflect.TypeOf(v)) // expect struct if non pointer fmt.Println(""Value type is:"", reflect.ValueOf(v).Kind()) if reflect.ValueOf(v).Kind() == reflect.Ptr { // expect: CustomStruct fmt.Println(""Indirect type is:"", reflect.Indirect(reflect.ValueOf(v)).Kind()) // prints interface // expect: struct fmt.Println(""Indirect value type is:"", reflect.Indirect(reflect.ValueOf(v)).Kind()) // prints interface } fmt.Println("""")}",How to get the value type of a pointer through an interface?
golang how to get the value type of a pointer through an interface," This playground illustrates my question.Basically I have a function that accepts an empty interface as argument. I want to pass anything in and print information on the types and values. It works as expected except when I pass a pointer to a custom type (in my example, of underlying struct type). I am not entirely sure how the reflection model is structured at that point. Since the function signature specifies an interface{} argument when I call reflect.Indirect(v).Kind() it naturally returns interface but I want to know the type when the function is called.Below is the same code from playground: <code>  package mainimport ( ""fmt"" ""reflect"")func main() { var s interface{} s = CustomStruct{} PrintReflectionInfo(s) PrintReflectionInfo(&s)}type CustomStruct struct {}func PrintReflectionInfo(v interface{}) { // expect CustomStruct if non pointer fmt.Println(""Actual type is:"", reflect.TypeOf(v)) // expect struct if non pointer fmt.Println(""Value type is:"", reflect.ValueOf(v).Kind()) if reflect.ValueOf(v).Kind() == reflect.Ptr { // expect: CustomStruct fmt.Println(""Indirect type is:"", reflect.Indirect(reflect.ValueOf(v)).Kind()) // prints interface // expect: struct fmt.Println(""Indirect value type is:"", reflect.Indirect(reflect.ValueOf(v)).Kind()) // prints interface } fmt.Println("""")}",How to get the value type of a pointer through an interface?
How to get the value type of a pointer through an interface," This playground illustrates my question.Basically I have a function that accepts an empty interface as argument. I want to pass anything in and print information on the types and values. It works as expected except when I pass a pointer to a custom type (in my example, of underlying struct type). I am not entirely sure how the reflection model is structured at that point. Since the function signature specifies an interface{} argument when I call reflect.Indirect(v).Kind() it naturally returns interface but I want to know the type when the function is called.Below is the same code from playground: <code>  package mainimport ( ""fmt"" ""reflect"")func main() { var s interface{} s = CustomStruct{} PrintReflectionInfo(s) PrintReflectionInfo(&s)}type CustomStruct struct {}func PrintReflectionInfo(v interface{}) { // expect CustomStruct if non pointer fmt.Println(""Actual type is:"", reflect.TypeOf(v)) // expect struct if non pointer fmt.Println(""Value type is:"", reflect.ValueOf(v).Kind()) if reflect.ValueOf(v).Kind() == reflect.Ptr { // expect: CustomStruct fmt.Println(""Indirect type is:"", reflect.Indirect(reflect.ValueOf(v)).Kind()) // prints interface // expect: struct fmt.Println(""Indirect value type is:"", reflect.Indirect(reflect.ValueOf(v)).Kind()) // prints interface } fmt.Println("""")}",How to get the value type of a pointer through an interface?
Golang return values of function as input arguments to another," If I have And I have: Then I can do the following successfully: However, let's say I want to add another argument to doSomething like: Go complains when compiling if I call it like: With: Is there a way to do this or should I just give up and assign the return values from returnIntAndString to some references and pass msg and these values like doSomething(msg, code, str) ? <code>  func returnIntAndString() (i int, s string) {...} func doSomething(i int, s string) {...} doSomething(returnIntAndString()) func doSomething(msg string, i int, s string) {...} doSomething(""message"", returnIntAndString()) main.go:45: multiple-value returnIntAndString() in single-value contextmain.go:45: not enough arguments in call to doSomething()",Return values of function as input arguments to another
Golang: Can the pointer in a struct pointer method be reassigned to another instance?," I've been looking into Golang and have been implementing a few data structures to learn how the language works. I've come across the following issue while writing the code for an AVL tree:Assigning the primary pointer from a struct pointer method seems to have no effect outside the scope of the function. E.g. tree.rotateLeftToRoot() doesn't result in tree.left becoming the new tree.Question: Is there a way to reassign the pointer in a struct pointer method in Golang, or is this generally discouraged? In the example this would be the ""tree = prevLeft"" line.Code snippet: I've tried other combinations of setting the value or address of tree, and none of them had the intended effect. For example, *tree = *prevLeft results in an infinite loop.Additional note: Returning tree and setting ""tree = tree.rotateLeftToRoot()"" avoids the issue. This works, but it seems dirty to be mixing effects and requiring assignment to returned values, when the caller really just wants to be able to call a function to update the tree.Can the tree be set to prevLeft from within the function? <code>  //Graphical representation of t.rotateLeftToRoot():// t L// L R -> LL t//LL LR LR Rfunc (tree *AvlTree) rotateLeftToRoot() { if tree == nil { return } prevLeft := tree.left if prevLeft != nil { tree.left = prevLeft.right //tree.left passed root its right branch prevLeft.right = tree //tree becomes tree.left's right branch tree.updateHeight() prevLeft.updateHeight() tree = prevLeft //desired behaviour: tree.left becomes the new tree //actual behaviour: no effect when function returns }}",Can the pointer in a struct pointer method be reassigned to another instance?
How to convert ISO 8601 time in goalng?, What is the equivalent code in golang for the following shell command ?date -u +%Y-%m-%dT%T%z <code> ,How to convert ISO 8601 time in golang?
Golang - JSON field set to null vs field not there," Is there a way, in golang, to see if I can differentiate between a json field being set to null vs a json field not being there when unmarshalled into a struct? Because both set the value in the struct to be nil, but I need to know if the field was there to begin with and to see if someone set it to null. VS Both jsons will be nil when unmarshalled into a struct.Any useful resources will be very appreciated! <code>  { ""somefield1"":""somevalue1"", ""somefield2"":null} { ""somefield1"":""somevalue1"",}",JSON field set to null vs field not there
How does defer and named return value work in golang?," I just started learning Go and I got confused with one example about using defer to change named return value in the The Go Blog - Defer, Panic, and Recover.The example says:Deferred functions may read and assign to the returning function's named return values.In this example, a deferred function increments the return value i after the surrounding function returns. Thus, this function returns 2: But as what I have learned from A Tour of Go - Named return valuesA return statement without arguments returns the named return values. This is known as a ""naked"" return.I tested in the following code and in function b it returns 1 because it wasn't the ""A return statement without arguments"" case mentioned above. So my question is in the first example, the surrounding function c has a named return value i, but the function c uses return 1 which in the second example we can see it should have return 1 no matter what value i is. But why after i changes in the deferred function the c function returns the value of i instead the value 1?As I was typing my question, I might have guessed the answer. Is it because: is equals to: in a function with a named return value variable i?Please help me confirm, thanks! <code>  func c() (i int) { defer func() { i++ }() return 1} func a() (i int) { // return 2 i = 2 return}func b() (i int) { // return 1 i = 2 return 1} return 1 i = 1return ",How does defer and named return value work?
Golang - How do you create a slice of functions with different signatures?," How do you create a slice of functions with different signatures? I tried the code below but its feels hack-ish. Do we just bite the bullet and use a slice interface{}? Is this just a case of trying to do too much with Go? <code>  package mainimport ( ""fmt"")type OneParams func(string) stringtype TwoParams func(string, string) stringtype ThreeParams func(string, string, string) stringfunc (o OneParams) Union() string { return ""Single string""}func (t TwoParams) Union() string { return ""Double string""}func (t ThreeParams) Union() string { return ""Triple string""}type Functions interface { Union() string}func Single(str string) string { return str}func Double(str1 string, str2 string) string { return str1 + "" "" + str2}func Triple(str1 string, str2 string, str3 string) string { return str1 + "" "" + str2 + "" "" + str3}func main() { fmt.Println(""Slice Of Functions Program!\n\n"") fSlice := []Functions{ OneParams(Single), TwoParams(Double), ThreeParams(Triple), } for _, value := range fSlice { switch t := value.(type) { case OneParams: fmt.Printf(""One: %s\n"", t(""one"")) case TwoParams: fmt.Printf(""Two: %s\n"", t(""one"", ""two"")) case ThreeParams: fmt.Printf(""Three: %s\n"", t(""one"", ""two"", ""three"")) default: fmt.Println(""Huh! What's that?"") } } fmt.Println(""\n\n"")}",How do you create a slice of functions with different signatures?
Go. Best practice to handle error from multiple abstract level," I wondering what is the best way to handle error form multiple level abstraction in go. Every time if I must add a new level abstraction to program, I am forced to transfer error code from level less to level high. Thereby is duplicate communitaces in log file or I must remmember to delete communicate form level low and transfer him to level higher. Below simply example. I skipped creating each object to more shortly and celar code, but I think You understand my problem In result in log file I get duplicate posts In turn if I only transfer some err to higher level without additional log I lost information what happend in each level. How this solve ? How privent duplicate communicates ? Or My way is the good and the only ?Problem is more frustrating if I create a few object which search something in database on a few abstraction level then I get also few lines form this same task in logFile.  <code>  type ObjectOne struct{ someValue int}func (o* ObjectOne)CheckValue()error{ if o.someValue == 0 { SomeLogger.Printf(""Value is 0 error program"") // communicate form first level abstraction to logger return errors.New(""Internal value in object is 0"") } return nil}type ObjectTwoHigherLevel struct{ objectOne ObjectOne}func (oT* ObjectTwoHigherLevel)CheckObjectOneIsReady() error{ if err := oT.objectOne.CheckValue() ; err != nil{ SomeLogger.Printf(""Value in objectOne is not correct for objectTwo %s"" , err) // second communicate return err } return nil}type ObjectThreeHiggerLevel struct{ oT ObjectTwoHigherLevel}func (oTh* ObjectThreeHiggerLevel)CheckObjectTwoIsReady()error{ if err := oTh.oT.CheckObjectOneIsReady() ; err != nil{ SomeLogger.Printf(""Value in objectTwo is not correct for objectThree %s"" , err) return err } return nil} Value is 0 error program Value in objectOne is not correct for objectTwo Internal value in object is 0 Value in objectTwo is not correct for objectThree Internal value in object is 0",Best practice to handle error from multiple abstract level
Goroutines are cooperatively scheduled. Does that mean that goroutines not blocked on I/O will cause goroutines to run sequentially?," From: http://blog.nindalf.com/how-goroutines-work/ As the goroutines are scheduled cooperatively, a goroutine that loops continuously can starve other goroutines on the same thread. Goroutines are cheap and do not cause the thread on which they are multiplexed to block if they are blocked on network input sleeping channel operations or blocking on primitives in the sync package. So given the above, say that you have some code like this that does nothing but loop a random number of times and print the sum: if you use goroutines like will the goroutines run one by one if you only have one thread? <code>  func sum(x int) { sum := 0 for i := 0; i < x; i++ { sum += i } fmt.Println(sum)} go sum(100)go sum(200)go sum(300)go sum(400)",Goroutines are cooperatively scheduled. Does that mean that goroutines that don't yield execution will cause goroutines to run one by one?
Go - Static member variable such as OOP langage," I'm pretty new with Go and then I searched a lot how to have a static class with static function/variables such as C# by example. But, I couldn't find anything which answered well about it. Maybe this question seems stupid, but I don't like either when I'm not sure or when I don't understand completely something. Let say we have this code: Golang is a C-like if I understand, so does it have some behavior like this one above, such as C++/C# languages? My code above can be achieved as C++/C# or the way to do it is to passing by a language as C (using the C modular programming way)? <code>  public class Program{ public static string name = ""Program tester.""; public enum Importance { None, Trivial, Regular, Important, Critical }; public static void tester(Importance value) { // ... Test against known Importance values. if (value == Importance.Trivial) { Console.WriteLine(""Not true""); } else if (value == Importance.Critical) { Console.WriteLine(""True""); } }}",Static member variable such as OOP langage
What's the difference between ResponseWriter.write and io.WriteString?," I've seen three ways of writing content to HTTP response: And: Also there's: What's the difference between them? Which one is preferred to use? <code>  func Handler(w http.ResponseWriter, req *http.Request) { io.WriteString(w, ""blabla.\n"")} func Handler(w http.ResponseWriter, r *http.Request) { w.Write([]byte(""blabla\n""))} fmt.Fprintf(w, ""blabla"")",What's the difference between ResponseWriter.Write and io.WriteString?
Rest API's in go," I see that Go itself has a package net/http, which is adequate at providing everything you need to get your own REST APIs up and running. However, there are a variety of frameworks; the most popular maybe say gorilla.Considering that one of the main things I need to do going forward is to build REST APIs that will access some back-end storage (databases, caches, etc.) to perform CRUD operation, is it good to go with Go's standard library itself, or should I consider using some frameworks?Normally, people write a new library or framework which solves the problem present in the existing library. But a lot of the frameworks also tend to make things worse when actual demands are simple.So I have few questions:Is the basic library in go lang good enough to support basic to moderate functionality for REST?If I do end up using the inbuilt library and tomorrow have to change it to use some framework (like a gorilla), how difficult/costly would that be?Are frameworks really addressing the problems or just making simple problems complex?I would be extremely grateful for someone to share his thoughts here (who has been through making this choice himself) while I research more of my own. <code> ",Rest APIs in Go - using net/http vs. a library like Gorilla
Golang - Removing all Unicode newlines from a string, How do I remove all Unicode newlines from a UTF-8 string in GoLang? I found this answer for PHP. <code> ,Golang - Removing all Unicode newline characters from a string
how to parse mysql error golang," I am trying to parse MySQL errors in order to return clean error messages to the user from a Go API.I read some article like this one that show what I would like to do but it looks like the module go-mysql-driver that I am using doesn't support parseError.To give a concrete example, with the error: I would like to be able to build a data structure that allow me to organize the information in order to return a user friendly message like so I can also translate it in different languages and send ready-to-use error messages back to the client.Thank you! <code>  Error 1062: Duplicate entry 'John' for key 'name_UNIQUE' Error with the field 'name': 'John' already exist""",How to parse MySQL errors
How to parse MySQL errors in Golang," I am trying to parse MySQL errors in order to return clean error messages to the user from a Go API.I read some article like this one that show what I would like to do but it looks like the module go-mysql-driver that I am using doesn't support parseError.To give a concrete example, with the error: I would like to be able to build a data structure that allow me to organize the information in order to return a user friendly message like so I can also translate it in different languages and send ready-to-use error messages back to the client.Thank you! <code>  Error 1062: Duplicate entry 'John' for key 'name_UNIQUE' Error with the field 'name': 'John' already exist""",How to parse MySQL errors
go lang (go-gin) listen on TCP4 not TCP6," I am using https://github.com/gin-gonic/gin to write an http serviceBut when I deploy it, it keeps deploying on tcp6(according to netstat) <code>  r := gin.Default()//none of these are working , It keeps being listed on tcp6r.Run("":8080"")r.Run(""*:8080"")r.Run(""0.0.0.0:8080"")",Listen on TCP4 not TCP6
How to Get data from aws Dynamodb with using partition key only(aws-sdk-go)?," I am using aws-sdk-go library for DynamoDb connectivity in Golang. My DynamoDb table have a Partition key DeviceId (String) and a Sort Key Time (Number). How can I write GetItemInput to get all data with a specific DeviceId? <code>  params := &dynamodb.GetItemInput{ Key: map[string]*dynamodb.AttributeValue { ""DeviceId"": { S: aws.String(""item_1""), }, }, ExpressionAttributeNames: map[string]*string{ ""DeviceId"": ""DeviceId"", }, TableName: aws.String(""DbName""), }list, err := svc.GetItem(params)",How to get data from aws Dynamodb with using partition key only?
Using dlv(delve) debugger in VS Code," I have installed the Go extension for VS Code, but unable to make it work.""dlv debug"" works alright from the terminal. The launch.json: Do you know how to set it up? <code>  dlv debug src/github.com/user/hello { ""version"": ""0.2.0"", ""configurations"": [ { ""name"": ""Launch"", ""type"": ""go"", ""request"": ""launch"", ""mode"": ""debug"", ""program"": ""${workspaceRoot}"", ""env"": {}, ""args"": [] } ]}",How to use Delve debugger in Visual Studio Code
Using dlv (delve) debugger in VS Code," I have installed the Go extension for VS Code, but unable to make it work.""dlv debug"" works alright from the terminal. The launch.json: Do you know how to set it up? <code>  dlv debug src/github.com/user/hello { ""version"": ""0.2.0"", ""configurations"": [ { ""name"": ""Launch"", ""type"": ""go"", ""request"": ""launch"", ""mode"": ""debug"", ""program"": ""${workspaceRoot}"", ""env"": {}, ""args"": [] } ]}",How to use Delve debugger in Visual Studio Code
Golang MVC structur, I searched many sites and I saw a lot of sources in GitHub and I haven't found a solution.I created an MVC website pattern in Golang:appcontrollersmodelslib (All the features class/functions)middlewarerouter.goresourcesviewsmain.goMy question is: How to inject config to have everywhere settings and other implemented class that will always be needed (like load speed single page).One more thing(additionally): Can anyone recommend me a good material or transcribe MVC tricks idea works MVC with Golang (General useful information). <code> ,Golang MVC structure
Get session values in golang, My rails app uses session for storing a user credentials for authorization. Trying to sign in and do some actions (that require a user session) in Go code. Should I retrieve a user session when signing in and pass to the next request? How can I handle that? <code> ,Get session values
Refer other package in godoc of a package, Can someone let me know if it is possible to refer a different package from godoc of a package? For example let's say I have a package src/logger/. In src/logger/doc.go I need to refer src/config/. Something like @see in javadoc. Is there a recommended way?I am on Go 1.7. <code> ,Refer a different package from the godoc of a package
What's the best practices to run a background task along with server listening in golang?," I'm new to Go. Say I have a server listening to HTTP request, and at the same time I need to check Redis notification so I can update data. Below is an example: Does simply putting checkExpire into a goroutine a good solution? <code>  func checkExpire() { for { switch msg := pubSubConn.Receive().(type) { case redis.Message: ... }}server.ListenAndServe() go func() { for { switch msg := pubSubConn.Receive().(type) { case redis.Message: ... }}()",What's the best practices to run a background task along with server listening
What's the best practices to run a background task along with server listening in Golang?," I'm new to Go. Say I have a server listening to HTTP request, and at the same time I need to check Redis notification so I can update data. Below is an example: Does simply putting checkExpire into a goroutine a good solution? <code>  func checkExpire() { for { switch msg := pubSubConn.Receive().(type) { case redis.Message: ... }}server.ListenAndServe() go func() { for { switch msg := pubSubConn.Receive().(type) { case redis.Message: ... }}()",What's the best practices to run a background task along with server listening
Is it possible to initialize golang slice with specific values?," Is it possible to initialize an slice with all 1's like in python?PYTHON: GOLANG Is it possible to do better than this? <code>  onesArray = np.ones(5)onesList = [1]*5 onesSlice := make([]int, 5)for i:= 0; i < len(onesSlice); i++{ onesSlice[i] = 1}",Is it possible to initialize slice with specific values?
"How to use predifined protobuf type (i.e. ""google/protobuf/timestamp.proto"") with grpc in golang"," I'm trying to use google/protobuf/timestamp.proto in with gRPC plugin and Go. This is how I run protoc: And this is my .proto: I'm seeing the following errors: Am I missing something, or this is not yet supported? <code>  protoc -I ./ ./*.proto --go_out=plugins=grpc:. #domain.protosyntax = ""proto3"";option java_multiple_files = true;option java_package = ""com.viant.xyz"";option java_outer_classname = ""domain"";import ""google/protobuf/timestamp.proto"";message Foo { Timestamp modifiedTime = 1; ...} domain.proto: Import ""google/protobuf/timestamp.proto"" was not found or had errors.domain.proto:44:5: ""Timestamp"" is not defined.","How to use predifined protobuf type (i.e. ""google/protobuf/timestamp.proto"") with gRPC"
Is Go vurable for buffer overflow, I know languages like c# aren't vulnerable to buffer overflows unless you marshal or use unsafe code. But is go vulnerable for buffer overflows? <code> ,Is Go vulnerable for buffer overflow
Coverage testing os.Exit scenarios in Go with Goveralls," This question: How to test os.exit scenarios in Go (and the highest voted answer therein) sets out how to test os.Exit() scenarios within go. As os.Exit() cannot easily be intercepted, the method used is to reinvoke the binary and check the exit value. This method is described at slide 23 on this presentation by Andrew Gerrand (one of the core members of the Go team); the code is very simple and is reproduced in full below.The relevant test and main files look like this (note that this pair of files alone is an MVCE): and However, this method appears to suffer certain limitations:Coverage testing with goveralls / coveralls.io does not work - see for instance the example here (the same code as above but put into github for your convenience) which produces the coverage test here, i.e. it does not record the test functions being run. NOTE that you don't need to those links to answer the question - the above example will work fine - they are just there to show what happens if you put the above into github, and take it all the way through travis to coveralls.ioRerunning the test binary appears fragile.Specifically, as requested, here is a screenshot (rather than a link) for the coverage failure; the red shading indicates that as far as coveralls.io is concerned, Crasher() is not being called.Is there a way around this? Particularly the first point.At a golang level the problem is this:The Goveralls framework runs go test -cover ..., which invokes the test above.The test above calls exec.Command / .Run without -cover in the OS argumentsUnconditionally putting -cover etc. in the argument list is unattractive as it would then run a coverage test (as the subprocess) within a non-coverage test, and parsing the argument list for the presence of -cover etc. seems a heavy duty solution.Even if I put -cover etc. in the argument list, my understanding is that I'd then have two coverage outputs written to the same file, which isn't going to work - these would need merging somehow. The closest I've got to that is this golang issue.SummaryWhat I am after is a simple way to run go coverage testing (preferably via travis, goveralls, and coveralls.io), where it is possible to both test cases where the tested routine exits with OS.exit(), and where the coverage of that test is noted. I'd quite like it to use the re-exec method above (if that can be made to work) if that can be made to work.The solution should show coverage testing of Crasher(). Excluding Crasher() from coverage testing is not an option, as in the real world what I am trying to do is test a more complex function, where somewhere deep within, under certain conditions, it calls e.g. log.Fatalf(); what I am coverage testing is that the tests for those conditions works properly. <code>  package fooimport ( ""os"" ""os/exec"" ""testing"")func TestCrasher(t *testing.T) { if os.Getenv(""BE_CRASHER"") == ""1"" { Crasher() // This causes os.Exit(1) to be called return } cmd := exec.Command(os.Args[0], ""-test.run=TestCrasher"") cmd.Env = append(os.Environ(), ""BE_CRASHER=1"") err := cmd.Run() if e, ok := err.(*exec.ExitError); ok && !e.Success() { fmt.Printf(""Error is %v\n"", e) return } t.Fatalf(""process ran with err %v, want exit status 1"", err)} package fooimport ( ""fmt"" ""os"")// Coverage testing thinks (incorrectly) that the func below is// never being calledfunc Crasher() { fmt.Println(""Going down in flames!"") os.Exit(1)}",Testing os.Exit scenarios in Go with coverage information (coveralls.io/Goveralls)
Coverage testing os.Exit scenarios in Go with coverage testing information (coveralls.io/Goveralls)," This question: How to test os.exit scenarios in Go (and the highest voted answer therein) sets out how to test os.Exit() scenarios within go. As os.Exit() cannot easily be intercepted, the method used is to reinvoke the binary and check the exit value. This method is described at slide 23 on this presentation by Andrew Gerrand (one of the core members of the Go team); the code is very simple and is reproduced in full below.The relevant test and main files look like this (note that this pair of files alone is an MVCE): and However, this method appears to suffer certain limitations:Coverage testing with goveralls / coveralls.io does not work - see for instance the example here (the same code as above but put into github for your convenience) which produces the coverage test here, i.e. it does not record the test functions being run. NOTE that you don't need to those links to answer the question - the above example will work fine - they are just there to show what happens if you put the above into github, and take it all the way through travis to coveralls.ioRerunning the test binary appears fragile.Specifically, as requested, here is a screenshot (rather than a link) for the coverage failure; the red shading indicates that as far as coveralls.io is concerned, Crasher() is not being called.Is there a way around this? Particularly the first point.At a golang level the problem is this:The Goveralls framework runs go test -cover ..., which invokes the test above.The test above calls exec.Command / .Run without -cover in the OS argumentsUnconditionally putting -cover etc. in the argument list is unattractive as it would then run a coverage test (as the subprocess) within a non-coverage test, and parsing the argument list for the presence of -cover etc. seems a heavy duty solution.Even if I put -cover etc. in the argument list, my understanding is that I'd then have two coverage outputs written to the same file, which isn't going to work - these would need merging somehow. The closest I've got to that is this golang issue.SummaryWhat I am after is a simple way to run go coverage testing (preferably via travis, goveralls, and coveralls.io), where it is possible to both test cases where the tested routine exits with OS.exit(), and where the coverage of that test is noted. I'd quite like it to use the re-exec method above (if that can be made to work) if that can be made to work.The solution should show coverage testing of Crasher(). Excluding Crasher() from coverage testing is not an option, as in the real world what I am trying to do is test a more complex function, where somewhere deep within, under certain conditions, it calls e.g. log.Fatalf(); what I am coverage testing is that the tests for those conditions works properly. <code>  package fooimport ( ""os"" ""os/exec"" ""testing"")func TestCrasher(t *testing.T) { if os.Getenv(""BE_CRASHER"") == ""1"" { Crasher() // This causes os.Exit(1) to be called return } cmd := exec.Command(os.Args[0], ""-test.run=TestCrasher"") cmd.Env = append(os.Environ(), ""BE_CRASHER=1"") err := cmd.Run() if e, ok := err.(*exec.ExitError); ok && !e.Success() { fmt.Printf(""Error is %v\n"", e) return } t.Fatalf(""process ran with err %v, want exit status 1"", err)} package fooimport ( ""fmt"" ""os"")// Coverage testing thinks (incorrectly) that the func below is// never being calledfunc Crasher() { fmt.Println(""Going down in flames!"") os.Exit(1)}",Testing os.Exit scenarios in Go with coverage information (coveralls.io/Goveralls)
"Is it okay to panic inside defer function, especially when it's alreay panicking?"," I tried this code and it seems the first panic panic(1) is simply ""overwritten"" by the second panic panic(2).But is it okay to do that? Or call a Golang function that might panic inside defer function?(In C++ it's almost never acceptable to throw exception out of a destructor. It terminates program if stack is already unwinding. I wonder if panicking in a similar manner could be bad in Golang.) <code>  func sub(){ defer func (){ panic(2) }() panic(1)}func main(){ defer func(){ x:=recover() println(x.(int)); }() sub()}","Is it okay to panic inside defer function, especially when it's already panicking?"
How to determine if type is a struct in Golang," Suppose I have 2 structs: And i want to reflect the Extended struct to get it's field : <code>  type Base struct { id int name string}type Extended struct { Base Email string Password string} e := Extended{}e.Email = ""me@mail.com""e.Password = ""secret""for i := 0 ; i < reflect.TypeOf(e).NumField() ; i++ { if reflect.TypeOf(e).Field(i) != ""struct"" { << how to do this validation? fmt.Println(reflect.ValueOf(e).Field(i)) }}",How to determine if type is a struct
golang template engine pipelines," I have a Golang template, defined like this Then I use it in one of my files: What does the dot mean after ""test""? Golang template docs say: But I am not sure what pipeline is. Reading documentation gave no results, could anyone explain once again?Also, why do we have to start values beginning with dot? E.g. {{ - printf ""%s"" .Name | trunc 24 -}}. Is it also a kind of pipeline?Thank you in advance! <code>  {{- define ""test"" -}}{{- printf ""%s"" .Name | trunc 24 -}}{{- end -}} {{ template ""test"" . }} {{template ""name"" pipeline}}The template with the specified name is executed with dot setto the value of the pipeline.",Golang template engine pipelines
Converting RGBA image to Grayscale Golan," I'm currently working on a program to convert and RGBA image to grayscale.I asked a question earlier and was directed to the following answer -Change color of a single pixel - Go lang imageHere is my original question - Program to convert RGBA to grayscale GolangI have edited my code so it now successfully runs - however the image outputted is not what I want. It is converted to grayscale however the pixels are all messed up making it look like noise on an old TV. I know I haven't added in the if else statement for checking if the image can accept the Set() method, however the suggestion for simply making a new image seems to have solved this.Any help much appreciated.Edit:I've added in some suggested code from the answer below: I currently get the following error. Am I missing something from the answer? Any tips appreciated. <code>  package mainimport (""image""""image/color""""image/jpeg""""log""""os"")type ImageSet interface {Set(x, y int, c color.Color)}func main() {file, err := os.Open(""flower.jpg"")if err != nil { log.Fatal(err)}defer file.Close()img, err := jpeg.Decode(file)if err != nil { log.Fatal(os.Stderr, ""%s: %v\n"", ""flower.jpg"", err)}b := img.Bounds()imgSet := image.NewRGBA(b)for y := 0; y < b.Max.Y; y++ { for x := 0; x < b.Max.X; x++ { oldPixel := img.At(x, y) r, g, b, a:= oldPixel.RGBA() r = (r+g+b)/3 pixel := color.RGBA{uint8(r), uint8(r), uint8(r), uint8(a)} imgSet.Set(x, y, pixel) } } outFile, err := os.Create(""changed.jpg"") if err != nil { log.Fatal(err) } defer outFile.Close() jpeg.Encode(outFile, imgSet, nil)} package mainimport (//""fmt""""image""""image/color""""image/jpeg""""log""""os"")type ImageSet interface {Set(x, y int, c color.Color)}func main() {file, err := os.Open(""flower.jpg"")if err != nil { log.Fatal(err)}defer file.Close()img, err := jpeg.Decode(file)if err != nil { log.Fatal(os.Stderr, ""%s: %v\n"", ""flower.jpg"", err)}b := img.Bounds()imgSet := image.NewRGBA(b)for y := 0; y < b.Max.Y; y++ { for x := 0; x < b.Max.X; x++ { oldPixel := img.At(x, y) r, g, b, _ := oldPixel.RGBA() y := 0.299*float64(r) + 0.587*float64(g) + 0.114*float64(b) pixel := color.Gray{uint8(y / 256)} imgSet.Set(x, y, pixel) } } outFile, err := os.Create(""changed.jpg"") if err != nil { log.Fatal(err) } defer outFile.Close() jpeg.Encode(outFile, imgSet, nil)} .\rgbtogray.go:36: cannot use y (type uint32) as type int in argument to imgSet.Set",Converting RGBA image to Grayscale Golang
Golang -- Base64 string decode and save as file," This has been doing my head in and I hope someone can help. Please forgive me if it's a stupid question as I am very new to Go.I have a struct that has base64 in it. the struct looks like this: I want to take that base64 string, decode it and then save it, sounds simple right and it probably is, but I am struck.The code looks like this: Where do I go from here? I have tried so many things and I just keep getting errors all over the file.I have tried adapting code that people use for images, but I always crash and burn as the file isn't an image, it could be anythingThanks in advance. <code>  type UploadedFile struct { PartnerId string FileName string UploadDateTime string FileChecksum string FileBase64 string } decoder := json.NewDecoder(r.Body)uploadedFile := models.UploadedFile{}err := decoder.Decode(&uploadedFile)dec, _ := base64.StdEncoding.DecodeString(uploadedFile.FileBase64)",Base64 string decode and save as file
Go: Decreasing slice capacity," My question is about slice length and capacity. I'm learning about Go here: https://tour.golang.org/moretypes/11.(My question was marked as a possible duplicate of this; however, this is not the case. My question is specifically about the cutting off the first few elements of a slice and the implications of that.)Why does the line s = s[2:] decrease the capacity when s = s[:4] and s = s[:0] do not? The only difference I see is that there is a number before the colon in s = s[2:] while there is a number after the colon in the other two lines.Is there any way to recover the first two elements that we cut off with s = s[2:]? After clicking the Run button, we get the following. <code>  package mainimport ""fmt""func main() { s := []int{2, 3, 5, 7, 11, 13} printSlice(s) // Slice the slice to give it zero length. s = s[:0] printSlice(s) // Extend its length. s = s[:4] printSlice(s) // Drop its first two values. s = s[2:] printSlice(s)}func printSlice(s []int) { fmt.Printf(""len=%d cap=%d %v\n"", len(s), cap(s), s)} len=6 cap=6 [2 3 5 7 11 13]len=0 cap=6 []len=4 cap=6 [2 3 5 7]len=2 cap=4 [5 7]",Decreasing slice capacity
Serving css/js from external sources to html served by GO," In my html I'm trying to include JS using I have also tried relative path (from server location) and relative from the html file My file structure main.go is the server Am I missing something do I have to server css/js through server? or should the simple html work <code>  <script src=""/js/app.js""></script> <script src=""js/app.js""></script> -js app.js-templates index.htmlhub.gomain.go func main() { http.HandleFunc(""/"", rootHandler) http.ListenAndServe("":8080"", nil)}func rootHandler(w http.ResponseWriter, r *http.Request) { http.ServeFile(w, r, ""Templates/index.html"")}",Serve static files via http with go
Go: how to use bufio.ScanWords," How do I use bufio.ScanWords and bufio.ScanLines functions to count words and lines?I tried: Prints: Not sure what that means? <code>  fmt.Println(bufio.ScanWords([]byte(""Good day everyone""), false)) 5 [103 111 111 100] <nil>",How to use bufio.ScanWords
Golang: goroutine that takes a channel receiver and sends string to channel," I am trying to make a loop of goroutines that take a channel that receives strings, and every time it is received it should append the value to another string. Only at the end of all goroutines (the goroutine count should be the length of the list passed in), should the code continue on.My example below doesn't seem to append the values from the strReceiver channel onto str, because str is never modified.Anyone know what's wrong? <code>  func appendToStr(str string, list []string, origin *url.URL) { var currProc int32 = 0; var maxProc int32 = int32(len(list)) var strReceiver := make(chan string, len(list)) for _, item := range list { go func() { doAsyncAndIncrement(item, strReceiver, &currProc) str += <-strReceiver }() } for { if atomic.LoadInt32(&currProc) <= maxProc { break; } } // continue on using 'str' which now contains the append values from the 'strReceiver' channel}func doAsyncAndIncrement(item string, receiver chan<- string, count *int32) { defer atomic.AddInt32(count, 1) var val string // do something with 'item' and set 'val'... receiver <- val}",goroutine that takes a channel receiver and sends string to channel
How to `catch` a specific error in golang," For example, I am using one Go standard library function as: This function may return errors, and I just care about errors which report ""connection lost"" or ""connection refused"", then do some code to fix these.It seems like: What's more, how to get all the errors a specific standard library function may return? <code>  func Dial(network, address string) (*Client, error) client, err := rpc.Dial(""tcp"", "":1234"") if err == KindOf(ConnectionRefused) { // do something}",How to `catch` specific errors
Golang copying structure that contain pointers," TL;DRBecause of the downvotes and the lack of answers and the comments I assume a tl;dr is needed.How can I create a struct in golang, which contains a pointer, then safely pass it by value to other functions ? (By safely I mean without having to worry that those functions can dereference said pointer and change the variable its pointing to).ANDIf the answer you are going to give is ""Copy functions"" then how can I delete the original copy constructor/operator ? Override it with me custom copy function ? Or otherwise discourage people from using it ?In golang I can have a structure that contains a pointer to a dynamically allocated variable.I can also pass instances of those structures to functions that ""copy"" them. However, I cannot override or delete the built-in copy operator. This means that, in theory, I could have code like the following one: This type of code is obviously a bit nonsensical here. However, assuming the member field ""a"" was a complex structure it might stand within reason that a function accessing it will try and modify it.It might also stand within reason that once the function ""mutator"" is called the programmer might want to keep on using his instance of A and (assuming he didn't necessarily code the structure or was aware of its internals) might even assume that since he passed a copy rather than a pointer his instance of A will remain unchanged.Now, there are several (3) popular languages which allow the programmer to think about allocating and manipulating memory that aren't golang. I don't know Rust or C so I will refrain to how I would tackle this problem in C++:a) Assuming I was the designer of the class A I could build a copy constructor resulting in the following code: This allows an instance of my class to be copied with the added caveat that the pointer is also reassigned.b) Assuming I was the designer of class A and didn't want to build the copy constructor (say that whatever a points to might be very large or that A is often used in performance critical conditions as a read only object) yet wanted to make sure that any assignment to copy couldn't modify the value a is pointing to (but still allow people to modify a by assigning it to a new value) I could write my class like this: Which would make the following code to fail to compile: But the following code would compile just fine: Now, mind you, this is typical of C++'s ""Object Oriented"" (eegh) design. I for one would much prefer if I could have some sort of rule in the function signature that guaranteed no modification of the instance of A passed to it or a method by which to declare the instance of A ""const"" and ""guard"" its dynamically allocated fields (not only the static ones) against re-assignment.However, whilst the solution may not be perfect, it is a solution. It allows me to have a clear idea about the ""ownership"" of my instances of A.In golang, it appears that any ""copy"" of an instance that contains pointers is basically free for all, it can't be safely passed around even if the author of the struct had such an intention.The one thing I can think of is having a ""Copy"" method that return a brand new instance of the structure (similar to the Copy Constructor in the example above). But without the ability to delete the copy constructor/operator it would be hard to make sure people will use and/or notice it.To be honest it seems quite strange to me that golang even allows re-writing the memory address of a pointer without using the ""unsafe"" package or something similar. Wouldn't it make more sense to simply prohibit this type of operation much like many others are ?Considering the way ""append"" works it seems quite obvious that the intent of the authors is to favor re-assigning new variables to a pointer rather than mutating the one it previously pointed to. However, whilst this is easy to enforce with a built in structure like a slice or an array it seems quite hard to enforce with a custom struct (without, at least, wrapping said struct in a package).Am I overlooking a way to do copy construction (or prohibit copying) in golang ? Is it indeed the original intent of the authors to encourage re assignment rather than mutation when memory and time permit it ? If so why is it so easy to mutate dynamically allocated variables ? Is there a way to mimic private/public behavior with structs or files rather than full fledged packages ? Are there any other way to enforce some semblance of ownership with structs that have pointers which I am overlooking ?  <code>  import ( ""fmt"")type A struct { a * int}func main() { var instance A value := 14 instance.a = &value fmt.Println(*instance.a) // prints 14 mutator(instance) fmt.Println(*instance.a) // prints 11 o.o}func mutator(instance A) { *instance.a = 11 fmt.Println(*instance.a)} #include <iostream> class A { public: int * a; A(int value): a(new int{value}) {} A(const A & copyFrom): a(new int{*copyFrom.a}) {} }; void mutator(A instance) { *instance.a = 11; std::cout << *instance.a << ""\n""; } int main() { A instance{14}; std::cout << *(instance.a) << ""\n""; mutator(instance); std::cout << *instance.a << ""\n""; } class A {public: const int * a; A(int value): a(new const int{value}) {}}; void mutator(A instance) { *instance.a = 11; std::cout << *instance.a << ""\n"";}int main() { A instance{14}; std::cout << *(instance.a) << ""\n""; mutator(instance); std::cout << *instance.a << ""\n"";} void mutator(A instance) { instance.a = new const int{11}; std::cout << *instance.a << ""\n"";}int main() { A instance{14}; std::cout << *(instance.a) << ""\n""; mutator(instance); std::cout << *instance.a << ""\n"";}",Golang copying structures that contain pointers
Golang: Get Data from http.ResponseWriter for logging," I don't know if this question makes any sense, but I was wondering If there is any way to get the data which is written in http.ResponseWriter. I need it for logging.I have written an API in Go. The aim is to create a single log with request and response data. The response can be either an error response or processed response. I was thinking if I could get data which is written on http.ResponseWriter then, I can create single meaningful log. Is this possible? If not, please suggest how can I achieve this. <code>  func api1(w http.ResponseWriter, req *http.Request) { var requestData MyStruct err := json.NewDecoder(req.Body).Decode(&requestData) if err != nil { writeError(w, ""JSON request is not in correct format"") return } log.Println("" Request Data :"", req.Body) // I am logging req result, err := compute() // getting result from a function if err != nil { errRes := ErrorResponse{""ERROR"", err} response, er = json.Marshal(errRes) // getting error response } else { response, er = json.Marshal(result) } if er != nil { http.Error(w, er.Error(), 500) // writing error return } io.WriteString(w, string(response)) // writing response}",How to get data from http.ResponseWriter for logging
Truncate a file in golang," When truncating a file it seems to be adding additional zero bytes to the start: As a result the file has the contents I write with a section of 0 bytes at the beginning.How do I truncate and completely rewrite a file without having leading zeros? <code>  configFile, err := os.OpenFile(""./version.json"", os.O_RDWR, 0666)defer configFile.Close()check(err)//some actions happen hereconfigFile.Truncate(0)configFile.Write(js)configFile.Sync()",How do I truncate and completely rewrite a file without having leading zeros?
Go language: get permanent MAC address, Is there an easy way to get the permanent MAC Address using Go? <code> ,Get permanent MAC address
golang reflect - how to list out the method name in an interface type?," For example, What I am attempting to do is getting list [""Foo1"", ""Foo2""] using runtime reflection. <code>  type FooService interface { Foo1(x int) int Foo2(x string) string}",How to list out the method name in an interface type?
Cannot autocomplete with Go in Eclipse: Broken Pipe error," I am running Eclipse 4.6.3 with GoClipse and NodeClipse installed. I have configured Go in Preferences -> Go.I want autocomplete to work for Go. However, it is giving me the error: writing to process input broken pipeSee screenshots below for error and configuration.How do I fix this problem? <code> ",Error with autocomplete in Eclipse
How to check if []byte is zeros in go," Is there a way to check if a byte slice is empty or 0 without checking each element or using reflect? One solution which seems weird that I found was to keep an empty byte array for comparison. For sure there must be a better/quicker solution.ThanksUPDATE did some comparison for 1000 loops and the reflect way is the worst by far... <code>  theByteVar := make([]byte, 128)if ""theByteVar is empty or zeroes"" { doSomething()} theByteVar := make([]byte, 128)emptyByteVar := make([]byte, 128)// fill with anythingtheByteVar[1] = 2if reflect.DeepEqual(theByteVar,empty) == false { doSomething(theByteVar)} Equal Loops: 1000 in true in 19.197sContains Loops: 1000 in true in 34.507sAllZero Loops: 1000 in true in 117.275sReflect Loops: 1000 in true in 14.616277ms",How to check if []byte is all zeros in go
Why http.Client{} prefix a pointer &?," I am learning Go and I am reading Go's official documentation about net/http, and I write following code from doc for test: http.Client is a struct, but I do not know why there is a & pointer prefixed. I think creating a http.Client reference is not necessary. And why does the client variable have a Get method? I am reading the source code of net/http, it defines the Client struct below: The Client struct does not have a Get method defined; why does the client variable have a Get method? <code>  package mainimport ( ""net/http"" ""fmt"")func main() { client := &http.Client{} resp, _ := client.Get(""http://example.com"") fmt.Println(resp)} type Client struct { Transport RoundTripper CheckRedirect func(req *Request, via []*Request) error Jar CookieJar Timeout time.Duration}",Why is http.Client{} prefixed with &?
Covert base64 string to JPG Golang," I am getting the image as base64 string ( dataurl ), Below is my function that converts the dataurl into the image,Now if the image is png then png library will create the image and jpg library will throw an error and vice versa.Problem is when i upload png it works well but when i upload jpg file returns this error invalid JPEG format: missing SOI marker Input dataurl is: This might help <code>  func (ProfileController) SetProfilePic(w http.ResponseWriter, r *http.Request) { session, _ := session.UserSession.Get(r, ""mvc-user-session"") var fieldMapForBasic map[string]*json.RawMessage var f *os.File data, _ := ioutil.ReadAll(r.Body) json.Unmarshal(data, &fieldMapForBasic) image, _ := json.Marshal(fieldMapForBasic[""image""]) coI := strings.Index(string(image), "","") rawImage := string(image)[coI+1:] // Encoded Image DataUrl // unbased, _ := base64.StdEncoding.DecodeString(string(rawImage)) res := bytes.NewReader(unbased) path, _ := os.Getwd() // Path to store the image // newpath := filepath.Join(path + ""/storage"", strconv.Itoa(session.Values[""id""].(int))) os.MkdirAll(newpath, os.ModePerm) uid := uuid.NewV4() fmt.Println(newpath) // if image is png this function will create the image from dataurl string // pngI, errPng := png.Decode(res) if errPng == nil { f, _ = os.OpenFile(newpath + ""/"" + uid.String() + "".png"", os.O_WRONLY | os.O_CREATE, 0777) png.Encode(f, pngI) fmt.Println(""Png generated"") user := model.User{} user.ProfilePic = ""storage/"" + strconv.Itoa(session.Values[""id""].(int)) + ""/"" + uid.String() session.Values[""profile_pic""] = user.ProfilePic session.Save(r, w) database.Connection.Id(session.Values[""id""].(int)).Update(&user) } else { fmt.Println(errPng.Error()) } // If image is Jpg this will generate the Image // jpgI, errJpg := jpeg.Decode(res) if errJpg == nil { f, _ = os.OpenFile(newpath + ""/"" + uid.String() + "".jpg"", os.O_WRONLY | os.O_CREATE, 0777) jpeg.Encode(f, jpgI, &jpeg.Options{Quality: 75}) fmt.Println(""Jpg created"") } else { fmt.Println(errJpg.Error()) } defer func() { f.Close() }() render.Json(w, ""ok"")} ""data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/2wBDAAIBAQIBAQICAgICAgICAwUDAwMDAwYEBAMFBwYHBwcGBwcICQsJCAgKCAcHCg0KCgsMDAwMBwkODw0MDgsMDAz/2wBDAQICAgMDAwYDAwYMCAcIDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAz/wAARCADeAN4DASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwDtKKKK/cD8rCiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/Z""",Convert base64 string to JPG
Covert base64 string to JPG," I am getting the image as base64 string ( dataurl ), Below is my function that converts the dataurl into the image,Now if the image is png then png library will create the image and jpg library will throw an error and vice versa.Problem is when i upload png it works well but when i upload jpg file returns this error invalid JPEG format: missing SOI marker Input dataurl is: This might help <code>  func (ProfileController) SetProfilePic(w http.ResponseWriter, r *http.Request) { session, _ := session.UserSession.Get(r, ""mvc-user-session"") var fieldMapForBasic map[string]*json.RawMessage var f *os.File data, _ := ioutil.ReadAll(r.Body) json.Unmarshal(data, &fieldMapForBasic) image, _ := json.Marshal(fieldMapForBasic[""image""]) coI := strings.Index(string(image), "","") rawImage := string(image)[coI+1:] // Encoded Image DataUrl // unbased, _ := base64.StdEncoding.DecodeString(string(rawImage)) res := bytes.NewReader(unbased) path, _ := os.Getwd() // Path to store the image // newpath := filepath.Join(path + ""/storage"", strconv.Itoa(session.Values[""id""].(int))) os.MkdirAll(newpath, os.ModePerm) uid := uuid.NewV4() fmt.Println(newpath) // if image is png this function will create the image from dataurl string // pngI, errPng := png.Decode(res) if errPng == nil { f, _ = os.OpenFile(newpath + ""/"" + uid.String() + "".png"", os.O_WRONLY | os.O_CREATE, 0777) png.Encode(f, pngI) fmt.Println(""Png generated"") user := model.User{} user.ProfilePic = ""storage/"" + strconv.Itoa(session.Values[""id""].(int)) + ""/"" + uid.String() session.Values[""profile_pic""] = user.ProfilePic session.Save(r, w) database.Connection.Id(session.Values[""id""].(int)).Update(&user) } else { fmt.Println(errPng.Error()) } // If image is Jpg this will generate the Image // jpgI, errJpg := jpeg.Decode(res) if errJpg == nil { f, _ = os.OpenFile(newpath + ""/"" + uid.String() + "".jpg"", os.O_WRONLY | os.O_CREATE, 0777) jpeg.Encode(f, jpgI, &jpeg.Options{Quality: 75}) fmt.Println(""Jpg created"") } else { fmt.Println(errJpg.Error()) } defer func() { f.Close() }() render.Json(w, ""ok"")} ""data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/2wBDAAIBAQIBAQICAgICAgICAwUDAwMDAwYEBAMFBwYHBwcGBwcICQsJCAgKCAcHCg0KCgsMDAwMBwkODw0MDgsMDAz/2wBDAQICAgMDAwYDAwYMCAcIDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAz/wAARCADeAN4DASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwDtKKKK/cD8rCiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/Z""",Convert base64 string to JPG
Golang - best way to read data from Websockets," I'm learning Go (Golang) and had a project in mind. The project would be a web app that pulls in a data stream from a 3rd party websocket. At this point, I'm trying to get my Go project to read the web socket data so I can parse it.The 3rd party websocket is a data stream of JSON objects. So far I've been able to successfully listen to the websocket. However, I'm confused on how to best deal with this. Namely, the read method I'm using on the Websocket library is getting a slice of bytes. Which seems challenging to turn into JSON objects. Is there a better way to read the websocket - collecting the JSON objects? GoalMy goal is to listen to this public web socket, get json objects - which I can parse for a field of my desire which would then be pulled into a view (dynamically updating with the data stream.)If not, how can I convert the slice of bytes back to a JSON object? CodeHere's my code: <code>  package mainimport ( ""golang.org/x/net/websocket"" ""fmt"" ""log"")func main(){ origin := ""http://localhost/"" url := ""wss://ws-feed.gdax.com"" ws, err := websocket.Dial(url, """", origin) if err != nil { log.Fatal(err) } if _, err := ws.Write([]byte(`{""type"":""subscribe"", ""product_ids"":[""LTC-USD""]}`)); err != nil { log.Fatal(err) } var msg = make([]byte, 512) var n int for 1>0{ if n, err = ws.Read(msg); err != nil { log.Fatal(err) } fmt.Printf(""Received: %s.\n"", msg[:n]) }}",Best way to read data from Websockets
How can I fetch a certificate from a URL using Go?," I'm trying to find a function similar to Python's ssl.get_server_certificate(), which takes a hostname-port pair and returns a PEM-encoded certificate, but I haven't had any luck.I've done a fair bit of digging around, but the closest question I've found (Get remote ssl certificate in golang) did not help, nor did reading through the documentation for the package crypto/tls. I'm new to Go, so I may have not understood something in the documentation <code> ",How can I fetch a certificate from a URL?
How to format a duration in golang," I have the following code which I can't run on play because I use the gin framework and filewalk. What I want to do is a sorted output of files based on filext als filter and the modtime as sort criteria.I was able to fulfil the most part of the request but the output looks ugly as you can see below.I have used https://github.com/davidscholberg/go-durationfmt to format the duration but the output looks ugly or I missus the library. <code>  package mainimport ( ""fmt"" ""os"" ""path/filepath"" ""time"" ""regexp"" ""github.com/gin-gonic/gin"" ""sort"" ""strings"" ""github.com/davidscholberg/go-durationfmt"")var filext = regexp.MustCompile(`\.[mM][pP]4|\.[mM]4[vV]|\.jpg|\.[hH]264|\.go`)var m map[int]stringvar keys []intfunc main() { if gin.IsDebugging() { fmt.Print(""This progamm shows only the path and the age of a file in 'STARTDIR'\n"") fmt.Print(""only the following files will be handled '.[mM][pP]4|.[mM]4[vV$|.[hH]264|.go'\n"") fmt.Print(""The git repository: https://gitlab.com/aleks001/show-files-age \n"") } if len(os.Getenv(""LISTEN_IP_PORT"")) == 0 { fmt.Print(""I need a ip and port on which I should listen.\n"") os.Exit(1) } router := gin.Default() gin.DisableConsoleColor() router.GET(""/videoinfo"",getInfo) router.Run(os.Getenv(""LISTEN_IP_PORT""))}func getInfo(c *gin.Context) { loc, _ := time.LoadLocation(""Europe/Vienna"") var startdir = """" if os.Getenv(""STARTDIR"") != """" { startdir = os.Getenv(""STARTDIR"") } else if c.GetHeader(""STARTDIR"") != """" { startdir = c.GetHeader(""STARTDIR"") } else { c.String(404,""Startdir not found <br>\n"") return } m = make(map[int]string) keys = nil filepath.Walk(startdir,walkpath) for k := range m { keys = append(keys, k) } sort.Ints(keys) for _, k := range keys { t := time.Date(time.Now().Year(),time.Now().Month(),time.Now().Day(),time.Now().Hour(),k,time.Now().Second(),time.Now().Nanosecond(),loc) durStr, err := durationfmt.Format(time.Since(t), ""%h:%m"") if err != nil { fmt.Println(err) } else { //fmt.Println(durStr) fmt.Printf(""Key: %s Value: %s\n"", durStr , m[k]) c.String(200,""Minutes: %s File: %s\n"", durStr, m[k]) } }}func walkpath(path string, f os.FileInfo, err error) error { if err != nil { fmt.Println(err) } else { if filext.MatchString(path) { age := time.Now().Sub(f.ModTime()) path_new := strings.Replace(path,""/videos/"","""",1) // path_new := strings.Replace(path,""..\\"","""",1) /* fmt.Printf(""Path: %s, ModTime: %s, Age: %s <br>\n"", walker.Path(), walker.Stat().ModTime(), age) c.String(200,""Path: %s, ModTime: %s, Age: %s <br>\n"", walker.Path(), walker.Stat().ModTime(), age) */ fmt.Printf(""Path: %s, Age: %d age minutes %0.2f <br>\n"", path_new, age, age.Minutes()) m[int(age.Minutes())]=path_new //c.String(200,""Path: %s, Age: %0.2f <br>\n"", path, age.Minutes()) } //fmt.Printf(""%s with %d bytes at motime %s\n"", path,f.Size(), f.ModTime())} return nil} Minutes: 0:6 File: upload/dir003/file1.m4vMinutes: 0:5 File: transfer/dir5/file2.jpgMinutes: -5:-48 File: transfer/dir001/file.mp4Minutes: -6:-21 File: transfer/03.jpgMinutes: -6:-22 File: transfer/02.mp4",How to format a duration
Retrieve unstructered array from mongodb in golang," I have the following document in MongoDB I'm trying to get the groups into a comma separated string like group1,group2 but as much as I've tried I keep coming up against a brick wall.Closest I've got is as follows The seems to put the groups into a map but I then can't get the groups into a string. I'm fairly new to Go so I'm still learning the different data types and what syntax to use to access them.Thanks <code>  { ""_id"" : ObjectId(""57e4f8f454b9a4bb13a031d8""), ""ip"" : ""192.168.0.1"", ""browser"" : ""Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.1; WOW64; Trident/4.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729)"", ""datetime"" : ISODate(""2016-09-23T09:42:12.821Z""), ""userhash"" : ""BF12742F1B3A486F75E80843230168CE"", ""groups"" : [ ""group1"", ""group2"" ]} type Record struct { ID bson.ObjectId `bson:""_id""` IP string `bson:""ip""` Browser string `bson:""browser""` DateTime string `bson:""datetime""` Groups bson.M `bson:""groups,inline""`} result = []Record{}_ = c.Find(bson.M{}).All(&result)",Retrieve unstructured array from mongodb in golang
Golang - passing certificate and key as string to ListenAndServeTLS," I am creating an app using Go and I am trying to start a https server using the ListenAndServeTLS function. Here is my code: The thing is that I would like to embed my certificate and its key inside my executable file and then pass them to the the server.ListeAndServeTLS function as a string or a byte array. However this function does not take these types of arguments. Is there another way to do this?Note: I am aware that it is a bad practice to embed a private key inside a client application, however what I am trying to do here is just to create a config webpage that will be hosted as https://localhost:8080. <code>  func StartServer() { defer config.CapturePanic() c := config.GetInstance() serverAddress := fmt.Sprintf("":%s"", c.GetConfig().ServerPort) server := http.Server{Addr: serverAddress} log.Info(""Starting local server"") http.HandleFunc(""/"", login.Handler) http.HandleFunc(""/login"", login.Handler) http.HandleFunc(""/settings"", settings.Handler) //cert, _ := data.Asset(""my-cert.pem"") //key, _ := data.Asset(""my-key.pem"") err := server.ListenAndServeTLS(""my-cert.crt"", ""my-cert.key"") if err != nil { log.WithError(err).Fatal(""Error stopping local server"") }}",Passing certificate and key as string to ListenAndServeTLS
Golang | interface{} to []string," I'm trying to parse some YAML file into go struct, but the file itself can not be treated as ordinary go structure: some of values may be either string or map[string][]string.What I have tried is to do custom unmarshal func: My domain structure looks like this: But this code causes an error: So my question may sound like ""how to convert {}interface to []string?"" or it may become more complex: ""How to parse YAML file into go struct if some key can be either simple string or map[string][]string?""UPDATE:Responding to @mkopriva: Didnt help me, as now it just prints some integers (0), but there should be a string. Converting it to an array of strings throws another error: <code>  func (domain *Domain) UnmarshalYAML(unmarshal func(interface{}) error) error { fmt.Println(""Parsing domain"") var hostUrl interface{} unmarshal(&hostUrl) fmt.Println(reflect.TypeOf(hostUrl)) switch hostUrl.(type) { case string: domain.Host = hostUrl.(string) case map[interface {}]interface {}: fmt.Println(""got map"") v := reflect.ValueOf(hostUrl) fmt.Println(v.MapKeys()[0]) for _, host := range v.MapKeys() { domain.Host = host.Interface().(string) fmt.Println(v.MapIndex(host)) //HERE I NEED TO DO SMTH LIKE THIS: //domain.Urls = v.MapIndex(host).([]string) } default: return errors.New(""invalid config file, cant parse domains"") } return nil} type Domain struct { Host string Urls []string} invalid type assertion: v.MapIndex(host).([]string) (non-interface type reflect.Value on left) fmt.Println(v.MapIndex(host))for url := range v.MapIndex(host).Interface().([] interface{}) { fmt.Println(url)} panic: interface conversion: interface {} is []interface {}, not []string",interface{} to []string
Go | interface{} to []string," I'm trying to parse some YAML file into go struct, but the file itself can not be treated as ordinary go structure: some of values may be either string or map[string][]string.What I have tried is to do custom unmarshal func: My domain structure looks like this: But this code causes an error: So my question may sound like ""how to convert {}interface to []string?"" or it may become more complex: ""How to parse YAML file into go struct if some key can be either simple string or map[string][]string?""UPDATE:Responding to @mkopriva: Didnt help me, as now it just prints some integers (0), but there should be a string. Converting it to an array of strings throws another error: <code>  func (domain *Domain) UnmarshalYAML(unmarshal func(interface{}) error) error { fmt.Println(""Parsing domain"") var hostUrl interface{} unmarshal(&hostUrl) fmt.Println(reflect.TypeOf(hostUrl)) switch hostUrl.(type) { case string: domain.Host = hostUrl.(string) case map[interface {}]interface {}: fmt.Println(""got map"") v := reflect.ValueOf(hostUrl) fmt.Println(v.MapKeys()[0]) for _, host := range v.MapKeys() { domain.Host = host.Interface().(string) fmt.Println(v.MapIndex(host)) //HERE I NEED TO DO SMTH LIKE THIS: //domain.Urls = v.MapIndex(host).([]string) } default: return errors.New(""invalid config file, cant parse domains"") } return nil} type Domain struct { Host string Urls []string} invalid type assertion: v.MapIndex(host).([]string) (non-interface type reflect.Value on left) fmt.Println(v.MapIndex(host))for url := range v.MapIndex(host).Interface().([] interface{}) { fmt.Println(url)} panic: interface conversion: interface {} is []interface {}, not []string",interface{} to []string
Go - get the parent path, I am creating Go command-line app and I need to generate some stuff in the current directory (the directory which the user execute the commands from)to get the pwd I need to use but this give me path like and I need path like this which option I've in this case?Omit the last string after the / or there is better way in Go? <code>  os.Getwd() /Users/s05333/go/src/appcmd /Users/s05333/go/src/,Get the parent path
How to extend a golang interface to another interface?, I have a Go interface: Now I want another interface Student:1. But I don't want to write the duplicate function GetName and GetAge.Is there a way to avoid write GetName and GetAge in Student interface ? like: 2. <code>  type People interface { GetName() string GetAge() string} type Student interface { GetName() string GetAge() string GetScore() int GetSchoolName() string} type Student interface { People interface GetScore() int GetSchoolName() string},How to extend a Go interface to another interface?
Golang - How to assign a value to the empty slice after the declaration," I am trying to assign a value to the empty slice as follows. And it throws an exception, panic: runtime error: index out of rangeNote: I know one way of doing this by initializing the value at declaration part as follows. But in the above example I am trying to assign a value after the declaration. Is there a way to achieve this? <code>  func main() { var s []int fmt.Println(s, len(s), cap(s)) s[0] = 99} var s []int{99}",How to assign a value to the empty slice after the declaration
Geth ecrecover hash size mismatch," I'm trying to verify signature passed in from client using the geth golang library. I'm getting the sample data (signature / address) from one of my cryptokitties accounts (I can see it in the request). If I paste the blow credentials into https://etherscan.io/verifySig, it gets verified, so I know the parameters are correct.My code: I'm sure I'm missing something simple, but not really sure where to look. **UPDATEWhat I tried after looking around some answers: changing the message like this:fmt.Sprintf(""\u0019Ethereum Signed Message:\n%d%s"", len(data), data) //""\u0019Ethereum Signed Message:\n13Cryptokitties""hex encoding the message before hashing it:data=hexutil.Encode(data)combining the above two, so first prepending the 'Ethereum Signed Message', then hexencoding it.Any points would be appreciated, I'm sure this is a noob question.**UPDATELooking through the source code, I discovered its expecting recovery id to be greater than 4:sig[64] >= 4In my case it turns out to be 27:sig[64] --> 27 <code>  import ( ""github.com/ethereum/go-ethereum/common/hexutil"" ""github.com/ethereum/go-ethereum/crypto"")sig := 0x80f5bac5b6300ed64835d5e2f167a368c892ccc2d0e252bc84befbcb093f5a2d36294b95d86683cec778c8c796049933c04c71576c56c1d6e9a9fa10342beca31cdata := ""Cryptokitties""decoded = hexutil.MustDecode(sig) // j8aUTtPid0ZnNa/s4Ef5gisYYh1bCeLSmFrtJtDjNRRqxShUr+1A3BVgoAPwiZ+lKN0POB1JOdVhVHI9tcHmABs=hash := crypto.Keccak256([]byte(data)) // ""ljQQTm25oqIbD+LMl70aRUcTzXCeeDGfkRj9YJYsgKY=""pubKey, err := crypto.Ecrecover(hash, sig) // error: ""invalid signature recovery id""",Geth ecrecover invalid signature recovery id
Kubernetes: Find the available to RAM using GO API," I am using the Minikube environment and I have defined the max memory using Now I want to get this memory value using the Kubernetes API call in GO.I have tried the following, But the output is not in readable manner. <code>  $] minikube config set memory 2048 import ( ""k8s.io/client-go/kubernetes"" ""k8s.io/client-go/rest"")availableMem := kubernetes.Interface.StorageV1beta1().RESTClient().Get().Name(""config"")",Find the available RAM using GO API
Kubernetes: Find the available RAM using GO API," I am using the Minikube environment and I have defined the max memory using Now I want to get this memory value using the Kubernetes API call in GO.I have tried the following, But the output is not in readable manner. <code>  $] minikube config set memory 2048 import ( ""k8s.io/client-go/kubernetes"" ""k8s.io/client-go/rest"")availableMem := kubernetes.Interface.StorageV1beta1().RESTClient().Get().Name(""config"")",Find the available RAM using GO API
go - no test coverage when tests are in a different package," I have integration tests which are located in a separate directory. Those tests run my http server in the same process via net/http/httptest. My tests run but I get no coverage.Here is a very simplified example not using http for brevity.Directory layout: hello.go integration_test.go Run the test: Another attempt: Notice that coverage is 0%.According to go help testflag: How can I get the real coverage when my tests are in a different package? <code>  $GOPATH/src/go-test hello hello.go itest integration_test.go package hellofunc Hello() string { return ""hello""} package itestimport ( ""go-test/hello"" ""testing"")func TestHello(t *testing.T) { s := hello.Hello() if s != ""hello"" { t.Errorf(""Hello says %s"", s) }} $ go test -v -coverpkg ./... ./itest=== RUN TestHello--- PASS: TestHello (0.00s)PASScoverage: 0.0% of statements in ./...ok go-test/itest 0.001s coverage: 0.0% of statements in ./... $ go test -v -coverpkg all ./itest=== RUN TestHello--- PASS: TestHello (0.00s)PASScoverage: 0.0% of statements in allok go-test/itest 0.001s coverage: 0.0% of statements in all -coverpkg pattern1,pattern2,pattern3 Apply coverage analysis in each test to packages matching the patterns. The default is for each test to analyze only the package being tested. See 'go help packages' for a description of package patterns. Sets -cover. $ go versiongo version go1.10 linux/amd64",No test coverage when tests are in a different package
Iterating over linked list in C++ is slower than in Go (with analogous memory access)," In a variety of contexts I've observed that linked list iteration is consistently slower in C++ than in Go by 10-15%. My first attempt at resolving this mystery on Stack Overflow is here. The example I coded up was problematic because:1) memory access was unpredictable because of heap allocations, and 2) because there was no actual work being done, some people's compilers were optimizing away the main loop.To resolve these issues I have a new program with implementations in C++ and Go. The C++ version takes 1.75 secs compared to 1.48 secs for the Go version. This time, I do one large heap allocation before timing begins and use it to operate an object pool from which I release and acquire nodes for the linked list. This way the memory access should be completely analogous between the two implementations.Hopefully this makes the mystery more reproducible!C++: Go: Output: <code>  #include <iostream>#include <sstream>#include <fstream>#include <string>#include <vector>#include <boost/timer.hpp>using namespace std;struct Node { Node *next; // 8 bytes int age; // 4 bytes};// Object pool, where every free slot points to the previous free slottemplate<typename T, int n>struct ObjPool{ typedef T* pointer; typedef pointer* metapointer; ObjPool() : _top(NULL), _size(0) { pointer chunks = new T[n]; for (int i=0; i < n; i++) { release(&chunks[i]); } } // Giver an available pointer to the object pool void release(pointer ptr) { // Store the current pointer at the given address *(reinterpret_cast<metapointer>(ptr)) = _top; // Advance the pointer _top = ptr; // Increment the size ++_size; } // Pop an available pointer off the object pool for program use pointer acquire(void) { if(_size == 0){throw std::out_of_range("""");} // Pop the top of the stack pointer retval = _top; // Step back to the previous address _top = *(reinterpret_cast<metapointer>(_top)); // Decrement the size --_size; // Return the next free address return retval; } unsigned int size(void) const {return _size;}protected: pointer _top; // Number of free slots available unsigned int _size;};Node *nodes = nullptr;ObjPool<Node, 1000> p;void processAge(int age) { // If the object pool is full, pop off the head of the linked list and release // it from the pool if (p.size() == 0) { Node *head = nodes; nodes = nodes->next; p.release(head); } // Insert the new Node with given age in global linked list. The linked list is sorted by age, so this requires iterating through the nodes. Node *node = nodes; Node *prev = nullptr; while (true) { if (node == nullptr || age < node->age) { Node *newNode = p.acquire(); newNode->age = age; newNode->next = node; if (prev == nullptr) { nodes = newNode; } else { prev->next = newNode; } return; } prev = node; node = node->next; }}int main() { Node x = {}; std::cout << ""Size of struct: "" << sizeof(x) << ""\n""; // 16 bytes boost::timer t; for (int i=0; i<1000000; i++) { processAge(i); } std::cout << t.elapsed() << ""\n"";} package mainimport ( ""time"" ""fmt"" ""unsafe"")type Node struct { next *Node // 8 bytes age int32 // 4 bytes}// Every free slot points to the previous free slottype NodePool struct { top *Node size int}func NewPool(n int) NodePool { p := NodePool{nil, 0} slots := make([]Node, n, n) for i := 0; i < n; i++ { p.Release(&slots[i]) } return p}func (p *NodePool) Release(l *Node) { // Store the current top at the given address *((**Node)(unsafe.Pointer(l))) = p.top p.top = l p.size++}func (p *NodePool) Acquire() *Node { if p.size == 0 { fmt.Printf(""Attempting to pop from empty pool!\n"") } retval := p.top // Step back to the previous address in stack of addresses p.top = *((**Node)(unsafe.Pointer(p.top))) p.size-- return retval}func processAge(age int32) { // If the object pool is full, pop off the head of the linked list and release // it from the pool if p.size == 0 { head := nodes nodes = nodes.next p.Release(head) } // Insert the new Node with given age in global linked list. The linked list is sorted by age, so this requires iterating through the nodes. node := nodes var prev *Node = nil for true { if node == nil || age < node.age { newNode := p.Acquire() newNode.age = age newNode.next = node if prev == nil { nodes = newNode } else { prev.next = newNode } return } prev = node node = node.next }}// Linked list of nodes, in ascending order by agevar nodes *Node = nilvar p NodePool = NewPool(1000)func main() { x := Node{}; fmt.Printf(""Size of struct: %d\n"", unsafe.Sizeof(x)) // 16 bytes start := time.Now() for i := 0; i < 1000000; i++ { processAge(int32(i)) } fmt.Printf(""Time elapsed: %s\n"", time.Since(start))} clang++ -std=c++11 -stdlib=libc++ minimalPool.cpp -O3; ./a.outSize of struct: 161.7548go run minimalPool.goSize of struct: 16Time elapsed: 1.487930629s",Iterating over linked list in C++ is slower than in Go with analogous memory access
"Golang tls.Dial returns ""too many colons in address"""," I am trying to loop through an array of addresses, and check their tls cert status. I pieced together a program from various examples that do other things.My first step in processing is where 'url' is passed in from the array (I do import crypto/tls). Before I go on to pulling the cert, I check for errors: Here is a snippet of the array (with only test addresses for now): The first 2 return too many colons in addressI found a suggestion to fix that using the brackets. The next 2 addresses, with the brackets, return no such hostWhere is my error? <code>  conn, err := tls.Dial(""tcp"", url, nil) if err != nil { log.Printf(""Unable to get %q - %s\n"", url, err) return} var urls = []string{ ""https://google.com:443"", ""https://expired.badssl.com:443"", ""[https://wrong.host.badssl.com]:443"", ""[https://self-signed.badssl.com]:443""}","tls.Dial returns ""too many colons in address"""
Set int Pointer to int Value Golang," I'm very new to Go and am trying to set a *int to point to a number, say 12345. But it's giving me the following error: I see that the error is with the *guess = 12345 since 12345, but I'm not sure what's causing it. <code>  package mainimport ( ""fmt"" ""reflect"")func main() { var guess *int fmt.Println(reflect.TypeOf(guess)) *guess = 12345 fmt.Println(guess)} Type: *intpanic: runtime error: invalid memory address or nil pointer dereference[signal SIGSEGV: segmentation violation code=0x1 addr=0x0 pc=0x483c7d]goroutine 1 [running]:main.main() /home/aaron/projects/gopath/src/github.com/AaronNBrock/go-guess/main.go:16 +0x9dexit status 2",Set an int pointer to an int value in Go
Arrays in GO is by value?," Doing a test from above, it seems that arrays in Go are passed by value instead of reference. So can I conclude that there is no concept of shallow-copying nor deep-copying needed when dealing with such matter in Go? <code>  package mainimport ( ""fmt"")func main() { var a = [5]int{1,2,3,4,5} b := a b[4] = 100 fmt.Println(a,b) //[1 2 3 4 5] [1 2 3 4 100]}",Arrays in Go are by value?
golang - what is the default value of struct map, What is the default value of struct in a map? How to check the map value is initialized? Should I check against nil or someStruct{}? <code>  type someStruct struct { field1 int field2 string}var mapping map[int]someStructfunc main() { mapping := make(map[int]someStruct)}func check(key int) { if mapping[key] == ? {}},What is the default value of a map of struct
What is the default value of struct map, What is the default value of struct in a map? How to check the map value is initialized? Should I check against nil or someStruct{}? <code>  type someStruct struct { field1 int field2 string}var mapping map[int]someStructfunc main() { mapping := make(map[int]someStruct)}func check(key int) { if mapping[key] == ? {}},What is the default value of a map of struct
GoLang how to return a blank rune," I'm looking at the string.Map function which must take a mapping function which returns a rune. I would like to eliminate runes that resolves false with a call to: unicode.IsPrint()func Map(mapping func(rune) rune, s string) stringMy function looks something like this: It should clean something like this ""helloworld ' \x10"" to ""helloworld ' ""But rune('') is invalid. How can I return a blank or empty rune? <code>  func main() { func CleanUp(s string) string { clean := func(r rune) rune { if unicode.IsPrint(r) || r == rune('\n') { return r } return rune('') }strings.Map(clean, s)}",How to return a blank rune
Raw Go system call v.s. raw C system call," Go, and C both involve system calls directly (Technically, C will call a stub). Technically, write is both a system call and a C function (at least on many systems). However, the C function is just a stub which invokes the system call. Go does not call this stub, it invokes the system call directly, which means that C is not involved here From Differences between C write call and Go syscall.WriteMy benchmark shows, pure C system call is 15.82% faster than pure Go system call in the latest release (go1.11).What did I miss? What could be a reason and how to optimize them?Benchmarks:Go: C: 340 different running, each C running contains 500000 executions, and each Go running contains b.N executions (mostly 500000, few times executed in 1000000 times):T-Test for 2 Independent Means: The t-value is -22.45426. The p-value is < .00001. The result is significant at p < .05.T-Test Calculator for 2 Dependent Means: The value of t is 15.902782. The value of p is < 0.00001. The result is significant at p 0.05.Update: I managed the proposal in the answers and wrote another benchmark, it shows the proposed approach significantly drops the performance of massive I/O calls, its performance close to CGO calls.Benchmark: The above figure shows, 100 different running, each C running contains 500000 executions, and each Go running contains b.N executions (mostly 500000, few times executed in 1000000 times) <code>  package main_testimport ( ""syscall"" ""testing"")func writeAll(fd int, buf []byte) error { for len(buf) > 0 { n, err := syscall.Write(fd, buf) if n < 0 { return err } buf = buf[n:] } return nil}func BenchmarkReadWriteGoCalls(b *testing.B) { fds, _ := syscall.Socketpair(syscall.AF_UNIX, syscall.SOCK_STREAM, 0) message := ""hello, world!"" buffer := make([]byte, 13) for i := 0; i < b.N; i++ { writeAll(fds[0], []byte(message)) syscall.Read(fds[1], buffer) }} #include <time.h>#include <stdio.h>#include <unistd.h>#include <sys/socket.h>int write_all(int fd, void* buffer, size_t length) { while (length > 0) { int written = write(fd, buffer, length); if (written < 0) return -1; length -= written; buffer += written; } return length;}int read_call(int fd, void *buffer, size_t length) { return read(fd, buffer, length);}struct timespec timer_start(){ struct timespec start_time; clock_gettime(CLOCK_PROCESS_CPUTIME_ID, &start_time); return start_time;}long timer_end(struct timespec start_time){ struct timespec end_time; clock_gettime(CLOCK_PROCESS_CPUTIME_ID, &end_time); long diffInNanos = (end_time.tv_sec - start_time.tv_sec) * (long)1e9 + (end_time.tv_nsec - start_time.tv_nsec); return diffInNanos;}int main() { int i = 0; int N = 500000; int fds[2]; char message[14] = ""hello, world!\0""; char buffer[14] = {0}; socketpair(AF_UNIX, SOCK_STREAM, 0, fds); struct timespec vartime = timer_start(); for(i = 0; i < N; i++) { write_all(fds[0], message, sizeof(message)); read_call(fds[1], buffer, 14); } long time_elapsed_nanos = timer_end(vartime); printf(""BenchmarkReadWritePureCCalls\t%d\t%.2ld ns/op\n"", N, time_elapsed_nanos/N);} func BenchmarkReadWriteNetCalls(b *testing.B) { cs, _ := socketpair() message := ""hello, world!"" buffer := make([]byte, 13) for i := 0; i < b.N; i++ { cs[0].Write([]byte(message)) cs[1].Read(buffer) }}func socketpair() (conns [2]net.Conn, err error) { fds, err := syscall.Socketpair(syscall.AF_LOCAL, syscall.SOCK_STREAM, 0) if err != nil { return } conns[0], err = fdToFileConn(fds[0]) if err != nil { return } conns[1], err = fdToFileConn(fds[1]) if err != nil { conns[0].Close() return } return}func fdToFileConn(fd int) (net.Conn, error) { f := os.NewFile(uintptr(fd), """") defer f.Close() return net.FileConn(f)}",Go syscall v.s. C system call
Golang: does slice of string perform copy of underlying data?," I am trying to efficiently count runes from a utf-8 string using the utf8 library. Is this example optimal in that it does not copy the underlying data?https://golang.org/pkg/unicode/utf8/#example_DecodeRuneInString I found StringHeader in the (unsafe) reflect library. Is this the exact structure of a string in Go? If so, it is conceivable that slicing a string merely updates Data or allocates a new StringHeader altogether. Bonus: where can I find the code that performs string slicing so that I could look it up myself? Any of these?https://golang.org/src/runtime/slice.gohttps://golang.org/src/runtime/string.goThis related SO answer suggests that runtime-strings incur a copy when converted from string to []byte. <code>  func main() { str := ""Hello, "" // let's assume a runtime-provided string for len(str) > 0 { r, size := utf8.DecodeRuneInString(str) fmt.Printf(""%c %v\n"", r, size) str = str[size:] // performs copy? }} type StringHeader struct { Data uintptr Len int}",Does slice of string perform copy of underlying data?
Import full contents of package in Golang," I'm wondering if there is any way to import the full contents of a package so that I don't have to prefix calls to things in the package with a package name?For example, is there a way to replace this: with this: <code>  import ""fmt""func main() { fmt.Println(""Hello, world"")} import ""fmt""func main() { Println(""Hello, world"")}",Import everything from a package
use fmt.Printf to format string," I have this function: It's a little wonky... is there a way to format the string using fmt.Sprintf?Something like this: but without the need to pass v 4 times? <code>  func getTableCreationCommands(v string) string { return ` CREATE TABLE share_` + v + ` PARTITION OF share FOR VALUES IN (` + v + `); CREATE TABLE nearby_` + v + ` PARTITION OF nearby FOR VALUES IN (` + v + `); `} func getTableCreationCommands(v string) string { return fmt.Sprintf(` CREATE TABLE share_%v PARTITION OF share FOR VALUES IN (%v); CREATE TABLE nearby_%v PARTITION OF nearby FOR VALUES IN (%v); `, v, v, v, v)}",Refer to the same parameter multiple times in a fmt.Sprintf format string
use fmt.Sprintf to format string," I have this function: It's a little wonky... is there a way to format the string using fmt.Sprintf?Something like this: but without the need to pass v 4 times? <code>  func getTableCreationCommands(v string) string { return ` CREATE TABLE share_` + v + ` PARTITION OF share FOR VALUES IN (` + v + `); CREATE TABLE nearby_` + v + ` PARTITION OF nearby FOR VALUES IN (` + v + `); `} func getTableCreationCommands(v string) string { return fmt.Sprintf(` CREATE TABLE share_%v PARTITION OF share FOR VALUES IN (%v); CREATE TABLE nearby_%v PARTITION OF nearby FOR VALUES IN (%v); `, v, v, v, v)}",Refer to the same parameter multiple times in a fmt.Sprintf format string
"Gitlab CI - Auto DevOps job failed, Unable to select a buildpack"," My Gitlab CI Auto DevOps job failed with I've gone through Auto DevOps andGetting started with Auto DevOpsand am still not sure where I should put the buildpack. Mine should be heroku-buildpack-go, which I've lost track where I get that from. My repo consist only a single-character README.md, and the ""Hello, playground"" main.go.Conclusion:Thanks to David's comprehensive explanation, I was able to get DevOps started with correct buildpack: From this I would conclude that your single .go file at the root of the directory tree does not meet the activation criteria for auto-building Go projects. I'd suggest picking one of the dependency managers in the requirements above and modifying your project to support it. FTA, I just did touch go.mod then git add & git push and the AutoDevops started building my GO project indeed. However it seems to me that Gitlab AutoDevops is not able to build any GO projects very easily, as I get the following error (with project variable TRACE=true): The easier solution is to use .gitlab-ci.yml file instead, documented inhttps://blog.boatswain.io/post/build-go-project-with-gitlab-ci/(and followed up at Gitlab CI - Start Shared Runner for normal repos). <code>  Status: Downloaded newer image for gliderlabs/herokuish:latest -----> Unable to select a buildpackERROR: Job failed: exit code 1 ... !! The go.mod file for this project does not specify a Go version !! !! Defaulting to go1.11.1 !! !! For more details see: https://devcenter.heroku.com/articles/go-apps-with-modules#build-configuration !! -----> Installing go1.11.1-----> Fetching go1.11.1.linux-amd64.tar.gz... done !! Installing package '.' (default) !! !! To install a different package spec add a comment in the following form to your `go.mod` file: !! // +heroku install ./cmd/... !! !! For more details see: https://devcenter.heroku.com/articles/go-apps-with-modules#build-configuration !! -----> Running: go install -v -tags heroku . go: cannot determine module path for source directory /tmp/build (outside GOPATH, no import comments)ERROR: Job failed: exit code 1","Gitlab CI - Auto DevOps job failed, Unable to select a buildpack for a Go project?"
Golang map initialization," As far as I understand, types slice and map are similar in many ways in Go. They both reference (or container) types. In terms of abstract data types, they represent an array and an associative array, respectively.However, their behaviour is quite different. While we can use a declared slice immediately (append new items or reslice it), we cannot do anything with a newly declared map. We have to call make function and initialize a map explicitly. Therefore, if some struct contains a map we have to write a constructor function for the struct.So, the question is why it is not possible to add some syntatic sugar and both allocate and initialize the memory when declaring a map.I did google the question, learnt a new word ""avtovivification"", but still failing to see the reason.I am not talking about struct literal. Yes, you can explicitly initialize a map by providing values such as m := map[int]int{1: 1}. However, if you have some struct: It is not possible to use a struct immediately (with default values for all fields). One has to create a constructor function for SomeStruct which has to initialize a map explicitly. <code>  var s []intvar m map[int]int package mainimport ( ""fmt"")type SomeStruct struct { someField map[int]int someField2 []int}func main() { s := SomeStruct{} s.someField2 = append(s.someField2, -1) // OK s.someField[0] = -1 // panic: assignment to entry in nil map fmt.Println(s)}",Map initialization in Go
Error when trying to deploy Google cloud function in Go using go modules," I am having issues trying to deploy a Google cloud function in Go 1.11 using Go modules. I have have the following code structure in my GOPATH: the load/go.mod looks like the following: When I try to deploy the function using the command I get the following error: The commands go mod vendor and go mod verify run successfully locally and I can see my local package models in the vendor folder of load <code>  example models go.mod models.go load fn.go go.mod go.sum vendor .... module github.com/example/loadrequire ( github.com/example/models v0.0.0)replace github.com/example/models => ../models gcloud functions deploy load-data --entry-point GCSNewFileTrigger --runtime go111 --trigger-resource new_data --trigger-event google.storage.object.finalize Deploying function (may take a while - up to 2 minutes)...failed. ERROR: (gcloud.functions.deploy) OperationError: code=3, message=Build failed: go: parsing /models/go.mod: open /models/go.mod: no such file or directorygo: error loading module requirements",Error when trying to deploy Google cloud function in Go 1.11 using go modules
Go Modules - Multiple Modules within the same project," I've been playing with Go modules and I was wondering what the best practice is in terms of the following directory structure: I was having problems importing the players package into my root project at first, but I noticed I could do this in the root go.mod file This then allows me to do import ""github.com/<name>/players"" in my main.go file.Now this approach works and was taken from here but I'm not sure if that's the correct approach for this or whether this approach is just meant for updating a local package temporarily while it's outside version control.Another option, that seems a little overkill, is to make every module its own repository?TL;DR; - What's the best practice approach to having multiple modules within the same repository and importing them in in other modules / a root main.go file? <code>  project go.mod main.go players go.mod players.go players_test.go module github.com/<name>/<project>require ( github.com/<name>/players v0.0.0)replace github.com/<name>/players => ./players",Multiple modules within the same project
"Go - get error ""property value expected css"" and ""at-rule or selector expected css"" on vscode"," I'm using Go and package html/template. This is my code in mypage.tmpl: But I get errors in VSCode: property value expected css(css-property value expected)and at-rule or selector expected css(css-rule selector expected)when I try {{ }} in style html. <code>  <div class=""col-sm-1""> <i class='fas fa-square companies-color' style=""color: {{.Company.Color}}""></i></div>","Error ""property value expected css"" and ""at-rule or selector expected css"" editing Go template in VSCode"
"Get error ""property value expected css"" and ""at-rule or selector expected css"" on vscode"," I'm using Go and package html/template. This is my code in mypage.tmpl: But I get errors in VSCode: property value expected css(css-property value expected)and at-rule or selector expected css(css-rule selector expected)when I try {{ }} in style html. <code>  <div class=""col-sm-1""> <i class='fas fa-square companies-color' style=""color: {{.Company.Color}}""></i></div>","Error ""property value expected css"" and ""at-rule or selector expected css"" editing Go template in VSCode"
"(Zap log framework, Go) Initialize log once and reuse from other Go file"," I'm trying to migrate my application from the beautiful Logrus (very helpful for debug) and introducing the Uber log framework Zap.With Logrus, I can initialize the logger only once and reuse it from other Go file, an example: From other Go file, I'm able to reuse that logger without any other initialization: My question is: using the Zap log framework, how can I initialize the log in the main function and use that logger from the other Go file? <code>  package mainimport( // Print filename on log filename ""github.com/onrik/logrus/filename"" // Very nice log library log ""github.com/sirupsen/logrus"")func main(){// ==== SET LOGGING Formatter := new(log.TextFormatter) Formatter.TimestampFormat = ""Jan _2 15:04:05.000000000"" Formatter.FullTimestamp = true Formatter.ForceColors = true log.AddHook(filename.NewHook()) // Print filename + line at every log log.SetFormatter(Formatter)} // VerifyCommandLineInput is delegated to manage the inputer parameter provide with the input flag from command linefunc VerifyCommandLineInput() datastructures.Configuration { log.Debug(""VerifyCommandLineInput | Init a new configuration from the conf file"") c := flag.String(""config"", ""./conf/test.json"", ""Specify the configuration file."") flag.Parse() if strings.Compare(*c, """") == 0 { log.Fatal(""VerifyCommandLineInput | Call the tool using --config conf/config.json"") } file, err := os.Open(*c) if err != nil { log.Fatal(""VerifyCommandLineInput | can't open config file: "", err) } defer file.Close() decoder := json.NewDecoder(file) cfg := datastructures.Configuration{} err = decoder.Decode(&cfg) if err != nil { log.Fatal(""VerifyCommandLineInput | can't decode config JSON: "", err) } log.Debug(""VerifyCommandLineInput | Conf loaded -> "", cfg) return cfg}",How to initialize a zap logger once and reuse it in other Go files?
"(Zap log framework, Go) Initialize log once and reuse from other Go file (Solved)"," I'm trying to migrate my application from the beautiful Logrus (very helpful for debug) and introducing the Uber log framework Zap.With Logrus, I can initialize the logger only once and reuse it from other Go file, an example: From other Go file, I'm able to reuse that logger without any other initialization: My question is: using the Zap log framework, how can I initialize the log in the main function and use that logger from the other Go file? <code>  package mainimport( // Print filename on log filename ""github.com/onrik/logrus/filename"" // Very nice log library log ""github.com/sirupsen/logrus"")func main(){// ==== SET LOGGING Formatter := new(log.TextFormatter) Formatter.TimestampFormat = ""Jan _2 15:04:05.000000000"" Formatter.FullTimestamp = true Formatter.ForceColors = true log.AddHook(filename.NewHook()) // Print filename + line at every log log.SetFormatter(Formatter)} // VerifyCommandLineInput is delegated to manage the inputer parameter provide with the input flag from command linefunc VerifyCommandLineInput() datastructures.Configuration { log.Debug(""VerifyCommandLineInput | Init a new configuration from the conf file"") c := flag.String(""config"", ""./conf/test.json"", ""Specify the configuration file."") flag.Parse() if strings.Compare(*c, """") == 0 { log.Fatal(""VerifyCommandLineInput | Call the tool using --config conf/config.json"") } file, err := os.Open(*c) if err != nil { log.Fatal(""VerifyCommandLineInput | can't open config file: "", err) } defer file.Close() decoder := json.NewDecoder(file) cfg := datastructures.Configuration{} err = decoder.Decode(&cfg) if err != nil { log.Fatal(""VerifyCommandLineInput | can't decode config JSON: "", err) } log.Debug(""VerifyCommandLineInput | Conf loaded -> "", cfg) return cfg}",How to initialize a zap logger once and reuse it in other Go files?
go 1.10: cannot implicitly include runtime/cgo in a shared library," I'm trying to execute go build -buildmode=shared -linkshared test but I'm getting the error: I have only one file in that packagelib.go I'm on a linux machine running go1.10.4 linux/amd64 <code>  go 1.10: cannot implicitly include runtime/cgo in a shared library package testimport ""fmt""func Hello() { fmt.Println(""Hi"")}",go 1.10: cannot implicitly include runtime/cgo in a shared library
g 1.10: cannot implicitly include runtime/cgo in a shared library," I'm trying to execute go build -buildmode=shared -linkshared test but I'm getting the error: I have only one file in that packagelib.go I'm on a linux machine running go1.10.4 linux/amd64 <code>  go 1.10: cannot implicitly include runtime/cgo in a shared library package testimport ""fmt""func Hello() { fmt.Println(""Hi"")}",go 1.10: cannot implicitly include runtime/cgo in a shared library
How do you convert a Go struct to a different struct with less fields?," I am trying to copy a struct of type Big to type Small without explicitly creating a new struct of type Small with the same fields.I have tried searching for other similar problems such as this and this yet all the conversions between different struct types happen only if the structs have the same fields.Here is an example of what I tried to do: I expected to be able to do something like this, yet it does not work: Is there a way of converting between Big to Small (and maybe even vice-versa) without using a Convert function? <code>  // Big has all the fields that Small has including some new ones.type Big struct { A int B string C float D byte}type Small struct { A int B string}// This is the current solution which I hope to not use.func ConvertFromBigToSmall(big Big) Small { return Small{ A: big.A, B: big.B, }} big := Big{}small := Small(big)",How to convert a struct to a different struct with fewer fields
Serving a React app from a Go lang server," I have a simple React application I would like to serve from my Go server back end. I hear the process is similar to serving a static html file, but I just can't seem to get it to work.When I try to view the app on the browser it says ""This page isn't working"" and that ""localhost has redirected too many times""Here is the code where I am running the server locally as well as trying to handle the react application Here is the code for the index route I believe the solution is simple and that I am most likely making a small error somewhere. <code>  func main() {r := mux.NewRouter()// handle appbuildHandler := http.FileServer(http.Dir(""./client/build/index.html""))r.PathPrefix(""/"").Handler(buildHandler)staticHandler := http.StripPrefix(""/static/"", http.FileServer(http.Dir(""./client/build/static"")))r.PathPrefix(""/static/"").Handler(staticHandler)r.HandleFunc(""/"", index).Methods(""GET"")srv := &http.Server{ Handler: r, Addr: ""127.0.0.1:8080"", WriteTimeout: 15 * time.Second, ReadTimeout: 15 * time.Second,}// servefmt.Println(""Server started on PORT 8080"")log.Fatal(srv.ListenAndServe())} func index(w http.ResponseWriter, r *http.Request) { // not sure if this is necessary http.ServeFile(w, r, ""index.html"")}",How to serve React
Go - Use of internal package not allowed, I'm trying to build and run a repo (https://github.com/hyperledger/fabric/tree/master) but this error keeps popping up and still I haven't found a solution to this. This is just one of many files that give this error.I'm pretty sure I'm doing something wrong since this repo is suppose to be working.Go version : OS : Linux Mint 19.2 Cinnamon <code>  consensus.go:12:2: use of internal package github.com/hyperledger/fabric/internal/pkg/identity not allowed go version go1.13.5 linux/amd64,Use of internal package not allowed
gomodules: module declared as X but was required as Y," I'm trying to use grafana/grafana/pkg/tsdb package in my module. I don't think this problem is specific to grafana but here it goes: It says that the package tsdb is importing xorm as github.com/go-xorm/core, but the module declares itself as xorm.io/core.Looking at Grafana's go.mod file, it's using github.com/go-xorm/core and going to github.com/go-xorm/core, it says the project is now archived... and it's go.mod file indeed declared itself as xorm.io/core...and suggestions on how I can resolve this issue? <code>  $ go get -u github.com/grafana/grafana/pkg/tsdbgo: finding github.com/inconshreveable/log15 latestgo: finding github.com/go-macaron/session latestgo: finding golang.org/x/oauth2 latestgo: finding github.com/teris-io/shortid latestgo: github.com/grafana/grafana/pkg/tsdb imports github.com/go-xorm/core: github.com/go-xorm/core@v0.6.3: parsing go.mod: module declares its path as: xorm.io/core but was required as: github.com/go-xorm/core",Module declared as X but was required as Y
How to maitain proto files?," I've created 3 proto files and would like to keep it in a git repo:separated from all others files. The repository contains only .proto files. I have 3 microservices and each of them has their own repository that is using those proto files to communicate with each others:You can see on the picture above, that proto files are consuming from different microservices.Assume, I am going to change the Protofile2 and push the changes to proto repository, remember proto files repository are separated from microservices repository:When I run go test on service1 or service2, it should tell me, that Protofile2 has changed or does not have the same hash like proto file in the service2 folder:That I have to generate the code again.Does it exist any tools to solve the problem? Or how should I solve it? <code> ",How to Maintain Proto Files?
Unable to use type string as sql.NullString in golang when using gorm," I am creating a gorm model I am using sql.NullString for the field Something cause it may be NULL.So when I try to execute a typical gorm example to validate my setup works: I get: cannot use ""a string goes here"", (type string) as type sql.NullString in field valueWhat type should I use for the Something field given it may be NULL? <code>  // Day is a corresponding day entrytype Day struct { gorm.Model Dateday string `json:""dateday"" gorm:""type:date;NOT NULL""` Nameday string `json:""nameday"" gorm:""type:varchar(100);NOT NULL""` Something sql.NullString `json:""salad""` Holyday bool `json:""holyday""`} db.Create(&Day{ Nameday: ""Monday"", Dateday: ""23-10-2019"", Something: ""a string goes here"", Holyday: false, })",Unable to use type string as sql.NullString
Golang package name containing hyphen," I am having some trouble understanding that why my code complains when I have hyphen in package.e.g. if I have a package name foo-bar and I declare that package name Then why does the Go compiler complain? Does it mean we should not use hyphens in go package names?Since there are many repo that has use hyphen in package name, am I doing something wrong? <code>  package foo-barfoo-bar/config.go:1:13: expected ';', found '-'",Package name containing hyphen
Why does the go generated protobuf files contain mutex locks?," While working and generating protobuf stubs in go I stumbled upon this interesting issue.Whenever I try and copy a message's struct by value I get this warning:call of state.world.script.HandleEvent copies lock value: throne/server/messages.PlayerDialogeStatus contains google.golang.org/protobuf/internal/impl.MessageState contains sync.Mutex copylocksWhile I understand why copying a mutex lock by value is wrong, I started wondering why are they even there in the first place.And thus my question: Why does the go generated protobuf files contain mutex locks placed on the message structs, specifically on the MessageState struct?Or alternatively: What is the goal of the mutex lock placed in the MessageState struct found on generated protobuf message structs? <code> ",Why do the Go-generated protobuf files contain mutex locks?
Serve embedded filesystem from root path," Go 1.16 added the new embed package. I would like to use this package to embed a directory and serve it over HTTP. Consider the following setup: With this setup, my expectation is that I can point my browser to localhost:8080 and have it load index.html. What I am observing instead, is that I need to point my browser to localhost:8080/static to have it load index.html.How can an embedded filesystem be served from the root path of the URL? <code>  myproject/|-- main.go|-- static/| |-- index.html| |-- styles.css| |-- scripts.js package mainimport ( ""embed"" ""log"" ""net/http"")//go:embed staticvar staticFS embed.FSfunc main() { http.Handle(""/"", http.FileServer(http.FS(staticFS))) log.Fatal(http.ListenAndServe("":8080"", nil))}",Serve embedded filesystem from root path of URL
Errors running first Go project on local machine," I've installed the latest version of Go on my local machine, downloaded the source code from https://github.com/rrrkren/topshot-sales, and placed the project code in my GOPATH.When I run it go run go/main.go in my command prompt, I get these errors Even though the go.mod file is located in the current directory. I would like to be able to download this project and keep it on my local machine, so I can edit the source code whenever I want. How can I do that? <code>  go\main.go:8:2: no required module provides package github.com/onflow/flow-go-sdk/client: go.mod file not found in current directory or any parent directory; see 'go help modules'go\main.go:6:2: no required module provides package github.com/rrrkren/topshot-sales/topshot: go.mod file not found in current directory or any parent directory; see 'go help modules'go\main.go:9:2: no required module provides package google.golang.org/grpc: go.mod file not found in current directory or any parent directory; see 'go help modules'",Errors running the first Go project on the local machine
How to unit test the controller in golang?," I have a controller function like this.... QueryParam Struct is like this.. My test function is like this.. On running this test it is giving me the following error But when i comment out the c.BindQuery() line in my controller function it successfully run my test function. What i am doing wrong here? can i somehow mock the c.BindQuery function? <code>  func GetMaterialByFilter(c *gin.Context) { queryParam := weldprogs.QueryParam{} c.BindQuery(&queryParam) materialByFilter, getErr := services.WeldprogService.GetMaterialByFilter(&queryParam) if getErr != nil { //TODO : Handle user creation error c.JSON(getErr.Status, getErr) return } c.JSON(http.StatusOK, materialByFilter)} type QueryParam struct { Basematgroup_id []string `form:""basematgroup_id""` License_id []string `form:""license_id""` Diameter_id []string `form:""diameter_id""` Gasgroup_id []string `form:""gasgroup_id""` Wiregroup_id []string `form:""wiregroup_id""` Wiremat_id []string `form:""wiremat_id""`} func TestGetMaterialByFilter(t *testing.T) { w := httptest.NewRecorder() c, _ := gin.CreateTestContext(w) GetMaterialByFilter(c) assert.Equal(t, 200, w.Code) var got gin.H err := json.Unmarshal(w.Body.Bytes(), &got) if err != nil { t.Fatal(err) } fmt.Println(got) assert.Equal(t, got, got) } panic: runtime error: invalid memory address or nil pointer dereference [recovered] panic: runtime error: invalid memory address or nil pointer dereference[signal SIGSEGV: segmentation violation code=0x1 addr=0x10 pc=0x97f626]",How to unit test a Go Gin handler function?
