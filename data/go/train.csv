originalTitle,body,reformulatedTitle
How to use C++ in Go?," In the new Go language, how do I call C++ code? In other words, how can I wrap my C++ classes and use them in Go? <code> ",How to use C++ in Go
Does Google's go-language address the problems with languages addressed in Paul's Graham's post 'Why Arc isn't Especially Object Oriented'?, Does Google's Golang address the problems with languages addressed in Paul's Graham's post 'Why Arc isn't Especially Object Oriented'? <code> ,Does Google's go-language address the problems in Paul's Graham's post 'Why Arc isn't Especially Object Oriented'?
Go command line arguments," How do I nicely parse a list of program parameters and automate handling ""--help"" and/or ""--version"" (such as ""program [-d value] [--abc] [FILE1]"") in Go? <code> ",getopt-like behavior in Go
How can I make Go go when Go won't go?," I got Go to compile: and typed in the ""hello world"": Then I tried to compile it, but it wouldn't go: This is going on on Ubuntu Linux on Pentium. Go installed and passed its tests. So where did I go wrong? Can someone tell me where to go from here?I also tried this program: But this was also no go (must stop making go puns): <code>  0 known bugs; 0 unexpected bugs package mainimport ""fmt""func main() { fmt.Printf(""Hello, \n"")} $ 8c gotest2gotest2:1 not a functiongotest2:1 syntax error, last name: main package mainimport fmt ""fmt"" // Package implementing formatted I/O.func main() { fmt.Printf(""Hello, world; or ; or \n"");} $ 8c gotest3.gogotest3.go:1 not a functiongotest3.go:1 syntax error, last name: main",How can I compile a Go program?
Differences between Coroutines and GoTo???," I always read about the horrible thing that ""goto"" is. But today, reading about the Google programming language Go, I see that it suports Coroutines (Goroutines).The question is: Or Why? <code>  Coroutine == GoTo Coroutine != GoTo?",Differences between Coroutines and `goto`?
Differences between Coroutines and GoTo?," I always read about the horrible thing that ""goto"" is. But today, reading about the Google programming language Go, I see that it suports Coroutines (Goroutines).The question is: Or Why? <code>  Coroutine == GoTo Coroutine != GoTo?",Differences between Coroutines and `goto`?
"Go: ""variable declared and not used"" compilation error"," I am learning Google's new language Go. I am just trying stuff out and I noticedthat if you declare a variable and do not do anything with it the go compiler (8g in my case) fails tocompile with this error: hello.go:9: error declared and not used. I was suprised at this since most language compilers just warn you about unused variables but still compile.Is there anyway I can get around this? I checked the documentation for the compiler and I don't see anything that would change this behaviour. Is there a way to just delete error so that this will compile? <code>  package mainimport ""fmt""import ""os""func main(){ fmt.Printf(""Hello World\n""); cwd, error := os.Getwd(); fmt.Printf(cwd);}","""variable declared and not used"" compilation error"
Google Go integration with Protocol Buffers?," After a quick look at the documentation, I immediately started to think about integration with existing languages and applications and was wondering whether support would be provided for Protocol Buffers? <code> ",Go integration with Protocol Buffers?
What can you do in 30 lines of Go?," So, the big buzz in the last few days is Go, the new language from Google. Assuming you're all obsessive programming language geeks like me, you've all downloaded it, built it, and run your ""Hello, "" program (isn't it nice using a language written by the inventors of UTF-8?). You've all read the tutorial, Effective Go, and some of the other docs.Now, what are you going to do with it?I'd like to see some demos that show off the power of Go. What can you do in a brief program? Show off your best example code. While the true measure of a language can't really be taken until you've written and maintained a large codebase with a team of many programmers over the course of a project with changing requirements, seeing how much you can do in a limited amount of code does help to demonstrate the expressive power of a language. I'd like to see short, complete programs that truly exercise the unique new features of Go; not just snippets or ""Hello, World"".So, post some cool code you've written with Go. Take advantage of its unique features, like its goroutines and channels for concurrency, or its interface based type system. Can you write a primitive chat server, or cool IRC bot? Implement a parallel Mandelbrot set that scales to many cores? Write an interpreter for some tiny language? And can you do it all in 30 lines? I chose 30 arbitrarily as about as much as you can fit into a Stack Overflow code block without it overflowing and getting a scroll bar; it should be enough to do something interesting without golfing too much, but short enough to keep everyone's attention for a quick demo. For instance, with just a bit of reformatting, the example web server should be able to fit (not counting the data).Show us your Go code! <code> ","What can you do in 30 lines of Go? Can you create a useful, complete program that demonstrates its features?"
Has anyone created a vim syntax file for the go language?, Has anyone created a vim syntax file for the go language?  <code> ,Where can I find a Vim syntax file for the go language?
Concurrency: how does shared memory vs message passing handle large data structures?," In looking at Go and Erlang's approach to concurrency, I noticed that they both rely on message passing.This approach obviously alleviates the need for complex locks because there is no shared state.However, consider the case of many clients wanting parallel read-only access to a single large data structure in memory -- like a suffix array.My questions:Will using shared state be faster and use less memory than message passing, as locks will mostly be unnecessary because the data is read-only, and only needs to exist in a single location?How would this problem be approached in a message passing context? Would there be a single process with access to the data structure and clients would simply need to sequentially request data from it? Or, if possible, would the data be chunked to create several processes that hold chunks?Given the architecture of modern CPUs & memory, is there much difference between the two solutions -- i.e., can shared memory be read in parallel by multiple cores -- meaning there is no hardware bottleneck that would otherwise make both implementations roughly perform the same? <code> ",How does shared memory vs message passing handle large data structures?
What next generation low level language is the best bet to migrate the code base ?," Let's say you have a company running a lot of C/C++, and you want to start planning migration to new technologies so you don't end up like COBOL companies 15 years ago.For now, C/C++ runs more than fine and there is plenty dev on the market for it.But you want to start thinking about it now, because given the huge running code base and the data sensitivity, you feel it can take 5-10 years to move to the next step without overloading the budget and the dev teams. You have heard about D, starting to be quite mature, and Go, promising to be quite popular.What would be your choice and why? <code> ",What next generation low level language is the best bet when migrating a code base?
Go - How to read/write to file?," I've been trying to learn Go on my own, but I've been stumped on trying read from and write to ordinary files.I can get as far as inFile, _ := os.Open(INFILE, 0, 0), but actually getting the content of the file doesn't make sense, because the read function takes a []byte as a parameter. <code>  func (file *File) Read(b []byte) (n int, err Error)",How to read/write from/to a file using Go
How to read/write from/to file?," I've been trying to learn Go on my own, but I've been stumped on trying read from and write to ordinary files.I can get as far as inFile, _ := os.Open(INFILE, 0, 0), but actually getting the content of the file doesn't make sense, because the read function takes a []byte as a parameter. <code>  func (file *File) Read(b []byte) (n int, err Error)",How to read/write from/to a file using Go
How to read/write from/to file using golang?," I've been trying to learn Go on my own, but I've been stumped on trying read from and write to ordinary files.I can get as far as inFile, _ := os.Open(INFILE, 0, 0), but actually getting the content of the file doesn't make sense, because the read function takes a []byte as a parameter. <code>  func (file *File) Read(b []byte) (n int, err Error)",How to read/write from/to a file using Go
How to read/write from/to file using Go?," I've been trying to learn Go on my own, but I've been stumped on trying read from and write to ordinary files.I can get as far as inFile, _ := os.Open(INFILE, 0, 0), but actually getting the content of the file doesn't make sense, because the read function takes a []byte as a parameter. <code>  func (file *File) Read(b []byte) (n int, err Error)",How to read/write from/to a file using Go
Iterating over all the keys of a golang map.," Is there a way to get a list of all the keys in a Go language map? The number of elements is given by len(), but if I have a map like: How do I iterate over all the keys? <code>  m := map[string]string{ ""key1"":""val1"", ""key2"":""val2"" };",Iterating over all the keys of a map
Iterating over all the keys of a Golang map," Is there a way to get a list of all the keys in a Go language map? The number of elements is given by len(), but if I have a map like: How do I iterate over all the keys? <code>  m := map[string]string{ ""key1"":""val1"", ""key2"":""val2"" };",Iterating over all the keys of a map
Learn Go Or Improve My Python Knowledge," I was reading about Go, and I can see that it's very good and can be a language used by many developers in some months, but I want to decide a simple thing: Learn Go or improve my Python or Ruby knowledge?Years developing with Python: 1Years developing with Ruby: 0.3 <code> ",Learn Go Or Improve My Python/Ruby Knowledge
Optional Parameters?, Can Go have optional parameters? Or can I just define two functions with the same name and a different number of arguments? <code> ,Optional Parameters in Go?
How to test key existence in a map?," I know I can iterate over a map m by, and look for a key but is there a more efficient way of testing a key's existence in a map? I couldn't find the answer in the language spec. <code>  for k, v := range m { ... }",How to check if a map contains a key in Go?
How to check if a map contains a key in go?," I know I can iterate over a map m by, and look for a key but is there a more efficient way of testing a key's existence in a map? I couldn't find the answer in the language spec. <code>  for k, v := range m { ... }",How to check if a map contains a key in Go?
What is the point of slice type in go (language), I have read this but still not fully aware of the advantage of slice against array.So I am expecting somebody in SO explain better than it and I am sure you can :) <code> ,What is the point of slice type in Go?
Sizeof struct in GO," I'm having a look at Go, which looks quite promising.I am trying to figure out how to get the size of a go struct, forexample something like Of course I know that it's 24 bytes, but I'd like to know it programmatically..Do you have any ideas how to do this ? <code>  type Coord3d struct { X, Y, Z int64}",Sizeof struct in Go
"To use package properly , how to arrange directory, file name, unit test file?"," My source files tree is like this: Inside foo.go: inside foo_test.go: My questions are:Does package name relates to directory name, source file name?If there is only one source file for a package, need I put it in a directory?Should I put foo.go and foo_test.go in the same package?In the foo_test.go, as it's in the same package as foo.go, I didn't import foo. But when I compile foo_test.go with 6g, it says bar() is undefined. What should I do? <code>  /src /pkg /foo foo.go foo_test.go package foofunc bar(n int) { ...} package foofunc testBar(t *testing.T) { bar(10) ...}","To use package properly, how to arrange directory, file name, unit test file?"
Using Google's Go Language to Write a Library for an iPhone App," I'm considering using Go as a low-level, performant language alternative to C/Objective-C to implement a library for an iPhone App. Could either of the Go compilers generate a library that could be linked into a native iPhone app with the Go runtime, etc.? Is there an ARM port for Go or does gccgo/gcc support this? I imagine that since gccgo uses gcc as the back-end and Xcode uses gcc to compile iPhone apps that there is a strong chance that this is possible. If it's possible, how would I set that up in an Xcode project?Has anyone tried this or seen it discussed before? (When I do a Google search like ""compiling go code iphone"" the ""go"" part is completely unused and I get only stuff about iPhone development.) <code> ",Using Go to write a library for an iPhone app
Why is go language so slow?," As we could see from The Computer Language Benchmarks Game in 2010:Go is on average 10x slower than C Go is 3x slower than Java !?How can this be, bearing in mind that Go compiler produces native code for execution?Immature compilers for Go? Or there is some intrinsic problem with the Go language?EDIT:Most answers deny intrinsic slowness of Go languge, claiming the problem resides in immature compilers.Therefore I've made some own tests to calculate Fibonacci numbers: Iterative algorithm runs in Go (freebsd,6g) with the same speed as in C (with O3 option). The dull recursive one runs in Go 2 times slower than in C (with -O3 option; with -O0 - the same). But I haven't seen 10x fall as in the Benchmarks Game. <code> ",Why is Go so slow (compared to Java)?
How to pass arguments to Go program?," How do I access command-line arguments in Go? They're not passed as arguments to main. A complete program, possibly created by linking multiple packages, must have one package called main, with a function defined. The function main.main() takes no arguments and returns no value.  <code>  func main() { ... }",How to access command-line arguments passed to a Go program?
Go : Access to another struct by value or by pointer, What difference there is when you access to another struct by value or by a pointer?When should be used each one of them? <code>  type foo_ struct { st uint8 nd uint8}type bar struct { rd uint8 foo foo_}type barP struct { rd uint8 foo *foo_},Access to another struct by value or by pointer
Go - Access to another struct by value or by pointer, What difference there is when you access to another struct by value or by a pointer?When should be used each one of them? <code>  type foo_ struct { st uint8 nd uint8}type bar struct { rd uint8 foo foo_}type barP struct { rd uint8 foo *foo_},Access to another struct by value or by pointer
can anybody suggest go-lang container for simple and fast FIFO stack," Can anyone suggest Go container for simple and fast FIF/queue, Go has 3 different containers: heap, list and vector. Which one is more suitable to implement a queue? <code> ",Is there a queue implementation?
Queue implementation in golang," Can anyone suggest Go container for simple and fast FIF/queue, Go has 3 different containers: heap, list and vector. Which one is more suitable to implement a queue? <code> ",Is there a queue implementation?
Queue implementation in Golang," Can anyone suggest Go container for simple and fast FIF/queue, Go has 3 different containers: heap, list and vector. Which one is more suitable to implement a queue? <code> ",Is there a queue implementation?
Go - Raise an exception," I would want to raise an exception as it's made in Python or Java --to finish the program with an error message--.An error message could be returned to a parent function: but I want that it can be finished when the error is found. Would be correct the next one? <code>  func readFile(filename string) (content string, err os.Error) { content, err := ioutil.ReadFile(filename) if err != nil { return """", os.ErrorString(""read "" + filename + "": "" + err) } return string(content), nil} func readFile(filename string) (content string) { content, err := ioutil.ReadFile(filename) defer func() { if err != nil { panic(err) } }() return string(content)}",Raise an exception
Is it possible to include inline assembly in Google Go code?," Is it possible to include inline assembly in Go code?This blog post shows compiling Go to a separate .s file and editing it, but not inline asm as part of a Go function like many C compilers support. <code> ",Is it possible to include inline assembly in Go code?
Why does Go compile quickly?," I've Googled and poked around the Go website, but I can't seem to find an explanation for Go's extraordinary build times. Are they products of the language features (or lack thereof), a highly optimized compiler, or something else? I'm not trying to promote Go; I'm just curious. <code> ",How does Go compile so quickly?
Why does Go compile so quickly?," I've Googled and poked around the Go website, but I can't seem to find an explanation for Go's extraordinary build times. Are they products of the language features (or lack thereof), a highly optimized compiler, or something else? I'm not trying to promote Go; I'm just curious. <code> ",How does Go compile so quickly?
How to implement a simple queue properly?," The current Go library doesn't provide the queue container.To implement a simple queue, I use circle array as the underlying data structure.It follows algorithms mentioned in TAOCP: Following is the code: But the output is obviously wrong:1 true2 true3 true4 true5 true6 true7 true8 true9 true10 false11 true12 true11 true12 true0 false0 false0 false0 false0 false0 false0 false0 false0 false0 falseI think I need one more field to make the code work properly.What do you suggest?The improved code has a small shortcoming: an array of size n can contain only n-1 elements. <code>  Insert Y into queue X: X[R]<-Y; R<-(R+1)%M; if R=F then OVERFLOW.Delete Y from queue X: if F=R then UNDERFLOW; Y<-X[F]; F<-(F+1) % M.F: Front, R: Rear, M: Array length. package mainimport ( ""fmt"")type Queue struct { len int head, tail int q []int}func New(n int) *Queue { return &Queue{n, 0, 0, make([]int, n)} }func (p *Queue) Enqueue(x int) bool { p.q[p.tail] = x p.tail = (p.tail + 1) % p.len return p.head != p.tail}func (p *Queue) Dequeue() (int, bool) { if p.head == p.tail { return 0, false } x := p.q[p.head] p.head = (p.head + 1) % p.len return x, true}func main() { q := New(10) for i := 1; i < 13; i++ { fmt.Println(i, q.Enqueue(i)) } fmt.Println() for i := 1; i < 13; i++ { fmt.Println(q.Dequeue()) } } package mainimport ( ""fmt"")type Queue struct { len int head, tail int q []int}func New(n int) *Queue { return &Queue{n, 0, 0, make([]int, n)} }func (p *Queue) Enqueue(x int) bool { p.q[p.tail] = x ntail := (p.tail + 1) % p.len ok := false if ntail != p.head { p.tail = ntail ok = true } return ok}func (p *Queue) Dequeue() (int, bool) { if p.head == p.tail { return 0, false } x := p.q[p.head] p.head = (p.head + 1) % p.len return x, true}func main() { q := New(10) for i := 1; i < 13; i++ { fmt.Println(i, q.Enqueue(i)) } fmt.Println() for i := 1; i < 13; i++ { fmt.Println(q.Dequeue()) } }",How to implement a queue in Go?
Problem using json in Golang (Go)," I am using json to store data on disk between program calls, the program runs fine for some time, but after that it displays error in json decoding, ""invalid character '1' after top-level value "". Can anyone suggest some solution to this problem ? <code> ","""invalid character '1' after top-level value "" unmarshaling JSON"
What language is the Go programming language written in?, I think the title is self explanatory. <code> ,What language is the compiler of Go programming language written in?
Debugging a program written in the go language.," How do I debug a Go program? I have been using the Gedit Go IDE, but it doesn't have debugging. Is there a way to step though my code and inspect memory? Or am I stuck with print statements? Can I use OutputDebugString? <code> ",How do I debug a program written in the Go language?
Are there any go librarys that provide associative array capability?," I'm looking for a go language capability similar to the ""dictionary"" in python to facilitate the conversion of some python code.EDIT: Maps worked quite well for this de-dupe application. I was able to condense 1.3e6 duplicated items down to 2.5e5 unique items using a map with a 16 byte string index in just a few seconds. The map-related code was simple so I've included it below. Worth noting that pre-allocation of map with 1.3e6 elements sped it up by only a few percent: <code>  var m = make(map[string]int, 1300000) // map with initial space for 1.3e6 elementsct, ok := m[ax_hash]if ok { m[ax_hash] = ct + 1} else { m[ax_hash] = 1}",Are there any go libraries that provide associative array capability?
"What does the asterisk do in ""Go""."," I'm a web developer looking to expand my horizons in order to get better at programming as a whole. I've done a bit Java and some simple Android applications. I'm now looking into lower level languages like C and Go (which I must say has some beautiful syntax and great ideas thus far, though I'm maybe too inexperienced to comment).So yeah I've been going through and trying to understand the examples on the Go website and I keep coming across a special asterisk character in examples like this: Also, I just noticed, what's with the &s? Is it assignment by reference (I might be using PHP talk here)?  <code>  s := ""hello""if s[1] != 'e' { os.Exit(1)}s = ""good bye""var p *string = &s*p = ""ciao""","What does the asterisk do in ""Go""?"
"What does the asterisk do in ""Go"""," I'm a web developer looking to expand my horizons in order to get better at programming as a whole. I've done a bit Java and some simple Android applications. I'm now looking into lower level languages like C and Go (which I must say has some beautiful syntax and great ideas thus far, though I'm maybe too inexperienced to comment).So yeah I've been going through and trying to understand the examples on the Go website and I keep coming across a special asterisk character in examples like this: Also, I just noticed, what's with the &s? Is it assignment by reference (I might be using PHP talk here)?  <code>  s := ""hello""if s[1] != 'e' { os.Exit(1)}s = ""good bye""var p *string = &s*p = ""ciao""","What does the asterisk do in ""Go""?"
Why no generics in go?," Disclaimer: I've only played with Go for one day now, so there's a good chance I've missed a lot.Does anybody know why there is no real support for generics/templates/whatsInAName in Go? So there is a generic map, but that's supplied by the compiler, while a Go programmer can't write her own implementation. With all the talk about making Go as orthogonal as possible, why can I USE a generic type but not CREATE a new one?Especially when it comes to functional programming, there are lambdas, even closures, but with a static type system lacking generics, how do I write, well, generic higher order functions like filter(predicate, list)? OK, Linked lists and the like can be done with interface{} sacrificing type safety.As a quick search on SO / Google did not reveal any insights, it looks like generics, if at all, will be added to Go as an afterthought. I do trust Thompson to do way better than the Java guys, but why keep generics out? Or are they planned and just not implemented yet? <code> ",Why no generics in Go?
How can we use channels in Google Go in place of mutex?," Channels combine communicationthe exchange of a valuewith synchronizationguaranteeing that two calculations (goroutines) are in a known state.How is it possible to use the channels in Google Go to perform the functionality of mutex? <code>  package mainimport ""sync""var global int = 0var m sync.Mutexfunc thread1(){ m.Lock() global = 1 m.Unlock()}func thread2(){ m.Lock() global = 2 m.Unlock()}func main(){ go thread1() go thread2()}",How can we use channels in Go in place of mutex?
What does it mean : 'systems language'?," The Go talk 2009 pdf has a comment to explain why they came up with the go language : What's the meaning of systems language?Is it a language that is supposed to run on target system by generating native binary?Is it a language that can build operating system on its own? I can see C#/Java is `not' a systems language, and C/C++ is. <code>  No new major systems language in a decade.",What does it mean by a  'systems language'?
Equivalent in Go to a C++ vector<int>?," I'm writing a function that returns a sequence of numbers of variable length: It can be observed that the final length of the returned sequence will be n. How and what should fib return to achieve idiomatic Go? If the length was not known in advance, how would the return value, and usage differ? How do I insert values into retval? <code>  func fib(n int) ??? { retval := ??? a, b := 0, 1 for ; n > 0; n-- { ??? // append a onto retval here c := a + b a = b b = c }}",Returning the lenght of a vector idiomatically
Calling Go from C code?, How does one call Go code in C from threads that weren't created by Go? What do I assign to a C function pointer such that threads not created by Go can call that pointer and enter into Go code?Update0I don't want to use SWIG.The callbacks will be coming from threads Go hasn't seen before. Neither cgo/life nor anything in pkg/runtime demonstrates this behaviour AFAICT. <code> ,C callbacks and non-Go threads
printing quotes in Go," is it possible to print back quotes in Go using back quotes : something like this: <code>  package mainimport ""fmt""func main() { fmt.Println(```) // for example I can do it with double quotes ""\""""}",how to put a backquote in a backquoted string?
how to initialize members in go struct," I am new to Golang so allocation in it makes me insane: and later, I just call: At this moment I get a nil pointer panic. I've worked around it by using another one function, and calling it right after new(): But I wonder, if it's possible to get rid of this boilerplate initializing? <code>  import ""sync""type SyncMap struct { lock *sync.RWMutex hm map[string]string}func (m *SyncMap) Put (k, v string) { m.lock.Lock() defer m.lock.Unlock() m.hm[k] = v, true} sm := new(SyncMap)sm.Put(""Test, ""Test"") func (m *SyncMap) Init() { m.hm = make(map[string]string) m.lock = new(sync.RWMutex)}",How to initialize members in Go struct
simultaneous assignment in GO," I'm learning Go and can't understand one thing, why creators of this language do support simultaneous assignment? It is very easy to make mistakes like a, b = a, b and not a, b = b, a, as I would want, thanks in advance for any good explanations.  <code> ",Simultaneous assignment in Go
googe go equivalent of java finalize method," Is there any method like java finalize in Go? If I've a type struct like How can I make sure that when Object is garbage collected, the file is closed? <code>  type Foo struct { f *os.File .... }func (p *Foo) finalize() { p.f.close( ) }",Equivalent of java finalize method
google go equivalent of java finalize method," Is there any method like java finalize in Go? If I've a type struct like How can I make sure that when Object is garbage collected, the file is closed? <code>  type Foo struct { f *os.File .... }func (p *Foo) finalize() { p.f.close( ) }",Equivalent of java finalize method
Go - Using a container/heap to implement a priority queue," In the big picture, I'm trying to implement Dijkstra's algorithm using a priority queue. According to members of golang-nuts, the idiomatic way to do this in Go is to use the heap interface with a custom underlying data structure. So I have created Node.go and PQueue.go like so: And PQueue.go: And main.go: (the action is in SolveMatrix) The problem is, upon compiling i get the error message: And commenting out the line PQ.Push(firstNode) does satisfy the compiler. But I don't understand why I'm getting the error message in the first place. Push doesn't modify the argument in any way. UPDATE:For the sake of those who come across this in searches in the future, the code above is chock full of gross misconceptions. Take a look below for a much more useful template to work off of:Node.go: PQueue.go: <code>  //Node.gopackage pqueuetype Node struct { row int col int myVal int sumVal int}func (n *Node) Init(r, c, mv, sv int) { n.row = r n.col = c n.myVal = mv n.sumVal = sv}func (n *Node) Equals(o *Node) bool { return n.row == o.row && n.col == o.col} // PQueue.gopackage pqueueimport ""container/vector""import ""container/heap""type PQueue struct { data vector.Vector size int}func (pq *PQueue) Init() { heap.Init(pq)}func (pq *PQueue) IsEmpty() bool { return pq.size == 0}func (pq *PQueue) Push(i interface{}) { heap.Push(pq, i) pq.size++}func (pq *PQueue) Pop() interface{} { pq.size-- return heap.Pop(pq)}func (pq *PQueue) Len() int { return pq.size}func (pq *PQueue) Less(i, j int) bool { I := pq.data.At(i).(Node) J := pq.data.At(j).(Node) return (I.sumVal + I.myVal) < (J.sumVal + J.myVal)}func (pq *PQueue) Swap(i, j int) { temp := pq.data.At(i).(Node) pq.data.Set(i, pq.data.At(j).(Node)) pq.data.Set(j, temp)} // Euler 81package mainimport ""fmt""import ""io/ioutil""import ""strings""import ""strconv""import ""./pqueue""const MATSIZE = 5const MATNAME = ""matrix_small.txt""func main() { var matrix [MATSIZE][MATSIZE]int contents, err := ioutil.ReadFile(MATNAME) if err != nil { panic(""FILE IO ERROR!"") } inFileStr := string(contents) byrows := strings.Split(inFileStr, ""\n"", -1) for row := 0; row < MATSIZE; row++ { byrows[row] = (byrows[row])[0 : len(byrows[row])-1] bycols := strings.Split(byrows[row], "","", -1) for col := 0; col < MATSIZE; col++ { matrix[row][col], _ = strconv.Atoi(bycols[col]) } } PrintMatrix(matrix) sum, len := SolveMatrix(matrix) fmt.Printf(""len: %d, sum: %d\n"", len, sum)}func PrintMatrix(mat [MATSIZE][MATSIZE]int) { for r := 0; r < MATSIZE; r++ { for c := 0; c < MATSIZE; c++ { fmt.Printf(""%d "", mat[r][c]) } fmt.Print(""\n"") }}func SolveMatrix(mat [MATSIZE][MATSIZE]int) (int, int) { var PQ pqueue.PQueue var firstNode pqueue.Node var endNode pqueue.Node msm1 := MATSIZE - 1 firstNode.Init(0, 0, mat[0][0], 0) endNode.Init(msm1, msm1, mat[msm1][msm1], 0) if PQ.IsEmpty() { // make compiler stfu about unused variable fmt.Print(""empty"") } PQ.Push(firstNode) // problem return 0, 0} [~/Code/Euler/81] $ make6g -o pqueue.6 Node.go PQueue.go6g main.gomain.go:58: implicit assignment of unexported field 'row' of pqueue.Node in function argumentmake: *** [all] Error 1 // Node.gopackage pqueueimport ""fmt""type Node struct { row int col int myVal int sumVal int parent *Node}func NewNode(r, c, mv, sv int, n *Node) *Node { return &Node{r, c, mv, sv, n}}func (n *Node) Eq(o *Node) bool { return n.row == o.row && n.col == o.col}func (n *Node) String() string { return fmt.Sprintf(""{%d, %d, %d, %d}"", n.row, n.col, n.myVal, n.sumVal)}func (n *Node) Row() int { return n.row}func (n *Node) Col() int { return n.col}func (n *Node) SetParent(p *Node) { n.parent = p}func (n *Node) Parent() *Node { return n.parent}func (n *Node) MyVal() int { return n.myVal}func (n *Node) SumVal() int { return n.sumVal}func (n *Node) SetSumVal(sv int) { n.sumVal = sv} // PQueue.gopackage pqueuetype PQueue []*Nodefunc (pq *PQueue) IsEmpty() bool { return len(*pq) == 0}func (pq *PQueue) Push(i interface{}) { a := *pq n := len(a) a = a[0 : n+1] r := i.(*Node) a[n] = r *pq = a}func (pq *PQueue) Pop() interface{} { a := *pq *pq = a[0 : len(a)-1] r := a[len(a)-1] return r}func (pq *PQueue) Len() int { return len(*pq)}// post: true iff is i less than jfunc (pq *PQueue) Less(i, j int) bool { I := (*pq)[i] J := (*pq)[j] return (I.sumVal + I.myVal) < (J.sumVal + J.myVal)}func (pq *PQueue) Swap(i, j int) { (*pq)[i], (*pq)[j] = (*pq)[j], (*pq)[i]}func (pq *PQueue) String() string { var build string = ""{"" for _, v := range *pq { build += v.String() } build += ""}"" return build}",Using a container/heap to implement a priority queue
Get the current process name in Go?," What I am looking for here is the equivalent of C's argv[0]. The flag package only gives access to command line arguments, but not the executable name. While one can get the process with Getpid(), I haven't found something that will give me access to the whole command line. The syscall command GetCommandLine() seems only to be available on Windows.  <code> ",Get the current process (executable) name in Go?
Implementing an overflow-free system stack in ANSI C," I was just reading about how Google Go makes each thread with a reduced stack size by default, and then links to new stacks if an overflow would occur ( see page 16 in here ). I was wondering the best way to do that in C.I have to say I am no C expert, so there might be a better way to detect a Stack Overflow on C, but giving my ignorance, here's how I thought I would implement it:The first thing I thought is that every time we have a fresh new stack, we get a stack variable's address, and with that we have roughly the starting stack address. Then we would need to be able to retrieve how much stack space the thread has. This would be possible if the thread isn't the main thread, but I have no idea how we would get this info on C.Then we would need to check (per function call, it could be) how much of the stack is already used, by retrieving current stack variable address. If we detect a possible stack overflow, we would need to have some way to create a new stack and link to the last one. The only way I thought it could be done in C would be to create a new thread to execute the function we want, and lock the current thread until the function returns its result.So, would there be a cleaner/better way to implement this? <code> ",Implementing an overflow-free system stack in C90
golang: read text file into string array (and write)," The ability to read (and write) a text file into and out of a string array is I believe a fairly common requirement. It is also quite useful when starting with a language removing the need initially to access a database. Does one exist in Golang?e.g. and I would prefer to use an existing one rather than duplicate. <code>  func ReadLines(sFileName string, iMinLines int) ([]string, bool) { func WriteLines(saBuff[]string, sFilename string) (bool) { ",Read text file into string array (and write)
Golang: read text file into string array (and write)," The ability to read (and write) a text file into and out of a string array is I believe a fairly common requirement. It is also quite useful when starting with a language removing the need initially to access a database. Does one exist in Golang?e.g. and I would prefer to use an existing one rather than duplicate. <code>  func ReadLines(sFileName string, iMinLines int) ([]string, bool) { func WriteLines(saBuff[]string, sFilename string) (bool) { ",Read text file into string array (and write)
golang: timestamp, What's the best way to get the current timestamp in Go and convert to string? I need both date and time in eg. YYYYMMDDhhmmss format. <code> ,Get current time as formatted string in Go?
How do I get the current timestamp in Go?, What's the best way to get the current timestamp in Go and convert to string? I need both date and time in eg. YYYYMMDDhhmmss format. <code> ,Get current time as formatted string in Go?
Initialize custom int type in Go lang," In Go it is valid to create a type: but how can one then initialize that type? make(Num, 2) does not seem to work. <code>  type Num int",Initialize custom int type in Go
How would I implement one-to-many on appengine in go?," How would I implement one-to-many on Google App Engine in the Go programming language?For example, if I have the structs below, how would I store the association of many Votes to one Comment? Would I use an array (slice) of keys to Votes in the Comment struct, or one key to the Comment from the Vote struct? <code>  type Comment struct { Author string Content string Date datastore.Time}type Vote struct { User string Score int}",How would I implement one-to-many on App Engine in Go?
How would I implement one-to-many in Go?," How would I implement one-to-many on Google App Engine in the Go programming language?For example, if I have the structs below, how would I store the association of many Votes to one Comment? Would I use an array (slice) of keys to Votes in the Comment struct, or one key to the Comment from the Vote struct? <code>  type Comment struct { Author string Content string Date datastore.Time}type Vote struct { User string Score int}",How would I implement one-to-many on App Engine in Go?
Call go functions from C," I am trying to create a static object written in Go to interface with a C program (say, a kernel module or something).I have found documentation on calling C functions from Go, but I haven't found much on how to go the other way. What I've found is that it's possible, but complicated.Here is what I found:Blog post about callbacks between C and GoCgo documentationGolang mailing list postDoes anyone have experience with this? In short, I'm trying to create a PAM module written entirely in Go. <code> ",Call Go functions from C
Why go isn't going parallel?," I'm testing this Go code on my VirtualBoxed Ubuntu 11.4 Ubuntu has access to all my 4 cores. I checked this with simultaneous run of several executables and System Monitor.But when I'm trying to run this code, it's using only one core and is not gaining any profit of parallel processing.What I'm doing wrong? <code>  package mainimport (""fmt"";""time"";""big"")var c chan *big.Intfunc sum( start,stop,step int64) { bigStop := big.NewInt(stop) bigStep := big.NewInt(step) bigSum := big.NewInt(0) for i := big.NewInt(start);i.Cmp(bigStop)<0 ;i.Add(i,bigStep){ bigSum.Add(bigSum,i) } c<-bigSum }func main() { s := big.NewInt( 0 ) n := time.Nanoseconds() step := int64(4) c = make( chan *big.Int , int(step)) stop := int64(100000000) for j:=int64(0);j<step;j++{ go sum(j,stop,step) } for j:=int64(0);j<step;j++{ s.Add(s,<-c) } n = time.Nanoseconds() - n fmt.Println(s,float64(n)/1000000000.)}",Why doesn't the Go statement execute in parallel?
Why doesn't the go statement execute in parallel?," I'm testing this Go code on my VirtualBoxed Ubuntu 11.4 Ubuntu has access to all my 4 cores. I checked this with simultaneous run of several executables and System Monitor.But when I'm trying to run this code, it's using only one core and is not gaining any profit of parallel processing.What I'm doing wrong? <code>  package mainimport (""fmt"";""time"";""big"")var c chan *big.Intfunc sum( start,stop,step int64) { bigStop := big.NewInt(stop) bigStep := big.NewInt(step) bigSum := big.NewInt(0) for i := big.NewInt(start);i.Cmp(bigStop)<0 ;i.Add(i,bigStep){ bigSum.Add(bigSum,i) } c<-bigSum }func main() { s := big.NewInt( 0 ) n := time.Nanoseconds() step := int64(4) c = make( chan *big.Int , int(step)) stop := int64(100000000) for j:=int64(0);j<step;j++{ go sum(j,stop,step) } for j:=int64(0);j<step;j++{ s.Add(s,<-c) } n = time.Nanoseconds() - n fmt.Println(s,float64(n)/1000000000.)}",Why doesn't the Go statement execute in parallel?
"in golang, does it make sense to write non-blocking code?"," coming from node.js point of view, where all code is non-blocking.In Go, non-blocking is easily achieved using channels.if one were writing a node.js type server in go, does it make sense to make it non-blocking? for example, having a database connect() function return a channel, as versus blocking while waiting for the connection to occur.to me, this seems the correct approachbut ... <code> ","In Go, does it make sense to write non-blocking code?"
"in golang, is is possible get reflect.Type from the type itself? from name as string?"," is it possible to get the reflect.Type of t1 without having to instantiate it?is it possible to get the reflect.Type of t1 from having its name ""t1"" as a string? <code>  type t1 struct { i int; s string }var v1 reflect.Type = /* how to set to t1's reflect.Type? */","In golang, is it possible to get reflect.Type from the type itself, from name as string?"
"in golang, using reflect, how do you set the value of a struct field?"," having a rough time working with struct fields using reflect package. in particular, have not figured out how to set the field value. getting Name of field i - this seems to workvar field = reflect.TypeOf(r).Field(i).Namegetting value of field i as a) interface{}, b) int - this seems to workvar iface interface{} = reflect.ValueOf(r).Field(i).Interface()var i int = int(reflect.ValueOf(r).Field(i).Int())setting value of field i - try one - panicreflect.ValueOf(r).Field(i).SetInt( i64 )panic: reflect.ValueSetInt using value obtained using unexported fieldassuming it did not like field names ""id"" and ""name"", so renamed to ""Id"" and ""Name""a) is this assumption correct?b) if correct, thought not necessary since in same file / packagesetting value of field i - try two (with field names capitalized ) - panicreflect.ValueOf(r).Field(i).SetInt( 465 )reflect.ValueOf(r).Field(i).SetInt( i64 )panic: reflect.ValueSetInt using unaddressable valueInstructions below by @peterSO are thorough and high qualityFour. this works:reflect.ValueOf(&r).Elem().Field(i).SetInt( i64 )he documents as well that the field names must be exportable (begin with capital letter) <code>  type t struct { fi int; fs string }var r t = t{ 123, ""jblow"" }var i64 int64 = 456","Using reflect, how do you set the value of a struct field?"
"in golang, how do you create a ""constructor"" for a type with a string basetype?"," trying to have a type Char that is a string one character long. what I'm unable to do is create a ""constructor"". I know I'm missing something completely obvious.declare the Char type can use that type with a declaration these are wrong: c1 and c2 need to be ""a"", not ""abc""what I really want is a ""constructor"" to limit Char to one character of course having the type Char and func Char is not the way to do it is there any way for to force type initialization through a constructor? or am I even asking the correct question?let me state differently: if the user says var c Char = ""abc"" they will have an invalid value for type Char - is there any way to force the user into func NewChar(string) Char as Char's only valid constructor? <code>  type Char string var c1 Char(""abc"") var c2 Char = ""abc"" func Char( s string ) Char { var ch string = s[0] return ch } type.go:8: Char redeclared in this block","In Go, how do I create a ""constructor"" for a type with a string base type?"
"in go, how do you create an interface when methods are called by *Type?"," Attempting to create an interface, but methods have *Type, not Type receiversAPOLOGIZE: was sleepy and mis-read error messages. Thought I was being block from creating the DB interface when in reality I was mis-using it. Sorry about that... will be more careful in the future! from here I would like an interface that contains the methods toType and toRaw does not work since the function receivers are pointers. I say this because when I try to use it I get the error.k Is there a way to create an interface from toType and toRaw, or do I need to backup and have the receivers be the types themselves and not pointers to types? <code>  type Char stringfunc (*Char) toType(v *string) interface{} { if v == nil { return (*Char)(nil) } var s string = *v ch := Char(s[0]) return &ch}func (v *Char) toRaw() *string { if v == nil { return (*string)(nil) } s := *((*string)(v)) return &s} type DB interface{ toRaw() *string toType(*string) interface{}} Char does not implement DB (toRaw method requires pointer receiver)","In go, how do you create an interface when methods are called by *Type?"
"In go, how to write a multi-line statement?"," In python, we use backslash to indicate that the current statement continues to next linefor example, or simply, Is it possible to do that in Go language? Thanks <code>  a = b + c + s \ + x + y a = b + c + s + x + y","In Go, how to write a multi-line statement?"
"In Go, using a setter for a struct type does not work as anticipated"," Using a setter function for a struct, but not working as anticipated: I am missing some fundamental understanding - why doesn't SetVal work?the behavior is similar to setting values in reflect which only works if provided a pointer to the object as versus the object itself <code>  package mainimport ""fmt""type T struct { Val string }// this setter seems not to workfunc (t T) SetVal( s string ) { t.Val = s}// this setter, using ptr to T, seems to work okfunc (t *T) SetVal2( s string ) { (*t).Val = s}func main() { v := T{""abc""} fmt.Println( v ) // prints {abc} v.SetVal(""pdq"") fmt.Println( v ) // prints {abc}, was expecting {pdq}! v.SetVal2(""xyz"") fmt.Println( v ) // prints {xyz}!}",Using a setter for a struct type does not work as anticipated
"In Go, if type T2 is based on type T1, is there any sort of functional inheritance between T1 and T2?"," If type T2 is based on type T1, other than sharing the same data fields, is there any relationship between T1 and T2? My understanding here is lackingwas hoping that T2 would inherit T1's methods, but such is not the case.was expecting T2 could be coerced into T1, since it was derived from T1was surprised that T1 could be coerced into T2, but so it is.it seems that the relationship between T1 and T2 is completely symmetrical - I cannot find anything that breaks the symmetry despite the fact one is actually derived from the other - or is this an illusion? <code>  package mainimport ""fmt""type T1 struct { s string }func (v *T1) F1() string { return v.s }type T2 T1func (v *T2) F2() string { return v.s }func main() { var t1 = T1{ ""xyz"" } var t2 = T2{ ""pdq"" } s0 := t2.F1() // error - expected ok s1 := ((*T1)(&t2)).F1() // ok - expected s2 := ((*T2)(&t1)).F2() // ok - not expected fmt.Println( s0, s1, s2 )}","If type T2 is based on type T1, is there any sort of ""inheritance"" from T1 to T2?"
"In Go, if type T2 is based on type T1, is there any sort of ""inheritance"" from T1 to T2?"," If type T2 is based on type T1, other than sharing the same data fields, is there any relationship between T1 and T2? My understanding here is lackingwas hoping that T2 would inherit T1's methods, but such is not the case.was expecting T2 could be coerced into T1, since it was derived from T1was surprised that T1 could be coerced into T2, but so it is.it seems that the relationship between T1 and T2 is completely symmetrical - I cannot find anything that breaks the symmetry despite the fact one is actually derived from the other - or is this an illusion? <code>  package mainimport ""fmt""type T1 struct { s string }func (v *T1) F1() string { return v.s }type T2 T1func (v *T2) F2() string { return v.s }func main() { var t1 = T1{ ""xyz"" } var t2 = T2{ ""pdq"" } s0 := t2.F1() // error - expected ok s1 := ((*T1)(&t2)).F1() // ok - expected s2 := ((*T2)(&t1)).F2() // ok - not expected fmt.Println( s0, s1, s2 )}","If type T2 is based on type T1, is there any sort of ""inheritance"" from T1 to T2?"
"In Go, one type is coerced into another, can a method to determine the type of the receiver?"," If types T1 and T2 are based on type T, and type T only comes into existence from a NewT1() or NewT2(), is there any way a function func (*T) WhoAmI() can know whether it ""really"" is a T1 or T2? to speak technically:once t1 type T1 is coerced into type T so func (*T) WhoAmI() can be called, does t1 completely lose the fact that its type is really T1? if not, how do we reclaim the knowledge from the perspective of a method receiving type T?to speak generally:in other words, if one type is based on another, if a variable of the derived type is coerced into the base type to run a method, can that method learn the real type of the receiver who called it? <code>  package mainimport ""fmt""import ""reflect""type T struct { s string }func (v *T) WhoAmI() string { // pull type name with reflect fmt.Println( reflect.TypeOf(v).Elem().Name() ) // always prints ""T""! // todo: if I am actually T1 return ""T1"" // todo: else if I am actually T2 return ""T2""}type T1 Tfunc NewT1( s string ) T1 { return T1{ s } }type T2 Tfunc NewT2( s string ) T2 { return T2{ s } }func main() { var t1 = T1{ ""xyz"" } var t2 = T2{ ""pdq"" } s1 := ((*T)(&t1)).WhoAmI() // would like to return ""T1"" s2 := ((*T)(&t2)).WhoAmI() // would like to return ""T2"" fmt.Println( s1, s2 )}","One type is coerced into another, can a method to determine the type of the receiver?"
goinstall: List all installed packages, How can I list all installed packages via goinstall? I need this to reinstall all packages installed on one computer to a different computer.  <code> ,Get a list of all installed packages in Go
File System Scanning in Golang, I need to write a function which when given the path of a folder scans the files rooted at that folder. And then I need to display the directory structure at that folder. I know how to do 2 (I am going to use jstree to display it in the browser).  <code> ,How to perform file system scanning
How to perform file system scanning in Golang?, I need to write a function which when given the path of a folder scans the files rooted at that folder. And then I need to display the directory structure at that folder. I know how to do 2 (I am going to use jstree to display it in the browser).  <code> ,How to perform file system scanning
Unknown escape sequence," I have the following function written in Go. The idea is the function has a string passed to it and returns the first IPv4 IP address found. If no IP address is found, an empty string is returned. The compile-time error I'm getting is unknown escape sequence: .How can I tell Go that the '.' is the actual character I'm looking for? I thought escaping it would do the trick, but apparently I'm wrong. <code>  func parseIp(checkIpBody string) string { reg, err := regexp.Compile(""[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+"") if err == nil { return """" } return reg.FindString(checkIpBody)}","""Unknown escape sequence"" error in Go"
how to stop a goroutine," I have a goroutine that calls a method, and passes returned value on a channel: How do I stop such a goroutine? <code>  ch := make(chan int, 100)go func(){ for { ch <- do_stuff() }}()",How to stop a goroutine
go: why request.URL.Host and Scheme are blank in the develoment server?," I'm very new to Go. Tried this first hello, world from the documentation, and wanted to read the Host and Scheme from the request: But their values are both blank. Why? <code>  package helloimport ( ""fmt"" ""http"")func init() { http.HandleFunc(""/"", handler)}func handler(w http.ResponseWriter, r *http.Request) { fmt.Fprint(w, ""Host: "" + r.URL.Host + "" Scheme: "" + r.URL.Scheme)}",Why are request.URL.Host and Scheme blank in the development server?
Why slice capacity greater than length gives runtime error?," Made a slice where capacity is less than the length This when tried to run gives following error. My question is can capacity be less than length?If 'Yes' then why this error came? And if 'No'then why this is a runtime error and why not a compile time? <code>  package main import fmt ""fmt"" func main(){ type b []int var k = make([]b, 10, 5) fmt.Printf(""%d\n"",k[8]) } panic: runtime error: makeslice: cap out of range runtime.panic+0x9e /go/src/pkg/runtime/proc.c:1060 runtime.panic(0x453b00, 0x30020390) runtime.panicstring+0x94 /go/src/pkg/runtime/runtime.c:116 runtime.panicstring(0x4afd6c, 0x40d80c) runtime.makeslice+0x70 /go/src/pkg/runtime/slice.c:24 runtime.makeslice(0x44302c, 0xa, 0x0, 0x5, 0x0, ...) main.main+0x45 C:/GOEXCE~1/basics/DATATY~1/slice.go:8 main.main() runtime.mainstart+0xf 386/asm.s:93 runtime.mainstart() runtime.goexit /go/src/pkg/runtime/proc.c:178 runtime.goexit() ----- goroutine created by ----- _rt0_386+0xbf 386/asm.s:80",Why slice length greater than capacity gives runtime error?
"Go - Read in lines in a text file, sort, then overwrite file"," I am trying to write a go function that will read in lines in a text file, sort them (alphabetize), and overwrite them back to the file. Right now, I am able to essentially emulate cat, but I can't seem to be able to manipulate the contents of the elements in read_line. when i use ReadString, how can i store each line into a slice (or is there a better way to store them so i can manipulate them)? Then I would use the sort package in a manner similar to this: then, to write to the file, i am using something similar to the following, although i have not included it because i have not yet gotten ""sort"" to work: Thank you in advance for any suggestions! <code>  func sort() { ff, _ := os.OpenFile(file, os.O_RDWR, 0666) f := bufio.NewReader(ff) for { read_line, _ := f.ReadString('\n') fmt.Print(read_line) if read_line == """" { break } } ff.Close()} sorted := sort.Strings(lines) io.WriteString(ff, (lines + ""\n""))","Read in lines in a text file, sort, then overwrite file"
Go: Slice of slices types," I'm currently working my way through the excellent Tour of Go.I finished one of the exercises (#45) with the following solution: I don't understand why I have to use a make statement with the uint8 type twice (see comments in snippet). That seems redundant but I can't figure out how to do it in an other way. <code>  func Pic(dx, dy int) [][]uint8 { pic := make([][]uint8, dy) /* type declaration */ for i := range pic { pic[i] = make([]uint8, dx) /* again the type? */ for j := range pic[i] { pic[i][j] = uint8((i+j)/2) } } return pic}",Slice of slices types
map-like functionality over a persistent file," I will be creating a structure more or less of the form: I want to write these values to a file and read them in on subsequent calls. My initial plan is to read them into a map and lookup values (Hash and LastModified) using the key (Path). Is there a slick way of doing this in Go?If not, what file format can you recommend? I have read about and experimented with with some key/value file stores in previous projects, but not using Go. Right now, my requirements are probably fairly simple so a big database server system would be overkill. I just want something I can write to and read from quickly, easily, and portably (Windows, Mac, Linux). Because I have to deploy on multiple platforms I am trying to keep my non-go dependencies to a minimum.I've considered XML, CSV, JSON. I've briefly looked at the gob package in Go and noticed a BSON package on the Go package dashboard, but I'm not sure if those apply.My primary goal here is to get up and running quickly, which means the least amount of code I need to write along with ease of deployment. <code>  type FileState struct { LastModified int64 Hash string Path string}",Store map key/values in a persistent file
Is there a foreach in Go?, Is there a foreach construct in the Go language? Can I iterate over a slice or array using a for? <code> ,Is there a foreach loop in Go?
What kind of Garbage Collection does Go uses?," Go is a garbage collected language:http://golang.org/doc/go_faq.html#garbage_collectionHere it says that it's a mark-and-sweep garbage collector, but it doesn't delve into details, and a replacement is in the works... yet, this paragraph seems not to have been updated much since Go was released.It's still mark-and-sweep? Is it conservative or precise? Is it generational? <code> ",What kind of Garbage Collection does Go use?
How do you create a new instance of a struct from it's Type at runtime in Go?," In Go, how do you create the instance of an object from its type at run time? I suppose you would also need to get the actual type of the object first too?I am trying to do lazy instantiation to save memory. <code> ",How do you create a new instance of a struct from its type at run time in Go?
Is it possible to make extensions to python/php/perl with golang?," I've heard Go is like C with channels and a lot of conveniences. I do very little C, but when I do it's to make small extensions to other languages. Can Go be a safe way to create extensions in other languages? Are people doing this? <code> ",Is it possible to make extensions to python/php/perl with Go?
golang: unexpected EOF while reading from a socket," I have the following simple golang program to download Google's privacy policy. Unfortunately it always crashes with the error unexpected EOF after reading 6861 bytes, even though the document is much longer. Why? outputs: <code>  package mainimport ""net""import ""fmt""import ""io""import ""os""func die(msg string, s os.Error) { fmt.Printf(""%s crashed: %v\n"", msg, s) os.Exit(1)}func main() { fd, err := net.Dial(""tcp"", ""google.com:80"") if err != nil { die(""dial"", err) } req := []byte(""GET /intl/en/privacy/ HTTP/1.0\r\nHost: www.google.com\r\n\r\n"") _, err = fd.Write(req) if err != nil { die(""dial write"", err) } buf := make([]byte, 1024) nr := 1 for nr > 0 { nr, err = io.ReadFull(fd, buf) if err != nil { die(""dial read"", err) } fmt.Printf(""read %d\n"", nr) }} read 1024read 1024read 1024read 1024read 1024read 1024dial read crashed: unexpected EOF",Go: unexpected EOF while reading from a socket
How to import local Golang package in GAE," How to import local packages in Golang + GAE?I wanna something like this: Listing of my_app.go: Listing of package1.go: I this case I have an error like: Thanks for help. <code>  app/-app.yaml-/my_app--my_app.go--/package1---package1.go package my_appimport ( ""http"" ""./package1"")func init() { http.HandleFunc(""/"", package1.index)} package package1import ( ""http"" ""fmt"")func index (w http.ResponseWriter, r * http.Request) { fmt.Fprint(w, ""I'm index page =) "")} /path/to/project/my_app/my_app.go:5: can't find import: ./package12011/11/03 10:50:51 go-app-builder: Failed building app: failed running 6g: exit status 1",How to import local Go package in GAE
convert string to byte array in Go," Is there convenient way for initial a byte array? prog.go:8: cannot use ""abcde"" (type string) as type [5]uint8 in field valueif I change the line to t := T1{[5]byte(""abcde""), 3}prog.go:8: cannot convert ""abcde"" (type string) to type [5]uint8 <code>  package mainimport ""fmt""type T1 struct { f1 [5]byte // I use fixed size here for file format or network packet format. f2 int32}func main() { t := T1{""abcde"", 3} // t:= T1{[5]byte{'a','b','c','d','e'}, 3} // work, but ugly fmt.Println(t)}",convert string to fixed size byte array in Go
Go - Call a Struct and it's Method by name?," I have found a function call MethodByName() here http://golang.org/pkg/reflect/#Value.MethodByName but it's not exactly what I want! (maybe because I don't know how to use it ... I cannot find any example with it). What I want is: So I guess, first I need something like StructByName() and after that use it for MethodByName(), is that right!? <code>  type MyStruct struct {//some feilds here} func (p *MyStruct) MyMethod { println(""My statement.""); } CallFunc(""MyStruct"", ""MyMethod""); //print out ""My statement."" ",Call a Struct and its Method by name in Go?
Call a Struct and it's Method by name in Go?," I have found a function call MethodByName() here http://golang.org/pkg/reflect/#Value.MethodByName but it's not exactly what I want! (maybe because I don't know how to use it ... I cannot find any example with it). What I want is: So I guess, first I need something like StructByName() and after that use it for MethodByName(), is that right!? <code>  type MyStruct struct {//some feilds here} func (p *MyStruct) MyMethod { println(""My statement.""); } CallFunc(""MyStruct"", ""MyMethod""); //print out ""My statement."" ",Call a Struct and its Method by name in Go?
ctag database for golang," How to generate tags file for Go sourceIn mac, I installed exuberant ctags , and tried the below command in source directory But, it doesn't consider *.go files. Do I have to use -h option? But, isn't it only for header files, as per the manual?Please give me the correct command so that I can use the tags file with vim. I also prefer absolute path so that I can keep the file anywhereThanks.Edit:I assumed current ctags support Go, seeing http://groups.google.com/group/golang-nuts/browse_thread/thread/3a4848db231b02c9.but, http://ctags.sourceforge.net/languages.html desn't have go listed. <code>  ctags -f gosource.tags -R `pwd`",ctag database for Go
Whats the difference of functions and methods in Google Go?," I am trying to get started with Go and the documentation is very good. What I did not find in the documentation is the difference between functions and methods.As far as I understand at the moment: functions are ""global"", which means I do not have to import a package to use functions, they are always there. Methods are bound to packages. Is this correct? <code> ",Whats the difference of functions and methods in Go?
go language how to get last modified file date and time, Does anyone know how to check for a file access date and time? The function returns the modified date and time and I need something that compares the accessed date time to the current date and time. <code> ,How to get last-accessed date and time of file in Go?
How to get last modified file date and time in Go?, Does anyone know how to check for a file access date and time? The function returns the modified date and time and I need something that compares the accessed date time to the current date and time. <code> ,How to get last-accessed date and time of file in Go?
GoLang: init function for Structs," I realize that Go does not have classes but pushes the idea of structs instead.Do structs have any sort of initialization function that can be called similar to a __construct() function of a class?Example: <code>  type Console struct { X int Y int}func (c *Console) init() { c.X = ""5""}// Here I want my init function to runvar console Console// or here if I usedvar console Console = new(Console)",init function for structs
Go: how to find out element position in slice?," How does one determine the position of an element present in slice?I need something like the following: <code>  type intSlice []intfunc (slice intSlice) pos(value int) int { for p, v := range slice { if (v == value) { return p } } return -1}",How to find out element position in slice?
Golang array slice from function return statement, I have the following functions: I want to call but I get this error: How do I properly get a slice of an array returned by a function in Go? <code>  func (c *Class)A()[4]bytefunc B(x []byte) B(c.A()[:]) cannot take the address of c.(*Class).A(),Go array slice from function return statement
How do you time a function in Go and return it's runtime in milliseconds?, How do you time a function in Go and return its runtime in milliseconds? <code> ,How do you time a function in Go and return its runtime in milliseconds?
Converting int and long into sting in Go," I have concurrent routine like this, Now, I want to send from routine 1 string like, string + int + string + system time in nanosecond. Can anybody help me how can I achieve this. <code>  Routine 1(){for 30 timesSend string}Routine 2 (out <-chan string){forcase str := <- out: fmt.Println(str)}",Converting int and long into string in Go
Go (golang) cross-compile to windows executable?," Using Ubuntu, what steps should I take to compile Go source code into a Windows executable? <code> ",Does Go cross-compile on Ubuntu to a Windows executable?
Golang template examples," What website has some good, up to date resources on using Go html/templates, especially in regard to parsing html files and handling lists? I came across the Hoka Poka website, but it seems to be out of date. <code> ",Go template examples
golang: Is it OK to leave a channel open?," Is it OK to leave a Go channel open forever (never close the channel) if I never check for its state? Will it lead to memory leaks? Is the following code OK? <code>  func (requestCh chan<- Request) GetResponse(data RequestData) Response { reply := make(chan Response) requestCh <- Request{data: data, replyCh: reply} return <-reply}",Is it OK to leave a channel open?
Removed last character of a string," I want to remove the very last character of a string, but before I do so I want to check if the last character is a ""+"". How can this be done? <code> ",How to remove the last character of a string in Golang?
Remove last character of a string," I want to remove the very last character of a string, but before I do so I want to check if the last character is a ""+"". How can this be done? <code> ",How to remove the last character of a string in Golang?
reading file line by line in go," I'm unable to find file.ReadLine function in Go. I can figure out how to quickly write one, but I am just wondering if I'm overlooking something here. How does one read a file line by line? <code> ",Reading a file line by line in Go
Redirect stdout pipe of child process in golang," I'm writing a program in Go that executes a server like program (also Go). Now I want to have the stdout of the child program in my terminal window where I started the parent program. One way to do this is with the cmd.Output() function, but this prints the stdout only after the process has exited. (That's a problem because this server-like program runs for a long time and I want to read the log output)The variable out is of type io.ReadCloser and I don't know what I should do with it to achieve my task, and I can't find anything helpful on the web on this topic. Explanation to the code: uncomment the Println function to get the code to compile, I know that Println(out io.ReadCloser) is not a meaningful function. (it produces the output &{3 |0 <nil> 0} ) These two lines are just required to get the code to compile. <code>  func main() { cmd := exec.Command(""/path/to/my/child/program"") out, err := cmd.StdoutPipe() if err != nil { fmt.Println(err) } err = cmd.Start() if err != nil { fmt.Println(err) } //fmt.Println(out) cmd.Wait()} ",Redirect stdout pipe of child process in Go
Redirect stdout pipe of child process in golang (SOLVED)," I'm writing a program in Go that executes a server like program (also Go). Now I want to have the stdout of the child program in my terminal window where I started the parent program. One way to do this is with the cmd.Output() function, but this prints the stdout only after the process has exited. (That's a problem because this server-like program runs for a long time and I want to read the log output)The variable out is of type io.ReadCloser and I don't know what I should do with it to achieve my task, and I can't find anything helpful on the web on this topic. Explanation to the code: uncomment the Println function to get the code to compile, I know that Println(out io.ReadCloser) is not a meaningful function. (it produces the output &{3 |0 <nil> 0} ) These two lines are just required to get the code to compile. <code>  func main() { cmd := exec.Command(""/path/to/my/child/program"") out, err := cmd.StdoutPipe() if err != nil { fmt.Println(err) } err = cmd.Start() if err != nil { fmt.Println(err) } //fmt.Println(out) cmd.Wait()} ",Redirect stdout pipe of child process in Go
Redirect stdout pipe of child process in golang," I'm writing a program in Go that executes a server like program (also Go). Now I want to have the stdout of the child program in my terminal window where I started the parent program. One way to do this is with the cmd.Output() function, but this prints the stdout only after the process has exited. (That's a problem because this server-like program runs for a long time and I want to read the log output)The variable out is of type io.ReadCloser and I don't know what I should do with it to achieve my task, and I can't find anything helpful on the web on this topic. Explanation to the code: uncomment the Println function to get the code to compile, I know that Println(out io.ReadCloser) is not a meaningful function. (it produces the output &{3 |0 <nil> 0} ) These two lines are just required to get the code to compile. <code>  func main() { cmd := exec.Command(""/path/to/my/child/program"") out, err := cmd.StdoutPipe() if err != nil { fmt.Println(err) } err = cmd.Start() if err != nil { fmt.Println(err) } //fmt.Println(out) cmd.Wait()} ",Redirect stdout pipe of child process in Go
Redirect stdout pipe of child process in Golang," I'm writing a program in Go that executes a server like program (also Go). Now I want to have the stdout of the child program in my terminal window where I started the parent program. One way to do this is with the cmd.Output() function, but this prints the stdout only after the process has exited. (That's a problem because this server-like program runs for a long time and I want to read the log output)The variable out is of type io.ReadCloser and I don't know what I should do with it to achieve my task, and I can't find anything helpful on the web on this topic. Explanation to the code: uncomment the Println function to get the code to compile, I know that Println(out io.ReadCloser) is not a meaningful function. (it produces the output &{3 |0 <nil> 0} ) These two lines are just required to get the code to compile. <code>  func main() { cmd := exec.Command(""/path/to/my/child/program"") out, err := cmd.StdoutPipe() if err != nil { fmt.Println(err) } err = cmd.Start() if err != nil { fmt.Println(err) } //fmt.Println(out) cmd.Wait()} ",Redirect stdout pipe of child process in Go
List of currently running process in golang, How can I get the list of currently running processes in Go?The OS package provides some functions: http://golang.org/pkg/os/but doesn't give anything to see the list of running processes. <code> ,List of currently running process in Go
List of currently running process in Golang, How can I get the list of currently running processes in Go?The OS package provides some functions: http://golang.org/pkg/os/but doesn't give anything to see the list of running processes. <code> ,List of currently running process in Go
Golang maps - deleting data," How does one delete data from a map in Go? For example, having I want to make m drop the ""key1"" without copying the entire map by iterating over its keys (which could get big in some uses). Is it enough to assign a nil value to ""key1"", or will that still keep the key in the map structure with an assigned value of nil? That is, if I later iterate over the keys of the map, will ""key1"" appear? <code>  m := map[string]string{ ""key1"":""val1"", ""key2"":""val2"" };",maps - deleting data
Go: Append if unique," Is there a way to check slices/maps for the presence of a value?I would like to add a value to a slice only if it does not exist in the slice.This works, but it seems verbose. Is there a better way to do this? <code>  orgSlice := []int{1, 2, 3}newSlice := []int{}newInt := 2 newSlice = append(newSlice, newInt)for _, v := range orgSlice { if v != newInt { newSlice = append(newSlice, v) }}newSlice == [2 1 3]",How to check the uniqueness inside a for-loop?
Golang - convert string which represent binary number into int," I wrote a stupid solution for this, any better recipe?As you can see lots of useless conversions there. <code>  package mainimport ( ""fmt"" ""strconv"" ""math"")func conv(str string) int { l := len(str) result := 0.0 for i,n := range str { number,_ := strconv.Atof64(string(n)) result += math.Exp2(float64(l-i-1))*number } return int(result)}func main() { fmt.Println(conv(""1001""))}",Go - convert string which represent binary number into int
Go: why would I make() or new()?," The introduction documents dedicate many paragraphs to explaining the difference between new() and make(), but in practice, you can create objects within local scope and return them.Why would you use the pair of allocators? <code> ",Why would I make() or new()?
Go Inter-Process Communication," Im writing a load balanced server system in Go.The load balancing server will communicate with several application servers and process requests. These servers can both, be running on the same machine or on the network.I already figured the networking out but now I need to find an optimal way for the load-balancer to communicate with a local application server. Using localhost-networking seems far from optimal.Im trying to share memory via the shmget and shmat system-calls but havent found any working examples and the syscall package is also completely undocumented.Can someone provide me with an example of how to use these calls or a realistic alternative that works on Go for doing IPC? <code> ",How to implement inter-process communication in Go?
Ways to declare a function of a certain type," I wanted to create a function of a certain type. I've found one way to do it, but there must be other, cleaner and nicer ways that do not include using var. What are the alternative ways to declare the function english of type Greeting? In the example above, I can't exchange var english = Greeting... with english := Greeting..., nor can I remove the Greeting(func ...) and just have the func stand alone since then I won't be able to access the exclamation method. <code>  package mainimport ""fmt""type Greeting func(name string) stringfunc (g Greeting) exclamation(name string) string { return g(name) + ""!""}var english = Greeting(func(name string) string { return ""Hello, "" + name})func main() { fmt.Println(english(""ANisus"")) fmt.Println(english.exclamation(""ANisus"")) }",Working with function types in Go
Obtaining a Unix Timestamp in Go Language," I have some code written in Go which I am trying to update to work with the latest weekly builds. (It was last built under r60). Everything is now working except for the following bit: Any advice on how to update this to work with the current Go implementation? <code>  if t, _, err := os.Time(); err == nil { port[5] = int32(t) }",Obtaining a Unix Timestamp in Go Language (current time in seconds since epoch)
Global variables / Get commando line argument and print it," This may sound stupid but how do I define a global variable in Go? const myglobalvariable = ""Hi there!"" doesn't really work...I just want to get the command line argument and after this I want to print it. I do this using this code snippet: The problem is that it just prints an empty line so I thought about declaring a global variable using const myglobalvariable = ""Hi there!"" but I just get the error cannot use flag.Args() (type []string) as type ideal string in assignment......I know this is a noob question so I hope you can help me... <code>  package mainimport ( ""flag"" ""fmt"")func main() { gettext(); fmt.Println(text)}func gettext() { flag.Parse() text := flag.Args() if len(text) < 1 { fmt.Println(""Please give me some text!"") }}",Global variables / Get command line argument and print it
"How best do I keep a long running Go program, running"," I've a long running server written in Go. Main fires off several goroutines where the logic of the program executes. After that main does nothing useful. Once main exits, the program will quit. The method I am using right now to keep the program running is just a simple call to fmt.Scanln(). I'd like to know how others keep main from exiting. Below is a basic example. What ideas or best practices could be used here?I considered creating a channel and delaying exit of main by receiving on said channel, but I think that could be problematic if all my goroutines become inactive at some point.Side note: In my server (not the example), the program isn't actually running connected to a shell, so it doesn't really make sense to interact with the console anyway. For now it works, but I'm looking for the ""correct"" way, assuming there is one. <code>  package mainimport ( ""fmt"" ""time"")func main() { go forever() //Keep this goroutine from exiting //so that the program doesn't end. //This is the focus of my question. fmt.Scanln()}func forever() { for ; ; { //An example goroutine that might run //indefinitely. In actual implementation //it might block on a chanel receive instead //of time.Sleep for example. fmt.Printf(""%v+\n"", time.Now()) time.Sleep(time.Second) }}","How best do I keep a long running Go program, running?"
"GO, APPENGINE: How to structure templates for application"," How are people handling the use of templates in their Go-based AppEngine applications?Specifically, I'm looking for a project structure that affords the following:Hierarchical (directory) structure of templates and partial templatesAllow me to use HTML tools/editors on my templates (embedding template text in xxx.go files makes this difficult)Automatic reload of template text when on dev serverPotential stumbling blocks are:template.ParseGlob() will not traverse recursively.For performance reasons it has been recommended not to upload your templates as raw text files (because those text files reside on different servers than executing code).Please note that I am not looking for a tutorial/examples of the use of the template package. This is more of an app structure question. That being said, if you have code that solves the above problems, I would love to see it. Thanks in advance. <code> ","Go, AppEngine: How to structure templates for application"
Golang / OpenGL render-to-texture-via-FBO -- incorrect display vs. normal Texture," off-screen rendering to a texture-bound offscreen framebuffer object should be so trivial but I'm having a problem I cannot wrap my head around.My full sample program (2D only for now!) is here:http://pastebin.com/hSvXzhJTSee below for some descriptions.I'm creating an rgba texture object 512x512, bind it to an FBO. No depth or other render buffers are needed at this point, strictly 2D.The following extremely simple shaders render to this texture:Vertex shader: In aPos this just gets a VBO containing 4 xy coords for a quad (-1, -1 :: 1, -1 :: 1, 1 :: -1, 1)So although the framebuffer resolution should theoretically by 512x512 obviously the shader renders its ""texture"" onto a ""full-(off)screen quad"", following GLs -1..1 coords paradigm.Fragment shader: So it sets a fully opaque color with red fixed at 0.25 and green/blue depending on x/y anywhere between 0 and 1.At this point my assumption is that a 512x512 texture is rendered showing only the -1..1 full-(off)screen quad, fragment-shaded for green/blue from 0..1.So this is my off-screen setup. On-screen, I have another real visible full-screen quad with 4 xyz coords { -1, -1, 1 ::: 1, -1, 1 ::: 1, 1, 1 ::: -1, 1, 1 }. Again, for now this is 2D so no matrices and so z is always 1.This quad is drawn by a different shader, simply rendering a given texture, text-book GL-101 style. In my sample program linked above I have a simple boolean toggle doRtt, when this is false (the default), render-to-texture is not performed at all and this shader simply shows uses texture.jpg from the current directory.This doRtt=false mode shows that the second on-screen quad-renderer is ""correct"" for my current requirements and performs the texturing as I want it to: repeated twice vertically and twice horizontally (later will be clamped, repeat is just for testing here), otherwise scaling with NO texture filtering or mipmapping.So no matter how the window (and thus view port) is resized, we always see a full-screen quad with a single texture repeated twice horizontally, twice vertically.Now, with doRtt=true, the second shader still does its job but the texture is never fully correctly scaled -- or drawn, this I'm not sure since unfortunately we can't just say ""hey gl save this FBO to disk for debugging purposes"".The RTT shader DOES perform some partial rendering (or maybe a full one, again can't be sure what's happening off-screen...) Especially when you resize the viewport a lot smaller than the default size you see the breaks between the texture repeats, and not all colors to be expected from our very simple RTT fragment shader are indeed shown.(A) either: the 512x512 texture is created correctly but not mapped correctly by my code (but then why is with doRtt=false any given texture.jpg file using the exact same simple textured-quad-shader showing just fine?)(B) or: the 512x512 texture is not rendered correctly and somehow the rtt frag shader changes its output depending on the window resolution -- but why? The off-screen quad is always at -1..1 for x and y, the vertex shader always maps this to fragment coords 0..1, the RTT texture always stays at 512x512 for this simple test!Note, BOTH the off-screen quad AND the on-screen quad never change their coords and are always ""full-screen"" (-1..1 in both dimensions).Again, this should be so simple. What on earth am I missing?Specs: OpenGL 4.2 (but the code doesn't need any 4.2 features obviously!), Nvidia Quadro 5010M, openSuse 12.1 64bit, Golang Weekly 22-Feb-2012. <code>  varying vec2 vPos; attribute vec2 aPos;void main (void) { vPos = (aPos + 1) / 2; gl_Position = vec4(aPos, 0.0, 1.0);} varying vec2 vPos;void main (void) { gl_FragColor = vec4(0.25, vPos, 1);}",OpenGL render-to-texture-via-FBO -- incorrect display vs. normal Texture
From io.Reader to string in go, I have an io.ReadCloser object (from an http.Response object).What's the most efficient way to convert the entire stream to a string object? <code> ,From io.Reader to string in Go
GoLang: Nested properties for structs with unknown property names?," I'm using JSON to get some values into a variable from an external source.I have a type like this that json.Unmarshal puts values into: After unmarshal, I can access a the type by: data.Typebut if I try doing something like: The compiler complains about no such value data.Value.Imagedata.So my question is, how do I reference properties in Go that I know will be there depending on some condition?Doing this works: But that isn't very flexible as I will be receiving different Values. <code>  type Frame struct { Type string Value map[string]interface{} } var data Frame if data.Type == ""image"" { fmt.Printf(""%s\n"", data.Value.Imagedata) } type Image struct { Filename string } type Frame struct { Type string Value map[string]interface{} }",Nested properties for structs with unknown property names?
return custom page on 404 error with standard http package," Assuming that we have: User sees a plain ""404 page not found"" when they try a wrong URL. How can I return a custom page for that case?Update concerning gorilla/muxAccepted answer is ok for those using pure net/http package.If you use gorilla/mux you should use something like this: And implement func notFound(w http.ResponseWriter, r *http.Request) as you want. <code>  http.HandleFunc(""/smth"", smthPage)http.HandleFunc(""/"", homePage) func main() { r := mux.NewRouter() r.NotFoundHandler = http.HandlerFunc(notFound)}",Showing custom 404 error page with standard http package
Golang fork process," I need help understanding how to demonize a process in Go. If you start this code on the command line the program returns control, but is still connected with cmd. Closing the cmd closes the program.How can I decouple it from the cmd? Adding: Results in this error: ""panic"" to wrong memory pointer <code>  package mainimport ( ""fmt"" ""os"")func start() { var procAttr os.ProcAttr procAttr.Files = []*os.File{nil, nil, nil} _, err := os.StartProcess(""/Path/prog"", nil, &procAttr) if err != nil { fmt.Printf(""%v"", err) }}func main () { start()} procAttr.Sys.HideWindow = true",How to fork a process
mod_go (apache) for developing web applications in Go programming language, I can not find a mod_go for deploying Go web applications. Is there any other way to run web applications in Go with an Apache web server (or even IIS)?Update: Now after doing Go full time for nearly a year; doing this (Go with Apache) is nullifying the very purpose of Go (Performance in terms of being highly concurrent). And I'm using nginx as a reverse proxy for http/https and having my Go backends behind it nicely. Though you have to change your mindset on webapps a bit when using Go. <code> ,Deploying Go web applications with Apache
Go: Benchmarking code with a StopWatch or similar," I'm trying to use Go package ""time"" to benchmark a function in my program. Been searching around, and people seem to use time.NanoSeconds() - but I think this function is no longer in the time package?What I need is an easy way to start and stop a timer, and print out the value. <code> ",Benchmarking code with a StopWatch or similar
How to convert a int value to string in go?," s is 'E', but what I want is ""123""Please tell me how can I get ""123"".And in Java, I can do in this way: how can I concat two strings in Go? <code>  i := 123s := string(i) String s = ""ab"" + ""c"" // s is ""abc""",How to convert an int value to string in Go?
How to convert an int value to string in go?," s is 'E', but what I want is ""123""Please tell me how can I get ""123"".And in Java, I can do in this way: how can I concat two strings in Go? <code>  i := 123s := string(i) String s = ""ab"" + ""c"" // s is ""abc""",How to convert an int value to string in Go?
Go Language Syntax," I was going through some code written in Google's Go language, and I came across this: I don't understand what the ... means. Does anybody know? <code>  func Statusln(a ...interface{})func Statusf(format string, a ...interface{})","What does ""..."" mean when next to a parameter in a go function declaration?"
Reading log files as they're updated in Go," I'm trying to parse some log files as they're being written in Go but I'm not sure how I would accomplish this without rereading the file again and again while checking for changes.I'd like to be able to read to EOF, wait until the next line is written and read to EOF again, etc. It feels a bit like how tail -f looks. <code> ",Reading log files as they're updated in Go
Reading log files as they're updated (tail) in Go," I'm trying to parse some log files as they're being written in Go but I'm not sure how I would accomplish this without rereading the file again and again while checking for changes.I'd like to be able to read to EOF, wait until the next line is written and read to EOF again, etc. It feels a bit like how tail -f looks. <code> ",Reading log files as they're updated in Go
"Go webserver how is the performence stability, in terms of long run stability compared to Tomcat, Apache?"," I have been thinking instead of using:TomcatApache Lightweight webserverPHPRubyJSPWhy not switch my projects to Go language. Because there i have:webserver built in i do not even need to depend on PHP, Ruby, JSP Go solves cross-platform such as: runs on FreeBSD, Linux, Solaris (Windows, Mac, Android, Tizen)nor Apache nor Tomcat nor other webserver maintainencespeed of browser would be extreamly faster then other web server scripting languages.But one thing i am worried about, which is the stablity of Go webserver compared to other webservers.Has anyone done this before or am i alone building such projects for production releases? <code> ","Go webserver how is the performance stability, in terms of long run stability compared to Tomcat, Apache?"
Instance new Type (golang), Can anyone tell me how to create a new instance of Type from a string? Reflect?There are examples but they are for the older (pre Go 1 versions) of the language [:(] <code> ,Instance new Type (Golang)
"When read a text file, how to specify the encoding?", I need to read a text file that is encoded in GBK. The standard library in Go programming language assumes that all text is encoded in UTF-8.How can I read files in other encodings? <code> ,Reading a non UTF-8 text file in Go
Reading a non UTF-8 text file in go, I need to read a text file that is encoded in GBK. The standard library in Go programming language assumes that all text is encoded in UTF-8.How can I read files in other encodings? <code> ,Reading a non UTF-8 text file in Go
"DLL-linking via Windows cgo/gcc/ld -- freeglut works, glfw doesn't. What's the cause?"," (Very detailed problem report -- tl;dr at the bottom!)I really prefer GLFW to Glut and want to get its Golang binding working under Windows 64-bit with Go 1.0.1 64-bit. Under Linux, the binding it works flawlessly. This is in principle doable under Windows -- GitHub user chsc has managed to do so, but he's on Win32 and his tips didn't resolve my issues yet. However I do have a complete and clean Mingw64 set up based on tdm64-gcc-4.6.1.Now here's the strange thing -- getting the freeglut binding to work under 64-bit Windows, 64-bit Go 1.0.1 works -- the glfw binding fails for me. I want to figure out why, as they essentially both use the same cgo features and techniques.Note I currently have a self-made half-baked but essentially working replacement package in place that uses LoadLibrary/GetProcAddress calls to expose glfw.dll in Go. This works but I think a hard-linked compiled-in CGO binding would be more desirable than countless Syscall(), Syscall6(), Syscall9(), Syscall12() etc Go func invocations. If Win32 and Linux gophers can have this, why not us Win64 folks?So here's my setup so far:I have a Golang build with three patches to make lib linking work with cgo appliedI have successfully compiled the newest freeglut and GLFW libraries as 64-bit DLLs using MinGW64.Header files glut.h, freeglut*.h and glfw.h are placed in \MinGW64\x86_64-w64-mingw32\include\GL (next to gl.h, glaux.h, glu.h)Lib files libfreeglut.a and libglfwdll.a are placed in \MinGW64\x86_64-w64-mingw32\lib (next to libglu32.a, libopengl32.a)64-bit DLLs glfw.dll and freeglut64.dll are placed in \windows and \windows\system32 (next to opengl32.dll, glu32.dll)freeglut64.dll and glfw.dll both work, I believe -- at least most of their example programs do after installing the DLLs.Everything should be in place, right? Now first for the successful binding (that I don't need), freeglut -- when I go get -x github.com/zombiezen/Go-GLUT/glut, all is built just fine and I can successfully create a glut window and show a triangle in a Windows test.exe compiled from a .go source file. Thanks to -x, go get shows what it does to build: To get to this point, I had to slightly modify glut.go as follows: So, to summarize, this builds fine, can be imported and linked from Go and used in code.Now for GLFW. The GO file reads extremely similar to glut.go: The #define GLFW_DLL is so that no static linking happens. Here's the output of go get -x github.com/jteeuwen/glfw however: Yes, it's a mouthful -- but essentially just always the same error, and fairly late in the build procedure. Notice if #define GLFW_DLL isn't defined, I get essentially the same output except without the __imp_ prefixes -- and static linking is neither encourage for Go nor is it desirable for this particular use-case.Now, when gcc complains about ""undefined reference to"", from what I google there could be various reasons...it cannot be failure to find the DLL's -- they're in the appropriate places and for freeglut64.dll it worksit cannot be failure to find the .a libs -- they're in the appropriate places, and libfreeglut.a works, and if I change -lglfwdll to -lblafoobar then gcc fails much earlier and rightly complains ""blafoobar not found"" -- so it does find libglfwdll.a.order of lib dependencies? I tried -lglfwdll as the first lib (before -lglu32 -lopengl32) and as the last (after those two), no difference.is the Golang glfw binding faulty? Don't think so, works for others, including under Windows for chsc (32-bit though)TL;DR -- under Windows 64-bit, Go 1.0.1 64-bit fully patched, CGO successfully generates stuff to feed into GCC for both freeglut and glfw. GCC then happily eats that stuff to build the freeglut binding, but rejects it for building the glfw binding, with ""undefined reference to"" for all C.funcs(). Both libfreeglut and libglfwdll are correctly built and installed as 64-bit DLLs and .h/.a libs correctly located. What could be the cause? <code>  WORK=C:\Users\roxor\AppData\Local\Temp\go-build292908674mkdir -p $WORK\github.com\zombiezen\Go-GLUT\glut\_obj\cd C:\Go\src\pkg\github.com\zombiezen\Go-GLUT\glutC:\Go\pkg\tool\windows_amd64\cgo.exe -objdir $WORK\github.com\zombiezen\Go-GLUT\glut\_obj\ -- -I $WORK\github.com\zombiezen\Go-GLUT\glut\_obj\ glut.goC:\Go\pkg\tool\windows_amd64\6c.exe -FVw -I $WORK\github.com\zombiezen\Go-GLUT\glut\_obj\ -I C:\Go\pkg\windows_amd64 -o $WORK\github.com\zombiezen\Go-GLUT\glut\_obj\_cgo_defun.6 -DGOOS_windows -DGOARCH_amd64 $WORK\github.com\zombiezen\Go-GLUT\glut\_obj\_cgo_defun.cgcc -I . -g -O2 -m64 -mthreads -I $WORK\github.com\zombiezen\Go-GLUT\glut\_obj\ -o $WORK\github.com\zombiezen\Go-GLUT\glut\_obj\_cgo_main.o -c $WORK\github.com\zombiezen\Go-GLUT\glut\_obj\_cgo_main.cgcc -I . -g -O2 -m64 -mthreads -I $WORK\github.com\zombiezen\Go-GLUT\glut\_obj\ -o $WORK\github.com\zombiezen\Go-GLUT\glut\_obj\_cgo_export.o -c $WORK\github.com\zombiezen\Go-GLUT\glut\_obj\_cgo_export.cgcc -I . -g -O2 -m64 -mthreads -I $WORK\github.com\zombiezen\Go-GLUT\glut\_obj\ -o $WORK\github.com\zombiezen\Go-GLUT\glut\_obj\glut.cgo2.o -c $WORK\github.com\zombiezen\Go-GLUT\glut\_obj\glut.cgo2.cgcc -I . -g -O2 -m64 -mthreads -I $WORK\github.com\zombiezen\Go-GLUT\glut\_obj\ -o $WORK\github.com\zombiezen\Go-GLUT\glut\_obj\support.o -c .\support.cgcc -I . -g -O2 -m64 -mthreads -o $WORK\github.com\zombiezen\Go-GLUT\glut\_obj\_cgo_.o $WORK\github.com\zombiezen\Go-GLUT\glut\_obj\_cgo_main.o $WORK\github.com\zombiezen\Go-GLUT\glut\_obj\_cgo_export.o $WORK\github.com\zombiezen\Go-GLUT\glut\_obj\glut.cgo2.o $WORK\github.com\zombiezen\Go-GLUT\glut\_obj\support.o -lfreeglutC:\Go\pkg\tool\windows_amd64\cgo.exe -objdir $WORK\github.com\zombiezen\Go-GLUT\glut\_obj\ -dynimport $WORK\github.com\zombiezen\Go-GLUT\glut\_obj\_cgo_.o -dynout $WORK\github.com\zombiezen\Go-GLUT\glut\_obj\_cgo_import.cC:\Go\pkg\tool\windows_amd64\6c.exe -FVw -I $WORK\github.com\zombiezen\Go-GLUT\glut\_obj\ -I C:\Go\pkg\windows_amd64 -o $WORK\github.com\zombiezen\Go-GLUT\glut\_obj\_cgo_import.6 -DGOOS_windows -DGOARCH_amd64 $WORK\github.com\zombiezen\Go-GLUT\glut\_obj\_cgo_import.cgcc -I . -g -O2 -m64 -mthreads -o $WORK\github.com\zombiezen\Go-GLUT\glut\_obj\_all.o $WORK\github.com\zombiezen\Go-GLUT\glut\_obj\_cgo_export.o $WORK\github.com\zombiezen\Go-GLUT\glut\_obj\glut.cgo2.o $WORK\github.com\zombiezen\Go-GLUT\glut\_obj\support.o -Wl,-r -nostdlib -lgcc -lmingwex -lmingw32C:\Go\pkg\tool\windows_amd64\6g.exe -o $WORK\github.com\zombiezen\Go-GLUT\glut\_obj\_go_.6 -p github.com/zombiezen/Go-GLUT/glut -D _/C_/Go/src/pkg/github.com/zombiezen/Go-GLUT/glut -I $WORK $WORK\github.com\zombiezen\Go-GLUT\glut\_obj\_cgo_gotypes.go $WORK\github.com\zombiezen\Go-GLUT\glut\_obj\glut.cgo1.goC:\Go\pkg\tool\windows_amd64\pack.exe grc $WORK\github.com\zombiezen\Go-GLUT\glut.a $WORK\github.com\zombiezen\Go-GLUT\glut\_obj\_go_.6 $WORK\github.com\zombiezen\Go-GLUT\glut\_obj\_cgo_import.6 $WORK\github.com\zombiezen\Go-GLUT\glut\_obj\_cgo_defun.6 $WORK\github.com\zombiezen\Go-GLUT\glut\_obj\_all.omkdir -p C:\Go\pkg\windows_amd64\github.com\zombiezen\Go-GLUT\cp $WORK\github.com\zombiezen\Go-GLUT\glut.a C:\Go\pkg\windows_amd64\github.com\zombiezen\Go-GLUT\glut.a // # include <GL/glut.h>// #cgo windows LDFLAGS: -lfreeglut// #include <stdlib.h>// #include ""support.h""import ""C"" //#cgo windows LDFLAGS: -lglfwdll -lglu32 -lopengl32//#include <stdlib.h>//#define GLFW_DLL//#include <GL/glfw.h>import ""C"" WORK=C:\Users\roxor\AppData\Local\Temp\go-build499107422mkdir -p $WORK\github.com\jteeuwen\glfw\_obj\cd C:\Go\src\pkg\github.com\jteeuwen\glfwC:\Go\pkg\tool\windows_amd64\cgo.exe -objdir $WORK\github.com\jteeuwen\glfw\_obj\ -- -I $WORK\github.com\jteeuwen\glfw\_obj\ callback.go glfw.go image.go vidmode.goC:\Go\pkg\tool\windows_amd64\6c.exe -FVw -I $WORK\github.com\jteeuwen\glfw\_obj\ -I C:\Go\pkg\windows_amd64 -o $WORK\github.com\jteeuwen\glfw\_obj\_cgo_defun.6 -DGOOS_windows -DGOARCH_amd64 $WORK\github.com\jteeuwen\glfw\_obj\_cgo_defun.cgcc -I . -g -O2 -m64 -mthreads -I $WORK\github.com\jteeuwen\glfw\_obj\ -o $WORK\github.com\jteeuwen\glfw\_obj\_cgo_main.o -c $WORK\github.com\jteeuwen\glfw\_obj\_cgo_main.cgcc -I . -g -O2 -m64 -mthreads -I $WORK\github.com\jteeuwen\glfw\_obj\ -o $WORK\github.com\jteeuwen\glfw\_obj\_cgo_export.o -c $WORK\github.com\jteeuwen\glfw\_obj\_cgo_export.cgcc -I . -g -O2 -m64 -mthreads -I $WORK\github.com\jteeuwen\glfw\_obj\ -o $WORK\github.com\jteeuwen\glfw\_obj\callback.cgo2.o -c $WORK\github.com\jteeuwen\glfw\_obj\callback.cgo2.cgcc -I . -g -O2 -m64 -mthreads -I $WORK\github.com\jteeuwen\glfw\_obj\ -o $WORK\github.com\jteeuwen\glfw\_obj\glfw.cgo2.o -c $WORK\github.com\jteeuwen\glfw\_obj\glfw.cgo2.cgcc -I . -g -O2 -m64 -mthreads -I $WORK\github.com\jteeuwen\glfw\_obj\ -o $WORK\github.com\jteeuwen\glfw\_obj\image.cgo2.o -c $WORK\github.com\jteeuwen\glfw\_obj\image.cgo2.cgcc -I . -g -O2 -m64 -mthreads -I $WORK\github.com\jteeuwen\glfw\_obj\ -o $WORK\github.com\jteeuwen\glfw\_obj\vidmode.cgo2.o -c $WORK\github.com\jteeuwen\glfw\_obj\vidmode.cgo2.cgcc -I . -g -O2 -m64 -mthreads -I $WORK\github.com\jteeuwen\glfw\_obj\ -o $WORK\github.com\jteeuwen\glfw\_obj\callback.o -c .\callback.cgcc -I . -g -O2 -m64 -mthreads -o $WORK\github.com\jteeuwen\glfw\_obj\_cgo_.o $WORK\github.com\jteeuwen\glfw\_obj\_cgo_main.o $WORK\github.com\jteeuwen\glfw\_obj\_cgo_export.o $WORK\github.com\jteeuwen\glfw\_obj\callback.cgo2.o $WORK\github.com\jteeuwen\glfw\_obj\glfw.cgo2.o $WORK\github.com\jteeuwen\glfw\_obj\image.cgo2.o $WORK\github.com\jteeuwen\glfw\_obj\vidmode.cgo2.o $WORK\github.com\jteeuwen\glfw\_obj\callback.o -lglfwdll -lglu32 -lopengl32# github.com/jteeuwen/glfw$WORK\github.com\jteeuwen\glfw\_obj\glfw.cgo2.o: In function `_cgo_680190d759a2_Cfunc_glfwGetNumberOfProcessors':C:\Go\src\pkg\github.com\jteeuwen\glfw/glfw.go:39: undefined reference to `__imp_glfwGetNumberOfProcessors'$WORK\github.com\jteeuwen\glfw\_obj\glfw.cgo2.o: In function `_cgo_680190d759a2_Cfunc_glfwGetKey':C:\Go\src\pkg\github.com\jteeuwen\glfw/glfw.go:51: undefined reference to `__imp_glfwGetKey'$WORK\github.com\jteeuwen\glfw\_obj\glfw.cgo2.o: In function `_cgo_680190d759a2_Cfunc_glfwSetTime':C:\Go\src\pkg\github.com\jteeuwen\glfw/glfw.go:60: undefined reference to `__imp_glfwSetTime'$WORK\github.com\jteeuwen\glfw\_obj\glfw.cgo2.o: In function `_cgo_680190d759a2_Cfunc_glfwExtensionSupported':C:\Go\src\pkg\github.com\jteeuwen\glfw/glfw.go:71: undefined reference to `__imp_glfwExtensionSupported'$WORK\github.com\jteeuwen\glfw\_obj\glfw.cgo2.o: In function `_cgo_680190d759a2_Cfunc_glfwPollEvents':C:\Go\src\pkg\github.com\jteeuwen\glfw/glfw.go:80: undefined reference to `__imp_glfwPollEvents'$WORK\github.com\jteeuwen\glfw\_obj\glfw.cgo2.o: In function `_cgo_680190d759a2_Cfunc_glfwGetMousePos':C:\Go\src\pkg\github.com\jteeuwen\glfw/glfw.go:90: undefined reference to `__imp_glfwGetMousePos'$WORK\github.com\jteeuwen\glfw\_obj\glfw.cgo2.o: In function `_cgo_680190d759a2_Cfunc_glfwGetJoystickParam':C:\Go\src\pkg\github.com\jteeuwen\glfw/glfw.go:102: undefined reference to `__imp_glfwGetJoystickParam'$WORK\github.com\jteeuwen\glfw\_obj\glfw.cgo2.o: In function `_cgo_680190d759a2_Cfunc_glfwGetProcAddress':C:\Go\src\pkg\github.com\jteeuwen\glfw/glfw.go:112: undefined reference to `__imp_glfwGetProcAddress'$WORK\github.com\jteeuwen\glfw\_obj\glfw.cgo2.o: In function `_cgo_680190d759a2_Cfunc_glfwGetGLVersion':C:\Go\src\pkg\github.com\jteeuwen\glfw/glfw.go:123: undefined reference to `__imp_glfwGetGLVersion'$WORK\github.com\jteeuwen\glfw\_obj\glfw.cgo2.o: In function `_cgo_680190d759a2_Cfunc_glfwSetMouseWheel':C:\Go\src\pkg\github.com\jteeuwen\glfw/glfw.go:133: undefined reference to `__imp_glfwSetMouseWheel'$WORK\github.com\jteeuwen\glfw\_obj\glfw.cgo2.o: In function `_cgo_680190d759a2_Cfunc_glfwGetJoystickPos':C:\Go\src\pkg\github.com\jteeuwen\glfw/glfw.go:148: undefined reference to `__imp_glfwGetJoystickPos'$WORK\github.com\jteeuwen\glfw\_obj\glfw.cgo2.o: In function `_cgo_680190d759a2_Cfunc_glfwOpenWindow':C:\Go\src\pkg\github.com\jteeuwen\glfw/glfw.go:168: undefined reference to `__imp_glfwOpenWindow'$WORK\github.com\jteeuwen\glfw\_obj\glfw.cgo2.o: In function `_cgo_680190d759a2_Cfunc_glfwSetMousePos':C:\Go\src\pkg\github.com\jteeuwen\glfw/glfw.go:178: undefined reference to `__imp_glfwSetMousePos'$WORK\github.com\jteeuwen\glfw\_obj\glfw.cgo2.o: In function `_cgo_680190d759a2_Cfunc_glfwSwapInterval':C:\Go\src\pkg\github.com\jteeuwen\glfw/glfw.go:188: undefined reference to `__imp_glfwSwapInterval'$WORK\github.com\jteeuwen\glfw\_obj\glfw.cgo2.o: In function `_cgo_680190d759a2_Cfunc_glfwGetMouseButton':C:\Go\src\pkg\github.com\jteeuwen\glfw/glfw.go:209: undefined reference to `__imp_glfwGetMouseButton'$WORK\github.com\jteeuwen\glfw\_obj\glfw.cgo2.o: In function `_cgo_680190d759a2_Cfunc_glfwSetWindowTitle':C:\Go\src\pkg\github.com\jteeuwen\glfw/glfw.go:218: undefined reference to `__imp_glfwSetWindowTitle'$WORK\github.com\jteeuwen\glfw\_obj\glfw.cgo2.o: In function `_cgo_680190d759a2_Cfunc_glfwGetVideoModes':C:\Go\src\pkg\github.com\jteeuwen\glfw/glfw.go:231: undefined reference to `__imp_glfwGetVideoModes'$WORK\github.com\jteeuwen\glfw\_obj\glfw.cgo2.o: In function `_cgo_680190d759a2_Cfunc_glfwGetJoystickButtons':C:\Go\src\pkg\github.com\jteeuwen\glfw/glfw.go:246: undefined reference to `__imp_glfwGetJoystickButtons'$WORK\github.com\jteeuwen\glfw\_obj\glfw.cgo2.o: In function `_cgo_680190d759a2_Cfunc_glfwRestoreWindow':C:\Go\src\pkg\github.com\jteeuwen\glfw/glfw.go:255: undefined reference to `__imp_glfwRestoreWindow'$WORK\github.com\jteeuwen\glfw\_obj\glfw.cgo2.o: In function `_cgo_680190d759a2_Cfunc_glfwInit':C:\Go\src\pkg\github.com\jteeuwen\glfw/glfw.go:265: undefined reference to `__imp_glfwInit'$WORK\github.com\jteeuwen\glfw\_obj\glfw.cgo2.o: In function `_cgo_680190d759a2_Cfunc_glfwSwapBuffers':C:\Go\src\pkg\github.com\jteeuwen\glfw/glfw.go:274: undefined reference to `__imp_glfwSwapBuffers'$WORK\github.com\jteeuwen\glfw\_obj\glfw.cgo2.o: In function `_cgo_680190d759a2_Cfunc_glfwGetMouseWheel':C:\Go\src\pkg\github.com\jteeuwen\glfw/glfw.go:284: undefined reference to `__imp_glfwGetMouseWheel'$WORK\github.com\jteeuwen\glfw\_obj\glfw.cgo2.o: In function `_cgo_680190d759a2_Cfunc_glfwIconifyWindow':C:\Go\src\pkg\github.com\jteeuwen\glfw/glfw.go:293: undefined reference to `__imp_glfwIconifyWindow'$WORK\github.com\jteeuwen\glfw\_obj\glfw.cgo2.o: In function `_cgo_680190d759a2_Cfunc_glfwWaitEvents':C:\Go\src\pkg\github.com\jteeuwen\glfw/glfw.go:302: undefined reference to `__imp_glfwWaitEvents'$WORK\github.com\jteeuwen\glfw\_obj\glfw.cgo2.o: In function `_cgo_680190d759a2_Cfunc_glfwSetWindowPos':C:\Go\src\pkg\github.com\jteeuwen\glfw/glfw.go:312: undefined reference to `__imp_glfwSetWindowPos'$WORK\github.com\jteeuwen\glfw\_obj\glfw.cgo2.o: In function `_cgo_680190d759a2_Cfunc_glfwGetWindowSize':C:\Go\src\pkg\github.com\jteeuwen\glfw/glfw.go:322: undefined reference to `__imp_glfwGetWindowSize'$WORK\github.com\jteeuwen\glfw\_obj\glfw.cgo2.o: In function `_cgo_680190d759a2_Cfunc_glfwDisable':C:\Go\src\pkg\github.com\jteeuwen\glfw/glfw.go:332: undefined reference to `__imp_glfwDisable'$WORK\github.com\jteeuwen\glfw\_obj\glfw.cgo2.o: In function `_cgo_680190d759a2_Cfunc_glfwGetWindowParam':C:\Go\src\pkg\github.com\jteeuwen\glfw/glfw.go:344: undefined reference to `__imp_glfwGetWindowParam'$WORK\github.com\jteeuwen\glfw\_obj\glfw.cgo2.o: In function `_cgo_680190d759a2_Cfunc_glfwCloseWindow':C:\Go\src\pkg\github.com\jteeuwen\glfw/glfw.go:353: undefined reference to `__imp_glfwCloseWindow'$WORK\github.com\jteeuwen\glfw\_obj\glfw.cgo2.o: In function `_cgo_680190d759a2_Cfunc_glfwOpenWindowHint':C:\Go\src\pkg\github.com\jteeuwen\glfw/glfw.go:363: undefined reference to `__imp_glfwOpenWindowHint'$WORK\github.com\jteeuwen\glfw\_obj\glfw.cgo2.o: In function `_cgo_680190d759a2_Cfunc_glfwSleep':C:\Go\src\pkg\github.com\jteeuwen\glfw/glfw.go:372: undefined reference to `__imp_glfwSleep'$WORK\github.com\jteeuwen\glfw\_obj\glfw.cgo2.o: In function `_cgo_680190d759a2_Cfunc_glfwEnable':C:\Go\src\pkg\github.com\jteeuwen\glfw/glfw.go:382: undefined reference to `__imp_glfwEnable'$WORK\github.com\jteeuwen\glfw\_obj\glfw.cgo2.o: In function `_cgo_680190d759a2_Cfunc_glfwSetWindowSize':C:\Go\src\pkg\github.com\jteeuwen\glfw/glfw.go:392: undefined reference to `__imp_glfwSetWindowSize'$WORK\github.com\jteeuwen\glfw\_obj\glfw.cgo2.o: In function `_cgo_680190d759a2_Cfunc_glfwTerminate':C:\Go\src\pkg\github.com\jteeuwen\glfw/glfw.go:411: undefined reference to `__imp_glfwTerminate'$WORK\github.com\jteeuwen\glfw\_obj\glfw.cgo2.o: In function `_cgo_680190d759a2_Cfunc_glfwGetDesktopMode':C:\Go\src\pkg\github.com\jteeuwen\glfw/glfw.go:420: undefined reference to `__imp_glfwGetDesktopMode'$WORK\github.com\jteeuwen\glfw\_obj\glfw.cgo2.o: In function `_cgo_680190d759a2_Cfunc_glfwGetTime':C:\Go\src\pkg\github.com\jteeuwen\glfw/glfw.go:429: undefined reference to `__imp_glfwGetTime'$WORK\github.com\jteeuwen\glfw\_obj\image.cgo2.o: In function `_cgo_680190d759a2_Cfunc_glfwFreeImage':C:\Go\src\pkg\github.com\jteeuwen\glfw/image.go:38: undefined reference to `__imp_glfwFreeImage'$WORK\github.com\jteeuwen\glfw\_obj\image.cgo2.o: In function `_cgo_680190d759a2_Cfunc_glfwReadImage':C:\Go\src\pkg\github.com\jteeuwen\glfw/image.go:52: undefined reference to `__imp_glfwReadImage'$WORK\github.com\jteeuwen\glfw\_obj\image.cgo2.o: In function `_cgo_680190d759a2_Cfunc_glfwLoadTextureImage2D':C:\Go\src\pkg\github.com\jteeuwen\glfw/image.go:65: undefined reference to `__imp_glfwLoadTextureImage2D'$WORK\github.com\jteeuwen\glfw\_obj\image.cgo2.o: In function `_cgo_680190d759a2_Cfunc_glfwLoadMemoryTexture2D':C:\Go\src\pkg\github.com\jteeuwen\glfw/image.go:78: undefined reference to `__imp_glfwLoadMemoryTexture2D'$WORK\github.com\jteeuwen\glfw\_obj\image.cgo2.o: In function `_cgo_680190d759a2_Cfunc_glfwLoadTexture2D':C:\Go\src\pkg\github.com\jteeuwen\glfw/image.go:91: undefined reference to `__imp_glfwLoadTexture2D'$WORK\github.com\jteeuwen\glfw\_obj\image.cgo2.o: In function `_cgo_680190d759a2_Cfunc_glfwReadMemoryImage':C:\Go\src\pkg\github.com\jteeuwen\glfw/image.go:107: undefined reference to `__imp_glfwReadMemoryImage'$WORK\github.com\jteeuwen\glfw\_obj\callback.o: In function `setWindowSizeCB':C:/Go/src/pkg/github.com/jteeuwen/glfw/callback.c:9: undefined reference to `__imp_glfwSetWindowSizeCallback'$WORK\github.com\jteeuwen\glfw\_obj\callback.o: In function `setWindowCloseCB':C:/Go/src/pkg/github.com/jteeuwen/glfw/callback.c:14: undefined reference to `__imp_glfwSetWindowCloseCallback'$WORK\github.com\jteeuwen\glfw\_obj\callback.o: In function `setWindowRefreshCB':C:/Go/src/pkg/github.com/jteeuwen/glfw/callback.c:19: undefined reference to `__imp_glfwSetWindowRefreshCallback'$WORK\github.com\jteeuwen\glfw\_obj\callback.o: In function `setMouseButtonCB':C:/Go/src/pkg/github.com/jteeuwen/glfw/callback.c:24: undefined reference to `__imp_glfwSetMouseButtonCallback'$WORK\github.com\jteeuwen\glfw\_obj\callback.o: In function `setMousePosCB':C:/Go/src/pkg/github.com/jteeuwen/glfw/callback.c:29: undefined reference to `__imp_glfwSetMousePosCallback'$WORK\github.com\jteeuwen\glfw\_obj\callback.o: In function `setMouseWheelCB':C:/Go/src/pkg/github.com/jteeuwen/glfw/callback.c:34: undefined reference to `__imp_glfwSetMouseWheelCallback'$WORK\github.com\jteeuwen\glfw\_obj\callback.o: In function `setKeyCB':C:/Go/src/pkg/github.com/jteeuwen/glfw/callback.c:39: undefined reference to `__imp_glfwSetKeyCallback'$WORK\github.com\jteeuwen\glfw\_obj\callback.o: In function `setCharCB':C:/Go/src/pkg/github.com/jteeuwen/glfw/callback.c:44: undefined reference to `__imp_glfwSetCharCallback'collect2: ld returned 1 exit status","DLL-linking via Windows cgo->gcc->ld gives ""undefined-reference-to-(function)"" errors"
How can I launch a process that is not a file in Go," I want to open a web browser: and I get the error Edit: What I want to achieve is the same as in Windows and C# when you do: With it a new instance of your default browser will launch showing the URL <code>  c, err := exec.Command(""http://localhost:4001"").Output()if err != nil { fmt.Printf(""ERROR: %v, %v\n"",err,c)} else { fmt.Printf(""OK:%v\n"",c)} ERROR: exec: ""http://localhost:4001"": file does not exist Process.Start(""http://localhost:4001"")",How can I launch a process that is not a file in Go (e.g. open a web page)
How do I configure go to use a proxy?," I want to run go install to install the tour, but I can't find the option to use a proxy for internet access. I don't need this just for the tour but for developing in Go in general. How do I configure Go to use a proxy. <code> ",How do I configure go command to use a proxy?
How do I configure Go to use a proxy?," I want to run go install to install the tour, but I can't find the option to use a proxy for internet access. I don't need this just for the tour but for developing in Go in general. How do I configure Go to use a proxy. <code> ",How do I configure go command to use a proxy?
How to import and use different packages of the same name in Go language?," For example, I want to use both text/template and html/template in one source file.But the code below throw errors. <code>  import ( ""fmt"" ""net/http"" ""text/template"" // template redeclared as imported package name ""html/template"" // template redeclared as imported package name)func handler_html(w http.ResponseWriter, r *http.Request) { t_html, err := html.template.New(""foo"").Parse(`{{define ""T""}}Hello, {{.}}!{{end}}`) t_text, err := text.template.New(""foo"").Parse(`{{define ""T""}}Hello, {{.}}!{{end}}`)}",How to import and use different packages of the same name
"What is this ""foo.(bar.Baz)"" thing in Go code?"," For instance, in this answer: https://stackoverflow.com/a/10385867/20654 What is that err.(*exec.ExitError) called? How does it work? <code>  ...if exiterr, ok := err.(*exec.ExitError); ok {...","What is this ""err.(*exec.ExitError)"" thing in Go code?"
go language: build and reference my own local package," I'm playing with Google Go and I'm having fun (!), but I'm having some problems with package subsystem.I'm running Go 1.0.1 on Mac OS X Lion. I've build also various single file programs without problems (I've also build a small webapp using html/templates without problems and it compiles and runs without any error).I've defined a ""reusable"" package (even.go): and a consumer program (useeven.go): But when I compile the ""library"" using I got nothing... No errors, no message... What happens?How should I do this? <code>  package evenfunc Even(i int) bool { return i % 2 == 0}func Odd(i int) bool { return i % 2 == 1} package mainimport ( ""./even"" ""fmt"")func main() { a := 5 b := 6 fmt.Printf(""%d is even %v?\n"", a, even.Even(a)) fmt.Printf(""%d is odd %v?\n"", b, even.Odd(b))} go build even.go",Build and reference my own local package in Go
If it is possible to use Go's Buffered Channel as a thread-safe queue?," I want to find a queue structure (a data container) whose elements must be first-in-first-out. It is important for me that the structure must be thread-safe. I'm going to use this data container as something like a task or connection pool.I know a buffered channel is thread-safe, but I wonder if it works as FIFO, especially in a concurrent situation.And if it is possible to use buffered channel as a thread-safe queue, do I need to worry about its efficiency? <code> ",Is it possible to use Go's buffered channel as a thread-safe queue?
Does a Go's channel return two values?," I saw some code in this link, and got confused:http://www.darkcoding.net/software/go-lang-after-four-months/What's the meaning of the second value(ok)? <code>  for self.isRunning { select { case serverData, ok = <-fromServer: // What's the meaning of the second value(ok)? if ok { self.onServer(serverData) } else { self.isRunning = false } case userInput, ok = <-fromUser: if ok { self.onUser(userInput) } else { self.isRunning = false } }}",Does a channel return two values?
Does LiteIDE work at all?," I'm trying out LiteIDE for golang and there are no docs to speak of and apparently no forum. I've set the Env for my environment and go installation. When I try to use it on the hello.go file (as a file or a a project) all I get is (Sorry for the formatting but the Code Sample tags in this forum can't handle XML blocks.)Lots of other people have seen the same thing.What are the TARGETPATH and TARGETARGS that is shown?Is there any documentation on how to configure LiteIDE? <code>  <action id=""Run"" cmd=""${TARGETPATH}"" args=""${TARGETARGS}""><start="" "" workdir=""C:/liteide.projects""/><error msg=""process failed to start"" /></action>",Does LiteIDE x14 work at all?
Ensure a type implements an interface at compile time," How can I ensure that a type implements an interface at compile time? The typical way to do this is by failure to assign to support interfaces from that type, however I have several types that are only converted dynamically. At runtime this generates very gruff error messages, without the better diagnostics given for compile time errors. It's also very inconvenient to find at run time that types I expected to support interfaces, do in fact not. <code> ",Ensure a type implements an interface at compile time in Go
How to check whether a file or directory denoted by a path exists in golang?," I want to check the existence of file ./conf/app.ini in my Go code, but I can't find a good way to do that. I know there is a method of File in Java: public boolean exists(), which returns true if the file or directory exists.But how can this be done in Go? <code> ",How to check whether a file or directory exists?
How to check whether a file or directory denoted by a path exists in Golang?," I want to check the existence of file ./conf/app.ini in my Go code, but I can't find a good way to do that. I know there is a method of File in Java: public boolean exists(), which returns true if the file or directory exists.But how can this be done in Go? <code> ",How to check whether a file or directory exists?
Code coverage tool for Go?, Has anyone succeeded in generating code coverage for Go unit tests? I can't find a tool for that on the web. <code> ,How to measure test coverage in Go
How to measure code coverage in Golang?, Has anyone succeeded in generating code coverage for Go unit tests? I can't find a tool for that on the web. <code> ,How to measure test coverage in Go
Go: Disable a log.Logger?," I have some heavily instrumented code that makes use of the log package. Now it's come time to turn off the logging, and I can't determine how to turn off the standard logger.Have I missed something? Should I be checking a flag before making log calls, or commenting them out in production? <code> ",How to disable a log.Logger
golang conditional compilation," I've got a trouble with conditional compilation in Go 1.Here is my test code. Is there anything I misunderstand about the ""// +build"" constraint and the ""-tags"" flag?main1.go main2.go when running ""go build"", I still got compile error <code>  // +build main1package mainimport ( ""fmt"")func main() { fmt.Println(""This is main 1"")} // +build main2package mainimport ( ""fmt"")func main() { fmt.Println(""This is main 2"")} $ go build -tags 'main1'# test./main2.go:8: main redeclared in this block previous declaration at ./main1.go:8",Golang conditional compilation
How can a gc find out about object references done from the stack?," In languages with automatic garbage collection like Haskell or Go, how can the garbage collector find out which values stored on the stack are pointers to memory and which are just numbers? If the garbage collector just scans the stack and assumes all addresses to be references to objects, a lot of objects might get incorrectly marked as reachable.Obviously, one could add a value to the top of each stack frame that described how many of the next values are pointers, but wouldn't that cost a lot of performance?How is it done in reality? <code> ",How can a garbage collector find out about object references done from the stack?
Get name of function using Google Go's reflection," I'm trying to use Go's reflection system to retrieve the name of a function but I get an empty string when calling the Name method on its type. Is this the expected behavior?This is a simple example of how I approach the problem: <code>  package mainimport ""fmt""import ""reflect""func main() { typ := reflect.TypeOf(main) name := typ.Name() fmt.Println(""Name of function"" + name)}",Get name of function using reflection
Get name of function using reflection in Golang," I'm trying to use Go's reflection system to retrieve the name of a function but I get an empty string when calling the Name method on its type. Is this the expected behavior?This is a simple example of how I approach the problem: <code>  package mainimport ""fmt""import ""reflect""func main() { typ := reflect.TypeOf(main) name := typ.Name() fmt.Println(""Name of function"" + name)}",Get name of function using reflection
How to install mgo from download sources?," I'm trying to install mgo which is a mongo-driver written in golang. The standard command: But it failed because of some cert issues.So I manually download the sources of mgo to local E:\mgo, but I don't know to how install it.The file tree: I tried: It reports: But if I try to install bson first: It reports another error: So, what's the correct command to install it? <code>  go get launchpad.net/mgo .bzr branch lock branch-lock checkout lock repository indices lock obsolete_packs packs uploadbsontestdb cd mgogo install auth.go:34:2: import ""launchpad.net/mgo/bson"": cannot find package cd bsongo install go install: no install location for _/E_/mgo/bson",How to install golang 3rd-party projects from download sources?
"golang: built-in ""html/template"" or ""mustache"", which one shall I use?"," I'm new to golang, and want to use it to build a web app.I found it has built-in html/template, which can render html template with specified data, and there is also a mustache port which seems good.I'm not sure which one shall I use. Please give me some advices or comparations between them to let me decide, thank you. <code> ","Built-in ""html/template"" or ""mustache"", which one shall I use?"
How to pipe several commands?," How can I pipe several external commands together in Go? I've tried this code but I get an error that says exit status 1. <code>  package mainimport ( ""io"" ""log"" ""os"" ""os/exec"")func main() { c1 := exec.Command(""ls"") stdout1, err := c1.StdoutPipe() if err != nil { log.Fatal(err) } if err = c1.Start(); err != nil { log.Fatal(err) } if err = c1.Wait(); err != nil { log.Fatal(err) } c2 := exec.Command(""wc"", ""-l"") c2.Stdin = stdout1 stdout2, err := c2.StdoutPipe() if err != nil { log.Fatal(err) } if err = c2.Start(); err != nil { log.Fatal(err) } if err = c2.Wait(); err != nil { log.Fatal(err) } io.Copy(os.Stdout, stdout2)}",How to pipe several commands in Go?
Adding a new function to an existing (standard) package," I'm writing some code that needs functionality that is almost satisfied by the ReadBytes method in the bufio package. Specifically, that method reads from a Reader until it encounters a particular byte. I need something that reads till it encounters one out of couple of bytes (space, newline and tab mainly).I looked at the source for the library and I know what to do if I have access to the internal buffer used by bufio structs. Is there any way I could ""monkey patch"" the package and add another method or two to it? Or another way to get the functionality I need? <code> ",Adding a new method to an existing (standard) type
Use []byte or string?," Frequently in writing Go applications, I find myself with the choice to use []byte or string. Apart from the obvious mutability of []byte, how do I decide which one to use?I have several use cases for examples:A function returns a new []byte. Since the slice capacity is fixed, what reason is there to not return a string?[]byte are not printed as nicely as string by default, so I often find myself casting to string for logging purposes. Should it always have been a string?When prepending []byte, a new underlying array is always created. If the data to prepend is constant, why should this not be a string? <code> ",When to use []byte or string in Go?
Chaining function calls in GO," Let us say we want to implement following computation:outval / err = f3(f3(f1(inval)) where each of f1, f2, f3 can fail with an error at that time we stop the computation and set err to error returned by the failing function. (Of course, nesting can be arbitrarily long)In languages like C++/JAVA/C# it can be easily done by having f1, f2 and f3 throw an exception and enclosing the computation in a try-catch block, while in languages like Haskell we can use monads instead.Now I am trying to implement it in GO and the only approach I can think of is obvious if-else ladder which is rather verbose. I don't have issue if we can't nest the calls, but in my opinion adding error check after each line in code looks ugly and it breaks the flow. I would like to know if there is any better way of doing it.Edit: Editing as per the comment by peterSOBelow is the concrete example and straightforward implementation What I am trying to illustrate is, function calc does some computation possibly with the help of library functions that can fail and semantics is if any call fails calc propagates the error to the caller (similar to not handling the exception). In my opinion, code for calc is ugly.Between for this particular case where all library functions have exactly same signature, we can make the code better (I am using idea from http://golang.org/doc/articles/wiki/#tmp_269) Then we can redefine calc as or as But without generics support, I am not sure how I can use this approach for any set of library functions. <code>  package mainimport ""fmt""func f1(in int) (out int, err error) { return in + 1, err}func f2(in int) (out int, err error) { return in + 2, err}func f3(in int) (out int, err error) { return in + 3, err}func calc(in int) (out int, err error) { var temp1, temp2 int temp1, err = f1(in) if err != nil { return temp1, err } temp2, err = f2(temp1) if err != nil { return temp2, err } return f3(temp2)}func main() { inval := 0 outval, err := calc3(inval) fmt.Println(inval, outval, err)} func saferun(f func (int) (int, error)) func (int, error) (int, error) { return func (in int, err error) (int, error) { if err != nil { return in, err } return f(in) }} func calc(in int) (out int, err error) { return saferun(f3)(saferun(f2)(f1(in)))} func calc(in int) (out int, err error) { sf2 := saferun(f2) sf3 := saferun(f3) return sf3(sf2(f1(in)))}",Nesting function calls in GO
Map with concurrent acces," When you use a map in a program with concurrent access, is there any need to use a mutex in functions to read values? <code> ",Map with concurrent access
"Why does Go have a ""goto"" statement"," I was surprised to find that Go has a 'goto' statement. I've always been taught that 'goto' statements are a thing of the past and evil for it occludes the actual flow of a program, and that functions or methods are always a better way of controlling flow.I must be missing something. Why did Google include it? <code> ","Why does Go have a ""goto"" statement?"
"In Go, does a break statement break from a switch/select?"," I know that switch/select statements break automatically after every case. I am wondering, in the following code: Does the break statement exit the for loop or just the switch block? <code>  for { switch sometest() { case 0: dosomething() case 1: break default: dosomethingelse() }}",Does a break statement break from a switch/select?
golang json and dealing with unexported fields," Is there a technical reason why unexported fields are not included by encoding/json? If not and it is an arbitrary decision could there be an additional back door option (say '+') to include even though unexported?Requiring client code to export to get this functionality feels unfortunate, especially if lower case is providing encapsulation or the decision to marshal structures comes much later than design of them.How are people dealing with this? Just export everything?Also, doesn't exporting field names make it difficult to follow suggested idioms. I think if a struct X has field Y, you can not have an accessor method Y(). If you want to provide interface access to Y you have to come up with a new name for the getter and no matter what you'll get something un-idiomatic according to http://golang.org/doc/effective_go.html#Getters <code> ",JSON and dealing with unexported fields
"Golang: Is it possible to capture a Ctrl+C signal and run a cleanup function, in a ""defer"" fashion?", I want to capture the Ctrl+C (SIGINT) signal sent from the console and print out some partial run totals.Is this possible in Golang?Note: When I first posted the question I was confused about Ctrl+C being SIGTERM instead of SIGINT. <code> ,"Is it possible to capture a Ctrl+C signal and run a cleanup function, in a ""defer"" fashion?"
"Golang: Is it possible to capture a Ctrl+C (SIGTERM) signal and run a cleanup function, in a ""defer"" fashion?", I want to capture the Ctrl+C (SIGINT) signal sent from the console and print out some partial run totals.Is this possible in Golang?Note: When I first posted the question I was confused about Ctrl+C being SIGTERM instead of SIGINT. <code> ,"Is it possible to capture a Ctrl+C signal and run a cleanup function, in a ""defer"" fashion?"
"Golang: Is it possible to capture a Ctrl+C signal and run a cleanup function, in a ""defer"" fashion?", I want to capture the Ctrl+C (SIGINT) signal sent from the console and print out some partial run totals.Is this possible in Golang?Note: When I first posted the question I was confused about Ctrl+C being SIGTERM instead of SIGINT. <code> ,"Is it possible to capture a Ctrl+C signal and run a cleanup function, in a ""defer"" fashion?"
Go big.Int factorial," I am trying to implement this bit of code: as a big.Int so as to make it effective for larger values of x.The following is returning a value of 0 for fmt.Println(factorial(r))The factorial of 7 should be 5040?Any ideas on what I am doing wrong? This code on go playground: http://play.golang.org/p/yNlioSdxi4 <code>  func factorial(x int) (result int) { if x == 0 { result = 1; } else { result = x * factorial(x - 1); } return;} package mainimport ""fmt""import ""math/big""func main() { fmt.Println(""Hello, playground"") //n := big.NewInt(40) r := big.NewInt(7) fmt.Println(factorial(r))}func factorial(n *big.Int) (result *big.Int) { //fmt.Println(""n = "", n) b := big.NewInt(0) c := big.NewInt(1) if n.Cmp(b) == -1 { result = big.NewInt(1) } if n.Cmp(b) == 0 { result = big.NewInt(1) } else { // return n * factorial(n - 1); fmt.Println(""n = "", n) result = n.Mul(n, factorial(n.Sub(n, c))) } return result}",Go big.Int factorial with recursion
Equivalent of Goroutines in Clojure," I recently enjoyed watching the Google IO talk on Go Concurrency patterns Although the Go approach to concurrency (groutines, communication over channels) is clearly different to Clojure (immutability, manged references, STM), it seemed like the Go approach could still be useful in some circumstances in a Clojure context.So is there a direct equivalent in Clojure or Java for Go's concurrency primitives (perhaps a library), in particular:channel-like objects that block until a reader and writer are available at both endsA select-like construct that can wait for results on multiple channelsP.S. Perfectly happy with a Java solution since it would be easy to use from ClojureUPDATE Since the question was originally asked, Clojure now has core.async which provides all this functionality and more. <code> ",Equivalent of Goroutines in Clojure / Java
Get a net.UDPConn's syscall.Handle on Windows?," How do I obtain the underlying syscall.Handle for a *net.UDPConn on Windows? I want this handle to set the IP_MULTICAST_TTL via syscall.SetsockoptInt. On Linux I do the following: But on Windows, the implicit dup inside *net.UDPConn's File() fails with: 04:24:49 main.go:150: dup: not supported by windowsAnd in the source code is marked as a to-do. How can I get this handle? Is there some other way to set the TTL if not?Update0I've submitted the shortcomings to the Go issue tracker:SetTTL for *net.UDPConnImplement dup for netFD on Windows <code>  func setTTL(conn *net.UDPConn, ttl int) error { f, err := conn.File() if err != nil { return err } defer f.Close() fd := int(f.Fd()) return syscall.SetsockoptInt(fd, syscall.SOL_IP, syscall.IP_MULTICAST_TTL, ttl)}",Get syscall.Handle from a Go *net.UDPConn on Windows?
"golang, how to execute command which requires input from user"," I want to execute perforce command line ""p4"" from Go to do the login job. ""p4 login"" require user to input password. How can I run a program that requires user's input in Go?The following code doesn't work.  <code>  err = exec.Command(p4cmd, ""login"").Run()if err != nil { log.Fatal(err)}",How to execute command which requires input from user
Golang application auto build versioning," Is it possible to increment a minor version number automatically each time a Go app is compiled?I would like to set a version number inside my program, with an autoincrementing section: Being 0.5 the version number I set, and 132 a value that increments automatically each time the binary is compiled.Is this possible in Go? <code>  $ myapp -versionMyApp version 0.5.132",Application auto build versioning
Getting CPU usage with golang, My Go program needs to know the current cpu usage percentage of all system and user processes.How can I obtain that? <code> ,How to get CPU usage
GAE Golang - How to store arbitrary Datastore-compatible structure in Memcache?," I've been developing a couple apps using Google App Engine Go SDK that use Memcache as a buffer for loading data from the Datastore. As the Memcache is only able to store data as []byte, I often find myself creating functions to encode the various structures as strings, and also functions to reverse the process. Needless to say, it is quite tedious when I need to do this sort of thing 5 times over.Is there an easy way to convert any arbitrary structure that can be stored in Datastore into []byte in order to store it in Memcache and then load it back without having to create custom code for various structures in GAE Golang? <code> ",What ways does Go have to easily convert data into bytes or strings
strings.Split in Golang," The file names.txt consists of many names in the form of: Does anyone know how to split the string so that it is individual names separated by commas? The following code splits by comma and leaves quotes around the name, what is the escape character to split out the "". Can it be done in one Split statement, splitting out "","" and leaving a comma to separate? By the way, this is part of Project Euler problem # 22. http://projecteuler.net/problem=22  <code>  ""KELLEE"",""JOSLYN"",""JASON"",""INGER"",""INDIRA"",""GLINDA"",""GLENNIS"" KELLEE,JOSLYN,JASON,INGER,INDIRA,GLINDA,GLENNIS package mainimport ""fmt""import ""io/ioutil""import ""strings""func main() { fData, err := ioutil.ReadFile(""names.txt"") // read in the external file if err != nil { fmt.Println(""Err is "", err) // print any error } strbuffer := string(fData) // convert read in file to a string arr := strings.Split(strbuffer, "","") fmt.Println(arr)}",strings.Split in Go
Modeling a hierarchy of types without language support for type hierarchies," I'm new to Go, and one of the first things I want to do is to port my little marked-up-page-generation library to Go. The primary implementation is in Ruby, and it is very much ""classical object orientation"" in its design (at least as I understand OO from an amateur programmer's perspective). It models how I see the relationship between marked-up document types: For a small project, I might do something like this (translated to the Go I now want): For larger projects, say for a website called ""Egg Sample"", I subclass one of the existing Page types, creating a deeper hierarchy: This fits well into classical object-oriented design: subclasses get a lot for free, and they just focus on the few parts that are different from their parent class. EggSamplePage can add some menus and footers that are common across all Egg Sample pages, for example.Go, however, does not have a concept of a hierarchy of types: there are no classes and there is no type inheritance. There's also no dynamic dispatch of methods (which seems to me to follow from the above; a Go type HtmlPage is not a ""kind of"" Go type Page).Go does provide:EmbeddingInterfacesIt seems those two tools should be enough to get what I want, but after several false starts, I'm feeling stumped and frustrated. My guess is that I'm thinking about it wrong, and I'm hoping someone can point me in the right direction for how to do this the ""Go way"".This is a specific, real problem I'm having, and as such, any suggestions about solving my particular problem without addressing the broader question are welcome. But I'm hoping the answer will be in the form of ""by combining structures, embedding, and interfaces in such-and-such a manner, you can easily have the behavior you want"" rather than something that sidesteps that. I think many newcomers to Go transitioning from classical-OO languages likely go through a similar period of confusion.Normally I would show my broken code here, but I've got several versions, each with their own problems, and I don't imagine including them will actually add any clarity to my question, which is already getting quite long. I will of course add code if it turns out to seem useful.Things I've done:Read much of The Go FAQ (especially the parts that seemed relevant)Read much of Effective Go (especially the parts that seemed relevant)Searched Google with many combinations of search termsRead various posts on golang-nutsWritten much inadequate Go codeLooked through the Go standard library source code for any examples that seemed similarTo be a little more explicit about what I'm looking for:I want to learn the idiomatic Go way of dealing with hierarchies like this. One of my more effective attempts seems the least Go-like: This got me close, but not all the way. My point right now is that it seems like a failed opportunity to learn the idioms Go programmers use in situations like this.I want to be as DRY (""Don't Repeat Yourself"") as is reasonable; I don't want a separate text/template for each type of page when so much of each template is identical to others. One of my discarded implementations works this way, but it seems it would become unmanageable once I get a more complex hierarchy of page types as outlined above.I'd like to be able to have a core library package that is usable as-is for the types that it supports (e.g. html5Page and xhtmlPage), and is extensible as outlined above without resorting to copying and editing the library directly. (In classical OO, I extend/subclass Html5Page and make a few tweaks, for example.) My current attempts haven't seemed to lend themselves to this very well.I expect the correct answer won't need much code to explain the Go way of thinking about this.Update: Based on the comments and answers so far, it seems I wasn't so far off. My problems must be a little less generally design-oriented than I thought, and a little more about exactly how I'm doing things. So here's what I'm working with: This works, but it has several problems:It feels really awkwardI'm repeating myselfIt might not be possible, but ideally I'd like all Page types to have a String() method that does the right thing, rather than having to use a function.I strongly suspect that I'm doing something wrong and that there are Go idioms that could make this better.I'd like to have a String() method that does the right thing, but will always use the page methods even when used through an HtmlPage, due to lack of dynamic dispatch anywhere but with interfaces.With my current interface-based page generation, not only do I not get to just do fmt.Println(p) (where p is some kind of Page), but I have to specifically choose between fmt.Println(dsts.PageString(p)) and fmt.Println(dsts.HtmlPageString(p)). That feels very wrong.And I'm awkwardly duplicating code between PageString() / HtmlPageString() and between headerString() / htmlHeaderString().So I feel like I'm still suffering design issues as a result of to some extent still thinking in Ruby or Java rather than in Go. I'm hoping there's a straightforward and idiomatic Go way to build a library that has something like the client interface I've described. <code>  Page / \ HTML Page Wiki Page / \ HTML 5 Page XHTML Page p := dsts.NewHtml5Page()p.Title = ""A Great Title""p.AddStyle(""default.css"")p.AddScript(""site_wide.js"")p.Add(""<p>A paragraph</p>"")fmt.Println(p) // Output a valid HTML 5 page corresponding to the above HTML 5 Page | Egg Sample Page / | \ ES Store Page ES Blog Page ES Forum Page type page struct { Title string content bytes.Buffer openPage func() string closePage func() string openBody func() string closeBody func() string} type page struct { Title string content bytes.Buffer}type HtmlPage struct { page Encoding string HeaderMisc string styles []string scripts []string}type Html5Page struct { HtmlPage}type XhtmlPage struct { HtmlPage Doctype string}type pageStringer interface { openPage() string openBody() string contentStr() string closeBody() string closePage() string}type htmlStringer interface { pageStringer openHead() string titleStr() string stylesStr() string scriptsStr() string contentTypeStr() string}func PageString(p pageStringer) string { return headerString(p) + p.contentStr() + footerString(p)}func headerString(p pageStringer) string { return p.openPage() + p.openBody()}func HtmlPageString(p htmlStringer) string { return htmlHeaderString(p) + p.contentStr() + footerString(p)}func htmlHeaderString(p htmlStringer) string { return p.openPage() + p.openHead() + p.titleStr() + p.stylesStr() + p.scriptsStr() + p.con tentTypeStr() + p.openBody()} func (p *page) String( string { return p.headerString() + p.contentStr() + p.footerString()}",Modeling a hierarchy of related things without language support for type hierarchies
"Go Tour, Excercise:Slices Index out of Range"," I am working through the exercises in the Go tour and I have hit a snag that I can't figure out.I'm doing Exercise: Slices and I am getting this error: Here is my code: <code>  256 x 256panic: runtime error: index out of range [0] with length 0goroutine 1 [running]:main.Pic(0x100, 0x100) /tmp/sandbox1628012103/prog.go:14 +0xcfgolang.org/x/tour/pic.Show(0xc0000001a0) /tmp/gopath962180923/pkg/mod/golang.org/x/tour@v0.0.0-20201207214521-004403599411/pic/pic.go:32 +0x28main.main() /tmp/sandbox1628012103/prog.go:25 +0x25 package mainimport ( ""fmt"" ""golang.org/x/tour/pic"")func Pic(dx, dy int) [][]uint8 { fmt.Printf(""%d x %d\n\n"", dx, dy) pixels := make([][]uint8, 0, dy) for y := 0; y < dy; y++ { pixels[y] = make([]uint8, 0, dx) for x := 0; x < dx; x++ { pixels[y][x] = uint8(x * y) } } return pixels}func main() { pic.Show(Pic)}","Tour of Go exercise #18: Slices, index out of range"
smtp.Sendmail fails after 10 minutes with EOF," I'm trying to send mail via the standard library SMTP package and it does nothing for exactly 10 minutes and then fails with an unhelpful End of File error I can't make sense of. The exact message that gets logged is: 2012/07/25 22:57:58 ERROR: Failed to send notification email: EOFI've log.Printf debugged this function and verified the values being sent at this point are valid. The email address is a real address on gmail.com and the password is correct, and board.SMTPServer is smtp.googlemail.com:465. I've tried storing the result of msg.Bytes() in a separate variable and taking the length to be sure that it was producing an byte array to send, and the length is indeed non-zero. I'm guessing the EOF is bubbling up from somwhere deeper in the standard library than the SendMail function itself, but I have no idea where it's choking and I don't know what I did to upset it. <code>  // excerpt from the calling function// --- snip ---if e := mailNotify(board, validPosts, ipMinusPort, delTime); e != nil { errorPage(w, tmpl, ""Contact Administrator"", ""Email notification failed, please contact archive admin."") log.Println(""ERROR: Failed to send notification email: "" + e.Error())}// --- snip ---func mailNotify(board *config.Board, validPosts []int64, ip string, delTime time.Time) error { addresses := strings.Split(board.NotifyAddr, "","") if len(addresses) < 1 { return nil } msg := new(bytes.Buffer) type values struct { IP string Posts []int64 DelTime time.Time } t.ExecuteTemplate(msg, ""post_reported"", &values{ip, validPosts, delTime}) auth:= smtp.PlainAuth("""", board.NotifyAddr, board.NotifyPass, strings.Split(board.SMTPServer, "":"")[0]) return smtp.SendMail(board.SMTPServer, auth, board.FromEmail, addresses, msg.Bytes())}",smtp.SendMail fails after 10 minutes with EOF
How do you download a large file using Go lang?," Is there a way to download a large file using Go that will store the content directly into a file instead of storing it all in memory before writing it to a file? Because the file is so big, storing it all in memory before writing it to a file is going to use up all the memory. <code> ",How can I efficiently download a large file using Go?
Lower case key names with JSON Marshal in Go," I wish to use the ""encoding/json"" package to marshal a struct declared in one of the imported packages of my application.Eg.: Because it is imported, all available (exported) fields in the struct begins with an upper case letter. But I wish to have lower case key names: will result in {""Foo"":42}but I wish to get {""foo"":42}Is it possible to get around the problem in some easy way? <code>  type T struct { Foo int} out, err := json.Marshal(&T{Foo: 42})",Lowercase JSON key names with JSON Marshal in Go
Go lang array and slice data types," I found myself confused with the array and slice data types.From Go docs, arrays are described as follows: There are major differences between the ways arrays work in Go and C. In Go, Arrays are values. Assigning one array to another copies all the elements. In particular, if you pass an array to a function, it will receive a copy of the array, not a pointer to it. The size of an array is part of its type. The types [10]int and [20]int are distinct. Functions: As in all languages in the C family, everything in Go is passed by value. That is, a function always gets a copy of the thing being passed, as if there were an assignment statement assigning the value to the parameter. For instance, passing an int value to a function makes a copy of the int, and passing a pointer value makes a copy of the pointer, but not the data it points to.Why does sort.Ints(arrayValue) modify the passed variable when I declared it as an array, not as a slice?Code Output <code>  var av = []int{1,5,2,3,7}fmt.Println(av)sort.Ints(av)fmt.Println(av)return [1 5 2 3 7][1 2 3 5 7]",Array and slice data types
Does Go have lambda expressions or anything similiar?, Does Go support lambda expressions or anything similar?I want to port a library from another language that uses lambda expressions (Ruby). <code> ,Does Go have lambda expressions or anything similar?
WSDL/SOAP support on go, Are there any packages to support SOAP/WSDL on Go?  <code> ,WSDL/SOAP support on Go?
How can I use Google Spreadsheet API from Google Go Language? (golang), I need to be able to read and write data to a spreadsheet. I am programming in the Go Language in Google App Engine. <code> ,How can I use Google Spreadsheet API from Go?
how to set and get fields in golang structs?," After creating a struct like this: How do I create a new instance of Foo and set and get the name?I tried the following: Nothing gets printed, because name is empty. So how do I set and get a field inside a struct?Working playground <code>  type Foo struct { name string}func (f Foo) SetName(name string) { f.name = name}func (f Foo) GetName() string { return f.name} p := new(Foo)p.SetName(""Abc"")name := p.GetName()fmt.Println(name)",How to set and get fields in struct's method
how to set and get fields in Golang structs?," After creating a struct like this: How do I create a new instance of Foo and set and get the name?I tried the following: Nothing gets printed, because name is empty. So how do I set and get a field inside a struct?Working playground <code>  type Foo struct { name string}func (f Foo) SetName(name string) { f.name = name}func (f Foo) GetName() string { return f.name} p := new(Foo)p.SetName(""Abc"")name := p.GetName()fmt.Println(name)",How to set and get fields in struct's method
How to properly output a string in a DOS window with go?," I have a exe in go which prints utf-8 encoded strings, with special characters in it.Since that exe is made to be used from a console window, its output is mangled because Windows uses ibm850 encoding (aka code page 850).How would you make sure the go exe print correctly encoded strings for a console windows, ie print for instance: instead of (without any translation to the right charset) <code>  ",How to properly output a string in a Windows console with go?
golang: How to do a https request with bad certificate?," Say I want to get https://golang.org programatically. Currently golang.org (ssl) has a bad certificate which is issued to *.appspot.com So when I run this: I get (as I expected) Now, I want to trust this certificate myself (imagine a self-issued certificate where I can validate fingerprint etc.): how can I make a request and validate/trust the certificate?I probably need to use openssl to download the certificate, load it into my file and fill tls.Config struct !? <code>  package mainimport ( ""log"" ""net/http"")func main() { _, err := http.Get(""https://golang.org/"") if err != nil { log.Fatal(err) }} Get https://golang.org/: certificate is valid for *.appspot.com, *.*.appspot.com, appspot.com, not golang.org",How to do a https request with bad certificate?
Setting Cookies in Golang (net/http)," I'm trying to set cookies with Go's net/http package. I have: I tried googling 'Golang' with 'cookies', but didn't get any good results. If anyone can point me in the right direction it would be greatly appreciated. <code>  package mainimport ""io""import ""net/http""import ""time""func indexHandler(w http.ResponseWriter, req *http.Request) { expire := time.Now().AddDate(0, 0, 1) cookie := http.Cookie{""test"", ""tcookie"", ""/"", ""www.domain.com"", expire, expire.Format(time.UnixDate), 86400, true, true, ""test=tcookie"", []string{""test=tcookie""}} req.AddCookie(&cookie) io.WriteString(w, ""Hello world!"")}func main() { http.HandleFunc(""/"", indexHandler) http.ListenAndServe("":80"", nil)}",Setting cookies with net/http
Exercise: Equivalent Binary Trees," I am trying to solve equivalent binary trees exercise on go tour. Here is what I did; However, I couldn't find out how to signal if any no more elements left in trees. I can't use close(ch) on Walk() because it makes the channel close before all values are sent (because of recursion.) Can anyone lend me a hand here? <code>  package mainimport ""tour/tree""import ""fmt""// Walk walks the tree t sending all values// from the tree to the channel ch.func Walk(t *tree.Tree, ch chan int) { if t.Left != nil { Walk(t.Left, ch) } ch <- t.Value if t.Right != nil { Walk(t.Right, ch) }}// Same determines whether the trees// t1 and t2 contain the same values.func Same(t1, t2 *tree.Tree) bool { ch1 := make(chan int) ch2 := make(chan int) go Walk(t1, ch1) go Walk(t2, ch2) for k := range ch1 { select { case g := <-ch2: if k != g { return false } default: break } } return true}func main() { fmt.Println(Same(tree.New(1), tree.New(1))) fmt.Println(Same(tree.New(1), tree.New(2)))}",Go Tour Exercise #7: Binary Trees equivalence
Go Tour Exercise: Equivalent Binary Trees," I am trying to solve equivalent binary trees exercise on go tour. Here is what I did; However, I couldn't find out how to signal if any no more elements left in trees. I can't use close(ch) on Walk() because it makes the channel close before all values are sent (because of recursion.) Can anyone lend me a hand here? <code>  package mainimport ""tour/tree""import ""fmt""// Walk walks the tree t sending all values// from the tree to the channel ch.func Walk(t *tree.Tree, ch chan int) { if t.Left != nil { Walk(t.Left, ch) } ch <- t.Value if t.Right != nil { Walk(t.Right, ch) }}// Same determines whether the trees// t1 and t2 contain the same values.func Same(t1, t2 *tree.Tree) bool { ch1 := make(chan int) ch2 := make(chan int) go Walk(t1, ch1) go Walk(t2, ch2) for k := range ch1 { select { case g := <-ch2: if k != g { return false } default: break } } return true}func main() { fmt.Println(Same(tree.New(1), tree.New(1))) fmt.Println(Same(tree.New(1), tree.New(2)))}",Go Tour Exercise #7: Binary Trees equivalence
Is there an Adwords API implementation in Go?," Given that Adwords is a Google thing, and Go is a Google thing, how long until there's a version of the Adwords API written in Go? Associated with that question, another: are there any SOAP libraries for Go yet? <code> ",How to do a SOAP call in Go?
golang random number generator how to seed properly," I am trying to generate a random string in Go and here is the code I have written so far: My implementation is very slow. Seeding using time brings the same random number for a certain time, so the loop iterates again and again. How can I improve my code? <code>  package mainimport ( ""bytes"" ""fmt"" ""math/rand"" ""time"")func main() { fmt.Println(randomString(10))}func randomString(l int) string { var result bytes.Buffer var temp string for i := 0; i < l; { if string(randInt(65, 90)) != temp { temp = string(randInt(65, 90)) result.WriteString(temp) i++ } } return result.String()}func randInt(min int, max int) int { rand.Seed(time.Now().UTC().UnixNano()) return min + rand.Intn(max-min)}",How to properly seed random number generator
Golang random number generator how to seed properly," I am trying to generate a random string in Go and here is the code I have written so far: My implementation is very slow. Seeding using time brings the same random number for a certain time, so the loop iterates again and again. How can I improve my code? <code>  package mainimport ( ""bytes"" ""fmt"" ""math/rand"" ""time"")func main() { fmt.Println(randomString(10))}func randomString(l int) string { var result bytes.Buffer var temp string for i := 0; i < l; { if string(randInt(65, 90)) != temp { temp = string(randInt(65, 90)) result.WriteString(temp) i++ } } return result.String()}func randInt(min int, max int) int { rand.Seed(time.Now().UTC().UnixNano()) return min + rand.Intn(max-min)}",How to properly seed random number generator
Go  variadic parameter functions weirdness," Situation:I'm trying to write a simple fmt.Fprintf wrapper which takes a variable number of arguments. This is the code: Problem:When I call it with Die(""foo""), I get the following output (instead of ""foo""): foo%!(EXTRA []interface {}=[])Why is there ""%!(EXTRA []interface {}=[])"" after the ""foo""?What is the correct way to create wrappers around fmt.Fprintf? <code>  func Die(format string, args ...interface{}) { str := fmt.Sprintf(format, args) fmt.Fprintf(os.Stderr, ""%v\n"", str) os.Exit(1)}",Variadic functions parameters pass-through
Go  variadic parameter functions," Situation:I'm trying to write a simple fmt.Fprintf wrapper which takes a variable number of arguments. This is the code: Problem:When I call it with Die(""foo""), I get the following output (instead of ""foo""): foo%!(EXTRA []interface {}=[])Why is there ""%!(EXTRA []interface {}=[])"" after the ""foo""?What is the correct way to create wrappers around fmt.Fprintf? <code>  func Die(format string, args ...interface{}) { str := fmt.Sprintf(format, args) fmt.Fprintf(os.Stderr, ""%v\n"", str) os.Exit(1)}",Variadic functions parameters pass-through
Go  variadic functions parameters pass-through," Situation:I'm trying to write a simple fmt.Fprintf wrapper which takes a variable number of arguments. This is the code: Problem:When I call it with Die(""foo""), I get the following output (instead of ""foo""): foo%!(EXTRA []interface {}=[])Why is there ""%!(EXTRA []interface {}=[])"" after the ""foo""?What is the correct way to create wrappers around fmt.Fprintf? <code>  func Die(format string, args ...interface{}) { str := fmt.Sprintf(format, args) fmt.Fprintf(os.Stderr, ""%v\n"", str) os.Exit(1)}",Variadic functions parameters pass-through
How do I unpack various form of integers in a byte buffer in golang?," I need to extract various fields in a byte buffer. I came up with this solution: Is there a more better/idiomatic/straightforward way of doing this?I want to keep offsets explicitI want to read from the byte buffer, not seeking and reading from the file when possible. <code>  func (fs *FileSystem) readSB() { // fs.f is a *os.File buf := make([]byte, 1024) fs.f.ReadAt(buf, 1024) // Offset: type var p *bytes.Buffer // 0: uint32 p = bytes.NewBuffer(buf[0:]) binary.Read(p, binary.LittleEndian, &fs.sb.inodeCount) // 4: uint32 p = bytes.NewBuffer(buf[4:]) binary.Read(p, binary.LittleEndian, &fs.sb.blockCount) // 20: uint32 p = bytes.NewBuffer(buf[20:]) binary.Read(p, binary.LittleEndian, &fs.sb.firstDataBlock) // 24: uint32 p = bytes.NewBuffer(buf[24:]) binary.Read(p, binary.LittleEndian, &fs.sb.blockSize) fs.sb.blockSize = 1024 << fs.sb.blockSize // 32: uint32 p = bytes.NewBuffer(buf[32:]) binary.Read(p, binary.LittleEndian, &fs.sb.blockPerGroup) // 40: uint32 p = bytes.NewBuffer(buf[40:]) binary.Read(p, binary.LittleEndian, &fs.sb.inodePerBlock)}",How do I unpack various form of integers in a byte buffer in Golang?
Read from initial stdin in GO?," I would like to read from the original stdin of a Go program. For example, if I did echo test stdin | go run test.go, I would want to have access to ""test stdin"". I've tried reading from os.Stdin, but if there's nothing in it, then it will wait for input. I also tried checking the size first, but the os.Stdin.Stat().Size() is 0 even when input is passed in.What can I do?  <code> ",Read from initial stdin in Go?
throw: all goroutines are asleep - deadlock! Exit status 2," I am trying to create a simple program to learn channels in Go.But Im running in to a deadlock error, which I cant figure out My initial thoughts was something about the Sleep function, but even if I dont include this I still run into this error and exit message.Can anyone give some hints on how to solve this? Thanks in advance <code>  package mainimport ( ""fmt"" ""time"")func printer(c chan int) { for i := 0; i < 10; i++ { c <- i time.Sleep(time.Second) }}func reciever(c chan int) { for { recievedMsg := <-c fmt.Println(recievedMsg) }}func main() { newChanel := make(chan int) printer(newChanel) reciever(newChanel)}","""all goroutines are asleep - deadlock! Exit status 2"" error in a printer-receiver program"
Why is this golang code blocking?," I wrote the following program: Since the channel eventlist is a buffered channel, I think I should get at exactly 100 times the output ""Hey!"", but it is displayed only once. Where is my mistake? <code>  package mainimport ( ""fmt"")func processevents(list chan func()) { for { //a := <-list //a() }}func test() { fmt.Println(""Ho!"")}func main() { eventlist := make(chan func(), 100) go processevents(eventlist) for { eventlist <- test fmt.Println(""Hey!"") }}",Why is this Go code blocking?
Why goroutine blocked other channels?," I wrote the following program: Since the channel eventlist is a buffered channel, I think I should get at exactly 100 times the output ""Hey!"", but it is displayed only once. Where is my mistake? <code>  package mainimport ( ""fmt"")func processevents(list chan func()) { for { //a := <-list //a() }}func test() { fmt.Println(""Ho!"")}func main() { eventlist := make(chan func(), 100) go processevents(eventlist) for { eventlist <- test fmt.Println(""Hey!"") }}",Why is this Go code blocking?
Image manipulation in golang," I have the following:Background image (bi)Image1 (i1)Image3 (i2)I want to position i1 and i2 over bi with some angle and then produce a final image. I have x and y axis value for i1 and i2 and their expected rotation angle. i1 and i2 may partially overlay on each other. but I have z index for i1 and i2 to know, if in case they overlap then who will be in foreground.I am trying to achieve this in Golang.http://golang.org/doc/articles/image_draw.html seems to do this. Anyone knows any similar example of code, that may help. Or can you show me couple of lines in Golang as a pseudo program?Thanks. <code> ",Image manipulation in Golang
Use golang as plugin?," Can go run dynamically in order to be used for a plugin based application ?In eclipse, we can create some plugins that Eclipse can run dynamically. Would the same thing be possible in Go ? <code> ",Develop plugins in Go?
golang embed file for later parsing execution use," I am essentially trying to walk through a folder of html files. I want to embed them into the binary file and be able to parse them upon request for template execution purposes. (Please excuse me if im not wording this properly).Any ideas, tips, tricks or better way of accomplishing this is much appreciated. <code>  // Template Filestype TempFiles struct { Files map[string]string}// Loop through view files and load themfunc LoadTempFiles() { t := new(TempFiles) // Load template files filepath.Walk(""application/views"", func(path string, info os.FileInfo, err error) error { if !info.IsDir() { content, _ := ioutil.ReadFile(path) t.Files[path] = string(content) } return nil })}func ViewTemp(w http.ResponseWriter, path string) { t := new(TempFiles) temp, err := template.New().Parse(t.Files[path]) if err != nil { http.Error(w, err.Error(), http.StatusInternalServerError) } else { temp.Execute(w, nil) }}",How to embed file for later parsing execution use
Create a textfile in Golang containing input from a HTML for," I am trying to set up a very simple web server where the user access a site and writes a string and an int.Then I want to save these two inputs, my idea was to do it to a text file that also can be displayed in the browser: .../textfile/I dont know what the norm on SO is on how much code is OK to post but here is what I have so far: And my HTML-form: (without all the formating) So my initial thoughts was to implement two functions returnInput() and saveInput() but maybe there are som built in functions that are easier to use?If somebody could point me in the right direction on how to save the input from the HTML form than I would be very greatful! Thanks in advance. <code>  type Person struct { name string hours int}const filename string = ""timelister""func upload(w http.ResponseWriter, r *http.Request) { t, _ := template.ParseFiles(""upload.html"") t.Execute(w, nil)}func (person *Person) open() { newFilename := filename + "".txt"" _, err := os.OpenFile(newFilename, os.O_RDWR|os.O_APPEND|os.O_CREATE, 0666) if err != nil { log.Fatal(""Open Filename: "", err) }}func returnInput() //want to implement thisfunc saveInput() //want to implemet thisfunc main() { http.HandleFunc(""/"", upload) http.ListenAndServe("":8080"", nil)} Name: <input type=""text"" name=""Name""> <input type=""submit"" value=""submit""></br> Hours: <input type=""text"" name=""Hours""> <input type=""submit"" value=""submit"">",How to read input from a HTML form and save it in a file - Golang
Create a textfile in Golang containing input from a HTML form," I am trying to set up a very simple web server where the user access a site and writes a string and an int.Then I want to save these two inputs, my idea was to do it to a text file that also can be displayed in the browser: .../textfile/I dont know what the norm on SO is on how much code is OK to post but here is what I have so far: And my HTML-form: (without all the formating) So my initial thoughts was to implement two functions returnInput() and saveInput() but maybe there are som built in functions that are easier to use?If somebody could point me in the right direction on how to save the input from the HTML form than I would be very greatful! Thanks in advance. <code>  type Person struct { name string hours int}const filename string = ""timelister""func upload(w http.ResponseWriter, r *http.Request) { t, _ := template.ParseFiles(""upload.html"") t.Execute(w, nil)}func (person *Person) open() { newFilename := filename + "".txt"" _, err := os.OpenFile(newFilename, os.O_RDWR|os.O_APPEND|os.O_CREATE, 0666) if err != nil { log.Fatal(""Open Filename: "", err) }}func returnInput() //want to implement thisfunc saveInput() //want to implemet thisfunc main() { http.HandleFunc(""/"", upload) http.ListenAndServe("":8080"", nil)} Name: <input type=""text"" name=""Name""> <input type=""submit"" value=""submit""></br> Hours: <input type=""text"" name=""Hours""> <input type=""submit"" value=""submit"">",How to read input from a HTML form and save it in a file - Golang
golang: installing packages in a local directory," What is the best practice to install packages (those with go get...) in a local directory?Example: I'd like to try out the Revel web framework, but I don't want to clutter my go installation at /usr/local/go.Normally I'd say sudo go get github.com/robfig/revel as written on the home page, but that would install it beneath /usr/local/go/src/pkg/....Is there an easy way to say (for example) go get --local ... and have the package in the current (sub) directory? <code> ",Installing packages in a local directory
Initialize nested anonymous struct in Go," I have the following struct which contains a net/http.Request: Now I want to initialize the anonymous inner struct http.Request in the following function: How can I initialize the inner struct with the parameter origRequest? <code>  type MyRequest struct { http.Request PathParams map[string]string} func New(origRequest *http.Request, pathParams map[string]string) *MyRequest { req := new(MyRequest) req.PathParams = pathParams return req}",Initialize embedded struct in Go
map in programming go," If I want to count the items in the map structure, what statement should I use?I tried to use but it seems the syntax is false. <code>  for _, _ := range m {...}",How to count items in a Go map?
Can Go really be that much faster than python?," I think I may have implemented this incorrectly because the results do not make sense. I have a Go program that counts to 1000000000: It finishes in less than a second. On the other hand I have a Python script: It finishes in a few minutes.Why is the Go version so much faster? Are they both counting up to 1000000000 or am I missing something? <code>  package mainimport ( ""fmt"")func main() { for i := 0; i < 1000000000; i++ {} fmt.Println(""Done"") } x = 0while x < 1000000000: x+=1print 'Done'",Can Go really be that much faster than Python?
Why does have := short assignments inside functions?," I don't quite understand the specific purpose of short assignments,why do this: when this is also possible: Is there any specific use case where short assignments are more convenientThanks <code>  x:= 10 var x = 10",Why does go have := short assignments inside functions?
Go language string length," How can I get the number of characters of a string in Go?For example, if I have a string ""hello"" the method should return 5. I saw that len(str) returns the number of bytes and not the number of characters so len("""") returns 2 instead of 1 because is encoded with two bytes in UTF-8. <code> ",How to get the number of characters in a string
How to get the number of Characters in a Golang String?," How can I get the number of characters of a string in Go?For example, if I have a string ""hello"" the method should return 5. I saw that len(str) returns the number of bytes and not the number of characters so len("""") returns 2 instead of 1 because is encoded with two bytes in UTF-8. <code> ",How to get the number of characters in a string
How to get the number of Characters in a String?," How can I get the number of characters of a string in Go?For example, if I have a string ""hello"" the method should return 5. I saw that len(str) returns the number of bytes and not the number of characters so len("""") returns 2 instead of 1 because is encoded with two bytes in UTF-8. <code> ",How to get the number of characters in a string
Create a Golang map of Lists," I'd like to create a map of string to container/list.List instances. Is this the correct way to go about it? <code>  package mainimport ( ""fmt"" ""container/list"")func main() { x := make(map[string]*list.List) x[""key""] = list.New() x[""key""].PushBack(""value"") fmt.Println(x[""key""].Front().Value)}",Create a map of string to List
Create a map of Lists," I'd like to create a map of string to container/list.List instances. Is this the correct way to go about it? <code>  package mainimport ( ""fmt"" ""container/list"")func main() { x := make(map[string]*list.List) x[""key""] = list.New() x[""key""].PushBack(""value"") fmt.Println(x[""key""].Front().Value)}",Create a map of string to List
golang: what is the zero for string," The documentation says : NewKey creates a new key. kind cannot be empty. Either one or both of stringID and intID must be zero. If both are zero, the key returned is incomplete. parent must either be a complete key or nil.What is the zero for string?I tried 0 and nil, and I got errors like: <code>  func NewKey(c appengine.Context, kind, stringID string, intID int64, parent *Key) *Key cannot use nil as type string in function argument",What is the zero for string?
golang: what is the zero for string?," The documentation says : NewKey creates a new key. kind cannot be empty. Either one or both of stringID and intID must be zero. If both are zero, the key returned is incomplete. parent must either be a complete key or nil.What is the zero for string?I tried 0 and nil, and I got errors like: <code>  func NewKey(c appengine.Context, kind, stringID string, intID int64, parent *Key) *Key cannot use nil as type string in function argument",What is the zero for string?
How to know TCP connection is closed in golang net package?, I'm implementing a small TCP server. How do I know if one of my clients closed? Should I just try to read or write and check if err is nil? <code> ,How to know TCP connection is closed in net package?
How to know TCP connection is closed in Golang net package?, I'm implementing a small TCP server. How do I know if one of my clients closed? Should I just try to read or write and check if err is nil? <code> ,How to know TCP connection is closed in net package?
What is the fastest way to generate long a random string in Go?, Like [a-zA-Z0-9] string:na1dopW129T0anN28udaZor hexadecimal string:8c6f78ac23b4a7b8c0182dBy long I mean 2K and more characters. <code> ,What is the fastest way to generate a long random string in Go?
Setting HTTP headers in Golang," I'm trying to set a header in my Go web server. I'm using gorilla/mux and net/http packages.I'd like to set Access-Control-Allow-Origin: * to allow cross domain AJAX.Here's my Go code: The net/http package has documentation describing sending http request headers as if it were a client - I'm not exactly sure how to set response headers? <code>  func saveHandler(w http.ResponseWriter, r *http.Request) {// do some stuff with the request data}func main() { r := mux.NewRouter() r.HandleFunc(""/save"", saveHandler) http.Handle(""/"", r) http.ListenAndServe("":""+port, nil)}",Setting HTTP headers
Go - how do I dump the struct into the byte array without reflection?," I already found encoding/binary package to deal with it, but it depended on reflect package so it didn't work with uncapitalized(that is, unexported) struct fields. However I spent a week to find that problem out, I still have a question: if struct fields should not be exported, how do I dump them easily into binary data?EDIT: Here's the example. If you capitalize the name of fields of Data struct, that works properly. But Data struct was intended to be an abstract type, so I don't want to export these fields. <code>  package mainimport ( ""fmt"" ""encoding/binary"" ""bytes"")type Data struct { id int32 name [16]byte}func main() { d := Data{Id: 1} copy(d.Name[:], []byte(""tree"")) buffer := new(bytes.Buffer) binary.Write(buffer, binary.LittleEndian, d) // d was written properly fmt.Println(buffer.Bytes()) // try to read... buffer = bytes.NewBuffer(buffer.Bytes()) var e = new(Data) err := binary.Read(buffer, binary.LittleEndian, e) fmt.Println(e, err)}",How do I dump the struct into the byte array without reflection?
what is difference between []string and ...string in golang?," In the Go language,[]string is a string arrayand we also use ...string as a parameter.What is the difference?Function definition: Can I call this function like below? <code>  func f(args ...string) {} args := []string{""a"", ""b""}f(args)",What is the difference between []string and ...string in golang?
What's the benefit of not requiring defining Go methods together with struct?," Go allows one to define methods separately from the struct/datatype they work on. Does it mean just flexibility in placing the method definitions or something more?I've heard Go's struct/methods system being compared to monkey patching, but if I understand correctly, then you really can't add methods to any existing type (struct), as methods must reside in same package as the type. Ie. you can monkey patch only the types which are under your control anyway. Or am I missing something?In which cases would you define a type and its methods in separate source files (or in different parts of the same source file)?  <code> ",What's the benefit of defining Go methods away from struct definitions?
Cannot convert []string to []interface {}," I'm writing some code, and I need it to catch the arguments and pass them through fmt.Println(I want its default behaviour, to write arguments separated by spaces and followed by a newline). However it takes []interface {} but flag.Args() returns a []string.Here's the code example: This returns the following error: Is this a bug? Shouldn't fmt.Println take any array? By the way, I've also tried to do this: but I get the following error: Is there a ""Go"" way to workaround this? <code>  package mainimport ( ""fmt"" ""flag"")func main() { flag.Parse() fmt.Println(flag.Args()...)} ./example.go:10: cannot use args (type []string) as type []interface {} in function argument var args = []interface{}(flag.Args()) cannot convert flag.Args() (type []string) to type []interface {}",Cannot print []string using fmt.Println
golang: array of struct != array of interface it implements?," I have an interface Model, which is implemented by struct Person.To get a model instance, I have the following helper functions: The above approach allows me to return a properly typed Person instance (can easily add new models later with same approach).When I attempted to do something similar for returning a slice of models, I get an error. Code: Go complains with: cannot use newPersons() (type []Person) as type []Model in return argumentMy goal is to return a slice of whatever model type is requested (whether []Person, []FutureModel, []Terminator2000, w/e). What am I missing, and how can I properly implement such a solution? <code>  func newModel(c string) Model { switch c { case ""person"": return newPerson() } return nil}func newPerson() *Person { return &Person{}} func newModels(c string) []Model { switch c { case ""person"": return newPersons() } return nil}func newPersons() *[]Person { var models []Person return &models}",slice of struct != slice of interface it implements?
golang: slice of struct != slice of interface it implements?," I have an interface Model, which is implemented by struct Person.To get a model instance, I have the following helper functions: The above approach allows me to return a properly typed Person instance (can easily add new models later with same approach).When I attempted to do something similar for returning a slice of models, I get an error. Code: Go complains with: cannot use newPersons() (type []Person) as type []Model in return argumentMy goal is to return a slice of whatever model type is requested (whether []Person, []FutureModel, []Terminator2000, w/e). What am I missing, and how can I properly implement such a solution? <code>  func newModel(c string) Model { switch c { case ""person"": return newPerson() } return nil}func newPerson() *Person { return &Person{}} func newModels(c string) []Model { switch c { case ""person"": return newPersons() } return nil}func newPersons() *[]Person { var models []Person return &models}",slice of struct != slice of interface it implements?
Golang: slice of struct != slice of interface it implements?," I have an interface Model, which is implemented by struct Person.To get a model instance, I have the following helper functions: The above approach allows me to return a properly typed Person instance (can easily add new models later with same approach).When I attempted to do something similar for returning a slice of models, I get an error. Code: Go complains with: cannot use newPersons() (type []Person) as type []Model in return argumentMy goal is to return a slice of whatever model type is requested (whether []Person, []FutureModel, []Terminator2000, w/e). What am I missing, and how can I properly implement such a solution? <code>  func newModel(c string) Model { switch c { case ""person"": return newPerson() } return nil}func newPerson() *Person { return &Person{}} func newModels(c string) []Model { switch c { case ""person"": return newPersons() } return nil}func newPersons() *[]Person { var models []Person return &models}",slice of struct != slice of interface it implements?
number of elements in a channel," Using a buffered channel, how do measure how many elements are in the channel? For example, I'm creating and sending on a channel like this: I want to measure how many msgs are in the channel send_ch.I'm aware that due to concurrency the measurement won't be exact, as pre-emption could occur between measurement and action (eg discussed in this video Google I/O 2012 - Go Concurrency Patterns). I'll be using this for flow control between producers and consumers ie once I've passed through a high watermark, changing some behaviour until I pass back through a low watermark. <code>  send_ch := make(chan []byte, 100)// codesend_ch <- msg",Number of elements in a channel
Replicate Java Decryption code in golang," I'm struggling with the migration of Java code to Golang for the last few days and I am now stuck. This is the working Java code: My implementation in Golang: What I know so far:all error values omitted by _ are nil in this piece of codethe bzip2 header (""BZ"") must be omitted for CBzip2InputStream, but not for bzip2.NewReaderthe first 16 bytes read from instream in Java and golang are the same, starting with the 17th byte all bytes differ for whatever reason <code>  final Key k = new SecretKeySpec(keyString.getBytes(), ""AES"");Cipher c = Cipher.getInstance(""AES"");c.init(Cipher.DECRYPT_MODE, k);final InputStream in = new BufferedInputStream(new FileInputStream(fileNameToDecrypt));final CipherInputStream instream = new CipherInputStream(in, c);if (instream.read() != 'B') { System.out.println(""Error"");}if (instream.read() != 'Z') { System.out.println(""Error"");}final CBZip2InputStream zip = new CBZip2InputStream(instream); c, _ := aes.NewCipher([]byte(keyString))// IV must be defined in golangiv := []byte{0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00}d := cipher.NewCBCDecrypter(c, iv)fi, _ := os.Open(fileNameToDecrypt)stat, _ := fi.Stat()enc := make([]byte, stat.Size())dec := make([]byte, stat.Size())fi.Read(enc)d.CryptBlocks(dec, enc)instream := bytes.NewBuffer(dec)zip := bzip2.NewReader(instream)",Migrate Java decryption code to Golang
declare const array of floats," I have tried: The first declaration and initialization works fine, but the second, third and fourth don't work.How can I declare and initialize a const array of floats? <code>  const ascii = ""abcdefghijklmnopqrstuvwxyz""const letter_goodness []float32 = { .0817,.0149,.0278,.0425,.1270,.0223,.0202, .0609,.0697,.0015,.0077,.0402,.0241,.0675, .0751,.0193,.0009,.0599,.0633,.0906,.0276, .0098,.0236,.0015,.0197,.0007 }const letter_goodness = { .0817,.0149,.0278,.0425,.1270,.0223,.0202, .0609,.0697,.0015,.0077,.0402,.0241,.0675, .0751,.0193,.0009,.0599,.0633,.0906,.0276, .0098,.0236,.0015,.0197,.0007 }const letter_goodness = []float32 { .0817,.0149,.0278,.0425,.1270,.0223,.0202, .0609,.0697,.0015,.0077,.0402,.0241,.0675, .0751,.0193,.0009,.0599,.0633,.0906,.0276, .0098,.0236,.0015,.0197,.0007 }",Declare a constant array
declare a constant array," I have tried: The first declaration and initialization works fine, but the second, third and fourth don't work.How can I declare and initialize a const array of floats? <code>  const ascii = ""abcdefghijklmnopqrstuvwxyz""const letter_goodness []float32 = { .0817,.0149,.0278,.0425,.1270,.0223,.0202, .0609,.0697,.0015,.0077,.0402,.0241,.0675, .0751,.0193,.0009,.0599,.0633,.0906,.0276, .0098,.0236,.0015,.0197,.0007 }const letter_goodness = { .0817,.0149,.0278,.0425,.1270,.0223,.0202, .0609,.0697,.0015,.0077,.0402,.0241,.0675, .0751,.0193,.0009,.0599,.0633,.0906,.0276, .0098,.0236,.0015,.0197,.0007 }const letter_goodness = []float32 { .0817,.0149,.0278,.0425,.1270,.0223,.0202, .0609,.0697,.0015,.0077,.0402,.0241,.0675, .0751,.0193,.0009,.0599,.0633,.0906,.0276, .0098,.0236,.0015,.0197,.0007 }",Declare a constant array
"Go build: ""Cannot find package"" (even though GOROOT is set)"," Even though I have GOPATH properly set, I still can't get ""go build"" or ""go run"" to find my own packages. What am I doing wrong? <code>  $ echo $GOROOT/usr/local/go$ echo $GOPATH/home/mitchell/go$ cat ~/main.gopackage mainimport ""foobar""func main() { }$ cat /home/mitchell/go/src/foobar.gopackage foobar$ go build main.gomain.go:3:8: import ""foobar"": cannot find package","Go build: ""Cannot find package"" (even though GOPATH is set)"
Trouble with go tour crawler exercise," I'm going through the Go Tour and I feel like I have a pretty good understanding of the language except for concurrency.slide 10 is an exercise that asks the reader to parallelize a web crawler (and to make it not cover repeats but I haven't gotten there yet.)Here is what I have so far: My question is, where do I put the close(ch) call.If I put a defer close(ch) somewhere in the Crawl method, then the program ends up writing to a closed channel from one of the spawned goroutines, because the call to Crawl will return before the spawned goroutines do.If I omit the call to close(ch), as I demonstrate it, the program deadlocks in the main function ranging the channel because the channel is never closed when all goroutines has returned. <code>  func Crawl(url string, depth int, fetcher Fetcher, ch chan string) { if depth <= 0 { return } body, urls, err := fetcher.Fetch(url) if err != nil { ch <- fmt.Sprintln(err) return } ch <- fmt.Sprintf(""found: %s %q\n"", url, body) for _, u := range urls { go Crawl(u, depth-1, fetcher, ch) }}func main() { ch := make(chan string, 100) go Crawl(""http://golang.org/"", 4, fetcher, ch) for i := range ch { fmt.Println(i) }}",Tour of Go exercise #10: Crawler
How to take a cube root in Google Go?," I'm writing a cube root function in Google Go using Newton's method. I want to check the results using math/cmplx.Pow(), but for the life of me, I can't figure out how. How do I do this? <code> ",How to take a cube root in Go?
Golang: : no new variables on left side of :=," What's happening here? It throws an error that says What I was doing was re-assigning values to an already declared variable. <code>  package mainimport ""fmt""func main() { myArray :=[...]int{12,14,26} ; fmt.Println(myArray) myArray :=[...]int{11,12,14} //error pointing on this line fmt.Println(myArray) ;} no new variables on left side of :=",no new variables on left side of :=
Golang: no new variables on left side of :=," What's happening here? It throws an error that says What I was doing was re-assigning values to an already declared variable. <code>  package mainimport ""fmt""func main() { myArray :=[...]int{12,14,26} ; fmt.Println(myArray) myArray :=[...]int{11,12,14} //error pointing on this line fmt.Println(myArray) ;} no new variables on left side of :=",no new variables on left side of :=
"In Go, how can you retrieve the IP address from an open TCPConn*?", I have a TCPConn* that I've accepted from a TCPListener.acceptTCP. I'd like to get only the IP address (no port information) as a string or IP. What is the correct (i.e. minimal casting/string manipulation) way to accomplish that? <code> ,How can you retrieve the IP address from an open TCPConn*?
In golang is there a nice way of getting a slice of of values from a map?," If I have a map m is there a better way of getting a slice of the values v than Is there a built feature of a map? Is there a function in a Go package, or is this the best code to do if I have to? <code>  package mainimport ( ""fmt"")func main() { m := make(map[int]string) m[1] = ""a"" m[2] = ""b"" m[3] = ""c"" m[4] = ""d"" // Can this be done better? v := make([]string, len(m), len(m)) idx := 0 for _, value := range m { v[idx] = value idx++ } fmt.Println(v) }",In golang is there a nice way of getting a slice of values from a map?
golang tracking file upload progress," i'm trying to track the upload progress in GOLANG, that's what i got at the moment  <code>  func Upload(w http.ResponseWriter, req *http.Request) { mr, err := req.MultipartReader() if err != nil { return } for { // var part *multipart.Part part, err := mr.NextPart() mr.partsRead if err == io.EOF { break } println(part) }}",How do i track the upload progress in golang
How do i track the upload progress in golang," i'm trying to track the upload progress in GOLANG, that's what i got at the moment  <code>  func Upload(w http.ResponseWriter, req *http.Request) { mr, err := req.MultipartReader() if err != nil { return } for { // var part *multipart.Part part, err := mr.NextPart() mr.partsRead if err == io.EOF { break } println(part) }}",How do i track the upload progress in golang
How do i track the upload progress in golang on server side," i'm trying to track the upload progress in GOLANG, that's what i got at the moment  <code>  func Upload(w http.ResponseWriter, req *http.Request) { mr, err := req.MultipartReader() if err != nil { return } for { // var part *multipart.Part part, err := mr.NextPart() mr.partsRead if err == io.EOF { break } println(part) }}",How do i track the upload progress in golang
golang convert iso8889-1 to utf8," I am trying to convert an ISO 8859-1 encoded string to UTF-8.The following function works with my testdata which contains german umlauts, but I'm not quite sure what source encoding the rune(b) cast assumes. Is it assuming some kind of default encoding, e.g. ISO8859-1 or is there any way to tell it what encoding to use? <code>  func toUtf8(iso8859_1_buf []byte) string { var buf = bytes.NewBuffer(make([]byte, len(iso8859_1_buf)*4)) for _, b := range(iso8859_1_buf) { r := rune(b) buf.WriteRune(r) } return string(buf.Bytes())}",golang convert iso8859-1 to utf8
How can i close bufio.Reader/Writer in golang?," How can I close bufio.Reader or bufio.Writer in golang? Should I close Writer? or just use file.Close() will make Writer close? <code>  func init(){ file,_ := os.Create(""result.txt"") writer = bufio.NewWriter(file)}",How can I close bufio.Reader/Writer in golang?
How Can i read a whole file into a string variable in golang?," I have lots of small files, I don't want to read them line by line.Is there a function in Go that will read a whole file into a string variable? <code> ",How can I read a whole file into a string variable
How Can I read a whole file into a string variable in Golang?," I have lots of small files, I don't want to read them line by line.Is there a function in Go that will read a whole file into a string variable? <code> ",How can I read a whole file into a string variable
How can I read a whole file into a string variable in Golang?," I have lots of small files, I don't want to read them line by line.Is there a function in Go that will read a whole file into a string variable? <code> ",How can I read a whole file into a string variable
Check whether a value is in a string slice in Go," What is the best way to check whether a certain value is in a string slice? I would use a Set in other languages, but Go doesn't have one.My best try is this so far: http://play.golang.org/p/gkwMz5j09nThis solution should be ok for small slices, but what to do for slices with many elements? <code>  package mainimport ""fmt""func main() { list := []string{""a"", ""b"", ""x""} fmt.Println(isValueInList(""b"", list)) fmt.Println(isValueInList(""z"", list))}func isValueInList(value string, list []string) bool { for _, v := range list { if v == value { return true } } return false}",Check whether a string slice contains a certain value in Go
Container types in google Go," I am trying to familiarize myself with Go and so was trying to implements some search function but looking through the docs for the container types, none of the inbuilt type implements a contains method. Am i missing something and if not how do i go about testing for membership? Do I have to implement my own method or i have to iterate through all elements. If this is so what is the rationale behind the omission of this elementary method for container types? <code> ",Container types in Go
How to generate hash number of a string in golang?," For example: Is there any built-in function could do this ?Thanks. <code>  hash(""HelloWorld"") = 1234567",How to generate hash number of a string in Go?
How do I parse an inner field in a nested JSON object in Golang?," I have a JSON object similar to this one: Now I want to parse ""name"" and ""mother"" into this struct: I want to specify the JSON field name with the json:... struct tag, however I don't know what to use as tag, because it is not the top object I am interested in. I found nothing about this in the encoding/json package docs nor in the popular blog post JSON and Go. I also tested mother, parents/mother and parents.mother. <code>  { ""name"": ""Cain"", ""parents"": { ""mother"" : ""Eve"", ""father"" : ""Adam"" }} struct { Name String Mother String `json:""???""`}",How to parse an inner field in a nested JSON object
Using the same tag for both json and bencode encoding packages," I feel like this should be a minor problem, but I've tried every pattern that I can think of, and I haven't had any luck. I have a structure that needs to be encodable by both the encoding/json and github.com/zeebo/bencode packages. It happens to include a channel, which cannot be encoded by either package. Thus, it needs to carry the tag ""-"", so that that field is skipped. This is valid when encoded by the json package, but fails with the bencode package. This block, of course, has the complimentary problem. I have tried tag syntaxes like json:""-"",bencode:""-"", *:""-"", ""-"", -. Is there a solution?Thank you all. <code>  type Index struct { Data data Queue chan string `json:""-""`} type Index struct { Data data Queue chan string `bencode:""-""`}",Multiple tags on the same Go struct member
The best way to get a string from a Writer in Go, I have a piece of code that returns a web page using the built-in template system. It accepts a ResponseWriter to which the resulting markup is written. I now want to get to the markup as a string and put it in a database in some cases. I factored out a method that accepts a normal Writer instead of a ResponseWriter and am now trying to get to the written content. Aha - a Pipe may be what I need and then I can get the string with ReadString from the bufio library. But it turns out that the PipeReader coming out from the pipe is not compatible with Reader (that I would need for the ReadString method). W00t. Big surprise. So I could just read into byte[]s using the PipeReader but it feels a bit wrong when ReadString is there. So what would be the best way to do it? Should I stick with the Pipe and read bytes or is there something better that I haven't found in the manual? <code> ,The best way to get a string from a Writer
golang - html/templates - Replacing newlines with <br>," I'm loading a text file that has newlines in it, and pass it to html/templates.Substituting the \n with <br> in the loaded string, they are escaped by the template to html &lt;br&gt; and displayed in the browser, instead of causing a line return.How can I change this behavior without switching to text/templates (which doesn't have XSS protection)? <code> ",html/templates - Replacing newlines with <br>
Encode / decode URLs in Go," What's the recommended way of encoding and decoding entire URLs in Go? I am aware of the methods url.QueryEscape and url.QueryUnescape, but they don't seem to be exactly what I am looking for. Specifically I am looking for methods like JavaScript's encodeURIComponent and decodeURIComponent.Thanks. <code> ",Encode / decode URLs
Is increment operators in Go atomic on x86?," Here's some background:I need a counter variable shared between go routines, used for something like a leaky-bucket. I know there's an example of leaky-bucket in Effective Go, concurrent section, but the number that I need to track may be very large, and I feel it's inefficient to use number of elements in a channel to track it. So I am considering of using a shared variable between different routines to track the number.I understand that without explicit configuration, all go routines are mapped onto one thread. But if I assign more than one thread to the program on a multi-core computer, is increment operators atomic? Is it all the same for different data types (int32, float32, etc.) on different machines (x86_32, x86_64, arm)?To be more concrete, What if I have counter += 1000 in one routine, and counter -= 512 in another routine, and the two routines happens to be running in two threads? Do I need to worry about thread-safty? Shall I put on locks on the counter? <code> ",Are increment operators in Go atomic on x86?
Golang function similar to getchar, Is there a Go function similar to C's getchar able to handle tab press in console? I want to make some sort of completion in my console app. <code> ,function similar to getchar
Method on member of struct in Golang," When decoding JSON I've always explicitly written a struct for each object so that I could implement the Stringer interface for individual objects in a parent struct like so: I recently learned that it is possible to do nesting with anonymous structs. This method is much more concise for defining the structure of the data to be decoded: But, is it possible to define a method on a member of a struct, particularly a member which is an anonymous struct? Like the Stringer interface implementation in the first code block. <code>  type Data struct { Records []Record}type Record struct { ID int Value string}func (r Record) String() string { return fmt.Sprintf(""{ID:%d Value:%s}"", r.ID, r.Value)} type Data struct { Records []struct { ID int Value string }}",Method on a struct field of type defined by a type literal
Method on anonymous struct member of named struct type in Golang," When decoding JSON I've always explicitly written a struct for each object so that I could implement the Stringer interface for individual objects in a parent struct like so: I recently learned that it is possible to do nesting with anonymous structs. This method is much more concise for defining the structure of the data to be decoded: But, is it possible to define a method on a member of a struct, particularly a member which is an anonymous struct? Like the Stringer interface implementation in the first code block. <code>  type Data struct { Records []Record}type Record struct { ID int Value string}func (r Record) String() string { return fmt.Sprintf(""{ID:%d Value:%s}"", r.ID, r.Value)} type Data struct { Records []struct { ID int Value string }}",Method on a struct field of type defined by a type literal
Go - dynamically call pointer receiver method on struct of unknown type," I'm working on a templating system written in Go, which means it requires liberal use of the reflect package. In this specific circumstance I need to be able to dynamically call a method on an interface{}. The oddity is that my reflection logic works fine as long as my data is of a known type, but not if the data is of type interface{}.The the following example you can see that the logic in main() and Pass() is identical. The only difference is whether the data is a known type or a known type inside an interface{}Go Play: http://play.golang.org/p/FTP3wgc0sZ Upon executing this code we get the following result Which means that my methodology for dynamically calling a method works fine except in a scenario when my object is currently in an interface{}.If instead I do not use a pointer receiver and pass i then it works as expected.Go Play: http://play.golang.org/p/myM0UXVYzXThis leads me to believe that my problem is that I cannot access the address of i (&i) when it is an interface{}. I've scoured the reflect package and tested things such as reflect.Value.Addr() and reflect.PtrTo() but I could not get either to work the way I needed. My hunch is that it has something to do with the fact that an interface{} is by definition a reference object. <code>  package mainimport ( ""fmt"" ""reflect"")type Test struct { Start string}func (t *Test) Finish() string { return t.Start + ""finish""}func Pass(i interface{}) { _, ok := reflect.TypeOf(&i).MethodByName(""Finish"") if ok { fmt.Println(reflect.ValueOf(&i).MethodByName(""Finish"").Call([]reflect.Value{})[0]) } else { fmt.Println(""Pass() fail"") }}func main() { i := Test{Start: ""start""} Pass(i) _, ok := reflect.TypeOf(&i).MethodByName(""Finish"") if ok { fmt.Println(reflect.ValueOf(&i).MethodByName(""Finish"").Call([]reflect.Value{})[0]) } else { fmt.Println(""main() fail"") }} Pass() failstartfinish",Dynamically call method on interface{} regardless of receiver type
Localisation strategies for Go with App Engine," Not necessarily specific to GAE I suppose, but I'm curious as to what people are using to translate or localise their web applications.My own approach I'm afraid is hopelessly naive, really just a hand-wave at the issue by loading an entity from the datastore for each package based on a locale value recorded in the user's profile. At least this allows translations of a few strings to be provided: Store with a string id corresponding to a locale, then load to Gorilla context or similar: Which is obviously incredibly limited, but at least makes strings available from calling code via context.Get(r, foo.Messages). Can anyone point me at more useful implementations, or suggest a better approach?Edit (relevant but not completely useful):gettext: a MO file parsergo-18nInternationalization plan for GoPolyglot <code>  package foo...type Messages struct { Locale string ErrorDatastore string LoginSuccessful string ...} const Messages ContextKey = iota...k := datastore.NewKey(c, ""Messages"", ""en_US"", 0, nil)m := new(Messages)if err := datastore.Get(c, k, m); err != nil { ...} else { context.Set(r, Messages, m)}",I18n strategies for Go with App Engine
Localization strategies for Go with App Engine," Not necessarily specific to GAE I suppose, but I'm curious as to what people are using to translate or localise their web applications.My own approach I'm afraid is hopelessly naive, really just a hand-wave at the issue by loading an entity from the datastore for each package based on a locale value recorded in the user's profile. At least this allows translations of a few strings to be provided: Store with a string id corresponding to a locale, then load to Gorilla context or similar: Which is obviously incredibly limited, but at least makes strings available from calling code via context.Get(r, foo.Messages). Can anyone point me at more useful implementations, or suggest a better approach?Edit (relevant but not completely useful):gettext: a MO file parsergo-18nInternationalization plan for GoPolyglot <code>  package foo...type Messages struct { Locale string ErrorDatastore string LoginSuccessful string ...} const Messages ContextKey = iota...k := datastore.NewKey(c, ""Messages"", ""en_US"", 0, nil)m := new(Messages)if err := datastore.Get(c, k, m); err != nil { ...} else { context.Set(r, Messages, m)}",I18n strategies for Go with App Engine
How to JSONize a uint8 slice in Go?," I've got a struct with a []uint8 member and I'm writing it with json.Marshal. Trouble is, it's interpreting the uint8s as chars and it outputs a string rather than an array of numbers. I can get this to work if it's a []int, but I don't want to have to allocate and copy over the items if I can avoid it. Can I? <code> ",How to marshal a byte/uint8 array as json array in Go?
"Go, Read lines from stdin until certain character"," I'm learning Go.My program should read data from stdin until I enter a line with a single period. How I should modify my for loop, to stop the program when I enter a single dot ?I tried to implement a while loop with the for statement, is there something wrong with my approach, is the condition wrong, or is ReadString messing with my data ? <code>  package mainimport ( ""os"" ""fmt"" ""bufio"")func main(){ in := bufio.NewReader(os.Stdin) input := """" for input != ""."" { input, err := in.ReadString('\n') if err != nil { panic(err) } }}",Read lines from stdin until certain character
What is the beste way to convert byte array to string in Golang?," I need to read [100]byte to transfer a bunch of string data.Because not all of the strings are precisely 100 characters long, the remaining part of the byte array is padded with 0s.If I convert [100]byte to string by: string(byteArray[:]), the tailing 0s are displayed as ^@^@s.In C, the string will terminate upon 0, so what's the best way to convert this byte array to string in Go? <code> ",How can I convert a zero-terminated byte array to string?
What is the beste way to convert byte array to string?," I need to read [100]byte to transfer a bunch of string data.Because not all of the strings are precisely 100 characters long, the remaining part of the byte array is padded with 0s.If I convert [100]byte to string by: string(byteArray[:]), the tailing 0s are displayed as ^@^@s.In C, the string will terminate upon 0, so what's the best way to convert this byte array to string in Go? <code> ",How can I convert a zero-terminated byte array to string?
What is the best way to convert byte array to string?," I need to read [100]byte to transfer a bunch of string data.Because not all of the strings are precisely 100 characters long, the remaining part of the byte array is padded with 0s.If I convert [100]byte to string by: string(byteArray[:]), the tailing 0s are displayed as ^@^@s.In C, the string will terminate upon 0, so what's the best way to convert this byte array to string in Go? <code> ",How can I convert a zero-terminated byte array to string?
How to convert a zero-terminated byte array to string?," I need to read [100]byte to transfer a bunch of string data.Because not all of the strings are precisely 100 characters long, the remaining part of the byte array is padded with 0s.If I convert [100]byte to string by: string(byteArray[:]), the tailing 0s are displayed as ^@^@s.In C, the string will terminate upon 0, so what's the best way to convert this byte array to string in Go? <code> ",How can I convert a zero-terminated byte array to string?
os.MkDir and os.MkDirAll permission value?," I'm trying to create a log file at the start of my program.I need to check if a /log directory exists if it doesn't create the directory then move on to creating the log file.Well I tried to use os.Mkdir (as well as os.MkdirAll), but no matter what value I put into the second parameter I get a locked out folder with no permissions. What value should this be in order to get a read / write for user folder? I thought it would be 0x700 but it doesn't seem to work.Thanks! <code> ",os.Mkdir and os.MkdirAll permissions
How to slice a string using a delimeter in GAE GO," In Go, if I have a string variable s: How can I convert or split or explode it into a slice or an array of strings so that it will become: <code>  var s string = ""a,b,c,d,e"" arr[0] = ""a""...arr[4] = ""e""",How to slice a string using a delimiter
How to slice a string using a delimeter," In Go, if I have a string variable s: How can I convert or split or explode it into a slice or an array of strings so that it will become: <code>  var s string = ""a,b,c,d,e"" arr[0] = ""a""...arr[4] = ""e""",How to slice a string using a delimiter
Disable chunked encoding for HTTP server responses in GO," I'm writing a small experimental http server in GO using the net/http package, and I need all my replies to have 'identity' transfer encoding. However the http server in GO always returns responses using the 'chunked' transfer.Is there any way to disable chunked encoding on HTTP server in GO? <code> ",Disable chunked encoding for HTTP server responses
Is Go language garbage collection better than JVM?," I do not know much about the Go programming language, but I have seen several claims that said Go has latency-free garbage collection, and it is much better than other garbage collectors (like JVM garbage collector). I have developed application for JVM and i know that JVM garbage collector is not latency-free (specially in large memory usage). I was wondering, what is difference between the garbage collection approach in Go and and the others which make it latency-free?Thanks in advance.Edit:@All I edited this question entirely, please vote to reopen this question if you find it constructive. <code> ",What is the Go language garbage collection approach compared to others?
What is difference between the garbage collection in Go language and JVM?," I do not know much about the Go programming language, but I have seen several claims that said Go has latency-free garbage collection, and it is much better than other garbage collectors (like JVM garbage collector). I have developed application for JVM and i know that JVM garbage collector is not latency-free (specially in large memory usage). I was wondering, what is difference between the garbage collection approach in Go and and the others which make it latency-free?Thanks in advance.Edit:@All I edited this question entirely, please vote to reopen this question if you find it constructive. <code> ",What is the Go language garbage collection approach compared to others?
How expensive []byte(string) in Go?," Let's convert string to []byte: How expensive is this cast operation? Is copying performed? As far as I see in Go specification: Strings behave like slices of bytes but are immutable, this should involve at least copying to be sure subsequent slice operations will not modify our string s. What happens with reverse conversation? Does []byte <-> string conversation involve encoding/decoding, like utf8 <-> runes? <code>  func toBytes(s string) []byte { return []byte(s) // What happens here?}",How expensive is []byte(string)?
How expensive []byte(string)?," Let's convert string to []byte: How expensive is this cast operation? Is copying performed? As far as I see in Go specification: Strings behave like slices of bytes but are immutable, this should involve at least copying to be sure subsequent slice operations will not modify our string s. What happens with reverse conversation? Does []byte <-> string conversation involve encoding/decoding, like utf8 <-> runes? <code>  func toBytes(s string) []byte { return []byte(s) // What happens here?}",How expensive is []byte(string)?
"Does ""package main"" need it's own folder?"," In my GOPATH I have something like this: In main.go I have package main, in d_interface.go and d_struct_that_implements_the_interface.go I have package my_prog.When I try to go build my_prog I get the following error: Does this mean that any file that belongs to package main should go in its own folder? If so, what is the reason for this? <code>  /bin//pkg//src//src/my_prog//src/my_prog/main.go/src/my_prog/d_interface.go/src/my_prog/d_struct_that_implements_the_interface.go can't load package: package my_prog: found packages my_prog (d_interface.go) and main (main.go) in C:\dev\Code\Go\src\my_prog","Error ""can't load package: package my_prog: found packages my_prog and main"""
"golang: Error ""can't load package: package my_prog: found packages my_prog and main"""," In my GOPATH I have something like this: In main.go I have package main, in d_interface.go and d_struct_that_implements_the_interface.go I have package my_prog.When I try to go build my_prog I get the following error: Does this mean that any file that belongs to package main should go in its own folder? If so, what is the reason for this? <code>  /bin//pkg//src//src/my_prog//src/my_prog/main.go/src/my_prog/d_interface.go/src/my_prog/d_struct_that_implements_the_interface.go can't load package: package my_prog: found packages my_prog (d_interface.go) and main (main.go) in C:\dev\Code\Go\src\my_prog","Error ""can't load package: package my_prog: found packages my_prog and main"""
"Golang: Error ""can't load package: package my_prog: found packages my_prog and main"""," In my GOPATH I have something like this: In main.go I have package main, in d_interface.go and d_struct_that_implements_the_interface.go I have package my_prog.When I try to go build my_prog I get the following error: Does this mean that any file that belongs to package main should go in its own folder? If so, what is the reason for this? <code>  /bin//pkg//src//src/my_prog//src/my_prog/main.go/src/my_prog/d_interface.go/src/my_prog/d_struct_that_implements_the_interface.go can't load package: package my_prog: found packages my_prog (d_interface.go) and main (main.go) in C:\dev\Code\Go\src\my_prog","Error ""can't load package: package my_prog: found packages my_prog and main"""
What is an idiomatic way of representing enums in golang?," I'm trying to represent a simplified chromosome, which consists of N bases, each of which can only be one of {A, C, T, G}.I'd like to formalize the constraints with an enum, but I'm wondering what the most idiomatic way of emulating an enum is in Go. <code> ",What is an idiomatic way of representing enums in Go?
How I should run my golang process in background ?," This question is not strictly programming related, but for sure important for programmers.I wrote a simple smtp server, when I run it from console all is fine, except it is blocking the command line.I know I can run it via or via screen / tmux etcBut the question is, how should I implement my program it runs in the background and it will be a pleasure for a system administrator to set it up and manage the process ?Some guys with far more experience than me, at golang-nuts, wrote, they don't use fork etc, and use some ""wrapper"" in form from monit etc.The target platform is Debian based, all other stuff on the box are init.d based.Any good resources for that topic or sources of a well written example project ? <code>  nohup ... &",How I should run my Golang process in background?
Find out which methods implements which interface," Example: In package io the type ByteReader defines an interface that wraps the method ReadByte() (c byte, err error). What is the easiest way to find out which types in the standard library (i.e. listed here in golang.org/pkg) satisfy this interface? Is this just a matter of experience or is there any other help? <code> ",How to find out which types implement which interface
Find out which types implement which interface," Example: In package io the type ByteReader defines an interface that wraps the method ReadByte() (c byte, err error). What is the easiest way to find out which types in the standard library (i.e. listed here in golang.org/pkg) satisfy this interface? Is this just a matter of experience or is there any other help? <code> ",How to find out which types implement which interface
How can I find out which types implement which interface?," Example: In package io the type ByteReader defines an interface that wraps the method ReadByte() (c byte, err error). What is the easiest way to find out which types in the standard library (i.e. listed here in golang.org/pkg) satisfy this interface? Is this just a matter of experience or is there any other help? <code> ",How to find out which types implement which interface
How to find out which types implement which interface in Golang?," Example: In package io the type ByteReader defines an interface that wraps the method ReadByte() (c byte, err error). What is the easiest way to find out which types in the standard library (i.e. listed here in golang.org/pkg) satisfy this interface? Is this just a matter of experience or is there any other help? <code> ",How to find out which types implement which interface
Golang memory consumption management," I am new to Go and trying to figure out how it manages memory consumption.I have trouble with memory in one of my test projects. I don't understand why Go uses more and more memory (never freeing it) when my program runs for a long time.I am running the test case provided below. After the first allocation, program uses nearly 350 MB of memory (according to ActivityMonitor). Then I try to free it and ActivityMonitor shows that memory consumption doubles. Why?I am running this code on OS X using Go 1.0.3.What is wrong with this code? And what is the right way to manage large variables in Go programs?I had another memory-management-related problem when implementing an algorithm that uses a lot of time and memory; after running it for some time it throws an ""out of memory"" exception. <code>  package mainimport (""fmt"" ""time"")func main() { fmt.Println(""getting memory"") tmp := make([]uint32, 100000000) for kk, _ := range tmp { tmp[kk] = 0 } time.Sleep(5 * time.Second) fmt.Println(""returning memory"") tmp = make([]uint32, 1) tmp = nil time.Sleep(5 * time.Second) fmt.Println(""getting memory"") tmp = make([]uint32, 100000000) for kk, _ := range tmp { tmp[kk] = 0 } time.Sleep(5 * time.Second) fmt.Println(""returning memory"") tmp = make([]uint32, 1) tmp = nil time.Sleep(5 * time.Second) return}",Go memory consumption management
List directory in go," I've been trying to figure out how to simply list the files and folders in a single directory in Go.I've found filepath.Walk, but it goes into sub-directories automatically, which I don't want. All of my other searches haven't turned anything better up. I'm sure that this functionality exists, but it's been really hard to find. Let me know if anyone knows where I should look. Thanks. <code> ",List directory in Go
what's the difference between fmt.Println() and println() in go," As illustrated below, both fmt.Println() and println() give same output in Go: Hello world!But: how do they differ from each other?Snippet 1, using the fmt package; Snippet 2, without the fmt package; <code>  package mainimport ( ""fmt"")func main() { fmt.Println(""Hello world!"")} package mainfunc main() { println(""Hello world!"")}",Difference between fmt.Println() and println() in Go
What's the difference between fmt.Println() and println() in Go?," As illustrated below, both fmt.Println() and println() give same output in Go: Hello world!But: how do they differ from each other?Snippet 1, using the fmt package; Snippet 2, without the fmt package; <code>  package mainimport ( ""fmt"")func main() { fmt.Println(""Hello world!"")} package mainfunc main() { println(""Hello world!"")}",Difference between fmt.Println() and println() in Go
Generate GO source code, I am looking for a way to generate Go source code.I found go/parser to generate an AST form a Go source file but couldn't find a way to generate Go source from AST. <code> ,Generate Go source code
glGetUniformLocation often returns 0 instead of -1 for an attribute that does not exist," I wrote a simple Go program. Its goal is to rotate a triangle on the screen using OpenGl.EDIT: The main loop seems to be responsible, OpenGl is fine, but I am doing something wrong with goroutines and/or channels. See at the bottom of this post. I am changing the title of this question appropriately.The program almost works. It stutters, alternating between rotating as it is supposed to, and just flashing the two OpenGl buffers without drawing anything. About two thirds of the frames I try to render fail silently, and I do not understand why.This does not depend on my frame rate. Whether I update at 50 or 1 FPS, I get long series of messed up frames followed by shorter series of working frames. I don't think I am asking OpenGl to work too fast (and I call glFinish() anyway).I started experimenting and found a strange behavior.I use glGetUniformLocation as a first step to send my new rotation matrix to the vertex buffer.I noticed that if I ask glGetUniformLocation to tell me where I can find ""dummy"", a parameter that obviously does not exist in the shader, it does not always return -1 as expected ; it sometimes returns 0. That dummy attribute is not responsible for the problem, it is merely a symptom.I check glGetError after every OpenGl call, they always return NO_ERROR.I am pasting here my code. I wish I could have made it shorter. My real code checks glError after every single call to OpenGl, and also looks at 0 buffers or -1 locations. This version is lighter. func main is at the top, followed my the loop that takes care of the rotation. As requested, the output of glxinfo. EDIT: The main loop seems to be responsible, OpenGl is fine, but I am doing something wrong with goroutines and/or channels.If I replace my main loop with something that does not rely on channels and goroutines, then OpenGl behaves perfectly. My problem may come from the fact that OpenGl is in the main Goroutine, which blocks while waiting for the channels to deliver a tick or a SDL event. I don't know, I am confused.Changing the title from glGetUniformLocation often returns 0 instead of -1 for an attribute that does not exist to OpenGl seems stuck while my main loop waits for channels to tick and deliver events. <code>  package mainimport ( ""fmt"" ""github.com/0xe2-0x9a-0x9b/Go-SDL/sdl"" gl ""github.com/chsc/gogl/gl33"" ""math"" ""time"" ""unsafe"")const DEG_TO_RAD = math.Pi / 180type GoMatrix [16]float64type GlMatrix [16]gl.Floatvar good_frames, bad_frames, sdl_events intfunc main() { //================================================================= // Just opening a window, skip to the next part. if status := sdl.Init(sdl.INIT_VIDEO); status != 0 { panic(""Could not initialize SDL: "" + sdl.GetError()) } defer sdl.Quit() sdl.GL_SetAttribute(sdl.GL_DOUBLEBUFFER, 1) const FLAGS = sdl.OPENGL if screen := sdl.SetVideoMode(640, 480, 32, FLAGS); screen == nil { panic(""Could not open SDL window: "" + sdl.GetError()) } if err := gl.Init(); err != nil { panic(err) } gl.Viewport(0, 0, 640, 480) gl.ClearColor(.5, .5, .5, 1) //================================================================= // Simplest shaders ever. // A matrix to move the model, nothing else. vertex_code := gl.GLString(` #version 330 core in vec3 vpos; uniform mat4 MVP; void main() { gl_Position = MVP * vec4(vpos, 1); } `) // Everything is red. fragment_code := gl.GLString(` #version 330 core void main(){ gl_FragColor = vec4(1,0,0,1); } `) vs := gl.CreateShader(gl.VERTEX_SHADER) fs := gl.CreateShader(gl.FRAGMENT_SHADER) gl.ShaderSource(vs, 1, &vertex_code, nil) gl.ShaderSource(fs, 1, &fragment_code, nil) gl.CompileShader(vs) gl.CompileShader(fs) prog := gl.CreateProgram() gl.AttachShader(prog, vs) gl.AttachShader(prog, fs) gl.LinkProgram(prog) // Did it compile? var link_status gl.Int gl.GetProgramiv(prog, gl.LINK_STATUS, &link_status) if link_status == gl.FALSE { var info_log_length gl.Int gl.GetProgramiv(prog, gl.INFO_LOG_LENGTH, &info_log_length) if info_log_length == 0 { panic(""Program linking failed but OpenGL has no log about it."") } else { info_log_gl := gl.GLStringAlloc(gl.Sizei(info_log_length)) defer gl.GLStringFree(info_log_gl) gl.GetProgramInfoLog(prog, gl.Sizei(info_log_length), nil, info_log_gl) info_log := gl.GoString(info_log_gl) panic(info_log) } } gl.UseProgram(prog) attrib_vpos := gl.Uint(gl.GetAttribLocation(prog, gl.GLString(""vpos""))) //================================================================= // One triangle. positions := [...]gl.Float{-.5, -.5, 0, .5, -.5, 0, 0, .5, 0} var vao gl.Uint gl.GenVertexArrays(1, &vao) gl.BindVertexArray(vao) var vbo gl.Uint gl.GenBuffers(1, &vbo) gl.BindBuffer(gl.ARRAY_BUFFER, vbo) gl.BufferData(gl.ARRAY_BUFFER, gl.Sizeiptr(unsafe.Sizeof(positions)), gl.Pointer(&positions[0]), gl.STATIC_DRAW) gl.EnableVertexAttribArray(attrib_vpos) gl.VertexAttribPointer(attrib_vpos, 3, gl.FLOAT, gl.FALSE, 0, gl.Pointer(nil)) //================================================================= Loop(prog) fmt.Println(""Good frames"", good_frames) fmt.Println(""Bad frames "", bad_frames) fmt.Println(""SDL events "", sdl_events)}func Loop(program gl.Uint) { start_time := time.Now() ticker := time.NewTicker(100 * time.Millisecond) defer ticker.Stop() running := true for running { select { case tick_time := <-ticker.C: OnTick(start_time, tick_time, program) case event := <-sdl.Events: running = OnSdlEvent(event) } }}func OnSdlEvent(event interface{}) bool { sdl_events++ switch event.(type) { case sdl.QuitEvent: return false // Stop the main loop. } return true // Do not stop the main loop.}func OnTick(start_time, tick_time time.Time, program gl.Uint) { duration := tick_time.Sub(start_time).Seconds() speed := 10. angle := math.Mod(duration*speed, 360) gom := RotZ(angle) MVP := ToGlMatrix(gom) /* HERE, SOMETHING FISHY HAPPENS. Problem: sometimes, actually often, OpenGl returns 0 instead of -1 for the dummy parameter. This is entirely correlated to the stuttering. With my implementation of OpenGl, swap buffer does a real swap. That means I get to see the last two pictures rendered. Thing is, I can see the swap, that means the pictures are different. That means that the call to DrawArrays is ignored. OpenGl is just crapping its pants. */ matrix_loc := gl.GetUniformLocation(program, gl.GLString(""MVP"")) dummy_matrix_loc := gl.GetUniformLocation(program, gl.GLString(""dummy"")) if gl.GetError() != gl.NO_ERROR { fmt.Println(""Error get location"") // Never happens. } if dummy_matrix_loc == -1 { good_frames++ // Because is SHOULD fail. } else { bad_frames++ // That's not normal. } gl.UniformMatrix4fv(matrix_loc, 16, gl.TRUE, &MVP[0]) if gl.GetError() != gl.NO_ERROR { fmt.Println(""Error send matrix"") // Never happens. } gl.Clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT) if gl.GetError() != gl.NO_ERROR { fmt.Println(""Error clearing"") // Never happens. } gl.DrawArrays(gl.TRIANGLES, 0, 3) if gl.GetError() != gl.NO_ERROR { fmt.Println(""Error drawing"") // Never happens. } gl.Finish() // Does not seem to make anything work better. sdl.GL_SwapBuffers()}func RotZ(angle float64) GoMatrix { var gom GoMatrix a := angle * DEG_TO_RAD c := math.Cos(a) s := math.Sin(a) gom[0] = c gom[1] = s gom[4] = -s gom[5] = c gom[10] = 1 gom[15] = 1 return gom}func ToGlMatrix(gom GoMatrix) GlMatrix { var glm GlMatrix glm[0] = gl.Float(gom[0]) glm[1] = gl.Float(gom[1]) glm[2] = gl.Float(gom[2]) glm[3] = gl.Float(gom[3]) glm[4] = gl.Float(gom[4]) glm[5] = gl.Float(gom[5]) glm[6] = gl.Float(gom[6]) glm[7] = gl.Float(gom[7]) glm[8] = gl.Float(gom[8]) glm[9] = gl.Float(gom[9]) glm[10] = gl.Float(gom[10]) glm[11] = gl.Float(gom[11]) glm[12] = gl.Float(gom[12]) glm[13] = gl.Float(gom[13]) glm[14] = gl.Float(gom[14]) glm[15] = gl.Float(gom[15]) return glm} > glxinfoname of display: :0display: :0 screen: 0direct rendering: Yesserver glx vendor string: ATIserver glx version string: 1.4server glx extensions: GLX_ARB_multisample, GLX_EXT_import_context, GLX_EXT_texture_from_pixmap, GLX_EXT_visual_info, GLX_EXT_visual_rating, GLX_OML_swap_method, GLX_SGI_make_current_read, GLX_SGI_swap_control, GLX_SGIS_multisample, GLX_SGIX_fbconfig, GLX_SGIX_pbuffer, GLX_SGIX_visual_select_groupclient glx vendor string: ATIclient glx version string: 1.4client glx extensions: GLX_ARB_create_context, GLX_ARB_create_context_profile, GLX_ARB_get_proc_address, GLX_ARB_multisample, GLX_EXT_import_context, GLX_EXT_visual_info, GLX_EXT_visual_rating, GLX_MESA_allocate_memory, GLX_MESA_copy_sub_buffer, GLX_MESA_swap_control, GLX_MESA_swap_frame_usage, GLX_NV_swap_group, GLX_OML_swap_method, GLX_SGI_make_current_read, GLX_SGI_swap_control, GLX_SGI_video_sync, GLX_SGIS_multisample, GLX_SGIX_fbconfig, GLX_SGIX_pbuffer, GLX_SGIX_swap_barrier, GLX_SGIX_swap_group, GLX_SGIX_visual_select_group, GLX_EXT_texture_from_pixmap, GLX_EXT_framebuffer_sRGB, GLX_ARB_fbconfig_float, GLX_AMD_gpu_associationGLX version: 1.4GLX extensions: GLX_ARB_create_context, GLX_ARB_create_context_profile, GLX_ARB_get_proc_address, GLX_ARB_multisample, GLX_EXT_import_context, GLX_EXT_visual_info, GLX_EXT_visual_rating, GLX_MESA_swap_control, GLX_NV_swap_group, GLX_OML_swap_method, GLX_SGI_make_current_read, GLX_SGI_swap_control, GLX_SGI_video_sync, GLX_SGIS_multisample, GLX_SGIX_fbconfig, GLX_SGIX_pbuffer, GLX_SGIX_swap_barrier, GLX_SGIX_swap_group, GLX_SGIX_visual_select_group, GLX_EXT_texture_from_pixmapOpenGL vendor string: ATI Technologies Inc.OpenGL renderer string: ATI Mobility Radeon HD 4500 SeriesOpenGL version string: 3.3.11005 Compatibility Profile ContextOpenGL shading language version string: 3.30OpenGL extensions: GL_AMDX_debug_output, GL_AMDX_vertex_shader_tessellator, GL_AMD_conservative_depth, GL_AMD_debug_output, GL_AMD_depth_clamp_separate, GL_AMD_draw_buffers_blend, GL_AMD_name_gen_delete, GL_AMD_performance_monitor, GL_AMD_pinned_memory, GL_AMD_sample_positions, GL_AMD_seamless_cubemap_per_texture, GL_AMD_shader_stencil_export, GL_AMD_texture_cube_map_array, GL_AMD_texture_texture4, GL_AMD_vertex_shader_tessellator, GL_ARB_ES2_compatibility, GL_ARB_blend_func_extended, GL_ARB_color_buffer_float, GL_ARB_copy_buffer, GL_ARB_depth_buffer_float, GL_ARB_depth_clamp, GL_ARB_depth_texture, GL_ARB_draw_buffers, GL_ARB_draw_buffers_blend, GL_ARB_draw_elements_base_vertex, GL_ARB_draw_instanced, GL_ARB_explicit_attrib_location, GL_ARB_fragment_coord_conventions, GL_ARB_fragment_program, GL_ARB_fragment_program_shadow, GL_ARB_fragment_shader, GL_ARB_framebuffer_object, GL_ARB_framebuffer_sRGB, GL_ARB_geometry_shader4, GL_ARB_get_program_binary, GL_ARB_half_float_pixel, GL_ARB_half_float_vertex, GL_ARB_imaging, GL_ARB_instanced_arrays, GL_ARB_map_buffer_range, GL_ARB_multisample, GL_ARB_multitexture, GL_ARB_occlusion_query, GL_ARB_occlusion_query2, GL_ARB_pixel_buffer_object, GL_ARB_point_parameters, GL_ARB_point_sprite, GL_ARB_provoking_vertex, GL_ARB_sample_shading, GL_ARB_sampler_objects, GL_ARB_seamless_cube_map, GL_ARB_separate_shader_objects, GL_ARB_shader_bit_encoding, GL_ARB_shader_objects, GL_ARB_shader_precision, GL_ARB_shader_stencil_export, GL_ARB_shader_texture_lod, GL_ARB_shading_language_100, GL_ARB_shadow, GL_ARB_shadow_ambient, GL_ARB_sync, GL_ARB_texture_border_clamp, GL_ARB_texture_buffer_object, GL_ARB_texture_buffer_object_rgb32, GL_ARB_texture_compression, GL_ARB_texture_compression_rgtc, GL_ARB_texture_cube_map, GL_ARB_texture_cube_map_array, GL_ARB_texture_env_add, GL_ARB_texture_env_combine, GL_ARB_texture_env_crossbar, GL_ARB_texture_env_dot3, GL_ARB_texture_float, GL_ARB_texture_gather, GL_ARB_texture_mirrored_repeat, GL_ARB_texture_multisample, GL_ARB_texture_non_power_of_two, GL_ARB_texture_query_lod, GL_ARB_texture_rectangle, GL_ARB_texture_rg, GL_ARB_texture_rgb10_a2ui, GL_ARB_texture_snorm, GL_ARB_timer_query, GL_ARB_transform_feedback2, GL_ARB_transform_feedback3, GL_ARB_transpose_matrix, GL_ARB_uniform_buffer_object, GL_ARB_vertex_array_bgra, GL_ARB_vertex_array_object, GL_ARB_vertex_buffer_object, GL_ARB_vertex_program, GL_ARB_vertex_shader, GL_ARB_vertex_type_2_10_10_10_rev, GL_ARB_viewport_array, GL_ARB_window_pos, GL_ATI_draw_buffers, GL_ATI_envmap_bumpmap, GL_ATI_fragment_shader, GL_ATI_meminfo, GL_ATI_separate_stencil, GL_ATI_texture_compression_3dc, GL_ATI_texture_env_combine3, GL_ATI_texture_float, GL_ATI_texture_mirror_once, GL_EXT_abgr, GL_EXT_bgra, GL_EXT_bindable_uniform, GL_EXT_blend_color, GL_EXT_blend_equation_separate, GL_EXT_blend_func_separate, GL_EXT_blend_minmax, GL_EXT_blend_subtract, GL_EXT_compiled_vertex_array, GL_EXT_copy_buffer, GL_EXT_copy_texture, GL_EXT_direct_state_access, GL_EXT_draw_buffers2, GL_EXT_draw_instanced, GL_EXT_draw_range_elements, GL_EXT_fog_coord, GL_EXT_framebuffer_blit, GL_EXT_framebuffer_multisample, GL_EXT_framebuffer_object, GL_EXT_framebuffer_sRGB, GL_EXT_geometry_shader4, GL_EXT_gpu_program_parameters, GL_EXT_gpu_shader4, GL_EXT_histogram, GL_EXT_multi_draw_arrays, GL_EXT_packed_depth_stencil, GL_EXT_packed_float, GL_EXT_packed_pixels, GL_EXT_pixel_buffer_object, GL_EXT_point_parameters, GL_EXT_provoking_vertex, GL_EXT_rescale_normal, GL_EXT_secondary_color, GL_EXT_separate_specular_color, GL_EXT_shadow_funcs, GL_EXT_stencil_wrap, GL_EXT_subtexture, GL_EXT_texgen_reflection, GL_EXT_texture3D, GL_EXT_texture_array, GL_EXT_texture_buffer_object, GL_EXT_texture_compression_latc, GL_EXT_texture_compression_rgtc, GL_EXT_texture_compression_s3tc, GL_EXT_texture_cube_map, GL_EXT_texture_edge_clamp, GL_EXT_texture_env_add, GL_EXT_texture_env_combine, GL_EXT_texture_env_dot3, GL_EXT_texture_filter_anisotropic, GL_EXT_texture_integer, GL_EXT_texture_lod, GL_EXT_texture_lod_bias, GL_EXT_texture_mirror_clamp, GL_EXT_texture_object, GL_EXT_texture_rectangle, GL_EXT_texture_sRGB, GL_EXT_texture_shared_exponent, GL_EXT_texture_snorm, GL_EXT_texture_swizzle, GL_EXT_timer_query, GL_EXT_transform_feedback, GL_EXT_vertex_array, GL_EXT_vertex_array_bgra, GL_IBM_texture_mirrored_repeat, GL_KTX_buffer_region, GL_NV_blend_square, GL_NV_conditional_render, GL_NV_copy_depth_to_color, GL_NV_explicit_multisample, GL_NV_float_buffer, GL_NV_half_float, GL_NV_primitive_restart, GL_NV_texgen_reflection, GL_NV_texture_barrier, GL_SGIS_generate_mipmap, GL_SGIS_texture_edge_clamp, GL_SGIS_texture_lod, GL_SUN_multi_draw_arrays, GL_WIN_swap_hint, WGL_EXT_swap_control func Loop(program gl.Uint) { start_time := time.Now() stop_time := start_time.Add(time.Duration(30 * time.Second)) running := true for running { tick_time := time.Now() OnTick(start_time, tick_time, program) time.Sleep(10 * time.Millisecond) if tick_time.After(stop_time) { running = false } }}",OpenGl seems stuck while my main loop waits for channels to tick and deliver events
"How do you access an outer scope while inside of a ""with"" or ""range"" scope?"," When inside a with or range, the scope of . is changed. How do you access the calling scope? <code> ","In a template how do you access an outer scope while inside of a ""with"" or ""range"" scope?"
Go  declared and not used," What's wrong with this code? prog.go:13: prev declared and not used <code>  package mainimport ""fmt""// fibonacci is a function that returns// a function that returns an int.func fibonacci() func() int { prev := 0 curr := 1 return func() int { temp := curr curr := curr + prev prev := temp return curr }}func main() { f := fibonacci() for i := 0; i < 10; i++ { fmt.Println(f()) }}","Go  declared and not used error, when I think I have done so to the variable"
What does it means that defined function without body in go language," I'm reading the code that package time, and then I want to know how the func After(d Duration) <-chan Time works. I found the code follows: So I found the definition of startTimer - it's so weird that function startTimer does not have a function body. I want to know that :Where is the real code of startTimer Why an ""abstract method"" can exists here Why the author of Go wrote it like thisThanks! <code>  func After(d Duration) <-chan Time { return NewTimer(d).C}func NewTimer(d Duration) *Timer { c := make(chan Time, 1) t := &Timer{ C: c, r: runtimeTimer{ when: nano() + int64(d), f: sendTime, arg: c, }, } startTimer(&t.r) return t} func startTimer(*runtimeTimer)",What does a function without body mean?
golang string index return not char," How to get an ""E"" output rather than 69? Does Golang have function to convert a char to byte and vice versa? <code>  package mainimport ""fmt""func main() { fmt.Print(""HELLO""[1])}",How to index characters in a Golang string?
How to index characters in a Go string," How to get an ""E"" output rather than 69? Does Golang have function to convert a char to byte and vice versa? <code>  package mainimport ""fmt""func main() { fmt.Print(""HELLO""[1])}",How to index characters in a Golang string?
Go: how can I change the for loop iterator type?," Go uses int for the iterator by default from what I can tell, except I want uint64. I cannot figure out a way to change the type of for loop iterator in Go. Is there a way to do it inline with the for statement? The default type of int causes problems when I try to do something in the loop, like a mod operation (%). <code>  func main() { var val uint64 = 1234567890 for i:=1; i<val; i+=2 { if val%i==0 { } } } ./q.go:7: invalid operation: i < val (mismatched types int and uint64)./q.go:8: invalid operation: val % i (mismatched types uint64 and int)",How can I change the for loop iterator type?
How to use custom packages in golang?," I'm trying to create and use a custom package in Go. It's probably something very obvious but I cannot find much information about this. Basically, I have these two files in the same folder:mylib.go main.go When I try to go run main.go, I get this error: I've tried to run go build mylib.go first but it doesn't seem to be doing anything (no file generated, no error message). So any idea how I could do this? <code>  package mylibtype SomeType struct {} package mainimport ( ""mylib"")func main() {} main.go:4:2: import ""mylib"": cannot find package",How to use custom packages
How to use custom packages in Golang?," I'm trying to create and use a custom package in Go. It's probably something very obvious but I cannot find much information about this. Basically, I have these two files in the same folder:mylib.go main.go When I try to go run main.go, I get this error: I've tried to run go build mylib.go first but it doesn't seem to be doing anything (no file generated, no error message). So any idea how I could do this? <code>  package mylibtype SomeType struct {} package mainimport ( ""mylib"")func main() {} main.go:4:2: import ""mylib"": cannot find package",How to use custom packages
why to name the return type in GO, What benefits arise from naming a function's return parameter(s)? <code>  func namedReturn(i int) (ret int) { ret = i i += 2 return}func anonReturn(i int) int { ret := i i += 2 return ret},Why should return parameters be named?
Go map (or list) of methods," I have several methods that I'm calling for some cases (like Add, Delete, etc..). However over time the number of cases is increasing and my switch-case is getting longer. So I thought I'd create a map of methods, like Go map of functions; here the mapping of functions is trivial. However, is it possible to create a map of methods in Go?When we have a method: The syntax below create compile-time error: Is it possible to create a map of methods in Go? <code>  func (f *Foo) Add(a string, b int) { } actions := map[string]func(a, b){ ""add"": f.Add(a,b),}",Map of methods in Go
Go map of methods," I have several methods that I'm calling for some cases (like Add, Delete, etc..). However over time the number of cases is increasing and my switch-case is getting longer. So I thought I'd create a map of methods, like Go map of functions; here the mapping of functions is trivial. However, is it possible to create a map of methods in Go?When we have a method: The syntax below create compile-time error: Is it possible to create a map of methods in Go? <code>  func (f *Foo) Add(a string, b int) { } actions := map[string]func(a, b){ ""add"": f.Add(a,b),}",Map of methods in Go
Packaging Golang application," How can I put my Go binary into a Debian package? Since Go is statically linked, I just have a single executable--I don't need a lot of complicated project metadata information. Is there a simple way to package the executable and resource files without going through the trauma of debuild?I've looked all over for existing questions; however, all of my research turns up questions/answers about a .deb file containing the golang development environment (i.e., what you would get if you do sudo apt-get install golang-go).  <code> ",Packaging Go application for Debian
Packaging Golang application for Debian," How can I put my Go binary into a Debian package? Since Go is statically linked, I just have a single executable--I don't need a lot of complicated project metadata information. Is there a simple way to package the executable and resource files without going through the trauma of debuild?I've looked all over for existing questions; however, all of my research turns up questions/answers about a .deb file containing the golang development environment (i.e., what you would get if you do sudo apt-get install golang-go).  <code> ",Packaging Go application for Debian
Read a character from standard input in Go, I want my app to show: And to exit when I press any key.How can I achieve this?Note: I have googled but all of what I've found needed to press Enter at the end. I want something like Console.ReadKey() in C#.I am running MS Windows. <code>  press any key to exit ...,Read a character from standard input in Go (without pressing Enter)
Golabg : Creating global map variables," I need a little help regarding creating a global map variable in Go. What I have done is as follows: Since I am not initializing the map, I am getting a nil pointer dereference error. What must I do to use this variable globally? Or, if this is not a correct way to do this, please guide me. <code>  package ...import(...)...type ir_table struct{ symbol string value string}var ir_MAP map[int]ir_table",Create global map variables
How can you have a 'debug build' in go?," I need to be able to build different versions of a go application; a 'debug' version and a normal version.This is easy to do; I simply have a const DEBUG, that controls the behaviour of the application, but it's annoying to have to edit the config file every time I need to swap between build types.I was reading about go build (http://golang.org/pkg/go/build/) and tags, I thought perhaps I could do this:config.go: config.debug.go: Then I should be able to build using go build or go build -tags debug, and the tags should exclude config.go and include config.debug.go....but this doesn't work. I get:src/build/config.go:3: DEBUG redeclared in this block (<0>) previousdeclaration at src/build/config.debug.go:3What am I doing wrong?Is there another and more appropriate #ifdef style way of doing this I should be using? <code>  // +build !debugpackage buildconst DEBUG = false // +build debugpackage buildconst DEBUG = true",How to properly use build tags?
Checking the equality of two arrays in Go, How can I check if two slices are equal? <code> ,Checking the equality of two slices
Checking the equality of two slices in Go, How can I check if two slices are equal? <code> ,Checking the equality of two slices
How to if x in array in golang?," Without iterating over the entire array, how can I check if x in array using Go? Does the language have a construct?Like Python: if ""x"" in array: ... <code> ","Does Go have ""if x in"" construct similar to Python?"
"Does golang have ""if x in"" construct similar to python?"," Without iterating over the entire array, how can I check if x in array using Go? Does the language have a construct?Like Python: if ""x"" in array: ... <code> ","Does Go have ""if x in"" construct similar to Python?"
"Does Golang have ""if x in"" construct similar to Python?"," Without iterating over the entire array, how can I check if x in array using Go? Does the language have a construct?Like Python: if ""x"" in array: ... <code> ","Does Go have ""if x in"" construct similar to Python?"
"In go, what is the idiomatic way to return either a struct or an error?"," I have a function that returns either a Card, which is a struct type, or an error.The problem is, how can I return from the function when an error occurs ? nil is not valid for structs and I don't have a valid zero value for my Card type. The only workaround I found is to use a *Card rather than a Card, a make it either nil when there is an error or make it point an actual Card when no error happens, but that's quite clumsy. Is there a better way ?EDIT : I found another way, but don't know if this is idiomatic or even good style. Since card is a named return value, I can use it without initializing it. It is zeroed in its own way, I don't really care since the calling function is not supposed to use this value. <code>  func canFail() (card Card, err error) { // return nil, errors.New(""Not yet implemented""); // Fails return Card{Ace, Spades}, errors.New(""not yet implemented""); // Works, but very ugly} func canFail() (card *Card, err error) { return nil, errors.New(""not yet implemented"");} func canFail() (card Card, err error) { return card, errors.New(""not yet implemented"")}",What is the idiomatic way to return either a struct or an error?
Is it necessary to put templates into a map for reusing in GoLang?," To deal with every request in a web application, the normal code about templates is like this: I guess ParseFiles every time cost a lot. Is it possible to reuse the template? So I improved it like this: I wonder it is feasible or practicable to improve efficiency by putting templates into a map or a cache?I also wonder the function Execute is thread safe or not?func (t *Template) Execute(wr io.Writer, data interface{}) (err error) <code>  t:= template.New(""welcome"")t, _ = t.ParseFiles(""welcome.tpl"")t.Execute(w, data) //templateMap := make(map[string][template])//...tplName :=""welcome""t := templateMap[tplName]if t=nil{ t:= template.New(tplName ) t, _ = t.ParseFiles(""welcome.tpl"") templateMap[tplName] = t}t.Execute(w, data)",Is it necessary to put templates into a map for reusing in Go?
How to expand slice to a list of arguments for fmt.Scanln()," I have a line containing 3 numbers that I want to read from stdin with fmt.Scanln() but this code won't work: I get this error message: I don't get it. <code>  X := make([]int, 3)fmt.Scanln(X...)fmt.Printf(""%v\n"", X) cannot use X (type []int) as type []interface {} in function argument",How to make fmt.Scanln() read into a slice of integers
Golang how to have an inplace string that updates at stdout?," I want to output to stdout and have the output ""overwrite"" the previous output.For example; if I output On 1/10, I want the next output On 2/10 to overwrite On 1/10. How can I do this? <code> ",How to have an in-place string that updates on stdout
Go: http static directories aren't being served," I don't understand why my static resources aren't being served. Here is the code: When I run the program, navigating to http://myhost.fake/css/ or to http://myhost.fake/css/main.css (these exists in the filesystem), I get a 404 error. The same is true if I replace ""./css"" with the full path to the directory. Ditto for the js static directory. My other handlers work fine. I am on a linux. Thanks! <code>  func main() { http.HandleFunc(""/"", get_shows) http.HandleFunc(""/get"", get_show_json) http.HandleFunc(""/set"", set_shows) http.Handle(""/css/"", http.FileServer(http.Dir(""./css""))) http.Handle(""/js/"", http.FileServer(http.Dir(""./js""))) http.ListenAndServe("":8080"", nil)}",http static directories aren't being served
`append` complexity in Go," What is the computational complexity of this loop in the Go programming language? Does append operate in linear time (reallocating memory and copying everything on each append), or in amortized constant time (like the way vector classes in many languages are implemnted)? <code>  var a []intfor i := 0 ; i < n ; i++ { a = append(a, i)}",`append` complexity
multiple goroutines listening on one channel," I have multiple goroutines trying to receive on the same channel simultaneously. It seems like the last goroutine that starts receiving on the channel gets the value. Is this somewhere in the language spec or is it undefined behaviour? Output: Example On PlaygroundEDIT:I just realized that it's more complicated than I thought. The message gets passed around all the goroutines. Output: NOTE: the above output is outdated in more recent versions of Go (see comments)Example On Playground <code>  c := make(chan string)for i := 0; i < 5; i++ { go func(i int) { <-c c <- fmt.Sprintf(""goroutine %d"", i) }(i)}c <- ""hi""fmt.Println(<-c) goroutine 4 c := make(chan string)for i := 0; i < 5; i++ { go func(i int) { msg := <-c c <- fmt.Sprintf(""%s, hi from %d"", msg, i) }(i)}c <- ""original""fmt.Println(<-c) original, hi from 0, hi from 1, hi from 2, hi from 3, hi from 4",Multiple goroutines listening on one channel
Go: Serial execution of package tests," I have implemented several packages for a web API, each with their own test cases. When each package is tested using go test ./api/pkgname the tests pass. If I want to run all tests at once with go test ./api/... test cases always fail.In each test case, I recreate the entire schema using DROP SCHEMA public CASCADE followed by CREATE SCHEMA public and apply all migrations. The test suite reports errors back at random, saying a relation/table does not exist, so I guess each test suite (per package) is run in parallel somehow, thus messing up the DB state.I tried to pass along some test flags like go test -cpu 1 -parallel 0 ./src/api/... with no success.Could the problem here be tests running in parallel, and if yes, how can I force serial execution?Update:Currently I use this workaround to run the tests, but I still wonder if there's a better solution <code>  find <dir> -type d -exec go test {} \;",Serial execution of package tests
Golang - How to ignore fields with sscanf (%* is rejected)," I wish to ignore a particular field whilst processing a string with sscanf.Man page for sscanf saysAn optional '*' assignment-suppression character: scanf() reads input as directed by the conversion specification, but discards the input. No corresponding pointer argument is required, and this specification is not included in the count of successful assignments returned by scanf().Attempting to use this in Golang, to ignore the 3rd field: compiles OK, but at runtime err is set to:bad verb %* for integerGolang doco doesn't specifically mention the %* conversion specification, but it does say,Package fmt implements formatted I/O with functions analogous to C's printf and scanf.It doesn't indicate that %* is not implemented, so... Am I doing it wrong? Or has it just been quietly omitted? ...but then, why does it compile? <code>  if c, err := fmt.Sscanf(str, "" %s %d %*d %d "", &iface.Name, &iface.BTx, &iface.BytesRx); err != nil || c != 3 {",How to ignore fields with sscanf (%* is rejected)
How to calculate sha1 file checksum in Go," I need utility for Windows that calculates sha256 file checksum so that when I downloadfedora I can verify checksum from here: https://fedoraproject.org/static/checksums/Fedora-18-i386-CHECKSUMMicrosoft utility from http://support.microsoft.com/kb/889768 does only md5 and sha1.I don't want to use other downloadable tools that are not signed and not available from https or from sources that I don't know about, because it does not make any sense to download unsigned code over unencrypted connection or from untrusted source to verify signature of another code to trust it.Luckily google provides possibility to use https for all downloads so I can download Go over secure connection and start from there.Here is simple code that does that for a small file, but it's not very good for big files because it's not streaming. How to make it to use streams so that it works on any file size. <code>  package mainimport ( ""io/ioutil"" ""crypto/sha256"" ""os"" ""log"" ""encoding/hex"")func main() { hasher := sha256.New() s, err := ioutil.ReadFile(os.Args[1]) hasher.Write(s) if err != nil { log.Fatal(err) } os.Stdout.WriteString(hex.EncodeToString(hasher.Sum(nil)))}",How to calculate sha256 file checksum in Go
"what is the ""less than followed by dash"" operator in go language?", What is the <- operator in go language? Have seen this in many code snippets related to Go but what is the meaning of it? <code> ,"What is the ""less than followed by dash"" (<-) operator in Golang?"
golang: invalid operation: s[k] (index of type *S)," I want to define a type like this: and I want add a method to the type like this: when the program runs, there was a error like this: So, how do I define the type and add the method to the type? <code>  type S map[string]interface{} func (s *S) Get( k string) (interface {}){ return s[k]} invalid operation: s[k] (index of type *S)",invalid operation: s[k] (index of type *S)
Change values while iterating in golang," Let's suppose I have these types: and that I want to iterate on my node's attributes to change them.I would have loved to be able to do: but as attr isn't a pointer, this wouldn't work and I have to do: Is there a simpler or faster way? Is it possible to directly get pointers from range?Obviously I don't want to change the structures just for the iteration and more verbose solutions are no solutions. <code>  type Attribute struct { Key, Val string}type Node struct { Attr []Attribute} for _, attr := range n.Attr { if attr.Key == ""href"" { attr.Val = ""something"" }} for i, attr := range n.Attr { if attr.Key == ""href"" { n.Attr[i].Val = ""something"" }}",Change values while iterating
Change values while iterating in Golang," Let's suppose I have these types: and that I want to iterate on my node's attributes to change them.I would have loved to be able to do: but as attr isn't a pointer, this wouldn't work and I have to do: Is there a simpler or faster way? Is it possible to directly get pointers from range?Obviously I don't want to change the structures just for the iteration and more verbose solutions are no solutions. <code>  type Attribute struct { Key, Val string}type Node struct { Attr []Attribute} for _, attr := range n.Attr { if attr.Key == ""href"" { attr.Val = ""something"" }} for i, attr := range n.Attr { if attr.Key == ""href"" { n.Attr[i].Val = ""something"" }}",Change values while iterating
MarhsalJSON on array of structs with non standard field in Go," I have the following types: I'm trying to marshal the JSON of this using json.Marshal(sample_ipfilepairs) but because IP isn't a string, it changes it into something strange.What is the proper way to make the JSON of this output IP as a string? <code>  type IPFilePair struct { IP net.IP FileName string}type IPFilePairs []*IPFilePair",MarshalJSON on array of structs with non standard field in Go
Defer execution with closure parameter returns strange result," Here is my code (run): Output:012344321044444Question: What's the difference between part 2 & part 3? Why part 2 output ""44444"" instead of ""43210""? <code>  package mainimport ""fmt""func main() { var whatever [5]struct{} for i := range whatever { fmt.Println(i) } // part 1 for i := range whatever { defer func() { fmt.Println(i) }() } // part 2 for i := range whatever { defer func(n int) { fmt.Println(n) }(i) } // part 3}","How golang's ""defer"" capture closure's parameter?"
"How golang ""defer"" capture closure's parameter?"," Here is my code (run): Output:012344321044444Question: What's the difference between part 2 & part 3? Why part 2 output ""44444"" instead of ""43210""? <code>  package mainimport ""fmt""func main() { var whatever [5]struct{} for i := range whatever { fmt.Println(i) } // part 1 for i := range whatever { defer func() { fmt.Println(i) }() } // part 2 for i := range whatever { defer func(n int) { fmt.Println(n) }(i) } // part 3}","How golang's ""defer"" capture closure's parameter?"
How to reopen a closed channel or make channel read unblockable in golang?," In my case, I have thousands of goroutines working simultaneously as work(). I also had a sync() goroutine. When sync starts, I need any other goroutine to pause for a while after sync job is done. Here is my code: Now the problem is, since <- is always blocking on read, every time goes to sync_stat := <- channel is blocking. I know if the channel was closed it won't be blocked, but since I have to use this channel until work() exits, and I didn't find any way to reopen a closed channel.I suspect myself on a wrong way, so any help is appreciated. Is there some ""elegant"" way to pause and resume any other goroutine? <code>  var channels []chan intvar channels_mutex sync.Mutexfunc work() { channel := make(chan int, 1) channels_mutex.Lock() channels = append(channels, channel) channels_mutex.Unlock() for { for { sync_stat := <- channel // blocked here if sync_stat == 0 { // if sync complete break } } // Do some jobs if (some condition) { return } }}func sync() { channels_mutex.Lock() // do some sync for int i := 0; i != len(channels); i++ { channels[i] <- 0 } channels_mutex.Unlock()}",Is there some elegant way to pause and resume any other goroutine?
Is there some elegant way to pause & resume any other goroutine in golang?," In my case, I have thousands of goroutines working simultaneously as work(). I also had a sync() goroutine. When sync starts, I need any other goroutine to pause for a while after sync job is done. Here is my code: Now the problem is, since <- is always blocking on read, every time goes to sync_stat := <- channel is blocking. I know if the channel was closed it won't be blocked, but since I have to use this channel until work() exits, and I didn't find any way to reopen a closed channel.I suspect myself on a wrong way, so any help is appreciated. Is there some ""elegant"" way to pause and resume any other goroutine? <code>  var channels []chan intvar channels_mutex sync.Mutexfunc work() { channel := make(chan int, 1) channels_mutex.Lock() channels = append(channels, channel) channels_mutex.Unlock() for { for { sync_stat := <- channel // blocked here if sync_stat == 0 { // if sync complete break } } // Do some jobs if (some condition) { return } }}func sync() { channels_mutex.Lock() // do some sync for int i := 0; i != len(channels); i++ { channels[i] <- 0 } channels_mutex.Unlock()}",Is there some elegant way to pause and resume any other goroutine?
GO lang - constant truncated to integer," The following GO program gives the error: Program: Why cant I use an int in a type of float64 ? <code>  ./fft.go:13: constant -6.28319 truncated to integer./fft.go:13: cannot use -7 * k / N (type int) as type float64 in assignment package mainimport ( ""math"" ""fmt"")func main() { fmt.Println(""Hello world "",math.E) var k, N int = 1, 10 var ans float64 = 0 var c float64 = (-2.0 * math.Pi * k) / N x := make([]float64,N) for i := 0; i < len(x); i++ { x[i] = 1 } ans = 0 for i := 0; i < N; i++ { ans += x[i] * math.E } fmt.Println(ans)}",Constant truncated to integer
How to test only one benchmark method in golang?," In my Go package there are several benchmark files like map1_benchmark_test.go and map2_benchmark_test.go. In every *_benchmark_test.go file, there is more than one benchmark function like func BenchmarkMapTravel(b *testing.B) and func BenchmarkMapGet(b *testing.B).Question is, how can I test just one benchmark function?I attempted to read some manuals, and got nothing about benchmark by running go help test. <code> ",How to test only one benchmark function?
Concatenate two arrays/slices in Go," I'm trying to combine the slice [1, 2] and the slice [3, 4]. How can I do this in Go?I tried: but got: However, the documentation seems to indicate this is possible, what am I missing? <code>  append([]int{1,2}, []int{3,4}) cannot use []int literal (type []int) as type int in append slice = append(slice, anotherSlice...)",Concatenate two slices in Go
Concatenate two slices," I'm trying to combine the slice [1, 2] and the slice [3, 4]. How can I do this in Go?I tried: but got: However, the documentation seems to indicate this is possible, what am I missing? <code>  append([]int{1,2}, []int{3,4}) cannot use []int literal (type []int) as type int in append slice = append(slice, anotherSlice...)",Concatenate two slices in Go
How to Pipe http response to a file in Golang?," How do I convert the below code to use streams/pipes so that I don't need to read the full content into memory?Something like:http.Get(""http://example.com/"").Pipe(""./data.txt"") <code>  package mainimport (""net/http"";""io/ioutil"")func main() { resp, err := http.Get(""http://example.com/"") check(err) defer resp.Body.Close() body, err := ioutil.ReadAll(resp.Body) check(err) err = ioutil.WriteFile(""./data.txt"", body, 0666) check(err)}func check(e error) { if e != nil { panic(e) }}",How to pipe an HTTP response to a file in Go?
"In Go, how can I get the string representation of a struct?"," For my application, it does not matter if the string is human readable or not. <code> ",How can I get the string representation of a struct?
How to `go test` all testings in my project?," The go test command covers *_test.go files in only one dir.I want to go test the whole project, which means the test should cover all *_test.go files in the dir ./ and every children tree dir under the dir ./.What's the command to do this? <code> ",How to `go test` all tests in my project?
Is there a way to do repetitive tasks at intervals in golang?," Is there a way to do repetitive background tasks in Go? I'm thinking of something like Timer.schedule(task, delay, period) in Java. I know I can do this with a goroutine and Time.sleep(), but I'd like something that easily stopped.Here's what I got, but looks ugly to me. Is there a cleaner/better way? <code>  func oneWay() { var f func() var t *time.Timer f = func () { fmt.Println(""doing stuff"") t = time.AfterFunc(time.Duration(5) * time.Second, f) } t = time.AfterFunc(time.Duration(5) * time.Second, f) defer t.Stop() //simulate doing stuff time.Sleep(time.Minute)}",Is there a way to do repetitive tasks at intervals?
Is there a way to do repetitive tasks at intervals in Golang?," Is there a way to do repetitive background tasks in Go? I'm thinking of something like Timer.schedule(task, delay, period) in Java. I know I can do this with a goroutine and Time.sleep(), but I'd like something that easily stopped.Here's what I got, but looks ugly to me. Is there a cleaner/better way? <code>  func oneWay() { var f func() var t *time.Timer f = func () { fmt.Println(""doing stuff"") t = time.AfterFunc(time.Duration(5) * time.Second, f) } t = time.AfterFunc(time.Duration(5) * time.Second, f) defer t.Stop() //simulate doing stuff time.Sleep(time.Minute)}",Is there a way to do repetitive tasks at intervals?
How can I print out an int64 in Go using fmt?," I tried: fmt.Printf(""%d"", math.MaxUint64)but I got the following error message: constant 18446744073709551615 overflows intHow can I fix this? Thanks! <code> ",How can I print out an constant uint64 in Go using fmt?
Why 'Total MB' in golang heap profile is less than 'RES' in top ?," I have a service written in go that takes 6-7G memory at runtime (RES in top). So I used the pprof tool trying to figure out where the problem is. But there are only about 1-2G memory in result ('Total MB' in pdf). Where's the rest ?And I've tried profile my service with GOGC=off, as a result the 'Total MB' is exactly the same as 'RES' in top. It seems that memory is GCed but haven't been return to kernel won't be profiled.Any idea?P.S, I've tested in both 1.0.3 and 1.1rc3. <code>  go tool pprof --pdf http://<service>/debug/pprof/heap > heap_prof.pdf",Why 'Total MB' in golang heap profile is less than 'RES' in top?
Why is this struct not working?," I'm trying to understand why the following test code is not working as expected: This would print: Meaning that someStrings is apparently modified... and then it's not.Anybody know what could be the issue? <code>  package mainimport ( ""fmt"" ""strings"")type Test struct { someStrings []string}func (this Test) AddString(s string) { this.someStrings = append(this.someStrings, s) this.Count() // will print ""1""}func (this Test) Count() { fmt.Println(len(this.someStrings))}func main() { var test Test test.AddString(""testing"") test.Count() // will print ""0""} ""1""""0""",Why don't changes made to a struct via a method persist?
How to split string and assign?," In Python it is possible to split a string and assign it to variables: but in Go it does not seem to work: Question: How to split a string and assign values in one step? <code>  ip, port = '127.0.0.1:5432'.split(':') ip, port := strings.Split(""127.0.0.1:5432"", "":"")// assignment count mismatch: 2 = 1",How to split a string and assign it to variables
How to split a string and assign it to variables in Golang?," In Python it is possible to split a string and assign it to variables: but in Go it does not seem to work: Question: How to split a string and assign values in one step? <code>  ip, port = '127.0.0.1:5432'.split(':') ip, port := strings.Split(""127.0.0.1:5432"", "":"")// assignment count mismatch: 2 = 1",How to split a string and assign it to variables
Go - bypassing access privileges using pointers," Let's say I have the following hierarchy for my project: And in the fragment.go I have the following code, with one getter and no setter: And in the main.go I create a Fragment and try to change Fragment.number without a setter: So by using the pointer, I changed the private variable outside of the fragment package. I understand that in for example C, pointers help to avoid copying large struct/arrays and they are supposed to enable you to change whatever they're pointing to. But I don't quite understand how they are supposed to work with private variables.So my questions are:Shouldn't the private variables stay private, no matter how they are accessed? How is this compared to other languages such as C++/Java? Is it the case there too, that private variables can be changed using pointers outside of the class?My Background: I know a bit C/C++, rather fluent in Python and new to Go. I learn programming as a hobby so don't know much about technical things happening behind the scenes. <code>  fragment/fragment.gomain.go package fragmenttype Fragment struct { number int64 // private variable - lower case}func (f *Fragment) GetNumber() *int64 { return &f.number} package mainimport ( ""fmt"" ""myproject/fragment"")func main() { f := new(fragment.Fragment) fmt.Println(*f.GetNumber()) // prints 0 //f.number = 8 // error - number is private p := f.GetNumber() *p = 4 // works. Now f.number is 4 fmt.Println(*f.GetNumber()) // prints 4}",Go Programming - bypassing access privileges using pointers
go-lang webserver : return image," I want to write a simple webserver in go that does the following: when i go to http://example.go:8080/image, it returns a static image.I'm following an example i found here. In this example they implement this method: and then refer to it here : Now, what i wanna do is serve an image instead of writing to the string.How would i go about that? <code>  func handler(w http.ResponseWriter, r *http.Request) { fmt.Fprintf(w, ""Hi there, I love %s!"", r.URL.Path[1:])} ......http.HandleFunc(""/"", handler)",go-lang simple webserver : serve static image
How to convert a rune to unicode-style-string like `\u554a` in golang?," If you run fmt.Println(""\u554a""), it shows ''.But how to get unicode-style-string \u554a from a rune '' ? <code> ",How to convert a rune to unicode-style-string like `\u554a` in Golang?
Replace one occurance with regexp, I want to replace a only one instance with a regex rather than all of them. How would I do this with Go's regexp library?input: foobar1xfoobar2xregex: bar(.)xreplacement: baz$1 ReplaceAllString output: foobaz1foobaz2ReplaceOneString output: foobaz1foobar2x <code> ,Replace one occurrence with regexp
"How to load a Golang template when ""{"" or ""}"" are in the static part of the template?"," My Problem is that, I want to build a letter generator, which first builds a latex-file from user input, and then compiles this via latex to PDF.The template contains multiple lines like this: The latex part is \setkomavar{signature}{}, and the template part from go is {{.Name}}.When I try to load the template, it throws this error:panic: template: letter.tmpl:72: unexpected ""}"" in commandIs there a trick to help the parser handling such a situation?Thanks in advance,Tino <code>  \setkomavar{signature}{{{.Name}}}","How to execute a Golang template when ""{"" or ""}"" are in the static part of the template?"
Access out of loop value inside golang template," I have this struct : I pass an instance of Site to a template.If I want to write a list of all pages, I do Now, what's the simplest way to use the Name field inside the loop (for example to change the href to Name/page) ?Note that a solution based on the fact that the external object is the global one that was passed to the template would be OK. <code>  type Site struct { Name string Pages []int} {{range .Pages}} <li><a href=""{{.}}"">{{.}}</a></li>{{end}}",Access out of loop value inside golang template's loop
golang: Best way to implement global counters for highly concurrent applications?," What is the best way to implement global counters for a highly concurrent application? In my case I may have 10K-20K go routines performing ""work"", and I want to count the number and types of items that the routines are working on collectively...The ""classic"" synchronous coding style would look like: Now this gets more complicated because I want to track the ""type"" of work being done, so really I'd need something like this: It seems like there should be a ""go"" optimized way using channels or something similar to this: This last example is still missing the map, but that's easy enough to add. Will this style provide better performance than just a simple atomic increment? I can't tell if this is more or less complicated when we're talking about concurrent access to a global value versus something that may block on I/O to complete...Thoughts are appreciated.Update 5/28/2013:I tested a couple implementations, and the results were not what I expected, here's my counter source code: It uses channels for both writes and reads which seems logical.Here are my test cases: I implemented a simple benchmark with just a mutex around the map (just testing writes), and benchmarked both with 5 goroutines running in parallel. Here are the results: I would not have expected the mutex to be that much faster...Further thoughts? <code>  var work_counter intfunc GoWorkerRoutine() { for { // do work atomic.AddInt32(&work_counter,1) } } var work_counter map[string]intvar work_mux sync.Mutexfunc GoWorkerRoutine() { for { // do work work_mux.Lock() work_counter[""type1""]++ work_mux.Unlock() } } var work_counter intvar work_chan chan int // make() called somewhere else (buffered)// started somewher elsefunc GoCounterRoutine() { for { select { case c := <- work_chan: work_counter += c break } }}func GoWorkerRoutine() { for { // do work work_chan <- 1 } } package helpersimport ()type CounterIncrementStruct struct { bucket string value int}type CounterQueryStruct struct { bucket string channel chan int}var counter map[string]intvar counterIncrementChan chan CounterIncrementStructvar counterQueryChan chan CounterQueryStructvar counterListChan chan chan map[string]intfunc CounterInitialize() { counter = make(map[string]int) counterIncrementChan = make(chan CounterIncrementStruct,0) counterQueryChan = make(chan CounterQueryStruct,100) counterListChan = make(chan chan map[string]int,100) go goCounterWriter()}func goCounterWriter() { for { select { case ci := <- counterIncrementChan: if len(ci.bucket)==0 { return } counter[ci.bucket]+=ci.value break case cq := <- counterQueryChan: val,found:=counter[cq.bucket] if found { cq.channel <- val } else { cq.channel <- -1 } break case cl := <- counterListChan: nm := make(map[string]int) for k, v := range counter { nm[k] = v } cl <- nm break } }}func CounterIncrement(bucket string, counter int) { if len(bucket)==0 || counter==0 { return } counterIncrementChan <- CounterIncrementStruct{bucket,counter}}func CounterQuery(bucket string) int { if len(bucket)==0 { return -1 } reply := make(chan int) counterQueryChan <- CounterQueryStruct{bucket,reply} return <- reply}func CounterList() map[string]int { reply := make(chan map[string]int) counterListChan <- reply return <- reply} func bcRoutine(b *testing.B,e chan bool) { for i := 0; i < b.N; i++ { CounterIncrement(""abc123"",5) CounterIncrement(""def456"",5) CounterIncrement(""ghi789"",5) CounterIncrement(""abc123"",5) CounterIncrement(""def456"",5) CounterIncrement(""ghi789"",5) } e<-true}func BenchmarkChannels(b *testing.B) { b.StopTimer() CounterInitialize() e:=make(chan bool) b.StartTimer() go bcRoutine(b,e) go bcRoutine(b,e) go bcRoutine(b,e) go bcRoutine(b,e) go bcRoutine(b,e) <-e <-e <-e <-e <-e}var mux sync.Mutexvar m map[string]intfunc bmIncrement(bucket string, value int) { mux.Lock() m[bucket]+=value mux.Unlock()}func bmRoutine(b *testing.B,e chan bool) { for i := 0; i < b.N; i++ { bmIncrement(""abc123"",5) bmIncrement(""def456"",5) bmIncrement(""ghi789"",5) bmIncrement(""abc123"",5) bmIncrement(""def456"",5) bmIncrement(""ghi789"",5) } e<-true}func BenchmarkMutex(b *testing.B) { b.StopTimer() m=make(map[string]int) e:=make(chan bool) b.StartTimer() for i := 0; i < b.N; i++ { bmIncrement(""abc123"",5) bmIncrement(""def456"",5) bmIncrement(""ghi789"",5) bmIncrement(""abc123"",5) bmIncrement(""def456"",5) bmIncrement(""ghi789"",5) } go bmRoutine(b,e) go bmRoutine(b,e) go bmRoutine(b,e) go bmRoutine(b,e) go bmRoutine(b,e) <-e <-e <-e <-e <-e} $ go test --bench=. helpersPASSBenchmarkChannels 100000 15560 ns/opBenchmarkMutex 1000000 2669 ns/opok helpers 4.452s",Best way to implement global counters for highly concurrent applications?
How to Unmarsal escaped json string on go?," I am using Sockjs with Go, but when the JavaScript client send json to the server it escapes it, and send's it as a []byte. I'm trying to figure out how to parse the json, so that i can read the data. but I get this error.json: cannot unmarshal string into Go value of type main.MsgHow can I fix this? html.UnescapeString() has no effect.  <code>  val, err := session.ReadMessage()if err != nil {break}var msg Msgerr = json.Unmarshal(val, &msg)fmt.Printf(""%v"", val)fmt.Printf(""%v"", err)type Msg struct { Channel string Name string Msg string} //Output""{\""channel\"":\""buu\"",\""name\"":\""john\"", \""msg\"":\""doe\""}""json: cannot unmarshal string into Go value of type main.Msg",How to unmarshal an escaped JSON string
How to unmarshal an escaped JSON string in Go?," I am using Sockjs with Go, but when the JavaScript client send json to the server it escapes it, and send's it as a []byte. I'm trying to figure out how to parse the json, so that i can read the data. but I get this error.json: cannot unmarshal string into Go value of type main.MsgHow can I fix this? html.UnescapeString() has no effect.  <code>  val, err := session.ReadMessage()if err != nil {break}var msg Msgerr = json.Unmarshal(val, &msg)fmt.Printf(""%v"", val)fmt.Printf(""%v"", err)type Msg struct { Channel string Name string Msg string} //Output""{\""channel\"":\""buu\"",\""name\"":\""john\"", \""msg\"":\""doe\""}""json: cannot unmarshal string into Go value of type main.Msg",How to unmarshal an escaped JSON string
How to set timeout for http.Get() requests in golang?," I'm making a URL fetcher in Go and have a list of URLs to fetch. I send http.Get() requests to each URL and obtain their response. How can I set a custom timeout for each Get request? (The default time is very long and that makes my fetcher really slow.) I want my fetcher to have a timeout of around 40-45 seconds after which it should return ""request timed out"" and move on to the next URL.How can I achieve this? <code>  resp,fetch_err := http.Get(url)",How to set timeout for http.Get() requests in Golang?
How to preallocate slice of pointers in a go-idiomatic way?," http://play.golang.org/p/j-Y0mQzTdP Outputs: [<nil> <nil> <nil> <nil> <nil> 0xc010035160 0xc010035170 0xc010035180 0xc010035190 0xc0100351a0]What i would like to do, is preallocate memory for 5 UselessStructs, stored as pointers. If i declare a slice of struct values eq: then this creates 5 empty structs - appending doesn't replace the empty structs, but rather keeps on adding to the slice, so the end result with this code:http://play.golang.org/p/zBYqGVO85h is: [{0 0} {0 0} {0 0} {0 0} {0 0} {0 0} {0 0} {0 0} {0 0} {0 0}]What is the the go-idiomatic way to preallocate and fill slices? <code>  package mainimport ""fmt""type UselessStruct struct { a int b int}func main() { mySlice := make([]*UselessStruct, 5) for i := 0; i != 5; i++ { mySlice = append(mySlice, &UselessStruct{}) } fmt.Println(mySlice)} mySlice := make([]UselessStruct, 5) package mainimport ""fmt""type UselessStruct struct { a int b int}func main() { mySlice := make([]UselessStruct, 5) for i := 0; i != 5; i++ { mySlice = append(mySlice, UselessStruct{}) } fmt.Println(mySlice)}",How to preallocate and fill a slice of pointers in a go-idiomatic way?
Golang Error Handling Techniques, I'm just getting started with Go. My code is starting to have a lot of this: or this Are there some good idioms/strategies/best-practices for checking and handling errors in Go?EDIT to clarify: I'm not bellyaching or suggesting that the Go team come up with something better. I'm asking if I'm doing it right or have I missed some technique that the community came up with. Thanks all. <code>  if err != nil { //handle err } if err := rows.Scan(&some_column); err != nil { //handle err },Go Error Handling Techniques
"In Go, why isn't my Stringer interface method getting invoked? When using fmt.Println"," Suppose I have the following code: When I call fmt.Println(myCar) and the object in question is a pointer, my String() method gets called properly. If, however the object is a value, my output is formatted using the default formatting built into Go and my code to format the said object is not called.The interesting thing is in either case if I call myCar.String() manually it works properly whether my object is either a pointer or value.How can I get my object formatted the way I want no matter if the object is value-based or pointer-based when used with Println? I don't want to use a value method for String because then that means every time it's invoked the object is copied which seams unreasonable. And I don't want to have to always manually called .String() either because I'm trying to let the duck-typing system do it's work. <code>  package mainimport ""fmt""type Car struct{ year int make string}func (c *Car)String() string{ return fmt.Sprintf(""{make:%s, year:%d}"", c.make, c.year)}func main() { myCar := Car{year:1996, make:""Toyota""} fmt.Println(myCar)}",Why isn't my Stringer interface method getting invoked? When using fmt.Println
Switch or if/elseif/else inside golang templates," I have this struct : I want to display my paragraphs in a Type dependent way.The only solution I found was based on dedicated functions like isAttachment testing the Type in Go and nested {{if}} : In fact I have more types, which makes it even weirder, cluttering both the Go code with IsSomething functions and the template with those {{end}}.What's the clean solution ? Is there some switch or if/elseif/else solution in go templates ? Or a completely different way to handle these cases ? <code>  const ( paragraph_hypothesis = 1<<iota paragraph_attachment = 1<<iota paragraph_menu = 1<<iota)type Paragraph struct { Type int // paragraph_hypothesis or paragraph_attachment or paragraph_menu} {{range .Paragraphs}} {{if .IsAttachment}} -- attachement presentation code -- {{else}}{{if .IsMenu}} -- menu -- {{else}} -- default code -- {{end}}{{end}}{{end}}",Switch or if/elseif/else inside golang HTML templates
How to get file length in golang?," I looked up golang.org/pkg/os/#File , but still have no idea.Seems there is no way to get file length, did I miss something?How to get file length in Go? <code> ",How to get file length in Go?
how to get json response in golang," I'm trying read JSON data from web, but that code returns empty result. I'm not sure what I'm doing wrong here. <code>  package mainimport ""os""import ""fmt""import ""net/http""import ""io/ioutil""import ""encoding/json""type Tracks struct { Toptracks []Toptracks_info}type Toptracks_info struct { Track []Track_info Attr []Attr_info}type Track_info struct { Name string Duration string Listeners string Mbid string Url string Streamable []Streamable_info Artist []Artist_info Attr []Track_attr_info}type Attr_info struct { Country string Page string PerPage string TotalPages string Total string}type Streamable_info struct { Text string Fulltrack string}type Artist_info struct { Name string Mbid string Url string}type Track_attr_info struct { Rank string}func get_content() { // json data url := ""http://ws.audioscrobbler.com/2.0/?method=geo.gettoptracks&api_key=c1572082105bd40d247836b5c1819623&format=json&country=Netherlands"" res, err := http.Get(url) if err != nil { panic(err.Error()) } body, err := ioutil.ReadAll(res.Body) if err != nil { panic(err.Error()) } var data Tracks json.Unmarshal(body, &data) fmt.Printf(""Results: %v\n"", data) os.Exit(0)}func main() { get_content()}",How to get JSON response from http.Get
How to get JSON response in Golang," I'm trying read JSON data from web, but that code returns empty result. I'm not sure what I'm doing wrong here. <code>  package mainimport ""os""import ""fmt""import ""net/http""import ""io/ioutil""import ""encoding/json""type Tracks struct { Toptracks []Toptracks_info}type Toptracks_info struct { Track []Track_info Attr []Attr_info}type Track_info struct { Name string Duration string Listeners string Mbid string Url string Streamable []Streamable_info Artist []Artist_info Attr []Track_attr_info}type Attr_info struct { Country string Page string PerPage string TotalPages string Total string}type Streamable_info struct { Text string Fulltrack string}type Artist_info struct { Name string Mbid string Url string}type Track_attr_info struct { Rank string}func get_content() { // json data url := ""http://ws.audioscrobbler.com/2.0/?method=geo.gettoptracks&api_key=c1572082105bd40d247836b5c1819623&format=json&country=Netherlands"" res, err := http.Get(url) if err != nil { panic(err.Error()) } body, err := ioutil.ReadAll(res.Body) if err != nil { panic(err.Error()) } var data Tracks json.Unmarshal(body, &data) fmt.Printf(""Results: %v\n"", data) os.Exit(0)}func main() { get_content()}",How to get JSON response from http.Get
"How do I convert a database row into a struct, in Go?", Let's say I have a struct: And a database table with the same schema. What's the easiest way to parse a database row into a struct? I've added an answer below but I'm not sure it's the best one. <code>  type User struct { Name string Id int Score int},How do I convert a database row into a struct
easiest way to download a file? golang," I can do something like below, which gives me a response class, but I'm not exactly sure how to write the io.reader to a file. What is the most straightforward way? <code>  http.Get(""https://www.domain.com/some.jpg"")",Easiest way to download a file?
Golang Removing fields from struct or hiding them in JSON Response," I've created an API in Go that, upon being called, performs a query, creates an instance of a struct, and then encodes that struct as JSON before sending back to the caller. I'd now like to allow the caller to be able to select the specific fields they would like returned by passing in a ""fields"" GET parameter.This means depending on the fields value(s), my struct would change. Is there any way to remove fields from a struct? Or at least hide them in the JSON response dynamically? (Note: Sometimes I have empty values so the JSON omitEmpty tag will not work here) If neither of these are possible, is there a suggestion on a better way to handle this?A smaller version of the structs I'm using are below: I then encode and output the response like so: <code>  type SearchResult struct { Date string `json:""date""` IdCompany int `json:""idCompany""` Company string `json:""company""` IdIndustry interface{} `json:""idIndustry""` Industry string `json:""industry""` IdContinent interface{} `json:""idContinent""` Continent string `json:""continent""` IdCountry interface{} `json:""idCountry""` Country string `json:""country""` IdState interface{} `json:""idState""` State string `json:""state""` IdCity interface{} `json:""idCity""` City string `json:""city""`} //SearchResulttype SearchResults struct { NumberResults int `json:""numberResults""` Results []SearchResult `json:""results""`} //type SearchResults err := json.NewEncoder(c.ResponseWriter).Encode(&msg)",Removing fields from struct or hiding them in JSON Response
Big O of append in golang," What is the complexity of Go's builtin append function? What about string concatenation using +?I'd like to remove an element from a slice by appending two slices excluding that element, ex. http://play.golang.org/p/RIR5fXq-Sf http://golang.org/pkg/builtin/#append says that if the destination has sufficient capacity, then that slice is resliced. I'm hoping that ""reslicing"" is a constant time operation. I'm also hoping the same applies to string concatenation using +. <code>  nums := []int{0, 1, 2, 3, 4, 5, 6, 7}fmt.Println(append(nums[:4], nums[5:]...))=> [0 1 2 3 5 6 7]",Big O of append in Golang
Access Struct in Map (without copying)," Assuming the following Why isn't it possible to access the struct instance now stored in the map? Can anyone shed some light into how to access the map-stored struct, or the logic behind why it's not possible?NotesI know that you can achieve this by making a copy of the struct, changing the copy, and copying back into the map -- but that's a costly copy operation.I also know this can be done by storing struct pointers in my map, but I don't want to do that either. <code>  type User struct { name string}users := make(map[int]User)users[5] = User{""Steve""} users[5].name = ""Mark""",Accessing struct fields inside a map value (without copying)
How to get the key value from a json string in GoLang," I would like to try get the key values from JSON in Go, however I'm unsure how to.I've been able to use simplejson to read json values, however I've not been able to find out how to get the key values.Would anyone be able to point me in the right direction and/or help me?Thank you! <code> ",How to get the key value from a json string in Go
How to install golang version 1.1 in ubuntu," Running sudo apt-get install golang-stable, I get Go version go1.0.3. Is there any way to install go1.1.1? <code> ",How to install the current version of Go in Ubuntu Precise
How to install the current version of Go in Ubuntu," Running sudo apt-get install golang-stable, I get Go version go1.0.3. Is there any way to install go1.1.1? <code> ",How to install the current version of Go in Ubuntu Precise
Golang : Error when i try do install," I have the error: I'm using go version 1.1 on OS X.I can build & run but can't install packages.My environment: Project tree: I can build without error: Here is a simple example: <code>  go install: no install location for directory /Users/xwilly/Dropbox/go/project/src outside GOPATH GOPATH=/Users/xwilly/Dropbox/go/projectPATH=/Library/Frameworks/Python.framework/Versions/2.7/bin:/usr/bin:/bin:/usr/sbin:/sbin:/usr/local/bin:/usr/local/go/bin:/Users/xwilly/Dropbox/go/project/bin /Users/xwilly/Dropbox/go/projectbinpkgsrc ..:src xwilly$ go build test.go ..:src xwilly$ go install test.gogo install: no install location for directory /Users/xwilly/Dropbox/go/project/src outside GOPATH xwilly$ cat test.go package mainimport ( ""fmt"")func main() { fmt.Println(""Bonjour"")}xwilly$ go run test.go Bonjourxwilly$ go install test.go go install: no install location for directory /Users/xwilly/Dropbox/go/project/src/learning outside GOPATH",Golang: Installation directory error?
Golang how to import local packages without gopath?," I've used GOPATH but for this current issue I'm facing it does not help. I want to be able to create packages that are specific to a project: I tried multiple ways but how do I get package1.go to work in the binary1.go or the binary2.go and so on?For example; I want to be able to import ""package1"" and then be able to run go build binary1.go and everything works fine without the error being thrown that the package cannot be found on GOROOT or GOPATH. The reason why I need this kind of functionality is for large scale projects; I do not want to have to reference multiple other packages or keep them in one large file. <code>  myproject/ binary1.go binary2.go package1.go package2.go",How to import local packages without gopath
Expand tilde to home directory in Go," I have a program that accepts a destination folder where files will be created. My program should be able to handle absolute paths as well as relative paths. My problem is that I don't know how to expand ~ to the home directory.My function to expand the destination looks like this. If the path given is absolute it does nothing otherwise it joins the relative path with the current working directory. Since path.Join doesn't expand ~ it doesn't work if the user passes something like ~/Downloads as the destination.How should I solve this in a cross platform way? <code>  import ""path""import ""os""// var destination *String is the user inputfunc expandPath() { if path.IsAbs(*destination) { return } cwd, err := os.Getwd() checkError(err) *destination = path.Join(cwd, *destination)}",Expand tilde to home directory
Go Template: How do I escape {{?," Im using AngularJS as the front-end JS library, with Go templates within Revel framework to to generate the markup on the back-end.But both Go and Angular use {{ and }} for delimiters in their templates. How can I escape them in Go to pass them to AngularJS? <code> ",How do I escape {{ and }} delimiters in Go templates?
How to iterate over keys and values of a Map in a go html template?, I have a template in go using the http/template package. How do I iterate over both the keys and values in the template?Example code : How do I access the key in {{range}} in the template <code>  template := `<html>,How to iterate over keys and values of a map in a Go html template
Go web page static file serving," I'm following a tutorial on building a webpage in go. Everything in the tutorial is easy to grasp, but I'm trying to expand on it. Specifically, I'm trying to add some static files (pictures). I've been going through the go docs and came across FileServer and adding in my handler I see an image being served but it's not using the template *I've tried giving the full path to the images too.What I'm trying to do is get the image to occupy the html tags that I've placed so carefully in the template.I want the image to appear where I tell them to, but get blank images where they should be. I'm not seeing any errors saying the file can't be found.The way I think this should work (again no experience in this) is by telling the server I have this directory that houses some static files and whenever a template requests an image check here and if found serve it. Doesn't appear to be this simple. What am I doing wrong? How can I get this to work?I'm using http.ListenAndServe("":8080"", nil) in my main in other words I'm not using apache or some other web-server <code>  http.ServeFile(w, r, ""/home/jeff/web/foo.jpg"") <h1>{{.Title}}</h1><p>[<a href=""/edit/{{.Title}}"">edit</a>]</p><img src=""foo.jpg"" alt=""moooooo""><img src=""foo.jpg"" alt=""foooooo""><div>{{printf ""%s"" .Body}}</div>",How to serve static files over http
"I use IntelliJ IDEA as golang IDE, and system environment have already set GOPATHBut IDEA can't load it."," I use IntelliJ IDEA as golang IDE in Windows , and system environment have already set GOPATHbut IDEA can't load $GOPATH. I use go get github.com/astaxie/beego, this package is installed correctly, but in IDEA can't import this library.I have added this package in project's structure in this way:and this project's choice Go sdk go1.1.1 windows/amd64 likehow can I set GOPATH in idea? <code> ","I use IntelliJ IDEA as golang IDE, and system environment have already set GOPATHBut IDEA can't load it"
Is it possible to print the type of a variable in Go?," I'm fairly unfamiliar with the Go programming language, and I've been trying to find a way to get the type of a variable as a string. So far, I haven't found anything that works. I've tried using typeof(variableName) to obtain a variable's type as a string, but this doesn't appear to be valid.Does Go have any built-in operator that can obtain a variable's type as a string, similar to JavaScript's typeof operator or Python's type operator? <code>  //Trying to print a variable's type as a string:package mainimport ""fmt""func main() { num := 3 fmt.Println(typeof(num)) //I expected this to print ""int"", but typeof appears to be an invalid function name.}","In the Go programming language, is it possible to obtain a variable's type as a string?"
golang - embedding text file into compiled executable," I have some text file that I read from my Go program. I'd like to ship a single executable, without supplying that text file additionally.How do I embed it into compilation on Windows and Linux? <code> ",How to embed files into Go binaries
Embedding text file into compiled executable," I have some text file that I read from my Go program. I'd like to ship a single executable, without supplying that text file additionally.How do I embed it into compilation on Windows and Linux? <code> ",How to embed files into Go binaries
How to embed files into Golang binaries?," I have some text file that I read from my Go program. I'd like to ship a single executable, without supplying that text file additionally.How do I embed it into compilation on Windows and Linux? <code> ",How to embed files into Go binaries
How to call the Scan variadic function in golang using reflection?," I'm looking to call the Rows.Scan() function using reflection. However it takes a variable number of pointers, but there are not a lot of source examples. I need to use reflection because I plan on filling a slice with the values from a Query call. So basically using rows.Columns() to get the length of the row and then make() a slice of []interface{} to fill with the data points that would normally be filled using the pointers passed to the Scan() function.Basically something like this code: Anyone have an example of calling a variadic function that takes pointers using reflection that I can take a look at?Edit:Sample code that doesn't appear to do what I'm after. The results: <code>  col := rows.Columns()vals := make([]interface{}, len(cols))rows.Scan(&vals) package mainimport ( _ ""github.com/lib/pq"" ""database/sql"" ""fmt"")func main() { db, _ := sql.Open( ""postgres"", ""user=postgres dbname=Go_Testing password=ssap sslmode=disable"") rows, _ := db.Query(""SELECT * FROM _users;"") cols, _ := rows.Columns() for rows.Next() { data := make([]interface{}, len(cols)) rows.Scan(data...) fmt.Println(data) }} [<nil> <nil> <nil> <nil> <nil>][<nil> <nil> <nil> <nil> <nil>][<nil> <nil> <nil> <nil> <nil>][<nil> <nil> <nil> <nil> <nil>][<nil> <nil> <nil> <nil> <nil>][<nil> <nil> <nil> <nil> <nil>]",How to call the Scan variadic function using reflection
How to call the Scan variadic function in Golang using reflection?," I'm looking to call the Rows.Scan() function using reflection. However it takes a variable number of pointers, but there are not a lot of source examples. I need to use reflection because I plan on filling a slice with the values from a Query call. So basically using rows.Columns() to get the length of the row and then make() a slice of []interface{} to fill with the data points that would normally be filled using the pointers passed to the Scan() function.Basically something like this code: Anyone have an example of calling a variadic function that takes pointers using reflection that I can take a look at?Edit:Sample code that doesn't appear to do what I'm after. The results: <code>  col := rows.Columns()vals := make([]interface{}, len(cols))rows.Scan(&vals) package mainimport ( _ ""github.com/lib/pq"" ""database/sql"" ""fmt"")func main() { db, _ := sql.Open( ""postgres"", ""user=postgres dbname=Go_Testing password=ssap sslmode=disable"") rows, _ := db.Query(""SELECT * FROM _users;"") cols, _ := rows.Columns() for rows.Next() { data := make([]interface{}, len(cols)) rows.Scan(data...) fmt.Println(data) }} [<nil> <nil> <nil> <nil> <nil>][<nil> <nil> <nil> <nil> <nil>][<nil> <nil> <nil> <nil> <nil>][<nil> <nil> <nil> <nil> <nil>][<nil> <nil> <nil> <nil> <nil>][<nil> <nil> <nil> <nil> <nil>]",How to call the Scan variadic function using reflection
what is the GOMAXPROCS default value," Is it guaranteed that GOMAXPROCS is set to 1 when the environment variable of the same name is not set?This code shows the value: and running it like this: shows that it is 1 in this case, but I am looking for some confirmation here. <code>  package mainimport ( ""runtime"" ""fmt"")func getGOMAXPROCS() int { return runtime.GOMAXPROCS(0)}func main() { fmt.Printf(""GOMAXPROCS is %d\n"", getGOMAXPROCS())} $ GOMAXPROCS= go run max.go GOMAXPROCS is 1",What is the GOMAXPROCS default value?
"cannot download, $GOPATH not set"," Setup:Have a look at my configuration: You can see that I've set a path for $GOPATH. In addition, I've created subdirectories that I may not need.Question:Why does the following command generate this error message? <code>  $ echo $GOPATH && ls -r $GOPATH/home/cyrus/.gosrc pkg bin$ echo $GOROOT && ls $GOROOT/usr/local/goapi AUTHORS bin CONTRIBUTORS doc favicon.ico include lib LICENSE misc PATENTS pkg README robots.txt src test VERSION $ go get code.google.com/p/go-tour/gotour package code.google.com/p/go-tour/gotour: cannot download, $GOPATH not set. For more details see: go help gopath","Error ""cannot download, $GOPATH not set."""
"Got error ""cannot download, $GOPATH not set,"" yet I have it set"," Setup:Have a look at my configuration: You can see that I've set a path for $GOPATH. In addition, I've created subdirectories that I may not need.Question:Why does the following command generate this error message? <code>  $ echo $GOPATH && ls -r $GOPATH/home/cyrus/.gosrc pkg bin$ echo $GOROOT && ls $GOROOT/usr/local/goapi AUTHORS bin CONTRIBUTORS doc favicon.ico include lib LICENSE misc PATENTS pkg README robots.txt src test VERSION $ go get code.google.com/p/go-tour/gotour package code.google.com/p/go-tour/gotour: cannot download, $GOPATH not set. For more details see: go help gopath","Error ""cannot download, $GOPATH not set."""
Golang. Missing type in composite literal," Simple question. How to initialize this struct? I would like to do something like this: Expectedly I'm getting an error: Sure, I can create a separated struct B and initialize it this way: But it not so useful than the first way. Is there a shortcut to initialize anonymous structure? <code>  type A struct { B struct { Some string Len int }} a := &A{B:{Some: ""xxx"", Len: 3}} missing type in composite literal type Btype struct { Some string Len int}type A struct { B Btype}a := &A{B:Btype{Some: ""xxx"", Len: 3}}",Missing type in composite literal
Reading from reader until a string is reached [golang]," I am trying to write a function to keep reading from a buffered reader until I hit a certain string, then to stop reading and return everything read prior to that string.In other words, I want to do the same thing as reader.ReadString() does, except taking a string instead of a single byte.For instance: How can I do this?Thanks in advance,TwichyAmendment 1: Previous attemptHere is my previous attempt; its badly written and doesnt work but hopefully it demonstrates what I am trying to do. <code>  mydata, err := reader.ReadString(""\r\n.\r\n"") //obviously will not compile func readDotData(reader *bufio.Reader)(string, error){delims := []byte{ '\r', '\n', '.', '\r', '\n'}curpos := 0var buffer []bytefor { curpos = 0 data, err := reader.ReadSlice(delims[0]) if err!=nil{ return """", err } buffer = append(buffer, data...) for { curpos++ b, err := reader.ReadByte() if err!=nil{ return """", err } if b!=delims[curpos]{ for curpos >= 0{ buffer = append(buffer, delims[curpos]) curpos-- } break } if curpos == len(delims){ return string(buffer[len(buffer)-1:]), nil } }}panic(""unreachable"")}",Reading from reader until a string is reached
Go - difference between paramter and receiver," I am following a Go tutorial and am stuck as I cant understand a particular method signature: The docs explain this as follows: This method's signature reads: ""This is a method named save that takes as its receiver p, a pointer to Page . It takes no parameters, and returns a value of type error.""I cant understand what the receiver is. I would read this as it being a parameter but then I would expect a parameter to be in save(). <code>  func (p *Page) save() error { filename := p.Title + "".txt"" return ioutil.WriteFile(filename, p.Body, 0600)}",What is the difference between parameter and receiver
Go - difference between parameter and receiver," I am following a Go tutorial and am stuck as I cant understand a particular method signature: The docs explain this as follows: This method's signature reads: ""This is a method named save that takes as its receiver p, a pointer to Page . It takes no parameters, and returns a value of type error.""I cant understand what the receiver is. I would read this as it being a parameter but then I would expect a parameter to be in save(). <code>  func (p *Page) save() error { filename := p.Title + "".txt"" return ioutil.WriteFile(filename, p.Body, 0600)}",What is the difference between parameter and receiver
How to set maximum number of connections in Go HTTP client," I have an http client which creates multiple connections to the host. I want to set a maximum number of connections it can set to a particular host. There are no such options in go's request.Transport.My code looks like I would expect this to create 1 connection. As I am calling it in a for-loop. But this keeps creating an infinite number of connections.Where as similar python code using the requests library creates only one connection. For some reason the go code is not reusing http connections. EDIT :The go code needs the body to be closed to reuse the connection.  <code>  package main import ( ""fmt"" ""net/http"" ""net/url"")const ( endpoint_url_fmt = ""https://blah.com/api1?%s"")func main() { transport := http.Transport{ DisableKeepAlives : false } outParams := url.Values{} outParams.Set(""method"", ""write"") outParams.Set(""message"", ""BLAH"") for { // Encode as part of URI. outboundRequest, err := http.NewRequest( ""GET"", fmt.Sprintf(endpoint_url_fmt, outParams.Encode()), nil ) outboundRequest.Close = false _ , err = transport.RoundTrip(outboundRequest) if err != nil { fmt.Println(err) } }} #!/usr/bin/env pythonimport requestsendpoint_url_fmt = ""https://something.com/restserver.php""params = {}params['method'] = 'write'params['category'] = category_errors_scubaparams['message'] = ""blah""while True: r = requests.get(endpoint_url_fmt, params = params) resp , err = transport.RoundTrip(outboundRequest) resp.Close() // This allows the connection to be reused",Why is Go HTTPS Client not reusing connections?
"In Go, is there any way to access private fields of a struct from another package?"," I have a struct in one package that has private fields: And another package (for example, a white-box testing package) needs access to them: Is there a way to declare bar to be a sort of ""friend"" package or any other way to be able to access foo.Foo's private members from bar, but still keep them private for all other packages (perhaps something in unsafe)? <code>  package footype Foo struct { x int y *Foo} package barimport ""../foo""func change_foo(f *Foo) { f.y = nil}",Is there any way to access private fields of a struct from another package?
Go: encrypt message with RSA private key (as in OpenSSL's RSA_private_encrypt)," I'm trying to implement Chef API client in Go, but stuck trying to create correct request header RSA signature. According to documentation:A canonical header is signed with the private key used by the client machine from which the request is sent, and is also encoded using Base64.The following ruby call to OpenSSL::PKey::RSA.private_encrypt() can be found in mixlib-authentication gem code, it uses OpenSSL bindings, private_encrypt() method calls RSA_private_encrypt openssl function.Unfortunately, I cannot find matching function in Go's standard library; crypto/rsa looks close, but it only implements conventional cryptography methods: encryption with public key, hash signing with private key. OpenSSL's RSA_private_encrypt does the opposite: it encrypts (small) message with private key (akin to creating a signature from message hash).This ""signing"" can also be achieved with this command: Are there any native Go libraries to achieve the same result as OpenSSL's RSA_private_encrypt, or the only way is using Cgo to call this function from OpenSSL library? Maybe I'm missing something. My idea was implementing the client without any non-go dependencies.I'm a Go newbie, so I'm not sure I can dive into crypto/rsa module sources.Found the similar question, but the answer to use SignPKCS1v15 is obviously wrong (this function encrypts message's hash, not the message itself). <code>  openssl rsautl -sign -inkey path/to/private/key.pem \ -in file/to/encrypt -out encrypted/output",Encrypt message with RSA private key (as in OpenSSL's RSA_private_encrypt)
how to quickly deploy Go code on the remote server," I'm writing some new web services in Go.What are some deployment strategies I can use, regardless of the target platform? For example, I'm developing on a Mac, but the staging/production servers will be running Linux.Are there some existing deployment tools I can use that support Go? If not, what are some things I can do to streamline the process? I use LiteIDE for development. Is there any way to hook LiteIDE into the deployment process? <code> ",Deployment strategies for Go services?
how to easily build/run Go code on the remote server," I'm writing some new web services in Go.What are some deployment strategies I can use, regardless of the target platform? For example, I'm developing on a Mac, but the staging/production servers will be running Linux.Are there some existing deployment tools I can use that support Go? If not, what are some things I can do to streamline the process? I use LiteIDE for development. Is there any way to hook LiteIDE into the deployment process? <code> ",Deployment strategies for Go services?
convert interface{} to int in Go Lang," I'm trying to get a value from a JSON and cast it to int but it doesn't work, and I don't know how to do it properly.Here is the error message: And the code: <code>  ...cannot convert val (type interface {}) to type int: need type assertion var f interface{} err = json.Unmarshal([]byte(jsonStr), &f) if err != nil { utility.CreateErrorResponse(w, ""Error: failed to parse JSON data."") return } m := f.(map[string]interface{}) val, ok := m[""area_id""] if !ok { utility.CreateErrorResponse(w, ""Error: Area ID is missing from submitted data."") return } fmt.Fprintf(w, ""Type = %v"", val) // <--- Type = float64 iAreaId := int(val) // <--- Error on this line. testName := ""Area_"" + iAreaId // not reaching here",Convert interface{} to int
convert interface{} to int in Golang," I'm trying to get a value from a JSON and cast it to int but it doesn't work, and I don't know how to do it properly.Here is the error message: And the code: <code>  ...cannot convert val (type interface {}) to type int: need type assertion var f interface{} err = json.Unmarshal([]byte(jsonStr), &f) if err != nil { utility.CreateErrorResponse(w, ""Error: failed to parse JSON data."") return } m := f.(map[string]interface{}) val, ok := m[""area_id""] if !ok { utility.CreateErrorResponse(w, ""Error: Area ID is missing from submitted data."") return } fmt.Fprintf(w, ""Type = %v"", val) // <--- Type = float64 iAreaId := int(val) // <--- Error on this line. testName := ""Area_"" + iAreaId // not reaching here",Convert interface{} to int
Is golang goroutine a coroutine?," In the Google I/O 2012 presentation Go Concurrency Patterns, Rob Pike mentions that several goroutines can live in one thread. Does this imply that they are implemented as coroutines? If not, how they are implemented? Links to source code would be welcome. <code> ",Is a Go goroutine a coroutine?
Go concurrent access to pointer methods," I'm trying to understand what happens when you make concurrent access to a pointers methods?I have a map of pointers and spawn off a few go routines. I pass the map into each go routine and each go routine will use one of the values in the map. Nothing is being written to the map only being read from.The map is small, only 4 keys so it's possible that more than one go routine will be using the same value from the map. Question is, what happens when two go routines call a method of the same pointer? Will I get unpredictable results?EDITExample: I'm taking out the map portion as that's not the question I'm after.I have foo which is a pointer of type MyStruct and this structure has a method DoSomething that takes arguments. In the main function I'm creating two go routines and both of them make calls to foo.DoSomething passing different values. In this example the first go routine has a much larger calculation to preform than the second one (just using sleep times here to simulate calculations). Again nothing in the structure is changing I'm only making a call to the structures method. Do I have to worry about the second go routine making a call to foo.DoSomething when the first go routine is still working with the method? <code>  package mainimport ( ""log"" ""time"")type MyStruct struct {}func (self *MyStruct) DoSomething(value int) { log.Printf(""%d Start"", value) calculation_time := time.Duration(value) * time.Second log.Printf(""%d Calculating"", value, calculation_time) time.Sleep(calculation_time) log.Printf(""%d Done"", value)}func main() { var foo = new(MyStruct) go foo.DoSomething(5) // is this method call a problem when the first one is still working? go foo.DoSomething(2) time.Sleep(time.Duration(6 * time.Second))}",Go concurrent access to pointers methods
Constructors in golang," I have a struct and I would like it to be initialised with some sensible default values.Typically, the thing to do here is to use a constructor but since go isn't really OOP in the traditional sense these aren't true objects and it has no constructors.I have noticed the init method but that is at the package level. Is there something else similar that can be used at the struct level?If not what is the accepted best practice for this type of thing in Go? <code> ",Constructors in Go
Go install always fails no install directory outside GOPATH," No matter what structure the project is in this always fails with the same message. Go build works perfectly.Here is my go env This is on Mac OSX Mountain Lion and go was installed with homebrew. <code>  ~/src/go-statsd-client> echo $GOPATH/Users/me/gopath~/src/go-statsd-client> echo $GOROOT/usr/local/Cellar/go/1.1.1\~/src/go-statsd-client> go installgo install: no install location for directory /Users/me/src/go-statsd-client outside GOPATH GOARCH=""amd64""GOBIN=""""GOCHAR=""6""GOEXE=""""GOHOSTARCH=""amd64""GOHOSTOS=""darwin""GOOS=""darwin""GOPATH=""/Users/me/gopath""GORACE=""""GOROOT=""/usr/local/Cellar/go/1.1.1""GOTOOLDIR=""/usr/local/Cellar/go/1.1.1/pkg/tool/darwin_amd64""CC=""gcc""GOGCCFLAGS=""-g -O2 -fPIC -m64 -pthread -fno-common""CGO_ENABLED=""1""",Go install fails with error: no install location for directory xxx outside GOPATH
golang: how to link gopath to liteide?," I've installed LiteIde and exported GOROOT and GOPATH in my .bashrc. When I use LiteIDE, the auto-completion works just fine, but it can't build/run my code. When I look at 'Manage GOPATH', the System GOPATH box is empty, and I can't type into it either.Looking up online, the solution seems to be - 'link' the GOPATH and LiteIDE. How do I 'link' the two? <code> ",How to link GOPATH to LiteIDE?
Golang sort a slice of runes?," I'm having trouble sorting strings by character (to check whether two strings are anagrams, I want to sort both of them, and check for equality).I can get a []rune representation of the string s like this: And I can sort ints like this But rune is just an alias for int32 so I should be able to call However, I get the error: So... how do I sort a slice of int32, int64, or int*? EDIT: I did get my runes sorted, but boy, this is ugly. So basically if you have a slice of whatever, you'll have to wrap it in a type that implements sort.Interface. All those implementations will have the exact same method bodies (like sort.IntSlice and sort.Float64Slice). If this is really how ugly this has to be then why didn't they provide these WhateverSlice wrappers in the sort package? The lack of generics start to hurt very badly now. There must be a better way of sorting things.  <code>  runes := make([]rune, len(s)) copy(runes, []rune(s)) someInts := []int{5, 2, 6, 3, 1, 4} // unsortedsort.Ints(someInts) sort.Ints(runes) cannot use runes (type []rune) as type []int in function argument type RuneSlice []runefunc (p RuneSlice) Len() int { return len(p) }func (p RuneSlice) Less(i, j int) bool { return p[i] < p[j] }func (p RuneSlice) Swap(i, j int) { p[i], p[j] = p[j], p[i] }func sorted(s string) string { runes := []rune(s) sort.Sort(RuneSlice(runes)) return string(runes)}",Go sort a slice of runes?
Golang template.ExecuteTemplate include html," I have followed this tutorial: http://golang.org/doc/articles/wiki/final.go and have slightly modified it for my needs/wants. The problem is I would like to support HTML in the templates. I realize this is a security risk but it's not a concern at the moment.The result of a page render: Let me explain a little bit of the code: The data I would like to have HTML is stored in Page.Body. This is type []byte which means I can't (or can I?) run html/template.HTML(Page.Body) as that function expects a string.I have this which pre-renders the templates: And the actual ExecuteTemplate looks like this: Where w is w http.ResponseWriter, tmpl is tmpl string, and p is p *PageFinally my 'view.html' (template) looks like the following: Things I have tried:{{printf ""%s"" .Body | html}} doesn't do anything I have included github.com/russross/blackfriday (Markdown processor) and have run p.Body = blackfriday.MarkdownCommon(p.Body) which correctly converts Markdown to HTML, but the HTML is still output as entities.EDIT: I have attempted the following bit of code (I don't know why the format is messed up) and it still outputs the exact same.var s template.HTMLs = template.HTML(p.Body)p.Body = []byte(s)Any guidance is greatly appreciated. If I'm being confusing please ask and I can modify my question. <code>  <h1>this<strong>is</strong>a test</h1> type Page struct { Title string Body []byte} var ( templates = template.Must(template.ParseFiles(""tmpl/edit.html"", ""tmpl/view.html""))) err := templates.ExecuteTemplate(w, tmpl+"".html"", p) <h1>{{.Title}}</h1><p>[<a href=""/edit/{{.Title}}"">edit</a>]</p><div>{{printf ""%s"" .Body}}</div>",Go template.ExecuteTemplate include html
Testing equivalence of maps (golang)," I have a table-driven test case like this one: I could check whether the lengths are the same and write a loop that checks if every key-value pair is the same. But then I have to write this check again when I want to use it for another type of map (say map[string]string).What I ended up doing is, I converted the maps to strings and compared the strings: This assumes that the string representations of equivalent maps are the same, which seems to be true in this case (if the keys are the same then they hash to the same value, so their orders will be the same). Is there a better way to do this? What is the idiomatic way to compare two maps in table-driven tests? <code>  func CountWords(s string) map[string]intfunc TestCountWords(t *testing.T) { var tests = []struct { input string want map[string]int }{ {""foo"", map[string]int{""foo"":1}}, {""foo bar foo"", map[string]int{""foo"":2,""bar"":1}}, } for i, c := range tests { got := CountWords(c.input) // TODO test whether c.want == got }} func checkAsStrings(a,b interface{}) bool { return fmt.Sprintf(""%v"", a) != fmt.Sprintf(""%v"", b) }//...if checkAsStrings(got, c.want) { t.Errorf(""Case #%v: Wanted: %v, got: %v"", i, c.want, got)}",How to test the equivalence of maps in Golang?
Testing equivalence of maps (Golang)," I have a table-driven test case like this one: I could check whether the lengths are the same and write a loop that checks if every key-value pair is the same. But then I have to write this check again when I want to use it for another type of map (say map[string]string).What I ended up doing is, I converted the maps to strings and compared the strings: This assumes that the string representations of equivalent maps are the same, which seems to be true in this case (if the keys are the same then they hash to the same value, so their orders will be the same). Is there a better way to do this? What is the idiomatic way to compare two maps in table-driven tests? <code>  func CountWords(s string) map[string]intfunc TestCountWords(t *testing.T) { var tests = []struct { input string want map[string]int }{ {""foo"", map[string]int{""foo"":1}}, {""foo bar foo"", map[string]int{""foo"":2,""bar"":1}}, } for i, c := range tests { got := CountWords(c.input) // TODO test whether c.want == got }} func checkAsStrings(a,b interface{}) bool { return fmt.Sprintf(""%v"", a) != fmt.Sprintf(""%v"", b) }//...if checkAsStrings(got, c.want) { t.Errorf(""Case #%v: Wanted: %v, got: %v"", i, c.want, got)}",How to test the equivalence of maps in Golang?
Testing equivalence of maps," I have a table-driven test case like this one: I could check whether the lengths are the same and write a loop that checks if every key-value pair is the same. But then I have to write this check again when I want to use it for another type of map (say map[string]string).What I ended up doing is, I converted the maps to strings and compared the strings: This assumes that the string representations of equivalent maps are the same, which seems to be true in this case (if the keys are the same then they hash to the same value, so their orders will be the same). Is there a better way to do this? What is the idiomatic way to compare two maps in table-driven tests? <code>  func CountWords(s string) map[string]intfunc TestCountWords(t *testing.T) { var tests = []struct { input string want map[string]int }{ {""foo"", map[string]int{""foo"":1}}, {""foo bar foo"", map[string]int{""foo"":2,""bar"":1}}, } for i, c := range tests { got := CountWords(c.input) // TODO test whether c.want == got }} func checkAsStrings(a,b interface{}) bool { return fmt.Sprintf(""%v"", a) != fmt.Sprintf(""%v"", b) }//...if checkAsStrings(got, c.want) { t.Errorf(""Case #%v: Wanted: %v, got: %v"", i, c.want, got)}",How to test the equivalence of maps in Golang?
Is it possible to dynamicly load go code?," As the title says I want to dynamically load a Go package (or not) based on information only available at run time.The objective is to allow the user to extend the program via custom packages that add new native script commands. Currently every time I add new commands or want to disallow some commands, I need to edit the program and recompile, whereas if I could make some kind of dll or the like then I could create a ""import"" script command to search for and load a named command library.For the curious the program in question is custom command based scripting library that I use for all kinds of things.I did some searching ahead of time, and the results don't look good, but I could not find a clear no. <code> ",Is it possible to dynamically load Go code?
Is it possible to dynamically load go code?," As the title says I want to dynamically load a Go package (or not) based on information only available at run time.The objective is to allow the user to extend the program via custom packages that add new native script commands. Currently every time I add new commands or want to disallow some commands, I need to edit the program and recompile, whereas if I could make some kind of dll or the like then I could create a ""import"" script command to search for and load a named command library.For the curious the program in question is custom command based scripting library that I use for all kinds of things.I did some searching ahead of time, and the results don't look good, but I could not find a clear no. <code> ",Is it possible to dynamically load Go code?
"learning the golang - ""declared and not used"" error scoping"," I get this error saying that I'm not using a variable… but to my noob eyes, it looks like I am: Can anyone point out what I'm missing about the language? I think it has to do with = vs. := and scoping, but I'm not sure. <code>  func Sqrt(x float64) float64 { z := float64(x); for i := 0; i < 10; i++ { z := z - (z*z - x) / (2 * z); } return z;}","""declared and not used"" Error"
"Learning Go - ""declared and not used"" Error"," I get this error saying that I'm not using a variable… but to my noob eyes, it looks like I am: Can anyone point out what I'm missing about the language? I think it has to do with = vs. := and scoping, but I'm not sure. <code>  func Sqrt(x float64) float64 { z := float64(x); for i := 0; i < 10; i++ { z := z - (z*z - x) / (2 * z); } return z;}","""declared and not used"" Error"
imported but undefined? golang," I want to use ""http"" package, and try to import and got outputs below I saw this question : Strange golang package import issueIs this the same problem? or did I use 'import' or 'http' in wrong way? <code>  package mainimport ( ""http"")func main() { resp, err := http.Get(""https://api.github.com/repos/otiai10/myFirstGo"") if err != nil { // do something } if resp != nil { // do something }} % go run httpget.go# command-line-arguments./httpget.go:4: imported and not used: ""http""./httpget.go:8: undefined: http",imported but undefined? Go
"What is websocket url ""ws://{{$}}/ws"" means?"," I work with websocket in go. And I got a websocket url format from a trivial example that I google like this: Relatively complete code below:home.html: And wsServer.go: I thought it would be a regular expression while actually I can't explain it.I test it on my own PC browser, and connect success with: but not. And why? Of course it works when I change ""ws://{{$}}/ws"" to a certain url. But I want to know why?And what can this expression matching for?The complete example code is large, I think above is enough to the question. If I miss something you can find out complete example in this page : https://github.com/garyburd/go-websocket/tree/master/examples/chat <code>  ws://{{$}}/ws <html><head><title>Chat Example</title><script type=""text/javascript""> $(function() { ...... if (window[""WebSocket""]) { conn = new WebSocket(""ws://{{$}}/ws""); conn.onclose = function(evt) { appendLog($(""<div><b>Connection closed.</b></div>"")) } conn.onmessage = function(evt) { appendLog($(""<div/>"").text(evt.data)) } } else { appendLog($(""<div><b>Your browser does not support WebSockets.</b></div>"")) } ...... });</script></head></html> package mainimport ( ""flag"" ""log"" ""net/http"" ""text/template"")var addr = flag.String(""addr"", "":8080"", ""http service address"")var homeTempl = template.Must(template.ParseFiles(""home.html""))func serveHome(w http.ResponseWriter, r *http.Request) { ...... w.Header().Set(""Content-Type"", ""text/html; charset=utf-8"") homeTempl.Execute(w, r.Host)}func main() { http.HandleFunc(""/"", serveHome) http.HandleFunc(""/ws"", serveWs) err := http.ListenAndServe(:8080, nil) if err != nil { log.Fatal(""ListenAndServe: "", err) }} http://localhost:8080 http://ip:8080 (which ip is my computer's also the litsening server's ip)","What does this websocket url ""ws://{{$}}/ws"" mean?"
"in golang, which value's kind is reflect.Interface"," Kind of j is reflect.Int, as expected. Kind of j is also reflect.Int.Which values kind is reflect.Interface? <code>  j:=1 var j interface{} = 1","In Go, which values kind is reflect.Interface?"
GoLang: mGo unstructured collections," I'm VERY new to Go. From what I've seen in the examples of mGo, in order to query a collection and then read from it, you have to predefine the data that will be coming back in a struct. In PHP, the document was assigned to an array. This was perfect as one record may have completely different set of keys (may not contain Name or Phone but contain Email) and I could access it directly without setting up a predefined class / struct / variable.Is there a way to do the same in Go / mGo? <code>  type Person struct { ID bson.ObjectId `bson:""_id,omitempty""` Name string Phone string Timestamp time.Time}",Unstructured MongoDB collections with mgo
How to declare constant in golang," I am trying to declare to constant in Go, but it is throwing an error. Could anyone please help me with the syntax of declaring a constant in Go?This is my code: This is the error <code>  const romanNumeralDict map[int]string = { 1000: ""M"", 900 : ""CM"", 500 : ""D"", 400 : ""CD"", 100 : ""C"", 90 : ""XC"", 50 : ""L"", 40 : ""XL"", 10 : ""X"", 9 : ""IX"", 5 : ""V"", 4 : ""IV"", 1 : ""I"",} # command-line-arguments./Roman_Numerals.go:9: syntax error: unexpected {",How to declare a constant map in Golang?
How to declare constant map in golang," I am trying to declare to constant in Go, but it is throwing an error. Could anyone please help me with the syntax of declaring a constant in Go?This is my code: This is the error <code>  const romanNumeralDict map[int]string = { 1000: ""M"", 900 : ""CM"", 500 : ""D"", 400 : ""CD"", 100 : ""C"", 90 : ""XC"", 50 : ""L"", 40 : ""XL"", 10 : ""X"", 9 : ""IX"", 5 : ""V"", 4 : ""IV"", 1 : ""I"",} # command-line-arguments./Roman_Numerals.go:9: syntax error: unexpected {",How to declare a constant map in Golang?
How to declare constant map," I am trying to declare to constant in Go, but it is throwing an error. Could anyone please help me with the syntax of declaring a constant in Go?This is my code: This is the error <code>  const romanNumeralDict map[int]string = { 1000: ""M"", 900 : ""CM"", 500 : ""D"", 400 : ""CD"", 100 : ""C"", 90 : ""XC"", 50 : ""L"", 40 : ""XL"", 10 : ""X"", 9 : ""IX"", 5 : ""V"", 4 : ""IV"", 1 : ""I"",} # command-line-arguments./Roman_Numerals.go:9: syntax error: unexpected {",How to declare a constant map in Golang?
How to iterate through a map in golang in order?," Please see below my map I am looking to loop through this map in the order of the size of the key However, this prints out Is there a way that I can print them out in the order of the size of the key so, I would like to loop through this map like this etc...Thank you very much for your help! <code>  var romanNumeralDict map[int]string = map[int]string{ 1000: ""M"", 900 : ""CM"", 500 : ""D"", 400 : ""CD"", 100 : ""C"", 90 : ""XC"", 50 : ""L"", 40 : ""XL"", 10 : ""X"", 9 : ""IX"", 5 : ""V"", 4 : ""IV"", 1 : ""I"",} for k, v := range romanNumeralDict { fmt.Println(""k:"", k, ""v:"", v) } k: 1000 v: Mk: 40 v: XLk: 5 v: Vk: 4 v: IVk: 900 v: CMk: 500 v: Dk: 400 v: CDk: 100 v: Ck: 90 v: XCk: 50 v: Lk: 10 v: Xk: 9 v: IXk: 1 v: I k:1K:4K:5K:9k:10",How to iterate through a map in Golang in order?
How to reverse sort a slice of integer golang," I am trying to reverse-sort a slice of integers in Go. How do I sort it so that it goes from highest to lowest? so [25 5 4 3 1]I have tried this Source: http://golang.org/pkg/sort/#ReverseHowever, I am getting the error below <code>  example := []int{1,25,3,5,4} sort.Ints(example) // this will give me a slice sorted from 1 to the highest number sort.Sort(sort.Reverse(sort.Ints(keys))) # command-line-arguments./Roman_Numerals.go:31: sort.Ints(keys) used as value",How do I reverse sort a slice of integer Go?
Correct approach to global logging in Golang," What's the pattern for application logging in Go? If I've got, say, 5 goroutines I need to log from, should I... Create a single log.Logger and pass it around?Pass around a pointer to that log.Logger?Should each goroutine or function create a logger?Should I create the logger as a global variable? <code> ",Correct approach to global logging
How would you define a pool of goroutines to be executed at once in Golang?," TL;DR: Please just go to the last part and tell me how you would solve this problem.I've begun using Go this morning coming from Python. I want to call a closed-source executable from Go several times, with a bit of concurrency, with different command line arguments. My resulting code is working just well but I'd like to get your input in order to improve it. Since I'm at an early learning stage, I'll also explain my workflow.For the sake of simplicity, assume here that this ""external closed-source program"" is zenity, a Linux command line tool that can display graphical message boxes from the command line.Calling an executable file from GoSo, in Go, I would go like this: This should be working just right. Note that .Run() is a functional equivalent to .Start() followed by .Wait(). This is great, but if I wanted to execute this program just once, the whole programming stuff would not be worth it. So let's just do that multiple times.Calling an executable multiple timesNow that I had this working, I'd like to call my program multiple times, with custom command line arguments (here just i for the sake of simplicity). Ok, we did it! But I still can't see the advantage of Go over Python This piece of code is actually executed in a serial fashion. I have a multiple-core CPU and I'd like to take advantage of it. So let's add some concurrency with goroutines.Goroutines, or a way to make my program parallela) First attempt: just add ""go""s everywhereLet's rewrite our code to make things easier to call and reuse and add the famous go keyword: Nothing! What is the problem? All the goroutines are executed at once. I don't really know why zenity is not executed but AFAIK, the Go program exited before the zenity external program could even be initialized. This was confirmed by the use of time.Sleep: waiting for a couple of seconds was enough to let the 8 instance of zenity launch themselves. I don't know if this can be considered a bug though.To make it worse, the real program I'd actually like to call takes a while to execute itself. If I execute 8 instances of this program in parallel on my 4-core CPU, it's gonna waste some time doing a lot of context switching I don't know how plain Go goroutines behave, but exec.Command will launch zenity 8 times in 8 different threads. To make it even worse, I want to execute this program more than 100,000 times. Doing all of that at once in goroutines won't be efficient at all. Still, I'd like to leverage my 4-core CPU!b) Second attempt: use pools of goroutinesThe online resources tend to recommend the use of sync.WaitGroup for this kind of work. The problem with that approach is that you are basically working with batches of goroutines: if I create of WaitGroup of 4 members, the Go program will wait for all the 4 external programs to finish before calling a new batch of 4 programs. This is not efficient: CPU is wasted, once again.Some other resources recommended the use of a buffered channel to do the work: This seems ugly. Channels were not intended for this purpose: I'm exploiting a side-effect. I love the concept of defer but I hate having to declare a function (even a lambda) to pop a value out of the dummy channel that I created. Oh, and of course, using a dummy channel is, by itself, ugly.c) Third attempt: die when all the children are deadNow we are nearly finished. I have just to take into account yet another side effect: the Go program closes before all the zenity pop-ups are closed. This is because when the loop is finised (at the 8th iteration), nothing prevents the program from finishing. This time, sync.WaitGroup will be useful. Done.My questionsDo you know any other proper way to limit the number of goroutines executed at once?I don't mean threads; how Go manages goroutines internally is not relevant. I really mean limiting the number of goroutines launched at once: exec.Command creates a new thread each time it is called, so I should control the number of time it is called.Does that code look fine to you?Do you know how to avoid the use of a dummy channel in that case?I can't convince myself that such dummy channels are the way to go. <code>  package mainimport ""os/exec""func main() { cmd := exec.Command(""zenity"", ""--info"", ""--text='Hello World'"") cmd.Run()} package main import ( ""os/exec"" ""strconv"")func main() { NumEl := 8 // Number of times the external program is called for i:=0; i<NumEl; i++ { cmd := exec.Command(""zenity"", ""--info"", ""--text='Hello from iteration n."" + strconv.Itoa(i) + ""'"") cmd.Run() }} package mainimport ( ""os/exec"" ""strconv"")func main() { NumEl := 8 for i:=0; i<NumEl; i++ { go callProg(i) // <--- There! }}func callProg(i int) { cmd := exec.Command(""zenity"", ""--info"", ""--text='Hello from iteration n."" + strconv.Itoa(i) + ""'"") cmd.Run()} package mainimport ( ""os/exec"" ""strconv"")func main() { NumEl := 8 // Number of times the external program is called NumCore := 4 // Number of available cores c := make(chan bool, NumCore - 1) for i:=0; i<NumEl; i++ { go callProg(i, c) c <- true // At the NumCoreth iteration, c is blocking }}func callProg(i int, c chan bool) { defer func () {<- c}() cmd := exec.Command(""zenity"", ""--info"", ""--text='Hello from iteration n."" + strconv.Itoa(i) + ""'"") cmd.Run()} package mainimport ( ""os/exec"" ""strconv"" ""sync"")func main() { NumEl := 8 // Number of times the external program is called NumCore := 4 // Number of available cores c := make(chan bool, NumCore - 1) wg := new(sync.WaitGroup) wg.Add(NumEl) // Set the number of goroutines to (0 + NumEl) for i:=0; i<NumEl; i++ { go callProg(i, c, wg) c <- true // At the NumCoreth iteration, c is blocking } wg.Wait() // Wait for all the children to die close(c)}func callProg(i int, c chan bool, wg *sync.WaitGroup) { defer func () { <- c wg.Done() // Decrease the number of alive goroutines }() cmd := exec.Command(""zenity"", ""--info"", ""--text='Hello from iteration n."" + strconv.Itoa(i) + ""'"") cmd.Run()}",How would you define a pool of goroutines to be executed at once?
Using go with fish fish shell - error when running `go install /path/to/src`," I am following the ""How to Write Code"" portion of the golang docs, here. I am also using fish fish shell.I have followed the tutorial and set the proper environment variables (GOPATH and PATH) but I can't get the command go install github.com/user/hello to work with my installation.I am getting an error: can't load package: package github.com/user/hello: import ""github.com/user/hello"": cannot find package <code> ",Using Go with fish fish shell - error when running `go install /path/to/src`
Golang: mapping strings to multiple types for json objects?," I want to create a map that I can transform into a json object such as but golang specifies that the map be declare with types, so I can have map[string]string or map[string]int. How do I create a json object like the above?Note: I won't know what data and/or types I need until runtime or when I need to create the json object. Therefore I can't just create an object like <code>  { ""a"": ""apple"", ""b"": 2} type Foo struct { A string `json:""a""` B int `json:""b""`}",Mapping strings to multiple types for json objects?
Golang: Confusing ToUpper and ToTitle, Is there any difference between the ToUpper and the ToTitle function? <code> ,Confusing ToUpper and ToTitle
Compare arrays in Go lang," How can I correctly compare two arrays in Go?For instance, how can I compare two dimensional arrays with int entries, or any other types?How deep is that comparison? <code> ",Comparing arrays in Go language
Execute formated time in a slice with html/template," I'm making this simple webserver that can host my blog, but whatever I do; I can not execute a proper formatted time into my html/template.Here's what I do:I've created this struct: Next up I've created this little func that retrieves the blogposts with corresponding title/dates from the Appengine Datastore and return that as a slice: Finally, in the blogHandler I create a slice based on the retrieved data from the Appengine Datastore using: Now when I Execute my template called blog like this, the dates of the blogs are being parsed as default dates: So, me, being the Golang n00b that I am, would say that a function like the following would give me the result I want However that results in a type conflict ofcourse, which I tried to solve using: It is probably some n00b thing I oversaw once again, but I just can't see how I can't override a time.Time Type in a slice or at least print it in the format that I want. <code>  type Blogpost struct { Title string Content string Date time.Time} func GetBlogs(r *http.Request, max int) []Blogpost { c := appengine.NewContext(r) q := datastore.NewQuery(""Blogpost"").Order(""-Date"").Limit(max) bp := make([]Blogpost, 0, max) q.GetAll(c, &bp) return bp} blogs := GetBlogs(r, 10) blog.Execute(w, blogs) // gives dates like: 2013-09-03 16:06:48 +0000 UTC blogs[0].Date = blogs[0].Date.Format(""02-01-2006 15:04:05"") // Would return like 03-09-2013 16:06:48, at least when you print the formatted date that is. blogs[0].Date, _ = time.Parse(""02-01-2006 15:04:05"", blogs[0].Date.Format(""02-01-2006 15:04:05"")) // returns once again: 2013-09-03 16:06:48 +0000 UTC",Execute formatted time in a slice with html/template
Unit testing in golang - log and then fail?," I am used to test drive my code. Now that I am new to Go I am trying to get it right as fast as possible. I am using the testing package in the standard library which seem to be good enough. (I also like that it is not yet another external dependency. We are currently at 2 dependencies overall - compared to any Java- or Ruby project.....) Anyways - it looks like an assert in golang looks like this: I find this verbose and would like to do it on one line instead: or something like that. I hope that I have missed something obvious here. What is the best/idiomatic way to do it in go?UPDATE: just to clarify. If I was to do something like this: and then write my test like this then it would not be the go way to do it? <code>  func TestSomething(t *testing.T) { something := false if something { t.Log(""Oh noes - something is false"") t.Fail() }} Assert( something, ""Oh noes - something is false"" ) func AssertTrue(t *testing.T, value bool, message string) { if value { t.Log(message) t.Fail() }} func TestSomething(t *testing.T) { something := false AssertTrue(t, something, ""Oh noes - something is false"")}",Unit testing - log and then fail?
"Go: ""Static"" method design"," I'm looking for advice on the best way to clean up the following structure. I know Go doesn't have static methods and it's usually better to encapsulate functionality in a separate package. My struct types reference each other, and so cannot be declared in separate packages because of circular imports. But, if I want to load a user or payment, I'm just throwing away the receiver: I could namespace the functions themselves, which strikes me as unclean: I would really like to be able to just call .Get or similar on the struct without writing the name of the struct in the function itself. What's the idiomatic way to do this? <code>  type Payment struct { User *User}type User struct { Payments *[]Payments}func (u *User) Get(id int) *User { // Returns the user with the given id }func (p *Payment) Get(id int) *Payment { // Returns the payment with the given id } var u *Useruser := u.Get(585) func GetUser(id int) *User { // Returns the user with the given id }func GetPayment(id int) *Payment { // Returns the payment with the given id }","""Static"" method design"
Golang : Express-like framework for building APIs," I have built some basic APIs with the node.js Express framework. I'm thinking of switching to Go, since callback code gets hard to reason about pretty quickly. I really like Express as a framework, is there something similar in Go? <code> ",Express-like framework for building APIs
Go: Named type assertions," If I have a custom type that simply redefines a pre-defined type with a name: And I try to use it in a function that accepts the pre-defined type: Why does the type assertion fail, but the conversion work? <code>  type Answer string func acceptMe(str string) { fmt.Println(str)}func main() { type Answer string var ans Answer = ""hello"" // cannot use ans (type Answer) as type string in function argument acceptMe(ans) // invalid type assertion: ans.(string) (non-interface type Answer on left) acceptMe(ans.(string)) // Does work, but I don't understand why if the previous doesn't: acceptMe(string(ans))}",Go: Named type assertions and conversions
How to sort a Map[string]int by its values?," Given this code block I would like to print out In the order of highest to lowest <code>  map[string]int {""hello"":10, ""foo"":20, ""bar"":20} foo, 20bar, 20hello, 10",How can I sort a Map[string]int by its values?
Using go-websocket behind Apaceh mod_proxy_wstunnel," Note: Updated config and added trailing slash to websocket path. Still same problemIs it possible to use go-websocket behind a Apache reverse proxy with mod_proxy_wstunnel?I tried and failed to get things working.I tried to use the Chat example behind an Apache reverse proxy (with mod_proxy_wstunnel enabled). And it doesn't work. The proxy is a success, while the websocket part does not work at all.My Apache config looks similar to this: And of course I'm running the chat server on port 8080. I've tested it with SSH tunnel, and things work perfectly. Then I moved on to Apache.The first time I tried, the javascript console complains this: The request seems to be stucked at the origin check.Then I tried again after comment out the origin check, it get this: It seems the chat server do not get the upgrade request at all.How should I debug this?Where should I start looking? <code>  <VirtualHost *:80> DocumentRoot /var/www/foobar ServerName foobar.com ProxyPass / http://localhost:8080/ ProxyPassReverse / http://localhost:8080/ ProxyPass /ws/ ws://localhost:8080/ws/ ProxyPassReverse /ws/ ws://localhost:8080/ws/ ErrorLog logs/error_log-foobar CustomLog logs/access_log-foobar common LogLevel debug</VirtualHost> NetworkError: 403 Forbidden - http://foobar.com/ws/ NetworkError: 400 Bad Request - http://foobar.com/ws/",Using go-websocket behind Apache mod_proxy_wstunnel
"Golang, encrypting a string with AES and Base64"," I'm trying to encrypt some text inside a database to be loaded and decrypted during program startup.I have tried a few methods, including a third party library https://github.com/richard-lyman/lithcrypt to no avail. Using the following method encrypts/decrypts 8/10 items, but it seems that some padding residue is left behind at some point in the encrypt/decrypt. As it stands my code is like this: It was mentioned to me that I might need to pad the string, but it seems strange that I would have to pad a stream cipher. Below is an example of this error: http://play.golang.org/p/4FQBAeHgRs  <code>  package client import ( ""encoding/base64"" ""crypto/aes"" ""crypto/cipher"" ""fmt"" ) var iv = []byte{34, 35, 35, 57, 68, 4, 35, 36, 7, 8, 35, 23, 35, 86, 35, 23}func encodeBase64(b []byte) string { return base64.StdEncoding.EncodeToString(b) } func decodeBase64(s string) []byte { data, err := base64.StdEncoding.DecodeString(s) if err != nil { panic(err) } return data } func Encrypt(key, text string) string { block, err := aes.NewCipher([]byte(key)) if err != nil { panic(err) } plaintext := []byte(text) cfb := cipher.NewCFBEncrypter(block, iv) ciphertext := make([]byte, len(plaintext)) cfb.XORKeyStream(ciphertext, plaintext) return encodeBase64(ciphertext) } func Decrypt(key, text string) string { block, err := aes.NewCipher([]byte(key)) if err != nil { panic(err) } ciphertext := decodeBase64(text) cfb := cipher.NewCFBEncrypter(block, iv) plaintext := make([]byte, len(ciphertext)) cfb.XORKeyStream(plaintext, ciphertext) } ",Encrypting a string with AES and Base64
Does Scala have an equivelent to golangs defer?, Does Scala have an equivelent to golangs defer?from:http://golang.org/doc/effective_go.html#defer Go's defer statement schedules a function call (the deferred function) to be run immediately before the function executing the defer returns. It's an unusual but effective way to deal with situations such as resources that must be released regardless of which path a function takes to return. The canonical examples are unlocking a mutex or closing a file. <code> ,Does Scala have an equivalent to golangs defer?
Iterate through a struct in Go," Basically, the only way (that I know of) to iterate through the values of the fields of a struct is like this: I was wondering, if there's a better and more versatile way of achieving []interface{}{ r.a_number, r.a_string, }, so I don't need to list each parameter individually, or alternatively, is there a better way to loop through a struct?I tried to look through the reflect package, but I hit a wall, because I'm not sure what to do once I retrieve reflect.ValueOf(*r).Field(0).Thanks! <code>  type Example struct { a_number uint32 a_string string}//...r := &Example{(2 << 31) - 1, ""....""}:for _, d:= range []interface{}{ r.a_number, r.a_string, } { //do something with the d}",Iterate through the fields of a struct in Go
Golang: how to unmarshal XML attributes with semi-colons?," Some SVG/XML files I'm working with have dashes and colons in attribute names - for example: I'm trying to figure out how to unmarshal these attributes using golang's encoding/xml package. While the dashed attributes works, the ones with the colon doesn't:[See here for a live example] These are seemingly legal attribute names; any idea how to extract the xlink:href one? thanks. <code>  <g> <a xlink:href=""http://example.com"" data-bind=""121"">...</a></g> package mainimport ( ""encoding/xml"" ""fmt"")var data = `<g> <a xlink:href=""http://example.com"" data-bind=""121"">lala</a></g>`type Anchor struct { DataBind int `xml:""data-bind,attr""` // this works XlinkHref string `xml:""xlink:href,attr""` // this fails}type Group struct { A Anchor `xml:""a""`}func main() { group := Group{} _ = xml.Unmarshal([]byte(data), &group) fmt.Printf(""%#v\n"", group.A)}",How to unmarshal XML attributes with colons?
Golang: how to unmarshal XML attributes with colons?," Some SVG/XML files I'm working with have dashes and colons in attribute names - for example: I'm trying to figure out how to unmarshal these attributes using golang's encoding/xml package. While the dashed attributes works, the ones with the colon doesn't:[See here for a live example] These are seemingly legal attribute names; any idea how to extract the xlink:href one? thanks. <code>  <g> <a xlink:href=""http://example.com"" data-bind=""121"">...</a></g> package mainimport ( ""encoding/xml"" ""fmt"")var data = `<g> <a xlink:href=""http://example.com"" data-bind=""121"">lala</a></g>`type Anchor struct { DataBind int `xml:""data-bind,attr""` // this works XlinkHref string `xml:""xlink:href,attr""` // this fails}type Group struct { A Anchor `xml:""a""`}func main() { group := Group{} _ = xml.Unmarshal([]byte(data), &group) fmt.Printf(""%#v\n"", group.A)}",How to unmarshal XML attributes with colons?
Is there an easy way to stub out time.Now() globally in golang during test?," Part of our code is time sensitive and we need to able to reserve something and then release it in 30-60 seconds etc, which we can just do a time.Sleep(60 * time.Second)I have just implemented time interface and during test use a stubbed implementation of the time interface, similar to this golang-nuts discussion.However, time.Now() is called in multiple sites which means we need to pass a variable around to keep track of how much time we have actually slept. I was wondering if there is an alternative way to stub out time.Now() globally. Maybe making a system call to change the system clock?Maybe we can write our own time package which basically wraps around the time package but allows us to change it? Our current implementation works well, I am a go beginner and I am curious to see if anyone has other ideas? <code> ",Is there an easy way to stub out time.Now() globally during test?
Go: Specifying template filenames for template.ParseFiles," My current directory structure looks like the following: The file foo.go uses ParseFiles to read in the template file during init. Unit tests for foo.go work as expected. However, I am now trying to run unit tests for bar.go and baz.go which both import foo.go and I get a panic on trying to open foo.tmpl. I've tried specifying the template name as a relative directory (""./foo.tmpl""), a full directory (""~/go/src/github.com/App/Template/foo.tmpl""), an App relative directory (""/App/Template/foo.tmpl""), and others but nothing seems to work for both cases. The unit tests fail for either bar.go or baz.go (or both).Where should my template file be placed and how should I call ParseFiles so that it can always find the template file regardless of which directory I call go test from?  <code>  App - Template - foo.go - foo.tmpl - Model - bar.go - Another - Directory - baz.go import ""text/template""var qTemplate *template.Templatefunc init() { qTemplate = template.Must(template.New(""temp"").ParseFiles(""foo.tmpl""))}... /App/Model$ go test panic: open foo.tmpl: no such file or directory/App/Another/Directory$ go test panic: open foo.tmpl: no such file or directory",Specifying template filenames for template.ParseFiles
golang pretty print json," Does anyone know of a simple way to pretty-print JSON output in Go?The stock http://golang.org/pkg/encoding/json/ package does not seem to include functionality for this (EDIT: it does, see accepted answer) and a quick google doesn't turn up anything obvious.Uses I'm looking for are both pretty-printing the result of json.Marshal and just formatting a string full of JSON from wherever, so it's easier to read for debug purposes. <code> ",How can I pretty-print JSON using Go?
How can I pretty-print json using Go?," Does anyone know of a simple way to pretty-print JSON output in Go?The stock http://golang.org/pkg/encoding/json/ package does not seem to include functionality for this (EDIT: it does, see accepted answer) and a quick google doesn't turn up anything obvious.Uses I'm looking for are both pretty-printing the result of json.Marshal and just formatting a string full of JSON from wherever, so it's easier to read for debug purposes. <code> ",How can I pretty-print JSON using Go?
Aggregation Query to MongoDB using go with mgo. How to represent an array," I am constructing an aggregation pipeline query with the $substr command from MongoDB but I don't know how to represent the array it requires in Go with the mgo driver because it contains different types of values (string, int).Here is the query in javascript: What this is trying to do is get the substring of dt (from the previous stage of aggregation) with starting index 0 and ending index 6.In Go i got: but [""$dt"",0,6] is not a correct representation and everything I tried seems to fail. <code>  [ {$group: {""_id"": {""dt"": {""$substr"": [""$dt"",0,6]}}}} ] []bson.M{""$group"": bson.M{""_id"": bson.M{""dt"": bson.M{""$substr"": [""$dt"",0,6]}}}}}",How to represent an array with mixed types
In golang how do you convert a slice into an array," I am trying to write an application that reads RPM files. The start of each block has a Magic char of [4]byte.Here is my struct I am trying to do the following: I am searching online and not sure how to go from a slice to an array (without copying). I can always make the Magic []byte (or even uint64), but I was more curious on how would I go from type []byte to [4]byte if needed to? <code>  type Lead struct { Magic [4]byte Major, Minor byte Type uint16 Arch uint16 Name string OS uint16 SigType uint16} lead := Lead{}lead.Magic = buffer[0:4]",How do you convert a slice into an array?
In Golang how do you convert a slice into an array," I am trying to write an application that reads RPM files. The start of each block has a Magic char of [4]byte.Here is my struct I am trying to do the following: I am searching online and not sure how to go from a slice to an array (without copying). I can always make the Magic []byte (or even uint64), but I was more curious on how would I go from type []byte to [4]byte if needed to? <code>  type Lead struct { Magic [4]byte Major, Minor byte Type uint16 Arch uint16 Name string OS uint16 SigType uint16} lead := Lead{}lead.Magic = buffer[0:4]",How do you convert a slice into an array?
XML Decoding in GoLang," I've been playing about with Go's XML package and cannot see what is wrong with the following code. The above code runs without any errors and prints to the terminal: The struct seems empty but I can't see why it isn't getting populated with the XML data.  <code>  package mainimport ( ""encoding/xml"" ""fmt"" ""net/http"") type Channel struct { Items Item}type Item struct { Title string `xml:""title""` Link string `xml:""link""` Description string `xml:""description""`}func main() { var items = new(Channel) res, err := http.Get(""http://www.reddit.com/r/google.xml"") if err != nil { fmt.Printf(""Error: %v\n"", err) } else { decoded := xml.NewDecoder(res.Body) err = decoded.Decode(items) if err != nil { fmt.Printf(""Error: %v\n"", err) } fmt.Printf(""Title: %s\n"", items.Items.Title) }} Title:",How to decode Reddit's RSS using Golang?
XML Decoding in Go," I've been playing about with Go's XML package and cannot see what is wrong with the following code. The above code runs without any errors and prints to the terminal: The struct seems empty but I can't see why it isn't getting populated with the XML data.  <code>  package mainimport ( ""encoding/xml"" ""fmt"" ""net/http"") type Channel struct { Items Item}type Item struct { Title string `xml:""title""` Link string `xml:""link""` Description string `xml:""description""`}func main() { var items = new(Channel) res, err := http.Get(""http://www.reddit.com/r/google.xml"") if err != nil { fmt.Printf(""Error: %v\n"", err) } else { decoded := xml.NewDecoder(res.Body) err = decoded.Decode(items) if err != nil { fmt.Printf(""Error: %v\n"", err) } fmt.Printf(""Title: %s\n"", items.Items.Title) }} Title:",How to decode Reddit's RSS using Golang?
"Go, Golang, formatFloat : convert float number to string"," http://golang.org/pkg/strconv/http://play.golang.org/p/4VNRgW8WoBHow do I convert a float number into string format?This is google playground but not getting the expected output. (2e+07)I want to get ""21312421.213123"" Please help me get the string out of float number. Thanks <code>  package mainimport ""fmt""import ""strconv""func floattostr(input_num float64) string { // to convert a float number to a string return strconv.FormatFloat(input_num, 'g', 1, 64) } func main() { fmt.Println(floattostr(21312421.213123)) // what I expect is ""21312421.213123"" in string format }",formatFloat : convert float number to string
How to use RWMutex in golang?," It is called below My understanding is that we first lock the receiver s (which is a type Stat) and then we add to it if the counter does exist.Questions:Q1: why do we need to lock it? What does RWMutex even mean?Q2: s.countersLock.RLock() - does this lock up the entire receiver s or only the counters field in type Stat?Q3: s.countersLock.RLock() - does this lock up the averages field?Q4: Why should we use RWMutex? I thought channel was the preferred way to handle concurrency in Golang?Q5: What is this atomic.AddInt64. Why do we need atomic in this case? Q6: Why would we unlock right before we add to it? <code>  type Stat struct { counters map[string]*int64 countersLock sync.RWMutex averages map[string]*int64 averagesLock sync.RWMutex} func (s *Stat) Count(name string) { s.countersLock.RLock() counter := s.counters[name] s.countersLock.RUnlock() if counter != nil { atomic.AddInt64(counter, int64(1)) return }}",How to use RWMutex?
How to use RWMutex in Golang?," It is called below My understanding is that we first lock the receiver s (which is a type Stat) and then we add to it if the counter does exist.Questions:Q1: why do we need to lock it? What does RWMutex even mean?Q2: s.countersLock.RLock() - does this lock up the entire receiver s or only the counters field in type Stat?Q3: s.countersLock.RLock() - does this lock up the averages field?Q4: Why should we use RWMutex? I thought channel was the preferred way to handle concurrency in Golang?Q5: What is this atomic.AddInt64. Why do we need atomic in this case? Q6: Why would we unlock right before we add to it? <code>  type Stat struct { counters map[string]*int64 countersLock sync.RWMutex averages map[string]*int64 averagesLock sync.RWMutex} func (s *Stat) Count(name string) { s.countersLock.RLock() counter := s.counters[name] s.countersLock.RUnlock() if counter != nil { atomic.AddInt64(counter, int64(1)) return }}",How to use RWMutex?
Golang: Name of a constant given its value," How do you get the name of a constant given its value ?More specifically (and to get a more readable understanding), I'm working with the crypto/tls package. Cipher suites are defined as constants: After a successful handshake with a server, I can get to the Ciphersuite agreed on through the connection: cipher here is an uint16. Is there a way to display it as a string, for instance TLS_RSA_WITH_3DES_EDE_CBC_SHA if that's what was agreed upon ? <code>  const ( TLS_RSA_WITH_RC4_128_SHA uint16 = 0x0005 TLS_RSA_WITH_3DES_EDE_CBC_SHA uint16 = 0x000a TLS_RSA_WITH_AES_128_CBC_SHA uint16 = 0x002f TLS_RSA_WITH_AES_256_CBC_SHA uint16 = 0x0035 TLS_ECDHE_RSA_WITH_RC4_128_SHA uint16 = 0xc011 TLS_ECDHE_RSA_WITH_3DES_EDE_CBC_SHA uint16 = 0xc012 TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA uint16 = 0xc013 TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA uint16 = 0xc014) c, _ := tls.Dial(""tcp"", ""somedomain.com:443"", nil)// Suppose everything went right// This is the Ciphersuite for the conn:cipher := c.ConnectionState().Ciphersuite",Name of a constant given its value
`go build` doesn't find my C standard library when compiling cgo package," I'm trying to compile a go project in a raspberry pi.The project has 5 files, two small .c files and its counterparts .h (one of these files is my code -- it calls the other, which is a base64 library) and a .go files which calls my .c code using cgo.When I compile my C code only (with its calls and everything) with gcc alone at the raspberry pi it does well without any configuration.When I compile the entire go project on my x86 Linux Ubuntu machine with go build, it also does pretty well.But when I try to compile the go project with go build in the raspberry pi it doesn't get my C libraries: (If I put the <stdlib.h> before the <math.h> the problem occurs for it too, so the problem is not the absence of math.h, I think)I tried to:add // #cgo CFLAGS: -I/usr/include to the .go fileadd // #cgo LDFLAGS: -I/usr/include (I can't discover what is the proper usage of these flags)use go build -ldflags '-I/usr/include'I don't understand why go is trying to compile base64.c with -I /usr/lib/go/pkg/linux_arm. Really don't. Someone help.EDIT: Clarifying note about the structure of the project:It has 5 files, 2 C (and its counterparts H):base64.c project.c and 1 Go: Where, what and how should I change in this declarations for this thing to work? And why did it worked on my x86 linux? <code>  fiatjaf@raspberrypi ~/g/s/b/f/project> go build -xWORK=/tmp/go-build702187084mkdir -p $WORK/bitbucket.org/fiatjaf/project/_obj/cd /home/fiatjaf/go/src/bitbucket.org/fiatjaf/project/usr/lib/go/pkg/tool/linux_arm/5c -FVw -I $WORK/bitbucket.org/fiatjaf/project/_obj/ -I /usr/lib/go/pkg/linux_arm -o $WORK/bitbucket.org/fiatjaf/project/_obj/base64.5 -DGOOS_linux -DGOARCH_arm ./base64.c# bitbucket.org/fiatjaf/project./base64.c:2 5c: No such file or directory: math.h #include <math.h>#include <stdint.h>#include <stdlib.h>... // definitions of functions used at project.c #include <stdlib.h>#include <string.h>#include ""base64.h""... // functions used at project.go ...// #include <stdlib.h>// #include <string.h>// #include ""project.h""// #cgo CFLAGS: -I/usr/include// #cgo LDFLAGS: -lmimport ""C""...",go build doesn't find my C standard library when compiling cgo package
how can I use gzip on a string in golong?," I want to use Go to read out a chunk from a file, treat it as a string and gzip this chunk. I know how to read from the file and treat it as a string, but when it comes to compress/gzip I am lost.Should I create an io.writer, which writes to a buf (byte slice), use gzip.NewWriter(io.writer) to get a w *gzip.Writer and then use w.Write(chunk_of_file) to write the chunk of file to buf? Then I would need to treat the string as a byte slice. <code> ",How can I use gzip on a string?
how can I use gzip on a string in golang?," I want to use Go to read out a chunk from a file, treat it as a string and gzip this chunk. I know how to read from the file and treat it as a string, but when it comes to compress/gzip I am lost.Should I create an io.writer, which writes to a buf (byte slice), use gzip.NewWriter(io.writer) to get a w *gzip.Writer and then use w.Write(chunk_of_file) to write the chunk of file to buf? Then I would need to treat the string as a byte slice. <code> ",How can I use gzip on a string?
"Golang, Go : convert string to float number"," http://play.golang.org/p/7kR2uZlV5-This is my playground link.I have an array of numbers but in string. I tried to convert them to float number but it does not give me anything. What is wrong with it?  <code>  var numbers []float64for _, elem := range str_numbers { i, err := strconv.ParseFloat(elem, 64) if err != nil { numbers = append(numbers, i) }}fmt.Println(numbers) // this gives me nothing []",How to convert string to float number
Golang : convert uint8 to int," http://play.golang.org/p/BoZkHC8_uAI want to convert uint8 to string but can't figure out how. This gives me prog.go:11: cannot use str[1] (type uint8) as type int in function argument [process exited with non-zero status]Any idea? <code>  package main import ""fmt"" import ""strconv"" func main() { str := ""Hello"" fmt.Println(str[1]) // 101 fmt.Println(strconv.Itoa(str[1])) }",How to convert uint8 to string
Golang : convert uint8 to string," http://play.golang.org/p/BoZkHC8_uAI want to convert uint8 to string but can't figure out how. This gives me prog.go:11: cannot use str[1] (type uint8) as type int in function argument [process exited with non-zero status]Any idea? <code>  package main import ""fmt"" import ""strconv"" func main() { str := ""Hello"" fmt.Println(str[1]) // 101 fmt.Println(strconv.Itoa(str[1])) }",How to convert uint8 to string
How to decode to utf-8 a []byte content that gives an error when unmarshaling," I'm making a request to an API, which with I get a []byte out of the response (ioutil.ReadAll(resp.Body)). I'm trying to unmarshal this content, but seems to be not encoded on utf-8 format, as unmarshal returns an error. I'm trying this to do so: I get as an error that invalid character '\x1f' looking for beginning of value. For the record, the response includes in the header that Content-Type:[application/json; charset=utf-8]. How can I decode content to avoid these invalid characters when unmarshaling?EditThis is the hexdump of content: play.golang.org/p/oJ5mqERAmj  <code>  package mainimport ( ""encoding/json"" ""fmt"" ""some/api"")func main() { content := api.SomeAPI.SomeRequest() // []byte variable var data interface{} err := json.Unmarshal(content, &data) if err != nil { panic(err.Error()) } fmt.Println(""Data from response"", data)}",How to decompress a []byte content in gzip format that gives an error when unmarshaling
Golang : convert integer to float number, How do I convert an integer value to float64 type?I tried But this does not work. And can't find any package that does this on Golang.orgHow do I get float64 values from integer values? <code>  float(integer_value),Convert an integer to a float number
Convert an integer to a float number in Golang, How do I convert an integer value to float64 type?I tried But this does not work. And can't find any package that does this on Golang.orgHow do I get float64 values from integer values? <code>  float(integer_value),Convert an integer to a float number
"Go, Golang : access string as character value"," http://play.golang.org/p/ZsALO8oF3WI want to traverse a string and return the character values. How do I, not return the numeric values per each letter, and return the actual characters?Now I am getting this My desired output would be Thanks, <code>  0 72 72 1 101 101 2 108 108 3 108 108 4 111 111 0 h h 1 e e 2 l l 3 l l 4 o o package main import ""fmt"" func main() { str := ""Hello"" for i, elem := range str { fmt.Println(i, str[i], elem) } for elem := range str { fmt.Println(elem) } }",How to access string as character value
"Golang, Ruby : Golang supports ... arguments"," I wonder if there a way where I can define a function for unknown number of variables in Go.Something like this I want to generalize the function Add for any number of inputs. <code>  func Add(num1... int) int { return args}func main() { fmt.Println(""Hello, playground"") fmt.Println(Add(1, 3, 4, 5,))}",Does Golang support variadic function?
Does Golang support ... arguments?," I wonder if there a way where I can define a function for unknown number of variables in Go.Something like this I want to generalize the function Add for any number of inputs. <code>  func Add(num1... int) int { return args}func main() { fmt.Println(""Hello, playground"") fmt.Println(Add(1, 3, 4, 5,))}",Does Golang support variadic function?
Golang Go : reverse array," http://play.golang.org/p/W70J4GU7nA It is hard to understand what it means in func Reverse(data Interface) Interface .How do I reverse an array? I do not need to sort. <code>  s := []int{5, 2, 6, 3, 1, 4} sort.Reverse(sort.IntSlice(s)) fmt.Println(s) // 5, 2, 6, 3, 1, 4",How do I reverse an array in Go?
unnormal quit with exec in golang," I found a strange problem in golang.The program executed by exec.Start() will quit if the parent program is interrupt by the signal os.Interrupt,while the child program will NOT quit if the parent program exit normally.What's the difference between that two conditions? For examples: In the later condition the parent of sleep 100000 will be the init process after 20s if we didn't interrupt the main program. <code>  package mainimport ""fmt""import ""os""import ""time""import ""os/exec""func main(){ cmd := exec.Command(""sleep"", ""100000"") cmd.Env = os.Environ() fmt.Println(cmd.Env) cmd.Start() time.Sleep(1e9*20) return} ",Why process created by exec.Start() quits if its parent is killed by SIGINT?
"Make ""application/x-www-form-urlencoded"" POST requests using `http.NewRequest(...)`"," I want to make a POST request to an API sending my data as a application/x-www-form-urlencoded content type. Due to the fact that I need to manage the request headers, I'm using the http.NewRequest(method, urlStr string, body io.Reader) method to create a request. For this POST request I append my data query to the URL and leave the body empty, something like this: As I response, I get always a 400 BAD REQUEST. I believe the problem relies on my request and the API does not understand which payload I am posting. I'm aware of methods like Request.ParseForm, not really sure how to use it in this context though. Maybe am I missing some further Header, maybe is there a better way to send payload as a application/json type using the body parameter? <code>  package mainimport ( ""bytes"" ""fmt"" ""net/http"" ""net/url"" ""strconv"")func main() { apiUrl := ""https://api.com"" resource := ""/user/"" data := url.Values{} data.Set(""name"", ""foo"") data.Add(""surname"", ""bar"") u, _ := url.ParseRequestURI(apiUrl) u.Path = resource u.RawQuery = data.Encode() urlStr := fmt.Sprintf(""%v"", u) // ""https://api.com/user/?name=foo&surname=bar"" client := &http.Client{} r, _ := http.NewRequest(""POST"", urlStr, nil) r.Header.Add(""Authorization"", ""auth_token=\""XXXXXXX\"""") r.Header.Add(""Content-Type"", ""application/x-www-form-urlencoded"") r.Header.Add(""Content-Length"", strconv.Itoa(len(data.Encode()))) resp, _ := client.Do(r) fmt.Println(resp.Status)}",Make a URL-encoded POST request using `http.NewRequest(...)`
"Golang, Go : what is rune by the way?"," What is a rune in Go?I've been googling but Golang only says in one line: rune is an alias for int32.But how come integers are used all around like swapping cases?The following is a function swapcase.What is all the <= and -?And why doesn't switch have any arguments? && should mean and but what is r <= 'z'? Most of them are from http://play.golang.org/p/H6wjLZj6lW I understand this is mapping rune to string so that it can return the swapped string. But I do not understand how exactly rune or byte works here. <code>  func SwapRune(r rune) rune { switch { case 'a' <= r && r <= 'z': return r - 'a' + 'A' case 'A' <= r && r <= 'Z': return r - 'A' + 'a' default: return r }} func SwapCase(str string) string { return strings.Map(SwapRune, str)}",What is a rune?
In Go find all matches in array in golang," I have an array of structs (struct detailed at bottom)I want to find all the structs that match certain values for, example, leg and site.So if leg=101 and site=1024A give back all the structs that match these criteria.What is the Go manner for doing this? <code>  type JanusDepth struct { dataset string ob string leg string site string hole string age float64 depth float64 long float64 lat float64}",Find all matches in Go array
nested struct intialization literals," How can I do this: ... Compiling that gives me: ""unknown B field 'MemberA' in struct literal""How can I initialize MemberA (from the ""parent"" struct) when I provide literal struct member values like this? <code>  type A struct { MemberA string}type B struct { A A MemberB string} b := B { MemberA: ""test1"", MemberB: ""test2"",}fmt.Printf(""%+v\n"", b)",nested struct initialization literals
nested struct initialization literals," How can I do this: ... Compiling that gives me: ""unknown B field 'MemberA' in struct literal""How can I initialize MemberA (from the ""parent"" struct) when I provide literal struct member values like this? <code>  type A struct { MemberA string}type B struct { A A MemberB string} b := B { MemberA: ""test1"", MemberB: ""test2"",}fmt.Printf(""%+v\n"", b)",nested struct initialization literals
Struct literals with embedded field," How can I do this: ... Compiling that gives me: ""unknown B field 'MemberA' in struct literal""How can I initialize MemberA (from the ""parent"" struct) when I provide literal struct member values like this? <code>  type A struct { MemberA string}type B struct { A A MemberB string} b := B { MemberA: ""test1"", MemberB: ""test2"",}fmt.Printf(""%+v\n"", b)",nested struct initialization literals
Golang : from []bytes to get hexadecimal," http://play.golang.org/p/SKtaPFtnKO All I need is Hash-key string that is converted from an input string. I was able to get it in bytes format usting h.Sum(nil) and able to print out the Hash-key in %x format. But I want to return the %x format from this function so that I can use it to convert email address to Hash-key and use it to access Gravatar.com.How do I get %x format Hash-key using md5 function in Go?Thanks, <code>  func md(str string) []byte { h := md5.New() io.WriteString(h, str) fmt.Printf(""%x"", h.Sum(nil)) // base 16, with lower-case letters for a-f return h.Sum(nil)}",How to go from []bytes to get hexadecimal
Golang: Why can I type alias functions and use them without casting?," In Go, if you define a new type e.g.: You can't then pass a MyInt to a function expecting an int, or vice versa: Fine. But why is it then that the same does not apply to functions? e.g.: Now, I'm not complaining because it saves me having to explicitly cast newfunc to type MyFunc, as I would have to do in the first example; it just seems inconsistent. I'm sure there is a good reason for it; can anyone enlighten me?The reason I ask is mainly because I would like to shorten some of my rather long function types in this way, but I want to make sure it's expected and acceptable to do this :) <code>  type MyInt int func test(i MyInt) { //do something with i}func main() { anInt := 0 test(anInt) //doesn't work, int is not of type MyInt} type MyFunc func(i int)func (m MyFunc) Run(i int) { m(i)}func run(f MyFunc, i int) { f.Run(i)}func main() { var newfunc func(int) //explicit declaration newfunc = func(i int) { fmt.Println(i) } run(newfunc, 10) //works just fine, even though types seem to differ}",Why can I type alias functions and use them without casting?
How to find the difference between two slices of strings in Golang?," Here is my desired outcome I am looking for the difference between the two string slices! <code>  slice1 := []string{""foo"", ""bar"",""hello""}slice2 := []string{""foo"", ""bar""}difference(slice1, slice2)=> [""hello""]",How to find the difference between two slices of strings
How to unit test Google App Engine Go HTTP handlers?, Local unit testing is supported from version 1.8.6 of the Google App Engine Go SDK. The appengine/aetest package allows me to create a Context to unit test with.How can I use this with net/http/httptest to test my HTTP handlers? <code> ,How can I unit test Google App Engine Go HTTP handlers?
golang template - how to render templates?, One layout template with three children templates.layout.html tags.html content.html comment.html gocode I am confused that how to render each children template and combine the result to layout output.Thanks. <code>  <html>,Golang template - how to render templates?
Go(lang): Implementing a cron / executing tasks at a specific time," I have been looking around for examples on how to implement a function that allows you to execute tasks at a certain time in Go, but I couldn't find anything.I implemented one myself and I am sharing it in the answers, so other people can have a reference for their own implementation. <code> ",Golang: Implementing a cron / executing tasks at a specific time
Unmarshaling json in Golang: required field?, Is it possible to generate an error if a field was not found while parsing a JSON input using Go?I could not find it in documentation.Is there any tag that specifies the field as required? <code> ,Unmarshaling json in Go: required field?
Unmarshaling JSON: required field?, Is it possible to generate an error if a field was not found while parsing a JSON input using Go?I could not find it in documentation.Is there any tag that specifies the field as required? <code> ,Unmarshaling json in Go: required field?
Why should I use log.Println istead of fmt.Println?," From log.go (the implementation of the log package) : log.Println is just a function wrapper for fmt.Sprintln , why should I use it instead of fmt.Println or fmt.Sprintln ?Any practical reasons ? <code>  167 // Println calls l.Output to print to the logger.168 // Arguments are handled in the manner of fmt.Println.169 func (l *Logger) Println(v ...interface{}) { l.Output(2, fmt.Sprintln(v...)) }",Why should I use log.Println instead of fmt.Println?
Strange behaviour of go lang udp server," I wrote a simple UDP server in go. When I do go run udp.go it prints all packages I send to it. But when running go run udp.go > out it stops passing stdout to the out file when the client stops.The client is simple program that sends 10k requests. So in the file I have around 50% of sent packages. When I run the client again, the out file grows again until the client script finishes.Server code: And here is the client code: <code>  package mainimport ( ""net"" ""fmt"")func main() { addr, _ := net.ResolveUDPAddr(""udp"", "":2000"") sock, _ := net.ListenUDP(""udp"", addr) i := 0 for { i++ buf := make([]byte, 1024) rlen, _, err := sock.ReadFromUDP(buf) if err != nil { fmt.Println(err) } fmt.Println(string(buf[0:rlen])) fmt.Println(i) //go handlePacket(buf, rlen) }} package mainimport ( ""net"" ""fmt"")func main() { num := 0 for i := 0; i < 100; i++ { for j := 0; j < 100; j++ { num++ con, _ := net.Dial(""udp"", ""127.0.0.1:2000"") fmt.Println(num) buf := []byte(""bla bla bla I am the packet"") _, err := con.Write(buf) if err != nil { fmt.Println(err) } } }}",Strange behaviour of golang UDP server
When should I use concurrency in golang?, So besides handling multiple server requests is there any other time that concurrency is relevant? I ask because it's so built into the language that I feel wasteful if I don't use it but I can barely find a use for it. <code> ,When should I use concurrency in Go?
How see stack trace of test code of Go program?," I use Go's native test facility (go test) to write a test. But when the test fails due to a bug in test code, I really can't debug it due to lack of stack trace or any other contextual informations.And even, the test code needs one contextual object t, so it is not simple work running the test code in normal mode.What is the best practice to debug test code? <code> ",How to see stack trace of test code of Go program?
"Go, Golang : why can't range over *[]Struct?"," http://play.golang.org/p/jdWZ9boyrhI am getting this error when my function tries to receive structure array.What does it mean by an unnamed type? Why can't it be named? I can name it outside function and also pass them as arguments with them being named.It does not work. So I just passed []Sentence as an argument and solve the problem that I need to. But when passing them as arguments, I had to return a new copy.I still think that it would be nice if I can just let the function receive the struct array and does not have to return anything.Like below: It is not working either with []Sentence.Is there anyway that I can make a function receive Struct array? <code>  prog.go:29: invalid receiver type *[]Sentence ([]Sentence is an unnamed type) prog.go:30: cannot range over S (type *[]Sentence) [process exited with non-zero status] func (S *[]Sentence)MarkC() { for _, elem := range S { elem.mark = ""C"" }}var arrayC []Sentencefor i:=0; i<5; i++ { var new_st Sentence new_st.index = i arrayC = append(arrayC, new_st)}//MarkC(arrayC)//fmt.Println(arrayC)//Expecting [{0 C} {1 C} {2 C} {3 C} {4 C}] //but not working ",Why can't range over *[]Struct?
Why go-lang doesn't show memory-reordering?," I'm reading preshing's blog Memory Reordering Caught in the Act, and reproduced memory-reordering by his example codeThen I wonder if I could reproduce memory-reordering by Go, so I wrote the example code in go, but memory-reordering is not shown in Go. I'm writing to share some findings. And could you help explain why Go could not get memory-reordering? Thanks.Example code in Go: The assembly code (by ""ndisasm -b 32"") show different between C++ vs GoAssembly code from C++ Assembly code from Go it seems Go uses dec eax around access of shared memory, but it make no sense that dec eax can prevent memory-reorderingThe Intel 64 and IA-32 Architectures Software Developer Manuals Volume 3, Section 8.2 shows the cases that could prevent memory-reordering, but dec eax isn't included...I tried to add dec eax as margin of shared-memory-access in C code, and memory-reordering is still there.By now, I have no clue about the reason. Please help me on it, thank you. <code>  package main import ( ""fmt"" ""math/rand"" ) var x, y, r1, r2 int var detected = 0 func randWait() { for rand.Intn(8) != 0 { } } func main() { beginSig1 := make(chan bool, 1) beginSig2 := make(chan bool, 1) endSig1 := make(chan bool, 1) endSig2 := make(chan bool, 1) go func() { for { <-beginSig1 randWait() x = 1 r1 = y endSig1 <- true } }() go func() { for { <-beginSig2 randWait() y = 1 r2 = x endSig2 <- true } }() for i := 1; ; i = i + 1 { x = 0 y = 0 beginSig1 <- true beginSig2 <- true <-endSig1 <-endSig2 if r1 == 0 && r2 == 0 { detected = detected + 1 fmt.Println(detected, ""reorders detected after "", i, ""iterations"") } } } 00000CF0 C705520300000100 mov dword [0x352],0x1 //X=1 -000000000CFA 8B0550030000 mov eax,[0x350] 00000D00 89054E030000 mov [0x34e],eax //r1=Y 000013EA 48 dec eax000013EB C70425787F170001 mov dword [0x177f78],0x1 //x=1 -000000000013F6 48 dec eax000013F7 8B1C25807F1700 mov ebx,[0x177f80]000013FE 48 dec eax000013FF 891C25687F1700 mov [0x177f68],ebx //r1=Y00001406 48 dec eax",Why Go doesn't show memory-reordering?
Golang: returning from defer," I want to return an error from a function if it panics (in Go): I appear to have misunderstood the very concept of panic and defer. Can anybody enlighten me? <code>  func getReport(filename string) (rep report, err error) { rep.data = make(map[string]float64) defer func() { if r := recover(); r != nil { fmt.Println(""Recovered in f"", r) err, _ = r.(error) return nil, err } }() panic(""Report format not recognized."") // rest of the getReport function, which can try to out-of-bound-access a slice ...} ",Go: returning from defer
golang closure variable scope, I'm reading 'CreateSpace An Introduction to Programming in Go 2012'and on page 86 I found this evil magic 1) Why is i not resetting ?2) is nextEven() returning and uint or is Println so smart that it can work with everything ? <code>  func makeEvenGenerator() func() uint { i := uint(0) return func() (ret uint) { ret = i i += 2 return }}// here's how it's callednextEven := makeEvenGenerator()fmt.Println(nextEven())fmt.Println(nextEven())fmt.Println(nextEven()),Go closure variable scope
Go/Golang write log to file," I'm trying to write to a log file with Go.I have tried several approaches, all of which have failed. This is what I have tried: The log file gets created, but nothing ever gets printed or appended to it. Why? <code>  func TestLogging(t *testing.T) { if !FileExists(""logfile"") { CreateFile(""logfile"") } f, err := os.Open(""logfile"") if err != nil { t.Fatalf(""error: %v"", err) } // attempt #1 log.SetOutput(io.MultiWriter(os.Stderr, f)) log.Println(""hello, logfile"") // attempt #2 log.SetOutput(io.Writer(f)) log.Println(""hello, logfile"") // attempt #3 log.SetOutput(f) log.Println(""hello, logfile"")}func FileExists(name string) bool { if _, err := os.Stat(name); err != nil { if os.IsNotExist(err) { return false } } return true}func CreateFile(name string) error { fo, err := os.Create(name) if err != nil { return err } defer func() { fo.Close() }() return nil}",How to write log to file
Dumping MySQL tables to JSON with GoLang," Was putting together a quick dumper for MySQL to JSON in Go. However I find that everything that I retrieve from the database is a []byte array. Thus instead of native JSON integers or booleans, I'm getting everything encoded as strings.Subset of the code: <code>  import ( ""encoding/json"" ""database/sql"" _ ""github.com/go-sql-driver/mysql"")func dumpTable(w io.Writer, table) { // ... rows, err := Query(db, fmt.Sprintf(""SELECT * FROM %s"", table)) checkError(err) columns, err := rows.Columns() checkError(err) scanArgs := make([]interface{}, len(columns)) values := make([]interface{}, len(columns)) for i := range values { scanArgs[i] = &values[i] } for rows.Next() { err = rows.Scan(scanArgs...) checkError(err) record := make(map[string]interface{}) for i, col := range values { if col != nil { fmt.Printf(""\n%s: type= %s\n"", columns[i], reflect.TypeOf(col)) switch t := col.(type) { default: fmt.Printf(""Unexpected type %T\n"", t) case bool: fmt.Printf(""bool\n"") record[columns[i]] = col.(bool) case int: fmt.Printf(""int\n"") record[columns[i]] = col.(int) case int64: fmt.Printf(""int64\n"") record[columns[i]] = col.(int64) case float64: fmt.Printf(""float64\n"") record[columns[i]] = col.(float64) case string: fmt.Printf(""string\n"") record[columns[i]] = col.(string) case []byte: // -- all cases go HERE! fmt.Printf(""[]byte\n"") record[columns[i]] = string(col.([]byte)) case time.Time: // record[columns[i]] = col.(string) } } } s, _ := json.Marshal(record) w.Write(s) io.WriteString(w, ""\n"") }}",Dumping MySQL tables to JSON with Golang
Proper package naming for testing in Go Lang," I have seen several different test package naming strategies within Go and wanted to know what pros and cons of each are and which one I should use.Strategy 1:File name: github.com/user/myfunc.go Test file name: github.com/user/myfunc_test.go See bzip2 for an example.Strategy 2:File name: github.com/user/myfunc.go Test file name: github.com/user/myfunc_test.go See wire for an example.Strategy 3:File name: github.com/user/myfunc.go Test file name: github.com/user/myfunc_test.go See strings for an example.The Go standard library seems to use a mixture of strategy 1 and 2. Which of all three should I use? It's a pain appending package *_test to my testing packages as it means I can't test my package private methods but maybe there is a hidden advantage I am not aware of?  <code>  package myfunc package myfunc package myfunc package myfunc_testimport ( ""github.com/user/myfunc"") package myfunc package myfunc_testimport ( . ""myfunc"")",Proper package naming for testing with the Go language
Proper package naming for testing in Golang," I have seen several different test package naming strategies within Go and wanted to know what pros and cons of each are and which one I should use.Strategy 1:File name: github.com/user/myfunc.go Test file name: github.com/user/myfunc_test.go See bzip2 for an example.Strategy 2:File name: github.com/user/myfunc.go Test file name: github.com/user/myfunc_test.go See wire for an example.Strategy 3:File name: github.com/user/myfunc.go Test file name: github.com/user/myfunc_test.go See strings for an example.The Go standard library seems to use a mixture of strategy 1 and 2. Which of all three should I use? It's a pain appending package *_test to my testing packages as it means I can't test my package private methods but maybe there is a hidden advantage I am not aware of?  <code>  package myfunc package myfunc package myfunc package myfunc_testimport ( ""github.com/user/myfunc"") package myfunc package myfunc_testimport ( . ""myfunc"")",Proper package naming for testing with the Go language
Go: check if interface specifies method using reflection," I want to reflect to determine whether or not a Go interface contains certain method signatures. I've dynamically got the names and signatures, previously through reflection on a struct. Here's a simplified example: http://play.golang.org/p/Uaidml8KMV. Thanks for your help! <code>  package mainimport ""reflect""func main() { type Mover interface { TurnLeft() bool // TurnRight is missing. } // How would I check whether TurnRight() bool is specified in Mover? reflect.TypeOf(Mover).MethodByName(""TurnRight"") // would suffice, but // fails because you can't instantiate an interface}",How to check if interface specifies method using reflection
How to find a type of a object in golang?," How do I find the type of an object in Go? In Python, I just use typeof to fetch the type of object. Similarly in Go, is there a way to implement the same ?Here is the container from which I am iterating: I am not able to get the type of the object lines in this case which is an array of strings. <code>  for e := dlist.Front(); e != nil; e = e.Next() { lines := e.Value fmt.Printf(reflect.TypeOf(lines))}",How to find the type of an object in Go?
How to find a type of a object in Golang?," How do I find the type of an object in Go? In Python, I just use typeof to fetch the type of object. Similarly in Go, is there a way to implement the same ?Here is the container from which I am iterating: I am not able to get the type of the object lines in this case which is an array of strings. <code>  for e := dlist.Front(); e != nil; e = e.Next() { lines := e.Value fmt.Printf(reflect.TypeOf(lines))}",How to find the type of an object in Go?
How to find a type of an object in Golang?," How do I find the type of an object in Go? In Python, I just use typeof to fetch the type of object. Similarly in Go, is there a way to implement the same ?Here is the container from which I am iterating: I am not able to get the type of the object lines in this case which is an array of strings. <code>  for e := dlist.Front(); e != nil; e = e.Next() { lines := e.Value fmt.Printf(reflect.TypeOf(lines))}",How to find the type of an object in Go?
How to find a type of an object in Go?," How do I find the type of an object in Go? In Python, I just use typeof to fetch the type of object. Similarly in Go, is there a way to implement the same ?Here is the container from which I am iterating: I am not able to get the type of the object lines in this case which is an array of strings. <code>  for e := dlist.Front(); e != nil; e = e.Next() { lines := e.Value fmt.Printf(reflect.TypeOf(lines))}",How to find the type of an object in Go?
golang range references instead values," I saw that range returns the key and the ""copy"" of the value. Is there a way for that range to return the adress of the item? Example http://play.golang.org/p/AFOGG9NGpxHere ""field"" is not modified because range sends the copy of field,Do I have to use index or is there any other way to modify the value? <code>  package mainimport ""fmt""type MyType struct { field string}func main() { var array [10]MyType for _, e := range array { e.field = ""foo"" } for _, e := range array { fmt.Println(e.field) fmt.Println(""--"") }}",Range references instead values
golang POST data using the Content-Type multipart/form-data," I'm trying to upload images from my computer to a website using go. Usually, I use a bash script that sends a file and a key to the server: it works fine, but I'm trying to convert this request into my golang program. http://matt.aimonetti.net/posts/2013/07/01/golang-multipart-file-upload-example/I tried this link and many others, but, for each code that I try, the response from the server is ""no image sent"", and I've no idea why. If someone knows what's happening with the example above. <code>  curl -F ""image""=@""IMAGEFILE"" -F ""key""=""KEY"" URL",POST data using the Content-Type multipart/form-data
nil detection in Golang," I see a lot of code in Go to detect nil, like this: however, I have a struct like this: and config is an instance of Config, when I do: there is compile error, saying: cannot convert nil to type Config <code>  if err != nil { // handle the error } type Config struct { host string port float64} if config == nil {}",nil detection in Go
"Go lang x := [...]string{""Sat"", ""Sun""} vs x:= []string{""Sat"", ""Sun""}"," In the go lang spec they used three dots in one of the examples: Does it make any difference if the three dots are left out? <code>  days := [...]string{""Sat"", ""Sun""} // len(days) == 2","x := [...]string{""Sat"", ""Sun""} vs x:= []string{""Sat"", ""Sun""}"
Go lang Sql IN parameters," What does Go want for the second param in this SQL query.I am trying to use the IN lookup in postgres. What I really want: <code>  stmt, err := db.Prepare(""SELECT * FROM awesome_table WHERE id= $1 AND other_field IN $2"")rows, err := stmt.Query(10, ???) SELECT * FROM awesome_table WHERE id=10 AND other_field IN (this, that);",How to execute an IN lookup in SQL using Golang?
Non black fields in struct declaration," From the golang spec Are there any practical scenarios of using the blank _ fields inside a struct? (some code snippets would be appreciated)  <code>  // A struct with 6 fields.struct { x, y int u float32 _ float32 // padding A *[]int F func()}",Why do struct declarations sometimes contain blank fields?
Non blank fields in struct declaration," From the golang spec Are there any practical scenarios of using the blank _ fields inside a struct? (some code snippets would be appreciated)  <code>  // A struct with 6 fields.struct { x, y int u float32 _ float32 // padding A *[]int F func()}",Why do struct declarations sometimes contain blank fields?
Blank fields in struct declaration," From the golang spec Are there any practical scenarios of using the blank _ fields inside a struct? (some code snippets would be appreciated)  <code>  // A struct with 6 fields.struct { x, y int u float32 _ float32 // padding A *[]int F func()}",Why do struct declarations sometimes contain blank fields?
"Blank fields in struct declaration, Why they exist?"," From the golang spec Are there any practical scenarios of using the blank _ fields inside a struct? (some code snippets would be appreciated)  <code>  // A struct with 6 fields.struct { x, y int u float32 _ float32 // padding A *[]int F func()}",Why do struct declarations sometimes contain blank fields?
Remove invalid UTF-8 characters from a string (Go lang)," I get this on json.Marshal of a list of strings: The reason is obvious, but how can I delete/replace such strings in Go? I've been reading docst on unicode and unicode/utf8 packages and there seems no obvious/quick way to do it.In Python for example you have methods for it where the invalid characters can be deleted, replaced by a specified character or strict setting which raises exception on invalid chars. How can I do equivalent thing in Go?UPDATE: I meant the reason for getting an exception (panic?) - illegal char in what json.Marshal expects to be valid UTF-8 string.(how the illegal byte sequence got into that string is not important, the usual way - bugs, file corruption, other programs that do not conform to unicode, etc) <code>  json: invalid UTF-8 in string: ""...ole\xc5\""",Remove invalid UTF-8 characters from a string
"Trying to understand this function from GO, why make a function that always run in constant time and how does this work?"," I was encounter the following function crypto/subtle package which caused me a lot curiosity, wish someone can explain the purpose behind it. Thanks, <code>  // ConstantTimeByteEq returns 1 if x == y and 0 otherwise. 27 func ConstantTimeByteEq(x, y uint8) int { 28 z := ^(x ^ y) 29 z &= z >> 4 30 z &= z >> 2 31 z &= z >> 1 32 33 return int(z) 34 }","Trying to understand this function from Go, why make a function that always run in constant time and how does this work?"
Does it make sense to have two packages in the same directory? (golang), I have a project that provides a library (exports some funcs) and also must provide a command-line interface (there must be an executable file).Example of directory structure: The go compiler needs the package main and func main to start execution. My library needs the package myproject where I put stuff on it. This is what the go tool says when I am building another project that tries to import myproject: So I believe there is no way to do it.Should I move the library or the CLI to another package? <code>  whatever.io/ myproject/ main.go myproject.go main.go:5:2: found packages myproject (myproject.go) and main (main.go) in $GOPATH/src/whatever.io/myproject,Does it make sense to have two packages in the same directory?
How to execute system command in Golang with unkown Arguments," I have a bunch of systems commands which are somwhat similar to appending new content to a file. I wrote a simple script to execute system commands, which works well if there are single words like 'ls' , 'date' etc. But if the command is greater than that, program dies.The following is the code The following is the error i see I guess, this may be due to, not sending cmds and arguments seperately ( http://golang.org/pkg/os/exec/#Command ). I am wondering how to subvert this, since I don't know how many arguments will be there in my command which needs to be executed. <code>  package mainimport ( ""fmt"" ""os/exec"" ""sync"")func exe_cmd(cmd string, wg *sync.WaitGroup) { fmt.Println(cmd) c = cmd.Str out, err := exec.Command(cmd).Output() if err != nil { fmt.Println(""error occured"") fmt.Printf(""%s"", err) } fmt.Printf(""%s"", out) wg.Done()}func main() { wg := new(sync.WaitGroup) wg.Add(3) x := []string{""echo newline >> foo.o"", ""echo newline >> f1.o"", ""echo newline >> f2.o""} go exe_cmd(x[0], wg) go exe_cmd(x[1], wg) go exe_cmd(x[2], wg) wg.Wait()} exec: ""echo newline >> foo.o"": executable file not found in $PATHexec: ""echo newline >> f2.o"": executable file not found in $PATHexec: ""echo newline >> f1.o"": executable file not found in $PATH ",How to execute system command with unknown arguments?
How to execute system command in Golang with unknown arguments," I have a bunch of systems commands which are somwhat similar to appending new content to a file. I wrote a simple script to execute system commands, which works well if there are single words like 'ls' , 'date' etc. But if the command is greater than that, program dies.The following is the code The following is the error i see I guess, this may be due to, not sending cmds and arguments seperately ( http://golang.org/pkg/os/exec/#Command ). I am wondering how to subvert this, since I don't know how many arguments will be there in my command which needs to be executed. <code>  package mainimport ( ""fmt"" ""os/exec"" ""sync"")func exe_cmd(cmd string, wg *sync.WaitGroup) { fmt.Println(cmd) c = cmd.Str out, err := exec.Command(cmd).Output() if err != nil { fmt.Println(""error occured"") fmt.Printf(""%s"", err) } fmt.Printf(""%s"", out) wg.Done()}func main() { wg := new(sync.WaitGroup) wg.Add(3) x := []string{""echo newline >> foo.o"", ""echo newline >> f1.o"", ""echo newline >> f2.o""} go exe_cmd(x[0], wg) go exe_cmd(x[1], wg) go exe_cmd(x[2], wg) wg.Wait()} exec: ""echo newline >> foo.o"": executable file not found in $PATHexec: ""echo newline >> f2.o"": executable file not found in $PATHexec: ""echo newline >> f1.o"": executable file not found in $PATH ",How to execute system command with unknown arguments?
How to execute system command with unknown arguments," I have a bunch of systems commands which are somwhat similar to appending new content to a file. I wrote a simple script to execute system commands, which works well if there are single words like 'ls' , 'date' etc. But if the command is greater than that, program dies.The following is the code The following is the error i see I guess, this may be due to, not sending cmds and arguments seperately ( http://golang.org/pkg/os/exec/#Command ). I am wondering how to subvert this, since I don't know how many arguments will be there in my command which needs to be executed. <code>  package mainimport ( ""fmt"" ""os/exec"" ""sync"")func exe_cmd(cmd string, wg *sync.WaitGroup) { fmt.Println(cmd) c = cmd.Str out, err := exec.Command(cmd).Output() if err != nil { fmt.Println(""error occured"") fmt.Printf(""%s"", err) } fmt.Printf(""%s"", out) wg.Done()}func main() { wg := new(sync.WaitGroup) wg.Add(3) x := []string{""echo newline >> foo.o"", ""echo newline >> f1.o"", ""echo newline >> f2.o""} go exe_cmd(x[0], wg) go exe_cmd(x[1], wg) go exe_cmd(x[2], wg) wg.Wait()} exec: ""echo newline >> foo.o"": executable file not found in $PATHexec: ""echo newline >> f2.o"": executable file not found in $PATHexec: ""echo newline >> f1.o"": executable file not found in $PATH ",How to execute system command with unknown arguments?
Need clarification about dynamic types in golang," Considering the fact that go is statically typed language, What is the meaning of a dynamic type of some value ? <code> ",What is the meaning of a dynamic type of some value in go?
Delete Entries from a Slice While Iterating Over it in Go," What is the best way to remove items from a slice while ranging over it?For example: <code>  type MultiDataPoint []*DataPointfunc (m MultiDataPoint) Json() ([]byte, error) { for i, d := range m { err := d.clean() if ( err != nil ) { //Remove the DP from m } } return json.Marshal(m)}",How to remove items from a slice while ranging over it?
Decipher golang garbage collection output," I was running a sample program program using Help me understand the first part i.e. 0 + 0 + 0 => Mark + Sweep + Clean timesDoes 422 -> 346 means that there has been memory cleanup from 422MB to 346 MB? If yes, then how come the memory is been reduced when there was nothing to be cleaned up?  <code>  rahul@g3ck0:~/programs/Remodel$ GOGCTRACE=1 go run main.go gc1(1): 0+0+0 ms 0 -> 0 MB 422 -> 346 (422-76) objects 0 handoffgc2(1): 0+0+0 ms 0 -> 0 MB 2791 -> 1664 (2867-1203) objects 0 handoffgc3(1): 0+0+0 ms 1 -> 0 MB 4576 -> 2632 (5779-3147) objects 0 handoffgc4(1): 0+0+0 ms 1 -> 0 MB 3380 -> 2771 (6527-3756) objects 0 handoffgc5(1): 0+0+0 ms 1 -> 0 MB 3511 -> 2915 (7267-4352) objects 0 handoffgc6(1): 0+0+0 ms 1 -> 0 MB 6573 -> 2792 (10925-8133) objects 0 handoffgc7(1): 0+0+0 ms 1 -> 0 MB 4859 -> 3059 (12992-9933) objects 0 handoffgc8(1): 0+0+0 ms 1 -> 0 MB 4554 -> 3358 (14487-11129) objects 0 handoffgc9(1): 0+0+0 ms 1 -> 0 MB 8633 -> 4116 (19762-15646) objects 0 handoffgc10(1): 0+0+0 ms 1 -> 0 MB 9415 -> 4769 (25061-20292) objects 0 handoffgc11(1): 0+0+0 ms 1 -> 0 MB 6636 -> 4685 (26928-22243) objects 0 handoffgc12(1): 0+0+0 ms 1 -> 0 MB 6741 -> 4802 (28984-24182) objects 0 handoffgc13(1): 0+0+0 ms 1 -> 0 MB 9654 -> 5097 (33836-28739) objects 0 handoffgc1(1): 0+0+0 ms 0 -> 0 MB 209 -> 171 (209-38) objects 0 handoff",Decipher garbage collection output
"How to properly use .Call in reflect package, Golang?"," Been having one last issue with my code which involves the .Call function in the reflect package. So I'm making a call such as this: where the method I'm making the .Call to is as follows: What I don't quite understand is how to manipulate the ""in"" variable in order to properly pass the map I need to into the function. I see that the second parameter in the make() is the length of the parameter? But I don't quite understand how to format the vars in order to properly pass in my parameter. I am recursively running into the error message: Any help would be much appreciated!  <code>  params := ""some map[string][]string""in := make([]reflect.Value,0)return_values := reflect.ValueOf(&controller_ref).MethodByName(action_name).Call(in) func (c *Controller) Root(params map[string][]string) map[string] string{} reflect: Call with too few input arguments",How to properly use .Call in reflect package
UDP server / client in Go not reading and writing data," I have written a UDP server and client in Go. I am not seeing any error messages when the server is running on port 1200, I also do not see any errors when client is trying to connect to port 1200 on the same machine (OS X 10.9.1)The server is not printing ""SOS..."", that is the message the client is writing, in a infinite loop.The client is able to send a message to the server though, however what the server is reading is 0 bytes.Server Code client code, running on same server, with command go run udp-client.go :1200 or go run udp-client.go 127.0.0.1:1200 <code>  package mainimport ( ""net"" ""fmt"" ""time"" )func main() { port := ""127.0.0.1:1200"" udpAddress, err := net.ResolveUDPAddr(""udp4"",port) if err != nil { fmt.Println(""error resolving UDP address on "", port) fmt.Println(err) return } conn ,err := net.ListenUDP(""udp"",udpAddress) if err != nil { fmt.Println(""error listening on UDP port "", port) fmt.Println(err) return } defer conn.Close() var buf []byte for { time.Sleep(100 * time.Millisecond) n,address, err := conn.ReadFromUDP(buf) if err != nil { fmt.Println(""error reading data from connection"") fmt.Println(err) return } if address != nil { fmt.Println(""got message from "", address, "" with n = "", n) if n > 0 { fmt.Println(""from address"", address, ""got message:"", string(buf[0:n]), n) } } }} package mainimport (""fmt""""net""""os""""time"")func main() { if len(os.Args) != 2{ fmt.Fprintf(os.Stderr, ""Usage:%s host:port"", os.Args[0]) os.Exit(1) } service := os.Args[1] fmt.Println(""Connecting to server at "", service) conn, err := net.Dial(""udp"",service) if err != nil { fmt.Println(""Could not resolve udp address or connect to it on "" , service) fmt.Println(err) return } fmt.Println(""Connected to server at "", service) defer conn.Close() fmt.Println(""About to write to connection"") for { time.Sleep(1000*time.Millisecond) n, err := conn.Write([]byte(""SOS ... \n"")) if err != nil { fmt.Println(""error writing data to server"", service) fmt.Println(err) return } if n > 0 { fmt.Println(""Wrote "",n, "" bytes to server at "", service) } }}",UDP server / client in Go not reading data
"What is the difference between a reugular expression quoted by ` and ""?"," Why the C:\\\\ (quoted by `) regexp does not match ""C:\\"" and ""C:\\\\"" do ? <code>  r, err := regexp.Compile(`C:\\\\`) // Not matchr, err := regexp.Compile(""C:\\\\"") // Matchesif r.MatchString(""Working on drive C:\\"") == true { fmt.Printf(""Matches."") } else { fmt.Printf(""No match."")}","What is the difference between a regular expression quoted by ` and ""?"
Paypal IPN and Golang integration," I am writing a listener for handling Paypal IPN messages and responses.From Paypal IPN requirement, The listener have to post the values received from Paypal back in the same order with a new parameter ""cmd=_notify-validate"" inserted at the front of the value list. Your listener HTTP POSTs the complete, unaltered message back to PayPal. Note: This message must contain the same fields, in the same order, as the original IPN from PayPal, all preceded by cmd=_notify-validate. Further, this message must use the same encoding as the original.However, Go's url.Values variable is implemented in map data structure which order of the value is not guaranteed to be the same when being iterated each time. ...When iterating over a map with a range loop, the iteration order is not specified and is not guaranteed to be the same from one iteration to the next"" And when url.Values encoded method is called, it will be sorted by key Encode encodes the values into URL encoded form (""bar=baz&foo=quux"") sorted by key. The listener is running on GAE thus I use ""appengine/urlfetch""'s PostForm function which takes url.Values as the second parameter As url.Values is a map, the order of values in the map are not guaranteed to be in order. How can I possibly pass the parameter values back in the same order received from Paypal IPN back to Paypal with GAE urlfetch service? <code>  c := appengine.NewContext(r)client := urlfetch.Client(c)resp, err := client.PostForm(""https://www.sandbox.paypal.com/cgi-bin/webscr"", r.Form)",Paypal IPN and Golang integration on GAE
Go Golang : anonymous struct and empty struct," http://play.golang.org/p/vhaKi5uVmm [1st Question] How and Why do we need this weird-looking struct? Is it empty struct or anonymous struct? I googled it but couldn't find the right answer or documentation to explain about this.The original source is from Andrew Gerrand's talkhttp://nf.wh3rd.net/10things/#10Here done is a channel of type struct{}So I tried with But it is not working. Why do I need an extra brackets for this line? [2nd Question] Why do I need this line? I know that this line is necessary because without this line, no output. But Why and what does this line do? And what makes it necessary in this code? I know that <-done is to receive values from the channel done and discard the received values. But why do I need to do this? <code>  package mainimport ""fmt""var battle = make(chan string)func warrior(name string, done chan struct{}) { select { case opponent := <-battle: fmt.Printf(""%s beat %s\n"", name, opponent) case battle <- name: // I lost :-( } done <- struct{}{}}func main() { done := make(chan struct{}) langs := []string{""Go"", ""C"", ""C++"", ""Java"", ""Perl"", ""Python""} for _, l := range langs { go warrior(l, done) } for _ = range langs { <-done }} done <- struct{}{} make(chan struct{}) done <- struct{} done <- struct{}{} for _ = range langs { <-done }",anonymous struct and empty struct
Golang : anonymous struct and empty struct," http://play.golang.org/p/vhaKi5uVmm [1st Question] How and Why do we need this weird-looking struct? Is it empty struct or anonymous struct? I googled it but couldn't find the right answer or documentation to explain about this.The original source is from Andrew Gerrand's talkhttp://nf.wh3rd.net/10things/#10Here done is a channel of type struct{}So I tried with But it is not working. Why do I need an extra brackets for this line? [2nd Question] Why do I need this line? I know that this line is necessary because without this line, no output. But Why and what does this line do? And what makes it necessary in this code? I know that <-done is to receive values from the channel done and discard the received values. But why do I need to do this? <code>  package mainimport ""fmt""var battle = make(chan string)func warrior(name string, done chan struct{}) { select { case opponent := <-battle: fmt.Printf(""%s beat %s\n"", name, opponent) case battle <- name: // I lost :-( } done <- struct{}{}}func main() { done := make(chan struct{}) langs := []string{""Go"", ""C"", ""C++"", ""Java"", ""Perl"", ""Python""} for _, l := range langs { go warrior(l, done) } for _ = range langs { <-done }} done <- struct{}{} make(chan struct{}) done <- struct{} done <- struct{}{} for _ = range langs { <-done }",anonymous struct and empty struct
Find character index in GoLang," I'm trying to find ""@"" string character in Go but I cannot find a way to do it. I know how to index characters like ""HELLO[1]"" which would output ""E"". However I'm trying to find index number of the found char.In Python I'd do it in following way: So chars would return ""chars"" and arefun would return ""arefun"" while using ""@"" delimeter. I've been trying to find solution for hours and I cannot seem to find proper way to do it in Golang. <code>  x = ""chars@arefun""split = x.find(""@"")chars = x[:split]arefun = x[split+1:]>>>print split5>>>print charschars>>>print arefunarefun",How to find a character index in Golang?
"GoLang: Public, Private - Upper Case, Lower Case:"," New to GoLang, coming from Delphi, C++ :First time I tried to create my own package in Go, I followed all the instructions about how to lay out the workspace, etc, but I kept on getting a compiler error: After poking around a bit I discovered that the public access modifier in Go is achieved simply by declaring a function in upper case. Great.But when I started experimenting with the container classes - List for starters, I discovered I had to declare a List reference return value like this: *list is in lower case.Same when I declared a local reference to a list - I had to use: Again, lower case for list.So, I'm confused. What is the rule? The list calls and references are obviously public, or I wouldn't be able to call/use them - so why are they in lower case? <code>  ./myPackage.go:52: undefined: myFunc func GetFactors(value *int64) *list.List {... l := list.New()","Public, Private - Upper Case, Lower Case:"
golang - net/http/pprof does't work," I have customer http service: It's does't work: return error: Thanks.edit:I think the problem is i rewrite default http server, net/http/pprof package inject http handler: the handler does not work in my code. <code>  s := &http.Server{ Addr: config.Port, Handler: Controller.Log(http.DefaultServeMux), ReadTimeout: 3 * time.Second, WriteTimeout: 3 * time.Second, } http.HandleFunc(""/exapmle/router/"", exampleFunc) err := s.ListenAndServe() if err != nil { log.Critical(err) os.Exit(1) } go tool pprof http://localhost:8201/debug/pprof/profile Failed to fetch http://localhost:8201/debug/pprof/profile?seconds=30 func init() { http.Handle(""/debug/pprof/"", http.HandlerFunc(Index)) http.Handle(""/debug/pprof/cmdline"", http.HandlerFunc(Cmdline)) http.Handle(""/debug/pprof/profile"", http.HandlerFunc(Profile)) http.Handle(""/debug/pprof/symbol"", http.HandlerFunc(Symbol))}",golang - net/http/pprof doesn't work
How to get JSON object by calling a url in Go Laguage?," I'm starting to learn Golang and I would like to know how to get a json response by calling an url, if you could give me an example it would be great in order to guide myself. <code> ",How to get JSON object by calling a url in Go Language?
"how to get a file's ctime,atime,mtime and change them use golang"," How can I get file's ctime, mtime, atime use Go and change them?In Go 1.1.2,* os.Stat can only get mtime* os.Chtimes can change mtime and atime but not ctime. <code> ","How can I get a file's ctime, atime, mtime and change them"
"How can I get a file's ctime,atime,mtime and change them using Go?"," How can I get file's ctime, mtime, atime use Go and change them?In Go 1.1.2,* os.Stat can only get mtime* os.Chtimes can change mtime and atime but not ctime. <code> ","How can I get a file's ctime, atime, mtime and change them"
"How can I get a file's ctime,atime,mtime and change them using Golang?"," How can I get file's ctime, mtime, atime use Go and change them?In Go 1.1.2,* os.Stat can only get mtime* os.Chtimes can change mtime and atime but not ctime. <code> ","How can I get a file's ctime, atime, mtime and change them"
How to read input from console line?," I would like to read standard input from the command line, but my attempts have ended with the program exiting before I'm prompted for input. I'm looking for the equivalent of Console.ReadLine() in C#.This is what I currently have: <code>  package mainimport ( ""bufio"" ""fmt"" ""os"")func main() { reader := bufio.NewReader(os.Stdin) fmt.Print(""Enter text: "") text, _ := reader.ReadString('\n') fmt.Println(text) fmt.Println(""Enter text: "") text2 := """" fmt.Scanln(text2) fmt.Println(text2) ln := """" fmt.Sscanln(""%v"", ln) fmt.Println(ln)}",How can I read from standard input in the console?
How to read from standard input in the console?," I would like to read standard input from the command line, but my attempts have ended with the program exiting before I'm prompted for input. I'm looking for the equivalent of Console.ReadLine() in C#.This is what I currently have: <code>  package mainimport ( ""bufio"" ""fmt"" ""os"")func main() { reader := bufio.NewReader(os.Stdin) fmt.Print(""Enter text: "") text, _ := reader.ReadString('\n') fmt.Println(text) fmt.Println(""Enter text: "") text2 := """" fmt.Scanln(text2) fmt.Println(text2) ln := """" fmt.Sscanln(""%v"", ln) fmt.Println(ln)}",How can I read from standard input in the console?
Date/time comparison in golang," Is there any options in doing date comparison in Go? I have to sort data based on date and time - independently. So I might allow an object that occurs within a range of dates so long as it also occurs within a range of times. In this model, I could not simply just select the oldest date, youngest time/latest date, latest time and Unix() seconds compare them. I'd really appreciate any suggestions.Ultimately, I wrote a time parsing string compare module to check if a time is within a range. However, this is not faring to well; I've got some gaping issues. I'll post that here just for fun, but I'm hoping there's a better way to time compare. So TLDR, I wrote a withinTimeRange(range, time) function but it's not working totally correctly. (In fact, mostly just the second case, where a time range crosses over days is broken. The original part worked, I just realized I'd need to account for that when making conversions to UTC from local.)If there's a better (preferably built in) way, I'd love to hear about it!NOTE:Just as an example, I solved this issue in Javascript with this function: However I really want to do this filter server-side. <code>  package mainimport ( ""strconv"" ""strings"")func tryIndex(arr []string, index int, def string) string { if index <= len(arr)-1 { return arr[index] } return def}/* * Takes two strings of format ""hh:mm:ss"" and compares them. * Takes a function to compare individual sections (split by "":""). * Note: strings can actually be formatted like ""h"", ""hh"", ""hh:m"", * ""hh:mm"", etc. Any missing parts will be added lazily. */func timeCompare(a, b string, compare func(int, int) (bool, bool)) bool { aArr := strings.Split(a, "":"") bArr := strings.Split(b, "":"") // Catches margins. if (b == a) { return true } for i := range aArr { aI, _ := strconv.Atoi(tryIndex(aArr, i, ""00"")) bI, _ := strconv.Atoi(tryIndex(bArr, i, ""00"")) res, flag := compare(aI, bI) if res { return true } else if flag { // Needed to catch case where a > b and a is the lower limit return false } } return false}func timeGreaterEqual(a, b int) (bool, bool) {return a > b, a < b}func timeLesserEqual(a, b int) (bool, bool) {return a < b, a > b}/* * Returns true for two strings formmated ""hh:mm:ss"". * Note: strings can actually be formatted like ""h"", ""hh"", ""hh:m"", * ""hh:mm"", etc. Any missing parts will be added lazily. */func withinTime(timeRange, time string) bool { rArr := strings.Split(timeRange, ""-"") if timeCompare(rArr[0], rArr[1], timeLesserEqual) { afterStart := timeCompare(rArr[0], time, timeLesserEqual) beforeEnd := timeCompare(rArr[1], time, timeGreaterEqual) return afterStart && beforeEnd } // Catch things like `timeRange := ""22:00:00-04:59:59""` which will happen // with UTC conversions from local time. // THIS IS THE BROKEN PART I BELIEVE afterStart := timeCompare(rArr[0], time, timeLesserEqual) beforeEnd := timeCompare(rArr[1], time, timeGreaterEqual) return afterStart || beforeEnd} function withinTime(start, end, time) { var s = Date.parse(""01/01/2011 ""+start); var e = Date.parse(""01/0""+(end==""24:00:00""?""2"":""1"")+""/2011 ""+(end==""24:00:00""?""00:00:00"":end)); var t = Date.parse(""01/01/2011 ""+time); return s <= t && e >= t;}",How to do date/time comparison
Golang: How to deference fields when printing?," http://play.golang.org/p/joEmjQdMaS This prints a memory address like this {0x10500168}Is there a way to make it print:{{""I want to see what is in here""}}This is mostly for debugging purposes, if I had a struct with 30 pointer fields, I didn't want to have to do a println for each of the 30 fields to see what is in it. <code>  package mainimport ""fmt""type SomeStruct struct { somePointer *somePointer}type somePointer struct { field string}func main() { fmt.Println(SomeStruct{&somePointer{""I want to see what is in here""}})}",How to dereference fields when printing?
Golang: How to dereference fields when printing?," http://play.golang.org/p/joEmjQdMaS This prints a memory address like this {0x10500168}Is there a way to make it print:{{""I want to see what is in here""}}This is mostly for debugging purposes, if I had a struct with 30 pointer fields, I didn't want to have to do a println for each of the 30 fields to see what is in it. <code>  package mainimport ""fmt""type SomeStruct struct { somePointer *somePointer}type somePointer struct { field string}func main() { fmt.Println(SomeStruct{&somePointer{""I want to see what is in here""}})}",How to dereference fields when printing?
golang reverse proxy with multiple apps," I want to serve two or more web applications running in a VM (different ports and some time in different directory under the same port) from the host machine and because I need the user to be logged before he can access those apps I can not use a static proxy like Nginx or Apache.So here is my situation : 192.168.1.1 : is the host ip 192.168.1.2 : is the VM ipInside the VM I have this : 192.168.1.2/owncloud : owncloud address 192.168.1.2:8080 : an other app 192.168.1.2:8888 : 3rd appI want to have this : 192.168.1.1/app1 --> 192.168.1.2/owncloud 192.168.1.1/app2 --> 192.168.1.2:8080 192.168.1.1/app2 --> 192.168.1.2:8888I have tried to use golang httputil.ReverseProxy to achieve this routing but with no much success:my code is based on this work : gist Edit :I have changed the vm ip address: 192.168.1.2 not 192.168.1.1 <code>  package mainimport( ""log"" ""net/url"" ""net/http"" ""net/http/httputil"")func main() { remote, err := url.Parse(""http://192.168.1.2:8080"") if err != nil { panic(err) } proxy := httputil.NewSingleHostReverseProxy(remote) http.HandleFunc(""/app2"", handler(proxy)) err = http.ListenAndServe("":80"", nil) if err != nil { panic(err) }}func handler(p *httputil.ReverseProxy) func(http.ResponseWriter, *http.Request) { return func(w http.ResponseWriter, r *http.Request) { log.Println(r.URL) r.URL.Path = ""/"" p.ServeHTTP(w, r) }}",Golang reverse proxy with multiple apps
Structs as keys in Golang maps," I was looking into using structs as keys in golang maps. A field in this struct is supposed to be a map also and this seems to go against the documentation provided here which says that only structs that have fields that can be compared with == and != can be in the fields of structs that are used as keys in maps. I however went ahead to try the following: The output was: This seems to go against the documentation as a field in the struct used as a key is a map. What do I seem to be getting wrong? <code>  package mainimport ""fmt""import ""strings""func main() { fmt.Println(""Hello, "") fmt.Println(strings.Join([]string{""obi"", ""$"", ""56""}, """")) z := make(map[string]float64) z[""obi""] = 0.003 x := &test{ name:""testing"", code:z, } a := &test{ name:""testing2"", code:z, } y := make(map[*test] string) y[x] = ""go home"" y[a] = ""come home"" for key, val := range y{ fmt.Println(key.name, key.code, val) }}type test struct{ name string code map[string]float64} Hello, obi$56testing map[obi:0.003] go hometesting2 map[obi:0.003] come home",Structs as keys in Go maps
golang - mysql Insert multiple data at once?," I know that Insert multiple data at once more efficiency: How to do that in golang? Use string splice, but it's not good. db.Prepare more safer, right? I need a function safer and efficient insert mulitple data at once. <code>  INSERT INTO test(n1, n2, n3) VALUES(v1, v2, v3),(v4, v5, v6),(v7, v8, v9); data := []map[string]string{ {""v1"":""1"", ""v2"":""1"", ""v3"":""1""}, {""v1"":""2"", ""v2"":""2"", ""v3"":""2""}, {""v1"":""3"", ""v2"":""3"", ""v3"":""3""},}//I do not want to do itfor _, v := range data { sqlStr := ""INSERT INTO test(n1, n2, n3) VALUES(?, ?, ?)"" stmt, _ := db.Prepare(sqlStr) res, _ := stmt.Exec(v[""v1""], v[""v2""], v[""v3""])} sqlStr := ""INSERT INTO test(n1, n2, n3) VALUES""for k, v := range data { if k == 0 { sqlStr += fmt.Sprintf(""(%v, %v, %v)"", v[""v1""], v[""v2""], v[""v3""]) } else { sqlStr += fmt.Sprintf("",(%v, %v, %v)"", v[""v1""], v[""v2""], v[""v3""]) } }res, _ := db.Exec(sqlStr)",How to insert multiple data at once
GOlang: Dynamic variables," I was wondering if it is possible to dynamically create variables in Go?I have provided a pseudo-code below to illustrate what I mean. I am storing the newly created variables in a slice: At the end of the loop, the slice should contain the variables: variable1, variable2...variable9 <code>  func method() { slice := make([]type) for(i=0;i<10;i++) { var variable+i=i; slice := append(slice, variablei) }}",Are dynamic variables supported?
json: cannot unmarshal string into Go value of type int64," I have struct I do json.Marshal write JSON bytes in HTML page. jQuery modifies name field in object and encodes object using jQueries JSON.stringify and jQuery posts string to Go handler.id field encoded as string.Sent: {""id"":1} Received: {""id"":""1""}Problem is that json.Unmarshal fails to unmarshal that JSON because id is not integer anymore. What is best way to handle such data? I do not wish to manually convert every field. I wish to write compact, bug free code.Quotes is not too bad. JavaScript does not work well with int64.I would like to learn the easy way to unmarshal json with string values in int64 values. <code>  type tySurvey struct { Id int64 `json:""id,omitempty""` Name string `json:""name,omitempty""`} json: cannot unmarshal string into Go value of type int64",Cannot unmarshal string into Go value of type int64
Golang declaring variables as Null*s," As per the example below, I need to get email and firstname and dateofbirth and so on as NullStrings and NullTimes as required, as my User struct is using them. How do I declare variables as NULLs <code>  package entitiesimport ( ""database/sql"" ""github.com/go-sql-driver/mysql"" ""testing"" ""time"")var ( email = sql.NullString(""mail@gmail.com"") << Does not work hashedPassword = ""password"" firstName = ""Lee"" lastName = ""Brooks"" dateOfBirth = time.Now height = 1.85 weight = 101.3)func privacyConcernedUser() *User { return &User{ Email: email, << These all complain eg: cannot use Email (type string) as type sql.NullString in field value HashedPassword: hashedPassword, FirstName: firstName, LastName: lastName, }}",Golang declaring variables as NULLs
Golang. Array of channels," I have an assignment to use arrays of channels.I do not understand. Why this does not work? <code>  package mainimport ""fmt""func run() { chann[0] <- 1}var chann = make([]chan int, 2)func main() { go run() obj := <- chann[0] fmt.Println(obj)}",Array of channels
What are generics in Go?, There's been a lot of criticism about Go recently because it doesn't have support for generics. What exactly does that mean? How would you explain that to someone coming from a dynamically typed language like Ruby where this isn't a familiar concept? <code> ,What would generics in Go be?
Decoding JSON in Golang using json.Unmarshal vs json.NewDecoder.Decode," I'm developing an API client where I need to encode a JSON payload on request and decode a JSON body from the response.I've read the source code from several libraries and from what I have seen, I have basically two possibilities for encoding and decoding a JSON string.Use json.Unmarshal passing the entire response string or using json.NewDecoder.Decode In my case, when dealing with HTTP responses that implements io.Reader, the second version seems to be require less code, but since I've seen both I wonder if there is any preference whether I should use a solution rather than the other.Moreover, the accepted answer from this question says Please use json.Decoder instead of json.Unmarshal.but it didn't mention the reason. Should I really avoid using json.Unmarshal? <code>  data, err := ioutil.ReadAll(resp.Body)if err == nil && data != nil { err = json.Unmarshal(data, value)} err = json.NewDecoder(resp.Body).Decode(value)",Decoding JSON using json.Unmarshal vs json.NewDecoder.Decode
Go - How to import a struct that is inside of other package?," I tried to learn Go but I frequently feel frustrating because some basic features that other languages has seems not working in Go. So basically, I would like to use struct type that is define in other file. I was able to use functions except struct type. In main.go, This works perfectly (and all other functions) as I expect (list is in $GOPATH). In package list, I defined struct as follow: I wanted to use this struct in other struct, so I attempted to do something like this, But unfortunately, I got error that the type LinkedList is not defined. How can I use a struct that is defined in other package? <code>  package main import ( ""list"" ) func main() { lst := list.NewList(false) lst.Insert(5) lst.Insert(7) lst.InsertAt(2, 1) lst.PrintList() } type LinkedList struct { head *node size int isFixed bool} type SomeType struct { lst *LinkedList}",How to import a struct that is inside of other package?
Golang how to escape back ticks," MySQL requires tables that shadow reserved words to be back ticked. I have a table Role which is a reserved word, but I have already put my query in back ticks so I can write it over multiple lines (this is a toy query, large ones will not fit on one line).How do I escape the back ticks?Here is my code: <code>  dbmap := db.InitDb()var roles []entities.Rolequery := ` << Difficult to see with SO's code editor widget, but here is a back tickSELECT *FROM `Role` <<< Needs escaping` << Difficult to see, but here is a back tick_, err := dbmap.Select(&roles, query, nil)if err != nil { panic(err)}fmt.Println(roles)",How to escape back ticks
Go: Import vars/consts from main in subpackage," I have a Go project at $GOPATH/dalu/myproject with the following files : main.go: subpackage/subpackage.go: Bonus (if I could):I tried something similar with more subpackages and when trying to import a subpackage in main that imports another subpackage which imports the first mentioned subpackage I get ""import cycle not allowed"" <code>  package mainimport ""dalu/myproject/subpackage""var GV string = ""World""func main() { subpackage.Hello()} package subpackageimport ( ""fmt"" ""dalu/myproject"")func Hello() { //? fmt.Println(""Hello""+GV)}",Import vars/consts from main in subpackage
What does an underscore in from of import statement means in Go," I saw this example from sqlite3 on GitHub : and cannot seem to find what the underscore in front of an import statement means. <code>  import ( ""database/sql"" ""fmt"" _ ""github.com/mattn/go-sqlite3"" ""log"" ""os"")",What does an underscore in front of an import statement mean?
What does an underscore in front of an import statement mean in Go," I saw this example from sqlite3 on GitHub : and cannot seem to find what the underscore in front of an import statement means. <code>  import ( ""database/sql"" ""fmt"" _ ""github.com/mattn/go-sqlite3"" ""log"" ""os"")",What does an underscore in front of an import statement mean?
What does an underscore in front of an import statement mean in Golang?," I saw this example from sqlite3 on GitHub : and cannot seem to find what the underscore in front of an import statement means. <code>  import ( ""database/sql"" ""fmt"" _ ""github.com/mattn/go-sqlite3"" ""log"" ""os"")",What does an underscore in front of an import statement mean?
Unmarshaling nested JSON objects in Golang," There are a few questions on the topic but none of them seem to cover my case, thus I'm creating a new one.I have JSON like the following: Is there a way to unmarshal the nested bar property and assign it directly to a struct property without creating a nested struct?The solution I'm adopting right now is the following: This is a simplified version, please ignore the verbosity. As you can see, I'd like to be able to parse and assign the value to I've seen people using a map, but that's not my case. I basically don't care about the content of foo (which is a large object), except for a few specific elements.What is the correct approach in this case? I'm not looking for weird hacks, thus if this is the way to go, I'm fine with that. <code>  {""foo"":{ ""bar"": ""1"", ""baz"": ""2"" }, ""more"": ""text""} type Foo struct { More String `json:""more""` Foo struct { Bar string `json:""bar""` Baz string `json:""baz""` } `json:""foo""` // FooBar string `json:""foo.bar""`} // FooBar string `json:""foo.bar""`",Unmarshaling nested JSON objects
Golang iterating through map in template," I am trying to display a list gym classes (Yoga, Pilates etc). For each class type there are several classes, so I want to group all the Yoga classes, and all the Pilates classes and so on.I made this function to take a slice and make a map of it The problem is now how can I iterate through it, according to http://golang.org/pkg/text/template/, you need to access it in .Key format, I don't know the keys (unless I also passed a slice of keys into the template). How do I unpack this map in my view.All I have currently is which displays something like: <code>  func groupClasses(classes []entities.Class) map[string][]entities.Class { classMap := make(map[string][]entities.Class) for _, class := range classes { classMap[class.ClassType.Name] = append(classMap[class.ClassType.Name], class) } return classMap} {{ . }} map[Pilates:[{102 PILATES ~/mobifit/video/ocen.mpg 169 40 2014-05-03 23:12:12 +0000 UTC 2014-05-03 23:12:12 +0000 UTC 1899-12-30 00:00:00 +0000 UTC {PILATES Pilates 1 2014-01-22 21:46:16 +0000 UTC} {1 leebrooks0@gmail.com password SUPERADMIN Lee Brooks {Male true} {1990-07-11 00:00:00 +0000 UTC true} {1.85 true} {88 true} 2014-01-22 21:46:16 +0000 UTC {0001-01-01 00:00:00 +0000 UTC false} {0001-01-01 00:00:00 +0000 UTC false} {0001-01-01 00:00:00 +0000 UTC false}} [{1 Mat 2014-01-22 21:46:16 +0000 UTC}]} {70 PILATES ~/mobifit/video/ocen.mpg 119 66 2014-03-31 15:12:12 +0000 UTC 2014-03-31 15:12:12 +0000 UTC 1899-12-30 00:00:00 +0000 UTC ",Iterating through map in template
List in GoLang:," I'm new to Go, and quite excited about it. But, in all the languages I've worked with extensively: Delphi, C#, C++, Python - Lists are very important because they can be dynamically resized, as opposed to arrays.In Golang, there is indeed a list.Liststruct, but I see very little documentation about it - whether in Go By Example or the three Go books that I have - Summerfield, Chisnal and Balbaert - they all spend a lot of time on arrays and slices and then skip to maps. In souce code examples I also find little or no use of list.List.It also appears that, unlike Python, Range is not supported for List - big drawback IMO. Am I missing something?Slices are certainly nice, but they still need to be based on an array with a hard coded size. That's where List comes in. Is there a way to create an array /slice in Go without a hard coded array size? Why is List ignored? <code> ",Why are lists used infrequently in Go?
Why are Lists used infrequently in GoLang:," I'm new to Go, and quite excited about it. But, in all the languages I've worked with extensively: Delphi, C#, C++, Python - Lists are very important because they can be dynamically resized, as opposed to arrays.In Golang, there is indeed a list.Liststruct, but I see very little documentation about it - whether in Go By Example or the three Go books that I have - Summerfield, Chisnal and Balbaert - they all spend a lot of time on arrays and slices and then skip to maps. In souce code examples I also find little or no use of list.List.It also appears that, unlike Python, Range is not supported for List - big drawback IMO. Am I missing something?Slices are certainly nice, but they still need to be based on an array with a hard coded size. That's where List comes in. Is there a way to create an array /slice in Go without a hard coded array size? Why is List ignored? <code> ",Why are lists used infrequently in Go?
Go (golang) - Getting an array of keys from a map," Is there any simpler/nicer way of getting a slice of keys from a map in Go?Currently I am iterating over the map and copying the keys to a slice: <code>  i := 0keys := make([]int, len(mymap))for k := range mymap { keys[i] = k i++}",Getting a slice of keys from a map
Golang - Getting a slice of keys from a map," Is there any simpler/nicer way of getting a slice of keys from a map in Go?Currently I am iterating over the map and copying the keys to a slice: <code>  i := 0keys := make([]int, len(mymap))for k := range mymap { keys[i] = k i++}",Getting a slice of keys from a map
How to dump methods of structs in golang?," The Golang ""fmt"" package has a dump method called Printf(""%+v"", anyStruct). I'm looking for any method to dump a struct and its methods too. For example: I want to check the existence of the Bar() method in an initialized instance of type Foo (not only properties).Is there any good way to do this? <code>  type Foo struct { Prop string}func (f Foo)Bar() string { return f.Prop}",How to dump methods of structs in Golang?
Is assigning a pointer atomic in golang?," Is assigning a pointer atomic in Go?Do I need to assign a pointer in a lock? Suppose I just want to assign the pointer to nil, and would like other threads to be able to see it. I know in Java we can use volatile for this, but there is no volatile in Go. <code> ",Is assigning a pointer atomic in Go?
how to interpolate a number in a string in golang," The following code Produces the following output My questionWhat should I do to interpolate a number inside a string? <code>  package mainimport ( ""fmt"")func main() { fmt.Println(say(9))}func say(num int)(total string){return fmt.Sprintf(""There are %s reasons to code!"", num)} There are %!s(int=9) reasons to code!",How to interpolate a number inside a string
HTTP Error Handler," I have a fairly quick-and-dirty error handler in my Go web app that raises a HTTP error, logs the important parts of the response and serves an error template. I'd like to remove the repetition where I'm writing something like this a few too many times in a handler: I've had a good read of the Error Handling and Go article which covers defining a custom HTTP handler type that returns a error type/struct like this (or even returning int, err instead): But I'm not sure how to retain my existing middleware functionality/wrapper that allows me to chain middleware like this: r.HandleFunc(""/route"", use(myHandler, middleware1, middleware2)) where use and my middleware look like this: From what I can figure, it'd be something like the below (which doesn't work). I'm getting an error saying cannot use m(h) (type http.Handler) as type appHandler in assignment: need type assertion. How do I resolve this whilst still keeping the middleware itself ""as is""?You can find a (simplified) playground example here: http://play.golang.org/p/Cmmo-wK2Af What am I missing and is there a better way to do this? <code>  err := doSomething()if err != nil { serverError(w, r, err, code)} type appHandler func(http.ResponseWriter, *http.Request) *appErrortype appError struct { code int Err error}// Ensures appHandler satisfies the http.Handler interfacefunc (fn appHandler) ServeHTTP(w http.ResponseWriter, r *http.Request) { if err := fn(w, r); err != nil { switch err.Code { case http.StatusNotFound: http.NotFound(w, r) case http.StatusInternalServerError: http.Error(w, ""message"", http.StatusInternalServerError) default: http.Error(w, ""message"", err.Code) } }} func use(h http.HandlerFunc, middleware ...func(http.HandlerFunc) http.HandlerFunc) http.HandlerFunc { for _, m := range middleware { h = m(h) } return h} func AntiCSRF(h http.HandlerFunc) http.HandlerFunc { return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) { // do something // h.ServeHTTP(w,r) } } r.Handle(""/route"", use(myHandler, middleware.NoCache)) // Contrived example!func use(h myHandlerType?, middleware ...func(http.Handler) http.Handler) http.Handler { for _, m := range middleware { h = m(h) } return h}func myHandler(w http.ResponseWriter, r *http.Request) *appError { // Extremely contrived example name := ""Matt"" _, err := fmt.Fprintf(w, ""Hi %s"", name) if err != nil { return &appError{500, err} } return nil}func contrivedMiddleware(h http.Handler) http.Handler { return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) { w.Header().Set(""Cache-Control"", ""max-age=0, private, must-revalidate"") w.Header().Set(""X-Accel-Expires"", ""0"") h.ServeHTTP(w, r) })}",Extending HTTP Handlers
convert interface to string in golang," I've a struct called item how could I get the field name, value and join it into a string.something like: to a string something like And I've try reflections to get convert interface to field value map so far. Am I going the right way? Cause I think there might have some better solutions. And thanks! I've got <code>  type Item struct { Limit int Skip int Fields string}item := Item { Limit: 3, Skip: 5, Fields: ""Valuie"", } item := Item { Limit: 3, Skip: 5, Fields: ""Valuie"", } ""Limit=3&Skip=5&Fields=Valuie"" m, _ = reflections.Items(data)for k, v := range m { fmt.Printf(""%s : %s\n"", k, v)} Limit : %!s(int=3)Skip : %!s(int=5)Fields : Valuie",How to provide string formatting for structs?
Usin the gofmt refactoring tool to rename a global variable," I'm experimenting the gofmt tool capabilities for refactoring go code based on this blog post, I have this trivial example: I'm trying to rename the v variable to mapplying this recipe: The code after the refactoring looks (broken) like: What am I missing here? <code>  package mainimport ( ""fmt"")var v = 12func main() { fmt.Println(v)} gofmt -r 'v -> m' -w main.go package mimport ( ""fmt"")var m = mfunc m() { m}",Using the gofmt refactoring tool to rename a global variable
Running external commands throught os/exec under other user," Using the os/exec package, I want to run an external command on a *nix OS, on behalf of another user (of course go process run under root user of another user with su privileges) I want avoid ""su"" or ""bash"" commands and make it purely with go. I made an approach using syscall.Setuid but this will change the user to the main project, I just need change the user to the external child process: <code>  func (self *Command) LoseTo(username string) { u, err := user.Lookup(username) if err != nil { fmt.Printf(""%v"", err) } uid, err := strconv.Atoi(u.Uid) if err := syscall.Setuid(uid); err != nil { fmt.Printf(""%v"", err) }}",Running external commands through os/exec under another user
"How to avoid annoying error ""declared and not used"" from golang"," I'm learning Go but I feel it is a bit annoying that when compiling, I should not leave any variable or package unused. This is really quite slowing me down. For example, I just wanted to declare a new package and plan to use it later or just uncomment some command to test. I always get the error and need to go comment all of those uses.Is there any way to avoid this kind of check in Go?  <code> ","How to avoid annoying error ""declared and not used"""
"How to avoid annoying error ""declared and not used"" from Golang"," I'm learning Go but I feel it is a bit annoying that when compiling, I should not leave any variable or package unused. This is really quite slowing me down. For example, I just wanted to declare a new package and plan to use it later or just uncomment some command to test. I always get the error and need to go comment all of those uses.Is there any way to avoid this kind of check in Go?  <code> ","How to avoid annoying error ""declared and not used"""
golang sql scan one row from a wide row," I have a table t containing a lot of columns, and my sql is like this: select * from t. Now I only want to scan one column or two from the wide returned row set. However, the sql.Scan accepts dest ...interface{} as arguments. Does it mean I have to scan everything and use only the column I needed?I know I could change the sql from select * to select my_favorite_rows, however, in this case, I have no way to change the sql. <code> ",sql: scan row(s) with unknown number of columns (select * from ...)
a simple if statement in Go," EDIT: The question essentially asks to generate prime numbers up to a certain limit. The original question follows.I want my if statement to become true if only these two conditions are met: In this case every possible number gets past these conditions, however I want only the numbers 2, 3, 5, 7, 11... basically numbers that are divisible only with themselves and by 1 to get past, with the exception being the very first '2'. How can I do this?Thanks <code>  for i := 2; i <= 10; i++ { if i%i == 0 && i%1 == 0 { } else { }}",Generating prime numbers in Go
is there a way to iterate over a range of integers in golang?," Go's range can iterate over maps and slices, but I was wondering if there is a way to iterate over a range of numbers, something like this: Or is there a way to represent range of integers in Go like how Ruby does with the class Range? <code>  for i := range [1..10] { fmt.Println(i)}",Is there a way to iterate over a range of integers?
Is there a way to iterate over a range of integers in Golang?," Go's range can iterate over maps and slices, but I was wondering if there is a way to iterate over a range of numbers, something like this: Or is there a way to represent range of integers in Go like how Ruby does with the class Range? <code>  for i := range [1..10] { fmt.Println(i)}",Is there a way to iterate over a range of integers?
Does Go's net/http support streaming the response body?," I am trying to connect to an endpoint that does http streaming of json data. I was wondering how to perform a basic request using Go's net/http package and read the response as it comes in. Currently, I am only able to read the response when the connection closes. Any insight would be greatly appreciated!Thanks!-RC <code>  resp, err := http.Get(""localhost:8080/stream"")if err != nil { ...}...// perform work while connected and getting data",How do I read a streaming response body using Golang's net/http package?
Easy way to check string is in json format in golang?," I want to create a function to receive an input string which can be string in json format or just a string. For example, something easy like following function. <code>  func checkJson(input string){ if ... input is in json ... { fmt.Println(""it's json!"") } else { fmt.Println(""it's normal string!"") }}",How to check string is in json format
define a new type of time in golang," I want to have a struct like this: But this struct will not compile, because there is no type time, isn't it?Should I alternatively use a string and insert the time / date information there? <code>  type Person struct { Name string DateJoined time}",Define a new type of time in golang
Private fields and methods a struct type," In the following test code I would like to have both mytype and the doPrivate method private, so that only members of mytype can access it, but not other types\functions in the scope of the mypackage package.Can I do this in golang? Fields size and hash as well as the doPrivate method should be encapsulated and no other type should have access to them.  <code>  package mypackagetype mytype struct { size string hash uint32}func (r *mytype) doPrivate() string { return r.size}func (r *mytype) Do() string { return doPrivate(""dsdsd"")}",Private fields and methods for a struct
how to get error message in a string in golang?," I referred this question - os.Error - string value (Golang), but that is not working in my case. In that err I need the error message that is thrown, e.g. if the parsing logic fails, it is throwing an error automatically. That is the error I need to catch. I am showing this only for example - whatever the runtime exception is, I need to catch it and pass as err in the return.How to achieve that? <code>  func (t Trans) TicketQty() (intQty int, err string) { defer func() { str := recover() if(str != nil){ err = ""an error"" } }() Qty := t.TransObject[""qty""].(map[string] interface{})[""ticket fv""].(float64) intQty = 10 return }",How to get error message in a string in golang?
Easiest way to get the machine epsilon in go (golang)," What is the easiest way to get the machine epsilon in Go? What about other aspects of floating point numbers such as precision, min exponent, max exponent, wobble, etc?I realize that there is the math/const package with the max and min for the different float types (http://golang.org/src/pkg/math/const.go), but no other information.One reason I would like to know is to verify that I've reached the maximum precision for a given calculation that the machine can do so that I don't quit to early or try longer then needed.The other is just for curiosity.ThanksEDIT:For the fun I looked up in some notes from school on how to calculate the epsilon manually for fun and here is a rough translation from c++ http://play.golang.org/p/XOXwIdNfsa enjoyEDIT:comment from below (thanks for a more idiomatic way of finding epsilon):Use epsilon := math.Nextafter(1, 2) - 1 Playground Nick Craig-Wood Mar 5 at 8:07 <code> ",Easiest way to get the machine epsilon in Go
golang floating point precision float32 vs float64," I wrote a program to demonstrate floating point error in Go: It prints: This matches the behaviour of the same program written in C (using the double type) However, if float32 is used instead, the program gets stuck in an infinite loop! If you modify the C program to use a float instead of a double, it prints Why doesn't the Go program have the same output as the C program when using float32? <code>  func main() { a := float64(0.2) a += 0.1 a -= 0.3 var i int for i = 0; a < 1.0; i++ { a += a } fmt.Printf(""After %d iterations, a = %e\n"", i, a)} After 54 iterations, a = 1.000000e+00 After 27 iterations, a = 1.600000e+00",Golang floating point precision float32 vs float64
Last item in a Golang template range," Given the template: This can output: If, however, I want to output: I'd need to know which is the last element in the range above.I can set a variable that holds the length of the array .SomeField, but that will always be 3, and the $i value above will only ever get to 2. And you can't perform arithmetic in templates from what I've seen.Is detecting the last value in a template range possible? Cheers. <code>  {{range $i, $e := .SomeField}} {{if $i}}, {{end}} $e.TheString{{end}} one, two, three one, two, and three",Last item in a template range
save an image from url to file - GO," Very new to Go (first simple project I'm working on).Question: How do I get an image from URL and then save it to my computer?Here's what I have so far: However, when I run this code, I get cannot use m (type image.Image) as type []byte in function argumentI'm assuming I have to convert image.Image (variable m) into an undefined amount of bytes? Is that the correct way to go about this? <code>  package mainimport (""fmt""""net/http""""image""""io/ioutil"")func main() { url := ""http://i.imgur.com/m1UIjW1.jpg"" // don't worry about errors response, _ := http.Get(url); defer response.Body.Close() m, _, err := image.Decode(response.Body) error := ioutil.WriteFile(""/images/asdf.jpg"", m, 0644)}",Save an image from url to file
"Convert byte array ""[]uint8"" to float64 in GoLang"," I'm trying to convert a []uint8 byte slice into a float64 in GoLang. I can't find a solution for this issue online. I've seen suggestions of converting to a string first and then to a float64 but this doesn't seem to work, it loses it's value and I end up with zeroes.Example: And it doesn't work... <code>  metric.Value, _ = strconv.ParseFloat(string(column.Value), 64)","Convert byte slice ""[]uint8"" to float64 in GoLang"
Why Does Golang Allow Compilation of Unused Function Parameters?," One of the more notable aspects of Go when coming from C is that the compiler will not build your program if there is an unused variable declared inside of it. So why, then, is this program building if there is an unused parameter declared in a function? <code>  func main() { print(computron(3, -3));}func computron(param_a int, param_b int) int { return 3 * param_a;}",Why does Go allow compilation of unused function parameters?
What does it mean for a constant to be untyped in golang?," The Go Programming Language Specification says that: Constants may be typed or untypedI am having a little doubt in my understanding.Consider this example in the spec: The spec says: constant may be given a type explicitly by a constant declaration or conversion, or implicitly when used in a variable declaration or an assignment or as an operand in an expressionBy this statement, why isn't l typed since it is clearly a constant declaration?This behaviour is clearer with another example Is the reason that f(""sarkozy"") compiles be due to this statement on Assignability in the spec? x is an untyped constant representable by a value of type T.My argument is the following:""sarkozy"" a an untyped literal.Thus ""sarkozy"" being representable by Foo means I can type coerce like this Foo(""sarkozy"") f(s) fails because s is not untyped. <code>  const l = ""hi"" // l == ""hi"" (untyped string constant)const m = string(k) // m == ""x"" (type string) type Foo stringfunc f(a Foo) {}func main() { f(""sarkozy"") const t = ""julie gayet"" f(t) s := ""hollande"" //compile error // f(s) f(Foo(s)) // ok}",What does it mean for a constant to be untyped?
operator variables in GoLong," This is might not be such a good question, since I don't know of any compiled language that supports this feature, but since Go is constantly surprising me, I'll ask it anyway:For my own practice, I am writing a little calculator program in Go. I'm wondering if there is a way I can declare and assign a variable of type ""Operator"", such that I could, for example, write: and write function like this (No, I am not asking about operator overloading.)Offhand, I don't know of any compiled language that supports such a thing (I'm not an expert in this). I did look at the docs under operators and found nothing. Can Go surprise me again?Edit: The accepted answer states that Haskell supports this, <code>  var o Operatoro = +var o1 Operatoro1 = / func DoOperation(a,b int,o Operator) int{ return a o b}",Does Go support operator type variables?
Does GoLang support operator type variables?," This is might not be such a good question, since I don't know of any compiled language that supports this feature, but since Go is constantly surprising me, I'll ask it anyway:For my own practice, I am writing a little calculator program in Go. I'm wondering if there is a way I can declare and assign a variable of type ""Operator"", such that I could, for example, write: and write function like this (No, I am not asking about operator overloading.)Offhand, I don't know of any compiled language that supports such a thing (I'm not an expert in this). I did look at the docs under operators and found nothing. Can Go surprise me again?Edit: The accepted answer states that Haskell supports this, <code>  var o Operatoro = +var o1 Operatoro1 = / func DoOperation(a,b int,o Operator) int{ return a o b}",Does Go support operator type variables?
How to trim leading and trailing white spaces of a string in golang?, Which is the effective way to trim the leading and trailing white spaces of string variable in Go? <code> ,How to trim leading and trailing white spaces of a string?
What does asterisk(*struct) notation means in golang," When I use os.Open to open a file I'm going to pass dicFile to I found the underlying code is using func NewReaderSize, but what I can not understand is rd.(*Reader). Reader is the struct type contained in package bufio. Asterisk followed by a struct is from what I see to get the value from pointer Reader, but it is not a pointer, so it does not make sense. Further more, it's using dot operator rd.(*Reader), I totally got confused. What's the meaning of this kind of usage in line 47? What kind of notation it is? <code>  // NewReaderSize returns a new Reader whose buffer has at least the specified43 // size. If the argument io.Reader is already a Reader with large enough44 // size, it returns the underlying Reader.45 func NewReaderSize(rd io.Reader, size int) *Reader {46 // Is it already a Reader?47 b, ok := rd.(*Reader)48 if ok && len(b.buf) >= size {49 return b50 }51 if size < minReadBufferSize {52 size = minReadBufferSize53 }54 r := new(Reader)55 r.reset(make([]byte, size), rd)56 return r57 } dictFile, err := os.Open(file) reader := bufio.NewReader(dictFile)",What does asterisk (*struct) notation mean in golang
For Iteration in Go Template," I'm trying to do an iteration in the template for pagination but there doesn't seem to be a way to do a for iteration.Instead of I want to do something like this Any advice? Thanks! <code>  {{range $i, $e := .aSlice}} {{range $i := 1 .. 10}} <div>{{$i}}</div>{{end}}",Iterating a range of integers in Go templates
Accessing global variables across packages in Go," I have two variables in the scope of package main, those would be these: Now, since the size of my application is starting to increase, I have decided to put each module of the website in its own package, much like a subdirectory as so: How would I go around around accessing the app and cfg global variables from other packages? Is this the wrong way to go about it? I have a feeling it is.In that case, how would I declare functions in their own namespace so I don't have to go crazy with names that are affixed with user and topic all the time. <code>  var ( app Application cfg Config) /src/github.com/Adel92/Sophie + user/ (package user) - register.go - login.go - password.go + topic/ (package topic) - ... etc - main.go (package main)",Accessing variables across packages in Go
Check if there is something to read on STDIN in golang," I need a command line utility to behave different if some string is piped into its STDIN. Here's some minimal example: This works fine if you call it like that: If test.go is called without anything on STDIN, the thing stucks at... ... waiting for EOF.What do I need to do to get this going?Thanks in advance! <code>  package main // file test.goimport ( ""fmt"" ""io/ioutil"" ""os"")func main() { bytes, _ := ioutil.ReadAll(os.Stdin) if len(bytes) > 0 { fmt.Println(""Something on STDIN: "" + string(bytes)) } else { fmt.Println(""Nothing on STDIN"") }} echo foo | go run test.go bytes, _ := ioutil.ReadAll(os.Stdin)",Check if there is something to read on STDIN in Golang
Portable way to detect different kinds of network error in Golang," I would like to identify what kind of error occurred in the network level. The only way I found was checking the error messages with a regular expression, but now I discovered that this messages can be in different languages (depending on the OS configuration), making it difficult to detect by regular expressions. Is there a better way to do it? Result: I discover the problem when testing the system in a Windows OS with Portuguese as default language.[EDIT]I found a way to do it using the OpError. Here is the checkErr function again with the new approach. If someone has a better solution I will be very glad to known it! [EDIT2]Updated after seong answer. <code>  package mainimport ( ""github.com/miekg/dns"" ""net"" ""regexp"")func main() { var c dns.Client m := new(dns.Msg) m.SetQuestion(""3com.br."", dns.TypeSOA) _, _, err := c.Exchange(m, ""ns1.3com.com.:53"") checkErr(err) m.SetQuestion(""example.com."", dns.TypeSOA) _, _, err = c.Exchange(m, ""idontexist.br.:53"") checkErr(err) m.SetQuestion(""acasadocartaocuritiba.blog.br."", dns.TypeSOA) _, _, err = c.Exchange(m, ""ns7.storedns22.in.:53"") checkErr(err)}func checkErr(err error) { if err == nil { println(""Ok"") } else if netErr, ok := err.(net.Error); ok && netErr.Timeout() { println(""Timeout"") } else if match, _ := regexp.MatchString("".*lookup.*"", err.Error()); match { println(""Unknown host"") } else if match, _ := regexp.MatchString("".*connection refused.*"", err.Error()); match { println(""Connection refused"") } else { println(""Other error"") }} $ go run neterrors.goTimeoutUnknown hostConnection refused func checkErr(err error) { if err == nil { println(""Ok"") } else if netErr, ok := err.(net.Error); ok && netErr.Timeout() { println(""Timeout"") } else if opError, ok := err.(*net.OpError); ok { if opError.Op == ""dial"" { println(""Unknown host"") } else if opError.Op == ""read"" { println(""Connection refused"") } }} func checkErr(err error) { if err == nil { println(""Ok"") return } else if netError, ok := err.(net.Error); ok && netError.Timeout() { println(""Timeout"") return } switch t := err.(type) { case *net.OpError: if t.Op == ""dial"" { println(""Unknown host"") } else if t.Op == ""read"" { println(""Connection refused"") } case syscall.Errno: if t == syscall.ECONNREFUSED { println(""Connection refused"") } }}",Portable way to detect different kinds of network error
Any difference in using an empty interface or an empty struct as a map's value in golang, I am using this construct to simulate a set I then add in all my keys and map them to nil.I've learnt that it is also possible to use Any benefits of using the empty struct versus interface{}. <code>  type MyType uint8map[MyType]interface{} map[MyType]struct{},Any difference in using an empty interface or an empty struct as a map's value?
print the Address of slice in golang," I have some experience in C and I am totally new to golang. Now in golang slice is a reference of array which contains the pointer to an array len of slice and cap of slice but this slice will also be allocated in memory and i want to print the address of that memory. But unable to do that. <code>  func learnArraySlice() { intarr := [5]int{12, 34, 55, 66, 43} slice := intarr[:] fmt.Printf(""the len is %d and cap is %d \n"", len(slice), cap(slice)) fmt.Printf(""address of slice 0x%x add of Arr 0x%x \n"", &slice, &intarr)}",How to print the memory address of a slice in Golang?
Authorization in golang," In a web service implemented in Go, I want to be able to restrict fields returned in a JSON response based on a user's role.For example I may have a currently logged in user who has a role of guest and another with the role of adminFor an admin I want json to have all the keys eg and for a guest to not have the role key eg I can currently marshal the json and it returns all fields. I need to be able to restrict it. <code>  { id: 1, name: ""John"", role: ""admin""} { id: 1, name: ""John""}","When serializing to JSON, how to omit certain fields based on a run-time condition?"
Golang Connecting to S3," Working on learning Go, and I am writing a component to manage pictures.I've been looking at the s3 library here: https://godoc.org/launchpad.net/goamz/s3#ACLIn Node, I use the Knox client and connect to my bucket like this: In the Go s3 library I see all of the functions I need to work with the s3 bucket, but I can't find the connect function - similar to this one above.So far, I've found this in the Docs: And it seems like I need to call this function: This is the EnvAuth function: In the S3 docs, I see all of the things that I need. I am just unsure about how I use the library, this is the first time I use a Go library.A guide on connecting to AWS/S3, then making a delete call would be very helpful!Many thanks :) <code>  var bucket = knox.createClient({ key: config.get('AWS_KEY'), secret: config.get('AWS_SECRET'), bucket: ""bucketName"" }); type Auth struct { AccessKey, SecretKey string } func EnvAuth() (auth Auth, err error) func EnvAuth() (auth Auth, err error) { auth.AccessKey = os.Getenv(""AWS_ACCESS_KEY_ID"") auth.SecretKey = os.Getenv(""AWS_SECRET_ACCESS_KEY"") // We fallback to EC2_ env variables if the AWS_ variants are not used. if auth.AccessKey == """" && auth.SecretKey == """" { auth.AccessKey = os.Getenv(""EC2_ACCESS_KEY"") auth.SecretKey = os.Getenv(""EC2_SECRET_KEY"") } if auth.AccessKey == """" { err = errors.New(""AWS_ACCESS_KEY_ID not found in environment"") } if auth.SecretKey == """" { err = errors.New(""AWS_SECRET_ACCESS_KEY not found in environment"") } return }",Go Connecting to S3
How to generate a random string of a fixed length in golang?," I want a random string of characters only (uppercase or lowercase), no numbers, in Go. What is the fastest and simplest way to do this? <code> ",How to generate a random string of a fixed length in Go?
Golang Resizing Images," I am using the Go resize package here: https://github.com/nfnt/resizeI am pulling an Image from S3, as such: After that, I need to resize the image: Upload the image to my S3 bucket How do I transform a data []byte to ---> image.Image and back to ----> data []byte? <code>  image_data, err := mybucket.Get(key)// this gives me data []byte new_image := resize.Resize(160, 0, original_image, resize.Lanczos3)// problem is that the original_image has to be of type image.Image err : = mybucket.Put('newpath', new_image, 'image/jpg', 'aclstring')// problem is that new image needs to be data []byte",Go Resizing Images
Using Go (Golang) to get Windows idle time (GetLastInputInfo or similar), Is there an example or method of getting a Windows system's idle time using Go? I've been looking at the documentation at the Golang site but I think I'm missing how to access (and use) the API to get system information including the idle time. <code> ,Using Golang to get Windows idle time (GetLastInputInfo or similar)
what is the advantage of using gorilla sessions custom backend?, I want to use Redis for session management.But I can't figure out what the advantage is of using Redis as a custom back-end for Gorilla sessions package over using it directly?link to the Gorilla session package: http://www.gorillatoolkit.org/pkg/sessions <code> ,What is the advantage of using Gorilla sessions custom backend?
Good or recommended way to map C struct to Go struct," i'm using cgo for developing library binding from Go.Let me consider the C struct and Go Struct as below. and this is go's struct For implementing Go function as below, what is better way to implement TranslateCCons2GoCons? My first answer is as below. are there any better way? <code>  struct cons_t { size_t type; cons_t *car; cons_t *cdr;};cons_t* parse(const char *str); type Cons struct { type int; car *Cons; cdr *Cons;} func Parse (str string) *Cons { str_ptr := C.CString(string); cons_ptr := C.parse(str_ptr); retCons := TranslateCCons2GoCons(cons_ptr); return retCons;} /*#cgoint getType(cons_t *cons) { return cons->type;}cons_t *getCar(cons_t *cons) { return cons->car;}cons_t *getCdr(cons_t *cons) { return cons->cdr;}*/func TranslateCCons2GoCons (c *C.cons_t) Cons { type := C.getType(c); car := C.getCar(c); cdr := C.getCdr(c); // drop null termination for simplicity return Cons{type, TranslateCCons2GoCons(car), TranslateCCons2GoCons(cdr)};}",Good or recommended way to translate C struct to Go struct
Are is there no XOR operator for booleans in golang?, Is there no XOR operator for booleans in golang?I was trying to do something like b1^b2 but it said it wasn't defined for booleans. <code> ,Is there no XOR operator for booleans in golang?
How to copy a map?," I'm trying to copy the contents of a map ( amap ) inside another one (aSuperMap) and then clear amap so that it can take new values on the next iteration/loop. The issue is that you can't clear the map without to clear its reference in the supermap as well. Here is some pseudo code. I've also tried some dynamic stuff but obviously it throws an error (cannot assign to nil) The question is how can I create an associative map ? In PHP I simply use aSuperMap[y][x] = aData. It seems that golang doesn't have any obvious method. If I delete delete(aMap, x) its reference from the super map is deleted as well. If I don't delete it the supermap ends up with duplicate data. Basically on each loop it gets aMap with the new value plus all the old values.  <code>  for something := range fruits{ aMap := make(map[string]aStruct) aSuperMap := make(map[string]map[string]aStruct) for x := range something{ aMap[x] = aData aSuperMap[y] = aMap delete(aMap, x) }//save aSuperMap saveASuperMap(something)} aSuperMap[y][x] = aData",How to copy a map?
How to copy a map? (golang )," I'm trying to copy the contents of a map ( amap ) inside another one (aSuperMap) and then clear amap so that it can take new values on the next iteration/loop. The issue is that you can't clear the map without to clear its reference in the supermap as well. Here is some pseudo code. I've also tried some dynamic stuff but obviously it throws an error (cannot assign to nil) The question is how can I create an associative map ? In PHP I simply use aSuperMap[y][x] = aData. It seems that golang doesn't have any obvious method. If I delete delete(aMap, x) its reference from the super map is deleted as well. If I don't delete it the supermap ends up with duplicate data. Basically on each loop it gets aMap with the new value plus all the old values.  <code>  for something := range fruits{ aMap := make(map[string]aStruct) aSuperMap := make(map[string]map[string]aStruct) for x := range something{ aMap[x] = aData aSuperMap[y] = aMap delete(aMap, x) }//save aSuperMap saveASuperMap(something)} aSuperMap[y][x] = aData",How to copy a map?
How to suppress [no test files] message on go test ./, I'm running go test ./... in the root of my project but several packages don't have any tests and report [no test files]. If I run go test ./... | grep -v 'no test files' I lose the return code from go test in case a test fails.Can I ignore packages with no tests while recursively testing everything from the root of the project? <code> ,How to suppress [no test files] message on go test
Sorting by time.Time in Golang," I am trying to sort struct in Go by its member which is of type time.Time.the structure is as follows. I have the below functions for sorting A map is defined as follows After the map gets filled with values,sorting of the map by values is done as below The problem is that the result is not sorted.Can anyone tell me what the problem is. <code>  type reviews_data struct { review_id string date time.Time score int firstname string anonymous bool review_text string title_text string rating float64 upcount int} type timeSlice []reviews_data// Forward request for lengthfunc (p timeSlice) Len() int { return len(p) }// Define comparefunc (p timeSlice) Less(i, j int) bool { return p[i].date.Before(p[j].date)}// Define swap over an arrayfunc (p timeSlice) Swap(i, j int) { p[i], p[j] = p[j], p[i] } var reviews_data_map = make(map[string]reviews_data) //Sort the map by date date_sorted_reviews := make(timeSlice, 0, len(reviews_data_map)) for _, d := range reviews_data_map { date_sorted_reviews = append(date_sorted_reviews, d) } sort.Sort(date_sorted_reviews)",How to sort by time.Time
what is the meaning of interface{} in golang?," I'm new to interfaces and trying to do SOAP request by github I don't understand the meaning of in this code: I've observed the same syntax in but don't understand what's being achieved by  <code>  Msg interface{} type Envelope struct { Body `xml:""soap:""`}type Body struct { Msg interface{}} fmt.Println interface{}",What's the meaning of interface{}?
Go: What's the meaning of interface{}?," I'm new to interfaces and trying to do SOAP request by github I don't understand the meaning of in this code: I've observed the same syntax in but don't understand what's being achieved by  <code>  Msg interface{} type Envelope struct { Body `xml:""soap:""`}type Body struct { Msg interface{}} fmt.Println interface{}",What's the meaning of interface{}?
Restrcting to Single Instance of executable with Golang, I need to only allow one instance of my Golang executable at a time. I'm not sure how to use a Global Mutex to make sure no other instances are running.This would be running on a Windows Machine. <code> ,Restricting to Single Instance of Executable with Golang
Golang: cannot type switch on non-interface value," I am playing with type assertion using the following dummy code, and I got the error: cannot type switch on non-interface valueDoes anyone know what does that mean? http://play.golang.org/p/Ti4FG0m1mc <code>  package mainimport ""fmt""import ""strconv""type Stringer interface { String() string}type Number struct { v int}func (number *Number) String() string { return strconv.Itoa(number.v)}func main() { n := &Number{1} switch v := n.(type) { case Stringer: fmt.Println(""Stringer:"", v) default: fmt.Println(""Unknown"") }}",Cannot type switch on non-interface value
Assigning a type uintptr to uint64 in GoLang, I'm trying to assign the value found in a variable of type uintptr to a uint64 variable in Go. Using gives mecannot use valFromSystem (type uintptr) as type uint64 in assignmentAnd trying gives meinvalid indirect of valFromSystem (type uintptr)Is there a way to pull the value pointed to by valFromSystem to assign to myVar? <code>  myVar = valFromSystem myVar = *valFromSystem,Assigning a type uintptr to uint64 in Golang
Is it safe to remove selected keys from Golang map within a range loop?," How can one remove selected keys from a map?Is it safe to combine delete() with range, as in the code below? https://play.golang.org/p/u1vufvEjSw <code>  package mainimport ""fmt""type Info struct { value string}func main() { table := make(map[string]*Info) for i := 0; i < 10; i++ { str := fmt.Sprintf(""%v"", i) table[str] = &Info{str} } for key, value := range table { fmt.Printf(""deleting %v=>%v\n"", key, value.value) delete(table, key) }}",Is it safe to remove selected keys from map within a range loop?
How do I create an executable from GoLang that doesn't open a command (cmd) window when run?," I created an application that I want to run invisibly in the background (no console). How do I do this?(This is for Windows, tested on Windows 7 Pro 64 bit) <code> ",How do I create an executable from Golang that doesn't open a console window when run?
How do I create an executable from Golang that doesn't open a command (cmd) window when run?," I created an application that I want to run invisibly in the background (no console). How do I do this?(This is for Windows, tested on Windows 7 Pro 64 bit) <code> ",How do I create an executable from Golang that doesn't open a console window when run?
How to make the same hashed string as node.js bcrypt with golang?," I set up a site with Node.js+passport for user authentication. Now I need to migrate to Golang, and need to do authentication with the user passwords saved in db. The Node.js encryption code is: How to make the same hashed string as Node.js bcrypt with Golang? <code>  var bcrypt = require('bcrypt'); bcrypt.genSalt(10, function(err, salt) { if(err) return next(err); bcrypt.hash(user.password, salt, function(err, hash) { if(err) return next(err); user.password = hash; next(); }); });",Bcrypt password hashing in Golang (compatible with Node.js)?
Bcrypt password hashing in golang (compatible with node.js)?," I set up a site with Node.js+passport for user authentication. Now I need to migrate to Golang, and need to do authentication with the user passwords saved in db. The Node.js encryption code is: How to make the same hashed string as Node.js bcrypt with Golang? <code>  var bcrypt = require('bcrypt'); bcrypt.genSalt(10, function(err, salt) { if(err) return next(err); bcrypt.hash(user.password, salt, function(err, hash) { if(err) return next(err); user.password = hash; next(); }); });",Bcrypt password hashing in Golang (compatible with Node.js)?
Parse input from HTML <form> in GoLang," I got something running with the Goji framework: What I was hoping someone could help me do is figure out how when an HTML form is submitted to send that data to Golang code.So if there is an input field with the name attribute and the value of that is name and the user types a name in there and submits, then on the form submitted page the Golang code will print hello, name.Here is what I could come up with: and here is my hello.html file:in the body: How do I connect hello.html to hello.go so that the Golang code gets what is in the input and returns hello, name in the form submitted page?I'd greatly appreciate any and all help! <code>  package mainimport ( ""fmt"" ""net/http"" ""github.com/zenazn/goji"" ""github.com/zenazn/goji/web"")func hello(c web.C, w http.ResponseWriter, r *http.Request) { fmt.Fprintf(w, ""Hello, %s!"", c.URLParams[""name""])}func main() { goji.Get(""/hello/:name"", hello) goji.Serve()} package mainimport( ""fmt"" ""net/http"" ""github.com/zenazn/goji"" ""github.com/zenazn/goji/web"")func hello(c web.C, w http.ResponseWriter, r *http.Request){ name := r.PostFormValue(""name"") fmt.Fprintf(w, ""Hello, %s!"", name)}func main(){ goji.Handle(""/hello/"", hello) goji.Serve()} <form action="""" method=""get""> <input type=""text"" name=""name"" /></form>",Parse input from HTML <form>
Parse input from HTML <form> in Golang," I got something running with the Goji framework: What I was hoping someone could help me do is figure out how when an HTML form is submitted to send that data to Golang code.So if there is an input field with the name attribute and the value of that is name and the user types a name in there and submits, then on the form submitted page the Golang code will print hello, name.Here is what I could come up with: and here is my hello.html file:in the body: How do I connect hello.html to hello.go so that the Golang code gets what is in the input and returns hello, name in the form submitted page?I'd greatly appreciate any and all help! <code>  package mainimport ( ""fmt"" ""net/http"" ""github.com/zenazn/goji"" ""github.com/zenazn/goji/web"")func hello(c web.C, w http.ResponseWriter, r *http.Request) { fmt.Fprintf(w, ""Hello, %s!"", c.URLParams[""name""])}func main() { goji.Get(""/hello/:name"", hello) goji.Serve()} package mainimport( ""fmt"" ""net/http"" ""github.com/zenazn/goji"" ""github.com/zenazn/goji/web"")func hello(c web.C, w http.ResponseWriter, r *http.Request){ name := r.PostFormValue(""name"") fmt.Fprintf(w, ""Hello, %s!"", name)}func main(){ goji.Handle(""/hello/"", hello) goji.Serve()} <form action="""" method=""get""> <input type=""text"" name=""name"" /></form>",Parse input from HTML <form>
Does Go or web requests sanitizes URLs?," I was implementing a simple web server in Go. As I have no experience in web development, this striked as a serious question for me. Let's say I'm serving web pages with a modified loadPage function from here Technically this allows me to write a request in a form of and the code would happily serve the /etc/passwd file, but it does not. Does this mean that there is some sort of protection against ../ in the Go http package or http protocol itself, or am I just doing something wrong and it is a security hole?  <code>  func loadPage(title string) []byte { filename := title body, _ := ioutil.ReadFile(filename) return body}func handler(w http.ResponseWriter, req *http.Request) { content := loadPage(req.URL.Path[1:]) fmt.Fprintf(w, ""%s"", content)} http://example.com/../../etc/passwd",Does Go sanitize URLs for web requests?
Golang Pointer to a string to string Conversion," In the Go language, is there any way to convert *string to string? (or, for that matter, any *T to T?)I have looked on the internet and through some Go documentation, but I can't find it - may have missed it. <code> ",How do I dereference a pointer in Go?
Why fmt.Printf accept byte array for %x in Go," I'm pretty new to Go. I want to know the exact difference between arrays and slices so please forgive me if I'm too obsessive over the spec.In documentation for package fmt, it says for Printf that %x can accept strings and slices of bytes. It said nothing about arrays of bytes. But in fact, if I put an array of bytes in it, it prints out fine too! Can anyone please tell me why? AFAIK, bytes array and slices cannot implicitly convert to each other.Thanks for reading my question! <code>  package mainimport ( ""fmt"")func main() { var b [6]byte for i := 0; i < 6; i++ { b[i] = 'a' } fmt.Printf(""%s\n"", b) // ""aaaaaa""}",Why does fmt.Printf accept a byte array for %x in Go
Should I sort with a function or a method?," The sort package provides these functions for sorting the builtin slice types:sort.Ints(a []int)sort.Float64s(a []float64)sort.Strings(a []string)It also provides these types for converting the builtin slice types to named types with Len(), Less(), Search(), Sort(), and Swap() methods:sort.IntSlicesort.Float64Slicesort.StringSliceThat means I can sort a slice of ints like this... or like this... Is it preferable to sort with a function or a method? Are there times when one form should be preferred over the other? <code>  // Functionslice := []int{5, 4, 3, 2, 1}sort.Ints(slice) // sort in place // Methodslice := sort.IntSlice{5, 4, 3, 2, 1}slice.Sort() // also sort in place",Sort with a function or method in Go?
Should I sort with a function or a method in Go?," The sort package provides these functions for sorting the builtin slice types:sort.Ints(a []int)sort.Float64s(a []float64)sort.Strings(a []string)It also provides these types for converting the builtin slice types to named types with Len(), Less(), Search(), Sort(), and Swap() methods:sort.IntSlicesort.Float64Slicesort.StringSliceThat means I can sort a slice of ints like this... or like this... Is it preferable to sort with a function or a method? Are there times when one form should be preferred over the other? <code>  // Functionslice := []int{5, 4, 3, 2, 1}sort.Ints(slice) // sort in place // Methodslice := sort.IntSlice{5, 4, 3, 2, 1}slice.Sort() // also sort in place",Sort with a function or method in Go?
Golang named arguments," How can I pass dictionary as list of arguments for function like in Python 3 in Go?Python 3: Go blank: <code>  def bar(a,b,c): print(a,b,c)args={c: 1, b: 2, a: 3}bar(**args) func bar( a, b, c int) { fmt.Printf(""%d, %d, %d"", a, b, c)}func main(){ args := make(map[string]int) args[""a""] = 3 args[""b""] = 2 args[""c""] = 1 // what next ?}",Go named arguments
bytes.Buffer does not implement io.Writer," I'm trying to have some Go object implement io.Writer, but writes to a string instead of a file or file-like object. I thought bytes.Buffer would work since it implements Write(p []byte). However when I try this: I get the following error: I am confused, since it clearly implements the interface. How do I resolve this error? <code>  import ""bufio""import ""bytes""func main() { var b bytes.Buffer foo := bufio.NewWriter(b)} cannot use b (type bytes.Buffer) as type io.Writer in function argument:bytes.Buffer does not implement io.Writer (Write method has pointer receiver)","Getting ""bytes.Buffer does not implement io.Writer"" error message"
In Go is naming the receiver variable 'self' misleading or good practise?," I have seen a fair amount of blogs & videos on Go and as far as I recall, none of the authors use 'self' or 'this' for the receiver variable when writing methods. However there seems to be a number of questions on stack overflow that do this, and it got me thinking about if this is misleading to name the variable 'self'? Reading the Spec for Method Sets does not provide any evidence either way (in my interpretation).I seem to recall finding somewhere that it was not really a self pointer, can anyone list evidence or provide reasoning either way, and if any problems/traps that might occur from thinking of it as 'self'?A quick example: Which method is more appropriate, or both? or <code>  type MyStruct struct { Name string} func (m *MyStruct) MyMethod() error { // do something useful} func (self *MyStruct) MyMethod() error { // do something useful}",In Go is naming the receiver variable 'self' misleading or good practice?
Golang Reflection: Get Tag from struct field," Is it possible to reflect on a field of a struct, and get a reference to its tag values?For example: From what I can see, the usual way to do this is to range over typ.NumField(), and then call field.Tag.Get(""tagname"").However, in my use-case, it would be much better to not have to pass the whole struct in. <code>  type User struct { name string `json:name-field` age int}// ...user := &User{""John Doe The Fourth"", 20}getStructTag(user.name)// ...func getStructTag(i interface{}) string{ //get tag from field }",Get struct field tag using Go reflect package
how to get all addresses and masks from local interfaces in go?," How can I get all addresses and masks from local interfaces in golang?I need the actual network mask configured along with every IP address.This code does not show the network masks in Windows 7: UPDATE: This issue has been fixed in Go: https://github.com/golang/go/issues/5395 <code>  package mainimport ( ""fmt"" ""log"" ""net"")func localAddresses() { ifaces, err := net.Interfaces() if err != nil { log.Print(fmt.Errorf(""localAddresses: %v\n"", err.Error())) return } for _, i := range ifaces { addrs, err := i.Addrs() if err != nil { log.Print(fmt.Errorf(""localAddresses: %v\n"", err.Error())) continue } for _, a := range addrs { log.Printf(""%v %v\n"", i.Name, a) } }}func main() { localAddresses()}",How to get all addresses and masks from local interfaces in go?
Golang - Global Variable Inline Assignment With Combined Declaration/Assignment Operator And Another Undeclared Variable Losing Scope?," This Go program will not compile. It throws the error global_var declared and not used However, when I remove the need for using the := operator by declaring new_string in the main function and simply using =, the compiler doesn't have a problem with seeing that global_var is declared globally and being used elsewhere in the program. My intuition tells me that it should know that global_var is declared already <code>  package mainimport ""log""var global_var intfunc main() { global_var, new_string := returnTwoVars() log.Println(""new_string: "" + new_string)}func returnTwoVars() (int, string) { return 1234, ""woohoo""}func usesGlobalVar() int { return global_var * 2}",Global variable inline assignment with combined declaration/assignment operator and another undeclared variable losing scope?
Golang: Reflection - How to get zero value of a field type," I have a struct containing many fields - I've figured out how to extract the field name, value, and tag information using reflection. What I also want to do is to determine if the value of a field is different from the field's default value.Currently, I have this (works, but a bit smelly): Seems to me that there should be a way to avoid the type switch in this case - what I'm trying to do is build up a map of field/values that have a value different from their default zero value, something like: Is there an elegant way to accomplish this?Thanks! <code>  ...qsMap := make(map[string]interface{})var defaultTime time.Timevar defaultString string...// get the field name and valuefieldName := s.Type().Field(i).Tag.Get(""bson"")fieldValue := valueField.Interface()// use reflection to determine the TYPE of the field and apply the proper formattingswitch fieldValue.(type) {case time.Time:if fieldValue != defaultTime { qsMap[fieldName] = fieldValue}case string:if fieldValue != defaultString { qsMap[fieldName] = fieldValue}...} // doesn't work -- i.e., if fieldValue of type string would be compared against """", etc.if fieldValue != reflect.Zero(reflect.Type(fieldValue)) { qsMap[fieldName] = fieldValue}",How to get zero value of a field type
How to get local IP Address in golang," I want to get the computer's IP address. I used the code below, but it returns 127.0.0.1.I want to get the IP address, such as 10.32.10.111, instead of the loopback address.  <code>  name, err := os.Hostname()if err != nil { fmt.Printf(""Oops: %v\n"", err) return}addrs, err := net.LookupHost(name)if err != nil { fmt.Printf(""Oops: %v\n"", err) return}for _, a := range addrs { fmt.Println(a)} ",How do I get the local IP address in Go?
How do I generate random numbers over a range in Go?," All the integer functions in math/rand generate non-negative numbers. I would like to generate random numbers in the range [-m, n). In other words, I would like to generate a mix of positive and negative numbers. <code>  rand.Int() int // [0, MaxInt]rand.Int31() int32 // [0, MaxInt32]rand.Int31n(n int32) int32 // [0, n)rand.Int63() int64 // [0, MaxInt64]rand.Int63n(n int64) int64 // [0, n)rand.Intn(n int) int // [0, n)",Generating random numbers over a range in Go
golang using timeouts with channels," I am using goroutines/channels to check if list of urls are reachable. Here is my code. This seems to always return true. Why is the timeout case not getting executed? The goal is to return false even if one of the urls is not reachable <code>  import ""fmt""import ""time""func check(u string) bool { time.Sleep(4 * time.Second) return true}func IsReachable(urls []string) bool { ch := make(chan bool, 1) for _, url := range urls { go func(u string) { select { case ch <- check(u): case <-time.After(time.Second): ch<-false } }(url) } return <-ch}func main() { fmt.Println(IsReachable([]string{""url1""}))}",Go using timeouts with channels
convert golang struct to map," I have the following problem. I need to convert a structure to map[string]interface{} in order to perform an update in database (using mgo as driver for mongodb).UpdateFor partially updating a document in mongoDB, the (optimal) solution is to convert to a map and delete the unwanted fields. For converting from struct to map please refer to my other postOriginal PostI receive the data from client side javascript and write in the my struct model. But I don't want to change/update some fields and thus I need to convert my structure to a map[string]interface{} to delete the unwanted fields.Converting the structure to json and then to map it's not ok because the field types are not preserved. For example, let the followin structure be an Image model: So far so good, but when I receive informations from client(i.e. javascript) the views field is a string. If I convert to a map the json input given from client, then the views field remains a string and the internal representation of this value is changed in database. So next time I read this image from database, the Views field is zeroed (because of it's string representation from database).Thus I write the json input from client in structure (for proper conversion of Views variable). But the owner value shouldn't change (the one form database). So I need to convert again the structure to a map[string]interface{} and process that map before making the update in database.Using the json package for this it's not an option, because the string tag from Views field will convert from int to string (when converting to map).So far I've tried the following function for converting structure to map, and I use reflection package and am a noob with using it. Don't quite understand well the package.I would be grateful if you would come up with some ideas.Thanks. <code>  type Image struct { Name string `json:name` Views int `json:views,string` Owner string `json:owner`}",partial update using mgo
function for converting a struct to map in golang," I want to convert a struct to map in Golang. It would also be nice if I could use the JSON tags as keys in the created map (otherwise defaulting to field name).Edit Dec 14, 2020Since structs repo was archived, you can use mapstructure instead.Edit TL;DR version, Jun 15, 2015If you want the fast solution for converting a structure to map, see the accepted answer, upvote it and use that package.Happy coding! :)Original PostSo far I have this function, I am using the reflect package but I don't understand well how to use the package, please bear with me. Also I looked at JSON package source code, because it should contain my needed implementation (or parts of it) but don't understand too much. <code>  func ConvertToMap(model interface{}) bson.M { ret := bson.M{} modelReflect := reflect.ValueOf(model) if modelReflect.Kind() == reflect.Ptr { modelReflect = modelReflect.Elem() } modelRefType := modelReflect.Type() fieldsCount := modelReflect.NumField() var fieldData interface{} for i := 0; i < fieldsCount; i++ { field := modelReflect.Field(i) switch field.Kind() { case reflect.Struct: fallthrough case reflect.Ptr: fieldData = ConvertToMap(field.Interface()) default: fieldData = field.Interface() } ret[modelRefType.Field(i).Name] = fieldData } return ret}",function for converting a struct to map in Golang
dot dot dot in golang. interface with empty braces," Below is a piece of Go code I have question about.Specifically, what is a in this function? Could anyone tell me what the three dots are here?And what does ...interface{} do? <code>  func DPrintf(format string, a ...interface{}) (n int, err error) { if Debug > 0 { n, err = fmt.Printf(format, a...) } return}",Meaning of ...interface{} (dot dot dot interface)
dot dot dot in Golang. interface with empty braces," Below is a piece of Go code I have question about.Specifically, what is a in this function? Could anyone tell me what the three dots are here?And what does ...interface{} do? <code>  func DPrintf(format string, a ...interface{}) (n int, err error) { if Debug > 0 { n, err = fmt.Printf(format, a...) } return}",Meaning of ...interface{} (dot dot dot interface)
"in golang, i wan to create a pair such as pair(string ,int) what is good solution"," I want to create a pair such as pair(string, int). I know that in go there is no pair type, and I also know that slices can only hold the same data type.How may I do this? <code> ",How can I create a pair type in go?
Format Timestamp in outgoing JSON in GoLang?," I've been playing with Go recently and it's awesome. The thing I can't seem to figure out (after looking through documentation and blog posts) is how to get the time.Time type to format into whatever format I'd like when it's encoded by json.NewEncoder.EncodeHere's a minimal Code example: Ideally, I'd like to send a request and get the Stamp field back as something like May 15, 2014 and not 2014-05-16T08:28:06.801064-04:00But I'm not really sure how, I know I can add json:stamp to the Document type declaration to get the field to be encoded with the name stamp instead of Stamp, but I don't know what those types of things are called, so I'm not even sure what to google for to find out if there is some type of formatting option in that as well. Does anyone have a link to the an example or good documentation page on the subject of those type mark ups (or whatever they're called) or on how I can tell the JSON encoder to handle time.Time fields? Just for reference, I have looked at these pages: here and here and of course, at the official docs <code>  package maintype Document struct { Name string Content string Stamp time.Time Author string}func sendResponse(data interface{}, w http.ResponseWriter, r * http.Request){ _, err := json.Marshal(data) j := json.NewEncoder(w) if err == nil { encodedErr := j.Encode(data) if encodedErr != nil{ //code snipped } }else{ //code snipped }}func main() { http.HandleFunc(""/document"", control.HandleDocuments) http.ListenAndServe(""localhost:4000"", nil)}func HandleDocuments(w http.ResponseWriter,r *http.Request) { w.Header().Set(""Content-Type"", ""application/json"") w.Header().Set(""Access-Control-Allow-Origin"", ""*"") switch r.Method { case ""GET"": //logic snipped testDoc := model.Document{""Meeting Notes"", ""These are some notes"", time.Now(), ""Bacon""} sendResponse(testDoc, w,r) } case ""POST"": case ""PUT"": case ""DELETE"": default: //snipped }}",How to format timestamp in outgoing JSON
Format Timestamp in outgoing JSON in Golang?," I've been playing with Go recently and it's awesome. The thing I can't seem to figure out (after looking through documentation and blog posts) is how to get the time.Time type to format into whatever format I'd like when it's encoded by json.NewEncoder.EncodeHere's a minimal Code example: Ideally, I'd like to send a request and get the Stamp field back as something like May 15, 2014 and not 2014-05-16T08:28:06.801064-04:00But I'm not really sure how, I know I can add json:stamp to the Document type declaration to get the field to be encoded with the name stamp instead of Stamp, but I don't know what those types of things are called, so I'm not even sure what to google for to find out if there is some type of formatting option in that as well. Does anyone have a link to the an example or good documentation page on the subject of those type mark ups (or whatever they're called) or on how I can tell the JSON encoder to handle time.Time fields? Just for reference, I have looked at these pages: here and here and of course, at the official docs <code>  package maintype Document struct { Name string Content string Stamp time.Time Author string}func sendResponse(data interface{}, w http.ResponseWriter, r * http.Request){ _, err := json.Marshal(data) j := json.NewEncoder(w) if err == nil { encodedErr := j.Encode(data) if encodedErr != nil{ //code snipped } }else{ //code snipped }}func main() { http.HandleFunc(""/document"", control.HandleDocuments) http.ListenAndServe(""localhost:4000"", nil)}func HandleDocuments(w http.ResponseWriter,r *http.Request) { w.Header().Set(""Content-Type"", ""application/json"") w.Header().Set(""Access-Control-Allow-Origin"", ""*"") switch r.Method { case ""GET"": //logic snipped testDoc := model.Document{""Meeting Notes"", ""These are some notes"", time.Now(), ""Bacon""} sendResponse(testDoc, w,r) } case ""POST"": case ""PUT"": case ""DELETE"": default: //snipped }}",How to format timestamp in outgoing JSON
Does Golang have callback concept?," I found many talks saying that Node.js is bad because of callback hell and Go is good because of its synchronous model. What I feel is Go can also do callback as same as Node.js but in a synchronous way. As we can pass anonymous function and do closure things So, why are they comparing Go and Node.js in callback perspective as if Go cannot become callback hell.Or I misunderstand the meaning of callback and anonymous function in Go?  <code> ",Does Go have callback concept?
How can I do test setup using the testing package that comes with Go, How can I do overall test setup processing which sets the stage for all the tests when using the testing package?As an example in Nunit there is a [SetUp] attribute. <code>  [TestFixture]public class SuccessTests{ [SetUp] public void Init() { /* Load test data */ }},How can I do test setup using the testing package in Go
Go get only a specific returned value from function?," Given swap, a function that returns multiple values, and supposing it's part of some API I can't modify: Is it possible to use swap function and get only the first returned value, discarding the second one? I tried this: And this is not possible too: How to deal with functions that return multiple values when I don't need all the returned parts?Code is based on ""A tour of go - lesson 9"" <code>  package mainimport ""fmt""func swap(x, y string) (string, string) { return y, x}func main() { a, b := swap(""hello"", ""world"") fmt.Println(a, b)} func main() { a, b := swap(""hello"", ""world"") fmt.Println(a)}ERROR: prog.go:10: b declared and not used [process exited with non-zero status] a := swap(""hello"", ""world"")ERROR: prog.go:10: multiple-value swap() in single-value context",Get only a specific value out of a function call with multiple return values?
"Gophers, how to get only a specific returned value from function call?"," Given swap, a function that returns multiple values, and supposing it's part of some API I can't modify: Is it possible to use swap function and get only the first returned value, discarding the second one? I tried this: And this is not possible too: How to deal with functions that return multiple values when I don't need all the returned parts?Code is based on ""A tour of go - lesson 9"" <code>  package mainimport ""fmt""func swap(x, y string) (string, string) { return y, x}func main() { a, b := swap(""hello"", ""world"") fmt.Println(a, b)} func main() { a, b := swap(""hello"", ""world"") fmt.Println(a)}ERROR: prog.go:10: b declared and not used [process exited with non-zero status] a := swap(""hello"", ""world"")ERROR: prog.go:10: multiple-value swap() in single-value context",Get only a specific value out of a function call with multiple return values?
"GAE Golang - is there a way to detect whether the code is run on local, test environment or on App Engine?", I am developing a Google App Engine Go application and testing it locally. I have some variables for test environment and some variables for the live App Engine environment. I am wondering whether there is some way to determine from inside the code what environment the code is run in and use a proper version of the variable without having to comment and uncomment code all the time. <code> ,"Is there a way to detect whether the code is run on local, test environment or on App Engine?"
Golang Get hours difference between two dates," I'm working for first time on Go, in this case i have a string on UTC format, I would like to know, how can I get the difference in hours between my date and the time now.This is my current string <code>  v := ""2014-05-03 20:57 UTC""",How to get hours difference between two dates
"Go, get hours difference between two dates"," I'm working for first time on Go, in this case i have a string on UTC format, I would like to know, how can I get the difference in hours between my date and the time now.This is my current string <code>  v := ""2014-05-03 20:57 UTC""",How to get hours difference between two dates
Idiomatic way to validate structs in Go?," I need to validate that a struct value is correct and this means I need to check every field individually, which is easy for a small number of small structs but I was wondering if there's a better way to do it. Here's how I'm doing it right now. Is this the idiomatic way to validate the values of fields in a struct? It looks cumbersome. <code>  type Event struct { Id int UserId int Start time.Time End time.Time Title string Notes string}func (e Event) IsValid() error { if e.Id <= 0 { return errors.New(""Id must be greater than 0"") } if e.UserId <= 0 { return errors.New(""UserId must be greater than 0"") } if e.End <= e.Start { return errors.New(""End must be after Start"") } if e.Start < time.Now() { return errors.New(""Cannot create events in the past"") } if e.Title == """" { return errors.New(""Title cannot be empty"") } return nil}",Idiomatic way to validate structs
What does &^ operator do?," According to the specification this operator is called bit clear: I've never heard of such an operator before, and I'm wondering why is it useful. It seems to take the left operand and disables all the bits that are turned on in the right operand. Is there any formal description of the operator?One more thing I noticed is that it's not commutative.Pseudocode in comarison with ^: <code>  &^ bit clear (AND NOT) integers 11110 &^ 100 //1101011110 ^ 100 //1101011110 &^ 0 //1111011110 ^ 0 //1111011110 &^ 11110 //011110 ^ 11110 //011110 &^ 111 //1100011110 ^ 111 //11001111 &^ 11110 //1111 ^ 11110 //11001",What does the &^ operator do?
what does go install do? (And some more text to satisy SO ), The docs say nothing about what build vs install doesMy expectation was that it's like make install; i.e. it takes the compiled stuff and puts in its final location (/usr/local/bin/my_new_toy or whatever) but it seems that it puts things in GOROOT/binCan I tell go to do a make install - i.e. put things elsewhere? Or do I just write a makefile (please tell me no)? <code> ,What does go install do?
nodejs setTimeout equivalent in Golang," I am currently studying, and I miss setTimeout from Nodejs in golang. I haven't read much yet, and I'm wondering if I could implement the same in go like an interval or a loopback.Is there a way that I can write this from node to golang? I heard golang handles concurrency very well, and this might be some goroutines or else? Thank you in advance! <code>  //Nodejsfunction main() { //Do something setTimeout(main, 3000) console.log('Server is listening to 1337')} //Go versionfunc main() { for t := range time.Tick(3*time.Second) { fmt.Printf(""working %s \n"", t) } //basically this will not execute.. fmt.Printf(""will be called 1st"")}",What is the nodejs setTimeout equivalent in Golang?
Go / golang time.Now().UnixNano() convert to milliseconds?, How can I get Unix time in Go in milliseconds?I have the following function: I need less precision and only want milliseconds. <code>  func makeTimestamp() int64 { return time.Now().UnixNano() % 1e6 / 1e3},Go time.Now().UnixNano() convert to milliseconds?
why fmt.Println does not work in google app engine," I built a simple web app using google app engine and golang. in code below, I use fmt.Println twice to print out somehting for debugging purpose. I have no problem running the app. everything works except nothing print out on the terminal.  <code>  func HomeHandler(w http.ResponseWriter, r *http.Request) { c := appengine.NewContext(r) q := datastore.NewQuery(""Post"").Ancestor(goblogKey(c)).Order(""-CreatedOn"").Limit(10) //posts := make([]entity.Post, 0, 10) var posts []entity.Post if _, err := q.GetAll(c, &posts); err != nil { http.Error(w, err.Error(), http.StatusInternalServerError) return } fmt.Println(string(len(posts)) + ""..........."") postList := []dto.Post{} for _, val := range posts { newpost := dto.Post{ Post: val, BodyHTML: template.HTML(val.Body), } fmt.Println(val.Title) postList = append(postList, newpost) } page := dto.PageData{Title: ""Home"", Posts: postList} templates.ExecuteTemplate(w, ""index"", page)}",Why doesn't fmt.Println work in Google app engine
How to create JSON for GO struct," I am trying to use the Marshal function to create JSON from a Go struct. The JSON created does not contain the Person struct.What am I missing?http://play.golang.org/p/ASVYwDM7Fz The output generated is as follows: I don't see Person in the output.http://golang.org/pkg/encoding/json/#Marshal <code>  type Person struct { fn string ln string}type ColorGroup struct { ID int Name string Colors []string P Person}per := Person{ fn: ""John"", ln: ""Doe"",}group := ColorGroup{ ID: 1, Name: ""Reds"", Colors: []string{""Crimson"", ""Red"", ""Ruby"", ""Maroon""}, P: per,}b, err := json.Marshal(group)if err != nil { fmt.Println(""error:"", err)}os.Stdout.Write(b) {""ID"":1,""Name"":""Reds"",""Colors"":[""Crimson"",""Red"",""Ruby"",""Maroon""],""P"":{}}",How to create JSON for Go struct
Empty or not required struct fields in golang," I have two structs that represent models that will be inserted into a mongodb database. One struct (Investment) has the other struct (Group) as one of its fields. The problem I'm having is that in the Investment model, Group is not required. If there is no group, I think its better for it to not be inserted in the db. Whats the best way to handle a db model such as this in Go? <code>  type Group struct { Base Name string `json:""name"" bson""name""`}type Investment struct { Base Symbol string `json:""symbol"" bson:""symbol"" binding:""required""` Group Group `json:""group"" bson:""group""` Fields bson.M `json:""fields"" bson:""fields""`}",Empty or not required struct fields
decoding JSON Golang," I'm trying to decode some json in Go but some fields don't get decoded. See the code running in browser here: What am I doing wrong?I need only the MX records so I didn't define the other fields. As I understand from the godoc you don't need to define the fields you don't use/need. <code>  // You can edit this code!// Click here and start typing.package mainimport ""fmt""import ""encoding/json""func main() { body := ` {""response"": { ""status"": ""SUCCESS"", ""data"": { ""mxRecords"": [ { ""value"": ""us2.mx3.mailhostbox.com."", ""ttl"": 1, ""priority"": 100, ""hostName"": ""@"" }, { ""value"": ""us2.mx1.mailhostbox.com."", ""ttl"": 1, ""priority"": 100, ""hostName"": ""@"" }, { ""value"": ""us2.mx2.mailhostbox.com."", ""ttl"": 1, ""priority"": 100, ""hostName"": ""@"" } ], ""cnameRecords"": [ { ""aliasHost"": ""pop.a.co.uk."", ""canonicalHost"": ""us2.pop.mailhostbox.com."" }, { ""aliasHost"": ""webmail.a.co.uk."", ""canonicalHost"": ""us2.webmail.mailhostbox.com."" }, { ""aliasHost"": ""smtp.a.co.uk."", ""canonicalHost"": ""us2.smtp.mailhostbox.com."" }, { ""aliasHost"": ""imap.a.co.uk."", ""canonicalHost"": ""us2.imap.mailhostbox.com."" } ], ""dkimTxtRecord"": { ""domainname"": ""20a19._domainkey.a.co.uk"", ""value"": ""\""v=DKIM1; g=*; k=rsa; p=DkfbhO8Oyy0E1WyUWwIDAQAB\"""", ""ttl"": 1 }, ""spfTxtRecord"": { ""domainname"": ""a.co.uk"", ""value"": ""\""v=spf1 redirect=_spf.mailhostbox.com\"""", ""ttl"": 1 }, ""loginUrl"": ""us2.cp.mailhostbox.com"" }}}` type MxRecords struct { value string ttl int priority int hostName string } type Data struct { mxRecords []MxRecords } type Response struct { Status string `json:""status""` Data Data `json:""data""` } type apiR struct { Response Response } var r apiR err := json.Unmarshal([]byte(body), &r) if err != nil { fmt.Printf(""err was %v"", err) } fmt.Printf(""decoded is %v"", r)}",How to decode json into structs
golang how to decode json into structs," I'm trying to decode some json in Go but some fields don't get decoded. See the code running in browser here: What am I doing wrong?I need only the MX records so I didn't define the other fields. As I understand from the godoc you don't need to define the fields you don't use/need. <code>  // You can edit this code!// Click here and start typing.package mainimport ""fmt""import ""encoding/json""func main() { body := ` {""response"": { ""status"": ""SUCCESS"", ""data"": { ""mxRecords"": [ { ""value"": ""us2.mx3.mailhostbox.com."", ""ttl"": 1, ""priority"": 100, ""hostName"": ""@"" }, { ""value"": ""us2.mx1.mailhostbox.com."", ""ttl"": 1, ""priority"": 100, ""hostName"": ""@"" }, { ""value"": ""us2.mx2.mailhostbox.com."", ""ttl"": 1, ""priority"": 100, ""hostName"": ""@"" } ], ""cnameRecords"": [ { ""aliasHost"": ""pop.a.co.uk."", ""canonicalHost"": ""us2.pop.mailhostbox.com."" }, { ""aliasHost"": ""webmail.a.co.uk."", ""canonicalHost"": ""us2.webmail.mailhostbox.com."" }, { ""aliasHost"": ""smtp.a.co.uk."", ""canonicalHost"": ""us2.smtp.mailhostbox.com."" }, { ""aliasHost"": ""imap.a.co.uk."", ""canonicalHost"": ""us2.imap.mailhostbox.com."" } ], ""dkimTxtRecord"": { ""domainname"": ""20a19._domainkey.a.co.uk"", ""value"": ""\""v=DKIM1; g=*; k=rsa; p=DkfbhO8Oyy0E1WyUWwIDAQAB\"""", ""ttl"": 1 }, ""spfTxtRecord"": { ""domainname"": ""a.co.uk"", ""value"": ""\""v=spf1 redirect=_spf.mailhostbox.com\"""", ""ttl"": 1 }, ""loginUrl"": ""us2.cp.mailhostbox.com"" }}}` type MxRecords struct { value string ttl int priority int hostName string } type Data struct { mxRecords []MxRecords } type Response struct { Status string `json:""status""` Data Data `json:""data""` } type apiR struct { Response Response } var r apiR err := json.Unmarshal([]byte(body), &r) if err != nil { fmt.Printf(""err was %v"", err) } fmt.Printf(""decoded is %v"", r)}",How to decode json into structs
Do three dots (which is called wildcard?) contain multiple meanings?," As I recognize, ""..."" means the length of the array in the below snippet. On the other hand, ""..."" means unpacking the slice y to arguments of int in the below snippet, as I guess. I'm not really sure about this. Now, the difference in the two meanings makes it hard for me to understand what ""..."" is. <code>  var days := [...]string { ""Sun"", ""Mon"", ""Tue"", ""Wed"", ""Thu"", ""Fri"", ""Sat"" } x := []int{1,2,3}y := []int{4,5,6}x = append(x, y...)",Do three dots contain multiple meanings?
Golang - Get pointer to value using reflection," I have a function that iterates through all fields of an interface passed as parameter. In order to achieve this is I am using reflection. The issue is that I do not know how to obtain the address of a non-pointer field. Here is an example: The above code represents my test structures. Now here is the actual function which traverses a specified structure and lists details about it: And here is the actual test after structure instantiation/initialization: And finally the output of InspectStruct call: As you can see I am using recursion, so if one of the fields is a struct kind then I call InspectStruct for it.My issue is that though all fields have been initialized for the entire structure ""t"" hierarchy, I am not able to get the address for any field located at a higher depth than ""t"". I would really appreciate any help. <code>  type Z struct { Id int}type V struct { Id int F Z}type T struct { Id int F V} func InspectStruct(o interface{}) { val := reflect.ValueOf(o) if val.Kind() == reflect.Interface && !val.IsNil() { elm := val.Elem() if elm.Kind() == reflect.Ptr && !elm.IsNil() && elm.Elem().Kind() == reflect.Ptr { val = elm } } if val.Kind() == reflect.Ptr { val = val.Elem() } for i := 0; i < val.NumField(); i++ { valueField := val.Field(i) typeField := val.Type().Field(i) address := ""not-addressable"" if valueField.Kind() == reflect.Interface && !valueField.IsNil() { elm := valueField.Elem() if elm.Kind() == reflect.Ptr && !elm.IsNil() && elm.Elem().Kind() == reflect.Ptr { valueField = elm } } if valueField.Kind() == reflect.Ptr { valueField = valueField.Elem() } if valueField.CanAddr() { address = fmt.Sprint(valueField.Addr().Pointer()) } fmt.Printf(""Field Name: %s,\t Field Value: %v,\t Address: %v\t, Field type: %v\t, Field kind: %v\n"", typeField.Name, valueField.Interface(), address, typeField.Type, valueField.Kind()) if valueField.Kind() == reflect.Struct { InspectStruct(valueField.Interface()) } }} t := new(T)t.Id = 1t.F = *new(V)t.F.Id = 2t.F.F = *new(Z)t.F.F.Id = 3InspectStruct(t) Field Name: Id, Field Value: 1, Address: 408125440 , Field type: int , Field kind: intField Name: F, Field Value: {2 {3}}, Address: 408125444 , Field type: main.V , Field kind: structField Name: Id, Field Value: 2, Address: not-addressable , Field type: int , Field kind: intField Name: F, Field Value: {3}, Address: not-addressable , Field type: main.Z , Field kind: structField Name: Id, Field Value: 3, Address: not-addressable , Field type: int , Field kind: int",Get pointer to value using reflection
Why doesn't this Go Lang code loop forever with a break label?," I am trying to figure out how break with labels works.I expect the following program to keep printing ""In if statement"" forever. This is because the break here statement brings the code execution back up to the beginning for loop which should then be executed again and again.However, this code is only executed once. What am I missing here? Execution result: http://play.golang.org/p/y9kH1YZezJ <code>  package mainimport ""fmt""func main() {here: for { fmt.Println(""In if statement"") break here } fmt.Println(""At the bottom"")} In if statementAt the bottomProgram exited.",Why doesn't this code loop forever with a break label?
golang: convert struct pointer to interface{}," If I have: The above are set in stone - I can't change foo or bar. Additionally, baz must converted back to a foo struct pointer inside bar. How do I cast &foo{} to interface{} so I can use it as a parameter when calling bar?  <code>  type foo struct{ } func bar(baz interface{}) { }",convert struct pointer to interface{}
Go: How to convert interface{} to []int?," I am programming in Go programming language.Say there's a variable of type interface{} that contains an array of integers. How do I convert interface{} back to []int?I have tried The error I got is: <code>  interface_variable.([]int) panic: interface conversion: interface is []interface {}, not []int",How to convert interface{} to []int?
Go lang - How send json string in POST request," I tried working with Apiary and made a universal template to send JSON to mock server and have this code: This code doesn't send JSON properly, but I don't know why. The JSON string can be different in every call. I can't use Struct for this. <code>  package mainimport ( ""encoding/json"" ""fmt"" ""github.com/jmcvetta/napping"" ""log"" ""net/http"")func main() { url := ""http://restapi3.apiary.io/notes"" fmt.Println(""URL:>"", url) s := napping.Session{} h := &http.Header{} h.Set(""X-Custom-Header"", ""myvalue"") s.Header = h var jsonStr = []byte(`{ ""title"": ""Buy cheese and bread for breakfast.""}`) var data map[string]json.RawMessage err := json.Unmarshal(jsonStr, &data) if err != nil { fmt.Println(err) } resp, err := s.Post(url, &data, nil, nil) if err != nil { log.Fatal(err) } fmt.Println(""response Status:"", resp.Status()) fmt.Println(""response Headers:"", resp.HttpResponse().Header) fmt.Println(""response Body:"", resp.RawText())}",How do I send a JSON string in a POST request in Go
Golang - How send json string in POST request," I tried working with Apiary and made a universal template to send JSON to mock server and have this code: This code doesn't send JSON properly, but I don't know why. The JSON string can be different in every call. I can't use Struct for this. <code>  package mainimport ( ""encoding/json"" ""fmt"" ""github.com/jmcvetta/napping"" ""log"" ""net/http"")func main() { url := ""http://restapi3.apiary.io/notes"" fmt.Println(""URL:>"", url) s := napping.Session{} h := &http.Header{} h.Set(""X-Custom-Header"", ""myvalue"") s.Header = h var jsonStr = []byte(`{ ""title"": ""Buy cheese and bread for breakfast.""}`) var data map[string]json.RawMessage err := json.Unmarshal(jsonStr, &data) if err != nil { fmt.Println(err) } resp, err := s.Post(url, &data, nil, nil) if err != nil { log.Fatal(err) } fmt.Println(""response Status:"", resp.Status()) fmt.Println(""response Headers:"", resp.HttpResponse().Header) fmt.Println(""response Body:"", resp.RawText())}",How do I send a JSON string in a POST request in Go
How do I send a json string in a POST request in Go," I tried working with Apiary and made a universal template to send JSON to mock server and have this code: This code doesn't send JSON properly, but I don't know why. The JSON string can be different in every call. I can't use Struct for this. <code>  package mainimport ( ""encoding/json"" ""fmt"" ""github.com/jmcvetta/napping"" ""log"" ""net/http"")func main() { url := ""http://restapi3.apiary.io/notes"" fmt.Println(""URL:>"", url) s := napping.Session{} h := &http.Header{} h.Set(""X-Custom-Header"", ""myvalue"") s.Header = h var jsonStr = []byte(`{ ""title"": ""Buy cheese and bread for breakfast.""}`) var data map[string]json.RawMessage err := json.Unmarshal(jsonStr, &data) if err != nil { fmt.Println(err) } resp, err := s.Post(url, &data, nil, nil) if err != nil { log.Fatal(err) } fmt.Println(""response Status:"", resp.Status()) fmt.Println(""response Headers:"", resp.HttpResponse().Header) fmt.Println(""response Body:"", resp.RawText())}",How do I send a JSON string in a POST request in Go
Golang: variable scope inside if statements," I've just started learning Go today and have got stuck on variable scopes.I've ultimately confused about how to get around the fact that I can't create a variable inside an if statement and the use it afterward.This is my code. The problem is that new1 can't be created before the if statement because its size is dependent upon the result of the if statement, and by creating it inside the if statement I can't use it after the if statement ends. The only thing I can think of is to do something like To be quite honest if that is truly the solution then I don't think I want to use Golang after all.So what is the best way of solving this? <code>  if len(array1)>len(array2) { new1 := make([]string,0,len(array1)) mc := Array2Map_string(array1) for _,tok :=range array2 { _, ok := mc[tok] if ok { new1[len(new1)]=tok } } } else { new1 := make([]string,0,len(array2)) mc := Array2Map_string(array2) for _,tok :=range array1 { _, ok := mc[tok] if ok { new1[len(new1)]=tok } } }new2 := make([]string,0,len(new1))copy(new2, new1) var pointlessvariable uintif len(array1)>len(array2) {pointlessvariable=len(array1)} else {pointlessvariable=len(array2)}var new1 = make([]string,0,pointlessvariable)if len(array1)>len(array2) {...",Variable scope inside if statements
Quicksort in Golang," I'm learning Go, and tried to implement a quicksort, however it doesn't return a complete list. To my understanding of Go it matches with a functioning Ruby implementation I wrote.My code is: I am very puzzled as to what in this doesn't work. <code>  func quickSort(data []string) []string { if len(data) > 1 { pivot := data[0] smaller := make([]string, 0, len(data)) equal := make([]string, 0, len(data)) larger := make([]string, 0, len(data)) for i := 1; i < len(data); i++ { if data[i] > pivot { larger = append(larger, data[i]) } else if data[i] < pivot { smaller = append(smaller, data[i]) } else { equal = append(equal, data[i]) } } return append(append(quickSort(smaller), equal...), quickSort(larger)...) } else { return data }}",Quicksort in Go
Golang - How to print the values of Arrays?, I want to see the values which are in the slice. How can I print them? <code>  projects []Project ,How to print the values of slices
How to print the values of Arrays, I want to see the values which are in the slice. How can I print them? <code>  projects []Project ,How to print the values of slices
Golang - How to print struct variables in console?," How can I print (to the console) the Id, Title, Name, etc. of this struct in Golang? <code>  type Project struct { Id int64 `json:""project_id""` Title string `json:""title""` Name string `json:""name""` Data Data `json:""data""` Commits Commits `json:""commits""`}",How to print struct variables in console?
How do you server simple documentation for go programs using godoc as a webpage?," I was trying to serve a specific local go file as a documentation web page, but was not able to do it.The official godoc documentation says: With the -http flag (i.e. the godoc command), it runs as a web server and presents the documentation as a web page. This does create something similar as the go page but it does not render the specific file that I want to render. So I tried to provide the name of the file I wanted: However, it just replies with: I also tried: but it didn't work.I also tried: but it replied with: I even tried just generating the html thing itself: same error as above.I also tried (since it was complaining that there was no file in the pkg dir): At the end, I gave up. I don't know how this godoc thing works. I installed the hello.go program so that I there was something in the pkg file in the workspace. How do you generate a webpage with your documentation for your code? <code>  user_me$ godoc -http=:6060 user_me$ godoc -http=:6000 hello.go usage: godoc package [name ...] godoc -http=:6060 -ex=false: show examples in command line mode -goroot=""/usr/local/go"": Go root directory -html=false: print HTML in command-line mode -http="""": HTTP service address (e.g., ':6060') -httptest.serve="""": if non-empty, httptest.NewServer serves on this address and blocks -index=false: enable search index -index_files="""": glob pattern specifying index files;if not empty, the index is read from these files in sorted order -index_throttle=0.75: index throttle value; 0.0 = no time allocated, 1.0 = full throttle -links=true: link identifiers to their declarations -maxresults=10000: maximum number of full text search results shown -notes=""BUG"": regular expression matching note markers to show -play=false: enable playground in web interface -q=false: arguments are considered search queries -server="""": webserver address for command line searches -src=false: print (exported) source in command-line mode -tabwidth=4: tab width -templates="""": directory containing alternate template files -timestamps=false: show timestamps with directory listings -url="""": print HTML for named URL -v=false: verbose mode -write_index=false: write index to a file; the file name must be specified with -index_files -zip="""": zip file providing the file system to serve; disabled if empty user_me$ godoc -url=""localhost:8080"" hello.go godoc -server=localhost:8080 hello.go 2014/07/01 10:45:56 open /usr/local/go/src/pkg/hello.go: no such file or directory godoc -html hello.go > hello.html godoc -html -goroo=$GOPATH hello.go > hello.html",How do you serve simple documentation for go programs using godoc as a webpage?
Go templates : range over slice of structs instead of struct of slices," Having played around with Go HTML templates a bit, all the examples I found for looping over objects in templates were passing structs of slices to the template, somewhat like in this example : with the ""main"" template being : This works, but i don't understand how I'm supposed to display each ID just next to its corresponding Name if i'm ranging on the .Name property only. I would find it more logical to treat each user as an object to group its properties when displaying.Thus my question:What if I wanted to pass a slice of structs to the template? What would be the syntax to make this work? I haven't found or understood how to in the official html/template doc.I imagined something looking remotely like this: and a template looking somewhat like this: (syntax here is deliberately wrong, it's just to get understood) <code>  type UserList struct { Id []int Name []string}var templates = template.Must(template.ParseFiles(""main.html""))func rootHandler(w http.ResponseWriter, r *http.Request) { users := UserList{ Id: []int{0, 1, 2, 3, 4, 5, 6, 7}, Name: []string{""user0"", ""user1"", ""user2"", ""user3"", ""user4""}, } templates.ExecuteTemplate(w, ""main"", &users)} {{define ""main""}} {{range .Name}} {{.}} {{end}}{{end}} type User struct { Id int Name string}type UserList []Uservar myuserlist UserList = ... {{define ""main""}} {{for each User from myuserlist as myuser}} {{myuser.Id}} {{myuser.Name}} {{end}}{{end}}",How to range over slice of structs instead of struct of slices
golang: How do I determine the number of lines in a file efficiently?," In Golang, I am looking for an efficient way to determine the number of lines a file has.Of course, I can always loop through the entire file, but does not seem very efficient. Is there a better (quicker, less expensive) way to find out how many lines a file has? <code>  file, _ := os.Open(""/path/to/filename"")fileScanner := bufio.NewScanner(file)lineCount := 0for fileScanner.Scan() { lineCount++}fmt.Println(""number of lines:"", lineCount)",Golang: How do I determine the number of lines in a file efficiently?
Nullable time.Time in golang," I have a struct that I intend to populate with a database record, one of the datetime columns is nullable: Since pointers can be nil, I've made RemindedAt a pointer, but this will require the code to know the difference between the At variables. Is there a more elegant way to handle this? <code>  type Reminder struct { Id int CreatedAt time.Time RemindedAt *time.Time SenderId int ReceiverId int}",Nullable time.Time
when to prepare postgresql statements in a web server?," I have a web server that connects to a postgresql database. As I understand, postgresql driver manages a connection pool internally so I made the database connection a global variable.I am using prepared statements and I do not know whether it is a good idea to prepare them in advance in my main function before the server has started, or do it in my request handlers (as below). I am new to golang. I think it is more efficient to make the statements global, but I am not sure. Please help. <code>  var db *sql.DBfunc main() { router = pat.New() router.Get(""/"", handler) db, e := sql.Open(""postgres"", ""..."") ... http.ListenAndServe(""127.0.0.1"", router)}func handler(w http.ResponseWriter, r *http.Request) { s, e := db.Prepare(""select * from mytable where field=$1"") r, e := s.Exec(123) ...}",when to prepare postgresql statements in a golang web server?
How to get the http redirect status codes in Golang," I'd like to log 301s vs 302s but can't see a way to read the response status code in Client.Do, Get, doFollowingRedirects, CheckRedirect. Will I have to implement redirection myself to achieve this? <code> ",How to get the http redirect status codes
How to prevent Golang from re-compiling C libraries?," I'm trying to find a way to make the compilation of a Go program faster. It is currently about 30 seconds, which makes it slow to work with the project.When I run go build -v, I see that most of the time is spent compiling go-sqlite3 (which links to the C sqlite lib). However, since this lib never changes, I'm wondering if it's possible to prevent the build tool from recompiling this every time? <code> ",How to improve Golang compilation speed?
"Go/Golang, Flatten a Nested JSON"," Trying to flatten a nested json response from 2 levels deep down to 1.Here is my working code on Go Playground: http://play.golang.org/p/kHAYuZUTkoI want to end up with: ...instead of a Social type containing a nested Facebook type (seen in the code below).I suspect I'll need to do a custom UnmarshalJSON function, but I don't know how those work and I'm new to Go.Suggestions?Here is the code from the Go Playground link above: <code>  type Social struct { GooglePlusPlusOnes uint32 `Social:""GooglePlusOne""` TwitterTweets uint32 `json:""Twitter""` LinkedinShares uint32 `json:""LinkedIn""` PinterestPins uint32 `json:""Pinterest""` StumbleuponStumbles uint32 `json:""StumbleUpon""` DeliciousBookmarks uint32 `json:""Delicious""` FacebookLikes uint32 `json:""??some_magical_nested_address??""` FacebookShares uint32 `json:""??some_magical_nested_address??""` FacebookComments uint32 `json:""??some_magical_nested_address??""` FacebookTotal uint32 `json:""??some_magical_nested_address??""`} package mainimport ( ""encoding/json"" ""fmt"")type Social struct { GooglePlusPlusOnes uint32 `json:""GooglePlusOne""` TwitterTweets uint32 `json:""Twitter""` LinkedinShares uint32 `json:""LinkedIn""` PinterestPins uint32 `json:""Pinterest""` StumbleuponStumbles uint32 `json:""StumbleUpon""` DeliciousBookmarks uint32 `json:""Delicious""` Facebook Facebook}type Facebook struct { FacebookLikes uint32 `json:""like_count""` FacebookShares uint32 `json:""share_count""` FacebookComments uint32 `json:""comment_count""` FacebookTotal uint32 `json:""total_count""`}func main() { var jsonBlob = []byte(`[ {""StumbleUpon"":0,""Reddit"":0,""Facebook"":{""commentsbox_count"":4691,""click_count"":0,""total_count"":298686,""comment_count"":38955,""like_count"":82902,""share_count"":176829},""Delicious"":0,""GooglePlusOne"":275234,""Buzz"":0,""Twitter"":7346788,""Diggs"":0,""Pinterest"":40982,""LinkedIn"":0} ]`) var social []Social err := json.Unmarshal(jsonBlob, &social) if err != nil { fmt.Println(""error:"", err) } fmt.Printf(""%+v"", social)}",How to flatten nested JSON
Golang map to json," I tried to convert my Go map to a json string with encoding/json Marshal, but it resulted in a empty string.Here's my code : My output is : I really don't know where I'm wrong. Thank you for your help. <code>  package mainimport ( ""encoding/json"" ""fmt"")type Foo struct { Number int `json:""number""` Title string `json:""title""`}func main() { datas := make(map[int]Foo) for i := 0; i < 10; i++ { datas[i] = Foo{Number: 1, Title: ""test""} } jsonString, _ := json.Marshal(datas) fmt.Println(datas) fmt.Println(jsonString)} map[9:{1 test} 2:{1 test} 7:{1 test} 3:{1 test} 4:{1 test} 5:{1 test} 6:{1 test} 8:{1 test} 0:{1 test} 1:{1 test}][]",Convert Go map to json
Read data from a socket with an unknown length," How could I socket.ReadFromUDP without knowing the length beforehand? Right now I have something like this. I tried this, but it always read 1024 bytes. The packets I'm receiving from the server vary from a couple of bytes to hundres of bytes. <code>  buff := make([]byte, <unknownLength>)for { socket.ReadFromUDP(buff) fmt.Println(""Bytes read:"", buff.Len())} buff := make([]byte, 1024)for { bytesRead, _, _ := socket.ReadFromUDP(buff) fmt.Println(""Bytes read:"", bytesRead)}",Read data from a UDP socket with an unknown length
Go(lang) Defer behavior," Effective Gostates the following regarding defer: The arguments to the deferred function (which include the receiver if the function is a method) are evaluated when the defer executes, not when the call executes. Besides avoiding worries about variables changing values as the function executes, this means that a single deferred call site can defer multiple function executions. Here's a silly example. Deferred functions are executed in LIFO order, so this code will cause 4 3 2 1 0 to be printed when the function returns.This example confuses me. If parameters are evaluated when the defer call is executed, then the defers in the for loop should print 5 5 5 5 5 since the defers will be called when the for loop ends, and at that time i would be 5. Evaluating defers at the end of the for loop will thus result in 5 for all calls.Am I missing something here? <code>  for i := 0; i < 5; i++ { defer fmt.Printf(""%d "", i)}",Golang defer behavior
One struct with multiple json representations in Golang," The problem I'm trying to solve is that I have a model of a community that looks like this Communities hold a lot of information and there are scenarios when I want to return only part of the description such as if I'm returning a list of trending communities. In this case I'd want to return only The only way I can think of doing this is to create a new type containing only those fields and write a convenience method that takes a community and returns that type, but essentially creating a new object and copying those fields by value, is there a better way to do this? I'm aware of the json:""-"" syntax, but I'm not sure of how you could do this on a case by case basis as I still need to sometimes return the full object, perhaps a different type that is converted to? <code>  type Community struct { Name string Description string Sources []Source Popularity int FavoriteCount int Moderators []string Children []Community Tracks []Track} type Community struct { Name string Description string Popularity int FavoriteCount int}",One struct with multiple json representations
Go: Write Struct to Json File using Struct Fields (not json keys)," How can I read a json file into a struct, and then Marshal it back out to a json string with the Struct fields as keys (rather than the original json keys)?(see Desired Output to Json File below...)Code: Output on screen: Output to Json File: Desired Output to Json File: <code>  package mainimport ( ""encoding/json"" ""fmt"" ""io/ioutil"")type Rankings struct { Keyword string `json:""keyword""` GetCount uint32 `json:""get_count""` Engine string `json:""engine""` Locale string `json:""locale""` Mobile bool `json:""mobile""`}func main() { var jsonBlob = []byte(` {""keyword"":""hipaa compliance form"", ""get_count"":157, ""engine"":""google"", ""locale"":""en-us"", ""mobile"":false} `) rankings := Rankings{} err := json.Unmarshal(jsonBlob, &rankings) if err != nil { // nozzle.printError(""opening config file"", err.Error()) } rankingsJson, _ := json.Marshal(rankings) err = ioutil.WriteFile(""output.json"", rankingsJson, 0644) fmt.Printf(""%+v"", rankings)} {Keyword:hipaa compliance form GetCount:157 Engine:google Locale:en-us Mobile:false} {""keyword"":""hipaa compliance form"",""get_count"":157,""engine"":""google"",""locale"":""en-us"",""mobile"":false} {""Keyword"":""hipaa compliance form"",""GetCount"":157,""Engine"":""google"",""Locale"":""en-us"",""Mobile"":false}",Write Struct to Json File using Struct Fields (not json keys)
When is the init() function in go (golang) run?," I've tried to find a precise explanation of what the init() function does in Go. I read what Effective Go says but I was unsure if I understood fully what it said. The exact sentence I am unsure is the following:And finally means finally: init is called after all the variable declarations in the package have evaluated their initializers, and those are evaluated only after all the imported packages have been initialized.What does all the variable declarations in the package have evaluated their initializers mean? Does it mean if you declare ""global"" variables in a package and its files, init() will not run until all of it is evaluated and then it will run all the init function and then main() when ./main_file_name is ran?I also read Mark Summerfield's go book the following:If a package has one or more init() functions they are automatically executed before the main package's main() function is called.In my understanding, init() is only relevant when you intend to run main() right? Anyone understands more precisely init() feel free to correct me <code> ",When is the init() function run?
When is the init() function in Go (Golang) run?," I've tried to find a precise explanation of what the init() function does in Go. I read what Effective Go says but I was unsure if I understood fully what it said. The exact sentence I am unsure is the following:And finally means finally: init is called after all the variable declarations in the package have evaluated their initializers, and those are evaluated only after all the imported packages have been initialized.What does all the variable declarations in the package have evaluated their initializers mean? Does it mean if you declare ""global"" variables in a package and its files, init() will not run until all of it is evaluated and then it will run all the init function and then main() when ./main_file_name is ran?I also read Mark Summerfield's go book the following:If a package has one or more init() functions they are automatically executed before the main package's main() function is called.In my understanding, init() is only relevant when you intend to run main() right? Anyone understands more precisely init() feel free to correct me <code> ",When is the init() function run?
Initialize a nested struct in Golang," I cannot figure out how to initialize a nested struct. Find an example here:http://play.golang.org/p/NL6VXdHrjh <code>  package maintype Configuration struct { Val string Proxy struct { Address string Port string }}func main() { c := &Configuration{ Val: ""test"", Proxy: { Address: ""addr"", Port: ""80"", } }}",How to initialize a nested struct?
Initialize a nested struct," I cannot figure out how to initialize a nested struct. Find an example here:http://play.golang.org/p/NL6VXdHrjh <code>  package maintype Configuration struct { Val string Proxy struct { Address string Port string }}func main() { c := &Configuration{ Val: ""test"", Proxy: { Address: ""addr"", Port: ""80"", } }}",How to initialize a nested struct?
How do you get a go (golang) program to print the line number of the error it just called?," I was trying to throw errors in my Golang program with log.Fatal but, log.Fatal does not also print the line where the log.Fatal was ran. Is there no way of getting access to the line number that called log.Fatal? i.e. is there a way to get the line number when throwing an error?I was trying to google this but was unsure how. The best thing I could get was printing the stack trace, which I guess is good but might be a little too much. I also don't want to write debug.PrintStack() every time I need the line number, I am just surprised there isn't any built in function for this like log.FatalStackTrace() or something that isn't costume.Also, the reason I do not want to make my own debugging/error handling stuff is because I don't want people to have to learn how to use my special costume handling code. I just want something standard where people can read my code later and be like ""ah ok, so its throwing an error and doing X...""The less people have to learn about my code the better :) <code> ",How do you get a Golang program to print the line number of the error it just called?
Golang test driven development to check database queries involved methods," I want to create a database driven application using Golang. I am trying to do it TDD way.When I try to test methods that make Sql queries, What all are the packages available ?I don't want to connect to the default database that I use for development. I can write code to take up another test database while running a test, but is there any go library that already does it.Is there any library that does db tests without connecting to database at all ?What is the standard way to do database test with golang ?  <code> ",Test driven development to check database queries involved methods
Case insensitive string comparison in golang," How do I search through a file for a word in a case insensitive manner? For example If I'm searching for UpdaTe in the file, if the file contains update, the search should pick it and count it as a match. <code> ",Case insensitive string search in golang
GoLang: import a specific version of a package," coming from a Node environment I used to install a specific version of a vendor lib into the project folder (node_modules) by telling npm to install that version of that lib from the package.json or even directly from the console, like so: Then I used to import that version of that package in my project just with: Now, I want to do the same thing with go. How can I do that?Is it possible to install a specific version of a package? If so, using a centralized $GOPATH, how can I import one version instead of another?I would do something like this: But then, how can I make a difference during the import? <code>  $ npm install express@4.0.0 var express = require('express'); $ go get github.com/wilk/uuid@0.0.1$ go get github.com/wilk/uuid@0.0.2",How do I import a specific version of a package using go get?
How do I import a specific version of a package?," coming from a Node environment I used to install a specific version of a vendor lib into the project folder (node_modules) by telling npm to install that version of that lib from the package.json or even directly from the console, like so: Then I used to import that version of that package in my project just with: Now, I want to do the same thing with go. How can I do that?Is it possible to install a specific version of a package? If so, using a centralized $GOPATH, how can I import one version instead of another?I would do something like this: But then, how can I make a difference during the import? <code>  $ npm install express@4.0.0 var express = require('express'); $ go get github.com/wilk/uuid@0.0.1$ go get github.com/wilk/uuid@0.0.2",How do I import a specific version of a package using go get?
How to parse variables outside the range ? go-lang tempaltes, I have two structs as below and I need to render the data on a template using the templates pack. I get this error <.Email>: Email is not a field of struct type Notes.The issue seems to be that only fields of the range struct seem to be available within the range loop so I'm wondering how I can import fields from outside the range struct (e.g. the Email string).The behavior is quite unexpected. HTML I've checked the godocs but they seem quite useless.  <code>  type notes struct{ Note string sf string}type uis struct{ notes []Note Email string}var ui uis {{range .notes}} {{.Email}} {{.sf}} {{end}}Email {{.Email}},How do I parse variables outside the range in Go templates?
Different ways to pass channels as arguments in function in go (golang)," I was reading some go code and say a few different ways to pass go channels. Maybe they are the same but I was wondering if there is any difference since I couldn't find documentation online:1) 2) 3) 4) I was wondering what the difference between them were and if they were just equivalent ways to do the same thing: pass a channel around different goroutines.NOTE: I am aware that there is no reason to pass a pointer to a chan, map, or slice, or function value, since those are all reference types which internally contain a pointer (the exception would be if you want the callee to change the reference type header). The only reason I provided it is for completeness (i.e. to really provide every way a channel could be attempted to be passed as a parameter and to make on question that hopefully, references all ways to do this and compares them). <code>  func serve(ch <-chan interface{}){ //do stuff } func serve(ch chan<- interface{}){ //do stuff } func serve(ch chan interface{}){ //do stuff } func server(ch *chan interface{}){ //do stuff}",Different ways to pass channels as arguments in function
Go: What does ^ do?," I hope this question is not too stupid... I have no idea what the ^ operator does in Go, e.g.a := 3^500At first I thought it must be pow but it most certainly is not. It's not mod (%) either.I've tried looking through the doc and searching on Google, but unfortunately Google doesn't think ^ is a search term. <code> ",What does ^ do?
Go: Overhead of converting from []byte to string and vice-versa," I always seem to be converting strings to []byte to string again over and over. Is there a lot of overhead with this? Is there a better way?For example, here is a function that accepts a UTF8 string, normalizes it, remove accents, then converts special characters to ASCII equivalent: So I'm starting with a string because that's what I get, then I'm converting it to a byte array, then back to a string, then to a byte array again, then back to a string again. Surely this is unnecessary but I can't figure out how to not do this..? And does it really have a lot of overhead or do I not have to worry about slowing things down with excessive conversions?(Also if anyone has the time I've not yet figured out how bytes.Buffer actually works, would it not be better to initialize a buffer of 2x the size of the string, which is the maximum output size of the return value?) <code>  var transliterations = map[rune]string{'':""AE"",'':""D"",'':""L"",'':""OE"",'':""Th"",'':""ss"",'':""ae"",'':""d"",'':""l"",'':""oe"",'':""th"",'':""OE"",'':""oe""}func RemoveAccents(s string) string { b := make([]byte, len(s)) t := transform.Chain(norm.NFD, transform.RemoveFunc(isMn), norm.NFC) _, _, e := t.Transform(b, []byte(s), true) if e != nil { panic(e) } r := string(b) var f bytes.Buffer for _, c := range r { temp := rune(c) if val, ok := transliterations[temp]; ok { f.WriteString(val) } else { f.WriteRune(temp) } } return f.String()}",Overhead of converting from []byte to string and vice-versa
How to set environment variables that last ? in go," I'm trying to set some environment variables on my machine using Go OS It seems the variable is available to the Go program but once I quite / terminate the Go process the variable is no longer available. I'm wondering if it's possible to set these variables permanently. The reason is that i was looking to create a ""setup"" file with config files ( db name etc ) for the local and dev environment so that I could switch between without any setup at all... just one time go run setup.go.  <code>  err := os.Setenv(""DBHOST"", dbHostLocal) if err != nil { log.Fatalf(""err %v"", err) }",How to set environment variables that last
Whats the correct golang way to do this:," This seems a bit stupid, surely theres a better way? Update: For the record, 5 years on from when I wrote this, I am now persuaded that this is a completely sufficient, and perhaps even better, way to handle errors clearly. Not saying its pretty though. <code>  err = SendMessageAndWait(db, ""this is a test"")if err != nil { fmt.Println(""Error sending message"", err) return}err = DoSomething(db, ""this is a test"")if err != nil { fmt.Println(""Error sending message"", err) return}err = CheckSomething(db, ""this is another test"")if err != nil { fmt.Println(""Error sending message"", err) return}err = SendMessageAndWait(db, ""this is a third test"")if err != nil { fmt.Println(""Error sending message"", err) return}... x10 ...",Whats the correct Go way to do handle errors
Process.Kill() on web server," I'm trying to stop the process started with exec.Command(""go"", ""run"", ""server.go"") and all its child processes.But when I call cmd.Process.Kill() and the go process stops, the child process (a web server in server.go) continues to run. It looks like Process.Kill() only stops the go (run) process, but leaves its child process (web server) running. ^C kills the whole process group, including all child (and sub-child) processes. How can I do the same?I tried cmd.Process.Signal(os.Interrupt), syscall.SIGINT, syscall.SIGQUIT and syscall.SIGKILL, none of which did anything. <code>  package mainimport ( ""fmt"" ""os/exec"" ""time"")func run() *exec.Cmd { cmd := exec.Command(""go"", ""run"", ""server.go"") err := cmd.Start() if err != nil { panic(err) } return cmd}func main() { cmd := run() time.Sleep(time.Second * 2) err := cmd.Process.Kill() if err != nil { panic(err) } cmd.Process.Wait() // === Web server is still running! === fmt.Scanln()}",Process.Kill() on child processes
How to parse unix timestamp in golang," I'm trying to parse an Unix timestamp but I get out of range error. That doesn't really makes sense to me, because the layout is correct (as in the Go docs): Playground <code>  package mainimport ""fmt""import ""time""func main() { tm, err := time.Parse(""1136239445"", ""1405544146"") if err != nil{ panic(err) } fmt.Println(tm)}",How to parse unix timestamp to time.Time
Allocation: new vs Foo{}, What is the difference between the following syntaxes for creating an object? Why 2 different methods if result is the same? <code>  type Foo struct { X int}f1 := &Foo{}f2 := new(Foo),Allocation: new(Foo) vs Foo{}
Anonymous struct as value to a map," I am using go 1.3.How can I access the fields of the anonymous struct ValueType of the map ?  <code>  package mainimport ""fmt""type Words map[string]struct{ pos int n int}func main() { w := make(Words) w[""abc""].pos = 5 // cannot assign fmt.Println(w)}",Assign to anonymous struct value in map
How to handle a specific error in go?," I'm trying to handle specific errors but I'm surprised about the behavior. Examples:If I use it returns true, even if err is nil. If I use it panics when err is nil. I really expected to work and I'm not sure why it returns true.Some more code:Here is some code to clarify the question (Play): <code>  if err == errors.New(""something""){}` if err.String() == ""something""` err == errors.New(""something"")` package mainimport ""fmt""import ""errors""func main() { e := errors.New(""error"") //I'm expecting this to return true if e == errors.New(""error"") { fmt.Println(""Hello, playground"") }}",Unclear behavior at specific error handling
Go: strings.Split on newline?," I'm trying to do the rather simple task of splitting a string by newlines.This does not work: I also tried ' instead of ` but no luck.Any ideas? <code>  temp := strings.Split(result,`\n`)",How to strings.Split on newline?
golang set flag after command," i am building a little cli tool that boots my app in development or production.the way i want it to work is like this: Atm it doest parses the flags after my command but only before my command. So this works Any idee how to fix it this so i can use it after my command? here is my code <code>  app run --dev or app run --prod app --dev run or app --prod run func main() { //flag.Usage := usage flag.Parse() args := flag.Args() if len(args) == 0 { Usage() os.Exit(0) } if *dev { os.Setenv(""ENV"", ""development"") } if *prod { os.Setenv(""ENV"", ""production"") } switch { // Run case args[0] == ""run"" && len(args) == 1: os.Setenv(""port"", *port) log.Printf(""Booting in %s"", os.Getenv(""ENV"")) Run() // Help case args[0] == ""help"" && len(args) == 1: Usage() }}",golang flag stops parsing after the first non-option
Golang unmarshal ignore empty fields," I get a JSON from a client on the successful submit of user details.Some element in the JSON can be skipped since they were not updated.On the Go server side, I have an equivalent struct defined.The server successfully marshals the JSON bytes into the struct. But for fields which are not recieved from client, unmarshal by default hard-codes nil for string and empty array for string array.For example, if I get the json { ""Id"" : 64, ""Name"" : ""Ryan"" }, I don't want unmarshal to convert it to {""Id"" : some hexadecimal, ""Name"" : some hexadecimal, ""Age"" : nil}. To make it simple, I would expect it to be {""Id"" : some hexadecimal, ""Name"" : some hexadecimal }How can I totally ignore the field and map what I get?Goplayground Code : http://play.golang.org/p/3dZq0nf68R <code>  type user struct { Id *int64 `json:"",omitempty""` Name *string `json:"",omitempty""` Age *int64 `json:"",omitempty""`}",unmarshal ignore empty fields
How can I use channel send direction in golang," In Go, it can be specified which direction a channel can send. I am trying to create an example about it, look at the following code: I get the compiler error How can I use channel direction in the right way?Or does anyone have a better sample than me? <code>  package mainimport ( ""fmt"" ""time"")func main() { ic_send_only := make(<-chan int) //a channel that can only send data - arrow going out is sending ic_recv_only := make(chan<- int) //a channel that can only receive a data - arrow going in is receiving go func() { ic_recv_only <- 4555 }() go func() { ic_send_only <- ic_recv_only }() fmt.Println(ic_recv_only) time.Sleep(10000)} # command-line-arguments.\send_receive.go:19: invalid operation: ic_send_only <- ic_recv_only (send to receive-only type <-chan int)[Finished in 0.2s with exit code 2]",How can I use channel send direction in Go
Should I use bufio for writing gzip files?," I noticed the gzip package uses bufio internally for reading gzipped files, but not for writing them. I know that buffering is important for I/O performance, so what is the proper way to buffer a gzip writer? Also, do I need to Flush() the gzip writer or the bufio writer (or both) before closing it, or will closing it automatically flush the writer?UPDATE: I now understand that both reads and writes are buffered with gzip. So buffering a gzip.Writer is really double buffering. @peterSO thinks this is redundant. @Steven Weinberg thinks double buffering may reduce the number of syscalls, but suggests benchmarking to be sure. <code>  // ignoring error handling for this exampleoutFile, _ := os.Create(""output.gz"")// Alternative 1 - bufio.Writer wraps gzip.WritergzipWriter, _ := gzip.NewWriter(outFile)writer, _ := bufio.NewWriter(gzipWriter)// Alternative 2 - gzip.Writer wraps bufio.Writerwriter, _ := bufio.NewWriter(outFile)gzipWriter, _ := gzip.NewWriter(writer)// Alternative 3 - replace bufio with bytes.Bufferbuf := bytes.NewBuffer()gzipWriter, _ := gzip.NewWriter(&buf)",How should I add buffering to a gzip writer?
Go / Golang - Serialize a map using a specific order," I have a map that uses string for both key and value. I have an array of keys that specifies the order of the values of the map.I want to serialize that map to a JSON, but keeping the order defined on the array.There is a sample code here: http://play.golang.org/p/A52GTDY6WxI want to serialize it as: But if I serialize the map directly, the keys are ordered alphabetically: I can serialize it as an array of maps, thus keeping the order, however that generates a lot of undesired characters: In my real code I need to serialize the results of a database query which is specified in a text file, and I need to maintain the column order. I cannot use structs because the columns are not known at compile time.EDIT: I don't need to read the JSON later in the specified order. The generated JSON is meant to be read by people, so I just want it to be as humanly readable as possible.I could use a custom format but JSON suits me perfectly for this.Thanks! <code>  { ""name"": ""John"", ""age"": ""20""} { ""age"": ""20"", ""name"": ""John""} [ { ""name"": ""John"" }, { ""age"": ""20"" }]",Serialize a map using a specific order
"""invalid character '\\x00' after top-level value"",", I am getting this error while unmarshalling json in a for loop.The first time through the loop is unmarshalling fine but on the next iteration I am getting this error.I am new to golang and this error message is not clear. Can someone please explain in what cases this error occurs and how I am supposed to avoid it. <code> ,"""invalid character '\x00' after top-level value"""
"""invalid character '\\x00' after top-level value""", I am getting this error while unmarshalling json in a for loop.The first time through the loop is unmarshalling fine but on the next iteration I am getting this error.I am new to golang and this error message is not clear. Can someone please explain in what cases this error occurs and how I am supposed to avoid it. <code> ,"""invalid character '\x00' after top-level value"""
How are people managing authentication in golang?," For those building RESTful APIs and JS front-end apps in Go, how are you managing authentication? Are you using any particular libraries or techniques?I'm surprised to find so little discussion about this. I keep in mind answers like the following, and am trying to avoid developing my own implementation:Authentication Form in ASP.NetIs everybody coding their own solution, separately? <code> ",How are people managing authentication in Go?
GO: error connecting to database with mysqldriver," I'm trying to follow the instructions here https://github.com/go-sql-driver/mysql#installation and http://go-database-sql.org/accessing.html to create a sql.db.The first line of my code has this When I ran the program on the terminal, I got this: Why is this? When I checked the user and host to mysql it states 'username' and 'localhost'. I followed the parameters like this: <code>  db, err := sql.Open(""mysql"", ""username@localhost/my_db"") Default addr for network ''localhost'' unknown [username[:password]@][protocol[(address)]]/dbname[?param1=value1&...&paramN=valueN]",error connecting to database with mysqldriver
Go: Always have x number of goroutines running at any time," I see lots of tutorials and examples on how to make Go wait for x number of goroutines to finish, but what I'm trying to do is have ensure there are always x number running, so a new goroutine is launched as soon as one ends.Specifically I have a few hundred thousand 'things to do' which is processing some stuff that is coming out of MySQL. So it works like this: Currently that will launch several hundred thousand threads of processTheThing(). What I need is that a maximum of x number (we'll call it 20) goroutines are launched. So it starts by launching 20 for the first 20 rows, and from then on it will launch a new goroutine for the next id the moment that one of the current goroutines has finished. So at any point in time there are always 20 running.I'm sure this is quite simple/standard, but I can't seem to find a good explanation on any of the tutorials or examples or how this is done. <code>  db, err := sql.Open(""mysql"", connection_string)checkErr(err)defer db.Close()rows,err := db.Query(`SELECT id FROM table`)checkErr(err)defer rows.Close()var id uintfor rows.Next() { err := rows.Scan(&id) checkErr(err) go processTheThing(id) }checkErr(err)rows.Close()",Always have x number of goroutines running at any time
"Convert UTC to ""local"" time - Go"," How can I convert UTC time to local time?I've created a map with the UTC difference for all the countries I need the local time. Then I add that difference as duration to the current time (UTC) and print the result hoping that's the local time of that specific country.For some reasons the result is wrong. For example with Hungary there is one hour difference. Any idea why I'm getting incorrect results? <code>  package mainimport ""fmt""import ""time""func main() { m := make(map[string]string) m[""Hungary""] = ""+01.00h"" offSet, err := time.ParseDuration(m[""Hungary""]) if err != nil { panic(err) } t := time.Now().UTC().Add(offSet) nice := t.Format(""15:04"") fmt.Println(nice)}","Convert UTC to ""local"" time in Go"
user a literal for type in assignment," I'm using the code in func Root as a guide to create another method Login shown below. In particular, in Root, I assign the literal Book{} to b and then use the result in the Scan. That code doesn't throw any errors (although I'm not sure if it's nice code), but when I try to do something similar in the Login function, which I'm modifying from this blogpost, I get this error for what it's worth, I also get this error right above when I compile but aren't I doing the same thing in the second method, namely assigning the literal u := User{} to a variable and then using it in the scan? Can you explain using the code below when you can and can't use a literal for type in an assignment? <code>  cannot use User literal (type User) as type *User in assignment no new variables on left side of := func Root(w http.ResponseWriter, r *http.Request) { rows, err := db.Query(""SELECT title, author, description FROM books"") books := []Book{} for rows.Next() { b := Book{} err := rows.Scan(&b.Title, &b.Author, &b.Description) PanicIf(err) books = append(books, b) } ...//code ommittedfunc Login(password, email string) (u *User, err error) { u := User{} db.QueryRow(""select * from users where email=$1 "", email).Scan(&u.Id, &u.Password, &u.Email) if err != nil { return } err = bcrypt.CompareHashAndPassword(u.Password, []byte(password)) if err != nil { u = nil } return}",use a literal for type in assignment
What is the different between new and make?," New does not initialize the memory, it only zeros it. It returns a pointer to a newly allocated zero value.Make creates slices, maps, and channels only, and it returns them initialized.What does ""initialized"" mean in this context?What other differences are there between new and make? <code> ",What is the difference between new and make?
Golang - Timezone parsing," In the example bellow the result is always ""[date] 05:00:00 +0000 UTC"" regardless the timezone you choose for the parseAndPrint function. What is wrong with this code? The time should change depending on the timezone you choose. (Go Playground servers are apparently configured in UTC timezone).http://play.golang.org/p/wP207BWYEd <code>  package mainimport ( ""fmt"" ""time"")func main() { now := time.Now() parseAndPrint(now, ""BRT"") parseAndPrint(now, ""EDT"") parseAndPrint(now, ""UTC"")}func parseAndPrint(now time.Time, timezone string) { test, err := time.Parse(""15:04:05 MST"", fmt.Sprintf(""05:00:00 %s"", timezone)) if err != nil { fmt.Println(err) return } test = time.Date( now.Year(), now.Month(), now.Day(), test.Hour(), test.Minute(), test.Second(), test.Nanosecond(), test.Location(), ) fmt.Println(test.UTC())}",How to properly parse timezone codes
too many arguments to return ( golang )," In a print function I am writing, I am trying to return a value based on the result of a switch statement; however, I am getting the error too many arguments to return.Forgive me if this question has a simple answer, but shouldn't it not matter how many arguments a function has and it can return just one thing? Or does it need to return one thing for each argument.Here is my code. I am getting an error on the return line ( Too many arguments to return ). How can I fix it so that it returns the string set in the switch statement? <code>  package bayfunc Print(DATA []TD, include string, exclude []string, str string) { result := NBC(DATA, include, exclude, str) var sentAnal string switch result { case 1: sentAnal = ""Strongly Negative"" case 2: sentAnal = ""Very Negative"" case 3: sentAnal = ""Negative"" case 4: sentAnal = ""Little Negative"" case 5: sentAnal = ""Neurtral"" case 6: sentAnal = ""Little Positive"" case 7: sentAnal = ""Positive"" case 8: sentAnal = ""More Positive"" case 9: sentAnal = ""Very Positive"" case 10: sentAnal = ""Strongly Positive"" default: sentAnal = ""Unknown"" } return sentAnal}","How to solve ""too many arguments to return"" issue"
"How to solve ""too many arguments to return"" issue in Golang?"," In a print function I am writing, I am trying to return a value based on the result of a switch statement; however, I am getting the error too many arguments to return.Forgive me if this question has a simple answer, but shouldn't it not matter how many arguments a function has and it can return just one thing? Or does it need to return one thing for each argument.Here is my code. I am getting an error on the return line ( Too many arguments to return ). How can I fix it so that it returns the string set in the switch statement? <code>  package bayfunc Print(DATA []TD, include string, exclude []string, str string) { result := NBC(DATA, include, exclude, str) var sentAnal string switch result { case 1: sentAnal = ""Strongly Negative"" case 2: sentAnal = ""Very Negative"" case 3: sentAnal = ""Negative"" case 4: sentAnal = ""Little Negative"" case 5: sentAnal = ""Neurtral"" case 6: sentAnal = ""Little Positive"" case 7: sentAnal = ""Positive"" case 8: sentAnal = ""More Positive"" case 9: sentAnal = ""Very Positive"" case 10: sentAnal = ""Strongly Positive"" default: sentAnal = ""Unknown"" } return sentAnal}","How to solve ""too many arguments to return"" issue"
Why isn't Go linking my assembly properly?," I'm trying to write some SIMD mostly for learning purposes. I know Go can link assembly, but I can't get it to work correctly.Here's the most minimal example I can make (element-wise vector multiplication):vec_amd64.s (note: the actual file has a whitespace line under RET since it causes errors otherwise) vec.go simd_test.go When I try to run go test I get the error: The go env command reports my GOHOSTARCH to be amd64 and my Go version to be 1.3. To confirm it wasn't the architecture causing the problem, I found another package that uses assembly and deleted all the assembly files except the _amd64.s one and its tests ran fine.I also tried changing it to an exported identifier in case that was causing weirdness, but no dice. I think I pretty closely followed the template in packages like math/big, so hopefully it's something simple and obvious that I'm missing.I know that Go is at least trying to use the assembly because if I introduce a syntax error to the .s file the build tool will complain about it.Edit:To be clear, go build will compile cleanly, but go test causes the error to appear. <code>  // func mul(v1, v2 Vec4) Vec4TEXT .mul(SB),4,$0-48 MOVUPS v1+0(FP), X0 MOVUPS v2+16(FP), X1 MULPS X1, X0 // also tried ret+32 since I've seen some places do that MOVUPS X0, toReturn+32(FP) RET package simdtype Vec4 [4]float32func (v1 Vec4) Mul(v2 Vec4) Vec4 { return Vec4{v1[0] * v2[0], v1[1] * v2[1], v1[2] * v2[2], v1[3] * v2[3]}}func mul(v1, v2 Vec4) Vec4 package simdimport ( ""testing"")func TestMul(t *testing.T) { v1 := Vec4{1, 2, 3, 4} v2 := Vec4{5, 6, 7, 8} res := v1.Mul(v2) res2 := mul(v1, v2) // Placeholder until I get it to compile if res != res2 { t.Fatalf(""Expected %v; got %v"", res, res2) }} # testmainsimd.TestMul: call to external function simd.mulsimd.TestMul: undefined: simd.mul",Go isn't linking my assembly: undefined external function
"go lang, struct: what is the third parameter"," I understand what the first two columns are,but what is json:""commitIndex""? <code>  type Config struct { CommitIndex uint64 `json:""commitIndex""` // TODO decide what we need to store in peer struct Peers []*Peer `json:""peers""`}",What is the third parameter of a Go struct field?
Golang declare slice or make slice?," In Go, what is the difference between var s []int and s := make([]int, 0)?I find that both works, but which one is better? <code> ",Declare slice or make slice?
Golang goroutines. How do they work," I was following the Go Tour and I am a bit stuck when it comes to goroutines. I understand that they are very lightweight and that every time a goroutine blocks, another one will start but I can't get my head around how this example actually works: PlaygroundI understand that a goroutine is started for the say function with the argument ""world"", but as far as I understand that should print ""world"" five times and ""hello"" once. However I don't understand why the output is as it is: From my limited understanding of threads from other languages the output should have been something like this: or like this: Why does the second line execute five times as well? Does anything below a go statement classify as part of the go routine?Also the next slide shows something I can't get my head round again: PlaygroundA goroutine is started for the second half of the slice and then another one for the first part of the slice, however the values x and y have been assigned two different values. The way I see it the sum function will send it's sum to channel c and then the next sum will send it's sum to the same channel c so how can the two variables be assigned two different values? Shouldn't channel c have one single sum value in there?I appreciate that this is quite a long question but I wasn't able to find the answer to these questions.  <code>  package mainimport ( ""fmt"" ""time"")func say(s string) { for i := 0; i < 5; i++ { time.Sleep(1000 * time.Millisecond) fmt.Println(s) }}func main() { go say(""world"") say(""hello"")} helloworldhelloworldhelloworldhelloworldhello helloworldworldworldworldworld world worldworldhelloworldworld package mainimport ""fmt""func sum(a []int, c chan int) { sum := 0 for _, v := range a { sum += v } c <- sum // send sum to c}func main() { a := []int{7, 2, 8, -9, 4, 0} c := make(chan int) go sum(a[:len(a)/2], c) go sum(a[len(a)/2:], c) x, y := <-c, <-c // receive from c fmt.Println(x, y, x+y)}",How do goroutines work?
Golang : How to serve static files with basic authentication," I cannot make basic authentication work with http.FileServer using github.com/abbot/go-http-auth. The code: works in main() without authentication, but cannot use it along with auth.JustCheck. I tried with handleFileServer function, but nothing is displayed. What's the trick? <code>  package mainimport ( ""fmt"" ""log"" ""net/http"" ""github.com/abbot/go-http-auth"")func Secret(user, realm string) string { users := map[string]string{ ""john"": ""$1$dlPL2MqE$oQmn16q49SqdmhenQuNgs1"", //hello } if a, ok := users[user]; ok { return a } return """"}func doRoot(w http.ResponseWriter, r *http.Request) { fmt.Fprintf(w, ""<h1>static file server</h1><p><a href='./static'>folder</p>"")}func handleFileServer(w http.ResponseWriter, r *http.Request) { fs := http.FileServer(http.Dir(""static"")) http.StripPrefix(""/static/"", fs)}func main() { authenticator := auth.NewBasicAuthenticator(""localhost"", Secret) // how to secure the FileServer with basic authentication?? // fs := http.FileServer(http.Dir(""static"")) // http.Handle(""/static/"", http.StripPrefix(""/static/"", fs)) http.HandleFunc(""/static/"", auth.JustCheck(authenticator, handleFileServer)) http.HandleFunc(""/"", auth.JustCheck(authenticator, doRoot)) log.Println(`Listening... http://localhost:3000 folder is ./static authentication in map users`) http.ListenAndServe("":3001"", nil)} fs := http.FileServer(http.Dir(""static""))http.Handle(""/static/"", http.StripPrefix(""/static/"", fs))",How to serve static files with basic authentication?
How to serve static files with basic authentication in Golang?," I cannot make basic authentication work with http.FileServer using github.com/abbot/go-http-auth. The code: works in main() without authentication, but cannot use it along with auth.JustCheck. I tried with handleFileServer function, but nothing is displayed. What's the trick? <code>  package mainimport ( ""fmt"" ""log"" ""net/http"" ""github.com/abbot/go-http-auth"")func Secret(user, realm string) string { users := map[string]string{ ""john"": ""$1$dlPL2MqE$oQmn16q49SqdmhenQuNgs1"", //hello } if a, ok := users[user]; ok { return a } return """"}func doRoot(w http.ResponseWriter, r *http.Request) { fmt.Fprintf(w, ""<h1>static file server</h1><p><a href='./static'>folder</p>"")}func handleFileServer(w http.ResponseWriter, r *http.Request) { fs := http.FileServer(http.Dir(""static"")) http.StripPrefix(""/static/"", fs)}func main() { authenticator := auth.NewBasicAuthenticator(""localhost"", Secret) // how to secure the FileServer with basic authentication?? // fs := http.FileServer(http.Dir(""static"")) // http.Handle(""/static/"", http.StripPrefix(""/static/"", fs)) http.HandleFunc(""/static/"", auth.JustCheck(authenticator, handleFileServer)) http.HandleFunc(""/"", auth.JustCheck(authenticator, doRoot)) log.Println(`Listening... http://localhost:3000 folder is ./static authentication in map users`) http.ListenAndServe("":3001"", nil)} fs := http.FileServer(http.Dir(""static""))http.Handle(""/static/"", http.StripPrefix(""/static/"", fs))",How to serve static files with basic authentication?
Can goroutine like erlang spawn across multiple machines transparent?," It is said that if configured erlang with cookie setting, the erlang's process could be run across different machines, and this is transparent to the caller.Is that possible for goroutine run like this? <code> ",Can goroutine like erlang spawn process across multiple hosts transparently?
Can goroutine like erlang spawn across multiple machines transparently?," It is said that if configured erlang with cookie setting, the erlang's process could be run across different machines, and this is transparent to the caller.Is that possible for goroutine run like this? <code> ",Can goroutine like erlang spawn process across multiple hosts transparently?
Can goroutine like erlang spawn process across multiple machines transparently?," It is said that if configured erlang with cookie setting, the erlang's process could be run across different machines, and this is transparent to the caller.Is that possible for goroutine run like this? <code> ",Can goroutine like erlang spawn process across multiple hosts transparently?
Golang memory layout compared to C++/C," In Go, it seems there are no constructors, but it is suggested that you allocate an object of a struct type using a function, usually named by ""New"" + TypeName, for example However, I am not sure about the memory layout of Go. In C/C++, this kind of code means you return a pointer, which point to a temporary object because the variable is allocated on the stack, and the variable may be some trash after the function return. In Go, do I have to worry such kind of thing? Because It seems no standard shows that what kind of data will be allocated on the stack vs what kind of data will be allocated on the heap.As in Java, there seems to have a specific point out that the basic type such as int, float will be allocated on the stack, other object derived from the object will be allocated on the heap. In Go, is there a specific talk about this? <code>  func NewRect(x,y, width, height float) *Rect { return &Rect(x,y,width, height)}",Go memory layout compared to C++/C
golang: Create a io.Reader from a local file," I would like to open a local file, and return a io.Reader. The reason is that I need to feed a io.Reader to a library I am using, like: <code>  func read(r io.Reader) (results []string) {}",Create a io.Reader from a local file
"Why can't you name a function in golang ""init""?"," So, today while I was coding I found out that creating a function with the name init generated an error method init() not found, but when I renamed it to startup it all worked fine.Is the word ""init"" preserved for some internal operation in Go or am I'm missing something here? <code> ","Why can't you name a function in Go ""init""?"
check os is 32 or 64 bit in golang," Is there any standard method to check os is 32 or 64 bit?I've check runtime & os package, but can not found.http://play.golang.org/p/d6NywMDMcY <code>  package mainimport ""fmt""import ""runtime""func main() { fmt.Println(runtime.GOOS, runtime.GOARCH)}",How can I check if my program is compiled for 32 or 64 bit processor?
What are the three other gothreads in go's runtime," Go seems to always have at least 4 goroutines running at any given time. What are the other three that are not the main goroutine?http://play.golang.org/p/MQBiLmHXBK <code>  package mainimport ( ""fmt"" ""runtime"")func main() { fmt.Println(runtime.NumGoroutine()) //4}",What are the three background goroutines in a Go program?
Storing golang JSON into Postgresql," I want to store a certain struct into my database that has a JSON field within it. The schema for the table is: I am using sqlx and lib/pq driver in my project and the following will not execute. Instead it panics saying there is a nil pointer. DB is a global *sqlx.DB struct When I remove weekly_schedule from the schema and fixture things run fine. But for some reason, the when this field is included, the program panics. Any idea as to how I should define the weekly_schedule field in both my DB schema and Go struct? <code>  type Comp struct { CompId int64 `db:""comp_id"" json:""comp_id""` StartDate time.Time `db:""start_date"" json:""start_date""` EndDate time.Time `db:""end_date"" json:""end_date""` WeeklySchedule json.RawMessage `db:""weekly_schedule"" json:""weekly_schedule""`} CREATE TABLE IF NOT EXISTS Tr.Comp( comp_id SERIAL, start_date timestamp NOT NULL, end_date timestamp NOT NULL, weekly_schedule json NOT NULL, PRIMARY KEY (comp_id)); tx := DB.MustBegin() compFixture := Comp{ StartDate: time.Now(), EndDate: time.Now().AddDate(1, 0, 0), WeeklySchedule: json.RawMessage([]byte(""{}"")), } _, err = tx.NamedExec( `INSERT INTO Tr.Comp(comp_id, start_date, end_date, weekly_schedule) VALUES (DEFAULT, :start_date, :end_date, :weekly_schedule) RETURNING comp_id;`, compFixture) if err != nil { t.Fatal(""Error creating fixture."", err) }",Storing Golang JSON into Postgresql
Go Lang generic map value, I have run into this problem a few times when wanting to use keys of maps in a similar way but the values in the maps are different. I thought I could write a function that takes the key type I want with interface{} as the value type but it doesn't work. Not sure if there is an elegant way to do this I just feel waist full rewriting simple things for different values. <code>  func main() { mapOne := map[string]int mapTwo := map[string]double mapThree := map[string]SomeStruct useKeys(mapOne)}func useKeys(m map[string]interface{}) { //something with keys here},generic map value
Go Lang /etc/resolv.conf missing in android," I cross compiled my Go source code to Arm to run in Android .The program runs in the terminal in the Android device, but I get an error saying that /etc/resolv.conf is missing. My program heavily relies on the net/http library in making http calls. How can I handle this error in Android? <code> ",Go /etc/resolv.conf missing in android
Practical examples of httptest.Server and httptest.ResponseRecorder," As title, when to use httptest.Server and httptest.ResponseRecorder?It seems to me that I can also test my handlers to return correct response using httptest.Server. I can simply start a httptest.Server given with my implementation of handlers, then do validations on the response's body.Please correct if I'm wrong, I am learning Go + TDD <code> ",When to use httptest.Server and httptest.ResponseRecorder
Go Unmarshal nested JSON structure," http://play.golang.org/p/f6ilWnWTjmI am trying to decode the following string but only getting null values.How do I decode nested JSON structure in Go?I want to convert the following to map data structure. <code>  package mainimport ( ""encoding/json"" ""fmt"")func main() { jStr := `{ ""AAA"": { ""assdfdff"": [""asdf""], ""fdsfa"": [""1231"", ""123""] }}` type Container struct { Key string `json:""AAA""` } var cont Container json.Unmarshal([]byte(jStr), &cont) fmt.Println(cont)}",Unmarshal nested JSON structure
User Authentication with Golang and AngularJS," I want to set up an authentication system with tokens on my Go application, which use an AngularJS front-end.What I'm looking for is advices about all steps to create a safe system. Here's my steps :We will considerate a user entry is already written in our database.1 - The user wants to sign inThe user goes to the index of the web app which prompts him to sign in.With my app.yaml file, I declare my HTML file with dependencies for the AngularJS front-end: Visual :Code: The user enters his credentials, and click on Sign in button.2 - Request the serverThe AngularJS module code: The Angular module posts the form to /signin path, so the Go application needs to handle it: Obviously, hashPassword(p string) hashes the user password and isInDatabase(e string, p string) is a boolean which checks if the provided credentials are stored in our database. As I said inside the code, I'm wondering if it's the good moment to hash the password of the user, or maybe hash it in client-side ? Print a zero-car string if the user is not in database is really useful or could I just return the function ? The main question here is how to manage my tokens ? I often see tokens are mainly composed of access_token, refresh_token and id_token. I also know access_token is limited in time to use (the current session, ot 3600seconds for example) and we use refresh_token to have a fresh new access_token. But how to generate it and store it ?3 - Handle response with AngularJSAs already written in AngularJS module code, when the user is well authenticated, we set cookies with provided tokens. Is it a good way ? I'm also wondering how to prevent XSRF (CSRF) attacks in my system ?Thank you for your future answers and advices. <code>  application: authtestversion: 1runtime: goapi_version: go1handlers:- url: / static_files: frontend/index.html upload: frontend/(.*\.html)- url: /js static_dir: frontend/js- url: /.* script: _go_app <form ng-submit=""signIn()"" ng-controller=""signInCtrl""> <input type=""email"" ng-model=""credentials.email"" placeholder=""Email"" name=""email""> <input type=""password"" ng-model=""credentials.password"" placeholder=""Password"" name=""password""> <input type=""submit"" value=""Sign in""></form> <script> angular.module('authtest', ['ngCookies']) .controller('signInCtrl', ['$scope', '$http', '$window', '$cookieStore', '$route', function($scope, $http, $window, $cookieStore, $route){ var credentials = {} $scope.signIn = function() { $http.post('/signin', credentials) .success(function (data, status) { if(status == 200) { if(data.Access_token){ //set cookies with tokens $cookieStore.put('access_token', data.Access_token); $cookieStore.put('refresh_token', data.Refresh_token); $route.reload(); } else { $window.alert('Wrong credentials, try again.'); } } }) .error(function (data, status) { $window.alert('error: ' + data + '(errorStatus: ' + status + ')'); }); }; }]);</script> package mainimport ( ""net/http"" ""encoding/json"" ""fmt"")type SignInCredentials struct { Email string Password string}type Token struct { Access_token string Refresh_token string Id_token string}func init() { //I use init() instead of main() because I'm using App Engine. http.HandleFunc(""/signin"", SignInHandler)}func SignInHandler (w http.ResponseWriter, r *http.Request) { decoder := json.NewDecoder(r.Body) var c SignInCredentials err := decoder.Decode(&c) if err != nil { panic() } var hashPassword = hash(c.Password) //Is it at a good level to hash it ? if isInDatabase(c.Email, hashPassword) == false { fmt.Fprintf(w, """") // Really useful ? return } var tokens Token /** * The user seems to be well stored in the database, but how * to manage my tokens ? */ response, _ := json.Marshal(tokens) fmt.Fprintf(w, string(response))}",User Authentication with Go and AngularJS
How to generate unit test coverage when using subprocess testing in golang?," I have unit tests for most of our code. But I cannot figure out how to generate unit tests coverage for certain code in main() in main package. The main function is pretty simple. It is basically a select block. It reads flags, then either call another function/execute something, or simply print help on screen. However, if commandline options are not set correctly, it will exit with various error codes. Hence, the need for sub-process testing.I tried sub-process testing technique but modified code so that it include flag for coverage: Here is original code: https://talks.golang.org/2014/testing.slide#23Explanation of above slide: http://youtu.be/ndmB0bj7eyw?t=47m16s But it doesn't generate cover profile. I haven't been able to figure out why not. It does generate cover profile for main process executing tests, but any code executed in sub-process, of course, is not marked as executed.I try to achieve as much code coverage as possible. I am not sure if I am missing something or if there is an easier way to do this. Or if it is just not possible.Any help is appreciated.ThanksAmer <code>  cmd := exec.Command(os.Args[0], ""-test.run=TestMain -test.coverprofile=/vagrant/ucover/coverage2.out"")",How to generate unit test coverage when using command line flags in Golang subprocess testing?
Golang Interface Fields," I'm familiar with the fact that, in Go, interfaces define functionality, rather than data. You put a set of methods into an interface, but you are unable to specify any fields that would be required on anything that implements that interface.For example: Now we can use the interface and its implementations: Now, what you can't do is something like this: However, after playing around with interfaces and embedded structs, I've discovered a way to do this, after a fashion: Because of the embedded struct, Bob has everything Person has. It also implements the PersonProvider interface, so we can pass Bob into functions that are designed to use that interface. Here is a Go Playground that demonstrates the above code.Using this method, I can make an interface that defines data rather than behavior, and which can be implemented by any struct just by embedding that data. You can define functions that explicitly interact with that embedded data and are unaware of the nature of the outer struct. And everything is checked at compile time! (The only way you could mess up, that I can see, would be embedding the interface PersonProvider in Bob, rather than a concrete Person. It would compile and fail at runtime.)Now, here's my question: is this a neat trick, or should I be doing it differently? <code>  // Interfacetype Giver interface { Give() int64}// One implementationtype FiveGiver struct {}func (fg *FiveGiver) Give() int64 { return 5}// Another implementationtype VarGiver struct { number int64}func (vg *VarGiver) Give() int64 { return vg.number} // A function that uses the interfacefunc GetSomething(aGiver Giver) { fmt.Println(""The Giver gives: "", aGiver.Give())}// Bring it all togetherfunc main() { fg := &FiveGiver{} vg := &VarGiver{3} GetSomething(fg) GetSomething(vg)}/*Resulting output:53*/ type Person interface { Name string Age int64}type Bob struct implements Person { // Not Go syntax! ...}func PrintName(aPerson Person) { fmt.Println(""Person's name is: "", aPerson.Name)}func main() { b := &Bob{""Bob"", 23} PrintName(b)} type PersonProvider interface { GetPerson() *Person}type Person struct { Name string Age int64}func (p *Person) GetPerson() *Person { return p}type Bob struct { FavoriteNumber int64 Person} func DoBirthday(pp PersonProvider) { pers := pp.GetPerson() pers.Age += 1}func SayHi(pp PersonProvider) { fmt.Printf(""Hello, %v!\r"", pp.GetPerson().Name)}func main() { b := &Bob{ 5, Person{""Bob"", 23}, } DoBirthday(b) SayHi(b) fmt.Printf(""You're %v years old now!"", b.Age)}",Go Interface Fields
Write to Client UDP Socket Golang," I'm looking for a good solution for a client/server communication with UDP sockets in Go language.The examples I found on the Internet show me how to send data to the server, but they do not teach how to send them back to the client.To demonstrate, my program does the following:My client program creates a socket on the 4444 port, like this: I sent a string and the local address to the server, so it could print the string and send an OK message. I am using gob for this: My Data struct looks like this: My server listens to the 4444 port and decodes the Gob correctly, but how can I send the OK message back? I'm using the client address to do so (on the server .go file): Then, I get an error code: When the client tries to connect to the Server's port 4444, the client creates a port with a random number (in this case, 35290) so they can communicate. I know I shouldn't be passing the client's address to the server, but conn.RemoteAddress() does not work. A solution that discovers the client's address would be most appreciated.Obs.: I know there is ReadFromUDP, so I can read the package. Should I read it, discover the client's address, and send the data to Gob so it can decode it? <code>  con, err := net.Dial(""udp"", ""127.0.0.1:4444"") enc := gob.NewEncoder(con)enc.Encode(Data{""test"", con.LocalAddr().String()}) type Data struct{ Msg string Addr string} con, err := net.Dial(""udp"", data.Addr) write udp 127.0.0.1:35290: connection refused",Write to Client UDP Socket in Go
TCP client / server file transfer in golang," I'm new to Go and I'm having troubles debugging this client / server file transfer code. When I request a 719kb png file from the server, I get the 719kb.. but not perfectly, the png when I open it isn't completely displayed (some is cut off. Where am I going wrong here? <code>  // CLIENT /// package mainimport ( ""bufio"" ""bytes"" ""fmt"" ""io"" ""log"" ""net"" ""os"" ""strings"")const BUFFER_SIZE = 1024func main() { //get port and ip address to dial if len(os.Args) != 3 { fmt.Println(""useage example: tcpClient 127.0.0.1 7005"") return } var ip string = os.Args[1] var port string = os.Args[2] connection, err := net.Dial(""tcp"", ip+"":""+port) if err != nil { fmt.Println(""There was an error making a connection"") } //read from reader := bufio.NewReader(os.Stdin) fmt.Print(""Please enter 'get <filename>' or 'send <filename>' to transfer files to the server\n\n"") inputFromUser, _ := reader.ReadString('\n') arrayOfCommands := strings.Split(inputFromUser, "" "") if arrayOfCommands[0] == ""get"" { getFileFromServer(arrayOfCommands[1], connection) } else if arrayOfCommands[0] == ""send"" { sendFileToServer(arrayOfCommands[1], connection) } else { fmt.Println(""Bad Command"") }}func sendFileToServer(fileName string, connection net.Conn) { var currentByte int64 = 0 fmt.Println(""send to client"") fileBuffer := make([]byte, BUFFER_SIZE) var err error //file to read file, err := os.Open(strings.TrimSpace(fileName)) // For read access. if err != nil { connection.Write([]byte(""-1"")) log.Fatal(err) } connection.Write([]byte(""send "" + fileName)) //read file until there is an error for err == nil || err != io.EOF { _, err = file.ReadAt(fileBuffer, currentByte) currentByte += BUFFER_SIZE fmt.Println(fileBuffer) connection.Write(fileBuffer) } file.Close() connection.Close()}func getFileFromServer(fileName string, connection net.Conn) { var currentByte int64 = 0 fileBuffer := make([]byte, BUFFER_SIZE) var err error file, err := os.Create(strings.TrimSpace(fileName)) if err != nil { log.Fatal(err) } connection.Write([]byte(""get "" + fileName)) for { connection.Read(fileBuffer) cleanedFileBuffer := bytes.Trim(fileBuffer, ""\x00"") _, err = file.WriteAt(cleanedFileBuffer, currentByte) currentByte += BUFFER_SIZE if err == io.EOF { break } } file.Close() return}// END CLIENT //// SERVER // package mainimport ( ""bytes"" ""fmt"" ""io"" ""log"" ""net"" ""os"" ""strings"")const BUFFER_SIZE = 1024const PORT = ""7005""func main() { fmt.Println(""start listening"") server, error := net.Listen(""tcp"", ""localhost:""+PORT) if error != nil { fmt.Println(""There was an error starting the server"" + error.Error()) return } //infinate loop for { connection, error := server.Accept() if error != nil { fmt.Println(""There was am error with the connection"" + error.Error()) return } fmt.Println(""connected"") //handle the connection, on it's own thread, per connection go connectionHandler(connection) }}func connectionHandler(connection net.Conn) { buffer := make([]byte, BUFFER_SIZE) _, error := connection.Read(buffer) if error != nil { fmt.Println(""There is an error reading from connection"", error.Error()) return } fmt.Println(""command recieved: "" + string(buffer)) //loop until disconntect cleanedBuffer := bytes.Trim(buffer, ""\x00"") cleanedInputCommandString := strings.TrimSpace(string(cleanedBuffer)) arrayOfCommands := strings.Split(cleanedInputCommandString, "" "") fmt.Println(arrayOfCommands[0]) if arrayOfCommands[0] == ""get"" { sendFileToClient(arrayOfCommands[1], connection) } else if arrayOfCommands[0] == ""send"" { fmt.Println(""getting a file"") getFileFromClient(arrayOfCommands[1], connection) } else { _, error = connection.Write([]byte(""bad command"")) }}func sendFileToClient(fileName string, connection net.Conn) { var currentByte int64 = 0 fmt.Println(""send to client"") fileBuffer := make([]byte, BUFFER_SIZE) //file to read file, err := os.Open(strings.TrimSpace(fileName)) // For read access. if err != nil { log.Fatal(err) } var err2 error //read file until there is an error for { _, err2 = file.ReadAt(fileBuffer, currentByte) currentByte += BUFFER_SIZE fmt.Println(fileBuffer) connection.Write(fileBuffer) if err2 == io.EOF { break } } file.Close() return}func getFileFromClient(fileName string, connection net.Conn) { var currentByte int64 = 0 fileBuffer := make([]byte, BUFFER_SIZE) var err error file, err := os.Create(strings.TrimSpace(fileName)) if err != nil { log.Fatal(err) } connection.Write([]byte(""get "" + fileName)) for err == nil || err != io.EOF { connection.Read(fileBuffer) cleanedFileBuffer := bytes.Trim(fileBuffer, ""\x00"") _, err = file.WriteAt(cleanedFileBuffer, currentByte) if len(string(fileBuffer)) != len(string(cleanedFileBuffer)) { break } currentByte += BUFFER_SIZE } connection.Close() file.Close() return}// END SERVER //",TCP client / server file transfer in Go
How to use interface type as a model in mgo (Golang)?," Suppose you have a workflow that consists of multiple embedded nodes of different types. Since nodes are of different types, I thought of using Golang interfaces here and came up with following: These workflows are stored in MongoDB and I have sample seed data in it. Using mgo, when I try to find a workflow (given its ID): I get the error - value of type bson.M is not assignable to type Node.It also feels a bit weird to me that how would mgo unmarshal embedded Node documents into a Go struct without any type information. May be I need to look at the problem from another point of view.Any suggestions would be highly appreciated. <code>  type Workflow struct { CreatedAt time.Time StartedAt time.Time CreatedBy string Nodes []Node}type Node interface { Exec() (int, error)}type EmailNode struct { From string To string Subject string Body string}type TwitterNode struct { Tweet string Image []byte}func (n *EmailNode) Exec() (int, error){ //send email return 0, nil}func (n *TwitterNode) Exec() (int, error) { //send tweet return 0, nil} w = &Workflow{}collection.FindID(bson.ObjectIdHex(id)).One(w)",How to use interface type as a model in mgo (Go)?
Proper way to send an int64 over a socket in golang," I'm trying to send a int64 over a TCP in golang, however, my receiver prints gets a different number then what I've sent out. What is the proper way to accomplish this? <code>  //Buffer on both client and serverbuffer := make([]byte, 1024)//SenderfileInfo, error := os.Stat(fileName)if error != nil { fmt.Println(""Error opening file"")}var fSize int = int(fileInfo.Size())connection.Write([]byte(string(fSize)))//Receiverconnection.Read(buffer)fileSize := new(big.Int).SetBytes(bytes.Trim(buffer, ""\x00"")).Int64()if err != nil { fmt.Println(""not a valid filesize"") fileSize = 0}",Proper way to send an int64 over a socket in go
How do I convert [Size]byte to string in Golang?," I have a sized byte array that I got after doing md5.Sum(). I get the error: cannot convert b (type [16]byte) to type string <code>  data := []byte(""testing"")var pass string var b [16]byteb = md5.Sum(data)pass = string(b)",How do I convert [Size]byte to string in Go?
How do I loop for n seconds?," I need to read UDP traffic until a timeout is reached. I can do this by calling SetDeadline on the UDPConn and looping until I get an I/O timeout error, but this seems hack-ish (flow control based on error conditions). The following code snippet seems more correct, but does not terminate. In production, this would obviously be executed in a goroutine; it's written as a main function for simplicity's sake. Why doesn't the given program terminate? Based on https://gobyexample.com/select, https://gobyexample.com/timeouts, and https://gobyexample.com/non-blocking-channel-operations, I would expect the above code to select the default case for one second, then take the first case and break out of the loop. How might I modify the above snippet to achieve the desired effect of looping and reading until a timeout occurs? <code>  package mainimport ( ""fmt"" ""time"")func main() { for { select { case <-time.After(time.Second * 1): fmt.Printf(""Finished listening.\n"") return default: fmt.Printf(""Listening...\n"") //read from UDPConn here } }}",How do I read a UDP connection until a timeout is reached?
Go: run single test instead of the whole suit?," I have a test suite for a Go package that implements a dozen tests. Sometimes, one of the tests in the suite fails and I'd like to re-run that test individually to save time in debugging process. Is this possible or do I have to write a separate file for this every time? <code> ",Just run single test instead of the whole suite?
Go: run single test instead of the whole suite?," I have a test suite for a Go package that implements a dozen tests. Sometimes, one of the tests in the suite fails and I'd like to re-run that test individually to save time in debugging process. Is this possible or do I have to write a separate file for this every time? <code> ",Just run single test instead of the whole suite?
panic: runtime error: index out of range in GoLang," I have the following function that takes a command from terminal and prints something based on input. It seems simple enough, if the user types 'add' the system prints a line, if the user types nothing, it prints something else. Whenever the user types add, it works. If the user doesn't type anything it throws panic: runtime error: index out of range in GoLangWhy is this?  <code>  func bootstrapCmd(c *commander.Command, inp []string) error { if inp[0] == ""add"" { fmt.Println(""you typed add"") } else if inp[0] == """" { fmt.Println(""you didn't type add"") } return nil }",panic: runtime error: index out of range in Go
Call a function in other package in golang," I have two files main.go which is under package main, and another file with some functions in the package called functions.My question is: How can I call a function from package main?File 1: main.go (located in MyProj/main.go) File 2: functions.go (located in MyProj/functions/functions.go) <code>  package mainimport ""fmt""import ""functions"" // I dont have problem creating the reference herefunc main(){ c:= functions.getValue() // <---- this is I want to do} package functionsfunc getValue() string{ return ""Hello from this another package""}",Call a function from another package in Go
Call a function from another package in golang," I have two files main.go which is under package main, and another file with some functions in the package called functions.My question is: How can I call a function from package main?File 1: main.go (located in MyProj/main.go) File 2: functions.go (located in MyProj/functions/functions.go) <code>  package mainimport ""fmt""import ""functions"" // I dont have problem creating the reference herefunc main(){ c:= functions.getValue() // <---- this is I want to do} package functionsfunc getValue() string{ return ""Hello from this another package""}",Call a function from another package in Go
Access a map value using a variable key in a golang template," How can I look up the value of a map by using a variable key without iterating? So one can lookup a constant key on variable map $x with $x.key1, but is it possible to do amap.$key? <code> ",Access a map value using a variable key in a Go template
Is it possible to get the last X characters from a string in GoLang?," If I have the string ""12121211122"" and I want to get the last 3 characters (e.g. ""122""), is that possible in Go? I've looked in the string package and didn't see anything like getLastXcharacters. <code> ",How to get the last X Characters of a Golang String?
Is it possible to get the last X characters from a string in Go?," If I have the string ""12121211122"" and I want to get the last 3 characters (e.g. ""122""), is that possible in Go? I've looked in the string package and didn't see anything like getLastXcharacters. <code> ",How to get the last X Characters of a Golang String?
How do i pass arguments to my handler," I am trying to pass my database object along to my handlers, instead of having a global object. But I don't know if this is possible, I'm using Gorilla Mux package, and I can see that it takes a closure as a second param. Which then defines the params i can use, ideally i would like to have a third param like this. Is there a workaround? Or do I need a global db object? I am new to Go, so please explain a potential answer in detail. <code>  // https://github.com/gorilla/mux/blob/master/mux.go#L174// HandleFunc registers a new route with a matcher for the URL path.// See Route.Path() and Route.HandlerFunc().func (r *Router) HandleFunc(path string, f func(http.ResponseWriter, *http.Request)) *Route { return r.NewRoute().Path(path).HandlerFunc(f)} // In my mainrouter.HandleFunc(""/users/{id}"", showUserHandler).Methods(""GET"")func showUserHandler(w http.ResponseWriter, r *http.Request, db *gorm.DB) { fmt.Fprintf(w, ""We should fetch the user with id %s"", vars[""id""])}",How do I pass arguments to my handler
Golang pprof not working properly," I'm trying to get pprof working with Golang.--text seems to work fine but most of other options does not work.For instance with pdf: With gv: Is there something that I need to change in Go to get it working? <code>  root@ubuntu:/home/user/IdeaProjects/go_projects/src# go tool pprof --pdf ./src /tmp/profile578584736/cpu.pprof > out.pdfsh: 1: dot: not foundroot@ubuntu:/home/user/IdeaProjects/go_projects/src# root@ubuntu:/home/user/IdeaProjects/go_projects/src# go tool pprof --gv ./src /tmp/profile578584736/cpu.pprof sh: 1: dot: not foundgv -scale 0Can't exec ""gv"": No such file or directory at /usr/local/go/pkg/tool/linux_386/pprof line 719.root@ubuntu:/home/user/IdeaProjects/go_projects/src# ",Go pprof not working properly
"Golang - Code organisation with structs, variables and interfaces"," I have a codebase where one file contains quite a lot of Structs, Interfaces and Variables in the same file as functions and I'm not sure if I need to seperate this into separate files with appending filename. So for example accounts.go will be accounts_struct.go and accounts_interface.go with struct and interface respectively.What would be a good approach for the file organisation when you have growing codebase for Structs, Variables and Interfaces? <code> ","How should I organise structs, variables and interfaces in Go?"
"""sudo go get github.com/hanwen/go-mtpfs"" doesn't work, what to do?", Running the command I get the following output: What does this mean? How can I fix this? <code>  sudo go get github.com/hanwen/go-mtpfs /usr/lib/go/src/pkg/github.com/hanwen/go-fuse/fuse/bufferpool.go:41: undefined: sync.Pool/usr/lib/go/src/pkg/github.com/hanwen/go-fuse/fuse/bufferpool.go:54: undefined: sync.Pool/usr/lib/go/src/pkg/github.com/hanwen/go-fuse/fuse/server.go:44: undefined: sync.Pool/usr/lib/go/src/pkg/github.com/hanwen/go-fuse/fuse/server.go:47: undefined: sync.Pool,"Go error ""undefined: sync.Pool"" when installing go-mtpfs"
Subtracting time.Duration from time in golang," I have a time.Time value obtained from time.Now() and I want to get another time which is exactly 1 month ago. I know subtracting is possible with time.Sub() (which wants another time.Time), but that will result in a time.Duration and I need it the other way around. <code> ",Subtracting time.Duration from time in Go
"golang json.Marshal(struct) returns ""{}"""," Here is the output: Why is the JSON essentially empty? <code>  type TestObject struct { kind string `json:""kind""` id string `json:""id, omitempty""` name string `json:""name""` email string `json:""email""`}func TestCreateSingleItemResponse(t *testing.T) { testObject := new(TestObject) testObject.kind = ""TestObject"" testObject.id = ""f73h5jf8"" testObject.name = ""Yuri Gagarin"" testObject.email = ""Yuri.Gagarin@Vostok.com"" fmt.Println(testObject) b, err := json.Marshal(testObject) if err != nil { fmt.Println(err) } fmt.Println(string(b[:]))} [ `go test -test.run=""^TestCreateSingleItemResponse$""` | done: 2.195666095s ] {TestObject f73h5jf8 Yuri Gagarin Yuri.Gagarin@Vostok.com} {} PASS","json.Marshal(struct) returns ""{}"""
"Go json.Marshal(struct) returns ""{}"""," Here is the output: Why is the JSON essentially empty? <code>  type TestObject struct { kind string `json:""kind""` id string `json:""id, omitempty""` name string `json:""name""` email string `json:""email""`}func TestCreateSingleItemResponse(t *testing.T) { testObject := new(TestObject) testObject.kind = ""TestObject"" testObject.id = ""f73h5jf8"" testObject.name = ""Yuri Gagarin"" testObject.email = ""Yuri.Gagarin@Vostok.com"" fmt.Println(testObject) b, err := json.Marshal(testObject) if err != nil { fmt.Println(err) } fmt.Println(string(b[:]))} [ `go test -test.run=""^TestCreateSingleItemResponse$""` | done: 2.195666095s ] {TestObject f73h5jf8 Yuri Gagarin Yuri.Gagarin@Vostok.com} {} PASS","json.Marshal(struct) returns ""{}"""
Generic way to duplicate Go slices?," I have a need to duplicate slices (and part of the underlying array) so a caller won't mutate the original elements of an array. I think I can write a function to do this for arrays of specific types: But is there a way to create the same method generically, perhaps without generics? <code>  func duplicateSliceOfSomeType(sliceOfSomeType []SomeType) []SomeType { dulicate := make([]SomeType, len(sliceOfSomeType)) copy(duplicate, sliceOfSomeType) return duplicate} func duplicateSlice(slice []?) []?{ duplicate := make([]?, len(slice)) copy(duplicate, slice) return duplicate}",Generic way to duplicate slices
Go: disallow direct struct initalization," Given the following packages in Go, is it possible to prevent the direct initialization of Bar with Bar{..} without de-exposing Bar from the package?package bar: package main: My gut feeling says this can't be done, so that is also a valid answer. <code>  package barimport ()type Bar struct { A string B string}func NewBar(baz string) Bar{ return Bar{A:baz, B:baz+baz}} package mainimport ( ""fmt"" ""./bar"")func main() { x := bar.NewBar(""sad"") //all bars should be created with this y := bar.Bar{A: ""fadss""} //and this should be disallowed bzzBar(x) bzzBar(y)}func bzzBar(bzz bar.Bar) { //but I can't do 'Bar -> bar' because I want to use the type fmt.Println(bzz)}",How to disallow direct struct initialization
golang string pointer to string," Is it possible to get the string value from a pointer to a string?I am using the goopt package to handle flag parsing and the package returns *string only. I want to use these values to call a function in a map.Example returns <code>  var strPointer = new(string)*strPointer = ""string""functions := map[string]func() { ""string"": func(){ fmt.Println(""works"") },} //Do something to get the string valuefunctions[strPointerValue]() ./prog.go:17:14: cannot use strPointer (type *string) as type string in map index",How to convert a 'string pointer' to a string in Golang?
Go string pointer to string," Is it possible to get the string value from a pointer to a string?I am using the goopt package to handle flag parsing and the package returns *string only. I want to use these values to call a function in a map.Example returns <code>  var strPointer = new(string)*strPointer = ""string""functions := map[string]func() { ""string"": func(){ fmt.Println(""works"") },} //Do something to get the string valuefunctions[strPointerValue]() ./prog.go:17:14: cannot use strPointer (type *string) as type string in map index",How to convert a 'string pointer' to a string in Golang?
Unmarshal Json data in a specific struct in Golang," I want to unmarshal the following JSON data in Go: I know how to do that, i define a struct like this: What i don't know is if there is a simple way to specializethis a bit more.I would like to have the data after the unmarshaling in a format like this: So that i can use it later after unmarshaling like this: I don't really know how to easy or idiomatically do that in GOso I hope that there is a nice solution for that. <code>  b := []byte(`{""Asks"": [[21, 1], [22, 1]] ,""Bids"": [[20, 1], [19, 1]]}`) type Message struct { Asks [][]float64 `json:""Bids""` Bids [][]float64 `json:""Asks""`} type Message struct { Asks []Order `json:""Bids""` Bids []Order `json:""Asks""`}type Order struct { Price float64 Volume float64} m := new(Message)err := json.Unmarshal(b, &m)fmt.Println(m.Asks[0].Price)",Unmarshal Json data in a specific struct
Unmarshal Json data in a specific struct in Go," I want to unmarshal the following JSON data in Go: I know how to do that, i define a struct like this: What i don't know is if there is a simple way to specializethis a bit more.I would like to have the data after the unmarshaling in a format like this: So that i can use it later after unmarshaling like this: I don't really know how to easy or idiomatically do that in GOso I hope that there is a nice solution for that. <code>  b := []byte(`{""Asks"": [[21, 1], [22, 1]] ,""Bids"": [[20, 1], [19, 1]]}`) type Message struct { Asks [][]float64 `json:""Bids""` Bids [][]float64 `json:""Asks""`} type Message struct { Asks []Order `json:""Bids""` Bids []Order `json:""Asks""`}type Order struct { Price float64 Volume float64} m := new(Message)err := json.Unmarshal(b, &m)fmt.Println(m.Asks[0].Price)",Unmarshal Json data in a specific struct
Golang - Multiple Struct switch?," Let's say I have an application that receives json data in two different formats. And I have a struct associated to each type: Assuming that I use the encoding/json library to turn the raw json data into the struct: type Point { pointtype string data json.RawMessage }How can I decode the data into the appropiate struct just by knowing the pointtype?I was trying something along the lines of : Which is not working because the returned value is an interface, not the proper struct type.How can I make this kind of switch struct selection work?here is a non working example <code>  f1 = `{""pointtype"":""type1"", ""data"":{""col1"":""val1"", ""col2"":""val2""}}`f2 = `{""pointtype"":""type2"", ""data"":{""col3"":""val3"", ""col3"":""val3""}}` type F1 struct { col1 string col2 string}type F2 struct { col3 string col4 string} func getType(pointType string) interface{} { switch pointType { case ""f1"": var p F1 return &p case ""f2"": var p F2 return &p } return nil}",Multiple Struct switch?
Golang: one liner if else statement, Please see https://golangdocs.com/ternary-operator-in-golang as pointed by @accdias (see comments)Can I write a simple if-else statement with variable assignment in go (golang) as I would do in php? For example: Currently I have to use the following: Sorry I cannot remember the name if this control statement and I couldn't find the info in-site or through google search. :/ <code>  $var = ( $a > $b )? $a: $b; var c intif a > b { c = a} else { c = b},How to do one-liner if else statement?
One-liner if else statement, Please see https://golangdocs.com/ternary-operator-in-golang as pointed by @accdias (see comments)Can I write a simple if-else statement with variable assignment in go (golang) as I would do in php? For example: Currently I have to use the following: Sorry I cannot remember the name if this control statement and I couldn't find the info in-site or through google search. :/ <code>  $var = ( $a > $b )? $a: $b; var c intif a > b { c = a} else { c = b},How to do one-liner if else statement?
How to run my golang webapp in docker based on scratch as the user nobody?," I don't want to run anything in a docker container as root.And I want minimalistic images.I can run my compiled Go app in the scratch-image without a problem.But when I don't want it to run as root (i assume its running as root)and define USER nobody in the dockerfile I get here is my dockerfile EDIT ------------turns out that scratch is empty, very empty. RUN useradd would execute /bin/sh -c useraddbut there is no /bin/sh . RUN [""useradd""] would exec directly. but there is no useradd. i d have to add rootfs.tar and build stuff from zero. i ll use debian as i don't wont to run anything as root within a containerbecause ... Treat root within a container as if it is root outside of the container <code>  014/10/25 06:07:10 Error response from daemon: Cannot start container 4822f34e54e20bb580f8cd1d38d7be3c828f28595c2bebad6d827a17b4c2fe21: finalize namespace setup user get supplementary groups Unable to find user nobody FROM scratchADD lichtpunkt_go_linux_amd64 /lichtpunkt_go_linux_amd64ADD web /webUSER nobodyCMD [""./lichtpunkt_go_linux_amd64""]EXPOSE 3001","How do I run my Go application in the scratch container as the user ""nobody?"""
How to run my Go webapp in docker based on scratch as the user nobody?," I don't want to run anything in a docker container as root.And I want minimalistic images.I can run my compiled Go app in the scratch-image without a problem.But when I don't want it to run as root (i assume its running as root)and define USER nobody in the dockerfile I get here is my dockerfile EDIT ------------turns out that scratch is empty, very empty. RUN useradd would execute /bin/sh -c useraddbut there is no /bin/sh . RUN [""useradd""] would exec directly. but there is no useradd. i d have to add rootfs.tar and build stuff from zero. i ll use debian as i don't wont to run anything as root within a containerbecause ... Treat root within a container as if it is root outside of the container <code>  014/10/25 06:07:10 Error response from daemon: Cannot start container 4822f34e54e20bb580f8cd1d38d7be3c828f28595c2bebad6d827a17b4c2fe21: finalize namespace setup user get supplementary groups Unable to find user nobody FROM scratchADD lichtpunkt_go_linux_amd64 /lichtpunkt_go_linux_amd64ADD web /webUSER nobodyCMD [""./lichtpunkt_go_linux_amd64""]EXPOSE 3001","How do I run my Go application in the scratch container as the user ""nobody?"""
Inserting an array into a Postgresql database in Golang," I want to be able to write an array of bigints into a table that I am using for history in Go. Unfortunately, I can't and when I do the error sql: converting Exec argument #1's type: unsupported type []int64, a slice is thrown. Here's what I'm doing, edited for brevity: This is the structure of the table that I wish to insert into:tid bigint primary key, productids bigint[] not null, cardid bigint not null, salepoint int <code>  type Card struct { cid int64}type Transaction struct { tid, cardid int64 productids []int64 salepoint int cardkey string}func logPurchase(card *Card, t *Transaction) { _, err := db.Exec(""INSERT INTO history VALUES ($1, $2, $3, $4)"", rand.Int63(), t.productids, card.cid, t.salepoint);}",Inserting an array into a Postgresql database
Remove diacritics in Go," How can I remove all diacritics from the given UTF8 encoded string using Go? e.g. transform the string ""o"" => ""zuzo"". Is there a standard way? <code> ",Remove diacritics using Go
including context objects through multiple http handlers in golang," I just read this blog post about creating a function type and implementing the .ServeHTTP() method on that function to be able to handle errors. For example: I like this approach but I can't conceptually figure out how to include a context object through handler layers. For example: AuthHandler would likely create a &SessionToken{User: user} object and set that in a context.Context object for each request. I can't work out how to get that to the viewRecord handler though. Ideas?  <code>  type appError struct { Error error Message string Code int}type appHandler func(http.ResponseWriter, *http.Request) *appErrorfunc (fn appHandler) ServeHTTP(w http.ResponseWriter, r *http.Request) { if e := fn(w, r); e != nil { // e is *appError, not os.Error. http.Error(w, e.Message, e.Code) }}func init() { http.Handle(""/view"", appHandler(viewRecord)) //viewRecord is an appHandler function} func init() { http.Handle(""/view"", AuthHandler(appHandler(viewRecord))) }",Including context objects through multiple HTTP handlers in golang
"osx - `go get` fails on permission denied, `sudo go get` fails on $GOPATH not set"," Installing some go packages fails with permission denied error, eg.: When I tried using sudo to fix the permission issue, it failed with $GOPATH not set error: How can I solve this? <code>  $ go get code.google.com/p/go.tools/cmd/covergo install code.google.com/p/go.tools/cmd/cover: open /usr/local/go/pkg/tool/darwin_amd64/cover: permission denied $ sudo go get code.google.com/p/go.tools/cmd/coverPassword:package code.google.com/p/go.tools/cmd/cover: cannot download, $GOPATH not set. For more details see: go help gopath",`go get` fails with permission denied on certain go packages
"osx - `go get` fails with permission denied on godoc, vet and cover packages"," Installing some go packages fails with permission denied error, eg.: When I tried using sudo to fix the permission issue, it failed with $GOPATH not set error: How can I solve this? <code>  $ go get code.google.com/p/go.tools/cmd/covergo install code.google.com/p/go.tools/cmd/cover: open /usr/local/go/pkg/tool/darwin_amd64/cover: permission denied $ sudo go get code.google.com/p/go.tools/cmd/coverPassword:package code.google.com/p/go.tools/cmd/cover: cannot download, $GOPATH not set. For more details see: go help gopath",`go get` fails with permission denied on certain go packages
"osx - `go get` fails with permission denied on godoc, vet, cover and goimports packages"," Installing some go packages fails with permission denied error, eg.: When I tried using sudo to fix the permission issue, it failed with $GOPATH not set error: How can I solve this? <code>  $ go get code.google.com/p/go.tools/cmd/covergo install code.google.com/p/go.tools/cmd/cover: open /usr/local/go/pkg/tool/darwin_amd64/cover: permission denied $ sudo go get code.google.com/p/go.tools/cmd/coverPassword:package code.google.com/p/go.tools/cmd/cover: cannot download, $GOPATH not set. For more details see: go help gopath",`go get` fails with permission denied on certain go packages
osx - `go get` fails with permission denied on certain go packages," Installing some go packages fails with permission denied error, eg.: When I tried using sudo to fix the permission issue, it failed with $GOPATH not set error: How can I solve this? <code>  $ go get code.google.com/p/go.tools/cmd/covergo install code.google.com/p/go.tools/cmd/cover: open /usr/local/go/pkg/tool/darwin_amd64/cover: permission denied $ sudo go get code.google.com/p/go.tools/cmd/coverPassword:package code.google.com/p/go.tools/cmd/cover: cannot download, $GOPATH not set. For more details see: go help gopath",`go get` fails with permission denied on certain go packages
How can I query mongodb with date range using golang?," Hi I have a collection named ""my_sales"" having fields product_name, price, sale_date.My doc looks like I tried in mongo shell like this It giving the correct result. Now I need to query same thing using golang I tried like this Its giving null result please help <code>  { ""_id"" : ObjectId(""5458b6ee09d76eb7326df3a4""), ""product_name"" : product1, ""price"" : 200, ""sale_date"" : ISODate(""2014-11-04T11:22:19.589Z"")}{ ""_id"" : ObjectId(""5458b6ee09d76eb7326df3a4""), ""product_name"" : product1, ""price"" : 200, ""sale_date"" : ISODate(""2014-11-04T11:22:19.589Z"")}{ ""_id"" : ObjectId(""5458b6ee09d76eb7326df3a4""), ""product_name"" : product1, ""price"" : 200, ""sale_date"" : ISODate(""2014-11-04T11:22:19.589Z"")}{ ""_id"" : ObjectId(""5458b6ee09d76eb7326df3a4""), ""product_name"" : product1, ""price"" : 200, ""sale_date"" : ISODate(""2014-11-05T11:22:19.589Z"")} db.my_sales.find({ sale_date: { $gt: ISODate(""2014-11-04""), $lt: new ISODate(""2014-11-05"") }); var sales_his []Sale err := c.Find(bson.M{""sale_date"":bson.M{ ""$gt"": ""ISODate(""+date_from+"")"", ""$lt"": ""ISODate(""+date_to+"")"" } }).All(&sales_his)",How can I query MongoDB with date range using mgo and Go?
Golang Testing with Appengine = Frustration," So I have spent the better part of two days trying to figure this one out and no matter what I do I can't get things straightened out. Here is what is going on:Using Go and Appengine. I am running into issues when trying toget proper unit tests working.I have tried lots of structures but here is a sample of where I am now: https://github.com/markhayden/SampleIssueI am running into dependency issues in either goapp serve or goapp test -v ./src/lib1 depending on how I have my import paths set. If I use ""src/lib1"" for my import path and then goapp serve. My app boots and runs fine, but when I run tests I get the following failure: Likewise, if I use ""dummy/src/lib1"" as my path, my tests are happy and run fine but upon goapp serve ing the app I now get: Have fiddled with all sorts of different options and can't figure out how to handle dependencies and still have solid testing. Maybe its a appengine / golang bug? Or am I missing something?Any help would be very much appreciated. Thanks in advance!Updated everything based on first comment feedback. I can run tests (as I was able to do before) but I still can not serve the app. Here is what I get when running goapp serve $GOPATH = /Users/markhayden/Projects/go$GOROOT = not set (according to docs it doesnt need to be if you dont use a custom directory)App Structure: In main.go: In lib1/lib1.go: <code>  src/lib1/lib1.go:5:2: cannot find package ""src/lib2"" in any of: /Users/USERNAME/go_appengine/goroot/src/pkg/src/lib2 (from $GOROOT) /Users/markhayden/Projects/go/src/src/lib2 (from $GOPATH) 2014/11/06 20:33:34 go-app-builder: Failed parsing input: app file lib1.go conflicts with same file imported from GOPATH INFO 2014-11-07 17:24:48,727 devappserver2.py:745] Skipping SDK update check.INFO 2014-11-07 17:24:48,748 api_server.py:172] Starting API server at: http://localhost:60732INFO 2014-11-07 17:24:48,751 dispatcher.py:185] Starting module ""default"" running at: http://localhost:8080INFO 2014-11-07 17:24:48,754 admin_server.py:118] Starting admin server at: http://localhost:8000ERROR 2014-11-07 17:24:49,041 go_runtime.py:171] Failed to build Go application: (Executed command: /Users/markhayden/go_appengine/goroot/bin/go-app-builder -app_base /Users/markhayden/Projects/go/src/github.com/markhayden/SampleIssue -arch 6 -dynamic -goroot /Users/markhayden/go_appengine/goroot -nobuild_files ^^$ -unsafe -gopath /Users/markhayden/Projects/go -print_extras_hash lib1/lib1.go lib2/lib2_test.go main_test.go main.go lib1/lib1_test.go lib2/lib2.go)2014/11/07 09:24:49 go-app-builder: Failed parsing input: app file lib2.go conflicts with same file imported from GOPATH $GOPATH/src/github.com/markhayden/SampleIssue/ - app.yaml - /lib1 - lib1_test.go - lib1.go - /lib2 - lib2_test.go - lib2.go - main_test.go - main.go import ( ""fmt"" ""github.com/markhayden/SampleIssue/lib1"" ""net/http"") import ( ""fmt"" ""github.com/markhayden/SampleIssue/lib2"")",Google Go AppEngine imports and conflicts when serving / testing
Google Golang AppEngine imports and conflicts when serving / testing," So I have spent the better part of two days trying to figure this one out and no matter what I do I can't get things straightened out. Here is what is going on:Using Go and Appengine. I am running into issues when trying toget proper unit tests working.I have tried lots of structures but here is a sample of where I am now: https://github.com/markhayden/SampleIssueI am running into dependency issues in either goapp serve or goapp test -v ./src/lib1 depending on how I have my import paths set. If I use ""src/lib1"" for my import path and then goapp serve. My app boots and runs fine, but when I run tests I get the following failure: Likewise, if I use ""dummy/src/lib1"" as my path, my tests are happy and run fine but upon goapp serve ing the app I now get: Have fiddled with all sorts of different options and can't figure out how to handle dependencies and still have solid testing. Maybe its a appengine / golang bug? Or am I missing something?Any help would be very much appreciated. Thanks in advance!Updated everything based on first comment feedback. I can run tests (as I was able to do before) but I still can not serve the app. Here is what I get when running goapp serve $GOPATH = /Users/markhayden/Projects/go$GOROOT = not set (according to docs it doesnt need to be if you dont use a custom directory)App Structure: In main.go: In lib1/lib1.go: <code>  src/lib1/lib1.go:5:2: cannot find package ""src/lib2"" in any of: /Users/USERNAME/go_appengine/goroot/src/pkg/src/lib2 (from $GOROOT) /Users/markhayden/Projects/go/src/src/lib2 (from $GOPATH) 2014/11/06 20:33:34 go-app-builder: Failed parsing input: app file lib1.go conflicts with same file imported from GOPATH INFO 2014-11-07 17:24:48,727 devappserver2.py:745] Skipping SDK update check.INFO 2014-11-07 17:24:48,748 api_server.py:172] Starting API server at: http://localhost:60732INFO 2014-11-07 17:24:48,751 dispatcher.py:185] Starting module ""default"" running at: http://localhost:8080INFO 2014-11-07 17:24:48,754 admin_server.py:118] Starting admin server at: http://localhost:8000ERROR 2014-11-07 17:24:49,041 go_runtime.py:171] Failed to build Go application: (Executed command: /Users/markhayden/go_appengine/goroot/bin/go-app-builder -app_base /Users/markhayden/Projects/go/src/github.com/markhayden/SampleIssue -arch 6 -dynamic -goroot /Users/markhayden/go_appengine/goroot -nobuild_files ^^$ -unsafe -gopath /Users/markhayden/Projects/go -print_extras_hash lib1/lib1.go lib2/lib2_test.go main_test.go main.go lib1/lib1_test.go lib2/lib2.go)2014/11/07 09:24:49 go-app-builder: Failed parsing input: app file lib2.go conflicts with same file imported from GOPATH $GOPATH/src/github.com/markhayden/SampleIssue/ - app.yaml - /lib1 - lib1_test.go - lib1.go - /lib2 - lib2_test.go - lib2.go - main_test.go - main.go import ( ""fmt"" ""github.com/markhayden/SampleIssue/lib1"" ""net/http"") import ( ""fmt"" ""github.com/markhayden/SampleIssue/lib2"")",Google Go AppEngine imports and conflicts when serving / testing
How to test a function's output (stdout/stderr) in Go unit tests," I have a simple function I want to test: But how can I test what the function actually sends to standard output? Test::Output does what I want in Perl. I know I could write all my own boilerplate to do the same in Go (as described here): But that's a lot of extra work for every single test. I'm hoping there's a more standard way, or perhaps an abstraction library to handle this. <code>  func (t *Thing) print(min_verbosity int, message string) { if t.verbosity >= minv { fmt.Print(message) }} orig = os.Stdoutr,w,_ = os.Pipe()thing.print(""Some message"")var buf bytes.Bufferio.Copy(&buf, r)w.Close()os.Stdout = origif(buf.String() != ""Some message"") { t.Error(""Failure!"")}",How to test a function's output (stdout/stderr) in unit tests
How to use double star glob in golang?," It seems like Go is one of few languages that does not seem to understand the double star (""globstar"") syntax for file globbing. At least this does not seems to work as expected: Am I missing something about the filepath implementation?Is there a library around that does support this? <code>  filepath.Glob(dir + ""/**/*.bundle/*.txt"")",How to use double star glob in Go?
"In a golang slice, why does s[lo:hi] equate to lo:hi-1?"," According to the Tour of Go, in a Go slice s, the expression s[lo:hi] evaluates to a slice of the elements from lo through hi-1, inclusive: In my code example above, ""p[0:3]"" would seem to intuitively ""read"" as: ""the slice from position 0 to position 3"", equating to [0, 10, 20, 30]. But of course, it actually equates to [0 10 20].So my question is: what is the design rationale for the upper value evaluating to hi-1 rather than simply hi? It feels unintuitive, but there must be some reason for it that I'm missing, and I'm curious what that might be.Thanks in advance. <code>  package mainimport ""fmt""func main() { p := []int{0, // slice position 0 10, // slice position 1 20, // slice position 2 30, // slice position 3 40, // slice position 4 50} // slice position 5 fmt.Println(p[0:3]) // => [0 10 20]} ","In a Go slice, why does s[lo:hi] end at element hi-1?"
"In a golang slice, why does s[lo:hi] end at element hi-1?"," According to the Tour of Go, in a Go slice s, the expression s[lo:hi] evaluates to a slice of the elements from lo through hi-1, inclusive: In my code example above, ""p[0:3]"" would seem to intuitively ""read"" as: ""the slice from position 0 to position 3"", equating to [0, 10, 20, 30]. But of course, it actually equates to [0 10 20].So my question is: what is the design rationale for the upper value evaluating to hi-1 rather than simply hi? It feels unintuitive, but there must be some reason for it that I'm missing, and I'm curious what that might be.Thanks in advance. <code>  package mainimport ""fmt""func main() { p := []int{0, // slice position 0 10, // slice position 1 20, // slice position 2 30, // slice position 3 40, // slice position 4 50} // slice position 5 fmt.Println(p[0:3]) // => [0 10 20]} ","In a Go slice, why does s[lo:hi] end at element hi-1?"
Initialize nested struct definition in Golang," How do you initialize the following struct? I tried: Didn't work: I tried: Didn't work: <code>  type Sender struct { BankCode string Name string Contact struct { Name string Phone string }} s := &Sender{ BankCode: ""BC"", Name: ""NAME"", Contact { Name: ""NAME"", Phone: ""PHONE"", }, } mixture of field:value and value initializersundefined: Contact s := &Sender{ BankCode: ""BC"", Name: ""NAME"", Contact: Contact { Name: ""NAME"", Phone: ""PHONE"", }, } undefined: Contact",Initialize nested struct definition
Go: go run can't find second file in package main," I am experiencing an issue where go run main.go produces the error: However the commands go build && ./goruntest compile and run the program just fine.The output is:Hi from test()Hi from sameFileTest()Hi from pkgtest.Test()Hi from pkgtest.Test1()I have the directory set-up like so: Here is the code.main.go gotest1.go pkgtest/pkgtest.go pkgtest/pkgtest1.go I understand that the problem is the second file as part of package main and I also understand that there is no real reason to have a second file in main.My question is: Why is go run unable to handle this set-up but building and running the executable works just fine?EDITIncluded a second file in pkgtestI also understand that the command go run main.go gotest1.go works but why do I need to specify gotest1.go?I originally omitted these details for the sake of brevity. But now I see they are important to the question. <code>  # command-line-arguments./main.go:9: undefined: test go/src/github.com/username/goruntest/ pkgtest/ pkgtest.go pkgtest1.go main.go test2.go package mainimport ( ""fmt"" ""github.com/username/goruntest/pkgtest"")func main() { fmt.Println(test()) // main.go:9 fmt.Println(sameFileTest()) fmt.Println(pkgtest.Test()) fmt.Println(pkgtest.Test1())}func sameFileTest() string { return ""Hi from sameFileTest()""} package mainfunc test() string { return ""Hi from test()""} package pkgtestfunc Test() string { return ""Hi from pkgtest.Test()""} package pkgtestfunc Test1() string { return ""Hi from pkgtest.Test1()""}","Why does the ""go run"" command fail to find a second file in the main package?"
GO language: Reading json file to create array and SSH channeling," Code below works fine with hard coded JSON data however doesn't work when I read JSON data from a file. I'm getting fatal error: all goroutines are asleep - deadlock error when using sync.WaitGroup.WORKING EXAMPLE WITH HARD-CODED JSON DATA: OUTPUT: NOT WORKING - EXAMPLE WITH READING JSON DATA FILE: OUTPUT HOSTS.TXT <code>  package mainimport ( ""bytes"" ""fmt"" ""os/exec"" ""time"")func connect(host string) { cmd := exec.Command(""ssh"", host, ""uptime"") var out bytes.Buffer cmd.Stdout = &out err := cmd.Run() if err != nil { fmt.Println(err) } fmt.Printf(""%s: %q\n"", host, out.String()) time.Sleep(time.Second * 2) fmt.Printf(""%s: DONE\n"", host)}func listener(c chan string) { for { host := <-c go connect(host) }}func main() { hosts := [2]string{""user1@111.79.154.111"", ""user2@111.79.190.222""} var c chan string = make(chan string) go listener(c) for i := 0; i < len(hosts); i++ { c <- hosts[i] } var input string fmt.Scanln(&input)} user@user-VirtualBox:~/go$ go run channel.gouser1@111.79.154.111: "" 09:46:40 up 86 days, 18:16, 0 users, load average: 5""user2@111.79.190.222: "" 09:46:40 up 86 days, 17:27, 1 user, load average: 9""user1@111.79.154.111: DONEuser2@111.79.190.222: DONE package mainimport ( ""bytes"" ""fmt"" ""os/exec"" ""time"" ""encoding/json"" ""os"" ""sync"")func connect(host string) { cmd := exec.Command(""ssh"", host, ""uptime"") var out bytes.Buffer cmd.Stdout = &out err := cmd.Run() if err != nil { fmt.Println(err) } fmt.Printf(""%s: %q\n"", host, out.String()) time.Sleep(time.Second * 2) fmt.Printf(""%s: DONE\n"", host)}func listener(c chan string) { for { host := <-c go connect(host) }}type Content struct { Username string `json:""username""` Ip string `json:""ip""`}func main() { var wg sync.WaitGroup var source []Content var hosts []string data := json.NewDecoder(os.Stdin) data.Decode(&source) for _, value := range source { hosts = append(hosts, value.Username + ""@"" + value.Ip) } var c chan string = make(chan string) go listener(c) for i := 0; i < len(hosts); i++ { wg.Add(1) c <- hosts[i] defer wg.Done() } var input string fmt.Scanln(&input) wg.Wait()} user@user-VirtualBox:~/go$ go run deploy.go < hosts.txt user1@111.79.154.111: "" 09:46:40 up 86 days, 18:16, 0 users, load average: 5""user2@111.79.190.222: "" 09:46:40 up 86 days, 17:27, 1 user, load average: 9""user1@111.79.154.111 : DONEuser2@111.79.190.222: DONEfatal error: all goroutines are asleep - deadlock!goroutine 1 [semacquire]:sync.runtime_Semacquire(0xc210000068) /usr/lib/go/src/pkg/runtime/sema.goc:199 +0x30sync.(*WaitGroup).Wait(0xc210047020) /usr/lib/go/src/pkg/sync/waitgroup.go:127 +0x14bmain.main() /home/user/go/deploy.go:64 +0x45agoroutine 3 [chan receive]:main.listener(0xc210038060) /home/user/go/deploy.go:28 +0x30created by main.main /home/user/go/deploy.go:53 +0x30bexit status 2user@user-VirtualBox:~/go$ [ { ""username"":""user1"", ""ip"":""111.79.154.111"" }, { ""username"":""user2"", ""ip"":""111.79.190.222"" }]",GO language: fatal error: all goroutines are asleep - deadlock
I can't run Go programms anymore," This is the oddest problem I've ever encountered. I have my Go development environment set up on a Windows 2008 R2 virtual machine. I don't even restart it nor run Windows update.Today I just realized that I can no longer run Go programs. I can successfully build and run unit tests with 'go test'. However, running any compiled Go program, (even hello world) causes a pop-up window titled 'Unsupported 16-bit application' to appear. The error message is as follows: The version of this file is not compatible with the version of Windows you're running. Check your computer's system information to see whether you need an x86 (32-bit) or x64 (64-bit) version of the program, and then contact the software publisher.The result is the same regardless of what version of Go I use (x86/x64). Also note that I'm not using any IDE. I call go.exe to build/test from the command line.I can't get my head around this since running 'go test' works just fine. Any thoughts?EDIT:Here's the console output when I build and run the program:build/run outputInterestingly, dumpbin suggests that indeed there's something wrong with the executable And here's the full source code: EDIT2:I've reinstalled Go twice with no effect. <code>  C:\Program Files (x86)\Microsoft Visual Studio 11.0>dumpbin /headersC:\Projects \GoPlayground\src\playground\playground.exe Microsoft (R)COFF/PE Dumper Version 11.00.51106.1 Copyright (C) MicrosoftCorporation. All rights reserved.Dump of file C:\Projects\GoPlayground\src\playground\playground.exeFile Type: LIBRARYC:\Projects\GoPlayground\src\playground\playground.exe : warningLNK4003: invali d library format; library ignoredC:\Projects\GoPlayground\src\playground\playground.exe : warningLNK4048: Invali d format file; ignored SummaryC:\Program Files (x86)\Microsoft Visual Studio 11.0> package playgroundimport ""fmt""import ""playground/another""func main() { fmt.Println(""Hello world!"") fmt.Println(another.Foobar(2))}-------------------package anotherfunc Foobar(i int) int { return i + 1}",I can't run Go programs anymore
How does pointer dereferencing work in golang?," I'm going through the golang tutorials at http://tour.golang.org/, and was experimenting a bit with some things in example 29For your reference, the original example is copied here: It's pretty basic, showing how to create instances of this fancy new struct, Vertex. Example 28, though, shows manipulating a vertex via a pointer to it, so I modified the example a bit and was surprised by the output. Here is the modification: And the output: The thing that surprised me is that t is not {4, 2}, which seems to mean that changing q.X changed the instance of the struct that q pointed to. Coming from a C/C++ background, this seems like extremely strange behavior to me.So, what's actually going on here? Why does using q.X = 4 to change the Vertex not propagate to t? <code>  package mainimport ""fmt""type Vertex struct { X, Y int}var ( p = Vertex{1, 2} // has type Vertex q = &Vertex{1, 2} // has type *Vertex r = Vertex{X: 1} // Y:0 is implicit s = Vertex{} // X:0 and Y:0)func main() { fmt.Println(p, q, r, s)} func main() { t := *q q.X = 4 u := *q fmt.Println(p, q, r, s, t, u, t == u)} {1 2} &{4 2} {1 0} {0 0} {1 2} {4 2} false",How does pointer dereferencing work in Go?
Pretty printing golang variable," Is there something like Ruby's awesome_print in Go?For example in Ruby you could write: the output would be: closest thing that I could found is Printf(""%#v"", x) <code>  require 'ap'x = {a:1,b:2} // also works for classap x { ""a"" => 1, ""b"" => 2}",How to pretty print variables
golang: difference between method receiver and parameter?," Looking at the Go documentation shown below, I'm having trouble understanding the distinction between receivers and parameters: This method's signature reads: This is a method named save that takes as its receiver p, a pointer to Page . It takes no parameters, and returns a value of type error. <code>  func (p *Page) save() error { filename := p.Title + "".txt"" return ioutil.WriteFile(filename, p.Body, 0600) }",What is the difference between a method receiver and parameter?
Go: difference between method receiver and parameter?," Looking at the Go documentation shown below, I'm having trouble understanding the distinction between receivers and parameters: This method's signature reads: This is a method named save that takes as its receiver p, a pointer to Page . It takes no parameters, and returns a value of type error. <code>  func (p *Page) save() error { filename := p.Title + "".txt"" return ioutil.WriteFile(filename, p.Body, 0600) }",What is the difference between a method receiver and parameter?
Go: what is the difference between a method receiver and parameter?," Looking at the Go documentation shown below, I'm having trouble understanding the distinction between receivers and parameters: This method's signature reads: This is a method named save that takes as its receiver p, a pointer to Page . It takes no parameters, and returns a value of type error. <code>  func (p *Page) save() error { filename := p.Title + "".txt"" return ioutil.WriteFile(filename, p.Body, 0600) }",What is the difference between a method receiver and parameter?
Cast a struct pointer to interface pointer in golang, I have a function the purpose of this function is to be able to treat a pointer of any type as input.But when I want to call it with a the pointer of a struct I have an error. When calling doStuff I have How can I cast &ms to be compatible with *interface{}? <code>  func doStuff(inout *interface{}) { ...} type MyStruct struct { f1 int} ms := MyStruct{1}doStuff(&ms) test.go:38: cannot use &ms (type *MyStruct) as type **interface {} in argument to doStuff,Cast a struct pointer to interface pointer in Golang
Can I use Goroutines in Google App Engine?," The following example seems to work, but is it safe to use? My goal is to do some very light background processing (whereas an actual task queue job feels too heavy). <code>  func MyHandler(w http.ResponseWriter, r *http.Request) { go func() { // do something ... }() return // 200}",Can I use Goroutines in Google App Engine (Standard Environment)?
golang alternative for python loop.last," I'm looking to loop over an array with Go templates and I want to add an extra string to the last item in the loop.In python, I can do Looking to achieve same thing with Go, below is the snippet of the Go equivalent. Thanks. <code>  {% for host in hosts %}{{ host }}{% if loop.last %} ;{% endif %}{% endfor %} {{ range $host := $hosts }}{{$host}}{{ end }}",Go alternative for python loop.last
Reading a file concurrently in Golang," The reading part isn't concurrent but the processing is. I phrased the title this way because I'm most likely to search for this problem again using that phrase. :)I'm getting a deadlock after trying to go beyond the examples so this is a learning experience for me. My goals are these:Read a file line by line (eventually use a buffer to do groups of lines).Pass off the text to a func() that does some regex work.Send the results somewhere but avoid mutexes or shared variables. I'm sending ints (always the number 1) to a channel. It's sort of silly but if it's not causing problems I'd like to leave it like this unless you folks have a neater option.Use a worker pool to do this. I'm not sure how I tell the workers to requeue themselves?Here is the playground link. I tried to write helpful comments, hopefully this makes sense. My design could be completely wrong so don't hesitate to refactor. <code>  package mainimport ( ""bufio"" ""fmt"" ""regexp"" ""strings"" ""sync"")func telephoneNumbersInFile(path string) int { file := strings.NewReader(path) var telephone = regexp.MustCompile(`\(\d+\)\s\d+-\d+`) // do I need buffered channels here? jobs := make(chan string) results := make(chan int) // I think we need a wait group, not sure. wg := new(sync.WaitGroup) // start up some workers that will block and wait? for w := 1; w <= 3; w++ { wg.Add(1) go matchTelephoneNumbers(jobs, results, wg, telephone) } // go over a file line by line and queue up a ton of work scanner := bufio.NewScanner(file) for scanner.Scan() { // Later I want to create a buffer of lines, not just line-by-line here ... jobs <- scanner.Text() } close(jobs) wg.Wait() // Add up the results from the results channel. // The rest of this isn't even working so ignore for now. counts := 0 // for v := range results { // counts += v // } return counts}func matchTelephoneNumbers(jobs <-chan string, results chan<- int, wg *sync.WaitGroup, telephone *regexp.Regexp) { // Decreasing internal counter for wait-group as soon as goroutine finishes defer wg.Done() // eventually I want to have a []string channel to work on a chunk of lines not just one line of text for j := range jobs { if telephone.MatchString(j) { results <- 1 } }}func main() { // An artificial input source. Normally this is a file passed on the command line. const input = ""Foo\n(555) 123-3456\nBar\nBaz"" numberOfTelephoneNumbers := telephoneNumbersInFile(input) fmt.Println(numberOfTelephoneNumbers)}",Reading a file concurrently
Correct way of getting Client's IP Addresses from http.Request (golang)," What's the correct way to get all client's IP Addresses from http.Request? In PHP there are a lot of variables that I should check. Is it the same on Go? One that I found is: And is the request case sensitive? for example x-forwarded-for is the same as X-Forwarded-For and X-FORWARDED-FOR? (from req.Header.Get(""X-FORWARDED-FOR"")) <code>  req.RemoteAddr",Correct way of getting Client's IP Addresses from http.Request
Correct way of getting Client's IP Addresses from http.Request (Golang)," What's the correct way to get all client's IP Addresses from http.Request? In PHP there are a lot of variables that I should check. Is it the same on Go? One that I found is: And is the request case sensitive? for example x-forwarded-for is the same as X-Forwarded-For and X-FORWARDED-FOR? (from req.Header.Get(""X-FORWARDED-FOR"")) <code>  req.RemoteAddr",Correct way of getting Client's IP Addresses from http.Request
Send e-mail over smtp in golang and change the sender's name," I am sending e-mails over smtp in golang, which works perfectly fine. To set the sender of an e-mail I use the Client.Mail funtion: When the recipient gets the e-mail he sees the sender as plaintext e-mail address: sender@example.comI want the sender to be displayed like: Sandy Sender <sender@example.com>.Is this possible? I tried setting the sender to Sandy Sender <sender@example.com> or only Sandy Sender but none of them work. I get the error 501 5.1.7 Invalid address <code>  func (c *Client) Mail(from string) error",Send e-mail over smtp and change the sender's name
How to check if slice has a given index in Go?," We can easily do that with maps: But not with slices: Surprised this wasn't asked before. Maybe I'm on the wrong mental model with Go slices? <code>  item, ok := myMap[""index""] item, ok := mySlice[3] // panic!",How to check if a slice has a given index in Go?
Golang how to use function as map's key, How to use function as map's key? for example: those code would show an error: invalid map key type Action <code>  type Action func(int)func test(a int) { }func test2(a int) { }func main() { x := map[Action]bool{} x[test] = true x[test2] = false},How to use function as map's key
runtime error: assignment to entry in nil map Golang," I am trying to generate a map and then convert that to a yaml file like this: I think I am missing something important while creating the map. My code is below. It is giving the following error: <code>  uid : kasi: cn: Chaithra street: fkmp nandan: cn: Chaithra street: fkmp remya: cn: Chaithra street: fkmp package mainimport ( ""fmt"" ""gopkg.in/yaml.v2"")type T struct { cn string street string}func main() { names := []string{""kasi"", ""remya"", ""nandan""} m := make(map[string]map[string]T, len(names)) for _, name := range names { //t := T{cn: ""Chaithra"", street: ""fkmp""} m[""uid""][name] = T{cn: ""Chaithra"", street: ""fkmp""} } fmt.Println(m) y, _ := yaml.Marshal(&m) fmt.Println(string(y)) //fmt.Println(m, names)} panic: runtime error: assignment to entry in nil map",Runtime error: assignment to entry in nil map
Convert byte array to int using GO language," I see some answers to exactly the same question I have: How to convert Byte array to int in GO programming language?I wrote below function to convert byte array to int Before that, I made sure that byte array has correct(base 256) values. in[0] = 54 (ASCII for 6), in[1] = 54 (ASCII for 6), in[2] = 49 (ASCII for 1), in[3] = 49 (ASCII for 1).So I am expecting to retrieve integer 6611 value from byte array, but I ended up getting 909521201. I fail to understand what is exactly going on in such a simple conversion.Can anyone flash some light?THanks <code>  func convertByteToInt(in []byte) int32 { return (int32(in[0]) << 24 | int32(in[1]) << 16 | int32(in[2]) << 8 | int32(in[3]))}",Convert byte array of ASCII numeric characters to int using GO language
How to pass arguments to go flags," I have a simple boolean flag I wish to pass args to: This code compiles and runs - but the variable is always true. I use the following call: and it's never false. What am I doing wrong? <code>  import ( ""flag"" ... )var debugMode = flag.Bool(""debug"", false, ""run in debug mode"")flag.Parse()if *debugMode == true { //print something} my_application -debug false",How to pass boolean arguments to go flags
Any Way To Escape a Golang String in a Regular Expression?, I'm wanting to match ^(@|\s)*{{string}}:? whereas {{string}} is dynamically defined. It may have periods and dashes and any number of things in it and I really need for it to be escaped.PHP provides a preg_quote method that escapes all special characters safely. I was wondering if Go provides any sort of analog. <code> ,Any way to escape a Go string in a regular expression?
Type is not an expression error," Using struct and a function that is supposed to print out the struct's elements, I have written this simple program: When I run it I get the error go:16: type Salutation is not an expression. What goes wrong here?Interestingly enough, when I change the definition of s to var s = Salutation {""Alex"", ""Hi""} it works just fine. But they are basically different syntactic ways to define the same entity. That's why I don't understand the source of the error.  <code>  package mainimport ""fmt""type Salutation struct { name string greeting string}func Greet(salutation Salutation) { fmt.Println(salutation.name) fmt.Println(salutation.greeting)}func main() { var s = Salutation s.name = ""Alex"" s.greeting = ""Hi"" Greet(s)}",Error: struct Type is not an expression
how to run a GO project in eclipse with goclipse installed," I have installed goclipse in my eclipse and created a new go project.Now this is what I have:And I have hello.go looks like this: Then I press run button, or right click the file hello.go, and then run, it gives nothing. Besides, it is also empty in bin folder.Then I press run configurations button, almost empty there with only a project name. it gives: This is my Preferences for Go:I noticed that both GOROOT and GOPATH are different from those listed in explorer, but once I changed them to C:\Go\src\pkg or C:\Go\src, the Apply and OK button becomes disabled. Besides, I don't have C:\Go\src\pkg folder either.I can go install or go build in command line, but I would like to use eclipse for another much larger project. It's windows 7, and the eclipse version is Luna Service Release 1 (4.4.1). Thank you.EDIT: Now I have the following configurations, and it works fine:Go is installed at c:\Goin Preferences: GOROOT:C:\Go, GOPATH: C:\Users\Tiina\go_workspaceThe rest in Preferences is filled in automatically.helloTest project is located at C:\Users\Tiina\go_workspace\src\helloTesthello.go is located at C:\Users\Tiina\go_workspace\src\helloTest\hello.goMaybe because I create a project from existing code, and there was something left behind, it automatically adds another GOPATH, in Preferences delete it. <code>  package mainimport ""fmt""func main() { fmt.Println(""Hello"")} Given Go package not found.",How to run a GO project in eclipse with goclipse installed
How to get value from map - GOLang?," ProblemFetching data from mapData Format NoteHow to get the following value from the above resultEvent_dtmReleaseDatestrIDTrans_strGuestListWhat i tried:res.Map(""Event_dtmReleaseDate"");Error : res.Map undefined (type map[string]interface {} has no field or method Map)res.Event_dtmReleaseDate;Error: v.id undefined (type map[string]interface {} has no field or method id) <code>  res = map[Event_dtmReleaseDate:2009-09-15 00:00:00 +0000 +00:00 Trans_strGuestList:<nil> strID:TSTB]",How to get a value from map
GoLang: check whether type of value of variable is function or not," How I can check that some variable in golang has type func, like this: <code>  func A() {}func main() { variable := A isFunc := IsFunc(variable) // true or false}",Go: check whether type of value is function
Go: Marshal nested structs into JSON," How do I marshal a nested struct into JSON? I know how to marshal the struct without any nested structs. However when I try to make the JSON response look like this: I run into problems.My code looks like this:Go: However, I get the error Missing type in composite literalHow do I resolve this? <code>  {""genre"": {""country"": ""taylor swift"", ""rock"": ""aimee""}} type Music struct { Genre struct { Country string Rock string }}resp := Music{ Genre: { // error on this line. Country: ""Taylor Swift"", Rock: ""Aimee"", },}js, _ := json.Marshal(resp)w.Write(js)",Marshal nested structs into JSON
golang: convert []string to []interface{}," I just want to write some code like this: I thought interface{} can represent any type, so []interface can also represent any []type before, now I know I'm wrong, []type is a whole type, can't be considered as []interface{}.So, can anyone help me how to make this code work, or any other solution?PS: I know that []byte or string can be converted to one another, but it's not actually my intention, may be there is another type rather than []byte and string. <code>  func (w Writer) WriteVString(strs []string) (int, error) { return writeV(func(index int, str interface{}) (int, error) { return w.WriteString(str.(string)) }, strs) // it doesn't work}func (w Writer) WriteV(bs [][]byte) (int, error) { return writeV(func(index int, b interface{}) (int, error) { return w.Write(b.([]byte)) }, []interface{}{bs...}) // it also can't be compiled}type writeFunc func(int, interface{}) (int, error)func writeV(fn writeFunc, slice []interface{}) (n int, err error) { var m int for index, s := range slice { if m, err = fn(index, s); err != nil { break } n += m ) return}",Convert []string to []interface{}
Embeddding when to use pointer," When I want to embed a struct within another struct, should I use a pointer or value?For example or <code>  type Job struct { Command string *log.Logger} type Job struct { Command string log.Logger}",Embedding when to use pointer
Android Studio and Golang?," Can you use Android Studio for Go development? I am able to install the gaoling plugin, but can not start a Go project?Thanks <code> ",Android Studio and Go?
golang plugin on notepad++," Did someone try using golang (Go programming language) plugin for Notepad++?I tried the instructions published at the below link, but it did not work for me. Just wondering if it worked for anyone:http://go-lang.cat-v.org/text-editors/notepad-plus-plus/ <code> ",Go language plugin for Notepad++
"What is ""_,"" in a golang declaration?"," And I can't seem to understand this kind of variable declaration: What exactly is ""_,"" doing and why have they declared a variable like this instead of (I found it as part of Go by Example: Maps) <code>  _, prs := m[""example""] prs := m[""example""]","What is ""_,"" (underscore comma) in a Go declaration?"
"What is ""_,"" in a Golang declaration?"," And I can't seem to understand this kind of variable declaration: What exactly is ""_,"" doing and why have they declared a variable like this instead of (I found it as part of Go by Example: Maps) <code>  _, prs := m[""example""] prs := m[""example""]","What is ""_,"" (underscore comma) in a Go declaration?"
Value receiver vs. Pointer receiver in Golang?," It is very unclear for me in which case I would want to use a value receiver instead of always using a pointer receiver.To recap from the docs: The docs also say ""For types such as basic types, slices, and small structs, a value receiver is very cheap so unless the semantics of the method requires a pointer, a value receiver is efficient and clear.""First point they docs say a value receiver is ""very cheap"", but the question is whether it is cheaper than a pointer receiver. So I made a small benchmark (code on gist) which showed me, that pointer receiver is faster even for a struct that has only one string field. These are the results: (Edit: Please note that second point became invalid in newer go versions, see comments.)Second point the docs say that a value receiver it is ""efficient and clear"" which is more a matter of taste, isn't it? Personally I prefer consistency by using the same thing everywhere. Efficiency in what sense? Performance wise it seems pointer are almost always more efficient. Few test-runs with one int property showed minimal advantage of Value receiver (range of 0.01-0.1 ns/op)Can someone tell me a case where a value receiver clearly makes more sense than a pointer receiver? Or am I doing something wrong in the benchmark? Did I overlook other factors? <code>  type T struct { a int}func (tv T) Mv(a int) int { return 0 } // value receiverfunc (tp *T) Mp(f float32) float32 { return 1 } // pointer receiver // Struct one empty string propertyBenchmarkChangePointerReceiver 2000000000 0.36 ns/opBenchmarkChangeItValueReceiver 500000000 3.62 ns/op// Struct one zero int propertyBenchmarkChangePointerReceiver 2000000000 0.36 ns/opBenchmarkChangeItValueReceiver 2000000000 0.36 ns/op",Value receiver vs. pointer receiver
Explanation of checking if value implements interface. Golang," I've read ""Effective Go"" and other Q&As like this: golang interface compliance compile type check , but nonetheless I can't understand properly how to use this technique.Please, see example: Is there any simple ways (eg without using reflection) check value if it implements an interface? <code>  type Somether interface { Method() bool}type MyType stringfunc (mt MyType) Method2() bool { return true}func main() { val := MyType(""hello"") //here I want to get bool if my value implements Somether _, ok := val.(Somether) //but val must be interface, hm..what if I want explicit type? //yes, here is another method: var _ Iface = (*MyType)(nil) //but it throws compile error //it would be great if someone explain the notation above, looks weird}",Explanation of checking if value implements interface
Solution for http://tour.golang.org/methods/11," Exercise: ReadersImplement a Reader type that emits an infinite stream of the ASCII character 'A'.I don't understand the question, how to emit character 'A'? into which variable should I set that character?Here's what I tried: <code>  package mainimport ""golang.org/x/tour/reader""type MyReader struct{}// TODO: Add a Read([]byte) (int, error) method to MyReader.func main() { reader.Validate(MyReader{}) // what did this function expect?}func (m MyReader) Read(b []byte) (i int, e error) { b = append(b, 'A') // this is wrong.. return 1, nil // this is also wrong..}","Tour of Go exercise #22: Reader, what does the question mean?"
Solution for https://tour.golang.org/methods/22," Exercise: ReadersImplement a Reader type that emits an infinite stream of the ASCII character 'A'.I don't understand the question, how to emit character 'A'? into which variable should I set that character?Here's what I tried: <code>  package mainimport ""golang.org/x/tour/reader""type MyReader struct{}// TODO: Add a Read([]byte) (int, error) method to MyReader.func main() { reader.Validate(MyReader{}) // what did this function expect?}func (m MyReader) Read(b []byte) (i int, e error) { b = append(b, 'A') // this is wrong.. return 1, nil // this is also wrong..}","Tour of Go exercise #22: Reader, what does the question mean?"
Tour of Go exercise #22: Reader what does mean the question?," Exercise: ReadersImplement a Reader type that emits an infinite stream of the ASCII character 'A'.I don't understand the question, how to emit character 'A'? into which variable should I set that character?Here's what I tried: <code>  package mainimport ""golang.org/x/tour/reader""type MyReader struct{}// TODO: Add a Read([]byte) (int, error) method to MyReader.func main() { reader.Validate(MyReader{}) // what did this function expect?}func (m MyReader) Read(b []byte) (i int, e error) { b = append(b, 'A') // this is wrong.. return 1, nil // this is also wrong..}","Tour of Go exercise #22: Reader, what does the question mean?"
Golang equivalent for Python's list iterator," I am playing with Go but I am having a very hard time doing things that are very simple in other languages.I'd like to reproduce a Python comprehension: What is an elegant way to do it in Go? I'd really like to simplify my code, especially when using a function on array. For example: <code>  array = [a for a in anotherArray if (some condition)] min = min(abs(a[i], b[j]) for i in range(n) for j in range(i, n))",Equivalent for Python's list comprehension
Golang equivalent for Python's list comprehension," I am playing with Go but I am having a very hard time doing things that are very simple in other languages.I'd like to reproduce a Python comprehension: What is an elegant way to do it in Go? I'd really like to simplify my code, especially when using a function on array. For example: <code>  array = [a for a in anotherArray if (some condition)] min = min(abs(a[i], b[j]) for i in range(n) for j in range(i, n))",Equivalent for Python's list comprehension
"Why there are two ways of declaring variables in GoLang, What's the different and which to use?"," According to the Go reference there are two ways of declaring a variableVariable_declarations (in the format of var count = 0 or var count int)andShort_variable_declarations (in the format of count := 0)I found it's very confusing to decide which one to use.The differences I know (till now) are that:I can only using a count := 0 format when in the scope of a function.count := 0 can be redeclared in a multi-variable short declaration.But they do behave the same as far as I know. And in the reference it also says: It (the count:=0way) is shorthand for a regular variable declaration with initializer expressions but no typesMy confusions are:If one is just the shorthand way of the other, why do they behave differently? In what concern does the author of Go make two ways of declaring a variable (why are they not merged into one way)? Just to confuse us?Is there any other aspect that I should keep my eyes open on when using them, in case I fall into a pit? <code> ","Why there are two ways of declaring variables in Go, what's the difference and which to use?"
Go language tutorial," According to fortyforty's reply to this question: fmt.Sprint(e) will call e.Error() to convert the value e to a string. If the Error() method calls fmt.Sprint(e), then the program recurses until out of memory. You can break the recursion by converting the e to a value without a String or Error method.This is still confusing to me. Why does fmt.Sprint(e) call e.Error() instead of String()? I tried using the Stringer interface, this is my code: <code>  package mainimport ( ""fmt"" ""math"")type NegativeSqrt float64func (e NegativeSqrt) Error() string { fmt.Printf(""."") return fmt.Sprint(e)}func (e NegativeSqrt) String() string { return fmt.Sprintf(""%f"", e)}func Sqrt(x float64) (float64, error) { if x < 0 { return 0, NegativeSqrt(x) } return math.Sqrt(x), nil}func main() { fmt.Println(Sqrt(2)) fmt.Println(Sqrt(-2))}",An infinite loop produced by fmt.Sprint(e) inside the Error method
Why can't I append string to byte slice as the GoLang reference specified?," Quote from the reference of append of Go As a special case, it is legal to append a string to a byte slice, like this: slice = append([]byte(""hello ""), ""world""...)But I find I can't do that as this snippet: What have I done wrong? <code>  package mainimport ""fmt""func main(){ a := []byte(""hello"") s := ""world"" a = append(a, s) //*Error*: can't use s(type string) as type byte in append fmt.Printf(""%s"",a)}",Why can't I append string to byte slice as the Go reference specified?
Why do i need to use http.StripPrefix to access my static files?," main.go Directory structure: Even after reading the documentation I have trouble understanding what exactly http.StripPrefix does here. 1) Why can't I access localhost:8080/static if I remove http.StripPrefix? 2) What URL maps to /static folder if I remove that function? <code>  package mainimport ( ""net/http"")func main() { http.Handle(""/static/"", http.StripPrefix(""/static/"", http.FileServer(http.Dir(""static"")))) http.ListenAndServe("":8080"", nil)} %GOPATH%/src/project_name/main.go%GOPATH%/src/project_name/static/..files and folders ..",Why do I need to use http.StripPrefix to access my static files?
golang remot imports fail," I just install golang with homebrew and I am having trouble importing remote packages.when I try to instal demo.go which contains I get the following error To my untrained eyes it looks like it is just looking locally on my GOPATH.  <code>  import ""github.com/bradfitz/gomemcache/memcache"" $ go installdemo.go:3:8: cannot find package ""github.com/bradfitz/gomemcache/memcache"" in any of:/usr/local/Cellar/go/1.4/libexec/src/github.com/bradfitz/gomemcache/memcache (from $GOROOT)/Users/white/go/src/github.com/bradfitz/gomemcache/memcache (from $GOPATH)",golang remote imports fail
"""range"" action and ""pipeline"" word clarification in text/html template package. Golang"," I try to get some fine points in text/html template package. I've read its documentation from golang site. It's difficult to understand what exactly means the . (dot) in general and at a certain time in the range action. What exactly means ""pipeline"", maybe it's difficult to understand because my English is not mother tongue): Let's consider an example: Here is ""index"": Output:TimurTimur1RenatRenat1{1 2 3.65 Something}{1 2 3.65 Something}1 <code>  {{pipeline}}The default textual representation of the value of the pipelineis copied to the output. data := map[string]interface{}{ ""struct"": &Order{ ID: 1, CustID: 2, Total: 3.65, Name: ""Something"", }, ""name1"": ""Timur"", ""name2"": ""Renat"", } t.ExecuteTemplate(rw, ""index"", data) {{define ""index""}} {{range $x := .}} {{.}} <b>{{$x}}</b><br> <i>{{$.struct.ID}}</i><br> <br> # the lines below don't work and break the loop # {{.ID}} # or # {{.struct.ID}} # what if I want here another range loop that handles ""struct"" members # when I reach ""struct"" field in the data variable or just do nothing # and just continue the loop? {{end}}{{end}}","""range"" action and ""pipeline"" clarification in text/html template package. Golang"
How get pointer of struct's member from interface{} (reflection). Golang," I want to pass struct's pointer to function that expect interface{}. Then get (through reflection) the pointer to the struct's member and then modify it using this pointer. I've read a much of Q&A and tried much of variations, but still I can get it work.Let's consider example below: I think the problem in poor understanding what actually do Addr() and Pointer() methods of reflect package.. <code>  type Robot struct { Id int}f := func(i interface {}) { v := reflect.ValueOf(i).Elem().FieldByName(""Id"") ptr := v.Addr().Pointer() *ptr = 100 //^ it needs to me for functions expecting the pointer: Scan(&pointerToValue)}robot := &Robot{}f(robot)println(robot.Id) //I want to get here 100",How get pointer of struct's member from interface{}
Golang event emitter / dispatcher for plugin architecture," In Node.js I was able to make a WordPress clone rather easily using the EventEmitter to replicate and build a hooks-system into the CMS core, which plugins could then attach to.I now need this same level of extensibility and core isolation for my CMS written in and ported to Go. Basically I have the core finished now, but in order to make it truly flexible I have to be able to insert events (hooks) and to have plugins attach to these hooks with additional functionality.I don't care about recompiling (dynamic / static linking), as long as you don't have to modify the core to load plugins - the CMS core should never be modified. (like WP, Drupal etc.)I noticed there's a few rather unknown projects, trying to implement events in Go looking somewhat similar to EventEmitter in Node.js:https://github.com/CHH/eventemitterhttps://github.com/chuckpreslar/emissionSince those 2 projects above haven't gained much popularity and attention somehow I feel this way of thinking about events might now be how we should do it in Go? Does this mean Go is maybe not geared to this task? To make truly extendable applications through plugins?Doesn't seem like Go has events built into its core, and RPC doesn't seem like a valid solution for integrating plugins into your core application as were they built in natively, and as if they were part of the main application itself.What's the best way for seamless plugin integration into your core app, for unlimited extension points (in core) without manipulating core every time you need to hook up a new plugin? <code> ",Golang events: EventEmitter / dispatcher for plugin architecture
Does a type assertion / type switch has bad performance / is slow in Go?," How slow is using type assertions / type switches in Go, as a method of run-time type discovery?I've heard that in C/C++ for example, discovering types at run time has bad performance. To bypass that, you usually add type members to classes, so you can compare against these instead of casting.I haven't found a clear answer for this throughout the www.Here's an example of what I'm asking about - Is this considered fast when compared to other type checking methodologies (like mentioned above, or others I'm not aware of)? <code>  func question(anything interface{}) { switch v := anything.(type) { case string: fmt.Println(v) case int32, int64: fmt.Println(v) case SomeCustomType: fmt.Println(v) default: fmt.Println(""unknown"") }}",Does a type assertion / type switch have bad performance / is slow in Go?
Golang Decoding Generic JSON Objects to One of Many Formats," I am working on a general JSON based message passing protocol in Go. What I would like to do is have a BaseMessage that has general information like Type, timestamp, etc. But at the same time I want to be able to define more specific message structures for certain types of data.For example: I have a set of handlers and to determine which handler should process the message I decode the JSON to the general Message type first to check the Type field. For this example I would get the handler associated with an ""Event"" message type. I run into problems when I then want to assert the EventMessage type onto the structure.The following code is very rough, but hopefully it displays my general idea of how I am trying to handle the messages. I have tried to use an interface{} but then the JSON decoder just creates a map which I then cant assert either type on. I have figured out workarounds that make it possible, but its very ugly, probably not efficient, and most likely error prone. I would like to keep things simple and straightforward so this code can be easily maintained.Is there a method of handling generic JSON objects in Go so that the decoded JSON could be one of many struct formats?I have also played with the idea of having more specific info in a Data interface{} in the main Message struct, but then I run into the same problem of not being able to assert any types onto the interface. There has to be a better way to handle JSON formats that I am just missing. <code>  type Message struct { Type string `json:type` Timestamp string `json:timestamp`}type EventMessage struct { Message EventType string EventCreator string EventData interface{}} type Handler func(msg Message) Messagehandlers := make(map[string]Handler)var msg Messagedecoder.Decode(&msg)handler := handlers[msg.Type]handler(msg)",Decoding generic JSON objects to one of many formats
golang http Concurrent Requests post eof," I'm running a small client in Go. We're getting a number of false alarms at the moment, which seem to come down to client.Do() returning an EOF error when num>=1000.This is the essence of my code: Is problem about number of file handles or max connections? <code>  func DoCreate(js string, cli *http.Client) { url2 := ""http://xvz.myserver.com:9000/path/create"" postBytesReader := bytes.NewReader([]byte(js)) request, _ := http.NewRequest(""POST"", url2, postBytesReader) resp, err := cli.Do(request) if err != nil { fmt.Println(err) // Post http://xvz.myserver.com:9000/path/create: EOF return } body, _ := ioutil.ReadAll(resp.Body) fmt.Println(string(body)) defer resp.Body.Close()}func main() { client := &http.Client{ CheckRedirect: nil, } for i := 0; i < num; i++ { var pq CreateReqInfo pq.Uid = strconv.Itoa(bid + i) petstr, _ := json.Marshal(pq) go DoCreate(string(petstr), client) }}",Golang HTTP Concurrent Requests POST EOF
Convert fixed size array to variable sized array in GO," I'm trying to convert a fixed size array [32]byte to variable sized array (slice) []byte: but the compiler throws the error: How should I convert it? <code>  package mainimport ( ""fmt"")func main() { var a [32]byte b := []byte(a) fmt.Println("" %x"", b)} ./test.go:9: cannot convert a (type [32]byte) to type []byte",Convert fixed size array to variable sized array in Go
"In golang, how to iterate two arrays using one `range`"," To iterate over an array, slice, string, map, or channel, we can use How can I iterate over two slices or maps simultaneously? Is there something like following in python? <code>  for _, x := range []int{1, 2, 3} { // do something} for x, y in range([1, 2, 3], [4, 5, 6]): print x, y","In Go (golang), how to iterate two arrays, slices, or maps using one `range`"
Please explain me one line of Go code," I found this line: https://github.com/streadway/amqp/blob/master/channel.go#L1089What does it do? Why the double parentheses? <code>  return (<-chan Delivery)(deliveries), nil",What does `(<-chan Delivery)(deliveries)` do?
Please explain one line of Go code," I found this line: https://github.com/streadway/amqp/blob/master/channel.go#L1089What does it do? Why the double parentheses? <code>  return (<-chan Delivery)(deliveries), nil",What does `(<-chan Delivery)(deliveries)` do?
Unable to go_out my protobuf, using protobuf version 2.6.1 ( which i installed via homebrew) I am trying to run I keep receiving this error. I have the protoc-gen-go installed in my go path. Anyone else have this issue? <code>  $ protoc --go_out=../cloud/ *.proto $ protoc-gen-go: program not found or is not executable$ --go_out: protoc-gen-go: Plugin failed with status code 1.,Unable to build protobuf to go endpoint
Define a recursive function within a function in Golang, I am trying to define a recursive function within another function in Go but I am struggling to get the right syntax. I am looking for something like this: I'd like to keep Function2 inside the scope of Function1 as it is accessing some elements of its scope.How can I do this in Go?Many thanks <code>  func Function1(n) int { a := 10 Function2 := func(m int) int { if m <= a { return a } return Function2(m-1) } return Function2(n)},Define a recursive function within a function in Go
"golang ""undefined"" function declared in another file?"," I'm trying to write a basic go program that calls a function on a different file, but a part of the same package. However, it returns: Here is the source code:main.go: employee.go: <code>  undefined: NewEmployee package mainfunc main() {emp := NewEmployee() } package maintype Employee struct { name string age int} func NewEmployee() *Employee { p := &Employee{} return p}func PrintEmployee (p *Employee) { return ""Hello world!""}","""undefined"" function declared in another file?"
Passing a query parameter to the GO LANg HTTP request handler using the MUX package," I am trying to pass an additional parameter in the request I am trying to send to the Go server - The Go server implementation is as follows - How should I look and parse for the token in the Go server so that the authentication is successful? Library function <code>  websocket.create_connection(""ws://<ip>:port/x/y?token=""qwerty"") func main() { err := config.Parse() if err != nil { glog.Error(err) os.Exit(1) return } flag.Parse() defer glog.Flush() router := mux.NewRouter() http.Handle(""/"", httpInterceptor(router)) router.Handle(""/v1/x"", common.ErrorHandler(stats.GetS)).Methods(""GET"") router.Handle(""/v1/x/y"", common.ErrorHandler(stats.GetS)).Methods(""GET"") var listen = fmt.Sprintf(""%s:%d"", config.Config.Ip, config.Config.Port) err = http.ListenAndServe(listen, nil) if err != nil { glog.Error(err) os.Exit(1) }}func httpInterceptor(router http.Handler) http.Handler { return http.HandlerFunc(func(w http.ResponseWriter, req *http.Request) { startTime := time.Now() if !auth.Auth(w, req) { http.Error(w, ""Failed authentication"", 401) return } router.ServeHTTP(w, req) finishTime := time.Now() elapsedTime := finishTime.Sub(startTime) switch req.Method { case ""GET"": case ""POST"": } })} func ParseFromRequest(req *http.Request, keyFunc Keyfunc) (token *Token, err error) { // Look for an Authorization header if ah := req.Header.Get(""Authorization""); ah != """" { // Should be a bearer token if len(ah) > 6 && strings.ToUpper(ah[0:6]) == ""BEARER"" { return Parse(ah[7:], keyFunc) } } // Look for ""access_token"" parameter req.ParseMultipartForm(10e6) if tokStr := req.Form.Get(""access_token""); tokStr != """" { return Parse(tokStr, keyFunc) } return nil, ErrNoTokenInRequest}",Passing a query parameter to the Go HTTP request handler using the MUX package
Is there idiomatic scoped sematics in golang?," I wonder if there is any idiomatic way to represent scoped semantics. By scoped I mean things like:scoped mutex (oneliner instead of explicit Lock + deffered Unlock),logging function (or any code block) entrance and exit,measuring execution time.Example code for first two bullets: https://play.golang.org/p/33j-GrBWSqBasically we need to make one function call just now (eg mutex lock), and one call should be postponed to defer (eg mutex unlock). I propose just returning unnamed function here, but it can be easily named (return struct with function field).There is only one problem: user can forget to 'call' result of first call.This code is (can be) idiomatic? <code>  package mainimport ""log""import ""sync""func Scoped(m *sync.Mutex) func() { m.Lock() return func() { m.Unlock() }}func Log(what string) func() { log.Println(what, ""started"") return func() { log.Println(what, ""done"") }}func main() { defer Log(""testing"")() m := &sync.Mutex{} // obviously mutex should be from other source in real life defer Scoped(m)() // use m}",Is there idiomatic scoped semantics in golang?
implementing Reader interface," I understand the general concept of Go's interfaces. However, I was recently looking into implementing the io.Reader interface, and it has me confused. I found this post which didn't help to much.Reader interface and the Read method in golangTo start with, the accepted answer is using io.Reader's Read function, which as far as I can tell is never implemented. Second, how does the Read function work in the context of something like ioutil.ReadAll. It takes something that implemented the io.Reader interface and returns a slice of bytes. I don't understand how something that is returning only an int and err can be processed into a slice of bytes.Edit:I was helped in the go-nuts IRC channel and this was the provided answer as to how you would likely actually implement one http://play.golang.org/p/ejpUVOx8jR. Much thanks to the go community.Edit 2:as pointed out below the implementation above will fail in the case where the strign is larger than the buffer. This is a more sane implementation http://play.golang.org/p/t4Zg8TnF33. <code> ",Implementing Reader interface
How to make config file in golang elegantly?," I'm a newbie with Golang.I want to write a program to manage my Redis instances so that I can create a Redis connection with specific config file. But I don't know how to create the config file for Redis instances elegantly.I found ""text/template"" before, is that a good idea? <code> ",How to make config file in Golang elegantly?
why is golang glog not much configurable," Does anyone know how to set/modify the log dir in the golang source code?I want to set the log dir in the soure code, instead of -log_dir= in the cmdline <code> ",How do I set the log directory of glog from code
Test for nil values in golang nested stucts," I have a deeply nested struct in go. These are constructed by a json unmarshaller. Quite some fields in this struct are however 'omitifempty' so I end op with a struct that can have nills in various places.Example (the real thing is even deeper nested, and big: 400 lines of structs): The question is if there is a more generic way to test if some node in the reference tree is nil? I need to get a lot of different items and it will be a pain to write all these if statements. Oh and speed is of concern. <code>  package mainimport ""fmt""type Foo struct { Foo string Bar *Bar}type Bar struct { Bar string Baz *Baz}type Baz struct { Baz string}func main() { f1 := Foo{Foo: ""f1""} f2 := Foo{Foo: ""f2"", Bar: &Bar{Bar: ""br2""}} f3 := Foo{Foo: ""f3"", Bar: &Bar{Bar: ""br3"", Baz: &Baz{Baz: ""bz3""}}} fmt.Println(f3.Bar.Baz.Baz) //-> bz3 fmt.Println(f2.Bar.Baz.Baz) //-> panic: runtime error: invalid memory address or nil pointer dereference fmt.Println(f1.Bar.Baz.Baz) //-> panic: runtime error: invalid memory address or nil pointer dereference //so far so good, but //is there a more generic way to do this kind of testing? if f2.Bar != nil && f2.Bar.Baz != nil { fmt.Println(f2.Bar.Baz.Baz) } else { fmt.Println(""something nil"") }}",Test for nil values in nested stucts
Golang: multiple value in single-value context," Due to error handling in Go, I often end up with multiple values functions. So far, the way I have managed this has been very messy and I am looking for best practices to write cleaner code.Let's say I have the following function: How can I assign a new variable to item.Value elegantly. Before introducing the error handling, my function just returned item and I could simply do this: Now I do this: Isn't there a way to access directly the first returned variable? <code>  type Item struct { Value int Name string}func Get(value int) (Item, error) { // some code return item, nil} val := Get(1).Value item, _ := Get(1)val := item.Value",Multiple values in single-value context
Go: multiple value in single-value context," Due to error handling in Go, I often end up with multiple values functions. So far, the way I have managed this has been very messy and I am looking for best practices to write cleaner code.Let's say I have the following function: How can I assign a new variable to item.Value elegantly. Before introducing the error handling, my function just returned item and I could simply do this: Now I do this: Isn't there a way to access directly the first returned variable? <code>  type Item struct { Value int Name string}func Get(value int) (Item, error) { // some code return item, nil} val := Get(1).Value item, _ := Get(1)val := item.Value",Multiple values in single-value context
golang testing [no test files]," I'm creating a simple test within my package directory called reverseTest.go whenever i try to run it the output is this is my go env Any help will be greatly appreciated. Thanks!! <code>  package mainimport ""testing""func TestReverse(t *testing.T) { cases := []struct { in, want string }{ {""Hello, world"", ""dlrow ,olleH""}, {""Hello, "", "" ,olleH""}, {"""", """"}, } for _, c := range cases { got := Reverse(c.in) if got != c.want { t.Errorf(""Reverse(%q) == %q, want %q"", c.in, got, c.want) } }} exampleFolder[no test files] GOARCH=""amd64""GOBIN=""""GOCHAR=""6""GOEXE=""""GOHOSTARCH=""amd64""GOHOSTOS=""linux""GOOS=""linux""GOPATH=""/home/juan/go""GORACE=""""GOROOT=""/usr/lib/go""GOTOOLDIR=""/usr/lib/go/pkg/tool/linux_amd64""TERM=""dumb""CC=""gcc""GOGCCFLAGS=""-g -O2 -fPIC -m64 -pthread""CXX=""g++""CGO_ENABLED=""1""","Golang testing: ""no test files"""
How to parse function declaration ( ast )," I'm trying to parse a method declaration. Basically I need to get the syntax node of the receiver base type (type hello) and the return types (notype and error). The ast package seems straightforward but for some reason I don't get the data I need (i.e. the fields are reported nil). The only useful data seems provided only in Object -> Decl field which is of type interface{} so I don't think I can serialize it.Any help would be appreciated. Code below: Playground <code>  package mainimport ( ""fmt"" ""go/ast"" ""go/parser"" ""go/token"")func main() { // src is the input for which we want to inspect the AST. src := `package mypack// type hello is a cool typetype hello string// type notype is not that cooltype notype int// func printme is like nothing else.func (x *hello)printme(s string)(notype, error){ return 0, nil}` // Create the AST by parsing src. fset := token.NewFileSet() // positions are relative to fset f, err := parser.ParseFile(fset, ""src.go"", src, 0) if err != nil { panic(err) } // Inspect the AST and find our function var mf ast.FuncDecl ast.Inspect(f, func(n ast.Node) bool { switch x := n.(type) { case *ast.FuncDecl: mf = *x } return true }) if mf.Recv != nil { fmt.Printf(""\n receivers:"") for _, v := range mf.Recv.List { fmt.Printf("",tag %v"", v.Tag) for _, xv := range v.Names { fmt.Printf(""name %v, decl %v, data %v, type %v"", xv.Name, xv.Obj.Decl, xv.Obj.Data, xv.Obj.Type) } } }}",How to parse a method declaration?
How to parse a function declaration?," I'm trying to parse a method declaration. Basically I need to get the syntax node of the receiver base type (type hello) and the return types (notype and error). The ast package seems straightforward but for some reason I don't get the data I need (i.e. the fields are reported nil). The only useful data seems provided only in Object -> Decl field which is of type interface{} so I don't think I can serialize it.Any help would be appreciated. Code below: Playground <code>  package mainimport ( ""fmt"" ""go/ast"" ""go/parser"" ""go/token"")func main() { // src is the input for which we want to inspect the AST. src := `package mypack// type hello is a cool typetype hello string// type notype is not that cooltype notype int// func printme is like nothing else.func (x *hello)printme(s string)(notype, error){ return 0, nil}` // Create the AST by parsing src. fset := token.NewFileSet() // positions are relative to fset f, err := parser.ParseFile(fset, ""src.go"", src, 0) if err != nil { panic(err) } // Inspect the AST and find our function var mf ast.FuncDecl ast.Inspect(f, func(n ast.Node) bool { switch x := n.(type) { case *ast.FuncDecl: mf = *x } return true }) if mf.Recv != nil { fmt.Printf(""\n receivers:"") for _, v := range mf.Recv.List { fmt.Printf("",tag %v"", v.Tag) for _, xv := range v.Names { fmt.Printf(""name %v, decl %v, data %v, type %v"", xv.Name, xv.Obj.Decl, xv.Obj.Data, xv.Obj.Type) } } }}",How to parse a method declaration?
WHy is cgo's performance is so slow? is there something wrong with my testing code?," I'm doing a test: compare excecution times of cgo and pure Go functions run 100 million times each. The cgo function takes longer time compared to the Golang function, and I am confused with this result. My testing code is: and result is: The results show that invoking the C function is slower than the Go function. Is there something wrong with my testing code?My system is : mac OS X 10.9.4 (13E28) <code>  package mainimport ( ""fmt"" ""time"")/*#include <stdio.h>#include <stdlib.h>#include <string.h>void show() {}*/// #cgo LDFLAGS: -lstdc++import ""C""//import ""fmt""func show() {}func main() { now := time.Now() for i := 0; i < 100000000; i = i + 1 { C.show() } end_time := time.Now() var dur_time time.Duration = end_time.Sub(now) var elapsed_min float64 = dur_time.Minutes() var elapsed_sec float64 = dur_time.Seconds() var elapsed_nano int64 = dur_time.Nanoseconds() fmt.Printf(""cgo show function elasped %f minutes or \nelapsed %f seconds or \nelapsed %d nanoseconds\n"", elapsed_min, elapsed_sec, elapsed_nano) now = time.Now() for i := 0; i < 100000000; i = i + 1 { show() } end_time = time.Now() dur_time = end_time.Sub(now) elapsed_min = dur_time.Minutes() elapsed_sec = dur_time.Seconds() elapsed_nano = dur_time.Nanoseconds() fmt.Printf(""go show function elasped %f minutes or \nelapsed %f seconds or \nelapsed %d nanoseconds\n"", elapsed_min, elapsed_sec, elapsed_nano) var input string fmt.Scanln(&input)} cgo show function elasped 0.368096 minutes or elapsed 22.085756 seconds or elapsed 22085755775 nanosecondsgo show function elasped 0.000654 minutes or elapsed 0.039257 seconds or elapsed 39257120 nanoseconds",Why cgo's performance is so slow? is there something wrong with my testing code?
WHy cgo's performance is so slow? is there something wrong with my testing code?," I'm doing a test: compare excecution times of cgo and pure Go functions run 100 million times each. The cgo function takes longer time compared to the Golang function, and I am confused with this result. My testing code is: and result is: The results show that invoking the C function is slower than the Go function. Is there something wrong with my testing code?My system is : mac OS X 10.9.4 (13E28) <code>  package mainimport ( ""fmt"" ""time"")/*#include <stdio.h>#include <stdlib.h>#include <string.h>void show() {}*/// #cgo LDFLAGS: -lstdc++import ""C""//import ""fmt""func show() {}func main() { now := time.Now() for i := 0; i < 100000000; i = i + 1 { C.show() } end_time := time.Now() var dur_time time.Duration = end_time.Sub(now) var elapsed_min float64 = dur_time.Minutes() var elapsed_sec float64 = dur_time.Seconds() var elapsed_nano int64 = dur_time.Nanoseconds() fmt.Printf(""cgo show function elasped %f minutes or \nelapsed %f seconds or \nelapsed %d nanoseconds\n"", elapsed_min, elapsed_sec, elapsed_nano) now = time.Now() for i := 0; i < 100000000; i = i + 1 { show() } end_time = time.Now() dur_time = end_time.Sub(now) elapsed_min = dur_time.Minutes() elapsed_sec = dur_time.Seconds() elapsed_nano = dur_time.Nanoseconds() fmt.Printf(""go show function elasped %f minutes or \nelapsed %f seconds or \nelapsed %d nanoseconds\n"", elapsed_min, elapsed_sec, elapsed_nano) var input string fmt.Scanln(&input)} cgo show function elasped 0.368096 minutes or elapsed 22.085756 seconds or elapsed 22085755775 nanosecondsgo show function elasped 0.000654 minutes or elapsed 0.039257 seconds or elapsed 39257120 nanoseconds",Why cgo's performance is so slow? is there something wrong with my testing code?
How to transfer strings to []byte directly in GoLang," Question is simple,how to transfer ""46447381"" in to []byte{0x46,0x44,0x73,0x81}? <code> ",How to transfer hex strings to []byte directly in Go?
Using binary packages directly - Golang," I'm writing a library in Go. I'm planning to distribute it, and with a main requirement of 'without source codes'. For testing, I have created two workspaces like following,WS1bin/pkg/linux_amd64/lib.asrc/lib/src.go WS2bin/pkg/src/main/main.goMy first workspace (WS1) is the actual dummy library, which has some utility functions. Second workspace (WS2) has main function which uses the package (lib.a) from WS1.Everything was working good until I remove the sources from WS1. If I remove the directory /lib/src.go in WS1, I'm getting the following error during go build, main.go:5:2: cannot find package ""lib"" in any of: /usr/local/go/src/pkg/lib (from $GOROOT) ../Testing/ws1/src/lib (from $GOPATH)The above message indicates us that we should keep the source files as well. Precompiled binary packages alone cannot be used directly.Based on few suggestions online, we may keep some dummy sources with timestamp value lesser than binary packages' timestamp. But, this doesn't seems to be a feasible solution for us. What happens if timestamp of the dummy sources got updated unfortunately?I have seen similar issue discussed here,https://github.com/golang/go/issues/2775My Questions:Distributing the sources is the only possibility in Golang?Why Go is not providing a provision for using '.a' files directly?If keeping the source is mandatory for Go, why this small thing isnot mentioned anywhere in Go? (or) Am I missing something here?Thanks in advance for your help guys! <code> ",Using binary packages directly
Regex golang mismatch," I have developed some regex in regexr where it works as expected, but when I use it in Go it seems to be mismatching strings. For example in regexr the following input does not match: But in Go it does match. <code>  (\+|-)?(((\d{1,3}[, ])(\d{3}[ ,])*\d{3})|\d+)( ?[\.,] ?(\d{3}[, ])*\d+)? 1.12,4.64",Regex Go mismatch
When to use os.Exit() and panic()? Golang, Could someone explain the key differences between os.Exit() and panic() and how they are used in practice in Go? <code> ,When to use os.Exit() and panic()?
When to use os.Exit() and panic() in Golang?, Could someone explain the key differences between os.Exit() and panic() and how they are used in practice in Go? <code> ,When to use os.Exit() and panic()?
Context of incoming request. Golang," From time to time I am faced with the ""Context"" concept which, as a rule is created for all incoming requests. Recently I've read the Go blog article that describes using the golang.org/x/net/context package. However, after playing with the code and trying to reproduce the logic of the article, I still hardly understand how to use it for every incoming request and even why it is useful for this.How should I organize my code to create context (and what should it contain, generally) for every incoming request using the golang.org/x/net/context package? Could anybody give a little example and explain what is so useful and why so frequently used? <code> ",Context of incoming request
Return map like 'ok' in golang on normal functions," In Go, the following works (note one use of the map has one return, the other has two returns) However, I have no idea how to do this same thing with my own function. Is it possible to have similar behavior with an optional return like map?For example: Wont compile (due to the error multiple-value Hello() in single-value context) ... is there a way to make this syntax work for the function Hello()? <code>  package mainimport ""fmt""var someMap = map[string]string { ""some key"": ""hello"" }func main() { if value, ok := someMap[""some key""]; ok { fmt.Println(value) } value := someMap[""some key""] fmt.Println(value)} package mainimport ""fmt""func Hello() (string, bool) { return ""hello"", true}func main() { if value, ok := Hello(); ok { fmt.Println(value) } value := Hello() fmt.Println(value)}",Return map like 'ok' in Golang on normal functions
what is the meaning about `...Type` in golang," This code is in builti.go: The last line made me feel very confused. I do not know the meaning of ...Type .These are other codes: The result is I guess the function of ... is to pick all elements from elems, but I haven't found an official explanation. What is it? <code>  // The append built-in function appends elements to the end of a slice. If// it has sufficient capacity, the destination is resliced to accommodate the// new elements. If it does not, a new underlying array will be allocated.// Append returns the updated slice. It is therefore necessary to store the// result of append, often in the variable holding the slice itself:// slice = append(slice, elem1, elem2)// slice = append(slice, anotherSlice...)// As a special case, it is legal to append a string to a byte slice, like this:// slice = append([]byte(""hello ""), ""world""...)func append(slice []Type, elems ...Type) []Type package mainimport ""fmt""func main() { s := []int{1,2,3,4,5} s1 := s[:2] s2 := s[2:] s3 := append(s1, s2...) fmt.Println(s1, s2, s3)} [1 2] [3 4 5] [1 2 3 4 5]","What is the meaning of ""...Type"" in Go?"
Go Template: is there a way to list used variables," Let's say I have a basic go text/template: I want to get an array of the variables names used in the template, to be able to skip the execution if they are not available in the data I pass to execute, is it possible to do that somehow?As my data is not a struct but a map, doing .var will always return something: if it doesn't exist, it will return an empty string when I would have hoped to get an error when executing the template.So for the example from above, I would have liked to get: <code>  {{.var}} is another {{.var2}} [var var2]",is there a way to list used variables?
Reason for huge size of compiled executalbe of Go," I complied a hello world Go program which generated native executable on my linux machine. But I was surprised to see the size of the simple Hello world Go program, it was 1.9MB !Why is it that the executable of such a simple program in Go is so huge?  <code> ",Reason for huge size of compiled executable of Go
Go language: How to change method implementation in run-time using reflection?," I have this type implementation: How I can change implementation of method getName() for this type using reflection?For example, I want use next implementation instead of current: <code>  type A struct{ name string}func (a A) getName() string { return ""My name is "" + a.name } func newGetName() string { return ""test reflection""} ",How to change method implementation in run-time using reflection?
json.Marshal encode xml content on Go(Golang)," Is it possible to make json.Marshal not escape < and >? I currently get: but I am looking for something like this: <code>  package mainimport ""fmt""import ""encoding/json""type Track struct { XmlRequest string `json:""xmlRequest""`}func main() { message := new(Track) message.XmlRequest = ""<car><mirror>XML</mirror></car>"" fmt.Println(""Before Marshal"", message) messageJSON, _ := json.Marshal(message) fmt.Println(""After marshal"", string(messageJSON))} {""xmlRequest"":""\u003ccar\u003e\u003cmirror\u003eXML\u003c/mirror\u003e\u003c/car\u003e""} {""xmlRequest"":""<car><mirror>XML</mirror></car>""}",How to stop json.Marshal from escaping < and >?
Struct's Zero value in golang," Here is sample code: Run results: It looks like those are the same about var ele A and ele2 := A{}So, the struct's Zero value is not nil, but a struct that all of the property are initialized Zero value. Is the guess right?If the guess is right, then the nature of var ele A and ele2 := A{} are the same right? <code>  package mainimport ( ""fmt"")type A struct { Name string}func (this *A) demo(tag string) { fmt.Printf(""%#v\n"", this) fmt.Println(tag)}func main() { var ele A ele.demo(""ele are called"") ele2 := A{} ele2.demo(""ele2 are called"")} &main.A{Name:""""}ele are called&main.A{Name:""""}ele2 are called",Struct's zero value
How to I handle nil return values from database?," I am writing a basic program to read values from database table and print in table. The table was populated by an ancient program. Some of the fields in the row are optional and when I try to read them as string, I get the following error: After I read other questions for similar issues, I came up with following code to handle the nil values. The method works fine in practice. I get the values in plain text and empty string instead of the nil values.However, I have two concerns:This does not look efficient. I need to handle 25+ fields like this and that would mean I read each of them as bytes and convert to string. Too many function calls and conversions. Two structs to handle the data and so on...The code looks ugly. It is already looking convoluted with 2 fields and becomes unreadable as I go to 25+Am I doing it wrong? Is there a better/cleaner/efficient/idiomatic golang way to read values from database?I find it hard to believe that a modern language like Go would not handle the database returns gracefully.Thanks in advance!Code snippet: edit:I want to have something like the following where I do no have to worry about handling NULL and automatically read them as empty string. <code>  panic: sql: Scan error on column index 2: unsupported driver -> Scan pair: <nil> -> *string // DB read formattype udInfoBytes struct { id []byte state []byte}// output formattype udInfo struct { id string state string}func CToGoString(c []byte) string { n := -1 for i, b := range c { if b == 0 { break } n = i } return string(c[:n+1])}func dbBytesToString(in udInfoBytes) udInfo { var out udInfo var s string var t int out.id = CToGoString(in.id) out.state = stateName(in.state) return out}func GetInfo(ud string) udInfo { db := getFileHandle() q := fmt.Sprintf(""SELECT id,state FROM Mytable WHERE id='%s' "", ud) rows, err := db.Query(q) if err != nil { log.Fatal(err) } defer rows.Close() ret := udInfo{} r := udInfoBytes{} for rows.Next() { err := rows.Scan(&r.id, &r.state) if err != nil { log.Println(err) } break } err = rows.Err() if err != nil { log.Fatal(err) } ret = dbBytesToString(r) defer db.Close() return ret} // output formattype udInfo struct { id string state string}func GetInfo(ud string) udInfo { db := getFileHandle() q := fmt.Sprintf(""SELECT id,state FROM Mytable WHERE id='%s' "", ud) rows, err := db.Query(q) if err != nil { log.Fatal(err) } defer rows.Close() r := udInfo{} for rows.Next() { err := rows.Scan(&r.id, &r.state) if err != nil { log.Println(err) } break } err = rows.Err() if err != nil { log.Fatal(err) } defer db.Close() return r}",How do I handle nil return values from database?
When building Go programs for release is it standard practise to just use 'go build'?," When building Go programs for release is it standard practise to just use go build without any other options? I ask because when building using go build all debug information is included by default. To remove it you can pass an option to the linker, thus: This omits all debug symbols. When building programs for release do you remove this information or leave it intact?EDIT: For clarity, i'm wondering how people compile Go programs for deployment to a live environment. In other compiled languages you have a different set of compiler command line options for debugging and release builds and release builds usually optimise the executable and remove debugging information. <code>  go build -ldflags ""-w"" prog.go",When building Go programs for release is it standard practice to just use 'go build'?
golang gorm and mysql: how can I retrieve instance of last added item," I'm using github.com/jinzhu/gorm with a mysql backend. I want to retrieve the Id (or the full entity) of the row in the previous Create call. As in, last-insert-id: (http://dev.mysql.com/doc/refman/5.0/en/information-functions.html#function_last-insert-id)How can I do this? <code> ",How can I retrieve instance of last added item
"golang, trying to join a slice into a string"," gives me an error of: prog.go:10: cannot use reg (type [3]string) as type []string in argument to strings.JoinIs there a more direct/better way than looping and adding to a var? <code>  package mainimport (""fmt""""strings"")func main() {reg := [...]string {""a"",""b"",""c""}fmt.Println(strings.Join(reg,"",""))}",How to join a slice of strings into a single string?
How to join a Slice into a String in Golang?," gives me an error of: prog.go:10: cannot use reg (type [3]string) as type []string in argument to strings.JoinIs there a more direct/better way than looping and adding to a var? <code>  package mainimport (""fmt""""strings"")func main() {reg := [...]string {""a"",""b"",""c""}fmt.Println(strings.Join(reg,"",""))}",How to join a slice of strings into a single string?
How to join a Slice into a String?," gives me an error of: prog.go:10: cannot use reg (type [3]string) as type []string in argument to strings.JoinIs there a more direct/better way than looping and adding to a var? <code>  package mainimport (""fmt""""strings"")func main() {reg := [...]string {""a"",""b"",""c""}fmt.Println(strings.Join(reg,"",""))}",How to join a slice of strings into a single string?
How to add new methods to an existing type in go?," I want to add a convenience util method on to gorilla/mux Route and Router types: but the compiler informs me Cannot define new methods on non-local type mux.RouterSo how would I achieve this? Do I create a new struct type that has an anonymous mux.Route and mux.Router fields? Or something else? <code>  package utilimport( ""net/http"" ""github.com/0xor1/gorillaseed/src/server/lib/mux"")func (r *mux.Route) Subroute(tpl string, h http.Handler) *mux.Route{ return r.PathPrefix(""/"" + tpl).Subrouter().PathPrefix(""/"").Handler(h)}func (r *mux.Router) Subroute(tpl string, h http.Handler) *mux.Route{ return r.PathPrefix(""/"" + tpl).Subrouter().PathPrefix(""/"").Handler(h)}",How to add new methods to an existing type in Go?
Golang convert []int8 to string," What's the best way (fastest performance) to convert from []int8 to string?For []byte we could do string(byteslice), but for []int8 it gives an error: I got the ba from SliceScan() method of *sqlx.Rows that produces []int8 instead of stringIs this solution the fastest? EDIT my bad, it's uint8 instead of int8.. so I can do string(ba) directly. <code>  cannot convert ba (type []int8) to type string func B2S(bs []int8) string { ba := []byte{} for _, b := range bs { ba = append(ba, byte(b)) } return string(ba)}",How to convert []int8 to string
Passing map parameters in Golang," I have a simple function which tests whether a string is an integer where the map being passed contains m[true] = 1, m[false] = 0. However, when I attempt to run this Go complains Either I cannot pass maps around as parameters in this way or else I am doing this entirely wrong. In any case, I would much appreciate some help <code>  func testInt(str string, m map[bool]) int { _,e := strconv.ParseInt(str, 0, 64); return m[nil == e] * 7;} 1: syntax error: unexpected )",Accepting map parameters
Accepting map parameters in Golang," I have a simple function which tests whether a string is an integer where the map being passed contains m[true] = 1, m[false] = 0. However, when I attempt to run this Go complains Either I cannot pass maps around as parameters in this way or else I am doing this entirely wrong. In any case, I would much appreciate some help <code>  func testInt(str string, m map[bool]) int { _,e := strconv.ParseInt(str, 0, 64); return m[nil == e] * 7;} 1: syntax error: unexpected )",Accepting map parameters
Golang defer clarification, What happened when defer called twice when the struct of that method has been changed?For example: which rows when the last rows.Close() called? <code>  rows := Query(`SELECT FROM whatever`)defer rows.Close()for rows.Next() { // do something}rows = Query(`SELECT FROM another`) defer rows.Close()for rows.Next() { // do something else},What happens when defer is called twice on same variable?
Inclide js file in go template," I started learning Go recently. I got a sample like as web app. I have: I couldn't load local jquery.min.js. When I wrote src=""http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"" it was loaded. How can I load local js file? I am not good at coding in Go and I did not write full code. So please try to explain very simple. Thanks in advance! <code>  /* tick-tock.go */package mainimport ( ""fmt"" ""io/ioutil"" ""log"" ""net/http"")// Content for the main html page..var page = `<html> <head> <script type=""text/javascript"" src=""http://localhost:8081/jquery.min.js""> </script> <style> div { font-family: ""Times New Roman"", Georgia, Serif; font-size: 1em; width: 13.3em; padding: 8px 8px; border: 2px solid #2B1B17; color: #2B1B17; text-shadow: 1px 1px #E5E4E2; background: #FFFFFF; } </style> </head>",Include js file in Go template
"Converting ""=?UTF 8?.."" to a regular string in golang"," I'm using an API and it's returning something like this for other language text: =?UTF 8?B?2KfZhNiu2LfZiNin2Kog2KfZhNiq2Yog2KrYrNmF2Lkg2KjZitmG?= =?UTF 8?B?INit2YHYuCDYp9mE2YLYsdin2ZPZhiDYp9mE2YPYsdmK2YUg2YjZgQ==?= =?UTF 8?B?2YfZhdmHINmF2YXYpyDYp9mU2YXZhNin2Ycg2KfZhNi52YTYp9mF?= =?UTF 8?B?2Kkg2LnYqNivINin2YTZhNmHINin2YTYutiv2YrYp9mGLnBkZg==?=Is this a common format? How would I go about converting this to a regular string in golang? Golang usually handles multiple languages well, but I'm not sure about how to go about converting. <code> ","Converting ""=?UTF 8?.."" (RFC 2047) to a regular string in golang"
import object is expected Error in golang 1.4.2," I have just upgraded Golang from 1.3 to version 1.4.2. And cannot compile due to error: on line m ""github.com/keighl/mandrill"" I guess some rules of importing have changed in 1.4.2. But cannot figure out how to change my import code to make it compile. <code>  ../../my/mandrill.go:5: import /path/to/go/home/pkg/darwin_amd64/github.com/keighl/mandrill.a: object is [darwin amd64 go1.3.3 X:precisestack] expected [darwin amd64 go1.4.2 X:precisestack]FAIL folder [build failed] package myimport ( ""fmt"" m ""github.com/keighl/mandrill"")",import object is expected Error in Golang 1.4.2
How to print message to stderr in Go," I want to print some logs for debugging and testing, but existing logs are massive, so I want to print my own logs to stderr: So that I can just see my own logs.How can I do that? <code>  go run main.go 1>/dev/null",How do I print message to stderr in Go?
How can I create slice of struct with reflection in Go," I need to create a slice of struct from its interface with reflection.I used Reflection because do not see any other solution without using it.Briefly, the function receives variadic values of Interface.Then, with reflection creates slice and passes it into another function.Reflection asks to type assertion But, I cannot use it.Code in playground http://play.golang.org/p/EcQUfIlkTe The code: <code>  SliceVal.Interface().(SomeStructType) package mainimport ( ""fmt"" ""reflect"")type Model interface { Hi()}type Order struct { H string}func (o Order) Hi() { fmt.Println(""hello"")}func Full(m []Order) []Order{ o := append(m, Order{H:""Bonjour""} return o}func MakeSlices(models ...Model) { for _, m := range models { v := reflect.ValueOf(m) fmt.Println(v.Type()) sliceType := reflect.SliceOf(v.Type()) emptySlice := reflect.MakeSlice(sliceType, 1, 1) Full(emptySlice.Interface()) }}func main() { MakeSlices(Order{})}",How to create slice of struct using reflection?
Golang properly instantiate os.FileMode," I have seen countless examples and tutorials that show how to create a file and all of them ""cheat"" by just setting the permission bits of the file. I would like to know / find out how to properly instantiate os.FileMode to provide to a writer during creation / updating of a file.A crude example is this below: In the basic function above permission bits 0664 is set and although this may make sense sometimes I prefer to have a proper way of setting the filemode correctly. As seen above a common example would be that the UID / GID is known and already provided as int values and the perms being octal digits that were previously gathered and inserted into a db as a string. <code>  func FileWrite(path string, r io.Reader, uid, gid int, perms string) (int64, error){ w, err := os.OpenFile(path, os.O_WRONLY|os.O_CREATE|os.O_TRUNC, 0664) if err != nil { if path == """" { w = os.Stdout } else { return 0, err } } defer w.Close() size, err := io.Copy(w, r) if err != nil { return 0, err } return size, err}",How to properly instantiate os.FileMode
Draw a simple rectangle in golang?," I want to draw a mailing label with some rectangles, barcodes, and then finally generate a PNG/PDF file.Is there is a better way to draw a shape in Go other than to do it with primitives - pixel by pixel? <code> ",Draw a rectangle in Golang?
Draw a rectangle in golang?," I want to draw a mailing label with some rectangles, barcodes, and then finally generate a PNG/PDF file.Is there is a better way to draw a shape in Go other than to do it with primitives - pixel by pixel? <code> ",Draw a rectangle in Golang?
Why gzip of java and golang get different result?," Firstly, my Java version: and output is:31-11780000000-5372-51-55-5547-4947-547310-8332-21-710000Then the Go version: output:31139800911013602552027220520120147207472027310002552551002552551733223524910000Why?I thought it might be caused by different byte reading methods of those two languages at first. But I noticed that 0 can never convert to 9. And the sizes of []byte are different.Have I written wrong code? Is there any way to make my Go program get the same output as the Java program?Thanks! <code>  string str = ""helloworld"";ByteArrayOutputStream localByteArrayOutputStream = new ByteArrayOutputStream(str.length());GZIPOutputStream localGZIPOutputStream = new GZIPOutputStream(localByteArrayOutputStream);localGZIPOutputStream.write(str.getBytes(""UTF-8""));localGZIPOutputStream.close();localByteArrayOutputStream.close();for(int i = 0;i < localByteArrayOutputStream.toByteArray().length;i ++){ System.out.println(localByteArrayOutputStream.toByteArray()[i]);} var gzBf bytes.BuffergzSizeBf := bufio.NewWriterSize(&gzBf, len(str))gz := gzip.NewWriter(gzSizeBf)gz.Write([]byte(str))gz.Flush()gz.Close()gzSizeBf.Flush()GB := (&gzBf).Bytes()for i := 0; i < len(GB); i++ { fmt.Println(GB[i])}",Why do gzip of Java and Go get different results?
golang executable file not found in $PATH," I have a problem when using Go. Here is my code: When I run this, I get the following errors.err exec: ""pwd"": executable file not found in $PATH;err exec: ""ls"": executable file not found in $PATHI'm using Ubuntu 14.04. <code>  package mainimport ( ""fmt"" ""os/exec"")func main() { output, err := exec.Command(""pwd"").Output() fmt.Println(string(output), err) output, err = exec.Command(""ls"", ""-l"").Output() fmt.Println(string(output), err)}",Unix executable files not found in $PATH
Writing generics function without generics in Go Lang," I know that Go will not have generics in the future and there are some recommendations to replace them by other constructs. But with my example below I got stuck. As you might guess, I'm trying to just fail on any error and want to put P() just around any function that is returning two results and the second is an error. This is working fine, but any is losing it's type information and is only an empty interface in the result.As I'm also calling lib functions I don't see a way to address this with Interfaces or Reflection.Any ideas? Am I totally on the wrong track or close to the goal? <code>  func P(any interface{}, err error) (interface{}) { if err != nil { panic(""error: ""+ err.Error()) } return any}",Writing generic error handling function without generics
Writing generics function without generics," I know that Go will not have generics in the future and there are some recommendations to replace them by other constructs. But with my example below I got stuck. As you might guess, I'm trying to just fail on any error and want to put P() just around any function that is returning two results and the second is an error. This is working fine, but any is losing it's type information and is only an empty interface in the result.As I'm also calling lib functions I don't see a way to address this with Interfaces or Reflection.Any ideas? Am I totally on the wrong track or close to the goal? <code>  func P(any interface{}, err error) (interface{}) { if err != nil { panic(""error: ""+ err.Error()) } return any}",Writing generic error handling function without generics
Golang - correct way to initialize empty slice," To declare an empty slice, with a non-fixed size,is it better to do: or: Just wondering which one is the correct way.  <code>  mySlice1 := make([]int, 0) mySlice2 := []int{}",Correct way to initialize empty slice
can I clear values of a instance of a type struct in golang dynamically?," Is it possible with Go to make a method that dynamically clears the values of a instance of a struct? <code>  type A struct { Name string Level int}type B struct { Skill string}func main() { a := A{""Momo"", 1} b := B{""Starfall""} // outputs // {""Momo"", 1} // {""Starfall""} clear(a) clear(b) // outputs // { , 0} // { }}func clear(v interface{}) { // some code}",How to clear values of a instance of a type struct dynamically
"golang reflect, get pointer to a struct field value"," I'm trying to make a function that converts a struct in the way mysql rows.Scan function needs it, so I don't need to pass manually lots of parameters. Note: I know the existence of sqlx and the alternative of writing manually in separate lines every pointer, but I'd like to solve it in this way as I'm learning go and want to understand what's going on.The error I get with this solution is:panic: sql: Scan error on column index 0: destination not a pointerto me looks like valueField.Addr().Pointer() should be a Pointer to the value. The following is a simplification of my code. <code>  type User struct { Name string Age int}func StrutForScan(u interface{}) []interface{} { val := reflect.ValueOf(u).Elem() v := make([]interface{}, val.NumField()) for i := 0; i < val.NumField(); i++ { valueField := val.Field(i) v[i] = valueField.Addr().Pointer() } return v}func ListUsers { rows, err := db.Query(""SELECT * FROM users"") PanicIf(err) var user User for rows.Next() { err := rows.Scan(StrutForScan(&user)...) PanicIf(err) fmt.Printf(""\nName: %s, Age: %s"", user.Name, string(user.Age)) }}",Get pointer to a struct field value
how to close/abort a Golang http.client POST prematurely," I'm using http.Client for the client-side implementation of a long-poll: Is there a standard way to pre-empt/cancel the request from the client-side? I imagine that calling resp.Body.Close() would do it, but I'd have to call that from another goroutine, as the client is normally already blocked in reading the response of the long-poll.I know that there is a way to set a timeout via http.Transport, but my app logic need to do the cancellation based on a user action, not just a timeout. <code>  resp, err := client.Post(url, ""application/json"", bytes.NewBuffer(jsonPostBytes))if err != nil { panic(err)}defer resp.Body.Close()var results []*ResponseMessageerr = json.NewDecoder(resp.Body).Decode(&results) // code blocks here on long-poll",how to close/abort a Golang http.Client POST prematurely
how preload a full hierachy in GO using GORM," I have a hierachy composed by several structures My DB creation is definded like this : Everything is clear and works fine to preload just one ""sub level"" of the hierachy like this : or I'm looking for a way using GORM to preload the whole hierachy invoking the ""First()"" method on one of the root element...I want to load an ""Entry"" with all its related ""Fields"" and I also want to have each ""Field"" preloaded with all its ""Decorators""...This is not feasable using the several ""Preload()"" functions : I understand ""iDB.Preload(""child1"").Preload(""child2"").First(root)"" works when both child1 and child2 are ""leaf"" of root.So my question is : is it possible to do this with gorm and if yes what is the best way to load recursively a complete hierachy?Thanks.Regards <code>  type Entry struct { Id int CreatedAt time.Time UpdatedAt time.Time Fields []Field}type SyncField struct { Id int CreatedAt time.Time UpdatedAt time.Time TechnicalName string JsonName string EntryId int Decorators []Decorator}type Decorator struct { Id int CreatedAt time.Time UpdatedAt time.Time Name string Description string SortingOrder int Params string SyncFieldId int} db.CreateTable(&Entry{})db.CreateTable(&SyncField{})db.Model(&Entry{}).Related(&SyncField{}, ""EntryId"")db.CreateTable(&Decorator{})db.Model(&SyncField{}).Related(&Decorator{}, ""DecoratorId"") entry := &Entry{Id: i}iDB.Preload(""SyncFields"").First(entry) field := &SyncField{Id: idf}iDB.Preload(""Decorators"").First(field) entry := &Entry{Id: i}iDB.Preload(""Decorators"").Preload(""SyncFields"").First(entry)",how preload a full hierarchy in GO using GORM
Mocking functions in Go," I'm trying to unit test a receiver function that calls other receiver functions in that struct.Let's say I want to test Three() and mock the call to two() in the following: I was following method two of the following answer.I created a custom constructor for every single function that I wanted to unit test and overrode those methods with mocked versions. But I thought it may not be easy to maintain the code once the number of functions grow.Is there any preferred way of mocking such functions? I wish the official documentation had some guidelines on how to mock things in different scenarios, similar to what mox on Python provides.Also, note that I don't want to use a third party mocking library. <code>  type MyStruct struct { a string b string}func (m *MyStruct) one() int { return 2}func (m *MyStruct) two() int { return m.one() * 2}func (m *MyStruct) Three() int { return m.two() * 2}",Mocking receiver functions in Go
How encode []rune into []byte using utf8 in golang?," It's really easy to decode a []byte into a []rune (simply cast to string, then cast to []rune works very nicely, I'm assuming it defaults to utf8 and with filler bytes for invalids). My question is - how are you suppose to decode this []rune back to []byte in utf8 form?Am I missing something or do I have manually call EncodeRune for every single rune in my []rune? Surely there is an encoder that I can simply pass a Writer to. <code> ",How encode []rune into []byte using utf8
Golang json decode is very slow. What would be a good way to do it?," I am using Go, Revel WAF and Redis.I have to store large json data in Redis (maybe 20MB).json.Unmarshal() takes about roughly 5 seconds. What would be a better way to do it?I tried JsonLib, encode/json, ffjson, megajson, but none of them were fast enough.I thought about using groupcache, but Json is updated in real time.This is the sample code: <code>  package mainimport ( ""github.com/garyburd/redigo/redis"" json ""github.com/pquerna/ffjson/ffjson"")func main() { c, err := redis.Dial(""tcp"", "":6379"") defer c.Close() pointTable, err := redis.String(c.Do(""GET"", ""data"")) var hashPoint map[string][]float64 json.Unmarshal([]byte(pointTable), &hashPoint) //Problem!!!}",Go JSON decoding is very slow. What would be a better way to do it?
Golang bug or intended feature on map literals," Just started to learn Go and I need map of string string, that I initialize literally. But compiler is complaining syntax error: need trailing comma before newline in composite literalSo I had to add coma after ""two"", or delete a new line and have } after last value for compiler to be happyIs this intended behavior of code style? EDIT: to be clear follwing will compile and work go version go1.4.2 darwin/amd64 Mac OSX 10.9.5 <code>  mapa := map[string]string{ ""jedan"":""one"", ""dva"":""two"" } mapa := map[string]string{ ""jedan"":""one"", ""dva"":""two"" }",Golang bug or intended feature on map literals?
How do I read in a large flat file in Golang," I have a flat file that has 339276 line of text in it for a size of 62.1 MB. I am attempting to read in all the lines, parse them based on some conditions I have and then insert them into a database. I originally attempted to use a bufio.Scan() loop and bufio.Text() to get the line but I was running out of buffer space. I switched to using bufio.ReadLine/ReadString/ReadByte (I tried each) and had the same problem with each. I didn't have enough buffer space. I tried using read and setting the buffer size but as the document says it actually a const that can be made smaller but never bigger that 64*1024 bytes. I then tried to use File.ReadAt where I set the starting postilion and moved it along as I brought in each section to no avail. I have looked at the following examples and explanations (not an exhaustive list): Read text file into string array (and write)How to Read last lines from a big file with Go every 10 secsreading file line by line in goHow do I read in an entire file (either line by line or the whole thing at once) into a slice so I can then go do things to the lines?Here is some code that I have tried: Here is something else I tried: I am at a loss. Either I don't understand exactly how the buffer works or I don't understand something else. Thanks for reading.  <code>  file, err := os.Open(feedFolder + value) handleError(err) defer file.Close() // fileInfo, _ := file.Stat() var linesInFile []string r := bufio.NewReader(file) for { path, err := r.ReadLine(""\n"") // 0x0A separator = newline linesInFile = append(linesInFile, path) if err == io.EOF { fmt.Printf(""End Of File: %s"", err) break } else if err != nil { handleError(err) // if you return error } } fmt.Println(""Last Line: "", linesInFile[len(linesInFile)-1]) var fileSize int64 = fileInfo.Size() fmt.Printf(""File Size: %d\t"", fileSize) var bufferSize int64 = 1024 * 60 bytes := make([]byte, bufferSize) var fullFile []byte var start int64 = 0 var interationCounter int64 = 1 var currentErr error = nil for currentErr != io.EOF { _, currentErr = file.ReadAt(bytes, st) fullFile = append(fullFile, bytes...) start = (bufferSize * interationCounter) + 1 interationCounter++ } fmt.Printf(""Err: %s\n"", currentErr) fmt.Printf(""fullFile Size: %s\n"", len(fullFile)) fmt.Printf(""Start: %d"", start) var currentLine []string for _, value := range fullFile { if string(value) != ""\n"" { currentLine = append(currentLine, string(value)) } else { singleLine := strings.Join(currentLine, """") linesInFile = append(linesInFile, singleLine) currentLine = nil } }",How do I read in a large flat file
golang example won't run," I'm trying to add an example to a package, and run the example via go test, however the example is never run.For example, see this gist: https://gist.github.com/85469ecc65bb5bb85857The gist has example_test.go: Yet when I run this: However other packages from stdlib work just fine: What is wrong with my example? <code>  package cow_testimport ( cow ""gist.github.com/85469ecc65bb5bb85857"")func Example() { cow.Poke()} # go test -v example_test.go testing: warning: no tests to runPASSok command-line-arguments 0.002s # cd /usr/lib/go/src/errors# go test -v example_test.go === RUN: Example--- PASS: Example (0.00s)PASSok command-line-arguments 0.002s",Go example won't run
Go - Logging responses to incoming HTTP requests inside http.HandleFunc," This is a follow-up question to In go, how to inspect the http response that is written to http.ResponseWriter? since the solution there requires faking a request, which works great for a unit test but not on a live server.I would like to dump out HTTP response that my web service is returning in response to requests it receives from users into a log file (or to console). The output should tell me what the headers are and the JSON payload.How does one go about that?If there were a httputil.DumpResponse equivalent that takes a http.ResponseWriter as argument rather than http.Response it would be perfect, but currently I can only access the Header from http.ResponseWriter <code>  r = mux.NewRouter()r.HandleFunc(""/path"", func (w http.ResponseWriter, r *http.Request) { fmt.Printf(""r.HandleFunc /path\n"") resp := server.NewResponse() defer resp.Close() r.ParseForm() // Server does some work here // ... // Insert debug code here, something like // // dump = http.DumpResponseFromWriter(w) // fmt.Printf(""%s\n"", dump)});http.Handle(""/path"", r)",Logging responses to incoming HTTP requests inside http.HandleFunc
Go Parse Time From Database," I am using golang and I am trying to read time from mysql and I am getting the following error. The error I am getting is How can I fix this? <code>  var my_time time.Timerows, err := db.Query(""SELECT current_time FROM table"")err := rows.Scan(&my_time) unsupported driver -> Scan pair: []uint8 -> *time.Time",How to parse time from database
How to parse/deserlize a dynamic JSON in go lang," Scenario:Consider the following is the JSON : If you notice, the data is structured in such a way that there is no hard-coded keys mentioning City/Temperature its basically just values.Issue: I am not able to parse any JSON which is dynamic. Question: Could anyone have found solution for this kind of JSON parsing? I tried go-simplejson, gabs & default encoding/json but no luck.Note: The above JSON is just for sample. And there are lot of applications which are using the current API, So I do not want to change how the data is structured. I mean I can't change to something as follows: Then I can define struct <code>  { ""Bangalore_City"": ""35_Temperature"", ""NewYork_City"": ""31_Temperature"", ""Copenhagen_City"": ""29_Temperature""} [{ ""City_Name"":""Bangalore"", ""Temperature"": ""35""},...] type TempData struct { City_Name string Temperature string}",How to parse/deserialize dynamic JSON
How to parse/deserlize a dynamic JSON in Golang," Scenario:Consider the following is the JSON : If you notice, the data is structured in such a way that there is no hard-coded keys mentioning City/Temperature its basically just values.Issue: I am not able to parse any JSON which is dynamic. Question: Could anyone have found solution for this kind of JSON parsing? I tried go-simplejson, gabs & default encoding/json but no luck.Note: The above JSON is just for sample. And there are lot of applications which are using the current API, So I do not want to change how the data is structured. I mean I can't change to something as follows: Then I can define struct <code>  { ""Bangalore_City"": ""35_Temperature"", ""NewYork_City"": ""31_Temperature"", ""Copenhagen_City"": ""29_Temperature""} [{ ""City_Name"":""Bangalore"", ""Temperature"": ""35""},...] type TempData struct { City_Name string Temperature string}",How to parse/deserialize dynamic JSON
How to parse/deserialize dynamic JSON in Golang," Scenario:Consider the following is the JSON : If you notice, the data is structured in such a way that there is no hard-coded keys mentioning City/Temperature its basically just values.Issue: I am not able to parse any JSON which is dynamic. Question: Could anyone have found solution for this kind of JSON parsing? I tried go-simplejson, gabs & default encoding/json but no luck.Note: The above JSON is just for sample. And there are lot of applications which are using the current API, So I do not want to change how the data is structured. I mean I can't change to something as follows: Then I can define struct <code>  { ""Bangalore_City"": ""35_Temperature"", ""NewYork_City"": ""31_Temperature"", ""Copenhagen_City"": ""29_Temperature""} [{ ""City_Name"":""Bangalore"", ""Temperature"": ""35""},...] type TempData struct { City_Name string Temperature string}",How to parse/deserialize dynamic JSON
Will the login functionality build into the Users API stop working on April 20th?," I am currently using the Users API (this one here) with the Go language on my Google App Engine application. My users are getting the warning message when they first grant permissions that says ""OpenID 2.0 for Google accounts is going away. Developers should migrate to OpenID Connect by April 20, 2015."" But I can't find any warnings in the documentation for the Users API anywhere saying that anything will stop working, like I do all throughout other sections regarding OpenID 2.0 (here).I am using very little of the Users API code, just to create the login urls like this: And to read the users' email addresses, like this: Do I need to worry about migrating, or will the Users API handle everything without failing after April 20th? <code>  url, _ := user.LoginURLFederated(c, return_url, ""www.google.com/accounts/o8/id"") u := user.Current(appengine.NewContext(r))email := u.Email",Will the login functionality built into the Users API stop working on April 20th?
golang gin framework cros," I'm using Go gin framework gin I've got Status Code:200 OK, but nothing happens after OPTIONS request. It looks like I miss something, but I can't understand where am I wrong.Can anybody help me?  <code>  func CORSMiddleware() gin.HandlerFunc { return func(c *gin.Context) { c.Writer.Header().Set(""Content-Type"", ""application/json"") c.Writer.Header().Set(""Access-Control-Allow-Origin"", ""*"") c.Writer.Header().Set(""Access-Control-Max-Age"", ""86400"") c.Writer.Header().Set(""Access-Control-Allow-Methods"", ""POST, GET, OPTIONS, PUT, DELETE, UPDATE"") c.Writer.Header().Set(""Access-Control-Allow-Headers"", ""Content-Type, Content-Length, Accept-Encoding, X-CSRF-Token, Authorization, X-Max"") c.Writer.Header().Set(""Access-Control-Allow-Credentials"", ""true"") if c.Request.Method == ""OPTIONS"" { c.AbortWithStatus(200) } else { c.Next() } }}",Go gin framework CORS
golang gin framework CORS," I'm using Go gin framework gin I've got Status Code:200 OK, but nothing happens after OPTIONS request. It looks like I miss something, but I can't understand where am I wrong.Can anybody help me?  <code>  func CORSMiddleware() gin.HandlerFunc { return func(c *gin.Context) { c.Writer.Header().Set(""Content-Type"", ""application/json"") c.Writer.Header().Set(""Access-Control-Allow-Origin"", ""*"") c.Writer.Header().Set(""Access-Control-Max-Age"", ""86400"") c.Writer.Header().Set(""Access-Control-Allow-Methods"", ""POST, GET, OPTIONS, PUT, DELETE, UPDATE"") c.Writer.Header().Set(""Access-Control-Allow-Headers"", ""Content-Type, Content-Length, Accept-Encoding, X-CSRF-Token, Authorization, X-Max"") c.Writer.Header().Set(""Access-Control-Allow-Credentials"", ""true"") if c.Request.Method == ""OPTIONS"" { c.AbortWithStatus(200) } else { c.Next() } }}",Go gin framework CORS
How the short hand for declaration & initialization are evaluated in go lang?," The shorthand for declaration and initialization in go is Equivalent to following way of declaration and initialization (as per specs)a:=1 b:=2 c:=3var a int var b int var c int a=1 b=2 c=3But I am not getting the answer for the problem found in following code: Output should be: Since the value of b is evaluated with a + b i.e 1+1 = 2. But its giving 1.Here is the playground links of both the working code where you can observe the difference. a,b = b, a+ba=b, b=a+bI know I am missing something to understand, basically how the shorthand expression are evaluated especially when the same variable is involved in the expression.But where is the proper documentation to refer. Could anyone help on this? <code>  var a, b, c = 1 , 2, 3 package mainimport ""fmt""func main() { var a int = 0 var b int = 1 fmt.Println(""init a "",a) fmt.Println(""init b "",b) a, b = b, a+b fmt.Println(""printing a after `a, b = b, a+b`"",a) fmt.Println(""printing b after `a, b = b, a+b`"",b) } printing a after 'a, b = b, a+b' 1 printing b after 'a, b = b, a+b' 2 ",How the shorthand of declaration & initialization are evaluated in go lang?
Nesting subrouters in gorilla," I've been using gorilla/mux for my routing needs. But I noticed one problem, when I nest multiple Subrouters it doesn't work.Here is the example: I wanted to use this approach so I can delegate populating the router to some other package, for example user.Populate(api)However this doesn't seem to work. It works only if I use single Subrouter in the chain.Any ideas? <code>  func main() { r := mux.NewRouter().StrictSlash(true) api := r.Path(""/api"").Subrouter() u := api.Path(""/user"").Subrouter() u.Methods(""GET"").HandleFunc(UserHandler) http.ListenAndServe("":8080"", r)}",Nesting subrouters in Gorilla Mux
How to build a release version binary in golang?," In C, we can build a debug version or a release version of the binary files (the object files and the executable). How can we do this in Go?  <code> ",How to build a release version binary in Go?
How to use division in golang's template?," How can I use division in a golang template. I need to divide Id by 2.For example <code>  {{if .Id/2}}HEY, I CAN DO IT!{{else}}WHY???{{end}}",How can I use division in a golang template?
Go: How to check an if object has a particular method?," In Go, how do you check if an object responds to a method?For example, in Objective-C this can be achieved by doing: <code>  if ([obj respondsToSelector:@selector(methodName:)]) { // if method exists [obj methodName:42]; // call the method}",How to check if an object has a particular method?
How to check an if object has a particular method?," In Go, how do you check if an object responds to a method?For example, in Objective-C this can be achieved by doing: <code>  if ([obj respondsToSelector:@selector(methodName:)]) { // if method exists [obj methodName:42]; // call the method}",How to check if an object has a particular method?
how do you use golang with a private gitlab repo?," GitLab is a free, open-source way to host private .git repositories but it does not seem to work with Go. When you create a project it generates a URL of the form: where:1.2.3.4 is the IP address of the gitlab serverprivate-developers is a user group which has access to the private repoGolang 1.2.1 doesn't seem to understand this syntax. results in: Is there a way to get this to work? <code>  git@1.2.3.4:private-developers/project.git go get git@1.2.3.4:private-developers/project.git package git@23.251.148.129/project.git: unrecognized import path ""git@1.2.3.4/project.git""",How to use Go with a private GitLab repo
How to use GoLang with a private Gitlab repo?," GitLab is a free, open-source way to host private .git repositories but it does not seem to work with Go. When you create a project it generates a URL of the form: where:1.2.3.4 is the IP address of the gitlab serverprivate-developers is a user group which has access to the private repoGolang 1.2.1 doesn't seem to understand this syntax. results in: Is there a way to get this to work? <code>  git@1.2.3.4:private-developers/project.git go get git@1.2.3.4:private-developers/project.git package git@23.251.148.129/project.git: unrecognized import path ""git@1.2.3.4/project.git""",How to use Go with a private GitLab repo
Finding the user who executed the program when running under sudo (GoLang)," I'm creating a small program that requires privileged access to a network port below 1024, so it runs with sudo.If part of what the utility will need to do requires knowing who the user is that invoked the application, I would need a way to query who the actual user is; using the OS/user method of getting the user points to ""System Administrator"" or other root user because it's running in a sudo context.Is there a way in GoLang to pull the user who is running the application under sudo? (Go 1.4.2, running on OS X 10.10.3). <code> ",How to find the user that executed a program as root using Golang?
What is the idomatic way to handle api versions in golang?," I'm creating a server in Go intended for a mobile app. I need to be able to support multiple versions of the API for cases were users don't update the app. The main concern with the versioning, is to return data in the correct format for the version of the mobile app.I've seen that there are three basic ways to do this.A. One way is by having one route handler on ""/"", and then allowing that function to parse the url for versioning.Example: B. Use a library such as gorilla/mux to handle patterns within the router, but I saw some warnings that this can be too slow.Example: C. Have individual urls that don't change, but based on the header, split into different versions.Example: I'm concerned that option 1 will be too messy code wise. I'm concerned that option 2 will be too slow performance wise, and I'm concerned that option 3 will be difficult for the client to handle, or will get confusing since the version isn't clearly labeled.Which method is the most idiomatic for Go, and will result in the greatest performance for a mobile app which will be polling often? <code>  func main() {http.HandleFunc(""/"", routes.ParseFullURI)} func main() { mux.HandleFunc(""{version:}/"", routes.ParseVersionForHome) mux.HandleFunc(""{version:}/getData"", routes.ParseVersionForGetDAta) mux.HandleFunc(""{version:}/otherCall"", routes.ParseVersionForOtherCall) } func main() { http.HandleFunc(""/"", routes.ParseHeaderForVersionForHome) http.HandleFunc(""/getData"", routes.ParseHeaderForVersionForGetData) http.HandleFunc(""/otherCall"", routes.ParseHeaderForVersionForOtherCall)}",What is the idiomatic way to handle api versions
What is the idiomatic way to handle api versions in golang?," I'm creating a server in Go intended for a mobile app. I need to be able to support multiple versions of the API for cases were users don't update the app. The main concern with the versioning, is to return data in the correct format for the version of the mobile app.I've seen that there are three basic ways to do this.A. One way is by having one route handler on ""/"", and then allowing that function to parse the url for versioning.Example: B. Use a library such as gorilla/mux to handle patterns within the router, but I saw some warnings that this can be too slow.Example: C. Have individual urls that don't change, but based on the header, split into different versions.Example: I'm concerned that option 1 will be too messy code wise. I'm concerned that option 2 will be too slow performance wise, and I'm concerned that option 3 will be difficult for the client to handle, or will get confusing since the version isn't clearly labeled.Which method is the most idiomatic for Go, and will result in the greatest performance for a mobile app which will be polling often? <code>  func main() {http.HandleFunc(""/"", routes.ParseFullURI)} func main() { mux.HandleFunc(""{version:}/"", routes.ParseVersionForHome) mux.HandleFunc(""{version:}/getData"", routes.ParseVersionForGetDAta) mux.HandleFunc(""{version:}/otherCall"", routes.ParseVersionForOtherCall) } func main() { http.HandleFunc(""/"", routes.ParseHeaderForVersionForHome) http.HandleFunc(""/getData"", routes.ParseHeaderForVersionForGetData) http.HandleFunc(""/otherCall"", routes.ParseHeaderForVersionForOtherCall)}",What is the idiomatic way to handle api versions
what is the 'defer' equivalent for java," This is just a short example of Go code: I am finding an equivalent of 'defer' in Java.Instead of 'defer' I can use Is there any alternative without using try/catch/finally? <code>  package mainimport ""fmt""func main() { defer fmt.Println(""world"") //use of keyword 'defer' fmt.Println(""hello"")} try { //do something} finally { //code using defer}",What is the 'defer' equivalent for Java
how can i pass struct to function as parameter in go lang," How can I pass a struct to function as a parameter in golang? There is my code: when I run it, I am getting an error like this there is play.golang.org fiddle address. <code>  package mainimport ( ""fmt"")type MyClass struct { Name string}func test(class interface{}) { fmt.Println(class.Name)}func main() { test(MyClass{Name: ""Jhon""})} # command-line-arguments/tmp/sandbox290239038/main.go:12: class.Name undefined (type interface {} has no field or method Name)",How can I pass a struct to a function as parameter?
"""Operator does not exist: integer =?"" when using Postgres with Golang"," I have a simple SQL query called within the QueryRow method provided by go's database/sql package. However, I'm getting the error pq: operator does not exist: integer =? It looks like the code doesn't understand that the ? is just a placeholder. How can I fix this? <code>  import ( ""github.com/codegangsta/martini"" ""github.com/martini-contrib/render"" ""net/http"" ""database/sql"" ""fmt"" _ ""github.com/lib/pq""))type User struct { Name string}func Show(db *sql.DB, params martini.Params) { id := params[""id""] row := db.QueryRow( ""SELECT name FROM users WHERE id=?"", id) u := User{} err := row.Scan(&u.Name) fmt.Println(err)}","""Operator does not exist: integer =?"" when using Postgres"
Golang - go get hanging on certain library," I'm trying to get this lumberjack library and it always hangs on the download step.I hit the same issue Friday and today. other Go packages install fine. I'm on Scientific Linux. Any ideas what could be going on? (It hangs on last line, I've let it run for 20 minutes so far.) <code>  >go get -u -v gopkg.in/natefinch/lumberjack.v2Fetching https://gopkg.in/natefinch/lumberjack.v2?go-get=1Parsing meta tags from https://gopkg.in/natefinch/lumberjack.v2?go-get=1 (status code 200)get ""gopkg.in/natefinch/lumberjack.v2"": found meta tag main.metaImport{Prefix:""gopkg.in/natefinch/lumberjack.v2"", VCS:""git"", RepoRoot:""https://gopkg.in/natefinch/lumberjack.v2""} at https://gopkg.in/natefinch/lumberjack.v2?go-get=1gopkg.in/natefinch/lumberjack.v2 (download)","""go get"" hanging on certain library"
What is the equivalent for bigint.pow(a) in Golang?," In my use case, I would like to know how the following Java code would be implemented in Go I am able to import the math/big package and create big integers, but not able to do Pow() function in Go. Also I don't find the function in the Go doc.Do I have to implement my own version of Pow() for bigint? Could anyone help me on this? <code>  BigInteger base = new BigInteger(""16"");int exponent = 1;BigInteger a = base.pow(exponent); //16^1 = 16",What is the equivalent for bigint.pow(a) in Go?
Is there a go's analog of python's bisect module?," I am looking for an out-of-the-box implementation of Python's bisect module in Go. All that I need is to find a position for inserting an item in a sorted array from the left and from the right.I know the logic behind the implementation, but I do not want to reinvent the wheel with all of its edge cases. <code> ",Is there a Go analog of Python's bisect module?
Golang: Checking for panic without recovering from it," In a defer function, I want to see whether a call to recover would yield a non-nil value (without recovering)Is it possible? <code> ",Checking for panic without recovering from it
Passing a .go-file as argument," For quick hacking, I prefer to use go run prog.go ... instead of building the executable first. However, the program I am working on should take another go-file as an argument. As a consequence, go run and the compiled binary behave differently: will try to execute both go-files, whereas will correctly take my file as input (the intended behaviour). Now I can pass additional args like this go run ... -- foo.go, but then because of the -- the position of the file differs in os.Args between the go run prog.go -- foo.go and the ./prog foo.go. Any easy solution? I'd like to avoid having full flag-processing. Should I just give up and stick to the compiled version? <code>  go run prog.go foo.go go build prog.go && ./prog foo.go",Passing a .go-file as additional argument to `go run`
Composition of interfaces [Golang]," Is there a way to make an interface also include the methods defined by another interface in Go?For example: I would like a way to specify that the SpecificDatabase interface contains the BasicDatabase interface. Similar to the way Go lets you do composition of structs.This way my methods can take a type that implements SpecificDatabase, but still call CreateTable() on it. <code>  type BasicDatabase interface { CreateTable(string) error DeleteTable(string) error}type SpecificDatabase interface { CreateUserRecord(User) error}",Composition of interfaces in Go
Why can not I copy a slice with copy in golang?," I need to make a copy of a slice in Go and reading the docs there is a copy function at my disposal. The copy built-in function copies elements from a source slice into a destination slice. (As a special case, it also will copy bytes from a string to a slice of bytes.) The source and destination may overlap. Copy returns the number of elements copied, which will be the minimum of len(src) and len(dst).But when I do: My tmp is empty as it was before (I even tried to use arr, tmp): You can check it on go playground. So why can not I copy a slice? <code>  arr := []int{1, 2, 3}tmp := []int{}copy(tmp, arr)fmt.Println(tmp)fmt.Println(arr) [][1 2 3]",Why can't I duplicate a slice with `copy()`?
Why can not I duplicate a slice with `copy()` in golang?," I need to make a copy of a slice in Go and reading the docs there is a copy function at my disposal. The copy built-in function copies elements from a source slice into a destination slice. (As a special case, it also will copy bytes from a string to a slice of bytes.) The source and destination may overlap. Copy returns the number of elements copied, which will be the minimum of len(src) and len(dst).But when I do: My tmp is empty as it was before (I even tried to use arr, tmp): You can check it on go playground. So why can not I copy a slice? <code>  arr := []int{1, 2, 3}tmp := []int{}copy(tmp, arr)fmt.Println(tmp)fmt.Println(arr) [][1 2 3]",Why can't I duplicate a slice with `copy()`?
Why can not I duplicate a slice with `copy()` in Golang?," I need to make a copy of a slice in Go and reading the docs there is a copy function at my disposal. The copy built-in function copies elements from a source slice into a destination slice. (As a special case, it also will copy bytes from a string to a slice of bytes.) The source and destination may overlap. Copy returns the number of elements copied, which will be the minimum of len(src) and len(dst).But when I do: My tmp is empty as it was before (I even tried to use arr, tmp): You can check it on go playground. So why can not I copy a slice? <code>  arr := []int{1, 2, 3}tmp := []int{}copy(tmp, arr)fmt.Println(tmp)fmt.Println(arr) [][1 2 3]",Why can't I duplicate a slice with `copy()`?
How can I compare two source code files/ ast trees ? Go," I'm generating some source code using the templates package( is there a better method? )and part of the testing I need to check if the output matches the expected source code.I tried a string comparison but it fails due the extra spaces / new lines generated by the templates package. I've also tried format.Source with not success. ( FAIL)I tried to parse the ast of the both sources (see bellow) but the ast doesn't match either even if the code is basically same except the new lines / spaces. (FAIL)package main Playground <code>  import ( ""fmt"" ""go/parser"" ""go/token"" ""reflect"")func main() { stub1 := `package main func myfunc(s string) error { return nil }` stub2 := `package main func myfunc(s string) error { return nil }` fset := token.NewFileSet() r1, err := parser.ParseFile(fset, """", stub1, parser.AllErrors) if err != nil { panic(err) } fset = token.NewFileSet() r2, err := parser.ParseFile(fset, """", stub2, parser.AllErrors) if err != nil { panic(err) } if !reflect.DeepEqual(r1, r2) { fmt.Printf(""e %v, r %s, "", r1, r2) }}",How can I compare two source code files/ ast trees?
How to create a new MySQL database with go-sql-driver," I'm working on Golang script that automatically clone a database.I'm using go-sql-driver but i can't find in the documentation a way to create a new database.Connection to MySQL require an URL scheme like: But the database not exists yet, I just want to connect to the server and then create a new one.How can I do that? I have to use another driver? <code>  user:password@tcp(localhost:3306)/database_name",How to create a new MySQL database with go-sql-driver
Go Hmac SHA1 generate hash that not equal to Hmac SHA1 in Java," I'm just starting to learn Go and I'm trying to rewrite my existing small application from Java to Go. I need to create Base64 hash of input string with key using Hmac SHA1 algorithm.My Java code: My Go code: The problem is that Go code generates output that is not expected. For example, for input string ""qwerty"" and key ""key"" Java output will be RiD1vimxoaouU3VB1sVmchwhfhg= and Go output will be 9Cuw7rAY671Fl65yE3EexgdghD8=. Where did I make mistakes in the Go code? <code>  private String getSignedBody(String input, String key) { String result = """"; try { SecretKeySpec signingKey = new SecretKeySpec(key.getBytes(""UTF-8""), ""HmacSHA1""); Mac mac = Mac.getInstance(""HmacSHA1""); mac.init(signingKey); byte[] rawHmac = mac.doFinal(input.getBytes(""UTF-8"")); result = Base64.encodeToString(rawHmac, false); } catch (Exception e) { Logger.error(""Failed to generate signature: "" + e.getMessage()); } return result;} func GetSignature(input, key string) string { key_for_sign := []byte(key) h := hmac.New(sha1.New, key_for_sign) h.Write([]byte(input)) return base64.StdEncoding.EncodeToString(h.Sum(nil))}",Go Hmac SHA1 generates hash different from Hmac SHA1 in Java
How to get a single unicode-character from string in golang," I wonder how I can I get a Unicode character from a string. For example, if the string is """", how can I get the first character """"?From another place I get one way: It does work.But I still have some questions:Is there another way to do it?Why in Go does str[0] not get a Unicode character from a string, but it gets byte data? <code>  var str = """"runes := []rune(str)fmt.Println(string(runes[0]))",How to get a single Unicode character from string
how can I install package with go get?," I want to install packages from github to my $GOPATH, I have tried this: the repository is here. <code>  go get github.com:capotej/groupcache-db-experiment.git",How can I install a package with go get?
"Golang converting string to specific type of int (int8,int16,int32,int64)"," I am trying to parse a string into an integer in Go. The Problem I found with it is in the documentation its mentioned syntax is as follows: where, s is the string to be parsed, base is implied by the string's prefix: base 16 for ""0x"", base 8 for ""0"", and base 10 otherwise. The bitSize parameter is where I am facing problem. As per documentation of ParseInt, it specifies the integer type that the result must fit into. Bit sizes 0, 8, 16, 32, and 64 correspond to int, int8, int16, int32, and int64.But for all the values like 0, 8, 16, 32, and 64. I am getting same type return value. I.eof int64 type. Could anyone point me out what am I missing.Code: https://play.golang.org/p/F3LbUh_maY <code>  ParseInt(s string, base int, bitSize int)","Parse string to specific type of int (int8, int16, int32, int64)"
Golang Dependency Management Best Practise," In Golang, we can specify open source libraries on GitHub as dependencies. For example: This will try to look for a branch based on your Go version and default to master if I understand correctly.So there is no way to import a specific release of a dependency, e.g.: What is the best practise to manage dependencies in Go then?I can see two approaches.I. Version ModulesIs it to create new modules for major versions with breaking changes?For example, my Go library could define modules v1 and v2 so then you could do: Or: Based on what you need. Any changes made to v1 or v2 would be required not to break any APIs or working functionality.II. ForkingThis would give you a complete control over a version of external dependency your Go code requires.For example, you could fork github.com/RichardKnop/somelibrary into your own GitHub account and then in your code do: Then you would have to fork all external dependencies which seems a bit overkill. However it would give you total control over versions. You could keep your forks at a version you know is working with your code and only update forks once you have checked that new releases of dependencies do not break anything.Thoughts? <code>  import ""github.com/RichardKnop/somelibrary"" import ""github.com/RichardKnop/somelibrary#v1.4.8"" import ""github.com/RichardKnop/somelibrary/v1"" import ""github.com/RichardKnop/somelibrary/v2"" import ""github.com/ForkingUser/somelibrary""",Golang Dependency Management Best Practice
How to avoid re-implementing sort.Interface for similar golang struct," There is one problem bothering me in Golang.Say I have 2 structs: And when I try to sort []*Dog and []*Cat by Age, I have to define 2 different sort struct like: A natural thought is to implement some SortableByAge interface and create a Less function using the interface function. Like: And then: However, according to:http://golang.org/doc/faq#convert_slice_of_interface Above is not possible.So I wonder what is the best practice for this case andIs there any other technique that can reduce the need for implementing the sort.Interface for similar structs again and again that I have missed?EDIT: I realized that my examples are terrible :( In real life case, these 2 structs are very different, the only thing in common between them is that I wish to sort them by a common numeric value.A better example would be: And the only thing these 2 structs share in common is that I wish to sort a slice(agh... should not have used Pizza in example) of them by price.So, combining them to a common struct is not really working for a lot of cases.But will look into go generate. <code>  type Dog struct { Name string Breed string Age int}type Cat struct { Name string FavoriteFood string Age int} type SortCat []*Catfunc (c SortCat) Len() int {//..}func (c SortCat) Swap(i, j int) {//..}func (c SortCat) Less(i, j int) bool {//..}type SortDog []*Dogfunc (c SortDog) Len() int {//..}func (c SortDog) Swap(i, j int) {//..}func (c SortDog) Less(i, j int) bool {//..} type SortableByAge interface { AgeValue() int} type SortAnimal []SortableByAgefunc (c SortDog) Less(i, j int) bool { return c[i].AgeValue() < c[j].AgeValue() } dogs := make([]*Dogs, 0 , 1)//add dogs heresort.Sort(SortAnimal(dogs)) type Laptop {//...}type Pizza {//...}",How to avoid re-implementing sort.Interface for similar golang structs
How to parse a coplicated json with go lang unmarshal?," In go the standard package encoding/json exposes json.Unmarshal function to parse JSON.It's possible to either unmarshal the JSON string in a predefined struct, or use the interface{} and iterate the result for unexpected JSON data structure.That said, I can't parse complex JSON properly. Can someone tell me how to achieve this? <code>  { ""k1"" : ""v1"", ""k2"" : ""v2"", ""k3"" : 10, ""result"" : [ [ [""v4"", v5, {""k11"" : ""v11"", ""k22"" : ""v22""}] , ... , [""v4"", v5, {""k33"" : ""v33"", ""k44"" : ""v44""} ] ], ""v3"" ] }",How to parse a complicated JSON with Go unmarshal?
How to parse a complicated JSON with Go lang unmarshal?," In go the standard package encoding/json exposes json.Unmarshal function to parse JSON.It's possible to either unmarshal the JSON string in a predefined struct, or use the interface{} and iterate the result for unexpected JSON data structure.That said, I can't parse complex JSON properly. Can someone tell me how to achieve this? <code>  { ""k1"" : ""v1"", ""k2"" : ""v2"", ""k3"" : 10, ""result"" : [ [ [""v4"", v5, {""k11"" : ""v11"", ""k22"" : ""v22""}] , ... , [""v4"", v5, {""k33"" : ""v33"", ""k44"" : ""v44""} ] ], ""v3"" ] }",How to parse a complicated JSON with Go unmarshal?
"What does the declare ""var _ FileInfo = FileInfoInternal{}"" mean in golang?"," When I read a copy of the docker/distribution source code, I find there are variables declared which make me quite confused.The code is: I don't know what the declare mean, and hope to get some help. <code>  var _ FileInfo = FileInfoInternal{}var _ FileInfo = &FileInfoInternal{}","Why declare like ""var _ I = T{}"" and ""var _ I = &T{}"" continuously?"
"Why declare some variables like ""var _ I = T{}"" and ""var _ I = &T{}"" continuously in golang?"," When I read a copy of the docker/distribution source code, I find there are variables declared which make me quite confused.The code is: I don't know what the declare mean, and hope to get some help. <code>  var _ FileInfo = FileInfoInternal{}var _ FileInfo = &FileInfoInternal{}","Why declare like ""var _ I = T{}"" and ""var _ I = &T{}"" continuously?"
"Why declare like ""var _ I = T{}"" and ""var _ I = &T{}"" continuously in golang?"," When I read a copy of the docker/distribution source code, I find there are variables declared which make me quite confused.The code is: I don't know what the declare mean, and hope to get some help. <code>  var _ FileInfo = FileInfoInternal{}var _ FileInfo = &FileInfoInternal{}","Why declare like ""var _ I = T{}"" and ""var _ I = &T{}"" continuously?"
"In Go, is there an os-independent way to atomically overwrite a file?"," If the file already exists, I want to overwrite it. If it doesn't exist, I want to create it and write to it. I'd prefer to not have to use a 3rd party library like lockfile (which seems to handle all types of locking.)My initial idea was to:Write to a temporary file with a randomly generated large id to avoid conflict.Rename the temp filename -> new path name. <code> ",Is there an os-independent way to atomically overwrite a file?
How initializate type variables in golang," How can to initialize any fields in golang types? For example: <code>  type MyType struct { Field string = ""default"" } ",How to initialize struct fields
Golang Web app on AWS with Elastic Beanstalk - Logs Not Showing?," This is sort of an in-depth question, so I'll try to explain it as best I can.I've built a small API service in Go that I'm trying to deploy to AWS using the relatively new AWS Elastic Beanstalk Docker support.Here's what I've done (the code is all open source, so you can follow along if you'd like): This will use elastic beanstalk to create a new app (with docker), and deploy it.If I then run eb opento open my web app, I'll see my public IP address displayed (this is the correct behavior), so I know that my application is running / functional.Now, in my source code, I've got several lines of debugging output: The above statement just prints ""WOO"" to the console. This is run every time a new request is made.Unfortunately, when I run eb logs to view my instance logs, this debug line never shows up and I can't figure out why.I've tried printing to STDERR, printing to STDOUT, etc. but I'm absolutely unable to get any output.I've scoured the internet looking for solutions, but have yet to find any. <code>  $ git clone https://github.com/rdegges/ipify-api.git$ cd ipify-api$ git fetch origin aws:aws$ git checkout aws$ eb init$ eb create$ eb deploy fmt.Println(""WOOOOOOOOOOOO"")",Go Web app on AWS with Elastic Beanstalk not showing output in logs
how use regexp get url pattern in golang?," How to use regular expression matching URL, which does decide to use the corresponding function processing <code>  package mainimport( ""fmt"" ""net/http"")func main() { http.HandleFunc(""/pattern"", resolve) http.ListenAndServe("":8080"", nil)}func resolve(w http.ResponseWriter, r * http.Request) { fmt.Println(r.URL.Host)}",How to use regexp get url pattern in golang?
How to get capturing group functionality in Golang regular expressions?," I'm porting a library from Ruby to Go, and have just discovered that regular expressions in Ruby are not compatible with Go (google RE2). It's come to my attention that Ruby & Java (plus other languages use PCRE regular expressions (perl compatible, which supports capturing groups)), so I need to re-write my expressions so that they compile ok in Go.For example, I have the following regex: This should accept input such as: The capturing groups allow the year, month and day to be captured into variables. To get the value of each group, it's very easy; you just index into the returned matched data with the group name and you get the value back. So, for example to get the year, something like this pseudo code: This is a pattern I use a lot in my expressions, so I have a lot of re-writing to do.So, is there a way to get this kind of functionality in Go regexp; how should I re-write these expressions? <code>  `(?<Year>\d{4})-(?<Month>\d{2})-(?<Day>\d{2})` 2001-01-20 m=expression.Match(""2001-01-20"")year = m[""Year""]",How to get capturing group functionality in Go regular expressions
golang: convert hex to float," I have to convert hex, represeneted as strings (e.g. ""0xC40C5253"") to float values (IEEE-754 conversion). I did not manage to do that using the strconv.ParseFloat function. Is there anything else I have to use?I couldn't find it so far. I also tried converting it to an integer first and then to a float, but the results were wrong.Code of my last try: <code>  package mainimport ( ""fmt"" ""strconv"")func main () { x, err := strconv.ParseInt(""C40C5253"", 16, 64) f, err := strconv.ParseFloat(fmt.Sprintf(""%d"", x), 64) if err != nil { fmt.Printf(""Error in conversion: %s\n"", err) } else { fmt.Println(f) }}",How to convert hex to float
Static local variable in golang," Is it possible to define a local variable in Go that can maintain its value from one function call to another? In C, we can do this using the reserved word static.Example in C: <code>  int func() { static int x = 0; x++; return x;}",Static local variable in Go
Does runtime.LockOSThread allows child goroutines to run in same OS Thread?," I understand that in Go, runtime.LockOSThread() will bind a goroutine to one OS thread and not allow other goroutines to execute in that thread.Is this also true for child goroutines?For example: Do both of these goroutines execute in a single and exclusive OS thread or only the first one? <code>  runtime.LockOSThread()go func() { go func() { // Do something }() // Do something}()",Does runtime.LockOSThread allow child goroutines to run in same OS thread?
single ampersand between 2 expressions in golang," I was looking at the Go language source code, module math/rand. I found there one interesting line I'm just curious, what does n&(n-1) mean?I would understand n && (n-1). It would be AND operator between 2 boolean expressions. I would understand &n. It's address of n variable. But what is n&(n-1) I cannot figure out.Full method code: <code>  if n&(n-1) == 0 { // n is power of two, can mask // Int63n returns, as an int64, a non-negative pseudo-random number in [0,n).// It panics if n <= 0.func (r *Rand) Int63n(n int64) int64 { if n <= 0 { panic(""invalid argument to Int63n"") } if n&(n-1) == 0 { // n is power of two, can mask return r.Int63() & (n - 1) } max := int64((1 << 63) - 1 - (1<<63)%uint64(n)) v := r.Int63() for v > max { v = r.Int63() } return v % n}",single ampersand between 2 expressions
How to find relationships between objects," For People With A Similar Question (written after finding a solution):This problem, as you might notice according to the answers below, has a lot of different solutions. I only chose Evan's because it was the easiest one for me implement into my own code. However, from what I tried, every other answer also worked. @SalvadorDali linked this Kaggle page which was definitely interesting and I reccomend reading if you are interested. Prolog was also brought up as a possible solution, I'm unfamiliar with it, but if you already know it -- it's probably worth considering. Also, if you just want to get code to use there are working Javascript and Python examples below. However, each one had a different approach to the solution and I'm not sure which is most effecient (feel free to test it yourself).For further approaches/reading:http://en.wikipedia.org/wiki/Breadth-first_searchProlog and ancestor relationshiphttps://www.kaggle.com/c/word2vec-nlp-tutorial/details/part-2-word-vectorsSorry for the confusing title, I can't figure out a way to properly word my question -- any better ideas are welcome.Because I'm having such a difficult time describing my question, I'll try to explain my goal and code as much as needed:Note: my code here is Go, but I'd be happy with answers in other languages as well, if you have any questions I'll try to answer as quick as possibleBasically, I have an array of ""Word"" objects that look like this: This is an example of 4 words within the array: My challenge is writing a method to test for a relationship between 2 words. Of course, testing between 2 words like ""cat"" and ""kitten"" would be easy with the example above. I could just check ""Cat""s list of synonyms and test to see if it contains ""kitten."" With code like this: However, I can't figure out how to test for a more distant relationship.For example: I tried to do it recursively, but all my attempts don't seem to work. Any example code (My code is in Go, but Python, Java, or Javascript are also fine), pseudocode or just explanations would be really great. <code>  type Word struct{ text string synonyms []string} []Word{ {text: ""cat"" synonyms: [""feline"", ""kitten"", ""mouser""]} {text: ""kitten"" synonyms: [""kitty"", ""kit""]} {text: ""kit"" synonyms: [""pack"", ""bag"", ""gear""]} {text: ""computer"" synonyms: [""electronics"", ""PC"", ""abacus""]} } areWordsRelated(word1 Word, word2 Word) bool{ for _, elem := range word1.synonyms{ if elem == word2.text{ return true } } return false} areWordsRelated(""cat"",""pack"") //should return true //because ""cat"" is related to ""kitten"" which is related to ""pack""areWordsRelated(""cat"", ""computer"") //should return false",How to find Relationships between Objects
Are pointers dereferenced by default in golang struct methods?," I'm confused by methods on structs in Go. I've following along in a tutorial in which they have: From my understanding, p is pointer and you would need to dereference the pointer before retrieving a property for example: The only way this makes sense to me is if the dot is acting like -> in C++. What am I missing? <code>  func (p *Page) save() error { filename := p.Title + "".txt"" return ioutil.WriteFile(filename, p.Body, 0600)} filename := (*p).Title + "".txt""",Are pointers dereferenced by default inside of methods?
golang The zero value of a slice is not nil.," I was following the example https://tour.golang.org/moretypes/10I modified the code expecting to get the same result. I did not. Is this a bug, or a documentation error? The tour states A nil slice has a length and capacity of 0.My y variable has a length and capacity of 0. Here is my output. I was expecting a second ""nil""~ Why didn't I get it? <code>  package mainimport ""fmt""func myPrint(z []int) { fmt.Println(z, len(z), cap(z)) if z == nil { fmt.Println(""nil!"") }}func main() { var z []int y := []int {} myPrint(z) myPrint(y)} [] 0 0nil![] 0 0",The zero value of a slice is not nil
Gorm (Golang) - multi column unique index," How do I define my structs to specify a multi-column unique index to Gorm in Go?Such as: <code>  type Something struct { gorm.Model First string `sql:""unique_index:unique_index_with_second""` Second string `sql:""unique_index:unique_index_with_first""`}",How to specify a struct with a multi-column unique index for Gorm?
How do I when I define my `struct`s specify a multi column unique index in Gorm Golang?," How do I define my structs to specify a multi-column unique index to Gorm in Go?Such as: <code>  type Something struct { gorm.Model First string `sql:""unique_index:unique_index_with_second""` Second string `sql:""unique_index:unique_index_with_first""`}",How to specify a struct with a multi-column unique index for Gorm?
Using Go server for production," I'm a PHP developer new to Golang. PHP comes with an inbuilt server which is not recommended for production. I read the beautiful book by astaxie on web development in Go and also the golang.org example on writing a web app. They both use the http.ListenAndServe() to create a web server. I just want to know if this server can be used in production or is it just a dummy server like PHP inbuilt server? By production I mean, can it handle huge traffic like an Apache or ngnix server? <code> ",Using Go's HTTP server for production
Server initiated requests," I know that HTTP is a request-response protocol. My problem, in short, is that a client makes a request to the server to start a long running-process, and I want to inform the client of the progress with a simple JSON message containing progress info.In HTTP/1.1 I know that I could use a WebSocket or server-sent events (SSE) or long polling.Now I know that HTTP/2 does not support WebSocket yet.My question is, what is the optimal way to handle such things over HTTP/2?Are there any new things that I am not aware of to handle server-initiated requests in HTTP/2?I am using the Go language, if that matters. <code> ",Server-initiated requests
convert chan to non chan in golang," Is it possible to let function funcWithNonChanResult have the following interface: And if I want it to use function funcWithChanResult with the interface: In other words, can I somehow convert chan int to int? Or I must have chan int result type in all the functions which use funcWithChanResult?Currently, I tried these methods: Full code: Playground <code>  func funcWithNonChanResult() int { func funcWithChanResult() chan int { result = funcWithChanResult() // cannot use funcWithChanResult() (type chan int) as type int in assignmentresult <- funcWithChanResult() // invalid operation: result <- funcWithChanResult() (send to non-chan type int) package mainimport ( ""fmt"" ""time"")func getIntSlowly() int { time.Sleep(time.Millisecond * 500) return 123}func funcWithChanResult() chan int { chanint := make(chan int) go func() { chanint <- getIntSlowly() }() return chanint}func funcWithNonChanResult() int { var result int result = funcWithChanResult() // result <- funcWithChanResult() return result}func main() { fmt.Println(""Received first int:"", <-funcWithChanResult()) fmt.Println(""Received second int:"", funcWithNonChanResult())}",Convert chan to non chan in golang
Reading a yaml file golang," I have an issue with reading a YAML file. I think it's something in the file structure but I can't figure out what.YAML file: code: <code>  conf: hits:5 time:5000000 type conf struct { hits int64 `yaml:""hits""` time int64 `yaml:""time""`}func (c *conf) getConf() *conf { yamlFile, err := ioutil.ReadFile(""conf.yaml"") if err != nil { log.Printf(""yamlFile.Get err #%v "", err) } err = yaml.Unmarshal(yamlFile, c) if err != nil { log.Fatalf(""Unmarshal: %v"", err) } return c}",How to read a YAML file
Reading a YAML file in Golang," I have an issue with reading a YAML file. I think it's something in the file structure but I can't figure out what.YAML file: code: <code>  conf: hits:5 time:5000000 type conf struct { hits int64 `yaml:""hits""` time int64 `yaml:""time""`}func (c *conf) getConf() *conf { yamlFile, err := ioutil.ReadFile(""conf.yaml"") if err != nil { log.Printf(""yamlFile.Get err #%v "", err) } err = yaml.Unmarshal(yamlFile, c) if err != nil { log.Fatalf(""Unmarshal: %v"", err) } return c}",How to read a YAML file
Adding POST variables to glolang test http Request," I am trying to add form variables to a Go http request.Here's how my Go test looks: The issue is that the form data never gets passed on to the function I need to test.The other relevant function is: I am using Go version go1.3.3 darwin/amd64. <code>  func sample_test(t *testing.T) { handler := &my_listener_class{} reader := strings.NewReader(""number=2"") req, _ := http.NewRequest(""POST"", ""/my_url"", reader) w := httptest.NewRecorder() handler.function_to_test(w, req) if w.Code != http.StatusOK { t.Errorf(""Home page didn't return %v"", http.StatusOK) }} func (listener *my_listener_class) function_to_test(writer http.ResponseWriter, request *http.Request) { ...}",Adding POST variables to Go test http Request
"How can I redirect, in Go, the stdout and stderr of a command to both the console and a log file while outputting in real time?"," The following bit of code does exactly what I want, except it only prints to the console. randomcommand.php: Output: What I'm trying to achieve is:Print the command's stdout and stderr to the console in real-time;Log the command's stdout and stderr to a file, exactly as it appears in the console;Respect the exact order of writes to stdout and stderr, and;Not modify the command itselfI've tried piping the command stdout and stderr into scanners or using io.Copy, each in a goroutine, but order of the output was not maintained. Probably because alternating between goroutines would have to occur at the same time as output alternates, which is just about impossible. I also tried the using ""select"" as in the examples from here. But order of output was not maintained.Same problem with Logstreamer.The other idea I have to try is to see if I can somehow just read from the console buffer, but this just doesn't feel right.Does anyone know if this is even possible and worth pursuing? <code>  cmd := exec.Command(""php"", ""randomcommand.php"")cmd.Stdout = os.Stdoutcmd.Stderr = os.Stderrif err := cmd.Run(); err != nil { log.Fatal(err)} // randomcommand.php simply alternates output between stdout and stderr 20 times$stdout = fopen('php://stdout', 'w+');$stderr = fopen('php://stderr', 'w+');for ($i = 1;$i <= 20; $i++) { fwrite($stdout, ""stdout $i\n""); fwrite($stderr, ""stderr $i\n"");} stdout 1stderr 1stdout 2stderr 2stdout 3stderr 3stdout 4stderr 4stdout 5stderr 5stdout 6stderr 6stdout 7stderr 7stdout 8stderr 8stdout 9stderr 9stdout 10stderr 10stdout 11stderr 11stdout 12stderr 12stdout 13stderr 13stdout 14stderr 14stdout 15stderr 15stdout 16stderr 16stdout 17stderr 17stdout 18stderr 18stdout 19stderr 19stdout 20stderr 20",How can I redirect the stdout and stderr of a command to both the console and a log file while outputting in real time?
illegal base64 data at input byte 4 when using base64.StdEncoding.DecodeString(str)," I am getting: error: illegal base64 data at input byte 4When passing in Base64Image into base64.StdEncoding.DecodeString(str): Let me know if you need the full base64, I have just pasted in the first part as it looks like the problem is within 4 byte? Do you know why? <code>  data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYA... data, errBase := base64.StdEncoding.DecodeString(Base64Image)if errBase != nil { fmt.Println(""error:"", errBase) return false}",Illegal base64 data at input byte 4 when using base64.StdEncoding.DecodeString(str)
Assigning null to JSON fields instead of empty strings in Golang," Since empty string is the zero/default value for Go string, I decided to define all such fields as interface{} instead. for example The application I am sending my data expect a null instead of an empty string if value is not available for that specific field.Is this the correct approach or can someone please point me to something better than this.  <code>  type student struct { FirstName interface{} `json:""first_name""` MiddleName interface{} `json:""middle_name""` LastName interface{} `json:""last_name""`}",Assigning null to JSON fields instead of empty strings
Golang: Gzip uncompressed http.Response.Body," I am building a Go application that takes an http.Response object and saves it (response headers and body) to a redis hash. When the application receives an http.Response.Body that is not gzipped, I want to gzip it before saving it to the cache.My confusion stems from my inability to make clear sense of Go's io interfaces, and how to negotiate between http.Response.Body's io.ReadCloser and the gzip Writer. I imagine there is an elegant, streaming solution here, but I can't quite get it to work. <code> ",Gzip uncompressed http.Response.Body
Which is the nicer way to initialize a map in Golang?, As map is a reference type. What is difference between:? and <code>  m := make(map[string]int32) m := map[string]int32{},Which is the nicer way to initialize a map?
Sharing a globally defined db conn with multiple packages in golang," I've read a few StackOverflow answers on how we handling the db connection. Since it's a pool, we can define it globally and use it in multiple goroutines and it's safe. The issue I'm having is that I have split my REST API into multiple packages. Each of these packages require a db connection, so I open a database connection in the startup. But even if I define the connection globally, it's only at the package level. What can I do to potentially share it among multiple packages? For some context I'm using the PostgreSQL driver and gin-gonic in my application. <code> ",Sharing a globally defined db conn with multiple packages
Sharing a globally defined db conn with multiple packages in Golang," I've read a few StackOverflow answers on how we handling the db connection. Since it's a pool, we can define it globally and use it in multiple goroutines and it's safe. The issue I'm having is that I have split my REST API into multiple packages. Each of these packages require a db connection, so I open a database connection in the startup. But even if I define the connection globally, it's only at the package level. What can I do to potentially share it among multiple packages? For some context I'm using the PostgreSQL driver and gin-gonic in my application. <code> ",Sharing a globally defined db conn with multiple packages
convert a byte to string in golang," I am trying to do something like this: I searched a lot and really have no idea how to do this.I know this will not work: <code>  bytes := [4]byte{1,2,3,4}str := convert(bytes)//str == ""1,2,3,4"" str = string(bytes[:])",Convert a byte to a string in Go
What the difference between cookie and cookiejar?," Today I faced the term ""cookiejar"" (package net/http/cookiejar). I tried to gather some information regarding it, but got nothing intelligible came out. I know that cookie is key/value pairs that server sends to a client, eg: Set-Cookie: foo=10, browser stores it locally and then each subsequent request browser will send these cookies back to the server, eg: Cookie: foo=10.Ok, but what about cookiejar? What is it and how does it look like? <code> ",What is the difference between cookie and cookiejar?
Go Templates: Using methods with multiple return values," I'm trying to write a template (using html/template) and passing it a struct that has some methods attached to it, many of which return multiple values. Is there any way of accessing these from within the template? I'd like to be able to do something like: But obviously this doesn't work. Is there no way around it?I've considered creating an anonymous struct in my code: And passing that in, but would much prefer to have something in the template. Any ideas? I also tried writing a wrapper function which I added to funcMaps but could never get that to work at all.Thanks for any suggestions! <code>  package mainimport ( ""fmt"" ""os"" ""text/template"")type Foo struct { Name string}func (f Foo) Baz() (int, int) { return 1, 5}const tmpl = `Name: {{.Name}}, Ints: {{$a, $b := .Baz}}{{$a}}, {{b}}`func main() { f := Foo{""Foo""} t, err := template.New(""test"").Parse(tmpl) if err != nil { fmt.Println(err) } t.Execute(os.Stdout, f)} data := struct { Foo a int b int}{ f, 0, 0,}data.a, data.b = f.Baz()",Using methods with multiple return values
generic function to get size of any structure in golang," I am writing a generic function to get the size of any type of structure, similar to sizeof function in C.I am trying to do this using interfaces and reflection but I'm not able to get the correct result. Code is below: This code returns wrong result as 12. I am very new to Go, kindly help me on this. <code>  package mainimport ( ""fmt"" ""reflect"" ""unsafe"")func main() { type myType struct { a int b int64 c float32 d float64 e float64 } info := myType{1, 2, 3.0, 4.0, 5.0} getSize(info)}func getSize(T interface{}) { v := reflect.ValueOf(T) const size = unsafe.Sizeof(v) fmt.Println(size)}",generic function to get size of any structure in Go
Getting method parameter names in Golang," Given the following Go method: I want to reflect the name of the parameter (which is data here).I tried the following, but it returns the structure name (which is testData here): How can I get the name of the parameter? <code>  func (t *T) TMethod(data *testData) (interface{}, *error) { ...} reflect.ValueOf(T).MethodByName(""TMethod"").Type().In(0).Elem().Name()",Getting method parameter names
grpc header/cookie in golang," I want to do place on server application which can be called by Go APP and Java app both. for some reason ,there's a cookie authentication and oAuth mechanism ,so I want to set one Go app as Auth Micro-service for the authentication purpose.As GRPC is built on the HTTP2 ,so The headers and cookies are on the protocol.but I did not find out how to carry on header and cookie when the rpc occurs,implemented by Go, on GitHub I only found the JAVA-Implementation for headers at : Can anybody give me some direction of Go implementation for this purpose? <code>  https://github.com/grpc/grpc-java/tree/master/examples/src/main/java/io/grpc/examples/header",grpc header/cookie in Go
Slice string in Go: How can I slice arabic (or other unicode) strings?," I need to slice a string in Go. Possible values can contain Latin chars and/or Arabic/Chinese chars. In the following example, the slice annotation [:1] for the Arabic string alphabet is returning a non-expected value/character. http://play.golang.org/p/R-JxaxbfNL <code>  package main import ""fmt"" func main() { a := ""a"" fmt.Println(a[:1]) // works b := """" fmt.Println(b[:1]) // does not work fmt.Println(b[:2]) // works fmt.Println(len(a) == len(b)) // false }",Slice unicode/ascii strings in golang?
Golang: how to read response body of ReverseProxy?," Reverse Proxy is works. How can I get the response body? <code>  package mainimport ( ""net/http"" ""net/http/httputil"" ""net/url"")func main() { target := &url.URL{Scheme: ""http"", Host: ""www.google.com""} proxy := httputil.NewSingleHostReverseProxy(target) http.Handle(""/google"", proxy) http.ListenAndServe("":8099"", nil)}",How to read response body of ReverseProxy
how to ask for administer privileges with Golang," What I want to achieve for my application, is to not need to right click and choose Run as administrator each time I want to run it. I want Windows to prompt me to gain admin permissions as with other windows applications.consider the following code: If you compile it and double click on it it will print: open: C:\Windows\test.txt: Access is denied.But if you right-click and run as administrator, it will create and write the file.How to make it ask for the admin permission just by double clicking on it? <code>  package mainimport ( ""fmt"" ""io/ioutil"" ""time"")func main() { err := ioutil.WriteFile(""C:/Windows/test.txt"", []byte(""TESTING!""), 0644) if err != nil { fmt.Println(err.Error()) time.Sleep(time.Second * 3) }}",How to ask for administer privileges on Windows with Go
How to ask for administer privileges on Windows with Golang," What I want to achieve for my application, is to not need to right click and choose Run as administrator each time I want to run it. I want Windows to prompt me to gain admin permissions as with other windows applications.consider the following code: If you compile it and double click on it it will print: open: C:\Windows\test.txt: Access is denied.But if you right-click and run as administrator, it will create and write the file.How to make it ask for the admin permission just by double clicking on it? <code>  package mainimport ( ""fmt"" ""io/ioutil"" ""time"")func main() { err := ioutil.WriteFile(""C:/Windows/test.txt"", []byte(""TESTING!""), 0644) if err != nil { fmt.Println(err.Error()) time.Sleep(time.Second * 3) }}",How to ask for administer privileges on Windows with Go
How do I declare a pointer to a method with a pointer receiver in Go," I am trying to create function pointer to a function that has a method receiver. However, I can't figure out how to get it to work (if it is possible)?Essentially, I have the following: The last line of the code gives the error <code>  type Foo struct {...}func (T Foo) Bar bool { ... }type BarFunc (Foo) func() bool // Does not work. syntax error: unexpected func, expecting semicolon or newline",How do I declare a function pointer to a method in Go
Is it needed to asign default value to variable in golang?," In Go, when a variable is declared it is initialized with zero value as described in the specification.http://golang.org/ref/spec#The_zero_valueBut is it good coding practice to make use of this property and do not explicitly initialize your variable if it needs to initialized with the default value.for example in the following examplehttp://play.golang.org/p/Mvh_zwFkOu The program relies on the default value of boolean to be false. <code>  package mainimport ""fmt""type B struct { isInit bool Greeting string}func (b *B) Init() { b.isInit = true b.Greeting = ""Thak you for your time""}func (b *B) IsInitialized() bool { return b.isInit}func main() { var b B if !b.IsInitialized(){ b.Init() } fmt.Println(b.Greeting)}",Is it required to assign default value to variable?
Is it needed to assign default value to variable in golang?," In Go, when a variable is declared it is initialized with zero value as described in the specification.http://golang.org/ref/spec#The_zero_valueBut is it good coding practice to make use of this property and do not explicitly initialize your variable if it needs to initialized with the default value.for example in the following examplehttp://play.golang.org/p/Mvh_zwFkOu The program relies on the default value of boolean to be false. <code>  package mainimport ""fmt""type B struct { isInit bool Greeting string}func (b *B) Init() { b.isInit = true b.Greeting = ""Thak you for your time""}func (b *B) IsInitialized() bool { return b.isInit}func main() { var b B if !b.IsInitialized(){ b.Init() } fmt.Println(b.Greeting)}",Is it required to assign default value to variable?
Is it required to assign default value to variable in Golang?," In Go, when a variable is declared it is initialized with zero value as described in the specification.http://golang.org/ref/spec#The_zero_valueBut is it good coding practice to make use of this property and do not explicitly initialize your variable if it needs to initialized with the default value.for example in the following examplehttp://play.golang.org/p/Mvh_zwFkOu The program relies on the default value of boolean to be false. <code>  package mainimport ""fmt""type B struct { isInit bool Greeting string}func (b *B) Init() { b.isInit = true b.Greeting = ""Thak you for your time""}func (b *B) IsInitialized() bool { return b.isInit}func main() { var b B if !b.IsInitialized(){ b.Init() } fmt.Println(b.Greeting)}",Is it required to assign default value to variable?
How to serve up a json response using a golang?," Question: Currently I'm printing out my response in the func Indexlike this fmt.Fprintf(w, string(response)) however, how can I send JSON properly in the request so that it maybe consumed by a view?  <code>  package mainimport ( ""fmt"" ""github.com/julienschmidt/httprouter"" ""net/http"" ""log"" ""encoding/json"")type Payload struct { Stuff Data}type Data struct { Fruit Fruits Veggies Vegetables}type Fruits map[string]inttype Vegetables map[string]intfunc Index(w http.ResponseWriter, r *http.Request, _ httprouter.Params) { response, err := getJsonResponse(); if err != nil { panic(err) } fmt.Fprintf(w, string(response))}func main() { router := httprouter.New() router.GET(""/"", Index) log.Fatal(http.ListenAndServe("":8080"", router))}func getJsonResponse()([]byte, error) { fruits := make(map[string]int) fruits[""Apples""] = 25 fruits[""Oranges""] = 10 vegetables := make(map[string]int) vegetables[""Carrats""] = 10 vegetables[""Beets""] = 0 d := Data{fruits, vegetables} p := Payload{d} return json.MarshalIndent(p, """", "" "")}",How to serve up a JSON response using Go?
Convert to time in GOlang from milliseconds," I have a some json data where there is a field called lastModifed contains time in millis. I wanted to convert this data into a struct type with json.UnMarshaller. I have mapped the field with json filed. But the conversion seems not working.IE :My Json looks like this: and struct Looks like looks not converting the time properly. how can i get the time from those millis??NB: The millis of lastModifiedTime are getting from java System.currentTimeMillis(); <code>  { ""name"" : ""hello"", ""lastModified"" : 1438167001716} type Model struct { Name string `json:""name""` Lastmodified time.Time `json:""lastModified""`}",Convert to time in Golang from milliseconds
Is all the variables in Go allocated in heap?," I am new to Go, and found it is OK to return the address of a local variable defined in a function. That is obviously not possible in C since local variable is in stack.So I am just wondering why it is OK to do it in Go? In Go, the local variable is in heap? Will it affect performance since allocating heap memory is quite expensive than stack? Is it possible allocate local variable in stack in Go? Or actually is there stack memory in Go? <code> ",Are all the variables in Go allocated on heap?
Can I create shared test utilities in go?," I'm wondering whether it's possible to share test utility code across packages in go. Specifically, I'm writing a TCP server that will be used by multiple handlers for different message types, and want to reuse a set of common test utils.The main TCP server code is in mypkg/tcpserver: The testutils_test.go code is intended to be a shared library that can be used by mypkg/tcpserver and other packages to set up a test server and client for their tests. For example in the handler subpackage I have: The handler/*_test.go files all import mypkg/tcpserver, but they are unable to access the test utilities defined in mypkg/tcpserver/testutils_test.go: It appears that tests can import other packages, but not test code defined within those packages? Is this the intent? If so, is there an idiomatic way to share test utilities across packages in go? <code>  mypkg/tcpserver/tcp_server.gomypkg/tcpserver/tcp_server_test.gomypkg/tcpserver/testutils_test.go mypkg/tcpserver/handler/handler.gomypkg/tcpserver/handler/csv_handler.gomypkg/tcpserver/handler/csv_handler_test.gomypkg/tcpserver/handler/delim_handler.gomypkg/tcpserver/handler/delim_handler_test.go $ wgo test mypkg/tcpserver/handler# mypkg/tcpserver/handlersrc/mypkg/tcpserver/handler/csv_handler_test.go:37: undefined: tcpserver.CreateTestServersrc/mypkg/tcpserver/handler/csv_handler_test.go:40: undefined: tcpserver.TestSenderFAIL mypkg/tcpserver/handler [build failed]",Can I create shared test utilities?
Golang Stream Large JSON," I have a massive JSON array stored in a file (""file.json"")I need to iterate through the array and do some operation on each element. Causes an out of memory - I'm guessing because it loads everything into memory first.Is there a way to stream the JSON element by element? <code>  err = json.Unmarshal(dat, &all_data)",Decode large stream JSON
Stream large JSON," I have a massive JSON array stored in a file (""file.json"")I need to iterate through the array and do some operation on each element. Causes an out of memory - I'm guessing because it loads everything into memory first.Is there a way to stream the JSON element by element? <code>  err = json.Unmarshal(dat, &all_data)",Decode large stream JSON
Golang: computing the memory footprint (or byte length) of a map," I want to limit a map to be maximum X bytes. It seems there is no straightforward way of computing the byte length of a map though. ""encoding/binary"" package has a nice Size function, but it only works for slices or ""fixed values"", not for maps. I could try to get all key/value pairs from the map, infer their type (if it's a map[string]interface{}) and compute the length - but that would be both cumbersome and probably incorrect (because that would exclude the ""internal"" Go cost of the map itself - managing pointers to elements etc). Any suggested way of doing this? Preferably a code example.  <code> ",Computing the memory footprint (or byte length) of a map
How to ping an IP Adress in golang, How can you ping an IP address from a golang application? The ultimate goal is to check if a server is online.Does go have a way in the standard library to implement a network ping? <code> ,How to ping an IP Address in golang
Golang: Check whether a file is a hard link?," How do you check whether a file is a hard link in Go? os.FileMode only has a mode for symlinks, not hard links.I had an idea that unfortunately doesn't work: This^ doesn't work because os.Readlink reads only symlinks, not hard links.I found a somewhat related answer:Counting hard links to a file in GoBut this answer shows how to find the number of hard links to a file, not whether a file itself is a hard link.I'm guessing that the syscall package used in that answer or, better yet, the sys package has a way to test whether a file's a hard link. Does anyone know to do this? (I have trouble understanding those packages because they're so low-level.)EDITI should add the reason why I'd like to check this. I'm trying to make a function to create a tar archive of a directory [using filepath.Walk()]. In this function, when I create the *tar.Header for a file, I set a value to *tar.Header.Typeflag.For example, if fi is a file's *os.FileInfo variable and hdr is the *tar.Header variable for that file's place in a new tar archive, it looks like this: In the tar package, the modes for hard links and regular files are distinct, TypeLink and TypeReg, but this isn't the case in the os package. So running this won't set the correct Typeflag: <code>  package mainfunc main() { filename := os.Args[1] var hardlink bool link, _ := os.Readlink(filename) fi, _ := os.Stat(filename) mode := string(fi.Mode().String()[0]) if link != """" && mode != ""L"" { hardlink = true } fmt.Printf(""%v is hard link? %v\n"", filename, hardlink)} if fi.Mode().IsDir() { hdr.Typeflag = tar.TypeDir} hdr.Mode = int64(fi.Mode())",Check whether a file is a hard link
Check whether a file is a hard link," How do you check whether a file is a hard link in Go? os.FileMode only has a mode for symlinks, not hard links.I had an idea that unfortunately doesn't work: This^ doesn't work because os.Readlink reads only symlinks, not hard links.I found a somewhat related answer:Counting hard links to a file in GoBut this answer shows how to find the number of hard links to a file, not whether a file itself is a hard link.I'm guessing that the syscall package used in that answer or, better yet, the sys package has a way to test whether a file's a hard link. Does anyone know to do this? (I have trouble understanding those packages because they're so low-level.)EDITI should add the reason why I'd like to check this. I'm trying to make a function to create a tar archive of a directory [using filepath.Walk()]. In this function, when I create the *tar.Header for a file, I set a value to *tar.Header.Typeflag.For example, if fi is a file's *os.FileInfo variable and hdr is the *tar.Header variable for that file's place in a new tar archive, it looks like this: In the tar package, the modes for hard links and regular files are distinct, TypeLink and TypeReg, but this isn't the case in the os package. So running this won't set the correct Typeflag: <code>  package mainfunc main() { filename := os.Args[1] var hardlink bool link, _ := os.Readlink(filename) fi, _ := os.Stat(filename) mode := string(fi.Mode().String()[0]) if link != """" && mode != ""L"" { hardlink = true } fmt.Printf(""%v is hard link? %v\n"", filename, hardlink)} if fi.Mode().IsDir() { hdr.Typeflag = tar.TypeDir} hdr.Mode = int64(fi.Mode())",Check whether a file is a hard link
Check whether a file is a hard link," How do you check whether a file is a hard link in Go? os.FileMode only has a mode for symlinks, not hard links.I had an idea that unfortunately doesn't work: This^ doesn't work because os.Readlink reads only symlinks, not hard links.I found a somewhat related answer:Counting hard links to a file in GoBut this answer shows how to find the number of hard links to a file, not whether a file itself is a hard link.I'm guessing that the syscall package used in that answer or, better yet, the sys package has a way to test whether a file's a hard link. Does anyone know to do this? (I have trouble understanding those packages because they're so low-level.)EDITI should add the reason why I'd like to check this. I'm trying to make a function to create a tar archive of a directory [using filepath.Walk()]. In this function, when I create the *tar.Header for a file, I set a value to *tar.Header.Typeflag.For example, if fi is a file's *os.FileInfo variable and hdr is the *tar.Header variable for that file's place in a new tar archive, it looks like this: In the tar package, the modes for hard links and regular files are distinct, TypeLink and TypeReg, but this isn't the case in the os package. So running this won't set the correct Typeflag: <code>  package mainfunc main() { filename := os.Args[1] var hardlink bool link, _ := os.Readlink(filename) fi, _ := os.Stat(filename) mode := string(fi.Mode().String()[0]) if link != """" && mode != ""L"" { hardlink = true } fmt.Printf(""%v is hard link? %v\n"", filename, hardlink)} if fi.Mode().IsDir() { hdr.Typeflag = tar.TypeDir} hdr.Mode = int64(fi.Mode())",Check whether a file is a hard link
Why should constructor of go return address?," I understand that Go doesn't have any constructors and a New func is used in its place, but according to this example. They always return &f. Why just simply returning File isn't suffice?UpdateI've tried returning the created object for a simple struct and it's fine. So, I wonder if returning an address is a standard way of constructor or something.Thanks. <code>  func NewFile(fd int, name string) *File { if fd < 0 { return nil } f := File{fd, name, nil, 0} return &f}",Why should constructor of Go return address?
Why does Go treat a Postgresql numeric & decimal columns as byte slices?," I'm not sure if this is a bug in Go or just something I don't understand. I have the following: This prints: So, I get []uint8 (e.g. a string) for the first two columns that are actually numbers. The last 2 columns are as expected. According to Postgresql Numeric & Decimal types are part of the SQL standard. So, why doesn't Go follow the SQL standard in their database/sql package? Is it because Go doesn't have a builtin ""Decimal"" type? It seems wrong that the database/sql package turned a number into a string because of a shortcoming in the language....  <code>  package mainimport ( ""database/sql"" ""log"" ""reflect"" _ ""github.com/lib/pq"")func main() { Db, err := sql.Open(""postgres"", ""user=yoitsme password=openupitsme host=x.x.x.x dbname=mydb"") if err != nil { log.Println(err) } rows, err := Db.Query(""SELECT 1.3250::numeric, 8.548::decimal, 908.234::float, 1234::integer"") defer rows.Close() for rows.Next() { var col1, col2, col3, col4 interface{} if err := rows.Scan(&col1, &col2, &col3, &col4); err != nil { log.Println(err) } log.Println(col1, reflect.TypeOf(col1)) log.Println(col2, reflect.TypeOf(col2)) log.Println(col3, reflect.TypeOf(col3)) log.Println(col4, reflect.TypeOf(col4)) } if err = rows.Err(); err != nil { log.Println(err) }} 2015/08/11 09:35:47 [49 46 51 50 53 48] []uint82015/08/11 09:35:47 [56 46 53 52 56] []uint82015/08/11 09:35:47 908.234 float642015/08/11 09:35:47 1234 int64",Why does Go treat a Postgresql numeric & decimal columns as []uint8?
Golang where is synchronization required," I defined a variable (r.something) inside an object while r.goroutine uses value stored in r.something with no synchronization.Nobody else is going to read/write this value except r.goroutine()Is it safe to do without synchronization?In other words: I want to reuse some variable from a goroutine initialized somewhere else before goroutine start. Is that safe?Additional question:After r.goroutine() finishes I want to be able to use r.something from somewhere else(without read/write overlap with other goroutines). Is it safe too? <code>  func (r *Runner) init() { r.something = make(map[string]int) r.something[""a""]=1 go r.goroutine()}",Is synchronization required?
With Golang how do I parse url parameters in the format of /id/123 not ?foo=bar, I'm trying to parse an URL like:http://example.com/id/123I've read through the net/url docs but it seems like it only parses strings likehttp://example.com/blah?id=123How can I parse the ID so I end up with the value of the id in the first example?This is not one of my own routes but a http string returned from an openid request. <code> ,How do I parse URLs in the format of /id/123 not ?foo=bar
With Go (golang) how do I parse URLs in the format of /id/123 not ?foo=bar, I'm trying to parse an URL like:http://example.com/id/123I've read through the net/url docs but it seems like it only parses strings likehttp://example.com/blah?id=123How can I parse the ID so I end up with the value of the id in the first example?This is not one of my own routes but a http string returned from an openid request. <code> ,How do I parse URLs in the format of /id/123 not ?foo=bar
Strip all whitespace from a string in golang," What is the fastest way to strip all whitespace from some arbitrary string in Go.I am chaining two function from the string package: Anyone have a better way to do this? <code>  response = strings.Join(strings.Fields(response),"""")",Strip all whitespace from a string
Go 1.5: imports runtime: C source files not allowed when not using cgo or SWIG," My program was building perfectly with go 1.4.2. After installing go 1.5, I am getting following error. imports runtime: C source files not allowed when not using cgo or SWIG: atomic_amd64x.c defs.c float.c heapdump.c lfstack.c malloc.c mcache.c mcentral.c mem_linux.c mfixalloc.c mgc0.c mheap.c msize.c os_linux.c panic.c parfor.c proc.c runtime.c signal.c signal_amd64x.c signal_unix.c stack.c string.c sys_x86.c vdso_linux_amd64.cThe error is not program dependent. Even a ""Hello world"" programs is throwing the same error. <code> ",Go 1.5+ : Error - imports runtime: C source files not allowed when not using cgo or SWIG
Go 1.5: Error - imports runtime: C source files not allowed when not using cgo or SWIG," My program was building perfectly with go 1.4.2. After installing go 1.5, I am getting following error. imports runtime: C source files not allowed when not using cgo or SWIG: atomic_amd64x.c defs.c float.c heapdump.c lfstack.c malloc.c mcache.c mcentral.c mem_linux.c mfixalloc.c mgc0.c mheap.c msize.c os_linux.c panic.c parfor.c proc.c runtime.c signal.c signal_amd64x.c signal_unix.c stack.c string.c sys_x86.c vdso_linux_amd64.cThe error is not program dependent. Even a ""Hello world"" programs is throwing the same error. <code> ",Go 1.5+ : Error - imports runtime: C source files not allowed when not using cgo or SWIG
Go : Error - imports runtime: C source files not allowed when not using cgo or SWIG," My program was building perfectly with go 1.4.2. After installing go 1.5, I am getting following error. imports runtime: C source files not allowed when not using cgo or SWIG: atomic_amd64x.c defs.c float.c heapdump.c lfstack.c malloc.c mcache.c mcentral.c mem_linux.c mfixalloc.c mgc0.c mheap.c msize.c os_linux.c panic.c parfor.c proc.c runtime.c signal.c signal_amd64x.c signal_unix.c stack.c string.c sys_x86.c vdso_linux_amd64.cThe error is not program dependent. Even a ""Hello world"" programs is throwing the same error. <code> ",Go 1.5+ : Error - imports runtime: C source files not allowed when not using cgo or SWIG
Go (reflect): How to discover all package types at runtime?," As far as I'm aware (see here, and here) there is no type discovery mechanism in the reflect package, which expects that you already have an instance of the type or value you want to inspect. Is there any other way to discover all exported types (especially the structs) in a running go package?Here's what I wish I had (but it doesn't exist): The end goal is to be able to discover all the structs of a package that meet certain criteria, then be able to instantiate new instances of those structs.BTW, a registration function that identifies the types is not a valid approach for my use case.Whether you think it's a good idea or not, here's why I want this capability (because I know you're going to ask):I've written a code generation utility that loads go source files and builds an AST to scan for types that embed a specified type. The output of the utility is a set of go test functions based on the discovered types. I invoke this utility using go generate to create the test functions then run go test to execute the generated test functions. Every time the tests change (or a new type is added) I must re-run go generate before re-running go test. This is why a registration function is not a valid option. I'd like to avoid the go generate step but that would require my utility to become a library that is imported by the running package. The library code would need to somehow scan the running namespace during init() for types that embed the expected library type. <code>  import ""time""import ""fmt""func main() { var types []reflect.Type types = reflect.DiscoverTypes(time) fmt.Println(types)}",How to discover all package types at runtime?
How to parse yaml with dyanmic key in Golang," I am trying to parse a YAML file with Go. The problem is that the keys in the YAML file might not always be the same. This is to do API versioning so the user can define the versions they support. For instance V1, V2, V3 etc. They do not need to be in order and can omit versions they don't support i.e, V0, V2, V5 etc. I saw a similar question asked hereThis is at the top level and I haven't quite figured out how to do this from inside the struct. <code>  package mainimport ( ""fmt"" ""gopkg.in/yaml.v2"")var data = `---development: skip-header-validation: true V1: current: ""1.0.0"" mime_types: - application/vnd.company.jk.identity+json; - application/vnd.company.jk.user+json; - application/vnd.company.jk.role+json; - application/vnd.company.jk.scope+json; - application/vnd.company.jk.test+json; skip-mime-type-validation: true skip-version-validation: true V2: current: ""2.0.0"" mime_types: - application/vnd.company.jk.identity+json; - application/vnd.company.jk.user+json; - application/vnd.company.jk.role+json; - application/vnd.company.jk.scope+json; - application/vnd.company.jk.test+json;`type MajorVersion struct { Current string `yaml:""current""` MimeTypes []string `yaml:""mime_types""` SkipVersionValidation bool `yaml:""skip-version-validation""` SkipMimeTypeValidation bool `yaml:""skip-mime-type-validation""`}type Environment struct { SkipHeaderValidation bool `yaml:""skip-header-validation""` Version map[string]MajorVersion}func main() { e := Environment{} yaml.Unmarshal([]byte(data), &e) fmt.Println(e)}",How to parse YAML with dynamic key in Golang
"Golang how to get the directory of the package the file is in, not the current working directory"," I'm making a package to make API calls to a service.I have a test package that I use just to test the API calls and test the functions of the main package which I just include the other package into.In my main package that I'm working on I have ioutil.ReadFile(filepath.Abs(""Filename.pub""))Which is ok, but when I call it from my test package e.g./Users/####/gocode/src/github.com/testfolder go run main.goit tells me panic: open /Users/####/gocode/src/github.com/testfolder/public.pub: no such file or directoryThe problem is, is it is looking for public.pub inside of testfolder instead of github.com/apipackage/ which is where it is.Just to clarify this mess of words:The API Package has a function that reads from the same directoryBut because I'm including the API package and Testfolder is the CWD when I go run main.go it is instead trying to get it from the testfolder instead even though the main.go doesn't have the function and is just including it. <code> ","How to get the directory of the package the file is in, not the current working directory"
"How can I create cloud.Context from ""appengine"".Context"," I can't figure out how to call cloud.WithContext and google.DefaultClient if I have appengine.Context and not context.Context. There are (old) ""appengine"" and (new) ""google.golang.org/appengine"" packages. The first one brings custom appengine.Context when second one comes with context.Context from ""golang.org/x/net/context""The whole google.golang.org/cloud expects context.Context only.I would be happy to move to using new ""google.golang.org/appengine"", but I've stuck with runtime.RunInBackground that have not been ported yet. From https://github.com/golang/appengine: appengine/aetest, appengine/cloudsql and appengine/runtime have not been ported yet.What I could write if appengine/runtime have been ported already: but there is no ""google.golang.org/appengine/runtime"" yet. So I have  <code>  import ( ""golang.org/x/net/context"" ""google.golang.org/appengine"" ""google.golang.org/appengine/runtime"" ""google.golang.org/cloud"" ""google.golang.org/cloud/storage"")func handler(w http.ResponseWriter, r *http.Request) { c := appengine.NewContext(r) runtime.RunInBackground(c, func(ctx context.Context) { hc, _ := google.DefaultClient(ctx, storage.ScopeFullControl) cc := cloud.WithContext(ctx, appengine.AppID(ctx), hc) })} runtime.RunInBackground(c, func(ctx appengine.Context) {",How can I create cloud context.Context from appengine.Context
how to get value of attribute href value in Golang," I want to parse anchor link from the html content./* My HTML Content Sample */The Anchor have href and i want to get the value of Href . But this is giving me error..Error: multiple-value s.Attr() in single-value context <code>  <a class=""productnamecolor colors_productname"" href=""http://www.cccxcxc.com/Nautical-Bubble-Romper-p/s15brpnt03.htm"">*/ <a class=""productnamecolor colors_productname"" href=""http://www.dewewe.com/Nautical-Bubble-Romper-p/erewrwer.htm""> <a class=""productnamecolor colors_productname"" href=""http://www.sdsddsd.com/Nautical-Bubble-Romper-p/dsadadasd.htm""> package main import ( ""fmt"" ""log"" ""github.com/PuerkitoBio/goquery"" ) func ExampleScrape() { doc, err := goquery.NewDocument(""http://www.myurl.com/category-s/1828.htm"") if err != nil { log.Fatal(err) } /* **my sample html after http open** <a class=""productnamecolor colors_productname"" href=""http://www.cccxcxc.com/Nautical-Bubble-Romper-p/s15brpnt03.htm"">*/ <a class=""productnamecolor colors_productname"" href=""http://www.dewewe.com/Nautical-Bubble-Romper-p/erewrwer.htm""> <a class=""productnamecolor colors_productname"" href=""http://www.sdsddsd.com/Nautical-Bubble-Romper-p/dsadadasd.htm""> ***/ doc.Find(""table.v65-productDisplay a.productnamecolor"").Each(func(i int, s *goquery.Selection) { band := s.Attr(""href"") // here i want to get attribute "" href "" value. this is not working here. fmt.Printf(band) }) } func main() { ExampleScrape() }",how to get value of attribute href value in Go language
how to get value of attribute href value in Go language.," I want to parse anchor link from the html content./* My HTML Content Sample */The Anchor have href and i want to get the value of Href . But this is giving me error..Error: multiple-value s.Attr() in single-value context <code>  <a class=""productnamecolor colors_productname"" href=""http://www.cccxcxc.com/Nautical-Bubble-Romper-p/s15brpnt03.htm"">*/ <a class=""productnamecolor colors_productname"" href=""http://www.dewewe.com/Nautical-Bubble-Romper-p/erewrwer.htm""> <a class=""productnamecolor colors_productname"" href=""http://www.sdsddsd.com/Nautical-Bubble-Romper-p/dsadadasd.htm""> package main import ( ""fmt"" ""log"" ""github.com/PuerkitoBio/goquery"" ) func ExampleScrape() { doc, err := goquery.NewDocument(""http://www.myurl.com/category-s/1828.htm"") if err != nil { log.Fatal(err) } /* **my sample html after http open** <a class=""productnamecolor colors_productname"" href=""http://www.cccxcxc.com/Nautical-Bubble-Romper-p/s15brpnt03.htm"">*/ <a class=""productnamecolor colors_productname"" href=""http://www.dewewe.com/Nautical-Bubble-Romper-p/erewrwer.htm""> <a class=""productnamecolor colors_productname"" href=""http://www.sdsddsd.com/Nautical-Bubble-Romper-p/dsadadasd.htm""> ***/ doc.Find(""table.v65-productDisplay a.productnamecolor"").Each(func(i int, s *goquery.Selection) { band := s.Attr(""href"") // here i want to get attribute "" href "" value. this is not working here. fmt.Printf(band) }) } func main() { ExampleScrape() }",how to get value of attribute href value in Go language
go 1.5 : go install remove binary file in current directory," Till Go 1.4.2 when i run go install after running go build, i could find binary file in my current folder. Hence following Linux command was working $ go build && go install && ./executableBut after installing go 1.5, when i run same command i get, -bash: ./executable: No such file or directoryand when i checked, there is no executable to find. Did go install behavior changed in Go 1.5? <code> ","go 1.5 : Is ""go install"" behaviour changed? Removing stale executables?"
returning value vs reference in go constructor," When building a simple object in go, what's the difference between these alternatives? <code>  func NewGender(value string) Gender { return Gender{strings.TrimSpace(value)}}func NewGender(value string) *Gender { return &Gender{strings.TrimSpace(value)}}",returning value vs pointer in Go constructor
Does convertions between aliast types in Go create a copies?," Example: Are ms or s2 a full copy of s (as it would be done with []byte(s))? Or they are just a string struct copies (which keeps the real value in a pointer)?What if we are passing this to a function? E.g.: <code>  type MyString string var s = ""very long string""var ms = MyString(s)var s2 = string(s) func foo(s MyString){ ...}foo(ms(s)) // do we copy s here?",Does conversion between alias types in Go create copies?
Does convertion between alias types in Go create copies?," Example: Are ms or s2 a full copy of s (as it would be done with []byte(s))? Or they are just a string struct copies (which keeps the real value in a pointer)?What if we are passing this to a function? E.g.: <code>  type MyString string var s = ""very long string""var ms = MyString(s)var s2 = string(s) func foo(s MyString){ ...}foo(ms(s)) // do we copy s here?",Does conversion between alias types in Go create copies?
golang appending to slice bad performance.. why?," I'm currently creating a game using GoLang. I'm measuring the FPS. I'm noticing about a 7 fps loss using a for loop to append to a slice like so: I'm doing this for every sprite, every draw. The question is why do I get such a huge performance hit with just looping for times and appending the same thing to these slices? Is there a more efficient way to do this? It is not like I'm adding exuberant amount of data. Each slice contains about 16 elements as shown above (4 x 4). When I simply put all 16 elements in one []float32{1..16} then fps is improved by about 4. Update: I benchmarked each append and it seems that each one takes 1 fps to perform.. That seems like a lot considering this data is pretty static.. I only need 4 iterations...Update: Added github repo https://github.com/Triangle345/GT <code>  vertexInfo := Opengl.OpenGLVertexInfo{}for i := 0; i < 4; i = i + 1 { vertexInfo.Translations = append(vertexInfo.Translations, float32(s.x), float32(s.y), 0) vertexInfo.Rotations = append(vertexInfo.Rotations, 0, 0, 1, s.rot) vertexInfo.Scales = append(vertexInfo.Scales, s.xS, s.yS, 0) vertexInfo.Colors = append(vertexInfo.Colors, s.r, s.g, s.b, s.a)}",Appending to slice bad performance.. why?
Accept function in argument with empty interface return type in Go," I would like to understand why the code snippet below does not compile. What is the Go way of accepting a function as a function argument that may have any return type? Play: https://play.golang.org/p/CqbuEZGy12My solution based on Volker's answer: Play: https://play.golang.org/p/waOGBZZwN7 <code>  package mainfunc main() { test(a) // Error: cannot use a (type func() string) as type func() interface {} in argument to test test(b) // Error: cannot use b (type func() int) as type func() interface {} in argument to test}func a() string { return ""hello""}func b() int { return 1}func test(x func() interface{}) { // some code... v := x() // some more code....} package mainimport ( ""fmt"")func main() { // Wrap function a and b with an anonymous function // that has an empty interface return type. With this // anonymous function, the call signature of test // can be satisfied without needing to modify the return // type of function a and b. test(func() interface{} { return a() }) test(func() interface{} { return b() })}func a() string { return ""hello""}func b() int { return 1}func test(x func() interface{}) { v := x() fmt.Println(v) }",Accept function in argument with empty interface return type
How would I go about converting uint64 into uint in golang?," I have the following function: But I get the following error: I've tried a few different functions from the strconv lib with no luck!  <code>  func (rc ResizeController) Resize(c *gin.Context) { height := c.Query(""height"") width := c.Query(""width"") filepath := c.Query(""file"") h, err := strconv.ParseUint(height, 10, 32) w, err := strconv.ParseUint(width, 10, 32) file, err := os.Open(""./test_images/"" + filepath) if err != nil { log.Fatal(err) } image, err := jpeg.Decode(file) if err != nil { log.Fatal(err) } m := resize.Resize(1000, 100, image, resize.Lanczos3) buf := new(bytes.Buffer) jpeg.Encode(buf, m, nil) response := buf.Bytes() c.Data(200, ""image/jpeg"", response)} controllers/resize_controller.go:41: cannot use h (type uint64) as type uint in argument to resize.Resizecontrollers/resize_controller.go:41: cannot use w (type uint64) as type uint in argument to resize.Resize",How to convert a uint64 into uint?
Derefence a pointer inside struct, How do I change value of *IsEnabled = trueNone of these work:  <code>  type MyStruct struct { IsEnabled *bool} *(MyStruct.IsEnabled) = true*MyStruct.IsEnabled = trueMyStruct.*IsEnabled = true,Reference a boolean for assignment in a struct
How to verify if a specific function is called in Golang, I'm trying my hand at writing TDD in Go. I am however stuck at the following.The test to write: Implementation to test: How would one test this simple bit? I figured I only wanted to verify that the exec library is spoken to correctly. That's the way I would do it in Java using Mockito. Can anyone help me write this test? From what I've read the usage of interfaces is suggested.The Feature-struct only contains a string Cmd. <code>  func TestFeatureStart(t *testing.T) {} func (f *Feature) Start() error { cmd := exec.Command(f.Cmd) cmd.Start()},How to verify if a specific function is called
Go RPC - Call is fine locally - marshalling issue when using RPC," I have some code I've been dumped with and am actually stumped - I've worked with RPC and the JSON side of things before but I can't seem to get it to work over RPC when it works fine locally. (also here but no tcp available urgh! http://play.golang.org/p/HmK-K09D2J )The output is pretty surprising as it indicates something going wrong with the marshalling rather than with the actual data - Running it in wireshark I can see the data being sent in the correct form (I had success using a similar technique in another question) but can't for the life of me get this to stop throwing marshalling bugs.The output from running this is as follows: Am I missing an interface/type trick or is this a bug in Go's marshalling? <code>  package mainimport ( ""log"" ""net"" ""net/rpc"" ""net/rpc/jsonrpc"" ""reflect"")type Foo interface { SayHello() error}type fakeFoo struct { internalValue string}func NewFakeFoo() *fakeFoo { f := &fakeFoo{} f.internalValue = ""123456789012347"" return f}func (m *fakeFoo) SayHello() error { return nil}type FooManager struct { availableFoos []Foo}func NewFooManager() *FooManager { p := new(FooManager) p.availableFoos = make([]Foo, 0) return p}func AddFoo(mm *FooManager, m Foo) { mm.availableFoos = append(mm.availableFoos, m) log.Println(""Added type "", reflect.TypeOf(m))}func (mm *FooManager) GetAvailableFoos(in []Foo, out *[]Foo) error { log.Println(""availableFoos:"", reflect.TypeOf(mm.availableFoos)) log.Println(""*out is"", reflect.TypeOf(*out)) *out = append(in, mm.availableFoos...) log.Println(""Out is:"", reflect.TypeOf(*out)) return nil}func startServer(mm *FooManager) { server := rpc.NewServer() server.Register(mm) l, e := net.Listen(""tcp"", "":8222"") if e != nil { log.Fatal(""listen error:"", e) } for { conn, err := l.Accept() log.Println(""Incoming!"") if err != nil { log.Fatal(err) } go server.ServeCodec(jsonrpc.NewServerCodec(conn)) }}func main() { fake1 := NewFakeFoo() fooHolder := NewFooManager() AddFoo(fooHolder, fake1) go startServer(fooHolder) log.Println(""Using standard function call"") var foos []Foo fooHolder.GetAvailableFoos(foos, &foos) log.Println(foos) log.Println(""Using RPC call"") conn, err := net.Dial(""tcp"", ""localhost:8222"") if err != nil { log.Fatalln(err) } defer conn.Close() c := jsonrpc.NewClient(conn) err = c.Call(""FooManager.GetAvailableFoos"", foos, &foos) if err != nil { log.Println(foos) log.Fatal(""GetAvailableFoos error:"", err) } log.Println(""Success: "", foos)} 2015/09/07 10:04:35 Added type *main.fakeFoo2015/09/07 10:04:35 Using standard function call2015/09/07 10:04:35 availableFoos: []main.Foo2015/09/07 10:04:35 *out is []main.Foo2015/09/07 10:04:35 Out is: []main.Foo2015/09/07 10:04:35 [0x1870a540]2015/09/07 10:04:35 Using RPC call2015/09/07 10:04:35 Incoming!2015/09/07 10:04:35 [0x1870a540]2015/09/07 10:04:35 GetAvailableFoos error:json: cannot unmarshal object into Go value of type main.Fooexit status 1",Unmarshal to a interface type
What is stadard defer/finalizer implementation in C++?," General idea of Golang-style defer is explained here and here.I wonder, does STL (of C++11, C++14, ...) or maybe Boost or maybe some other library contain implementation of such a class? So I could just use it without reimplementing it in every new project. <code> ",What is standard defer/finalizer implementation in C++?
Golang: How to get directory total size?," So I am trying to get total size of a directory using Go. So far I have this: The question is whether the dirSize global variable is going to cause problems and if it does, how do I move it to the scope of the DirSizeMB function? <code>  var dirSize int64 = 0func readSize(path string, file os.FileInfo, err error) error { if !file.IsDir() { dirSize += file.Size() } return nil} func DirSizeMB(path string) float64 { dirSize = 0 filepath.Walk(path, readSize) sizeMB := float64(dirSize) / 1024.0 / 1024.0 sizeMB = Round(sizeMB, .5, 2) return sizeMB}",How to get directory total size?
"Why does go forbid taking the address of (&) map member, yet allows (&) slice element"," Go doesn't allow taking the address of a map member: The rationale is that if Go allows taking this address, when the map backstore grows or shinks, the address can become invalid, confusing the user.But Go slice gets relocated when it outgrows its capacity, yet, Go allows us to take the address of a slice element: Why is Go designed like this? What is special about taking address of slice element? <code>  // if I do this:p := &mm[""abc""]// Syntax Error - cannot take the address of mm[""abc""] a := make([]Test, 5) a[0] = Test{1, ""dsfds""} a[1] = Test{2, ""sdfd""} a[2] = Test{3, ""dsf""} addr1 := reflect.ValueOf(&a[2]).Pointer() fmt.Println(""Address of a[2]: "", addr1) a = append(a, Test{4, ""ssdf""}) addrx := reflect.ValueOf(&a[2]).Pointer() fmt.Println(""Address of a[2] After Append:"", addrx) // Note after append, the first address is invalid Address of a[2]: 833358258224 Address of a[2] After Append: 833358266416","Why does Go forbid taking the address of (&) map member, yet allows (&) slice element?"
"Why does go forbid taking the address of (&) map member, yet allows (&) slice element?"," Go doesn't allow taking the address of a map member: The rationale is that if Go allows taking this address, when the map backstore grows or shinks, the address can become invalid, confusing the user.But Go slice gets relocated when it outgrows its capacity, yet, Go allows us to take the address of a slice element: Why is Go designed like this? What is special about taking address of slice element? <code>  // if I do this:p := &mm[""abc""]// Syntax Error - cannot take the address of mm[""abc""] a := make([]Test, 5) a[0] = Test{1, ""dsfds""} a[1] = Test{2, ""sdfd""} a[2] = Test{3, ""dsf""} addr1 := reflect.ValueOf(&a[2]).Pointer() fmt.Println(""Address of a[2]: "", addr1) a = append(a, Test{4, ""ssdf""}) addrx := reflect.ValueOf(&a[2]).Pointer() fmt.Println(""Address of a[2] After Append:"", addrx) // Note after append, the first address is invalid Address of a[2]: 833358258224 Address of a[2] After Append: 833358266416","Why does Go forbid taking the address of (&) map member, yet allows (&) slice element?"
How to convert from a Unicode to another Unicode in Go lang?, I'm working on a project where I need to convert text from an encoding (for example Windows-1256 Arabic) to UTF-8.How do I do this in Go? <code> ,How to convert from an encoding to UTF-8 in Go?
How to convert from an Encoding to another Unicode in Go lang?, I'm working on a project where I need to convert text from an encoding (for example Windows-1256 Arabic) to UTF-8.How do I do this in Go? <code> ,How to convert from an encoding to UTF-8 in Go?
what is the difference between the string and []byte in golang," what is the difference between the string and []byte in Go?When to use ""he"" or ""she""?Why? helloThe output is just ""hello"", and lack of 127, sometimes I feel that it's weird. <code>  s := ""some string""b := []byte(s) // convert string -> []bytes2 := string(b) // convert []byte -> string bb := []byte{'h','e','l','l','o',127}ss := string(bb)fmt.Println(ss)",What is the difference between the string and []byte in Go?
Golang main difference from CSP-Languge by Hoare," Look at this statement taken from The examples from Tony Hoare's seminal 1978 paper: Go's design was strongly influenced by Hoare's paper. Although Go differs significantly from the example language used in the paper, the examples still translate rather easily. The biggest difference apart from syntax is that Go models the conduits of concurrent communication explicitly as channels, while the processes of Hoare's language send messages directly to each other, similar to Erlang. Hoare hints at this possibility in section 7.3, but with the limitation that ""each port is connected to exactly one other port in another process"", in which case it would be a mostly syntactic difference. I'm confused.Processes in Hoare's language communicate directly to each other. Go routines communicate also directly to each other but using channels.So what impact has the limitation in golang. What is the real difference? <code> ",Golang main difference from CSP-Language by Hoare
Go : When will json.Unmarshall to struct return error?," Assume i have a struct like Then in main i have code apparently the code above produce a nil error, regardless the json format is different. When will json.Unmarshal() return error in Go? <code>  type A struct{ name string`json:""name""`} var jsonString string = `{""status"":false}`var a Aerror := json.Unmarshal([]byte(jsonString),&a)",Go : When will json.Unmarshal to struct return error?
What is the best way to check for empty body in Go lang," From the documentation it states that For server requests the Request Body is always non-nil but will return EOF immediately when no body is present.For ContentLength, the documentation states For client requests, a value of 0 means unknown if Body is not nil.So is it better to check for ContentLength or to check EOF <code>  r *http.Requestif r.ContentLength == 0 { //empty body} type Input struct { Name *string `json:""name""`}input := new(Input)if err := json.NewDecoder(r.Body).Decode(input); err.Error() == ""EOF"" { //empty body}",What is the best way to check for empty request Body?
Go: How can I start the browser AFTER the server started listening?," In Go, how can I start the browser AFTER the server started listening?Preferably the simplest way possible.My code so far, super dumbed down to the point: <code>  package mainimport ( // Standard library packages ""fmt"" ""net/http"" ""github.com/skratchdot/open-golang/open"" // Third party packages ""github.com/julienschmidt/httprouter"")// go get github.com/toqueteos/webbrowserfunc main() { // Instantiate a new router r := httprouter.New() // Add a handler on /test r.GET(""/test"", func(w http.ResponseWriter, r *http.Request, _ httprouter.Params) { // Simply write some test data for now fmt.Fprint(w, ""Welcome!\n"") }) //open.Run(""https://google.com/"") // open.Start(""https://google.com"") // http://127.0.0.1:3000/test // Fire up the server http.ListenAndServe(""localhost:3000"", r) fmt.Println(""ListenAndServe is blocking"") open.RunWith(""http://localhost:3000/test"", ""firefox"") fmt.Println(""Done"")}",How can I start the browser AFTER the server started listening?
How to get all dependency files for a program using Golang," I make a program in Go and after completing the code, if I want to run this code on other pc or VM, then it does not get all the dependency package files. How can I get all dependency files? <code> ",How to get all dependency files for a program
Go Scheduler who fills the local runqueue of P," Look at this well known image taken from morsmachine.dk/go-scheduler The gray lists are local runqueues of P. If this queue get empty they will be filled with go routines from the global runqueue.The Question is, who fills the local runqueue of P? Scheduler, without synchronisation or every P do it for himself (mutex)? P.S. The article omits this information. <code> ",Go Scheduler who fills the local runqueue of P?
Golang destructors?," I know there are no destructors in Go since technically there are no classes. As such, I use initClass to perform the same functions as a constructor. However, is there any way to create something to mimic a destructor in the event of a termination, for the use of, say, closing files? Right now I just call defer deinitClass, but this is rather hackish and I think a poor design. What would be the proper way? <code> ",Go destructors?
Do we need to close response object in case of error while calling http.Get(url)," In the following code is it also necessary to close the response body in the error case: <code>  res, err := http.Get(url)if err != nil { log.Printf(""Error: %s\n"", err)}defer res.Body.Close()",Do we need to close the response object if an error occurs while calling http.Get(url)?
How to replicate do while in golang?," I want a set of code to be executed until user explicitly wants to exit the function. For eg: when a user runs the program, he will see 2 options:Run again Exitthis will be achieved using switch case structure. Here if user presses 1, set of functions associated with 1 will execute and if user presses 2, the program will exit. How should i achieve this scenario in golang ? In java, i believe this could be done using do while structure but go doesn't support do while loop. Following is my code which i tried but this goes in a infinite loop: The program irrespective of the input, prints only ""hi"". Could someone please correct me what wrong i am doing here ?Thanks. <code>  func sample() { var i = 1 for i > 0 { fmt.Println(""Press 1 to run"") fmt.Println(""Press 2 to exit"") var input string inpt, _ := fmt.Scanln(&input) switch inpt { case 1: fmt.Println(""hi"") case 2: os.Exit(2) default: fmt.Println(""def"") } }}",How to replicate do while in go?
"Please explain &, and * pointers in GoLang"," There have been multiple instances where the compiler throws an error when I try to pass variables as arguments inside Go functions. I've been able to debug this sometimes by using a pointer in front of the variable. Both &, and * pointers seem to clear the error. Though, I'd like to understand why. I'm wondering what the difference between &, and * is, and when each should be used. Thank you! <code>  func (ctx *NewContext) SendNotification(rw http.ResponseWriter, req *http.Request, p httprouter.Params) { decoder := json.NewDecoder(req.Body) var u User if err := decoder.Decode(&u); err != nil { http.Error(rw, ""could not decode request"", http.StatusBadRequest) return }}","Please explain &, and * pointers"
Read Encrypted PKCS8 Key," I'm trying to read an encrypted PKCS8 private key file. I generated the keys like this: And I try reading it in Go this way: But I get an error saying: However, I can't figure out what's going wrong. Am I generating the key wrong or am I using the wrong library? I see libraries specifically for reading unencrypted PKCS8 files but none for encrypted PKCS8 files specifically.Does anyone have any idea? <code>  openssl genrsa -out file.pem -passout pass:file -aes256 1024openssl pkcs8 -topk8 -inform pem -in file.pem -outform pem -out filePKCS8.pem block, _ := pem.Decode(key)return x509.DecryptPEMBlock(block, password) x509: no DEK-Info header in block","""No DEK-Info header in block"" when attempting to read encrypted private key"
Named vs Unnamed Types," The problem:I recently started reading the Golang Specification Manual and got stuck trying to understand the named and unnamed types in the relevant section. I come from a dynamic language and this has given me a bit of a headache.The manual states: A type determines the set of values and operations specific to values of that type. Types may be named or unnamed. Named types are specified by a (possibly qualified) type name; unnamed types are specified using a type literal, which composes a new type from existing types.And continues: Named instances of the boolean, numeric, and string types are predeclared. Composite typesarray, struct, pointer, function, interface, slice, map, and channel typesmay be constructed using type literals.The problem here is that with the specification, the links make me jump around the pages and lose track of what is what with so many concepts thrown at me too fast.Other Resources:I have searched around for clarification on this and, other than the specification manual, resources are scarce. The only relevant material I could locate was:Learning Go - Types - blog-post explaining nuances of the Type System in Go.An issue here about pretty much the same thing I'm asking.Unfortunately, I couldn't find any relevant questions on Stack Overflow regarding this. (and if they exist, I need to revise my search methods!). I'm asking because understanding the type system of a new language is one of the basic concepts in order to efficiently learn it. So, the question:Can somebody present a concise, clear example illustrating the differences between the concepts of named and unnamed types?* *Additionally, explaining the concepts of qualified and pre-declared would be good for completeness but obviously not necessary.  <code> ",Named and Unnamed Types
Array of Objects in golang," I have a requirement in which I need to store array of objects in a variable. The objects are of different types. Refer to following example: Notice the second element is array of string itself. After research, I thought of storing this as interface type like: Still, I am getting few compilation errors which I am not able to find out. <code>  v := [ {""name"":""ravi""}, [""art"",""coding"",""music"",""travel""], {""language"":""golang""}, {""experience"":""no""} ] var v interface{} = [ {""name"":""ravi""}, [""art"",""coding"",""music"",""travel""], {""language"":""golang""}, {""experience"":""no""} ]",How to create array of objects in golang?
How to get the stack trace pointing to actual error reason in Golang?," Let's say I have some code like this: In case err != nil I will get something like this: This stack trace is completely legit but sometimes these error messages may not clarify what happened and so I'd like to dig deeper into the source code of the 3rd party library to investigate what exactly causes this error to be returned. However when my code panics like this, there is no way to get the actual place that returned this error.A little bit more clarification: as I'm coming from JVM world where exceptions are thrown I can completely trace what exactly line of code thrown the exception and thus can easily find the place and see what gone wrong. Go stack trace ends exactly where my code panics and thus not too useful in my case.I've created a playground here and ideally I'd like to be able to trace the error to the place it was actually returned from, not panic. (e.g. to line 17, return """", errors.New(""some error explanation here""))Is this even possible? <code>  value, err := some3rdpartylib.DoSomething()if err != nil { panic(err)} panic: some error explanation heregoroutine 1 [running]:main.main() /tmp/blabla/main.go:6 +0x80",How to get the stack trace pointing to actual error reason
How to get number of rows by select query using mysql in go lang," I'm new in golang. I want to create a login verification from MySQL db.I want a method like as in PHP mysqli_num_rows($res) == 1...I tried len(rows) or rows.Column() @fmt.Println(""No of rows are :"", rows) but it won't...The code which i tried ... (It is a dummy code) If you have another solution for login verification purpose then kindly suggest and explain it briefly Kindly help me out. <code>  rows, err := db.Query(""select * from userLog where u_name = ? and u_pass = ?"", uname, pswd)if err != nil { log.Fatal(err)}fmt.Println(""No of rows are :"", rows)defer rows.Close()",How to get number of rows by select query using mysql
How can I work with sql NULL values and JSON in Golang in a good way?," Go types like Int64 and String cannot store null values,so I found I could use sql.NullInt64 and sql.NullString for this.But when I use these in a Struct,and generate JSON from the Struct with the json package,then the format is different to when I use regular Int64 and String types.The JSON has an additional level because the sql.Null*** is also a Struct.Is there a good workaround for this,or should I not use NULLs in my SQL database? <code> ",How can I work with SQL NULL values and JSON in a good way?
How can I work with SQL NULL values and JSON in Golang in a good way?," Go types like Int64 and String cannot store null values,so I found I could use sql.NullInt64 and sql.NullString for this.But when I use these in a Struct,and generate JSON from the Struct with the json package,then the format is different to when I use regular Int64 and String types.The JSON has an additional level because the sql.Null*** is also a Struct.Is there a good workaround for this,or should I not use NULLs in my SQL database? <code> ",How can I work with SQL NULL values and JSON in a good way?
How can I create an array that containing uniq strings," I want to create an array that contains unique strings. How can I do that? <code>  var paths = make([]string, 0)func main() { // Members are added dynamically paths = append(paths, ""aaa"") paths = append(paths, ""bbb"") paths = append(paths, ""bbb"") paths = append(paths, ""ccc"") // convert [""aaa"", ""bbb"", ""bbb"", ""ccc""] -> [""aaa"", ""bbb"", ""ccc""] // or can I use some class that disallow the same string automaticaly?}",How can I create an array that contains unique strings?
How can I create an array that containing uniqe strings?," I want to create an array that contains unique strings. How can I do that? <code>  var paths = make([]string, 0)func main() { // Members are added dynamically paths = append(paths, ""aaa"") paths = append(paths, ""bbb"") paths = append(paths, ""bbb"") paths = append(paths, ""ccc"") // convert [""aaa"", ""bbb"", ""bbb"", ""ccc""] -> [""aaa"", ""bbb"", ""ccc""] // or can I use some class that disallow the same string automaticaly?}",How can I create an array that contains unique strings?
How can I create an array that containing unique strings?," I want to create an array that contains unique strings. How can I do that? <code>  var paths = make([]string, 0)func main() { // Members are added dynamically paths = append(paths, ""aaa"") paths = append(paths, ""bbb"") paths = append(paths, ""bbb"") paths = append(paths, ""ccc"") // convert [""aaa"", ""bbb"", ""bbb"", ""ccc""] -> [""aaa"", ""bbb"", ""ccc""] // or can I use some class that disallow the same string automaticaly?}",How can I create an array that contains unique strings?
What could happen if I don't close response.Body in golang?," In Go, I have some http responses and I sometimes forget to call: What happens in this case? will there be a memory leak? Also is it safe to put in defer resp.Body.Close() immediately after getting the response object? What if there is an error, could resp or resp.Body be nil?  <code>  resp.Body.Close() client := http.DefaultClientresp, err := client.Do(req)defer resp.Body.Close()if err != nil { return nil, err}",What could happen if I don't close response.Body?
Listen for raw ICMP Packets," I'm working on a two part application where one side sends ICMP packets and the other side listens for the ICMP packets and takes action when it receives them. The problem is, I'm not sure how to keep the listener alive indefinitely (just want it sitting there in a loop only taking action when it receives a packet).Currently, I'm able to use the go-fastping library and can send and receive packets if it's a two way communication (I send it, they respond, I process the remote response). The question is how do I make this asymmetrical?My attempt at a listener was: but this doesn't work. My logic here was that I want a while true loop to keep the listener alive (in this case that's the for {), then I listen for new packets with ICMP's ListenPacket but I don't seem to be getting anything using this approach. Any ideas or help would be greatly appreciated. Thanks in advance for your time and assistance. <code>  for { conn, err := icmp.ListenPacket(""ip4:icmp"", ""192.168.1.8"") if err != nil { fmt.Println(err) }}",How to listen for ICMP packets?
Listen for raw ICMP Packets in Golang," I'm working on a two part application where one side sends ICMP packets and the other side listens for the ICMP packets and takes action when it receives them. The problem is, I'm not sure how to keep the listener alive indefinitely (just want it sitting there in a loop only taking action when it receives a packet).Currently, I'm able to use the go-fastping library and can send and receive packets if it's a two way communication (I send it, they respond, I process the remote response). The question is how do I make this asymmetrical?My attempt at a listener was: but this doesn't work. My logic here was that I want a while true loop to keep the listener alive (in this case that's the for {), then I listen for new packets with ICMP's ListenPacket but I don't seem to be getting anything using this approach. Any ideas or help would be greatly appreciated. Thanks in advance for your time and assistance. <code>  for { conn, err := icmp.ListenPacket(""ip4:icmp"", ""192.168.1.8"") if err != nil { fmt.Println(err) }}",How to listen for ICMP packets?
Why is it common to have struct members be pointers in Golang?," Take, for example, the go github package. Just about every member of every struct defined is a pointer to a value rather than a value.Is this idiomatic Go? Why?I understand that it reduces the size of the struct (assuming the size of the pointer is less than the size of the value it points to) which may important if you are passing around structs by value a lot. But why not have a struct of values and pass the struct by pointer instead? <code> ",Is it common to have struct members be pointers?
Is it common to have struct members be pointers in Golang?," Take, for example, the go github package. Just about every member of every struct defined is a pointer to a value rather than a value.Is this idiomatic Go? Why?I understand that it reduces the size of the struct (assuming the size of the pointer is less than the size of the value it points to) which may important if you are passing around structs by value a lot. But why not have a struct of values and pass the struct by pointer instead? <code> ",Is it common to have struct members be pointers?
Golang remove all contents of a directory," I'm new to Go and can't seem to find a way to delete all the contents of a directory when I don't know the contents.I've tried: but get remove *: no such file or directory or invalid argument.And of course if you do: it deletes the tmp directory as well. Which is not what I want. <code>  os.RemoveAll(""/tmp/*"")os.Remove(""/tmp/*"") os.RemoveAll(""/tmp/"")",How to remove all contents of a directory using Golang?
Golang : Storing Sql result sets in a nested struct and omit if empty," I am trying to store SQL query dataset in a struct and display in JSON. I have almost done it. Now the problem is if the result set of nested structs is empty then I would not like to display it. Same problem specified here but using a pointer ends in a panic when scanning may be because I am using &user.Profile.Firstname 2015/11/01 16:42:16 Panic recovery -> runtime error: invalid memory address or nil pointer dereferenceIf I remove the pointer then everything works fine just the empty field remains. I am confused how to achieve this. Output: <code>  package mainimport ( ""database/sql"" ""github.com/gin-gonic/gin"" _ ""github.com/go-sql-driver/mysql"" ""log"")type User struct { Id int64 Username string Email string Profile Profile `json:"",omitempty""`}type Profile struct { Id int64 `json:"",omitempty""` UserId int64 `json:"",omitempty""` Firstname *string `json:"",omitempty""` Lastname *string `json:"",omitempty""`}var DB *sql.DBfunc checkErr(err error, msg string) { if err != nil { log.Fatal(msg, err) }}func main() { DB, _ = sql.Open(""mysql"", ""username:secrect@/database"") defer DB.Close() r := gin.Default() v1 := r.Group(""api/v1/"") { v1.GET(""users"", GetUsers) } r.Run("":8080"")}func GetUsers(c *gin.Context) { stmt, err := DB.Query(""Select users.id, username , email , firstname , lastname from users left join profiles on users.id = profiles.user_id "") if err != nil { panic(err.Error()) } defer stmt.Close() users := []User{} for stmt.Next() { var user User err := stmt.Scan(&user.Id, &user.Username, &user.Email, &user.Profile.Firstname, &user.Profile.Lastname) if err != nil { panic(err.Error()) } users = append(users, user) } c.JSON(200, &users)} { ""Id"": 1, ""Username"": ""test1"", ""Email"": ""test1@example.com"", ""Profile"": { ""Firstname"": ""John"", ""Lastname"": ""Doe"" }},{ ""Id"": 2, ""Username"": ""test2"", ""Email"": ""test2@example.com"", ""Profile"": { }},",Storing Sql result sets in a nested struct and omit if empty
Return different specialised implementations of interfaces from the same function in Go lang," I'm have a few data structures which are similar with some unique fields to each. They all implement the same behavioural interface (DataPoint). Therefore their processing can be done once while exchanging the type of each structure and operating on it via the methods defined in the interface. I wanted to have a function return me the empty data struct for each type based on some criteria. However, I can't seem to compile this as if my function returns the interface by signature but actually returns an implementation, it complains. Here's a simplified example and playground sample of what I mean:https://play.golang.org/p/LxY55BC59D The compilation produces:  <code>  package mainimport ""fmt""type DataPoint interface { Create() }type MetaData struct { UniqueId string AccountId int UserId int}type Conversion struct { Meta MetaData Value int}func (c *Conversion) Create() { fmt.Println(""CREATE Conversion"")}type Impression struct { Meta MetaData Count int}func (i *Impression) Create() { fmt.Println(""CREATE Impression"")} func getDataPoint(t string) DataPoint { if t == ""Conversion"" { return &Conversion{} } else { return &Impression{} }}func main() { meta := MetaData{ UniqueId: ""ID123445X"", AccountId: 1, UserId: 2, } dpc := getDataPoint(""Conversion"") dpc.Meta = meta dpc.Value = 100 dpc.Create() fmt.Println(dpc) dpi := getDataPoint(""Impression"") dpi.Meta = meta dpi.Count = 42 dpi.Create() fmt.Println(dpi)} prog.go:51: dpc.Meta undefined (type DataPoint has no field or method Meta)prog.go:52: dpc.Value undefined (type DataPoint has no field or method Value)prog.go:58: dpi.Meta undefined (type DataPoint has no field or method Meta)prog.go:59: dpi.Count undefined (type DataPoint has no field or method Count)",Return different specialised implementations of interfaces from the same function
Replace negative lookahead," I'm trying to write a regex that can extract a command, here's what I've got so far using a negative lookbehind assertion: So with the input: foo bar baz is extracted every time. See working example https://regex101.com/r/lF9aG7/3In Go however this doesn't compile http://play.golang.org/p/gkkVZgScS_It throws: I did a bit of research and realized negative lookbehinds are not supported in the language to guarantee O(n) time.How can I rewrite this regex so that it does the same without negative lookbehind? <code>  \b(?<![@#\/])\w.* /msg @nickname #channel foo bar baz/foo #channel @nickname foo bar baz foo bar baz panic: regexp: Compile(`\b(?<![@#\/])\w.*`): error parsing regexp: invalid or unsupported Perl syntax: `(?<`",How to simulate negative lookbehind in Go
Replace negative lookbehind," I'm trying to write a regex that can extract a command, here's what I've got so far using a negative lookbehind assertion: So with the input: foo bar baz is extracted every time. See working example https://regex101.com/r/lF9aG7/3In Go however this doesn't compile http://play.golang.org/p/gkkVZgScS_It throws: I did a bit of research and realized negative lookbehinds are not supported in the language to guarantee O(n) time.How can I rewrite this regex so that it does the same without negative lookbehind? <code>  \b(?<![@#\/])\w.* /msg @nickname #channel foo bar baz/foo #channel @nickname foo bar baz foo bar baz panic: regexp: Compile(`\b(?<![@#\/])\w.*`): error parsing regexp: invalid or unsupported Perl syntax: `(?<`",How to simulate negative lookbehind in Go
"Using GORM, is there a way for me to set a default value as a PostgreSQL function?"," I want something like: Is this possible with GORM? <code>  type User struct { ID int `sql:""default:<myfunction>""`}",How to set a PostgreSQL function as default value in GORM?
How can I convert from int to hex in Golang?," I want to convert from int to hex in Golang.In strconv, there is a method that converts strings to hex. Is there a similar method to get a hex string from an int? <code> ",How can I convert from int to hex
Golang Method Sets (Pointer vs Value Receiver)," I am having a hard time understanding as to why are these rules associated with method set of pointer type .vs. value typeCan someone please explain the reason (from the interface table perspective)(Snippet from William Kennedy's blog) Snippet from specification Method setsA type may have a method set associated with it. The method set of an interface type is its interface. The method set of any other type T consists of all methods declared with receiver type T. The method set of the corresponding pointer type *T is the set of all methods declared with receiver *T or T (that is, it also contains the method set of T). Further rules apply to structs containing anonymous fields, as described in the section on struct types. Any other type has an empty method set. In a method set, each method must have a unique non-blank method name.The method set of a type determines the interfaces that the type implements and the methods that can be called using a receiver of that type. <code>  Values Methods Receivers-----------------------------------------------T (t T)*T (t T) and (t *T)Methods Receivers Values-----------------------------------------------(t T) T and *T(t *T) *T",Method Sets (Pointer vs Value Receiver)
Golang - Difference between &Struct{} vs Struct{}," Is there a reason why I should create a struct using &StructName{} instead of Struct{}? I see many examples using the former syntax, even in the Effective Go Page but I really can not understand why.Additional Notes:I'm not sure whether I explained my problem well with these two approaches so let me refine my question.I know that by using the & I will recieve a pointer instead of a value however I would like to know why would I use the &StructName{} instead of the StructName{}. For example, is there any benefits of using: instead of: <code>  func NewJob(command string, logger *log.Logger) *Job { return &Job{command, logger}} func NewJob(command string, logger *log.Logger) Job { return Job{command, logger}}",Difference between &Struct{} vs Struct{}
Go cross-compilation with 1.5.x - output file is overriden, I'm using go 1.5 and I'm cross compiling like specified here.The problem is that when compiling the project it will override the binary the last compilation created. Moreover - I will never know which OS/ARCH the executable file that I'm running was compiled to (in any case that is not windows).Is there a way to rename the file at compile command?  <code> ,Go cross-compilation with 1.5.x - output file is overridden
What is the difference between *string and string in Golang?," Aim: understanding the difference between *string and string in GolangAttempt results in: but when the *string is assigned to a string: it is able to print the string again: QuestionsWhy is a *string != string, e.g. display of: ""root"" vs.%!q(*string=0xc8200781f0)? In what other cases should a *string beused instead of a string and why? Why is it possible to assign a*string to a string variable, while the display of the string is different, e.g. display of: ""root"" vs.%!q(*string=0xc8200781f0)? <code>  func passArguments() { username := flag.String(""user"", ""root"", ""Username for this server"") flag.Parse() fmt.Printf(""Your username is %q."", *username) fmt.Printf(""Your username is %q."", username)} Your username is ""root"".Your username is %!q(*string=0xc820072200) bla:=*usernamefmt.Printf(""Your username is %q."", bla) Your username is ""root"".Your username is %!q(*string=0xc8200781f0).Your username is ""root"".",What are the differences between a *string and a string in Golang?
Convert Uint32 to int in Go," How do I convert a uint32 into an int in Go?A little background, I'm reading from a file and this gives me the correct size from a byte array like this: However, the bufio.Discard func expects an int. I was able to use fmt to convert size to a string and then use strconv to get it to an int. There has to be a more elegant way to do this. <code>  size := binary.BigEndian.Uint32(b[4:])",Convert uint32 to int in Go
golang tool pprof not working properly," I've previously used the pprof tool without issue and it worked great - now I see output like the following no matter what I profile:the application being profiled in this example probably makes 40+ function calls and even more complex apps are producing similar callgraphs for both cpu and memprofiling.The apps Im trying to profile are all web applications, I am profiling them for one minute at a time and using wrk to generate 200,000,000+ requests = all returning data and a 2xx responsepprof suddenly stopped working a few days ago running osx yosemite - in an attempt to resolve the issue I recently upgraded to el capitan but result is the same.Note: this is not just call graphs - calling list or top command produce similarly barren results but the apps themselves work fine: I am using the following package: ""github.com/davecheney/profile"" with go v1.5.1For clarity, here's what I'm doing to generate the profiles::I import the above package into main.go and place the following at the top of my main func: I then build the binary and run it: I then see output like this: Now I work the app from another terminal : After 60 seconds, I go back to check my profile: Any ideas what might be happening here or where I could start with trouble shooting/solving this?Any help suggestions welcome. <code>  (pprof) top269.97kB of 269.97kB total ( 100%) flat flat% sum% cum cum% 269.97kB 100% 100% 269.97kB 100% (pprof) defer profile.Start(profile.MemProfile).Stop() go build -o orig /Users/danielwall/www/netlistener/application/adrequest.go /Users/danielwall/www/netlistener/application/cookie.go /Users/danielwall/www/netlistener/application/header.go /Users/danielwall/www/netlistener/application/lex.go /Users/danielwall/www/netlistener/application/main.go /Users/danielwall/www/netlistener/application/publisher_ids.go /Users/danielwall/www/netlistener/application/request.go /Users/danielwall/www/netlistener/application/response.go /Users/danielwall/www/netlistener/application/server.go /Users/danielwall/www/netlistener/application/sniff.go /Users/danielwall/www/netlistener/application/status.go /Users/danielwall/www/netlistener/application/transfer.go./orig 2015/11/16 11:39:49 profile: memory profiling enabled, /var/folders/26/2sj70_sn72l_93j7tf6r07gr0000gn/T/profile614358295/mem.pprof wrk -d60 -c10 -H ""X-Device: desktop"" -H ""X-Country-Code: GB"" ""http://localhost:8189/app?id=111&schema=xml2&ad_type=auto&url=http://test.com/&category=bob""Running 1m test @ http://localhost:8189/app?id=111&schema=xml2&ad_type=auto&url=http://test.com/&category=bob 2 threads and 10 connections Thread Stats Avg Stdev Max +/- Stdev Latency 414.09us 0.92ms 55.36ms 95.66% Req/Sec 17.57k 3.19k 22.59k 76.00% 2097764 requests in 1.00m, 684.20MB readRequests/sec: 34958.03Transfer/sec: 11.40MB ^C2015/11/16 12:05:20 profile: caught interrupt, stopping profilesgo tool pprof /var/folders/26/2sj70_sn72l_93j7tf6r07gr0000gn/T/profile614358295/mem.pprof",golang tool pprof not working properly - same broken output regardless of profiling target
GoLang variable in for loop undefined outside," I am wondering why the following piece of code is not working: I've stripped some unrelevant code (as this is obviously not really random).The issue i'm having is that just under the for-loop, ""randomString"" is undefined.I've tried setting it using randomString := fmt.Sprintf() and with the var you've seen above.I'm quite sure this is a scoping issue (the randomString variable is not in the scope outside of the for-loop), but as a PHP / JS developer, i'm not used to this and would say that variable is also available after the for loop.How can I access that variable from that point? Basically just displaying the last generated string. <code>  package mainimport ( ""fmt"")func main() { for i := 0; i < 10000; i++ { var randomString = fmt.Sprintf(""a%sa\n"", ""test"") } fmt.Printf(""Made 10000 random strings like"", randomString);}",Variable in for loop undefined outside
Why use sql tags in struct in golang sql," Well I know the necessity of tags in struct in golang and how is it accessed by reflect in golang. But I have searched and could not find a reliable answer to the question of why I should use sql tags in struct while writing struct for sql results. I have explored many sample code and people are using sql:""index"" in the struct and sql:""primary_key"" in the struct.Now I have done indexing in the database layer, isnt it enough? Should I have to use sql:""index"" too get the best results? Like so I have defined primary key attribute in the database should I have to specify sql:""primary_key"" as well?My code seems to work fine without those. Just want to know their benefit and usages. <code> ",Why use sql tags in struct in some go libs like gorm?
strcut field assignment difference of pointer/non-pointer type," In section 4.4 (Structs) of The Go Programming Language, there is a code excerpt: with the remark If the result type of EmployeeByID were changed to Employee instead of *Employee, the assignment statement would not compile since its left-hand side would not identify a variable.I don't understand why changing the result type of EmployeeByID to Employee would cause LHS not identify a variable. <code>  var dilbert Employeefunc EmployeeByID(id int) *Employee { /* ... */ }id := dilbert.IDEmployeeByID(id).salary = 0",struct field assignment difference of pointer/non-pointer type
struct field assignment difference of pointer/non-pointer type," In section 4.4 (Structs) of The Go Programming Language, there is a code excerpt: with the remark If the result type of EmployeeByID were changed to Employee instead of *Employee, the assignment statement would not compile since its left-hand side would not identify a variable.I don't understand why changing the result type of EmployeeByID to Employee would cause LHS not identify a variable. <code>  var dilbert Employeefunc EmployeeByID(id int) *Employee { /* ... */ }id := dilbert.IDEmployeeByID(id).salary = 0",struct field assignment difference of pointer/non-pointer type
Golang If I am using channels properly should I need to use Mutexs?," If I am using channels properly, should I need to use mutexes to protect against concurrent access? <code> ",If I am using channels properly should I need to use mutexes?
Golang embedded struct," Is it possible to inherit methods of a type without using embedded structs?The first snippet of code is working code that embeds the Property struct in Node and I'm able to call node.GetString that's a method on Properties. The thing I don't like about this is when I initialize Node I have(?) to initialize the Properties struct within it. Is there a way around this? Ultimately, I would like to do something like the following. Where Node is of type Properties and initializing does not require initializing a Property struct too. The following code doesn't work but may be clear what my goal is. I'll be adding more structs that will use Properties's methods which is why I'm asking. If I only had Node, I would just have methods for Node and be done. But because I'll have more than Node I find it kind of redundant to add the same methods to all the structs that embed PropertiesI guess more to the exact problem, I want to use Properties methods from Node without having to initialize Properties. <code>  package mainimport ""fmt""type Properties map[string]interface{}func (p Properties) GetString(key string) string { return p[key].(string)}type Nodes map[string]*Nodetype Node struct { *Properties}func main() { allNodes := Nodes{""1"": &Node{&Properties{""test"": ""foo""}}} // :'( singleNode := allNodes[""1""] fmt.Println(singleNode.GetString(""test""))} package mainimport ""fmt""type Properties map[string]interface{}func (p Properties) GetString(key string) string { return p[key].(string)}type Nodes map[string]*Nodetype Node Propertiesfunc main() { allNodes := Nodes{""1"": &Node{""test"": ""foo""}} // :) singleNode := allNodes[""1""] fmt.Println(singleNode.GetString(""test"")) // :D}",Embedded struct
"Go: marshal []byte to JSON, giving a strange string"," When I try to marshal []byte to JSON format, I only got a strange string.Please look the following code.I have two doubt:How can I marshal []byte to JSON?Why []byte become this string? the output is: golang playground: https://play.golang.org/p/wanppBGzNR <code>  package mainimport ( ""encoding/json"" ""fmt"" ""os"")func main() { type ColorGroup struct { ByteSlice []byte SingleByte byte IntSlice []int } group := ColorGroup{ ByteSlice: []byte{0,0,0,1,2,3}, SingleByte: 10, IntSlice: []int{0,0,0,1,2,3}, } b, err := json.Marshal(group) if err != nil { fmt.Println(""error:"", err) } os.Stdout.Write(b)} {""ByteSlice"":""AAAAAQID"",""SingleByte"":10,""IntSlice"":[0,0,0,1,2,3]}","Marshal []byte to JSON, giving a strange string"
get 3 years ago timestamp in golang?," I want to get the time unix time stamp 3 years ago, I use this now: This is not that accurate anyway (because year may have 366 days). <code>  time.Now().Unix(() - 3 * 3600 * 24 * 365",Get 3 years ago timestamp in golang?
Golang testing using local files," I'm looking for what best practice I should use when it comes to testing with Go using local files.By using local files, I mean that in order to test functionality, the application needs some local files, as the application reads from these files frequently.I'm not sure if I should write temporary files myself just before running the tests using the ioutil package tempdir and tempfile functions, or create a test folder like so; and then read from the contents inside <code>  testing/...test_files_heremain.gomain_test.go testing/...",Testing using local files
Golang http.NewRequest: structs as json not working," I am trying to post a struct using Go's http.POST, however I am not being succeeded with that.Please look: After loading some data from a database, I have the following, in order to perform the POST itself: Unfortunately, the return I get from server is not as expected: Edit: inserted the post body(first line on program's output). If I run the request on Postman, with this body, it works as expected. Server does not check Accept header, just the Content-Type, which is already set to application/json;charset=utf-8.What am I doing wrong? I have spent the last hours looking into this, but no luck at all. <code>  //SKUStock definitiontype SkuStock struct { Sku string `json:""id""`; Quantity int64 `json:""stockQuantity""`;}type StockJson struct { Items []SkuStock `json:""skus""`;} //Sends the skuStock Information to serverfunc SendSkuData(stockItems []SkuStock) {//creates a json like {""skus"":[{""id"":""ITEM1576"",""stockQuantity"":995}]} stockPayload, err := json.Marshal(StockJson{stockItems}); if err != nil { log.Fatal(err); } client := &http.Client{} apiRequestUrl := os.Getenv(""api.protocol"") + ""://"" + os.Getenv(""api.address"") + ""/batch/sku/stock""; req, err := http.NewRequest(""POST"", apiRequestUrl, bytes.NewBuffer(stockPayload)); req.Header.Add(""Content-Type"", ""application/json;charset=utf-8""); req.SetBasicAuth(os.Getenv(""api.key""), """"); log.Printf(""Request body: %s"", string(stockPayload)); log.Printf(""Request %s"", req); resp, err := client.Do(req); if(err != nil) { log.Fatal(err); } defer resp.Body.Close(); log.Printf(""Response %s"", resp);} 2015/12/08 23:42:47 Request body: {""skus"":[{""id"":""ITEM1576"",""stockQuantity"":995}]}2015/12/08 23:42:47 Request &{POST http://api-sandbox.bonmarketplace.com.br/batch/sku/stock HTTP/1.1 %!s(int=1) %!s( int=1) map[Authorization:[Basic REMzRjAyNjUwNDE5RDAzQUJBNjEyM0E0QUZCMzJGQUQ6] Content-Type:[application/ json;charset=utf-8]] {{""skus"":[{""id"":""ITEM1576"",""stockQuantity"":995}]}} %!s(int64=48) [] %!s(bool=false) api-sandbox. bonmarketplace.com.br map[] map[] %!s(*multipart.Form=<nil>) map[] %!s(*tls.ConnectionState=<nil>) %!s(<-chan struct {}=<nil>)}2015/12/08 23:42:47 Response &{415 Unsupported Media Type %!s(int=415) HTTP/1.1 %!s(int=1) %!s(int=1) map[Server:[ nginx/1.7.5] Date:[Wed, 09 Dec 2015 01:40:18 GMT] Content-Type:[application/json;charset=utf-8] Content-Length:[163] Connection:[keep-alive] X-Access-Control-Realm:[external]] %!s(*http.bodyEOFSignal=&{0xc820122000 {0 0} false <nil> 0xd78a0 0xd7840}) %!s(int64=163) [] %!s(bool=false) map[] %!s(*http.Request=&{POST 0xc820064480 HTTP/1.1 1 1 map[Content- Type:[application/json;charset=utf-8] Authorization:[Basic REMzRjAyNjUwNDE5RDAzQUJBNjEyM0E0QUZCMzJGQUQ6]] {0xc82000e460} 48 [] false api-sandbox.bonmarketplace.com.br map[] map[] <nil> map[] <nil> <nil>}) %!s(*tls.ConnectionState=<nil>)}",Golang http.NewRequest: Invalid content-type
Do we need to close DB connection before closing application?," In Go, when using a SQL database, does one need to close the DB (db.Close) before closing an application? Will the DB automatically detect that the connection has died? <code> ",Do we need to close DB connection before closing application in Go?
"SETEX with mgo error - ""Use of closed network connection"""," I'm using the following code to execute a SET and EXPIRE from my Go app. but I've started to get an error: Use of closed network connection. I use Gary Burd's Redigo package and RedisLabs.My code to connect to Redis is: <code>  _, err = C.Cache.Do(""SETEX"", key, 3600, data) //Connect to cache (Redis)cache, err := connectToCache()if err != nil { log.Printf(""Cache connection settings are invalid"") os.Exit(1)}defer cache.Close()func connectToCache() (redis.Conn, error) { cache, err := redis.Dial(""tcp"", CACHE_URI) if err != nil { return nil, err } _, err = cache.Do(""AUTH"", CACHE_AUTH) if err != nil { cache.Close() return nil, err } return cache, nil}","SETEX error - ""Use of closed network connection"""
Golang: How to use global var across files in a package," I have the following file structure:models/db.go models/db_util.go When I try to access db in InsertProfile function, it says NULL ptr exception. How do I access the db in db_utils.go?I would not like to capitalize db (as it would give access to all the packages).I am getting the QUERY returned from the db in init() correctly. <code>  type DB struct { *sql.DB}var db *DBfunc init() { dbinfo := fmt.Sprintf(""user=%s password=%s dbname=%s sslmode=disable"", DB_USER, DB_PASSWORD, DB_NAME) db, err := NewDB(dbinfo) checkErr(err) rows, err := db.Query(""SELECT * FROM profile"") checkErr(err) fmt.Println(rows)}func NewDB(dataSourceName string) (*DB, error) { db, err := sql.Open(""postgres"", dataSourceName) if err != nil { return nil, err } if err = db.Ping(); err != nil { return nil, err } return &DB{db}, nil} func (p *Profile) InsertProfile() { if db != nil { _, err := db.Exec(...) checkErr(err) } else { fmt.Println(""DB object is NULL"") }}",How to use global var across files in a package?
Golang: How to use global var across files in a package?," I have the following file structure:models/db.go models/db_util.go When I try to access db in InsertProfile function, it says NULL ptr exception. How do I access the db in db_utils.go?I would not like to capitalize db (as it would give access to all the packages).I am getting the QUERY returned from the db in init() correctly. <code>  type DB struct { *sql.DB}var db *DBfunc init() { dbinfo := fmt.Sprintf(""user=%s password=%s dbname=%s sslmode=disable"", DB_USER, DB_PASSWORD, DB_NAME) db, err := NewDB(dbinfo) checkErr(err) rows, err := db.Query(""SELECT * FROM profile"") checkErr(err) fmt.Println(rows)}func NewDB(dataSourceName string) (*DB, error) { db, err := sql.Open(""postgres"", dataSourceName) if err != nil { return nil, err } if err = db.Ping(); err != nil { return nil, err } return &DB{db}, nil} func (p *Profile) InsertProfile() { if db != nil { _, err := db.Exec(...) checkErr(err) } else { fmt.Println(""DB object is NULL"") }}",How to use global var across files in a package?
How can I store reference to the result of an operation in Go," Okay it's hard to describe it in words but let's say I have a map that stores int pointers, and want to store the result of an operation as another key in my hash: This doesn't work and gives me the error: cannot take the address of *m[""x""] & *m[""y""]Thoughts? <code>  m := make(map[string]*int)m[""d""] = &(*m[""x""] + *m[""y""])",How can I store reference to the result of an operation in Go?
golang strings replacer how to replace all substrings at once," I am trying to replace multiple different characters from a string using Replacer but having issues replacing one string. Output has two underscores instead of one, and if I try replacing using other Replacer, then it cannot replace it entirely.Try the code on the Go Playground: I can use multiple Replacer etc. but would really like to do it in one pass / or one statement. Any suggestions how so do it cleanly? My goal is to be efficient (this will be done frequently, so important although these strings are short) and also to not use multiple Replacers.  <code>  package mainimport ( ""fmt"" ""strings"" )//Expecting output to be emp_my_statsfunc main() { var input string = ""/v1.0/emp/emp_1/my_stats"" replacer := strings.NewReplacer(""/v1.0/"", """", ""/"", ""_"", ""emp_1"", """")// replacer := strings.NewReplacer(""/v1.0/"", """", ""/"", ""_"", ""/emp_1"", """") output := replacer.Replace(input) fmt.Printf(""output %v"", output) }",Strings.Replacer: how to replace all substrings at once?
How to execute a linux built in command in golang," I am trying to find out if a program exists on Linux and I found this article. I tried executing this from my go program and it keeps giving me an error saying it can-not find ""command"" in my $PATH, which is to be expected since it's a built-in command in linux and not a binary. So my question is how to execute built in commands of linux from within go programs? error: exec: ""command"": executable file not found in $PATH <code>  exec.Command(""command"", ""-v"", ""foo"")",How to execute a shell built-in command
Golang - Checking equality of interface{}," I am searching a []interface{} slice for a given interface{} value: In the trivial case the types are int. However what should I do if, for example, the types are some custom struct?  <code>  var v interface{}for i := 0; i < len(A); i++ { if (A[i] == v) { fmt.Println(""Gotcha!"") break }}",Checking equality of interface{}
Go: Log when server is started," Is there any way to print something when the http server starts? For instance ""Server is started at port 8080""In Node (using Express), it would be like: This is my code: Thanks. <code>  app.listen(8080, function() { console.log('Server started at port 8080') }); func main() { http.HandleFunc(""/"", MyHandler) http.ListenAndServe("":8080"", nil)}",Log when server is started
How to spawn goroutine per HTTP request," Previously titled: How to spawn goroutine per HTTP request?The code below is a simple HTTP server that echos the path back to the requester. I used it to test if the ListenAndServe method of the net/http package by default fires a goroutine to handle each request; which I discovered it doesn't. If I make three requests at the same time, the first takes 10 seconds to return, the second 20 (10 seconds after the first returns), and the third 30 seconds. Basically what I want is the main goroutine to listen for an HTTP connection, then pass the reading of the request and the response to a handler spawned in another goroutine. Could someone point me in the right direction for accomplishing this? Preferably using the net/http package in go.UPDATE 12/21/15 08:46 AM MSTI conducted the same exact test you did using my web browser (chrome 47), five requests at the root of localhost:8080, and the results were roughly: So, hopefully, the folks who would otherwise down-vote my question would understand my confusion and why I made the assumption I did. I have no idea why I got the results I did on the 4th and 5th request.I ran the same test using curl and had the same results as @tomasz.I'm using go1.2.1.UPDATE 12/21/15 02:08 PM MSTPer @tomasz's suggestion below, I retitled this question from ""How to spawn goroutine per HTTP request"" to ""Why isn't this go HTTP server spawning a goroutine per request in Chrome 47?"" <code>  package mainimport ( ""fmt"" ""net/http"" ""time"")func handler(w http.ResponseWriter, r *http.Request) { time.Sleep(10000 * time.Millisecond) fmt.Fprint(w, r.URL.Path)}func main() { http.HandleFunc(""/"", handler) http.ListenAndServe("":8080"", nil)} 1st: 10 seconds2nd: 20 seconds3rd: 30 seconds4th: 36 seconds 5th: 38 seconds",Why isn't this go HTTP server spawning a goroutine per request in Chrome 47?
Golang: when to use pointers," I'm new to the Go Language, and have only minimal background in C/C++, so naturally I'm struggling with the idea of when to use pointers and when not to use pointers. Although this question might be considered open-ended, I'm wondering what some guidelines on when to return structs and when to return pointers, (and equivalently when to accept structs / pointers as arguments).From what I can guess, the following statements hold true:structs are passed into functions by value. That is, a copy of a structure is made when passing it into a function.if I want to pass a structure by reference, then I would instead use a pointer argument in the function definition, and use the addressof operator when calling the function.The reason why I would want to pass in a structure by reference is because either the structure I'm passing in is large, and it would be taxing on memory to pass it by value (unlikely) or if I want to make changes to the copy that I'm passing in (more likely).As a corollary to 3.), I should pass by value unless I have one of the reasons above to pass by reference.Are my assumptions correct? Or am I missing the mark on pointers? <code> ",When to use pointers
Run Multiple Exec Commands golang," I'm having trouble figuring out how to run multiple commands using the os/exec package. I've trolled the net and stackoverflow and haven't found anything that works for me case. Here's my source: I want to the command like I would from terminal. cd path; ./configure; makeSo I need run each command in order and wait for the last command to finish before moving on. With my current version of the code it currently says that ./configure: no such file or directory I assume that is because cd path executes and in a new shell ./configure executes, instead of being in the same directory from the previous command. Any ideas? UPDATE I solved the issue by changing the working directory and then executing the ./configure and make command Still now i'm curious to know if there is a way to execute commands in the same shell. <code>  package mainimport ( _ ""bufio"" _ ""bytes"" _ ""errors"" ""fmt"" ""log"" ""os"" ""os/exec"" ""path/filepath"")func main() { ffmpegFolderName := ""ffmpeg-2.8.4"" path, err := filepath.Abs("""") if err != nil { fmt.Println(""Error locating absulte file paths"") os.Exit(1) } folderPath := filepath.Join(path, ffmpegFolderName) _, err2 := folderExists(folderPath) if err2 != nil { fmt.Println(""The folder: %s either does not exist or is not in the same directory as make.go"", folderPath) os.Exit(1) } cd := exec.Command(""cd"", folderPath) config := exec.Command(""./configure"", ""--disable-yasm"") build := exec.Command(""make"") cd_err := cd.Start() if cd_err != nil { log.Fatal(cd_err) } log.Printf(""Waiting for command to finish..."") cd_err = cd.Wait() log.Printf(""Command finished with error: %v"", cd_err) start_err := config.Start() if start_err != nil { log.Fatal(start_err) } log.Printf(""Waiting for command to finish..."") start_err = config.Wait() log.Printf(""Command finished with error: %v"", start_err) build_err := build.Start() if build_err != nil { log.Fatal(build_err) } log.Printf(""Waiting for command to finish..."") build_err = build.Wait() log.Printf(""Command finished with error: %v"", build_err)}func folderExists(path string) (bool, error) { _, err := os.Stat(path) if err == nil { return true, nil } if os.IsNotExist(err) { return false, nil } return true, err} err = os.Chdir(folderPath) if err != nil { fmt.Println(""File Path Could not be changed"") os.Exit(1) }",Run Multiple Exec Commands in the same shell golang
The &^ operator in golang?," I can't really google the name AND NOT and get any useful results, what exactly is this operator, and how could I do this in a language like C? I checked the specification, and there is nothing helpful in there but a list that says it's &^ (AND NOT). <code> ","What is the ""&^"" operator in golang?"
What this array init syntax mean?," I recently found the code below: I understand that this [N]bool is initialized with N false (zeros) by default. And if the index followed by a colon is specified values can are defined form the index (inclusive). Where is it described? What types can be used as an index value (there is a char in the example)? <code>  var noEscape = [256]bool{ 'A': true, true, true, true, true, true, true, true, true, true, true, true, true, true, true, true, true, true, true, true, true, true, true, true, true, true, 'a': true, true, true, true, true, true, true, true, true, true, true, true, true, true, true, true, true, true, true, true, true, true, true, true, true, true, '0': true, true, true, true, true, true, true, true, true, true, '-': true, '.': true, '_': true, '~': true,}",What this array init syntax mean? (elements with keys)
What is this CONTEXT in Go lang when talking about HTTP Requests? (I am a 6 year old)," To some this might be a stupid question. On the other hand this is is very important to me. I am new to Go programming and when I read this Sharing values between Middlewares and this Go Concurrency Patterns: Context I could not figure out what exactly what they meant by Context when referring to sharing values between middleware handlers or request handlers in general. I've been able to write a web framework with Go -- Frodo. Not perfect in a lot of ways, it was a learning experiment. As you see I am not stupid. Just under informed being new to Go lang.Thank you in advance for a comprehensive explanation. <code> ",What is this CONTEXT in Go lang when talking about HTTP Requests?
Golang ReplaceAllString," I read the example code from golang.org website. Essentially the code looks like this: The output is like this: I understand the first output, but I don't understand the the rest three. Can someone explain to me the results 2,3 and 4. Thanks. <code>  re := regexp.MustCompile(""a(x*)b"")fmt.Println(re.ReplaceAllString(""-ab-axxb-"", ""T""))fmt.Println(re.ReplaceAllString(""-ab-axxb-"", ""$1""))fmt.Println(re.ReplaceAllString(""-ab-axxb-"", ""$1W""))fmt.Println(re.ReplaceAllString(""-ab-axxb-"", ""${1}W"")) -T-T---xx-----W-xxW-",Go ReplaceAllString
Why did Go omit package version management?," I'm getting my hands dirty with Go, and while I understand and appreciate the principle of simplicity that Go was built upon, I'd like to grasp the rationale behind forgoing a built-in package versioning method in their dependency-fetching tool go get and the import statement.If I understand correctly, go get and import fetch the package from HEAD and they are unable to refer to a branch or a tag. While there are tools like gopkg.in that circumvent this limitation, the official toolchain:Forces developers to create separate repos for major (breaking) versions of their products.It doesn't allow consumers to downgrade between minor or micro versions in case bugs are found in newer ones.Truth be told, things are not so easy because package versioning would require a strategy to deal with conflicting transitive dependencies, e.g. X depends on A and B, each of which depend on different versions of C.Coming from a Java background, it does appear that this limitation poses some risks and problems, amongst others:Product/package evolution and breakage of public APIs of 3rd party deps is unavoidable, therefore versioning must be a first-class citizen in the toolchain IMHO.The Git-repo-per-version policy is highly inefficient: The overall Git history of the package is lost or scattered across repos (merges between versions, backports, etc.) Conflicts with transitive dependencies may still occur, and will go about undetected because the language nor the toolchain impose any semantics to allow detection in the first place.Enterprise adoption may be hindered and development teams may shy away from the language, given that:Always dragging in HEAD means that they can't control or freeze their 3rd party deps, leading to a potentially unpredictable end product.May lack the manpower to keep their product constantly updated and tested with upstream's HEAD (not every company in the world is Google :)).While I do understand that the latter risk can be and must be mitigated with Continuous Integration, it does not solve the underlying root of the problem.What information am I missing? How do you deal with package upstream changes when deploying Go in an enterprise with limited manpower? <code> ",Package version management in Go 1.5
Reverse Splice of strings," I don't understand what is wrong with the below implementation, I had a look at sort.StringSlice and it looks the same. <code>  type RevStr []stringfunc(s RevStr) Len() int { return len(s) }func(s RevStr) Less(i, j int) bool { return s[i] < s[j] }func(s RevStr) Swap(i, j int) { s[i], s[j] = s[j], s[i] }func Reverse(input string) string { rs := RevStr(strings.Split(input, "" "")) sort.Reverse(rs) return strings.Join(rs, "" "")}",Reverse Slice of strings
"Can I recover from panic, then panic again and keep the original stacktrace?"," Is it possible to ""rethrow"" an error from recover and keep the original stack trace? The best I know how to do is to panic again, but that does create a new stacktrace. My motivation for wanting this is that unless my function exits normally or handleError runs, my program deadlocks. And unless I preserve the original strack trace, I do not know where it crashed. <code>  func do() { defer func() { cleanUp() if x := recover(); x != nil { handleError() panic(x) } }() doStuff()}","Can I recover from panic, handle the error, then panic again and keep the original stack trace?"
how to stream an io.ReadCloser into a http.ResponseWriter in golang?," I have a client which makes a request to download a file, the web server forwards this request on to the resource server that actually holds the file. The *http.Response back from the resource server has the Body io.ReaderCloser streaming the file contents from the resource server. But I'm then at the point where I want to start writing that into the original http.ResponseWriter that came from the client. Looking at the http.ResponseWriter interface it only contains a Write method which takes a slice of bytes, which makes me think that the only way to get the file contents back to the client is to read the Body io.ReaderCloser into a buffer and then put that into the http.ResponseWriter's Write method. which I dont want to do since that is hugely inefficient and it would be much better to stream it through my web server. Is this possible?here is some code to illustrate: <code>  getFile() *http.Response { //make a request to resource server and return the response object}// handle request from clienthttp.HandleFunc(""/getFile"", func(w http.ResponseWriter, r *http.Request){ res := getFile() //how can I stream res.Body into w without buffering ?})",How to stream an io.ReadCloser into a http.ResponseWriter
How to detect when []bytes can't be converted to string in GOlang?, There are invalid byte sequences that can't be converted to Unicode strings. How do I detect that when converting []byte to string in Go? <code> ,How to detect when bytes can't be converted to string in Go?
How to compare 2 function in Golang?," For example I have list of functions that I want to compare:http://play.golang.org/p/_rCys6rynf What is the correct way to compare if two functions are the same? <code>  type Action func(foo string)type Handler struct { Get Action Post Action}var routes map[string]Handlerfunc Undefined(foo string) {}func Defined(foo string) {}func init() { routes = map[string]Handler{ `/`: Handler{Defined,Undefined}, }}func main() { for _, handler := range routes { if handler.Post != Undefined { // do something } // invalid operation: (func(string))(handler.Post) != Undefined (func can only be compared to nil) if &handler.Post != &Undefined { // do something } // cannot take the address of Undefined // invalid operation: &handler.Post != &Undefined (mismatched types *Action and *func(string)) }}",How to compare 2 functions in Go?
golang unmarshaling an array of a predefined structure," My XML contains an array of predefined elements, but I can't pick up the array. Here is the XML structure: Here is the full code and here is the playground link. Running this will pick up Parent.Val, but not Parent.Children. EDIT: I simplified the problem a bit here. Basically I can't unmarshal any array, not just of predefined structure. Below is the updated work code. In that example, only one item ends up in the container interface. <code>  var xml_data = `<Parent> <Val>Hello</Val> <Children> <Child><Val>Hello</Val></Child> <Child><Val>Hello</Val></Child> <Child><Val>Hello</Val></Child> </Children> </Parent>` package mainimport ( ""fmt"" ""encoding/xml"")func main() { container := Parent{} err := xml.Unmarshal([]byte(xml_data), &container) if err != nil { fmt.Println(err) } else { fmt.Println(container) }}var xml_data = `<Parent> <Val>Hello</Val> <Children> <Child><Val>Hello</Val></Child> <Child><Val>Hello</Val></Child> <Child><Val>Hello</Val></Child> </Children> </Parent>`type Parent struct { Val string Children []Child}type Child struct { Val string} func main() { container := []Child{} err := xml.Unmarshal([]byte(xml_data), &container) if err != nil { fmt.Println(err) } else { fmt.Println(container) } /* ONLY ONE CHILD ITEM GETS PICKED UP */}var xml_data = ` <Child><Val>Hello</Val></Child> <Child><Val>Hello</Val></Child> <Child><Val>Hello</Val></Child> `type Child struct { Val string}",How do I unmarshal nested XML elements into an array?
"In Go, how can I extract the value of my current local time offset?"," I'm struggling a bit trying to format and display some IBM mainframe TOD clock data. I want to format the data in both GMT and local time (as the default -- otherwise in the zone the user specifies).For this, I need to get the value of the local time offset from GMT as a signed integer number of seconds.In zoneinfo.go (which I confess I don't fully understand), I can see but this is not, I think, exported, so this code doesn't work: Is there a simple way to get this information? <code>  // A zone represents a single time zone such as CEST or CET.type zone struct { name string // abbreviated name, ""CET"" offset int // seconds east of UTC isDST bool // is this zone Daylight Savings Time?} package mainimport ( ""time""; ""fmt"" )func main() { l, _ := time.LoadLocation(""Local"") fmt.Printf(""%v\n"", l.zone.offset)}",How can I extract the value of my current local time offset?
How can I extract the value of my current local time offset?," I'm struggling a bit trying to format and display some IBM mainframe TOD clock data. I want to format the data in both GMT and local time (as the default -- otherwise in the zone the user specifies).For this, I need to get the value of the local time offset from GMT as a signed integer number of seconds.In zoneinfo.go (which I confess I don't fully understand), I can see but this is not, I think, exported, so this code doesn't work: Is there a simple way to get this information? <code>  // A zone represents a single time zone such as CEST or CET.type zone struct { name string // abbreviated name, ""CET"" offset int // seconds east of UTC isDST bool // is this zone Daylight Savings Time?} package mainimport ( ""time""; ""fmt"" )func main() { l, _ := time.LoadLocation(""Local"") fmt.Printf(""%v\n"", l.zone.offset)}",How can I extract the value of my current local time offset?
Compress and decompress a file using lz4 in Go lang.?, I want to compress and decompress a file using lz4 algorithm in Go. Is there any package available to do this? I searched and found a package called https://github.com/pierrec/lz4 I am new Go and I cannot figure out how to use this package to compress and decompress a file.I need to use this package to compress a file to binary format and decompress the binary file to original file using Go. <code> ,How to compress and decompress a file using lz4?
How to compress and decompress a file using lz4 in Golang?, I want to compress and decompress a file using lz4 algorithm in Go. Is there any package available to do this? I searched and found a package called https://github.com/pierrec/lz4 I am new Go and I cannot figure out how to use this package to compress and decompress a file.I need to use this package to compress a file to binary format and decompress the binary file to original file using Go. <code> ,How to compress and decompress a file using lz4?
Am I creating a go leak?, When I do this instead of this Am I leaking goroutines if I do not close them and Is there a tool to detect when I forget to close goroutines? <code>  done := make(chan bool)for i := 0; i < 10; i++ { go func() { done <- true }()}<-done done := make(chan bool)for i := 0; i < 10; i++ { go func() { done <- true }()}for i := 0; i < 10; i++ { <-done},Is there a tool to detect when I forget to close goroutines?
Golang Global Variable access, How do I access a variable that was declared/init in my main.go in a different .go package/file? Keeps telling me that the variable is undefined (I know that global variables are bad but this is just to be used as a timestamp)in main.go trying to access StartTime in a different .go filebut keep getting StartTime undefined <code>  var StartTime = time.Now()func main(){...},How to access global variables
Golang: how to ignore extra fields for fmt.Sprintf," I have a Golang program that reads a string parameter from command line and passes it to the fmt.Sprintf function. Let's say tmp_str is the target string from command line. In some cases, the program will pass a completed string like ""Hello Friends"", instead of a string template.. The program would panic and return: Hello Friends%!(EXTRA string=world)So, how to ignore the extra fields for fmt.Sprintf? <code>  package mainimport ""fmt""func main() { tmp_str := ""hello %s"" str := fmt.Sprintf(tmp_str, ""world"") fmt.Println(str)}",How to ignore extra fields for fmt.Sprintf
How to round upwards when casting float to int in go what's, When casting float to int the decimal is discarded. What's a clean way to cast so that it rounds to the nearest whole number instead.x := int(3.6)should equal 4 instead of 3. <code> ,How to round to nearest int when casting float to int in go
Is it possible get information about caller function in golang?, Is it possible get information about caller function in Golang? For example if I have How can I get that foo has been called from main?I'm able to this in other language (for example in C# I just need to use CallerMemberName class attribute) <code>  func foo() { //Do something}func main() { foo() },Is it possible get information about caller function in Golang?
Confirm TLS certificate while preforming ReverseProxy in GoLang," In Go I'm using NewSingleHostReverseProxy to perform a reverse proxy, however I need to confirm the SSL certificates of the host site, to make sure I have the correct secure certificate... any ideas how I should do this? Should I be doing this with the handler or transport? I'm new to Go and still getting my head around it. <code>  proxy := httputil.NewSingleHostReverseProxy(&url.URL{ Scheme: ""https"", Host: ""sha256.badssl.com"",})http.ListenAndServe(""127.0.0.1:80"", proxy)",Confirm TLS certificate while performing ReverseProxy in GoLang
Go lang: First frame of video," I'm creating a single page application with Golang on the backend and javascript on the frontend. Id like to find a way how to get the first frame of a video using Golang.First, I upload a .mp4 video file to the server. It is saved on the server.Is there a way to get the first frame of this video, using Golang?It should be possible to do it using Javascript on frontend, but I don't feel like it is the right way to solve this issue.I have no idea how to implement it using Golang, and I haven't found any useful libraries, not even built-in functions that could help me to solve this.Every piece of advice or any recommendations will be much appreciated. <code> ",First frame of video
Decalring a field tag in proto message," I just dived in Go programming using protobuf and I'm at the point where I need to validate data in a struct. I found govalidator, which seems to do the perfect job for what I need. It does validate structs based on the field tags, something like And my protobuf definition would look like Now my question would be, is there a way to define the field tags in the proto message. From what I've seen in the generated go code, the compiler adds tags to the fields anyway, but could I ""sneak"" the ones that I need too? Also, I would imagine that unmarshalling could be one possible solution, but it somehow seems inefficient to me to unmarshal just to copy the field values to an equivalent struct which would have the necessary field tags. <code>  type Contact struct { firstName string `valid:""alpha,required""` lastName string `valid:""alpha,required""` email string `valid:""email,required""`}jdoe := &Contact{ firstName: ""John"", lastName: ""Doe"", email: ""jdoe@mail.com""}ok, err = govalidator.ValidateStruct(jdoe) message Contact { string firstName = 1; string lastName = 2; string email = 3;}",Declaring a field tag in proto message
How get SHA1 RSA signed of data in go?," I'm new in Go and having hard time to figure it out how crypto package works.Basicly I need to sign a string with pem key and get sha1 of that like the equivalent code in C# in below.Thanks <code>  RSACryptoServiceProvider rsa = new RSACryptoServiceProvider(); rsa.FromXmlString(<RSAKeyValue><Modulus>oQRshGhLf2Fh...);byte[] signMain = rsa.SignData(Encoding.UTF8.GetBytes(data), new SHA1CryptoServiceProvider());",How get SHA1 RSA signed of bytes in Go?
Cannot start golang application exe as a windows services, I have a application with Go language as the backend.I can create a service using the sc and nssm as below :sc create TestService binpath=C:\User\sds\Desktop\test.exe nssm install TestService C:\User\sds\Desktop\test.exeThe services are created successfully but it doesn not get started. It gives startup timeout error while starting the service.I need to start the application from windows services.Thanks in advance. <code> ,Cannot start a Go application exe as a windows services
How to merge multiple strings and int into a single string in golang?," I am a newbie in Go. I can't find any official docs showing how to merge multiple strings into a new string. What I'm expecting: Input: ""key:"", ""value"", "", key2:"", 100Output: ""Key:value, key2:100""I want to use + to merge strings like in Java and Swift if possible. <code> ",How to merge multiple strings and int into a single string
How to return dynamic type struct in golang?," I am using Golang Revel for some web project and I did like 12 projects in that so far. In all of them I have a lot of code redundancy because of return types. Look at this two functions: As you can see they they both returns same type of data (type struct).My idea was just to pass string var like this: Like this I can have just one helper for returning data types instead ofdoing same thing over and over again for different models but same data type.My questions are:Is this possible at allIf yes can you point me to right docsIf no, I will be more then happy to return your answer :) <code>  func (c Helper) Brands() []*models.Brand{ //do some select on rethinkdb and populate correct model var brands []*models.Brand rows.All(&brands) return brands}func (c Helper) BlogPosts() []*models.Post{ //do some select on rethinkdb and populate correct model var posts []*models.Post rows.All(&posts) return posts} func (c Helper) ReturnModels(modelName string) []*interface{} { //do rethinkdb select with modelName and return []*interface{} for modelName}",How to return dynamic type struct in Golang?
Escape Variables with PrintF? - GoLang," If I wanted to do the following: How could I escape the first occurrence of %v? \%v doesn't seem to work. Any ideas? <code>  fmt.Printf(""Escape this -> %v... Do not escape this -> %v"", ""Unescaped"")",Escape Variables with Printf
How to convert UTC time to unix timestamp with golang, I am looking for an option to convert UTC time string to unix timestamp.The string variable I have is 02/28/2016 10:03:46 PM and it needs to be converted to a unix timestamp like 1456693426Any idea how to do that? <code> ,How to convert UTC time to unix timestamp
Convert date from human readable format golang," I know that there is a library for doing opposite. I need to format string, for example, ""a year ago"" to any date format ""29/02/15"". <code> ",Convert date from human readable format
Convert string into uint16 in go lang," I'm researching a solution in order to convert a string (in my case the string is ""05f8"") into a uint16.I made research but I don't find a solution.Does anyone know how to do this?Thanks for your help! <code> ",How do I convert a string value in uint16 in Go lang?
How do I parse ASCII hex-encoded representation of an uint16 value?," I'm researching a solution in order to convert a string (in my case the string is ""05f8"") into a uint16.I made research but I don't find a solution.Does anyone know how to do this?Thanks for your help! <code> ",How do I convert a string value in uint16 in Go lang?
How to set time to dd-MMM-yyyy HH:mm:ss in golang?," https://play.golang.org/p/82QgBdoI2G The output should be like if date time today is 2016-03-03 08:00:00 +0000UTCOutput: 03-MAR-2016 08:00:00Time should be in 24hr format. <code>  package mainimport ""fmt""import ""time""func main() { fmt.Println(time.Now().Format(""01-JAN-2006 15:04:00""))}",How to set time to dd-MMM-yyyy HH:mm:ss in go?
Is an struct actually copied between goroutines if sent over a Golang channel?," If a large struct is sent over a channel in Go, is it actually copied between goroutines?For example, in the code below, will Go actually copy all largeStruct data between goroutines producer and consumer? Playground: http://play.golang.org/p/fawEQnSDwB <code>  package mainimport ( ""fmt"" ""sync"")type largeStruct struct { buf [10000]int}func main() { ch := make(chan largeStruct) wg := &sync.WaitGroup{} wg.Add(2) go consumer(wg, ch) go producer(wg, ch) wg.Wait()}func producer(wg *sync.WaitGroup, output chan<- largeStruct) { defer wg.Done() for i := 0; i < 5; i++ { fmt.Printf(""producer: %d\n"", i) output <- largeStruct{} } close(output)}func consumer(wg *sync.WaitGroup, input <-chan largeStruct) { defer wg.Done() i := 0LOOP: for { select { case _, ok := <-input: if !ok { break LOOP } fmt.Printf(""consumer: %d\n"", i) i++ } }}",Is a struct actually copied between goroutines if sent over a Golang channel?
Can I import a Golang package based on the OS I'm build for?," Say I have a go project that based on which OS, and in some cases which distro, I want to use say a Systemd client package vs an Upstart client package vs a sysv client package vs a launchd client package. Is it possible to selectively import each package so I only import the one I need per OS/distro I'm building for? Or do I have to import each package for each OS/distro? <code> ",Can I import a Golang package based on the OS I'm building for?
Can i host Angular2 frontent and Golang backend in one server, I want to create RESTful API with Golang and frontend with Angular2.Communication will be made with http requests. Angular2 will send requests to Golang API's. I know for Angular2 I should run own http server for routing and services.Can I run Golang server on one host and Angular2 server on another one and connect them together? <code> ,Can I host Angular2 frontend and Golang backend in one server
how to judge zero value of golang reflect," This program's output is What's the matter Why if v == nil is false? <code>  package mainimport ( ""fmt"" ""reflect"")func main() { var p1 *string = nil var v interface{} = p1 val := reflect.Indirect(reflect.ValueOf(v)) if v == nil { fmt.Printf(""NULL"") } else { if val.CanInterface() { fmt.Printf(""if is %v\n"", val.Interface()) } }} panic: reflect: call of reflect.Value.CanInterface on zero Valuegoroutine 1 [running]:panic(0xd65a0, 0xc82005e000) /usr/local/go/src/runtime/panic.go:464 +0x3e6reflect.Value.CanInterface(0x0, 0x0, 0x0, 0x0) /usr/local/go/src/reflect/value.go:897 +0x62",How to judge zero value of golang reflect
Golang: how to redirect to a url," I would like to show client another page after data has been collected from previous page. But I have trouble redirect the new URL on the server side. Here is my logic:submit user input with POST action to server;server run function saveChoice() to save user input into a database;After user input is saved, server send a new URL to client;By the time the client GET the new URL, server reads the database and get saved data outAnd I am stuck on step 3 (here is an example of the flow): And here is the template: May I know how I can redirect to a new page?p.s. If I put URL on button, then server is not going to run saveChoice() <code>  type Stuff struct{ List []string}func checkcheck(w http.ResponseWriter, r *http.Request) { sinfo := Stuff{ List: some_slice } t, err := template.New("""").Parse(tpl_ds) checkErr(err) err = r.ParseForm() checkErr(err) err = t.Execute(w, sinfo) checkErr(err) if r.Method == ""POST"" { saveChoice(r.Form[""choices""]) /* step 3: make user open another URL */ }} <html><script> $(function () { $('form').on('submit', function (e) { e.preventDefault(); $.ajax({ type: 'post', data: $('form').serialize(), }); }); });</script><body> <form method=""POST""> {{range .List}} <input type=""checkbox"" name=""choices"" value=""{{.}}""> <span>{{.}}</span><br> {{end}} <input type=""submit"" value=""Submit""> </form></body></html>",How to redirect to a url
Difference between goroutines and boost::fiber, I just started having a look at go and how the concurency in go works.I just wondered if you could implement something equal in C++ and found boost.fiber.What's the difference between goroutines and boost fibers? Could you implement something goroutine like with those fibers in C++? <code> ,Difference between goroutines and boost.fiber
Golang: Why do these processes become Zombies?," I have an application in Go that reroutes the STDIN and STDOUT of binaries and then runs them. In a nutshell I'm doing:- create command object with the binary path (lets call the object command A) - create command object with the binary path (calling it command B) - set the stdout of command B to the stdin of Command A - start command A - start command BI noticed whenever the process for command B exits while command A is running, it becomes a zombie process in the process table.Here's an example: Why does commandB become a Zombie if it exits while commandA is still running? I'm running Go 1.5 on Ubuntu 14. <code>  commandA := exec.Command(""samplebin"")commandB := exec.Command(""sample2bin"")cmdAStdin := commandA.StdinPipe()commandB.Stdout = cmdAStdincommandA.Start()commandB.Start()",Golang: Child Processes become Zombies
"Error ""command not found"" with Golang"," I'm trying to run Go in an interactive mode. I want to use go-eval for that, I followed their README instructions:I ran go get github.com/sbinet/go-eval/ successfullyI ran go-eval which resulted in -bash: go-eval: command not foundSome more information:echo $PATH returns: /usr/local/go/bin:...echo $GOPATH returns: $HOME/golangrunning whereis go-eval returns no outputrunning go install go-eval returns:can't load package: package go-eval: cannot find package ""go-eval"" in any of: /usr/local/go/src/go-eval (from $GOROOT) $HOME/golang/src/go-eval (from $GOPATH) <code> ","Error ""command not found"" after installing go-eval"
Golang: How to read a text file?," I'm trying to read ""file.txt"" and put the contents into a variable using Golang. Here is what I've tried... The file gets read successfully and the return from os.Open returns a type of *os.File <code>  package mainimport ( ""fmt"" ""os"" ""log"")func main() { file, err := os.Open(""file.txt"") if err != nil { log.Fatal(err) } fmt.Print(file)}",How to read a text file?
How to use function that added to a structure as a goroutine function," I have this code. I expect to output: but it outputs: Is there something wrong with my code? <code>  hello : 1 world : 2 world : 2world : 2 package mainimport ( ""fmt"" ""time"")type Task struct { name string data int32}func (this *Task) PrintData() { fmt.Println(this.name, "":"", this.data)}func main() { tasks := []Task{{""hello"", 1}, {""world"", 2}} for _, task := range tasks { go task.PrintData() } time.Sleep(time.Second * 5000)}",How to use a method as a goroutine function
Golang: How to sort struct with multiple sort parameters?, I have an array/slice of members: My question is how to sort them by LastName and then by FirstName. <code>  type Member struct { Id int LastName string FirstName string}var members []Member,How to sort struct with multiple sort parameters?
Use int as month when constructing date golang," When I supply an int as an argument to time.Date for month, it works (Example): Why, when I try to convert a string to int and then use that variable, I get the error: Example: https://play.golang.org/p/-XFNZHK476 <code>  time.Date(2016, 1, 1, 0, 0, 0, 0, time.UTC) cannot use mStr (type int) as type time.Month in argument to time.Date",Use int as month when constructing date
Gorm: separate where in query," I need to separate where to validates values with conditional, Example That returns two queries:1: SELECT ""users"".* FROM ""users"" WHERE users.email LIKE '%test@test.com%'2: SELECT ""users"".* FROM ""users"" WHERE users.name LIKE '%jhon%'but I need the result in only one query: Thanks! <code>  email := ""test@test.com""if email != """" { db.Where(""users.email LIKE ?"", ""%""+email+""%"")}db.Where(""users.name like ?"", ""%""+jhon+""%"").Find(&users) SELECT ""users"".* FROM ""users"" WHERE users.email LIKE '%test@test.com%' and users.name LIKE '%jhon%'",Separate where in query
golang: why Map and type assertion can return 1 or 2-value," To define a map, we can do such a thing:value, present := m[""key""]or:value := m[""key""]and with type assertion, we can do: but I can't find a way to define a func that can return 1 value or 2-values. For instance: When I invoke this func I get: PS: I know how something like template.Must works, but it seems different. I really want to know how Map and type assertion can do the magic, so I can apply it to functions.Thanks in advance. (Am I clear? I have poor English sorry). <code>  var i interface{} = ""hello""s := i.(string)fmt.Println(s)s, ok := i.(string)fmt.Println(s, ok) func hello() (string, error) { return ""world"", nil} v, ok := hello() // validv := hello() // invalid",Why map and type assertion can return 1 or 2 values?
Why map and type assertion can return 1 or 2-value," To define a map, we can do such a thing:value, present := m[""key""]or:value := m[""key""]and with type assertion, we can do: but I can't find a way to define a func that can return 1 value or 2-values. For instance: When I invoke this func I get: PS: I know how something like template.Must works, but it seems different. I really want to know how Map and type assertion can do the magic, so I can apply it to functions.Thanks in advance. (Am I clear? I have poor English sorry). <code>  var i interface{} = ""hello""s := i.(string)fmt.Println(s)s, ok := i.(string)fmt.Println(s, ok) func hello() (string, error) { return ""world"", nil} v, ok := hello() // validv := hello() // invalid",Why map and type assertion can return 1 or 2 values?
"Why map and type assertion can return 1 or 2-value, but I can't find a way to define a func that can return 1 value or 2-values?"," To define a map, we can do such a thing:value, present := m[""key""]or:value := m[""key""]and with type assertion, we can do: but I can't find a way to define a func that can return 1 value or 2-values. For instance: When I invoke this func I get: PS: I know how something like template.Must works, but it seems different. I really want to know how Map and type assertion can do the magic, so I can apply it to functions.Thanks in advance. (Am I clear? I have poor English sorry). <code>  var i interface{} = ""hello""s := i.(string)fmt.Println(s)s, ok := i.(string)fmt.Println(s, ok) func hello() (string, error) { return ""world"", nil} v, ok := hello() // validv := hello() // invalid",Why map and type assertion can return 1 or 2 values?
golang check if all items in a slice are equal," I need to create a function that: The only way I can think of doing it is to reverse the slice, and compare the slice and the reversed slice.Is there a better way to do this thats good syntax and more efficient? <code>  returns true if all elements in a slice are equal (they will all be the same type)returns false if any elements in a slice are different",Check if all items in a slice are equal
GoLang Convert String to io.Writer?, Is it possible to convert a string to an io.Writer type in Golang?I will be using this string in fmt.Fprintf() but I am unable to convert the type. <code> ,Golang Convert String to io.Writer?
Golang: http.Redirect() with headers," I have a web page that emulates authorizing API access. The user enters an API url and an authorization key (let's say ""true"" or ""false""). On the Go side, there's a handler function for this path which reads the form and generates a token based on the authorization key.Ideally, I'd like to save the token as a header and redirect the request to the proper handler based on the API url entered. However, when I use http.Redirect(), my header does not get sent as part of the request. There may be several API urls with different paths, but my thought process has the token being written as a header in that same handler function every time. I'm designing it this way because the API url may eventually redirect to different domains, so I'd like to keep it separate from reading the form.Google tells me to use Client.CheckRedirect somehow, but I'm not sure how to implement it in my handler functions. How can I redirect while keeping my headers? Thank you! <code>  func createTokenHandler(w http.ResponseWriter, r *http.Request) { r.ParseForm() path := r.FormValue(""path"") auth := r.FormValue(""auth"") // let's say ""true"" or ""false"" w.Header().Set(""auth"", auth) http.Redirect(w, r, path, http.StatusFound) // is this the correct http code?}// path redirects to this handlerfunc otherPathHandler(w http.ResponseWriter, r *http.Request) { // these were necessary for cross-domain requests to work with custom header, keeping them w.Header().Set(""Access-Control-Allow-Origin"", ""*"") w.Header().Set(""Access-Control-Allow-Headers"", ""auth"") auth = r.Header.Get(""auth"") if auth == ""true"" { w.Write([]byte(""Validated, here's the API response."")) // continue }}",http.Redirect() with headers
Go: convert string to float32?," There is an input that I need to read from the console as a string, then manipulate the string and convert some of it to float32.I have tried using: But it does not work. This is the error I get: cannot use float (type float64) as type float32 in field valueIs there anything else I could do?Thanks! <code>  float, _ := strconv.ParseFloat(myString, 32)",Convert string to float32?
How to iterate (access elements in) channels without closing.," I am new to go and I am trying to create a simple chat server where clients can broadcast messages to all connected clients. In my server, I have a goroutine (infinite for loop) that accepts connection and all the connections are received by a channel. Then, I start a handler (goroutine) for every connected client. Inside the handler, I try to broadcast to all connections by iterating through the channel. However, I cannot broadcast because (I think from reading the docs) the channel needs to be closed before iterating. I am not sure when I should close the channel because I want to continuously accept new connections and closing the channel won't let me do that. If anyone can help me, or provide a better way to broadcast messages to all connected clients, it would be appreciated.  <code>  go func() { for { conn, _ := listener.Accept() ch <- conn }}() for c := range ch { conn.Write(msg)}",How to broadcast message using channel
Golang project's main thread sleep forever?," Is there any API to let the main goroutine sleep forever? In other words, I want my project always run except when I stop it. <code> ",Go project's main goroutine sleep forever?
Golang project's main goroutine sleep forever?," Is there any API to let the main goroutine sleep forever? In other words, I want my project always run except when I stop it. <code> ",Go project's main goroutine sleep forever?
How to interpret golang stacktrace," I am getting this stacktrace when running a go program: The signature of the Event function is: which can also be seen here: https://github.com/DataDog/datadog-go/blob/cc2f4770f4d61871e19bfee967bc767fe730b0d9/statsd/statsd.go#L285The type definition for Event can be seen here: https://github.com/DataDog/datadog-go/blob/cc2f4770f4d61871e19bfee967bc767fe730b0d9/statsd/statsd.go#L333The type definition for Client can be seen here: https://github.com/DataDog/datadog-go/blob/cc2f4770f4d61871e19bfee967bc767fe730b0d9/statsd/statsd.go#L59My question is, how do I interpret the memory addresses on this line, and more generally, any stack traces which involve typed variables as targets and as arguments? When I looked at http://www.goinggo.net/2015/01/stack-traces-in-go.html (which is the only information I was able to find on the subject), I didn't see anything about how to interpret the output when structs were involved. <code>  /home/travis/.gimme/versions/go1.6.linux.amd64/src/runtime/panic.go:464 +0x3e6github.com/DataDog/datadog-go/statsd.(*Client).Event(0x0, 0xc8200c7ec8, 0x0, 0x0) /home/travis/gopath/src/github.com/DataDog/datadog-go/statsd/statsd.go:286 +0x11fgithub.com/some/path/server.(*Server).buildAndUpdate(0xc820024068, 0xc820064600, 0x0, 0x0) /home/travis/gopath/src/github.com/some/path/server/http.go:86 +0xf9fcreated by github.com/some/path/server.(*Server).processPullRequestEvent /home/travis/gopath/src/github.com/some/path/server/http.go:169 +0x53f func (c *Client) Event(e *Event) error github.com/DataDog/datadog-go/statsd.(*Client).Event(0x0, 0xc8200c7ec8, 0x0, 0x0)",How to interpret Go stacktrace
Exact width of formatted floats," I am trying to get some floats formatted with the same width using fmt.Printf().For example, given the float values 0.0606060606060606, 0.3333333333333333, 0.05, 0.4 and 0.1818181818181818, I would like to get each value formatted in, say, 10 runes: But I can't understand how it's done. Documentation says that For floating-point values, width sets the minimum width of the field and precision sets the number of places after the decimal, if appropriate, except that for %g/%G it sets the total number of digits. For example, given 123.45 the format %6.2f prints 123.45 while %.4g prints 123.5. The default precision for %e and %f is 6; for %g it is the smallest number of digits necessary to identify the value uniquely.So, if I use %f a larger number will not fit in 10-character constraint, therefore %g is required. To get a minimum width of 10 is %10g and to get a maximum number of 9 digits (+1 for the dot) it's %.9g, but combining them in %10.9g is not behaving as I expect How come I get strings which are of 10 runes, others that are 11 runes and others that are 12 runes?In particular, it seems that %.9g does not produce 9 digits in total. See for example: http://play.golang.org/p/ie9k8bYC7r <code>  0.060606060.33333333 0.05 0.40.18181818 0.06060606060.333333333 0.05 0.40.181818182",fmt.Printf with width and precision fields in %g behaves unexpectedly
Why can't I access this field in a struct/interface?," I am trying to understand interfaces better and am not understanding why s has no field Width. My example is here: Why does r have Width but s doesn't? The exact error I get is: <code>  package mainimport ""fmt""type shapes interface { setWidth(float64)}type rect struct { Width float64}func (r *rect) setWidth(w float64) { r.Width = w}var allShapes = map[string]shapes{ ""rect"": &rect{},}func main() { r := &rect{} r.setWidth(5) fmt.Println(r.Width) // this works for _, s := range allShapes { s.setWidth(7) fmt.Println(s.Width) // why not??? }} s.Width undefined (type shapes has no field or method Width)",Why can't I access this field in an interface?
what the difference between := and = in go?," I am new to Go programming language. I noticed something strange in Go: I thought that it used := and substitutes = in Python, but when I use = in Go it is also works. What is the difference between := and =? <code> ",What is the difference between := and = in Go?
what is the difference between := and = in go?," I am new to Go programming language. I noticed something strange in Go: I thought that it used := and substitutes = in Python, but when I use = in Go it is also works. What is the difference between := and =? <code> ",What is the difference between := and = in Go?
golang changing values of a struct inside a method of another struct," I have an issue with structs and maybe an issue with pointers, if my guess is correct.This struct has some fields and a field that holds a slice: This Connection looks like this: My problem is changing the value of connactive to true.Bot has a method that listens to the connection: And connection.activeConn() is the part that is not working correctly the method looks like this: This actually gets executed so it's not an issue of the connection not getting a response or something.But if I try to loop through it later in a method of Bot, connactive is always false for some reason (which is the default). I think I am working with a copy or so of the original connection and not the changed connection that has connactive = true.Any ideas? Thanks for the help. <code>  type Bot struct { // ... connlist []Connection} type Connection struct { conn net.Conn messages int32 channels []string joins int32 connactive bool} func (bot *Bot) ListenToConnection(connection Connection) { reader := bufio.NewReader(connection.conn) tp := textproto.NewReader(reader) for { line, err := tp.ReadLine() if err != nil { log.Printf(""Error reading from chat connection: %s"", err) break // break loop on errors } if strings.Contains(line, ""tmi.twitch.tv 001"") { connection.activateConn() } if strings.Contains(line, ""PING "") { fmt.Fprintf(connection.conn, ""PONG tmi.twitch.tv\r\n"") } fmt.Fprintf(bot.inconn, line+""\r\n"") }} func (connection *Connection) activateConn() { connection.connactive = true} for i := 0; i < len(bot.connlist); i++ { log.Println(bot.connlist[i].connactive)}",Golang changing values of a struct inside a method of another struct
golang time.Since() with months and years," I am trying to convert a timestamp like this: to a time since format so it would say like 9 months ago 1 day 2 hours 30 minutes 2 seconds.something like that.I used time.Parse and time.Since to get to this: But how do I convert from there on? Something like this is what I thought: But the issue with this is that this won't be accurate for months because months can have 28, 30 and 31 days.Is there a better way of achieving what I want? <code>  2015-06-27T09:34:22+00:00 6915h7m47.6901559s for hours > 24 { days++ hours -= 24}",time.Since() with months and years
Golang time.Since() with months and years," I am trying to convert a timestamp like this: to a time since format so it would say like 9 months ago 1 day 2 hours 30 minutes 2 seconds.something like that.I used time.Parse and time.Since to get to this: But how do I convert from there on? Something like this is what I thought: But the issue with this is that this won't be accurate for months because months can have 28, 30 and 31 days.Is there a better way of achieving what I want? <code>  2015-06-27T09:34:22+00:00 6915h7m47.6901559s for hours > 24 { days++ hours -= 24}",time.Since() with months and years
How to serve http partial content with Go," I have a webserver written in go and I'm serving some audio files from different sources (local, other servers, S3). I want to enable serving partial content for this files so the HTML audio tags are able to seek and loop.How can I achive this? I know that the http package ServeContent function does this but how can I do it by serving the files myself? I need to do it without this so that I can serve files from different sources with the same handler. <code> ",How to serve http partial content with Go?
Why goes golang allow named slice type assignment without explicit type conversion?, I thought go didn't allow any named type to actual type assignment without explicit type conversion. But how does it compile without an error if I assign []byte to json.RawMessage? https://play.golang.org/p/oD5LwJl7an <code>  var a json.RawMessage // type RawMessage []bytevar b []bytea = bvar x time.Duration // type Duration int64var y int64x = y // ERROR: cannot use y (type int64) as type time.Duration in assignment,Why does golang allow named slice type assignment without explicit type conversion?
Change color of a single pixel - Go lang image," I want to open jpeg image file, encode it, change some pixel colors, and then save it back as it was.I'd like to do something like this I just can't come up with a working solution, since default image type that I get after encoding image-file doesn't have Set method.Can anyone explain how to do this? Thanks a lot. <code>  imgfile, err := os.Open(""unchanged.jpeg"")defer imgfile.Close()if err != nil { fmt.Println(err.Error())}img,err := jpeg.Decode(imgfile)if err != nil { fmt.Println(err.Error())}img.Set(0, 0, color.RGBA{85, 165, 34, 1})img.Set(1,0,....)outFile, _ := os.Create(""changed.jpeg"")defer outFile.Close()jpeg.Encode(outFile, img, nil)",Change color of a single pixel - Golang image
Call golang call jsonrpc with curl," I have ""hello world"" rpc service written in golang. It works fine and go jsonrpc client is working. But I need to send request with curl and this example doesn't work: Go accept connection but produce absolutely no result: Here my go code: <code>  curl \-X POST \-H ""Content-Type: application/json"" \-d '{""id"": 1, ""method"": ""Test.Say"", ""params"": [{""greet"": ""world""}]}' \http://localhost:1999/_goRPC_ curl: (52) Empty reply from server package mainimport ( ""log"" ""os"" ""time"" ""net"" ""net/rpc"" ""net/rpc/jsonrpc"")// RPC Api structuretype Test struct {}// Greet method argumentstype GreetArgs struct { Name string}// Grret message accept object with single param Namefunc (test *Test) Greet(args *GreetArgs, result *string) (error) { *result = ""Hello "" + args.Name return nil}// Start server with Test instance as a servicefunc startServer(ch chan<- bool, port string) { test := new(Test) server := rpc.NewServer() server.Register(test) listener, err := net.Listen(""tcp"", "":"" + port) if err != nil { log.Fatal(""listen error:"", err) } defer listener.Close() for { conn, err := listener.Accept() if err != nil { log.Fatal(err) } go server.ServeCodec(jsonrpc.NewServerCodec(conn)) ch <- true }}// Start client and call Test.Greet methodfunc startClient(port string) { conn, err := net.Dial(""tcp"", "":"" + port) if err != nil { panic(err) } defer conn.Close() c := jsonrpc.NewClient(conn) var reply string var args = GreetArgs{""world""} err = c.Call(""Test.Greet"", args, &reply) if err != nil { log.Fatal(""arith error:"", err) } log.Println(""Result: "", reply)}func main() { if len(os.Args) < 2 { log.Fatal(""port not specified"") } port := os.Args[1] ch := make(chan bool) go startServer(ch, port) time.Sleep(500 * time.Millisecond) go startClient(port) // Produce log message each time connection closes for { <-ch log.Println(""Closed"") }}",Call golang jsonrpc with curl
What do 2 time structs with the same date and time return false when compared with ==?," I have a time.Time created using time.Date(). I then calculate the number of nanoseconds between 1970/1/1 00:00:00.000000000 and that time.I then take the nanoseconds and turn them back into a time.Time using time.Unix().However, if I compare the reconstituted time with the original using ==, it returns false. If I subtract these 2 times, the resulting duration is 0. If I compare these 2 times using time.Equal(), it returns true.If I create another time using time.Date() with the same values as the first time, using == to compare this new time and the original time results in a true.This is the code that demonstrates this (Golang Playground): Why does the reconstituted time return false when compared with the original time? <code>  package mainimport ( ""fmt"" ""time"")func main() { t1 := time.Date(2016, 4, 14, 1, 30, 30, 222000000, time.UTC) base := time.Date(1970, 1, 1, 0, 0, 0, 0, t1.Location()) nsFrom1970 :=t1.Sub(base).Nanoseconds() // Calculate the number of nanoseconds from 1970/1/1 to t1 t2 := time.Unix(0, nsFrom1970) fmt.Println(t1) fmt.Println(t2) fmt.Println(t1.Sub(t2)) // 0 fmt.Println(t1 == t2) //false fmt.Println(t1.Equal(t2)) //true t3 := time.Date(2100, 2, 1, 21, 21, 21, 222000000, time.UTC) fmt.Println(t1 == t3) //true}",Why do 2 time structs with the same date and time return false when compared with ==?
Pakage for verifying Google sign-in token in Go running on GAE, I have successfully received google sign-in token from my Android app on my web server written in Go running on GAE. I do not wish to use the because it has the issue about latency and potential network errors warned on google sign-in integration guiding page. So I am finding the way to use Google API Client Library for Go and I found this I found that it was more complicated than the Java and Python Google API Client Library that I would need to just call the GoogleIdTokenVerifier method or verify_id_token function to get the information of the google user that has signed in on the Android app. I am not sure I am going to the right direction. Please guide me on how to verify the google sign-in token received from Android app. <code>  https://www.googleapis.com/oauth2/v3/tokeninfo?id_token=XYZ123 https://github.com/google/google-api-go-client/blob/master/GettingStarted.md,Package for verifying Google sign-in token in Go running on GAE
Find K shortest paths taking departure and arrival time into account," I know there are some questions and posts/articles regarding this question, but from my newbie view, not exactly.The thing is, I've got a main program listening to a port and redirecting the calls to a specific handler. The typical structure: With the handler being something like: Then somepackage, which contains the function foo, has some global variables, basically because they're needed for functions to share (e.g., when using a priority queue implemented with a container/heap, which will get the priorities in the Swap function from a global matrix of distances which is of course changable). And many other examples. In summary, global variables...The problem is, as you might see, that those variables are shared among all the calls to the handler. And that's bad.How can I actually solve this? There must be an easy to way to do it that I haven't got to yet, because it looks like something so usual...Thanks in advance.EDITTo make it clearer. For example, in my A* package, I've got the following global variables: Then, PriorityQueueAStar is implemented as follows: The question then, is, how do I keep doing this without having all those maps as global variables? If they are part of the struct, how do I access the struct from the priority queue functions? <code>  func main() { http.HandleFunc(""/something"", specificHandler) http.ListenAndServe("":8080"", nil)} func specificHandler(w http.ResponseWriter, r *http.Request) { somepackage.foo()} var openVerticesAS PriorityQueueAStar// which vertices are closedvar closedVertices map[int]bool// which vertices are currently openvar openVertices map[int]bool// cost from start to nodevar gScore map[int]float64// cost from start to end, passing by node i (g+h)var fScore map[int]float64 type PriorityQueueAStar []int // rel idfunc (pq PriorityQueueAStar) Len() int { return len(pq) }func (pq PriorityQueueAStar) Empty() bool { return len(pq) == 0 }func (pq PriorityQueueAStar) Less(i, j int) bool { return fScore[pq[i]] < fScore[pq[j]]}func (pq PriorityQueueAStar) Swap(i, j int) { pq[i], pq[j] = pq[j], pq[i]}func (pq *PriorityQueueAStar) Push(x interface{}) { *pq = append(*pq, x.(int))}func (pq *PriorityQueueAStar) Pop() interface{} { old := *pq n := len(old) rel := old[n-1] *pq = old[0 : n-1] return rel}func (pq PriorityQueueAStar) Top() interface{} { return pq[0]}",Usage of global variables with Http handlers in Golang
"In golang, is there a way to check whether value is pointer field?"," I have a slice of interface{} and I need to check whether this slice contains pointer field values.Clarification example: <code>  var str *strings := ""foo""str = &svar parms = []interface{}{""a"",1233,""b"",str}index := getPointerIndex(parms)fmt.Println(index) // should print 3","In Go, how do I check a value is of (any) pointer type?"
"In Go, is there a way to check whether value is pointer field?"," I have a slice of interface{} and I need to check whether this slice contains pointer field values.Clarification example: <code>  var str *strings := ""foo""str = &svar parms = []interface{}{""a"",1233,""b"",str}index := getPointerIndex(parms)fmt.Println(index) // should print 3","In Go, how do I check a value is of (any) pointer type?"
How To replace all charecters in a string in golang," How to replace all characters in string ""golang"" (above string) by * that is it should look like ""******""? <code>  package mainimport ( ""fmt"" ""strings"")func main() { fmt.Println(strings.Replace(""golang"", ""g"", ""1"", -1))}",How to replace all characters in a string in golang
Golang - Don't escape in HTML templates," Trying to render HTML templates for sending via email with embedded attachments with cid:. Problem is, that Go does escaping and I cannot do anything. My testing template looks more less like this: Output is: If text is outside attribute context, it is evaluated correctly, but when it is an src attribute it always become that error string. I tried also change value from string to template.HTMLAttr but nothing happen. Cid value is always evaluated to that error output #ZgotmplZ. <code>  tplVars := map[string]interface{}{ ""Dog"": ""cid:dog.png"", ""Cat"": ""cid:cat.png"",} Dog: <img src=""{{.Dog}}"">Cat: {{.Cat}} Dog: <img src=""#ZgotmplZ"">Cat: cid:cat.png",How to not escape in HTML templates
How can I properly write the `Read` and `Write` in this test," I'm trying out the net.Pipe(). I thought writing the ""haha"" string and then reading it back might be a good experiment.Here is my first version. It blocks on the Write I tried to use a goroutine It works. But I felt there is no guarantee that the Read will read the whole ""haha"" string. It might only read the ""hah"" part.I'm wondering if there is a better way to demo the usage of net.Pipe() <code>  func TestNetPipe(t *testing.T) { out1 := make([]byte, 10) c1, c2 := net.Pipe() c1.Write([]byte(""haha"")) c2.Read(out1)} func TestNetPipe(t *testing.T) { out1 := make([]byte, 10) c1, c2 := net.Pipe() go func() { c1.Write([]byte(""haha"")) }() fmt.Printf(""%v\n"", out1) c2.Read(out1) fmt.Printf(""%v\n"", out1)}",How can I properly write the `Read` and `Write` the `net.Pipe()`
Do Go `testing.B` benchmarks prevent unwanted optimizations?," I've recently started learning Go and I'm trying to implement a map that can be used concurrently by multiple groutines. I want to be able to compare my implementation to a simple sync.Mutex-protected map, or to something like this: https://github.com/streamrail/concurrent-map/blob/master/concurrent_map.goFrom using Google Caliper, I assume that a naive approach for benchmarking would allow many unwanted optimizations to trash the actual results. Are the benchmarks that use testing.B employing some of the techniques to avoid that (after all both Go and Caliper are Google projects)? If yes, are they known? If not, what's the best way to microbenchmark in Go? <code> ",Do Go testing.B benchmarks prevent unwanted optimizations?
Golang: time.Time Round to Day," I have a timestamp coming in, I wonder if there's a way to round it down to the start of a day in PST. For example, ts: 1305861602 corresponds to 2016-04-14, 21:10:27 -0700, but I want to round it to a timestamp that maps to 2016-04-14 00:00:00 -0700. I read through the time.Time doc but didn't find a way to do it. <code> ",time.Time Round to Day
Go: Why defer in range loop is called in a reverse order?," I've run across an answer on a question about ""reverse range"" and I was going to down-vote it as it seemed ridiculously wrong but checked and it actually works(!):https://play.golang.org/p/4K2fDlSoCm And the output is: Any ideas why it works this way? Am I right it's not guaranteed to be executed exactly in the reverse order? Also I don't think it's a good way to write programs but curious to find why are we getting this result. <code>  package mainimport ( ""fmt"")func main() { s := []int{1, 2, 3, 4, 5} for i, _ := range s { defer fmt.Println(s[i]) }} 54321Program exited.",Why defer in range loop is called in a reverse order?
Is it possible to have a struct with multiple JSON tags," I post a request to a server and get a reply in JSON format. I'm able to unmarshal it to a struct. Then I need to create a new JSON file with the same data but different JSON tags. Example:In the following code, I get {""name"":""Sam"",""age"":20} from a server and unmarshal it to the struct Foo: Then I need to change the tag name to employee_name and omit age: After that I send this modified data to another server.I know I could just create a new Bar and copy all data into it, but there are a lot of fields. I was wondering if there is a way to attach multiple JSON tags like this: Thanks in advance. <code>  type Foo struct { Name string `json:""name""` Age int `json:""age""`} type Bar struct { Name string `json:""employee_name""` Age int `json:""-""`} type Foo struct { Name string `json:""name"" json:""employee_name""` Age int `json:""age"" json:""-""`} ",Is it possible to have a struct with multiple JSON tags?
How to set default values in golang structs, There are multiple answers/techniques to the below question:How to set default values to golang structs?How to initialize structs in golangI have a couple of answers but further discussion is required. <code> ,How to set default values in Go structs
Go: Should I use an interface to allow for mocking?," I'm writing a JSON validator in Go, and I want to test another object that interacts with my Validator. I've implemented the Validator as a struct with methods. To allow me to inject a mock Validator into another object, I've added an interface, which the Validator implements. I've then swapped argument types to expect the interface. One of my mocks looks like this: This works, but it doesn't feel quite right. Collaborators won't see anything other than my concrete type in production code; I've only introduced the interface to suit the test. If I do this everywhere, I feel like I'll be repeating myself by writing interfaces for methods that will only ever have one real implementation.Is there a better way to do this? <code>  // Validator validates JSON documents.type Validator interface { // Validate validates a decoded JSON document. Validate(doc interface{}) (valid bool, err error) // ValidateString validates a JSON string. ValidateString(doc string) (valid bool, err error)}// SchemaValidator is a JSON validator fixed with a given schema.// This effectively allows us to partially apply the gojsonschema.Validate()// function with the schema.type SchemaValidator struct { // This loader defines the schema to be used. schemaLoader gojsonschema.JSONLoader validationError error}// Validate validates the given document against the schema.func (val *SchemaValidator) Validate(doc interface{}) (valid bool, err error) { documentLoader := gojsonschema.NewGoLoader(doc) return val.validate(documentLoader)}// ValidateString validates the given string document against the schema.func (val *SchemaValidator) ValidateString(doc string) (valid bool, err error) { documentLoader := gojsonschema.NewStringLoader(doc) return val.validate(documentLoader)} // PassingValidator passes for everything.type PassingValidator bool// Validate passes. Alwaysfunc (val *PassingValidator) Validate(doc interface{}) (valid bool, err error) { return true, nil}// ValidateString passes. Alwaysfunc (val *PassingValidator) ValidateString(doc string) (valid bool, err error) { return true, nil}",Should I use an interface to allow for mocking?
golang :how do i handle index out of range error?," I am writing a CLI interface program in Go.my program requires a user to enter a filename as an argument . following is the code I wrote to handle the situations in which user doesn't enter any argument . but it panics and gives an error ""index out of range"".how do I handle this? <code>  package mainimport ( ""encoding/hex"" ""fmt"" ""io/ioutil"" ""log"" ""os"")func main() { if len(os.Args) == 0 { fmt.Println(""usage: gohex <filename>"") os.Exit(1) } else { filename := os.Args[1] data, err := ioutil.ReadFile(filename) if err != nil { log.Fatal(err) } fmt.Println(hex.Dump(data)) }}",golang :how do I handle index out of range error?
Difference between initialization and zeroing in GoLang," I am coming from C# background, and I am little confused with the way of GoLang initialization and zeroing definitions. I think you can guess that this confusion arises from make() and new() functions in Go. What should I expect happening internally when these methods run? What happens when initialization and zeroing happens? I know that there is an init() function in GoLang that is used to initialize packages. But I think it is different than this. Anyways, what is the difference between them?UpdateI answered my own question, please check it to see my answer. <code> ","Difference between initialization and zeroing, and new() and make() in GoLang"
Golang dup one struct to another," I have two struct having the same members, I want to copy one struct to another, see the pseudo code below: Then I have foo of struct Foo, and bar of struct Bar, Is there any way to copy bar from foo? <code>  type Common struct { Gender int From string To string}type Foo struct { Id string Name string Extra Common}type Bar struct { Id string Name string Extra Common}",Copy one struct to another where structs have same members and different types
Golang copy one struct to another," I have two struct having the same members, I want to copy one struct to another, see the pseudo code below: Then I have foo of struct Foo, and bar of struct Bar, Is there any way to copy bar from foo? <code>  type Common struct { Gender int From string To string}type Foo struct { Id string Name string Extra Common}type Bar struct { Id string Name string Extra Common}",Copy one struct to another where structs have same members and different types
Jenkin build setup for Go Projects," We are planning to setup Jenkin Build process for Go Projects. I setup Custom Workspace in jenkins and installing go1.6 from ""Global Tool Configuration"".I am getting error message while executing go buildBelow is the GOPATH and GOROOT What I am missing here?.. Thanks for your help.. <code>  GOPATH /var/lib/jenkins/workspace/project/goGOROOT /var/lib/jenkins/workspace ain.go:20:2: cannot find package ""bytes"" in any of: /var/lib/jenkins/workspace/src/pkg/bytes (from $GOROOT) /var/lib/jenkins/workspace/project/go/src/bytes (from $GOPATH)",Jenkins build setup for Go Projects
How create rsa private key with passphrase in golang, How to create RSA private key with passphrase in Go?I read the documentation for the crypto package but I was unable to piece together a solution from it. <code> ,How to create RSA private key with passphrase in Go?
Golang mixed assignation and declaration," I started working with go for a few weeks, and (once again) I stumbled across something that seems odd for me: playgroundI want to assign two variables simultaneously.One is already declared, in a superior scope, the other one is not.It does not work: the compiler tries to redeclare the former variable.However, it works fine if this variable is declared in the same scope.Why is that? <code>  // Not workinga := 1{ a, b := 2, 3}// Worksa := 1a, b := 2, 3",Golang mixed assignment and declaration
Golang - Cannot free memory once occupied by bytes.Buffer," I receive bytes of compressed ASCII text in compressedbytes of type []byte. The problem I face is that the following procedure occupies a lot of memory that does not get freed after the function reaches its end and remains occupied during the whole runtime of the program. I noticed that the type in use is bytes.Buffer and this type has the Reset() and Truncate() functions but none of them allows to free the memory that is once occupied.The documentation of Reset() states the following: Reset resets the buffer to be empty, but it retains the underlying storage for use by future writes. Reset is the same as Truncate(0).How can I unset the buffer and free the memory again?My program needs about 50MB of memory during the run that takes 2h. When I import strings that are zlib compressed the program needs 200 MB of memory.Thanks for your help.=== UpdateI even created a separate function for the decompression and call the garbage collector manually with runtime.GC() after the program returns from that function without success.  <code>  b := bytes.NewReader(compressedbytes) r, err := zlib.NewReader(b) if err != nil { panic(err) } cleartext, err = ioutil.ReadAll(r) if err != nil { panic(err) } // unpack decompresses zlib compressed bytesfunc unpack(packedData []byte) []byte { b := bytes.NewReader(packedData) r, err := zlib.NewReader(b) if err != nil { panic(err) } cleartext, err := ioutil.ReadAll(r) if err != nil { panic(err) } r.Close() return cleartext}",Cannot free memory once occupied by bytes.Buffer
Call all functions with special prefix in Golang," I have a package named ""seeder"": Now I want to call all functions with MyFunc prefix I want something like this: and this output: EDIT1:In this example, parentKey is a string variable which changed in a loop But GC said: use of package seeder without selector <code>  package seederimport ""fmt""func MyFunc1() { fmt.Println(""I am Masood"")}func MyFunc2() { fmt.Println(""I am a programmer"")}func MyFunc3() { fmt.Println(""I want to buy a car"")} package mainimport ""./seeder""func main() { for k := 1; k <= 3; k++ { seeder.MyFunc1() // This calls MyFunc1 three times }} for k := 1; k <= 3; k++ { seeder.MyFunc + k ()} I am MasoodI am a programmerI want to buy a car for parentKey, _ := range uRLSjson{ pppp := seeder + ""."" + strings.ToUpper(parentKey) gorilla.HandleFunc(""/"", pppp).Name(parentKey)}",Call functions with special prefix/suffix
Call all functions with special prefix or sufix in Golang," I have a package named ""seeder"": Now I want to call all functions with MyFunc prefix I want something like this: and this output: EDIT1:In this example, parentKey is a string variable which changed in a loop But GC said: use of package seeder without selector <code>  package seederimport ""fmt""func MyFunc1() { fmt.Println(""I am Masood"")}func MyFunc2() { fmt.Println(""I am a programmer"")}func MyFunc3() { fmt.Println(""I want to buy a car"")} package mainimport ""./seeder""func main() { for k := 1; k <= 3; k++ { seeder.MyFunc1() // This calls MyFunc1 three times }} for k := 1; k <= 3; k++ { seeder.MyFunc + k ()} I am MasoodI am a programmerI want to buy a car for parentKey, _ := range uRLSjson{ pppp := seeder + ""."" + strings.ToUpper(parentKey) gorilla.HandleFunc(""/"", pppp).Name(parentKey)}",Call functions with special prefix/suffix
Call all functions with special prefix or suffix in Golang," I have a package named ""seeder"": Now I want to call all functions with MyFunc prefix I want something like this: and this output: EDIT1:In this example, parentKey is a string variable which changed in a loop But GC said: use of package seeder without selector <code>  package seederimport ""fmt""func MyFunc1() { fmt.Println(""I am Masood"")}func MyFunc2() { fmt.Println(""I am a programmer"")}func MyFunc3() { fmt.Println(""I want to buy a car"")} package mainimport ""./seeder""func main() { for k := 1; k <= 3; k++ { seeder.MyFunc1() // This calls MyFunc1 three times }} for k := 1; k <= 3; k++ { seeder.MyFunc + k ()} I am MasoodI am a programmerI want to buy a car for parentKey, _ := range uRLSjson{ pppp := seeder + ""."" + strings.ToUpper(parentKey) gorilla.HandleFunc(""/"", pppp).Name(parentKey)}",Call functions with special prefix/suffix
Golang: Creating a Constant Type and Restrictiing the Type's Values," I have a question about types of constants which are restricted to certain values and how you accomplish that in Go. Say I create a type unary which has two constant values Positive(1) and Negative(-1) and I want to restrict the user of that type (unary) from creating other values of type unary. Do I achieve this by creating a package and making the values Positive and Negative visible and making the type unary restricted to the containing package? See code below for example Is this the correct way to restrict a type to certain constant values? <code>  package unarytype unary int////not visible outside of the package unaryconst ( Positive unary = 1//visible outside of the package unary Negative unary = -1//visible outside of the package unary)func (u unary) String() string {//visible outside of the package unary if u == Positive { return ""+"" } return ""-""}func (u unary) CalExpr() int {//visible outside of the package unary if u == Positive { return 1 } return -1}",Creating a Constant Type and Restricting the Type's Values
Golang: Creating a Constant Type and Restricting the Type's Values," I have a question about types of constants which are restricted to certain values and how you accomplish that in Go. Say I create a type unary which has two constant values Positive(1) and Negative(-1) and I want to restrict the user of that type (unary) from creating other values of type unary. Do I achieve this by creating a package and making the values Positive and Negative visible and making the type unary restricted to the containing package? See code below for example Is this the correct way to restrict a type to certain constant values? <code>  package unarytype unary int////not visible outside of the package unaryconst ( Positive unary = 1//visible outside of the package unary Negative unary = -1//visible outside of the package unary)func (u unary) String() string {//visible outside of the package unary if u == Positive { return ""+"" } return ""-""}func (u unary) CalExpr() int {//visible outside of the package unary if u == Positive { return 1 } return -1}",Creating a Constant Type and Restricting the Type's Values
Building for ARM?," Whenever I try and use 'go install' after settings goarch, goos and gobin I get 'cannot install cross-compiled binaries when GOBIN is set', but don't understand why?What's the simplest way to build for arm linux? <code> ",Building for ARM? Cannot do cross-compilation with `go install` when GOBIN is set
Go Lang - Convert Hex to ASCII," I'm writing a go program to convert hex to int, binary and ascii. The int and binary worked fine but ascii is causing issues. If the input text is shorter than 2 characters it works fine, but anything longer causes malformed text to appear. My code is as follows: An example of some output when entering hex '73616d706c65': I've done lots of searching and have seen some documentation in regards to 'runes' but i'm unsure as to how this works. Is there a built-in hex encode/decode library that can be used to accomplish this? <code>  package mainimport ""fmt""import ""strconv""func main() { // get input as string fmt.Print(""Enter hex to convert: "") var input_hex string = """" fmt.Scanln(&input_hex) // convert hex to int and print outputs if i, err := strconv.ParseInt(input_hex, 16, 0); err != nil { fmt.Println(err) } else { // int fmt.Print(""Integer = "") fmt.Println(i) // ascii fmt.Print(""Ascii = "") fmt.Printf(""%c"", i) fmt.Println("""") // bin fmt.Print(""Binary = "") fmt.Printf(""%b"", i) fmt.Println(""\n"") }} Enter hex to convert: 73616d706c65Integer = 126862285106277Ascii = Binary = 11100110110000101101101011100000110110001100101",How to convert Hex to ASCII
go / golang: one-liner to transform []int into string," Basically I have []int{1, 2, 3}, I want a one-liner that transforms this into the string ""1, 2, 3"" (I need the delimiter to be custom, sometimes ., sometimes ,, etc). Below is the best I could come up with. Searched online and did not seem to find a better answer.In most languages there is in-built support for this, e.g.:python: go: Surely there must be an utility buried into go that allows me to do this with a one-liner?I know that there is strings.Join(A, "", ""), but that only works if A is already []string. <code>  > A = [1, 2, 3]> "", "".join([str(a) for a in A])'1, 2, 3' package mainimport ( ""bytes"" ""fmt"" ""strconv"")// Could not find a one-liner that does this :(.func arrayToString(A []int, delim string) string { var buffer bytes.Buffer for i := 0; i < len(A); i++ { buffer.WriteString(strconv.Itoa(A[i])) if i != len(A)-1 { buffer.WriteString(delim) } } return buffer.String()}func main() { A := []int{1, 2, 3} fmt.Println(arrayToString(A, "", ""))}",One-liner to transform []int into string
Golang postgres error constants?," I'm trying to delete a database using the postgres driver (lib/pq) by doing a: But I'd like to do a different conditional based on whether the error received is something strange, or is a ""database does not exist"" error.Is there a constant variable or something I can use to check if the error returned is a ""database does not exist"" error message, or would I have to manually parse the error string myself?I tried to look in the documentation, but could not find anything for ""database does not exist"". I did however find this list.Perhaps it fits under some other error code? Also I'm not quite sure the semantically correct way of fetching and comparing the error codes through the Postgres driver. I presume I should do something like this: <code>  db.Exec(""DROP DATABASE dbName;"") if err.ErrorCode != ""xxx""",Does the error returned by db.Exec(...) have a code?
Golang: Two's complement and fmt.Printf," So computers use Two's complement to internally represent signed integers. I.e., -5 is represented as ^5 + 1 = ""1111 1011"".However, trying to print the binary representation, e.g. the following code: Outputs -101. Not quite what I'd expect. Is the formatting different or is it not using Two's complement after all?Interestingly, converting to an unsigned int results in the ""correct"" bit pattern: Output is 11111011 - exactly the 2s complement of -5.So it seems to me the value is internally the really using Two's complement, but the formatting is printing the unsigned 5 and prepending a -. Can somebody clarify this? <code>  var i int8 = -5fmt.Printf(""%b"", i) var u uint8 = uint(i)fmt.Printf(""%b"", u)",Two's complement and fmt.Printf
How to log type assertion errors in golang," I have an array of some data which I want to map in []string. I can do it in 2 ways:a) In this case, the execution would stop after listing the error on the console.b) In this case, no errors would occur but s will have its zero-valueI want to log the errors in such type assertion failure cases without stopping the execution. However, when I am using type (b), I cannot see the error details. The only solution I can think is to use reflect.TypeOf and print both the types. Is there any other way we can get the error when using solution (b)? <code>  // someDatas := someData.([]string) // someDatas, ok := someData.([]string)",How to log type assertion errors in golang?
ugly command for building GO binary," I'm currently taking a microservice online course where I deploy small go apps to docker containers. The long and ugly command line to build the binaries is this one: till now I just used go install to compile my go app.Can anyone explain this command to me? <code>  go build --tags netgo --ldflags '-extldflags ""-lm -lstdc++ -static""'","What do these Go build flags mean? netgo -extldflags ""-lm -lstdc++ -static""'"
golang: Print function that consumes json.RawMessage directrly," I'm doing some work with Elasticsearch and the query return a Source object which it's type is *json.RawMessage.I only want to print it to screen without creating struct model for it and doing the obvious json.Marshal.Is there a print function that will consume *json.RawMessage type and print it to screen?Code sample: This code run will result in un-readable array of bytes, apparently without the ability to just build a string from the raw message. <code>  for _, hit := range serachResult.Hits.Hits { fmt.Println(hit.Source, ""\n"") }",Print function that consumes json.RawMessage directly
golang: Is there a way to iterate over specific month or week," Is there a way, in go, to iterate over a specific month and get all time.Date objects from it?For instance iterate over April will result in 04012016 until 04312016: (Currently the above code will not work obviously).Or if not part of the standard library is there a third party library that equivalent to moment.js? <code>  for _, dayInMonth := range date.April { // do stuff with dates returned}",Is there a way to iterate over specific month or week
How do you write a package with multiple binaries in it?," I've seen this discussed in various places, with answers like 'use a cmd/foo, cmd/bar' type folder structure.This does not work for me. This works: and building it: However, I can't figure out what variation on: I might need to build all such binaries in one step.This layout: Seems totally unusable. No combination of go build ... commands seems to build bin1 or bin2. The best I can get is go build cmd/bin1/main.go which gives me a binary called 'main'. Not helpful.So, specifically and in detail, including the go build command, that actually builds the individual binaries, how do you do this?...and why is the default advice that people keep giving to use a top level cmd folder? How do you build these binaries if you do? <code>  $ du -a8 ./src/cmd/bin1/main.go8 ./src/cmd/bin18 ./src/cmd/bin2/main.go8 ./src/cmd/bin216 ./src/cmd8 ./src/shared/foo/foo.go8 ./src/shared/foo8 ./src/shared24 ./src go build ./src/cmd/bin2go build ./src/cmd/bin1 go build ./src/... $ du -a8 ./cmd/bin1/main.go8 ./cmd/bin18 ./cmd/bin2/main.go8 ./cmd/bin216 ./cmd8 ./src/shared/foo/foo.go8 ./src/shared/foo8 ./src/shared8 ./src24 .",How to build multiple package binaries at once
Golang : How to replace nth char from a string," I want to replace the nth char in the original string. I can access the nth char from the string by using chars[i], but when I assign a value to chars[i], I get an error.  <code>  package mainimport ""fmt""func main() { var chars = ""abcdef"" fmt.Println(string(chars[3])) chars[3] = ""z"" // is not working}",How to replace nth char from a string in Go
How to get yesterday date in golang, How do I get yesterday's date in the time.Time struct in Go? <code> ,How to get yesterday's date in golang?
golang io.ReadCloser to io.ReadSeeker," I'm trying to download a file from S3 and upload that file to another bucket in S3. Copy API won't work here because I've been told not to use it.Getting an object from S3 has a response.Body that's an io.ReadCloser and to upload that file, the payload takes a Body that's an io.ReadSeeker.The only way I can figure this out is by saving the response.Body to a file then passing that file as a io.ReadSeeker. This would require writing the entire file to disk first then reading the entire file from disk which sounds pretty wrong.What I would like to do is: Question is, how do I go from an io.ReadCloser to an io.ReadSeeker in the most efficient way possible?  <code>  resp, _ := conn.GetObject(&s3.GetObjectInput{Key: ""bla""})conn.PutObject(&s3.PutObjectInput{Body: resp.Body}) // resp.Body is an io.ReadCloser and the field type expects an io.ReadSeeker",How do I go from io.ReadCloser to io.ReadSeeker?
Golang check if unmarshaled json's type is nil," When unmarshalling a string of json, using Golang's json.Unmarshal() function, I always unmarshal the string into a map[string]interface{} - I'm not sure weather there is a more optimal way of decoding json.To get to the point: Sometimes the json's unmarshalled type is nil, not string (or int etc.). This always throws a panic, saying: interface conversion: interface is nil, not intHow can I avoid this panic or check if the interface's type is nil or not?Example:Here is an example of my problem in action: https://play.golang.org/p/0ATzXBbdoS <code> ",Golang check if interface type is nil
"golang counts virtual cores, not physical?"," I have some Go code I am benchmarking on my Macbook (Intel Core i5 processor with two physical cores). Go's runtime.NumCPU() yields 4, because it counts ""virtual cores""I don't know much about virtual cores in this context, but my benchmarks seems to indicate a multiprocessing speedup of only 2x when I configure my code using I get the same performance if I use 2 instead of 4 cores. I would post the code, but I think it's largely irrelevant to my questions, which are:1) is this normal?2) why, if it is, do multiple virtual cores benefit a machine like my macbook?Update:In case it matters, in my code, there are the same number of goroutines as whatever you set runtime.GOMAXPROCS() the tasks are fully parallel, have no interdependencies or shared state. its running as a native compiled binary. <code>  runtime.GOMAXPROCS(runtime.NumCPU())","Go counts virtual cores, not physical?"
How to copy a interface value use go?," How to copy an interface value in Go?My User interface: My Admin struct: I try to copy user1's value.Main Function: How to achieve that changing the copy's name the original doesn't change? <code>  type User interface { Name() string SetName(name string)} type Admin struct { name string}func (a *Admin) Name() string { return a.name}func (a *Admin) SetName(name string) { a.name = name} func main() { var user1 User user1 = &Admin{name:""user1""} fmt.Printf(""User1's name: %s\n"", user1.Name()) var user2 User user2 = user1 user2.SetName(""user2"") fmt.Printf(""User2's name: %s\n"", user2.Name()) // The name will be changed as ""user2"" fmt.Printf(""User1's name: %s\n"", user1.Name()) // The name will be changed as ""user2"" too, How to make the user1 name does not change}",How to copy an interface value in Go?
Golang: How do I check the equality of three values elegantly?," Say I have values a, b and c. I want to find out if they are equal. If I do Then I get a compile error This is pretty obvious, because this parses to: And (a == b) is a bool.Of course I can do: However, this isn't very nice looking and feels confusing. Is there another way? <code>  if a == b == c{...} invalid operation: a == b == c (mismatched types bool and TypeOfABandC) (a == b) == c if a == b && a == c {...}",How do I check the equality of three values elegantly?
Output UUID in golang as a short string," Is there a built in way, or reasonably standard package that allows you to convert a standard UUID into a short string that would enable shorter URL's?I.e. taking advantage of using a larger range of characters such as [A-Za-z0-9] to output a shorter string.I know we can use base64 to encode the bytes, as follows, but I'm after something that creates a string that looks like a ""word"", i.e. no + and /: <code>  id = base64.StdEncoding.EncodeToString(myUuid.Bytes())",Output UUID in Go as a short string
Golang: String date to date," How to convert string date format to date, I have date string in format of: Following I tried with no luck. all above statements are giving parse errors. <code>  YYYY-MM-DD t, err := time.Parse(""%Y-%m-%d"", ""2011-01-19"")t, err := time.Parse(""YYYY-MM-DD"", ""2011-01-19"")t, err := time.Parse(""2016-01-20"", ""2011-01-19"")",Parsing RFC-3339 date string to time.Time
String date to date," How to convert string date format to date, I have date string in format of: Following I tried with no luck. all above statements are giving parse errors. <code>  YYYY-MM-DD t, err := time.Parse(""%Y-%m-%d"", ""2011-01-19"")t, err := time.Parse(""YYYY-MM-DD"", ""2011-01-19"")t, err := time.Parse(""2016-01-20"", ""2011-01-19"")",Parsing RFC-3339 date string to time.Time
How can i add elements to slice reflection?," Hi i am learning Go and i was doing some reflection. I got stuck in a case like this:I want to create a slice of struct passed to function as interface{}Then I want to append new elements to this sliceHere is a playground with the code example. Error: panic: reflect: call of reflect.Append on interface ValueIs there a way to make it work ? Note: that i want to work on a reference.Solution:Here is what i manage to do: playground. <code>  package mainimport ( ""fmt"" ""reflect"")type A struct{ Name string }func main() { bbb(A{})}func aaa(v interface{}) { sl := reflect.ValueOf(v).Elem() typeOfT := sl.Type() ptr := reflect.New(typeOfT).Interface() s := reflect.ValueOf(ptr).Elem() sl.Set(reflect.Append(sl, s)) ptr = reflect.New(typeOfT).Interface() s = reflect.ValueOf(ptr).Elem() sl.Set(reflect.Append(sl, s))}func bbb(v interface{}) { myType := reflect.TypeOf(v) models := reflect.Zero(reflect.SliceOf(myType)).Interface() aaa(&models) fmt.Println(models)}",How can I add elements to slice reflection?
"Regex ""is not a constant"" error in Golang"," I'm trying to write a regex in Go to verify that a string only has alphanumerics, periods, and underscores. However, I'm running into an error that I haven't seen before and have been unsuccessful at Googling.Here's the regex: Here is the error: What does ""not a constant"" mean and how do I fix this? <code>  pattern = regexp.MustCompile(`^[A-Za-z0-9_\.]+`) const initializer regexp.MustCompile(""^[A-Za-z0-9_\\.]+"") is not a constant","Regex ""is not a constant"" compilation error"
Is there anyway to create null terminated string in GOLANG," Is there anyway to create null terminated string in Go?What I'm currently trying is a:=""golang\0"" but it is showing compilation error: <code>  non-octal character in escape sequence: """,Is there anyway to create null terminated string in Go?
go - regex - negative lookbehind alternative," I have a stringcentenaryI'd like to match ten only when it is not preceded by cen.So far I have this regex:(([^c][^e][^n])|^)tenThat returns true in the following cases tenary, blahtenary and false for ctenary, cetenary, centanary <code>  package mainimport ( ""fmt"" ""regexp"")func main() { txt := ""ctenary"" rx := `(([^c][^e][^n])|^)ten` re := regexp.MustCompile(rx) m := re.MatchString(txt) fmt.Println(m)}",Negative lookbehind alternative
How can I fill out this C structure in Go?," I am trying to interface with some C code from Go. Using cgo, this has been relatively straight-forward until I hit this (fairly common) case: needing to pass a pointer to a structure that itself contains a pointer to some data. I cannot seem to figure out how to do this from Go without resorting to putting the creation of the structure into the C code itself, which I'd prefer not to do. Here is a snippet that illustrates the problem: While this compiles fine, trying to run it results in: In my case, the data being passed to the C call doesn't persist past the call (i.e. the C code in question digs into the structure, copies what it needs, then returns). <code>  package main// typedef struct {// int size;// void *data;// } info;//// void test(info *infoPtr) {// // Do something here...// }import ""C""import ""unsafe""func main() { var data uint8 = 5 info := &C.info{size: C.int(unsafe.Sizeof(data)), data: unsafe.Pointer(&data)} C.test(info)} panic: runtime error: cgo argument has Go pointer to Go pointer",How can I fill out void* C pointer in Go?
Go and IN clause in psql," I am trying to execute the following query against the PostgreSQL database in Go using pq driver: where 1, 2, 3 is passed at a slice tags := []string{""1"", ""2"", ""3""}.I have tried many different things like: which results in pq: syntax error at or near ""$1"". I also tried which also fails with pq: invalid input syntax for integer: ""1,2,3""I also tried passing a slice of integers/strings directly and got sql: converting Exec argument #0's type: unsupported type []string, a slice.So how can I execute this query in Go? <code>  SELECT COUNT(id)FROM tagsWHERE id IN (1, 2, 3) s := ""("" + strings.Join(tags, "","") + "")""if err := Db.QueryRow(` SELECT COUNT(id) FROM tags WHERE id IN $1`, s,).Scan(&num); err != nil { log.Println(err)} if err := Db.QueryRow(` SELECT COUNT(id) FROM tags WHERE id IN ($1)`, strings.Join(stringTagIds, "",""),).Scan(&num); err != nil { log.Println(err)}",Go and IN clause in Postgres
Where does the square brackets come from?," The above Go program will print the following output, with slice value inside the square brackets ""[]"". 2009/11/10 23:00:00 [abc edf]And I want to know where in the source code that [] is added into the formatted string. I checked the source code src/fmt/print.go file, but couldn't find the exact line of code that does this. Could anyone provide a hint? <code>  package mainimport ( ""fmt"" ""log"")func main() { a := []string{""abc"", ""edf""} log.Println(fmt.Sprint(a))}",Where do the square brackets come from?
golang: reassigning in pointer method receiver," What I understand about pointer method receiver and non-pointer method receiver is first one can be modified in the method and next one isn't.So, following worked exactly as I expected. It prints hongseok/13 and unknown/0.But, I want to replace whole s in update method at once with reassigning. So, I've just altered update method as bellow. And it doesn't change s in main method and prints double hongseok/13. Above change fix the problem.I think there's no semantic difference. What am I missing? <code>  type student struct { name string age int}func (s *student) update() { s.name = ""unknown"" s.age = 0}func main() { s := student{""hongseok"", 13} fmt.Println(s) s.update() fmt.Println(s)} func (s *student) update() { s = &student{""unknown"", 0}} func (s *student) update() { *s = student{""unknown"", 0}}",Reassigning in pointer method receiver
What is the comparable interface called in golang?," I'm working on a simple linked list implementation in Go for learning purposes. The definition of an element is below: As you can see, the Value can be anything that satisfies the empty interface. Now, as a new feature, I would like to make it so that when you insert a new element into the list, it inserts it in a sorted manner - each element will be <= the next.In order to do this, I wrote the following method: The compiler complains operator < not defined on interface which is fair. So I understand that in my Element typedef, I should restrict Value to types that can be compared using the < operator. I learned this while researching this problem that Go does not support operator overloading - I am not trying to do that. Instead, I am just trying to make sure that Element.Value is a type that can be compared using the < operator. How do I do this?Update:It occurs to me that it might not be too difficult to simple define a new type, based on a built-in, that can be compared through some function. so I wrote this mess (as well as a bunch of other ways of trying to do the same thing): What I would really like is to define an interface, which, if implemented for a type, provides functions LessThan and EqualTo that operate on two instances of that type and provides a bool - something like LessThan(i, j WhatEvers) bool which can be used in place of <. I realize below it's implemented as an instance method - I've tried both ways but no success. With the above, I would use it something like: this.next.Value.LessThan(val) in the Add function. I get either: or Is this possible to use an interface to require that a certain function must exist that operates on two instances of a custom type, or is it only for Methods? <code>  type Element struct { next, prev *Element Value interface{}} func (l *LinkedList) Add(val interface{}) *Element { this := &l.Root e := Element{Value: val} for { if this.next.Value != nil && this.next.Value < val { // <-comparison here this = this.next } else { return l.insert(&e, this) } }} type Comparable interface { LessThan(j interface{}) bool // tried (j Comparable), (j MyInt), etc EqualTo(j interface{}) bool // tried (j Comparable), (j MyInt), etc}type MyInt intfunc (i MyInt) LessThan(j MyInt) bool { return i < j}func (i MyInt) EqualTo(j MyInt) bool { return i == j}type Element struct { next, prev *Element Value Comparable} linkedlist.MyInt does not implement linkedlist.Comparable (wrong type for EqualTo method) have EqualTo(linkedlist.MyInt) bool want EqualTo(interface {}) bool linkedlist.MyInt does not implement linkedlist.Comparable (wrong type for EqualTo method) have EqualTo(linkedlist.MyInt) bool want EqualTo(linkedlist.Comparable) bool",What is the comparable interface called?
How to check for an empty array in golang?," I am calling a function that returns an empty array if there are no values.When I do this it doesn't work: The work around I'm using is: But declaring a variable just to check the return value doesn't seem right. What's the better way to do this? <code>  if r == [] { fmt.Println(""No return value"") } var a [0]intif r == a { fmt.Println(""No return value"") }",How do I check for an empty slice?
GoLang with GoDaddy certificate not configured correctly," in general I got 3 files from GoDaddy:main Certificate fileServer Private KeyBundle filein configured all these files in my Go server in the following way: The web server runs properly, it's currently published at https://myalcoholist.com:443.I validated my SSL using https://www.ssllabs.com/ssltest/analyze.html?d=myalcoholist.com and it's response is This server's certificate chain is incomplete. Grade capped to B.you can go to this link to see the all detailed result.what am I missing? <code>  cert, err := tls.LoadX509KeyPair(""myalcoholist.pem"",""myalcoholist.key"")if err != nil { log.Fatalf(""server: loadkeys: %s"", err)} pem, err := ioutil.ReadFile(""cert/sf_bundle-g2-g1.crt"") if err != nil { log.Fatalf(""Failed to read client certificate authority: %v"", err) } if !certpool.AppendCertsFromPEM(pem) { log.Fatalf(""Can't parse client certificate authority"") } tlsConfig := &tls.Config{ ClientCAs: certpool, Certificates: []tls.Certificate{cert}, } srv := &http.Server{ Addr: ""myalcoholist.com:443"", Handler: n, ReadTimeout: time.Duration(5) * time.Second, WriteTimeout: time.Duration(5) * time.Second, TLSConfig: tlsConfig,}err := srv.ListenAndServeTLS(""cert/myalcoholist.pem"",""cert/myalcoholist.key"")",HTTP SSL with GoDaddy's certificate - This server's certificate chain is incomplete
GoLang with http ssl GoDaddy's certificate - This server's certificate chain is incomplete.," in general I got 3 files from GoDaddy:main Certificate fileServer Private KeyBundle filein configured all these files in my Go server in the following way: The web server runs properly, it's currently published at https://myalcoholist.com:443.I validated my SSL using https://www.ssllabs.com/ssltest/analyze.html?d=myalcoholist.com and it's response is This server's certificate chain is incomplete. Grade capped to B.you can go to this link to see the all detailed result.what am I missing? <code>  cert, err := tls.LoadX509KeyPair(""myalcoholist.pem"",""myalcoholist.key"")if err != nil { log.Fatalf(""server: loadkeys: %s"", err)} pem, err := ioutil.ReadFile(""cert/sf_bundle-g2-g1.crt"") if err != nil { log.Fatalf(""Failed to read client certificate authority: %v"", err) } if !certpool.AppendCertsFromPEM(pem) { log.Fatalf(""Can't parse client certificate authority"") } tlsConfig := &tls.Config{ ClientCAs: certpool, Certificates: []tls.Certificate{cert}, } srv := &http.Server{ Addr: ""myalcoholist.com:443"", Handler: n, ReadTimeout: time.Duration(5) * time.Second, WriteTimeout: time.Duration(5) * time.Second, TLSConfig: tlsConfig,}err := srv.ListenAndServeTLS(""cert/myalcoholist.pem"",""cert/myalcoholist.key"")",HTTP SSL with GoDaddy's certificate - This server's certificate chain is incomplete
What is the meaning of '*' and '&' in Golang?," I am doing the http://tour.golang.org/. Could anyone explain me lines 1,3,5 and 7 this function especially what '*' and '&' do? I mean by mentioning them in a function declaration, what they are supposed/expected to do? A toy example: It seems that they are pointers like what we have in C++. But I cannot connect those concepts to what we have here. In other words, what '*' an '&' do when I use them in function declaration in Go.I know what reference and dereference mean. What I cannot understand is: how we can use pointer to a function is Go. for example line 1 and 7, what these two lines do? Function named intial1 is declared that returns a pointer? and in line 7, we call it with arguments using return function. <code>  1: func intial1(var1 int, var2 int, func1.newfunc[]) *callproperfunction {2:3: addition:= make ([] add1, var1)4: for i:=1;i<var2;i++ {5: var2 [i] = *addtother (randomstring(lengthofcurrent))6: }7: return &callproperfunction {var1 int, var2 int, func1.newfunc[], jackpot}8: }",What is the meaning of '*' and '&'?
Convert interface{} to map in Golang," I am trying to create a function that could accept following Here struct could be any struct not just a specific one.Converting interface to *struct or []*struct is working fine.But giving error for map.After reflect it shows it is map[] but giving error when try to iterate over range.Here is code Is there any way to convert interface{} to map and iterate or get it's elements. <code>  *struct[]*structmap[string]*struct package mainimport ( ""fmt"" ""reflect"")type Book struct { ID int Title string Year int}func process(in interface{}, isSlice bool, isMap bool) { v := reflect.ValueOf(in) if isSlice { for i := 0; i < v.Len(); i++ { strct := v.Index(i).Interface() //... proccess struct } return } if isMap { fmt.Printf(""Type: %v\n"", v) // map[] for _, s := range v { // Error: cannot range over v (type reflect.Value) fmt.Printf(""Value: %v\n"", s.Interface()) } } }func main() { b := Book{} b.Title = ""Learn Go Language"" b.Year = 2014 m := make(map[string]*Book) m[""1""] = &b process(m, false, true)}",How to convert interface{} to map
Go - returning a pointer on stack," In C when I return a pointer of a stack-created variable from a function, the memory discards after the function is returned, thus making the pointer impossible to dereference. But in Go, the compiler is not giving me any errors. Does that mean that this is safe to do? <code>  package mainimport ( ""fmt"")func main() { fmt.Println(*(something()))}func something() *string { s := ""a"" return &s} ",Returning a pointer on stack
Go Programming value error," The Go code is below. Error Message: syntax error: unexpected float64 at end of statement in line 9. I don't know what is wrong. Who know that? <code>  package mainimport ( ""fmt"" ""math"")func pow(x, n, lim float64) float64 { v float64 = math.Pow(x,n) // line 9 if v<lim { return v } else { fmt.Printf(""%g >= %g\n"", v, lim) } return lim }func main() { fmt.Println( pow(3, 2, 10), pow(3, 2, 20), ) }",Unexpected <type> at the end of statement
How do add a text label to an image in Go?," Given image.RGBA, coordinates, and a line of text, how do I add a simple label with any plain fixed font? E.g. Face7x13 from font/basicfont. Alignment doesn't really matter, but best if I could write the label above a line which starts at the coordinates.And I would like to avoid external loadable dependencies like fonts. <code>  package mainimport ( ""image"" ""image/color"" ""image/png"" ""os"")func main() { img := image.NewRGBA(image.Rect(0, 0, 320, 240)) x, y := 100, 100 addLabel(img, x, y, ""Test123"") png.Encode(os.Stdout, img)}func addLabel(img *image.RGBA, x, y int, label string) { col := color.Black // now what?}",How to add a simple text label to an image in Go?
How do add a simple text label to an image in Go?," Given image.RGBA, coordinates, and a line of text, how do I add a simple label with any plain fixed font? E.g. Face7x13 from font/basicfont. Alignment doesn't really matter, but best if I could write the label above a line which starts at the coordinates.And I would like to avoid external loadable dependencies like fonts. <code>  package mainimport ( ""image"" ""image/color"" ""image/png"" ""os"")func main() { img := image.NewRGBA(image.Rect(0, 0, 320, 240)) x, y := 100, 100 addLabel(img, x, y, ""Test123"") png.Encode(os.Stdout, img)}func addLabel(img *image.RGBA, x, y int, label string) { col := color.Black // now what?}",How to add a simple text label to an image in Go?
How can I parse a json that has following field in golang," In Go, how can I parse the following JSON?I know to use struct to parse, but the keys are different for each entry, also they are not fixed, they can be more or less. Thanks for help!  <code>  { ""consul"": [], ""docker"": [], ""etcd"": [""etcd""], ""kubernetes"": [""secure""], ""mantl-api"": [], ""marathon"": [""marathon""], ""mesos"": [""agent"", ""follower"", ""leader"", ""master""], ""mesos-consul"": [], ""zookeeper"": [""mantl""]}",How can I parse the following JSON structure in Go
How can I parse a json that has following field in Go," In Go, how can I parse the following JSON?I know to use struct to parse, but the keys are different for each entry, also they are not fixed, they can be more or less. Thanks for help!  <code>  { ""consul"": [], ""docker"": [], ""etcd"": [""etcd""], ""kubernetes"": [""secure""], ""mantl-api"": [], ""marathon"": [""marathon""], ""mesos"": [""agent"", ""follower"", ""leader"", ""master""], ""mesos-consul"": [], ""zookeeper"": [""mantl""]}",How can I parse the following JSON structure in Go
is dereference golang struct return new copy of struct?," Why when we reference struct using (*structObj) does Go seem to return a new copy of structObj rather than return the same address of original structObj? This might be some misunderstanding of mine, so I seek clarification Output Go playground  <code>  package mainimport ( ""fmt"")type me struct { color string total int}func study() *me { p := me{} p.color = ""tomato"" fmt.Printf(""%p\n"", &p.color) return &p}func main() { p := study() fmt.Printf(""&p.color = %p\n"", &p.color) obj := *p fmt.Printf(""&obj.color = %p\n"", &obj.color) fmt.Printf(""obj = %+v\n"", obj) p.color = ""purple"" fmt.Printf(""p.color = %p\n"", &p.color) fmt.Printf(""p = %+v\n"", p) fmt.Printf(""obj = %+v\n"", obj) obj2 := *p fmt.Printf(""obj2 = %+v\n"", obj2)} 0x10434120&p.color = 0x10434120&obj.color = 0x10434140 //different than &p.color!obj = {color:tomato total:0}p.color = 0x10434120p = &{color:purple total:0}obj = {color:tomato total:0}obj2 = {color:purple total:0} // we get purple now when dereference again",Does dereferencing a struct return a new copy of struct?
Golang: Unmarshal json with int set to 0 does not seem to work," I am trying to parse a json object into a struct, but integer values set to 0 won't work. if I set the integer to anything but 0, this works fine.even if I Unmarshal the object and set the Integer field to 0, Marshalling it back removes the ""integer"" field.Why? and how to get around this?EDIT:from what I gather from the comments, omitempty triggers when value is 0. So now the disappearance makes sense.I'm parsing json, editing it and forwarding it to another service, so this is unfortunate, especially as field not present defaults to other values than 0, and I would prefer not having to feed in the defaults for the downstream API.So is there a way to omit empty values but keep 0?or change empty to something else?Do I need to have 2 structs: one for input and one for output? <code>  q := []byte(`{""string"":""this is a string"", ""integer"": 0}`)type Test struct { String string `json:""string,omitempty""` Integer int `json:""integer,omitempty""`} var qq Testif err := json.Unmarshal(q, &qq); err != nil { panic(err)}queryStr, err := json.Marshal(qq)if err != nil { panic(err)}fmt.Println(string(queryStr))// Output: {""string"": ""this is a string""}",Unmarshal/Marshal json with int set to 0 does not seem to work
Golang: Unmarshal/Marshal json with int set to 0 does not seem to work," I am trying to parse a json object into a struct, but integer values set to 0 won't work. if I set the integer to anything but 0, this works fine.even if I Unmarshal the object and set the Integer field to 0, Marshalling it back removes the ""integer"" field.Why? and how to get around this?EDIT:from what I gather from the comments, omitempty triggers when value is 0. So now the disappearance makes sense.I'm parsing json, editing it and forwarding it to another service, so this is unfortunate, especially as field not present defaults to other values than 0, and I would prefer not having to feed in the defaults for the downstream API.So is there a way to omit empty values but keep 0?or change empty to something else?Do I need to have 2 structs: one for input and one for output? <code>  q := []byte(`{""string"":""this is a string"", ""integer"": 0}`)type Test struct { String string `json:""string,omitempty""` Integer int `json:""integer,omitempty""`} var qq Testif err := json.Unmarshal(q, &qq); err != nil { panic(err)}queryStr, err := json.Marshal(qq)if err != nil { panic(err)}fmt.Println(string(queryStr))// Output: {""string"": ""this is a string""}",Unmarshal/Marshal json with int set to 0 does not seem to work
Best way to swap elements in golang slice?," Is it possible to swap elements like in python? or do we have to use: <code>  a,b = b,a temp = aa = bb = temp",Best way to swap variable values in Go?
How do I parse an ISO 8601 Timestamp in GoLang?," I know I need to use a time layout in Go (as shown here https://golang.org/src/time/format.go) but I can't find the layout for an ISO 8601 timestamp.If it helps, I get the timestamp from the Facebook API. Here is an example timestamp: 2016-07-25T02:22:33+0000 <code> ",How do I parse an ISO 8601 Timestamp in Go?
Golang Microservices can't communicate using Docker," I am trying to get two containers that are each running a different Go service. Both services were built with the net/http package. I have an API frontend as one and an Authentication service backend.Here is my compose file: I know the links are working because from the api container I can ping auth and curl -X Post http://auth:8080/validate but within Go I get a dial address tcp i/o timeout. Here is the code. The client.Do(request) is what is throwing the Dial error. Now my auth service is not even being touched because I have a logger that prints to screen every request that is coming in. env.AuthHost is mapped to the AUTH_HOST environment variable.env.AuthPort is mapped to the Auth_PORT environment variable.Much help is appreciated.If it helps I am running MacOSX. Both Dockerfiles looks like this: EDIT:I ran net.LookupHost(env.AuthHost) within Go and it is returning a different IP address then ping, curl, and even docker inspect. Is this a Go thing then?EDIT:If I remove the port portion of the authString, the request goes through but get an error when parsing response. The response is a 301 redirect by NGINX which I think is strange because that is not even in my stack. The location header for the redirect is localhost, which I think is strange as well.I have tried exposing a port on the host machine and accessing it with that port with no better luck (same hostname).EDIT:So it is a Mac only thing I assume. I cloned down the repo and ran on Windows 10 and I was able to connect to my auth service. Would this be Docker for Mac error? I am probably going to report it to them, but I would not consider this closed since it still is an issue for Mac users. <code>  version: ""2""services: staticfiles: build: ./files volumes: - /public - /views api: build: ./api environment: - PORT=8080 - BASE_URL=https://example.org - AUTH_HOST=auth - AUTH_PORT=8080 - VIEW_DIR=/views - PUBLIC_DIR=/public ports: - ""80:8080"" volumes_from: - staticfiles:ro links: - auth depends_on: - staticfiles db: build: ./postgres environment: - POSTGRES_USER=inheritor - POSTGRES_DB=inheritor auth: build: ./auth expose: - ""8080"" environment: - PORT=8080 - DB_USER=inheritor - DB_NAME=inheritor - DB_HOST=db - DB_Port=5432 links: - db var ( authString = ""http://"" + env.AuthHost + "":"" + env.AuthPort)//ValidateToken validates a token using the session in DBfunc ValidateToken(req *model.ValidateRequest) (*model.JWTClaims, error) { client := new(http.Client) api := authString + ""/validate"" cont, err := model.Jsonify(req) if err != nil { return nil, exception.NewInternalError(""Could not turn the request into a json object."") } request, err := http.NewRequest(""POST"", api, bytes.NewBuffer(cont)) if err != nil { return nil, exception.NewInternalError(""Could not create request: "" + err.Error()) } request.Header.Set(""Content-type"", ""application/json"") response, err := client.Do(request) if err != nil { return nil, exception.NewInternalError(""Could not make the request: "" + err.Error()) } defer response.Body.Close() res := new(model.AuthResponse) res.Claims = new(model.JWTClaims) decoder := json.NewDecoder(response.Body) err = decoder.Decode(&res) spew.Dump(response.Body) if err != nil { return nil, exception.NewInternalError(""Could not parse response back from auth service. "" + err.Error()) } if response.StatusCode != http.StatusOK { return nil, exception.NewInvalidJWTError(res.Error) } return res.Claims, nil} Client: Version: 1.12.0-rc4 API version: 1.24 Go version: go1.6.2 Git commit: e4a0dbc Built: Wed Jul 13 03:28:51 2016 OS/Arch: darwin/amd64 Experimental: trueServer: Version: 1.12.0-rc4 API version: 1.24 Go version: go1.6.2 Git commit: e4a0dbc Built: Wed Jul 13 03:28:51 2016 OS/Arch: linux/amd64 Experimental: true FROM golang:1.6RUN mkdir -p /go/src/github.com/dixonwille/Inheritor/apiWORKDIR /go/src/github.com/dixonwille/Inheritor/apiCOPY . /go/src/github.com/dixonwille/Inheritor/apiRUN go build -v -o Inheritor cmd/Inheritor/main.goUSER nobodyENTRYPOINT [""./Inheritor""]",Microservices can't communicate using Docker for Mac
Golang Microservices can't communicate using Docker for Mac," I am trying to get two containers that are each running a different Go service. Both services were built with the net/http package. I have an API frontend as one and an Authentication service backend.Here is my compose file: I know the links are working because from the api container I can ping auth and curl -X Post http://auth:8080/validate but within Go I get a dial address tcp i/o timeout. Here is the code. The client.Do(request) is what is throwing the Dial error. Now my auth service is not even being touched because I have a logger that prints to screen every request that is coming in. env.AuthHost is mapped to the AUTH_HOST environment variable.env.AuthPort is mapped to the Auth_PORT environment variable.Much help is appreciated.If it helps I am running MacOSX. Both Dockerfiles looks like this: EDIT:I ran net.LookupHost(env.AuthHost) within Go and it is returning a different IP address then ping, curl, and even docker inspect. Is this a Go thing then?EDIT:If I remove the port portion of the authString, the request goes through but get an error when parsing response. The response is a 301 redirect by NGINX which I think is strange because that is not even in my stack. The location header for the redirect is localhost, which I think is strange as well.I have tried exposing a port on the host machine and accessing it with that port with no better luck (same hostname).EDIT:So it is a Mac only thing I assume. I cloned down the repo and ran on Windows 10 and I was able to connect to my auth service. Would this be Docker for Mac error? I am probably going to report it to them, but I would not consider this closed since it still is an issue for Mac users. <code>  version: ""2""services: staticfiles: build: ./files volumes: - /public - /views api: build: ./api environment: - PORT=8080 - BASE_URL=https://example.org - AUTH_HOST=auth - AUTH_PORT=8080 - VIEW_DIR=/views - PUBLIC_DIR=/public ports: - ""80:8080"" volumes_from: - staticfiles:ro links: - auth depends_on: - staticfiles db: build: ./postgres environment: - POSTGRES_USER=inheritor - POSTGRES_DB=inheritor auth: build: ./auth expose: - ""8080"" environment: - PORT=8080 - DB_USER=inheritor - DB_NAME=inheritor - DB_HOST=db - DB_Port=5432 links: - db var ( authString = ""http://"" + env.AuthHost + "":"" + env.AuthPort)//ValidateToken validates a token using the session in DBfunc ValidateToken(req *model.ValidateRequest) (*model.JWTClaims, error) { client := new(http.Client) api := authString + ""/validate"" cont, err := model.Jsonify(req) if err != nil { return nil, exception.NewInternalError(""Could not turn the request into a json object."") } request, err := http.NewRequest(""POST"", api, bytes.NewBuffer(cont)) if err != nil { return nil, exception.NewInternalError(""Could not create request: "" + err.Error()) } request.Header.Set(""Content-type"", ""application/json"") response, err := client.Do(request) if err != nil { return nil, exception.NewInternalError(""Could not make the request: "" + err.Error()) } defer response.Body.Close() res := new(model.AuthResponse) res.Claims = new(model.JWTClaims) decoder := json.NewDecoder(response.Body) err = decoder.Decode(&res) spew.Dump(response.Body) if err != nil { return nil, exception.NewInternalError(""Could not parse response back from auth service. "" + err.Error()) } if response.StatusCode != http.StatusOK { return nil, exception.NewInvalidJWTError(res.Error) } return res.Claims, nil} Client: Version: 1.12.0-rc4 API version: 1.24 Go version: go1.6.2 Git commit: e4a0dbc Built: Wed Jul 13 03:28:51 2016 OS/Arch: darwin/amd64 Experimental: trueServer: Version: 1.12.0-rc4 API version: 1.24 Go version: go1.6.2 Git commit: e4a0dbc Built: Wed Jul 13 03:28:51 2016 OS/Arch: linux/amd64 Experimental: true FROM golang:1.6RUN mkdir -p /go/src/github.com/dixonwille/Inheritor/apiWORKDIR /go/src/github.com/dixonwille/Inheritor/apiCOPY . /go/src/github.com/dixonwille/Inheritor/apiRUN go build -v -o Inheritor cmd/Inheritor/main.goUSER nobodyENTRYPOINT [""./Inheritor""]",Microservices can't communicate using Docker for Mac
Golang slice append performance," To make slice append operation faster we need to allocate enough capacity. There's two ways to append slice, Here is the code: And the result is:BenchmarkSliceAppend-4 200000000 7.87 ns/op 8 B/op 0 allocs/opBenchmarkSliceSet-4 300000000 5.76 ns/op 8 B/opWhy is a[i] = i faster than a = append(a, i)? <code>  func BenchmarkSliceAppend(b *testing.B) { a := make([]int, 0, b.N) for i := 0; i < b.N; i++ { a = append(a, i) }}func BenchmarkSliceSet(b *testing.B) { a := make([]int, b.N) for i := 0; i < b.N; i++ { a[i] = i }}",Golang slice append vs assign performance
How to have a global variable accessible across all packages in golang," I have a main.go file which has: In router.InitMap I want to declare a global variable which can be accessed throughout my application anywhere. Is is possible? I tried: But I can't access the variable Global even in the same package. <code>  // running the router in port 9000func main() { router,Global := routers.InitApp() fmt.println(Global) router.RunTLS("":9000"" , ""domain.crt"" , ""domain.key"")} func InitApp() (*gin.Engine,string) { var Global= ""myvalue"" router := gin.New() return router,Global}",How to have a global variable accessible across all packages
How to work with concurrent logs at golang?," I've searched for it and only found here and here, but it does not solve my problem.How can I, using a standard way, identify the log separating the concurrent logs like JAVA does with thread ID? Because if I have a concurrent method then the logs will be printed mixed at the output, so I think that the LOGGER needs to have a way of identifying each request ""thread""Ex: output As you can see, without using an int flag, it is impossible to know which request logged a message. In Java and C for example you can use thread id for this purpose.How to achieve this in Golang? Thanks. <code>  package mainimport ""log""func main() { /* simulating 10000 users requests */ for i:=1; i < 10000; i++ { go getHello(i) }}func getHello(d int){ log.Printf(""m=getHello, i=%d,begin"", d) log.Println(""m=getHello, processing the hello message"") log.Printf(""m=getHello, i=%d, end"", d)} 2016/07/29 15:59:46 m=getHello, i=1017,begin2016/07/29 15:59:46 m=getHello, processing the hello message2016/07/29 15:59:46 m=getHello, i=1017, end2016/07/29 15:59:46 m=getHello, processing the hello message2016/07/29 15:59:46 m=getHello, i=1038, end2016/07/29 15:59:46 m=getHello, i=311,begin2016/07/29 15:59:46 m=getHello, processing the hello message2016/07/29 15:59:46 m=getHello, i=311, end2016/07/29 15:59:46 m=getHello, i=1023,begin",How to work with concurrent logs in golang?
"Strange golang ""append"" behavior"," I have this simple code: I was expecting it to print {0} {1} {2} {3}, however it prints {0} {3} {3} {3}. What happened here? <code>  import ""fmt""type Foo struct { val int}func main() { var a = make([]*Foo, 1) a[0] = &Foo{0} var b = [3]Foo{Foo{1}, Foo{2}, Foo{3}} for _, e := range b { a = append(a, &e) } for _, e := range a { fmt.Printf(""%v "", *e) }}","Strange golang ""append"" behavior (overwriting values in slice)"
Decoding top level JSON array with json.Decoder in golang, Is it possible to decode top level JSON array with json.Decoder?Or reading entire JSON and json.Unmarshall is the only way in this case?I have read the accepted answer in this question and cannot figure out how to use it with top level JSON array <code> ,Decoding top level JSON array with json.Decoder
using vueJS with a Go(golang) backend," I want to use Go templates as well as VueJS for data-binding. Has anyone integrated both before?I wish to use VueJS primarily for Ajax calls as doing it manually(or with jQuery) always leaves my code messy.To be more specific, if I have a simple<p> tag whose value is generated from a Go template like so: Now I want to bind to the value inlike so: Both are for the same tag. <code>  {{.Color}} {{someVariable}} ",Using VueJS with a Go backend
using VueJS with a Golang backend," I want to use Go templates as well as VueJS for data-binding. Has anyone integrated both before?I wish to use VueJS primarily for Ajax calls as doing it manually(or with jQuery) always leaves my code messy.To be more specific, if I have a simple<p> tag whose value is generated from a Go template like so: Now I want to bind to the value inlike so: Both are for the same tag. <code>  {{.Color}} {{someVariable}} ",Using VueJS with a Go backend
Structure for json to allow a value to optionally be an array golang s3 bucket policy," I am trying to change the policy for an s3 bucket on aws. I have created the following json structure for a policy: Which works fine for putting bucket policies in place. The issue comes when I try to get the current policy and modify it.If there is a statement that only has one AWS, Action, or Resource value, Amazon will convert it from an array to a simple value, causing my unmarshalling to fail.Is there any way that I can specify AWS/Action/Resource values to be either a string slice or just a string?I know that there are packages available that I could use to get around this to some extent (github.com/Jeffail/gabs, for example), but it would be cleaner to just create the JSON structure since it is fairly simple. <code>  type Policy struct { Version string `json:""Version""` Id string `json:""Id""` Statement []Statement `json:""Statement""`}type Statement struct { Sid string `json:""Sid""` Effect string `json:""Effect""` Principal Principal `json:""Principal""` Action []string `json:""Action""` Resource []string `json:""Resource""`}type Principal struct { AWS[]string `json:""AWS""`}",Golang structure for json to allow a value to optionally be an array
Golang: Using anonymous struct or empty struct as a function parameter," Here is a piece of code play.google.org that runs without any problem: However, if the PrintAnonymous() function exists in another package (let's say, temp), the code will not work: My question are:Is there a way to call a (public) function with anonymous struct as a parameter (a.k.a. PrintAnonymous() above)?A function with empty struct as a parameter (a.k.a. PrintAnonymous2() above) can be called even if it exists in another package. Is this a special case?Well, I know that I can always name the struct to solve the problem, I'm just curious about this, and wonder why it seems that this is not allowed. <code>  package mainimport ( ""fmt"")func PrintAnonymous(v struct { i int s string}) { fmt.Printf(""%d: %s\n"", v.i, v.s)}func PrintAnonymous2(v struct{}) { fmt.Println(""Whatever"")}func main() { value := struct { i int s string }{ 0, ""Hello, world!"", } PrintAnonymous(value) PrintAnonymous2(struct{}{})} cannot use value (type struct { i int; s string })as type struct { i int; s string } in argument to temp.PrintAnonymous",Exporting functions with anonymous struct as a parameter [cannot use value (type struct {...}) as type struct {...} in argument to package.Func]
Golang: Exporting functions with anonymous struct or empty struct as a parameter," Here is a piece of code play.google.org that runs without any problem: However, if the PrintAnonymous() function exists in another package (let's say, temp), the code will not work: My question are:Is there a way to call a (public) function with anonymous struct as a parameter (a.k.a. PrintAnonymous() above)?A function with empty struct as a parameter (a.k.a. PrintAnonymous2() above) can be called even if it exists in another package. Is this a special case?Well, I know that I can always name the struct to solve the problem, I'm just curious about this, and wonder why it seems that this is not allowed. <code>  package mainimport ( ""fmt"")func PrintAnonymous(v struct { i int s string}) { fmt.Printf(""%d: %s\n"", v.i, v.s)}func PrintAnonymous2(v struct{}) { fmt.Println(""Whatever"")}func main() { value := struct { i int s string }{ 0, ""Hello, world!"", } PrintAnonymous(value) PrintAnonymous2(struct{}{})} cannot use value (type struct { i int; s string })as type struct { i int; s string } in argument to temp.PrintAnonymous",Exporting functions with anonymous struct as a parameter [cannot use value (type struct {...}) as type struct {...} in argument to package.Func]
Go: Exporting functions with anonymous struct as a parameter [cannot use value (type struct {...}) as type struct {...} in argument to package.Func]," Here is a piece of code play.google.org that runs without any problem: However, if the PrintAnonymous() function exists in another package (let's say, temp), the code will not work: My question are:Is there a way to call a (public) function with anonymous struct as a parameter (a.k.a. PrintAnonymous() above)?A function with empty struct as a parameter (a.k.a. PrintAnonymous2() above) can be called even if it exists in another package. Is this a special case?Well, I know that I can always name the struct to solve the problem, I'm just curious about this, and wonder why it seems that this is not allowed. <code>  package mainimport ( ""fmt"")func PrintAnonymous(v struct { i int s string}) { fmt.Printf(""%d: %s\n"", v.i, v.s)}func PrintAnonymous2(v struct{}) { fmt.Println(""Whatever"")}func main() { value := struct { i int s string }{ 0, ""Hello, world!"", } PrintAnonymous(value) PrintAnonymous2(struct{}{})} cannot use value (type struct { i int; s string })as type struct { i int; s string } in argument to temp.PrintAnonymous",Exporting functions with anonymous struct as a parameter [cannot use value (type struct {...}) as type struct {...} in argument to package.Func]
Convert UTC string to golang time object," I have this datetime, or something that looks like it. I want to convert this to a time object and I've been unable to produce any output from time.Parse apart from: I've tried these layouts: And a few more - none have worked.This is how I'm calling parse : How do I create a time object from a string? <code>  2014-11-17 23:02:03 +0000 UTC 0001-01-01 00:00:00 +0000 UTC time.RFC33390001-01-01 00:00:00 0000 UTC2016-10-10time.UnixDate updatedAt, err := time.Parse(time.UnixDate, updatedAtVar)",Convert UTC string to time object
Explain Type Assertions in Go like I am 5, I'm reading about type assertions x.(T) in The Go Programming Language and don't understand them.I understand that there are different scenarios:T is a concrete type or an interfaceOne (asserted value?) or two (ok) values can be returnedThis is what I don't understand:Why would I use them?What exactly do they return?I have also googled on the topic and still don't understand.  <code> ,Explain Type Assertions in Go
Parse array in Golang," How to parse a string (which is an array) in Go using json package? <code>  type JsonType struct{ Array []string}func main(){ dataJson = `[""1"",""2"",""3""]` arr := JsonType{} unmarshaled := json.Unmarshal([]byte(dataJson), &arr.Array) log.Printf(""Unmarshaled: %v"", unmarshaled)}",How to parse JSON array in Go
Parse JSON array in Golang," How to parse a string (which is an array) in Go using json package? <code>  type JsonType struct{ Array []string}func main(){ dataJson = `[""1"",""2"",""3""]` arr := JsonType{} unmarshaled := json.Unmarshal([]byte(dataJson), &arr.Array) log.Printf(""Unmarshaled: %v"", unmarshaled)}",How to parse JSON array in Go
Golang - get request max data limit," I'm scraping HTML pages and have set up a HTTP client like so: Now when I make GET requests of multiple URLs I don't want to get stuck with URLs that deliver massive amount of data. Is there a way to limit the amount of data (bytes) the GET request accepts from a resource and stops? <code>  client := *http.Client{ Transport: &http.Transport{ Dial: (&net.Dialer{ Timeout: 30 * time.Second, KeepAlive: 30 * time.Second, }).Dial, TLSHandshakeTimeout: 10 * time.Second, ResponseHeaderTimeout: 10 * time.Second, }, } response, err := client.Get(page.Url)checkErr(err)body, err := ioutil.ReadAll(response.Body)checkErr(err)page.Body = string(body)",Limiting amount of data read in the response to a HTTP GET request
golang - pass method to function," I'm curious if this is possible in Go. I have a type with multiple methods. Is it possible to have a function which takes a method argument and then call it for the type?Here is a small example of what I would want: Go thinks type Foo has a method called foo(), rather than replacing it with the passed in method name. <code>  package mainimport ( ""fmt"")type Foo intfunc (f Foo) A() { fmt.Println(""A"")}func (f Foo) B() { fmt.Println(""B"")}func (f Foo) C() { fmt.Println(""C"")}func main() { var f Foo bar := func(foo func()) { f.foo() } bar(A) bar(B) bar(C)}",Pass method argument to function
Strange behavior with golang append() being affected by fmt.Println()," I noticed some strange behavior with Golang's append(). I understand the basic concept of how slice capacity affects whether a new underlying array gets allocated, but why is whether or not I use a fmt.Println() AFTER the append has happened affecting the result of the append? Link to run code here: https://play.golang.org/p/jJ-5ZxTBIn <code>  package mainimport ""fmt""func main() { a := []byte(""AAA"") b := append(a, []byte(""BBB"")...) fmt.Println("" a: "", string(a), "" b: "", string(b)) c := append(a, []byte(""CCC"")...) fmt.Println("" a: "", string(a), "" b: "", string(b), "" c: "", string(c)) fmt.Println(&b) //try commenting this out and in and running the program}",Strange behavior with Golang append() being affected by fmt.Println()
golang dynamic variable reference," In Go, I would like to do something like this. I have a big object with many structs (using Google's protobuf). here is a contrived example: I would like to be able to dynamically reference things. for example: Is this possible in Go? if so, how could I do that? essentially, I'm creating a report which only contains a subset of the object and I want to be able to create a mapping file where the user can map keys/values together and my program will output the value. I have this working in python, but wanted to try using Go :) <code>  person.name = ""testing""person.address.street = ""123 test st""person.address.city = ""tester""person.address.zip = 90210person.billing.address.same = true key := ""person.address.zip""fmt.Println(""the value of key: "" + key) // would like to get 90210key := ""person.address.city""fmt.Println(""the value of key: "" + key) // would like to get ""tester""",Golang dynamic variable reference
golang invalid character 'b' looking for beginning of value," I am trying to post json with a xml message inside it. However it returns: I think the possible reason is that I am trying to marshal the returns body which is not in the json format. The error happened at this line: <code>  invalid character 'b' looking for beginning of value func (s *BackendConfiguration) Do(req *http.Request, v interface{}) error { log.Printf(""Requesting %v %v%v\n"", req.Method, req.URL.Host, req.URL.Path) start := time.Now() res, err := s.HTTPClient.Do(req) if debug { log.Printf(""Completed in %v\n"", time.Since(start)) } if err != nil { log.Printf(""Request to sakura failed: %v\n"", err) return err } defer res.Body.Close() resBody, err := ioutil.ReadAll(res.Body) if err != nil { log.Printf(""Cannot parse sakura response: %v\n"", err) return err } if debug { log.Printf(""sakura response: %q\n"", resBody) } if v != nil { return json.Unmarshal(resBody, v) } return nil} return json.Unmarshal(resBody, v)",Golang invalid character 'b' looking for beginning of value
It's thread-safe with concurrent access?," I have struct with count property need to thread-safe access.I know it can be done with sync.Mutex or sync.RWMutex. But I am not sure it's ok like this: Thank you.Edit:I'm confused that access field directly s.count is not safe. But atomic.LoadUint32(&s.count) is safe? <code>  type Status struct { count uint32 attr1 string attr2 string}func (s *Status) Get() uint32 { return atomic.LoadUint32(&s.count)}func (s *Status) Add(n uint32) { atomic.AddUint32(&s.count, n)}func (s *Status) Reset(n uint32) { atomic.StoreUint32(&s.count, n)}",Is this thread-safe with concurrent access?
"json unmarshal error when jsonString has ""\n"" in it"," I need to decode a JSON string which has ""\n"" in it: I use the Golang code below: But I get the error: <code>  [ {""Name"":""Neo"", ""Message"":""Hi\n:Hello everyone""}, {""Name"":""Sam"",""Messsage"":""Hello\nEveery\nOne""}] package mainimport ( ""encoding/json"" ""fmt"")type Person struct { Messages []string `json:""Name,omitempty""`}func main() {s := ""[{\""Name\"":\""Neo\"", \""Message\"":\""Hi\n:Hello everyone\""}, {\""Name\"":\""Sam\"",\""Messsage\"":\""Hello\nEveery\nOne\""}]""var pro Personerr := json.Unmarshal([]byte(s), &pro)if err == nil {fmt.Printf(""%+v\n"", pro)} else {fmt.Println(err)fmt.Printf(""%+v\n"", err)}} ERROR invalid character '\n' in string literal","Error embedding ""\n"" into a string literal"
How does behave a non initialized channel?," I have a struct that holds a channel that is not initialized.When I write into it, the routine is blocking as expected but the reader is never notified that something is in the pipe.I am surprised that there is no error and I am wondering what is doing Go.In the example bellow, neither the message pushed nor got it are printed. (Uncomment the intialization and it will work like a charm) Here is the playground https://play.golang.org/p/76zrCuoeoh(I know I should initialize the channel, this is not the purpose of the question, I want to know what is happening in Go with non initialized channels.) <code>  type MyStruct struct { over chan bool}func main() { nonInitialized := &MyStruct{} // nonInitialized.over = make(chan bool) go func() { for i := 0; i < 10; i++ { select { case <-nonInitialized.over: fmt.Println(""got it"") default: // proceed } fmt.Println(""do some stuff"") time.Sleep(10 * time.Millisecond) } panic(""took too long"") }() // push on the non initialized channel fmt.Println(""pushing"") nonInitialized.over <- true fmt.Println(""pushed"")}",How does a non initialized channel behave?
"os.Mkdir versus syscall.Mkdir, what is different in golang?"," os.Mkdir and syscall.Mkdir both have same API in Golangsyscall.Mkdir: os.Mkdir: What is the difference between them? <code>  func Mkdir(path string, mode uint32) (err error) func Mkdir(name string, perm FileMode) error","os.Mkdir versus syscall.Mkdir, what is the difference in Golang?"
"os.Mkdir versus syscall.Mkdir, what is difference in Golang?"," os.Mkdir and syscall.Mkdir both have same API in Golangsyscall.Mkdir: os.Mkdir: What is the difference between them? <code>  func Mkdir(path string, mode uint32) (err error) func Mkdir(name string, perm FileMode) error","os.Mkdir versus syscall.Mkdir, what is the difference in Golang?"
Setting pointers to nil to prevent memory leak in Go(lang)," I'm learning Go, and as an exercise I wanted to implement a linked list. For reference I looked at the official Go code (https://golang.org/src/container/list/list.go) . One thing that stuck with me are these lines: I am curious as to how does setting pointers to nil in this case prevent memory leaks? If possible I would like to construct a program which has this flaw and see it while profiling with pprof (I would use a modified verion of the list.go without this nil pointer setting).For clarity of answer: If one of the nodes has an external pointer to it, then all of the adjacent removed nodes will have an active reference through that pointer and won't be removed.We create an external pointer pointing to Node2 We remove nodes 2-4 from the listYou would expect at this point only for the Node 1,2 &5 to be alive and the rest to be GC-ed. However, due to Node2 stillpointing to Node3 & etc., the entire chain remains uncollected. <code>  108 // remove removes e from its list, decrements l.len, and returns e. 109 func (l *List) remove(e *Element) *Element { 110 e.prev.next = e.next 111 e.next.prev = e.prev 112 e.next = nil // avoid memory leaks 113 e.prev = nil // avoid memory leaks 114 e.list = nil 115 l.len-- 116 return e 117 } ",Setting pointers to nil to prevent memory leak in Golang
How to get the size of and io.reader object," I would like to get the size of an io.reader to return the length of a picture for a bse64 concerns.The main problem is to get the size of dec to return a content-length headerHere is my code : regards and thanks <code>  package mainimport ( ""fmt"" ""net/http"" ""time"" ""strconv"" ""io"" base64 ""encoding/base64"" ""bytes"")func pix(w http.ResponseWriter, r *http.Request) { fmt.Fprintf(w, ""Hi there, I love %s!"", r.URL.Path[1:]) cookie, _ := r.Cookie(""csrftoken"") fmt.Printf(cookie.Value)}func img(w http.ResponseWriter, r *http.Request) { expiration := time.Now().Add(365 * 24 * time.Hour) cookie := http.Cookie{Name: ""csrftoken"",Value:""abcd"",Expires:expiration,HttpOnly: false} http.SetCookie(w, &cookie) img := bytes.NewBufferString(""iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAIAAACRXR/mAAADMUlEQVRYw+2YTUgUYRjHZzOJIoNA+rrUyYNIRQgRHaLo4qFDBEGeunSxS9TFU0QEnhIh6IvokrUzO2uamRmbG6XmR/mVaKZpZVbYvvO143zszsxOz+yahNm+785sITEP72F3Z+adH8/zf5+PpagwtxKXj+Vj+Vg+lo/lY+W+WI4KpddKwWIQFUSF97nNLcLGZt75SiOHchEXfskDVmYjlowpiEoei3UT2ljcFJOpOd169C1Z2SuvgsdpB7cgzB16EV/byGM2xDIVPxQujKmBDF/2m2l0vFvmEin7N2v8kiiPiOeGlGHRvP1RdxA9eYtGR7pk2Pf6lI7RCoP2RaWkZWe3fsFc18hvesAHPGEFUc24ltnx3kyiCJwfRMs6dTXLdSIjO9Osal18qzKfE5V9coDxhlU7qS3uOyiaB55JDtkS2TKoLCLaOLPS4b02pQdCHiUfRKf653/d2kjZN6f10jYxI2EnrGk5H+2WsVi6ZZ8fVSmGQKaYyyFuR6ugmUtVrJo2C7HokeGq8447sYpOPBbo3XFzKC95626sZlz905sUM9XLGbXvtKtTOhZrQDApkhNNkiAOPo/viojh2YSZsj1aF2eQ5n2stuomNQjiiGQanrFufdCXP8gu8tbhjridJ6saVPKExXJrwlwfb3pnAg2Ut0tEBZFI8gza81Tik15DCDIoINQ7aQdBo90RMfrdwNaWLFY9opJGkBQrhCA/HXspQ8W1XHkN6vfWFiGH9ouwhdpJUFuy2JX3eg6uyqENpNHZYcUd02jcLMI2WO67UwZVv1G1HLMq3L83KuEbLPdY7IL2L42p0MMQiuzkq/ncwucOi6qPbWkWoPfCUsENpweUnP1EmE4XGhgagT72RyXolkSCHBbTU3By3fgJj8VyJW3CmSHl8oTWMJuYUUizVvtcsuyJ6J4J663CMLevXar/lJgnKNSgbphzKjriTn5i0F8eX9ODXnEzf6JHvjGtv+aNGdWCOEKnJRmpr5oFVQV8WTWglIKHMlPhv5uqQ1xGYfB5fRMPo+n2VmFbi7ChiS9oWBhZvXrI01TNLg7yPxt51v9rxMfysXwsH8vH+g+wfgDUr+5LcyNV4AAAAABJRU5ErkJggg=="") dec := base64.NewDecoder(base64.StdEncoding, img) w.Header().Set(""Content-Type"", ""image/jpeg"")// the problem is here i would like to get the size to return the length of the picture (lend(dec)) w.Header().Set(""Content-Length"", strconv.Itoa(len(dec))) io.Copy(w, dec)}func main() { http.HandleFunc(""/pix/"", pix) http.HandleFunc(""/img/"", img) http.HandleFunc(""/red/"", img) http.HandleFunc(""/"", img) http.ListenAndServe("":8080"", nil)}",How to get the size of an io.reader object
"Go, generic, how to get keys of map"," I have a function named Keys() to get all the keys of a map, here is the code: But I got Does Go support generics and how should I fix my code? <code>  func main() { m2 := map[int]interface{}{ 2:""string"", 3:""int"", } fmt.Println(Keys(m2))}func Keys(m map[interface{}]interface{}) (keys []interface{}) { for k := range m { keys = append(keys, k) } return keys} cannot use m2 (type map[int]interface {}) as type map[interface {}]interface {} in argument to Keys",How to get keys of map
"Go, generics, how to get keys of map"," I have a function named Keys() to get all the keys of a map, here is the code: But I got Does Go support generics and how should I fix my code? <code>  func main() { m2 := map[int]interface{}{ 2:""string"", 3:""int"", } fmt.Println(Keys(m2))}func Keys(m map[interface{}]interface{}) (keys []interface{}) { for k := range m { keys = append(keys, k) } return keys} cannot use m2 (type map[int]interface {}) as type map[interface {}]interface {} in argument to Keys",How to get keys of map
i cant understand why interfaces are needed in golang," In Golang, we use structs with receiver methods. everything is perfect up to here.I'm not sure what interfaces are, however. We define methods in structs and if we want to implement a method on a struct, we write it anyway again under another struct.This means that interfaces seem to be just method definitions, taking just extra unneeded space on our page.Is there any example explaining why I need an interface? <code> ",Why are interfaces needed in Golang?
When should i initialize golang variables," There are some kind of variables in Golang:global variable: var a intlocal variable: func hello() { var a int }return variable: func hello() (a int) {}Golang sometimes will auto-init some variables,but I don't know when and why? It confused me.Example: which one should I have to initialize before use? <code>  type User struct { Name string `json:""name""` Age int `json:""age""`}func foo(bts []byte) { var a User err := json.Unmarshal(bts, &a) // It's ok}func bar(bts []byte) (a *User) { err := json.Unmarshal(bts, a) // It will crash}",When should I initialize Golang variables
Go panic: runtime error: index out of range but length of array is not null," I am having a hard time learning how to loop through a string in Go to do some stuff (specifically, to separate words than contain vowels).I wrote this code snippet: https://play.golang.org/p/zgDtOyq6qf.Here is the error Im getting when running it: I searched in this forum, and someone said that its due to the length of the array, but its not the case here. I cannot figure out how to solve this issue.Can someone please suggest something? <code>  panic: runtime error: index out of rangegoroutine 1 [running]:panic(0x1045a0, 0x1040a010) /usr/local/go/src/runtime/panic.go:500 +0x720main.myFunc(0x114130, 0x4, 0x0, 0x0, 0x0, 0x3ba3) /tmp/sandbox960520145/main.go:19 +0x1a0main.main() /tmp/sandbox960520145/main.go:10 +0x40",Go panic: runtime error: index out of range when the length of array is not null
How to compare golang error objects," I have an error value which when printed on console gives me Token is expiredHow can I compare it with a specific error value? I tried this but it did not work: <code>  if err == errors.New(""Token is expired"") { log.Printf(""Unauthorised: %s\n"", err)}",How to compare Go errors
How to compare Golang error objects," I have an error value which when printed on console gives me Token is expiredHow can I compare it with a specific error value? I tried this but it did not work: <code>  if err == errors.New(""Token is expired"") { log.Printf(""Unauthorised: %s\n"", err)}",How to compare Go errors
Why am I receiving an oversized record TSL error?," I'm trying to use go-xmpp to connect to DuckDuckGo's XMPP services.Below is my test-case: The log.Fatal block is being executed and returns the following error message: Googling the error points me towards an identical error in Docker, so that's not exactly helpful. What does this error mean? What can I do to fix this? <code>  package mainimport ( ""crypto/tls"" ""log"" ""github.com/mattn/go-xmpp"")const ( svr = ""dukgo.com"" usr = ""testtesttest"" pwd = ""test123"")func main() { xmpp.DefaultConfig = tls.Config{ ServerName: svr, InsecureSkipVerify: false, } options := xmpp.Options{ Host: svr, User: usr, Password: pwd, } _, err := options.NewClient() if err != nil { log.Fatal(err) }} 2016/08/24 16:32:27 tls: oversized record received with length 28012exit status 1",Why am I receiving an oversized record TLS error?
Unmarshal incorrectly formated datetime in Golang," BackgroundI am learning Go and I'm trying to do some JSON unmarshaling of a datetime.I have some JSON produced by a program I wrote in C, I am outputting what I thought was a valid ISO8601 / RFC3339 timezone offset. I'm using strftime with the following format string: (Note that %f is not supported by strftime natively, I have a wrapper that replaces it with the nanoseconds).This will then produce the following result: Unmarshaling this in Go however will not work:https://play.golang.org/p/vzOXbzAwdW Output: (Working example: https://play.golang.org/p/5xcM0aHsSw)This is because RFC3339 expects the timezone offset to be in the format 02:00 with a :, but strftime outputs it as 0200.So I need to fix this in my C program to output the correct format. QuestionHowever, now I have a bunch of JSON files with this incorrect format: instead of the correct (with the : in the timezone offset): but I still want to be able to unmarshal it correctly in my Go program. Preferably two different JSON files with only this difference should parse in the exact same way.Regarding marshaling back to JSON, the correct format should be used.This is how I have defined it in my struct: So the question is, what is the ""Go"" way of doing this?Also in my code example I am using RFC3339Nano. How would I specify that in the metadata for the struct as well? As I have it now with just json:""time"" will that ignore the nano seconds? <code>  %Y-%m-%dT%H:%M:%S.%f%z 2016-08-08T21:35:14.052975+0200 package mainimport ( ""fmt"" ""time"")func main() { t, err := time.Parse(time.RFC3339Nano, ""2016-08-08T21:35:14.052975+0200"") if err != nil { panic(err) } fmt.Println(t)} panic: parsing time ""2016-08-08T21:35:14.052975+0200"" as ""2006-01-02T15:04:05.999999999Z07:00"": cannot parse ""+0200"" as ""Z07:00"" %z The +hhmm or -hhmm numeric timezone (that is, the hour and minute offset from UTC). (SU) 2016-08-08T21:35:14.052975+0200 2016-08-08T21:35:14.052975+02:00 Time time.Time `json:""time""`",Unmarshal incorrectly formatted datetime
Unmarshal incorrectly formated datetime," BackgroundI am learning Go and I'm trying to do some JSON unmarshaling of a datetime.I have some JSON produced by a program I wrote in C, I am outputting what I thought was a valid ISO8601 / RFC3339 timezone offset. I'm using strftime with the following format string: (Note that %f is not supported by strftime natively, I have a wrapper that replaces it with the nanoseconds).This will then produce the following result: Unmarshaling this in Go however will not work:https://play.golang.org/p/vzOXbzAwdW Output: (Working example: https://play.golang.org/p/5xcM0aHsSw)This is because RFC3339 expects the timezone offset to be in the format 02:00 with a :, but strftime outputs it as 0200.So I need to fix this in my C program to output the correct format. QuestionHowever, now I have a bunch of JSON files with this incorrect format: instead of the correct (with the : in the timezone offset): but I still want to be able to unmarshal it correctly in my Go program. Preferably two different JSON files with only this difference should parse in the exact same way.Regarding marshaling back to JSON, the correct format should be used.This is how I have defined it in my struct: So the question is, what is the ""Go"" way of doing this?Also in my code example I am using RFC3339Nano. How would I specify that in the metadata for the struct as well? As I have it now with just json:""time"" will that ignore the nano seconds? <code>  %Y-%m-%dT%H:%M:%S.%f%z 2016-08-08T21:35:14.052975+0200 package mainimport ( ""fmt"" ""time"")func main() { t, err := time.Parse(time.RFC3339Nano, ""2016-08-08T21:35:14.052975+0200"") if err != nil { panic(err) } fmt.Println(t)} panic: parsing time ""2016-08-08T21:35:14.052975+0200"" as ""2006-01-02T15:04:05.999999999Z07:00"": cannot parse ""+0200"" as ""Z07:00"" %z The +hhmm or -hhmm numeric timezone (that is, the hour and minute offset from UTC). (SU) 2016-08-08T21:35:14.052975+0200 2016-08-08T21:35:14.052975+02:00 Time time.Time `json:""time""`",Unmarshal incorrectly formatted datetime
"In Golang, why I can redefine the same variable multiple times in a for loop but can't outside of a loop?"," I have the following program. When executed I got: As we can see, the x := 77 has been execute 2 times. However, If I modify it slightly like this: I will get the error ""no new variables on left side of :="". Why this? <code>  package mainimport ( ""fmt"")func main() { for i := 0; i < 2; i++ { x := 77 fmt.Println(x) }} 7777 package mainimport ( ""fmt"")func main() { a := 77 fmt.Println(a) a := 77 fmt.Println(a)}",Why I can redefine the same variable multiple times in a for loop but can't outside of a loop?
How can I use 'time.After' and 'default' in GoLang?," I'm trying to understand a simple code of Golang routines: That's fine, but Why I cannot use a simple default in this ""select"" block? Something like this: It gets this output: And I can't understand why. <code>  package mainimport ( ""fmt"" ""time"")func sleep(seconds int, endSignal chan<- bool) { time.Sleep(time.Duration(seconds) * time.Second) endSignal <- true}func main() { endSignal := make(chan bool, 1) go sleep(3, endSignal) var end bool for !end { select { case end = <-endSignal: fmt.Println(""The end!"") case <-time.After(5 * time.Second): fmt.Println(""There's no more time to this. Exiting!"") end = true } }} for !end { select { case end = <-endSignal: fmt.Println(""The end."") case <-time.After(4 * time.Second): fmt.Println(""There's no more time to this. Exiting!"") end = true default: fmt.Println(""No end signal received."") }} go run goroutines-timeout.goNo end signal received!No end signal received!No end signal received!No end signal received!...The end!",How can I use 'time.After' and 'default' in Golang?
Why does URL.RawPath choke on %25?," While with similar input, URL.RawQuery seems to be properly populated.Playground <code>  u, err := url.Parse(""https://example.com/foo%2fbar"")if err != nil { log.Fatal(err)}fmt.Println(u.Path)fmt.Println(u.RawPath)fmt.Println(u.String(), ""\n"")u, err = url.Parse(""https://example.com/foo%25fbar?q=morefoo%25bar"")if err != nil { log.Fatal(err)}fmt.Println(u.Path)fmt.Println(u.RawPath)fmt.Println(u.RawQuery)fmt.Println(u.String())",Why does url.Parse not populate URL.RawPath?
Convert int32 to string in GOlang, I need to convert an int32 to string in Golang. Is it possible to convert int32 to string in Golang without converting to int or int64 first?Itoa needs an int. FormatInt needs an int64. <code> ,Convert int32 to string in Golang
Does go compiler's evaluation differ for constant expression and other expression," Why does below code fail to compile? I get an error main.go:12: constant 2147483648 overflows intAbove statement is correct. Yes, 2147483648 overflows int (In 32 bit architecture). But the shift operation should result in a negative value ie -2147483648. But the same code works, If I change the constants into variables and I get the expected output.  <code>  package mainimport ( ""fmt"" ""unsafe"")var x int = 1const ( ONE int = 1 MIN_INT int = ONE << (unsafe.Sizeof(x)*8 - 1))func main() { fmt.Println(MIN_INT)} package mainimport ( ""fmt"" ""unsafe"")var x int = 1var ( ONE int = 1 MIN_INT int = ONE << (unsafe.Sizeof(x)*8 - 1))func main() { fmt.Println(MIN_INT)}",Does Go compiler's evaluation differ for constant expression and other expression
Generate 6-digit Verification Code with golang?," Generate 6-digit code for phone verification,The following is a very simple approach that I have used Do you have a better way to do this <code>  package mainimport ( ""fmt"" ""math/rand"" ""time"") var randowCodes = [...]byte{ '1', '2', '3', '4', '5', '6', '7', '8', '9', '0',} func main() { var r *rand.Rand = rand.New(rand.NewSource(time.Now().UnixNano())) for i := 0; i < 3; i++ { var pwd []byte = make([]byte, 6) for j := 0; j < 6; j++ { index := r.Int() % len(randowCodes) pwd[j] = randowCodes[index] } fmt.Printf(""%s\n"", string(pwd)) } } ",Generate 6-digit Verification Code with Golang?
how to get all get request query parameters into a structure in GO?," Hi I want to transform get query parameters into a structure in Go, for example I have this structure: And I have the optional parameters that the user can specify when sending a get request which are Offset, Limit, SortBy, Asc, Username, First_Name, Last_Name, Status.If those parameters were sent in the body then I would do this: But I can't send body in a GET request so what is the solution instead of getting each parameter alone and then putting them into a structure? <code>  type Filter struct { Offset int64 `json:""offset""` Limit int64 `json:""limit""` SortBy string `json:""sortby""` Asc bool `json:""asc""` //User specific filters Username string `json:""username""` First_Name string `json:""first_name""` Last_Name string `json:""last_name""` Status string `json:""status""`} b, err := ioutil.ReadAll(r.Body)if err != nil { log.WithFields(logFields).Errorf(""Reading Body Message:failed:%v"", err) return}var filter Filtererr = json.Unmarshal(b, &filter)",How to get all GET request query parameters into a structure in Go?
How to extract and verify token sent from frontend in golang," I am using ""github.com/dgrijalva/jwt-go"", and able to send a token to my frontend, and what I would like to know how I could retrieve the token sent from the frontend so that I can verify if the token that was sent is valid and if so the secured resource will be delivered.Here is the token sent from frontend JavaScript: Here is the code to send token Here is the code to verify the token Am getting nil token as a return, my guess is I have sent bearer and I think it might need parsing if so how? <code>  headers: { 'Authorization':'Bearer' + localStorage.getItem('id_token') } token := jwt.New(jwt.GetSigningMethod(""HS256"")) claims := make(jwt.MapClaims) claims[""userName""] = loginRequest.UserName claims[""exp""] = time.Now().Add(time.Minute * 60).Unix() token.Claims = claims tokenString, err := token.SignedString([]byte(SecretKey)) tokenByte, err := json.Marshal(data) w.WriteHeader(201) w.Write(tokenByte) func VerifyToken(r *http.Request) bool { reqToken := r.Header.Get(""Authorization"") token, err := jwt.Parse(reqToken, func(t *jwt.Token) (interface{}, error) { return []byte(SecretKey), nil }) if err == nil && token.Valid { fmt.Println(""valid token"") return true } else { fmt.Println(""invalid token"") return false }}",How to extract and verify token sent from frontend
Go: How is two dimensional array's memory representation," In Java, two dimensional array is multi one-dimensional array. That means those one-dimensional arrays not consecutive on memory.In contrast, in C, two dimensional array in fact is one-dimensional array with size is total_row * total_column. Because Go language uses many concepts from C.So my question is: does two dimensional array's memory representation in Go look like C or Java? <code> ",What is two dimensional array's memory representation?
How is two dimensional array's memory representation," In Java, two dimensional array is multi one-dimensional array. That means those one-dimensional arrays not consecutive on memory.In contrast, in C, two dimensional array in fact is one-dimensional array with size is total_row * total_column. Because Go language uses many concepts from C.So my question is: does two dimensional array's memory representation in Go look like C or Java? <code> ",What is two dimensional array's memory representation?
What is two dimensional array's memory representation," In Java, two dimensional array is multi one-dimensional array. That means those one-dimensional arrays not consecutive on memory.In contrast, in C, two dimensional array in fact is one-dimensional array with size is total_row * total_column. Because Go language uses many concepts from C.So my question is: does two dimensional array's memory representation in Go look like C or Java? <code> ",What is two dimensional array's memory representation?
Read a set of integers separated by space in golang, I want to read a set of integer values from stdin and put it into integer slice. What is the fastest way to do that without using for loop.e.g. How can I put these values in an integer slice? <code>  Enter the number of integers3Enter the integers23 45 66,Read a set of integers separated by space in Golang
"Convert int array to string saperated by ','"," I know that for string array []string I can use strings.Join(a []string, ',') but I want to do the same thing for an integer array []int.My usecase is something like this for a query where variants is []map[string]int How to achieve this? <code>  var Ids []int sqlStr := ""select id from mapping where my_id in ("" for _, mp := range variants { sqlStr += ""?,"" Ids = append(Ids, mp[""id""]) } sqlStr = strings.TrimRight(sqlStr, "","") rows, err := db.Query(sqlStr+"")"", strings.Join(Ids, ',')) // I can't do this because Join needs String array","Convert int array to string separated by ','"
How to get the list of objects from a sub folder of an amazon s3 bucket using golang?," How do I get the list of objects from a sub folder of an Amazon S3 bucket using golang?I tried: I got the list of all the objects in the bucket, but I need only the list of objects in a subfolder. <code>  svc := s3.New(session.New(), &aws.Config{Region: aws.String(""us-east-1"")})params := &s3.ListObjectsInput{ Bucket: aws.String(""bucket""),}resp, _ := svc.ListObjects(params)for _, key := range resp.Contents { fmt.Println(*key.Key)}",How to get list of objects from sub folder of Amazon S3 bucket using golang?
Why am I loosing precision while converting float32 to float64?," While converting a float32 number to float64 precision is being lost in Go. For example converting 359.9 to float64 produces 359.8999938964844. If float32 can be stored precisely why is float64 losing precision?Sample code: Try it on Playground <code>  package mainimport ( ""fmt"")func main() { var a float32 = 359.9 fmt.Println(a) fmt.Println(float64(a))}",Why am I losing precision while converting float32 to float64?
Golang struct comparison," The Go Programming Language Specification section on Comparison operators leads me to believe that a struct containing only comparable fields should be comparable: Struct values are comparable if all their fields are comparable. Two struct values are equal if their corresponding non-blank fields are equal.As such, I would expect the following code to compile since all of the fields in the ""Student"" struct are comparable: However, it fails to compile with the message: invalid operation: alice >= carol (operator >= not defined on struct)What am I missing? <code>  package maintype Student struct { Name string // ""String values are comparable and ordered, lexically byte-wise."" Score uint8 // ""Integer values are comparable and ordered, in the usual way.""}func main() { alice := Student{""Alice"", 98} carol := Student{""Carol"", 72} if alice >= carol { println(""Alice >= Carol"") } else { println(""Alice < Carol"") }}",Go struct comparison
Is there a simple way to convert base rows to JSON in Golang," Currently on what I've seen so far is that, converting database rows to JSON or to []map[string]interface{} is not simple. I have to create two slices and then loop through columns and create keys every time. ...Some code Is there any package for this ? Or I am missing some basics here  <code>  tableData := make([]map[string]interface{}, 0) values := make([]interface{}, count) valuePtrs := make([]interface{}, count) for rows.Next() { for i := 0; i < count; i++ { valuePtrs[i] = &values[i] } rows.Scan(valuePtrs...) entry := make(map[string]interface{}) for i, col := range columns { var v interface{} val := values[i] b, ok := val.([]byte) if ok { v = string(b) } else { v = val } entry[col] = v } tableData = append(tableData, entry) }",Is there a simple way to convert data base rows to JSON in Golang
How to set different content types when using HTML/TEMPLATE package in GO," When trying to pass a value into .html code I'm using the html/template package.However, I can't seem to set the .css content type that is referenced in my .html file. It is being served to the browser as plain text and thus formatting is ignored.In a static .html file I can use the built-in http.Fileserver which takes care of content types but then templating doesn't work. I can't pass in the variable. It just displays as {{.}}Is there a way to combine the content-type convenience of the built-in fileserver http.Fileserver with the template ability of http.HandleFunc?Here is my code as it stands without using http.Fileserver. Note, my Go file is in the starting directory and the index.html and .css files are in a subdirectory /hello/: Here is my .html file. The html page is being served without any issues. It's the separate .css file that is not being served (linked in the .html file) thus the formatting doesn't occur. <code>  package mainimport ( ""html/template"" ""io/ioutil"" ""log"" ""net/http"")var Message string = ""test page""func servePipe(w http.ResponseWriter, req *http.Request) { dat, err := ioutil.ReadFile(""hello/index.html"") if err != nil { log.Fatal(""couldn't read file:"", err) } templ, err := template.New(""Test"").Parse(string(dat)) if err != nil { log.Fatal(""couldn't parse page:"", err) } templ.Execute(w, Message)}func main() { http.HandleFunc(""/hello/"", servePipe) http.ListenAndServe("":8080"", nil)} <!DOCTYPE html><html><head><title>Test Page</title> <link rel=""stylesheet"" type=""text/css"" href=""style.css""/></head><body> <p>{{.}}</p></body></html>",How to set different content types when using HTML/TEMPLATE package in Go
How can i use golang to make a GUI window?," I am in need to make a simple window in Go to display some text,there is no need for a real GUI like interface.How can I make a window like this using Go? <code> ",How can I use Go to make a GUI window?
How to marshal json string to bson document in golang for writing to MongoDB?," What I am looking is equivalent of Document.parse()in golang, that allows me create bson from json directly? I do not want to create intermediate Go structs for marshaling <code> ",How to marshal json string to bson document for writing to MongoDB?
Golang read multiple times from same reader," I want to use request.Body(type io.ReadCloser) which is containing a image.I dont want to use ioutil.ReadAll() as i want to write this body directly to the file as well as want to decode it, so i only want to use the reference to the content to pass to further function calls, I tried creating multiple instances of reader for example shown below but in second call it always results into nil.Please help me how can i pass multiple separate reference for the same reader? <code>  package mainimport ( ""io/ioutil"" ""log"" ""strings"")func main() { r := strings.NewReader(""some io.Reader stream to be read\n"") a := &r b := &r log.Println(ioutil.ReadAll(*a)) log.Println(ioutil.ReadAll(*b))}",How to read multiple times from same io.Reader
go client program generates a lot a sockets in TIME_WAIT state," I have a Go program that generates a lot of HTTP requests from multiple goroutines. after running for a while, the program spits out an error: connect: cannot assign requested address.When checking with netstat, I get a high number (28229) of connections in TIME_WAIT.The high number of TIME_WAIT sockets happens when I the number of goroutines is 3 and is severe enough to cause a crash when it is 5.I run Ubuntu 14.4 under docker and go version 1.7This is the Go program. This is the server program: <code>  package mainimport ( ""io/ioutil"" ""log"" ""net/http"" ""sync"")var wg sync.WaitGroupvar url=""http://172.17.0.9:3000/"";const num_coroutines=5;const num_request_per_coroutine=100000func get_page(){ response, err := http.Get(url) if err != nil { log.Fatal(err) } else { defer response.Body.Close() _, err =ioutil.ReadAll(response.Body) if err != nil { log.Fatal(err) } }}func get_pages(){ defer wg.Done() for i := 0; i < num_request_per_coroutine; i++{ get_page(); }}func main() { for i:=0;i<num_coroutines;i++{ wg.Add(1) go get_pages() } wg.Wait()} package mainimport ( ""fmt"" ""net/http"" ""log"")var count int;func sayhelloName(w http.ResponseWriter, r *http.Request) { count++; fmt.Fprintf(w,""Hello World, count is %d"",count) // send data to client side}func main() { http.HandleFunc(""/"", sayhelloName) // set router err := http.ListenAndServe("":3000"", nil) // set listen port if err != nil { log.Fatal(""ListenAndServe: "", err) }}",Go client program generates a lot a sockets in TIME_WAIT state
What are golang channels used for?, When looking through some Go code I found the following: I looked up in a online tutorial how Go Channels work:https://tour.golang.org/concurrency/2But I find this example unclear.Can someone give me a easy explanation and an example of the use of channels? <code>  ch := make(chan int),What are channels used for?
What are Golang channels used for?, When looking through some Go code I found the following: I looked up in a online tutorial how Go Channels work:https://tour.golang.org/concurrency/2But I find this example unclear.Can someone give me a easy explanation and an example of the use of channels? <code>  ch := make(chan int),What are channels used for?
golang extract the claims from jwt token," I'm using the dgrijalva/jwt-go/ package.I would like to extract the payload from the token, and I couldn't find a way to do it.Example (taken from : https://jwt.io/):for encoded: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWV9.TJVA95OrM7E2cBab30RMHrHDcEfxjoYZgeFONFh7HgQI would like to extract the payload: I will be grateful for an example (using golang). <code>  { ""sub"": ""1234567890"", ""name"": ""John Doe"", ""admin"": true}",How to extract the claims from JWT token
How to extract the claims from jwt token," I'm using the dgrijalva/jwt-go/ package.I would like to extract the payload from the token, and I couldn't find a way to do it.Example (taken from : https://jwt.io/):for encoded: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWV9.TJVA95OrM7E2cBab30RMHrHDcEfxjoYZgeFONFh7HgQI would like to extract the payload: I will be grateful for an example (using golang). <code>  { ""sub"": ""1234567890"", ""name"": ""John Doe"", ""admin"": true}",How to extract the claims from JWT token
GO: Get all fields from an interface," How do I know the fields I can access from the reply object/interface? I tried reflection but it seems you have to know the field name first. What if I need to know all the fields available to me? <code>  // Do sends a command to the server and returns the received reply.Do(commandName string, args ...interface{}) (reply interface{}, err error)",Get all fields from an interface
Go: Get all fields from an interface," How do I know the fields I can access from the reply object/interface? I tried reflection but it seems you have to know the field name first. What if I need to know all the fields available to me? <code>  // Do sends a command to the server and returns the received reply.Do(commandName string, args ...interface{}) (reply interface{}, err error)",Get all fields from an interface
How to generate a sequence of numbers in Golang?," I want to generate a sequence of numbers in Go but I can't find any built-in functions for this.Basically I want the equivalent of PHP's range function in Golang: It would be useful when creating a slice/array of numeric types and you want to populate/initialize it with a numeric sequence. <code>  array range ( mixed $start , mixed $end [, number $step = 1 ] )",How to generate a sequence of numbers
How to convert a String value to the correct reflect.Kind in go?," Is there a generic helper method in Go to convert a string to the correct value based on reflect.Kind?Or do I need to implement the switch over all kinds myself?I have a value like ""143"" as a string and a reflect.Value with kind ""UInt16"" and like to convert that string value and set it into the UInt16 value of my struct.My current code looks like: This works already, but I wonder if this is already implemented somewhere else. <code>  func setValueFromString(v reflect.Value, strVal string) error { switch v.Kind() { case reflect.Int, reflect.Int8, reflect.Int16, reflect.Int32, reflect.Int64: val, err := strconv.ParseInt(strVal, 0, 64) if err != nil { return err } if v.OverflowInt(val) { return errors.New(""Int value too big: "" + strVal) } v.SetInt(val) case reflect.Uint, reflect.Uint8, reflect.Uint16, reflect.Uint32, reflect.Uint64: val, err := strconv.ParseUint(strVal, 0, 64) if err != nil { return err } if v.OverflowUint(val) { return errors.New(""UInt value too big: "" + strVal) } v.SetUint(val) case reflect.Float32: val, err := strconv.ParseFloat(strVal, 32) if err != nil { return err } v.SetFloat(val) case reflect.Float64: val, err := strconv.ParseFloat(strVal, 64) if err != nil { return err } v.SetFloat(val) case reflect.String: v.SetString(strVal) case reflect.Bool: val, err := strconv.ParseBool(strVal) if err != nil { return err } v.SetBool(val) default: return errors.New(""Unsupported kind: "" + v.Kind().String()) } return nil}",How to convert a string value to the correct reflect.Kind in go?
Golang Regex Get Value inside brackets," Code: How to Get Value inside parentheses? <code>  package mainimport ( ""fmt"" ""regexp"")func main() { r := regexp.MustCompile(`((.*))`) s := `(tag)SomeText` res := r.FindStringSubmatch(s) fmt.Println(res[1])}",Golang regex get value inside parentheses
Golang Regex Get Value inside parentheses," Code: How to Get Value inside parentheses? <code>  package mainimport ( ""fmt"" ""regexp"")func main() { r := regexp.MustCompile(`((.*))`) s := `(tag)SomeText` res := r.FindStringSubmatch(s) fmt.Println(res[1])}",Golang regex get value inside parentheses
How to generate *unique* random number in go using standard library," How can I generate a stream of unique random number in Go?I want to guarantee there are no duplicate values in array a using math/rand and/or standard Go library utilities. There are questions and solutions on how to generate a series of random number in Go, for example, here.But I would like to generate a series of random numbers that does not duplicate previous values. Is there a standard/recommended way to achieve this in Go?My guess is to (1) use permutation or to (2) keep track of previously generated numbers and regenerate a value if it's been generated before.But solution (1) sounds like overkill if I only want a few number and (2) sounds very time consuming if I end up generating a long series of random numbers due to collision, and I guess it's also very memory-consuming.Use Case: To benchmark a Go program with 10K, 100K, 1M pseudo-random number that has no duplicates. <code>  func RandomNumberGenerator() *rand.Rand { s1 := rand.NewSource(time.Now().UnixNano()) r1 := rand.New(s1) return r1}rng := RandomNumberGenerator() N := 10000for i := 0; i < N; i++ { a[i] = rng.Int()}",How to generate a stream of *unique* random numbers in Go using the standard library
How to generate *unique* random number in Go using standard library," How can I generate a stream of unique random number in Go?I want to guarantee there are no duplicate values in array a using math/rand and/or standard Go library utilities. There are questions and solutions on how to generate a series of random number in Go, for example, here.But I would like to generate a series of random numbers that does not duplicate previous values. Is there a standard/recommended way to achieve this in Go?My guess is to (1) use permutation or to (2) keep track of previously generated numbers and regenerate a value if it's been generated before.But solution (1) sounds like overkill if I only want a few number and (2) sounds very time consuming if I end up generating a long series of random numbers due to collision, and I guess it's also very memory-consuming.Use Case: To benchmark a Go program with 10K, 100K, 1M pseudo-random number that has no duplicates. <code>  func RandomNumberGenerator() *rand.Rand { s1 := rand.NewSource(time.Now().UnixNano()) r1 := rand.New(s1) return r1}rng := RandomNumberGenerator() N := 10000for i := 0; i < N; i++ { a[i] = rng.Int()}",How to generate a stream of *unique* random numbers in Go using the standard library
How to generate a stream of *unique* random numbers in Go using standard library," How can I generate a stream of unique random number in Go?I want to guarantee there are no duplicate values in array a using math/rand and/or standard Go library utilities. There are questions and solutions on how to generate a series of random number in Go, for example, here.But I would like to generate a series of random numbers that does not duplicate previous values. Is there a standard/recommended way to achieve this in Go?My guess is to (1) use permutation or to (2) keep track of previously generated numbers and regenerate a value if it's been generated before.But solution (1) sounds like overkill if I only want a few number and (2) sounds very time consuming if I end up generating a long series of random numbers due to collision, and I guess it's also very memory-consuming.Use Case: To benchmark a Go program with 10K, 100K, 1M pseudo-random number that has no duplicates. <code>  func RandomNumberGenerator() *rand.Rand { s1 := rand.NewSource(time.Now().UnixNano()) r1 := rand.New(s1) return r1}rng := RandomNumberGenerator() N := 10000for i := 0; i < N; i++ { a[i] = rng.Int()}",How to generate a stream of *unique* random numbers in Go using the standard library
Golang: group and sum slices," I come from the .NET world where I had LINQ so I could do in-memory queries like the one we usually see in SQL.I have a slice of this structure I want to group by 8 fields, and then sum another integer field. Something like: I thought in:Creating an Equal function, to compare structures (those eightfields).Iterate over the collection I'm analyzing. For each itemcheck if it is already in the hash table. If it is there => I sumthe field. If it is not => I add the new item to hash table.Is there a better way or any beautiful, efficient and easy ready to uselibrary? <code>  type Register struct { id1 int id2 int id3 int id4 int id5 int id6 int id7 int id8 int money int}",Golang: group and sum slice of structs
Are golang slices pass by value?," In Go, I am trying to make a scramble slice function for my traveling salesman problem. While doing this I noticed when I started editing the slice I gave the scramble function was different every time I passed it in.After some debugging I found out it was due to me editing the slice inside the function. But since Go is supposed to be a ""pass by value"" language, how is this possible?https://play.golang.org/p/mMivoH0TuVI have provided a playground link to show what I mean.By removing line 27 you get a different output than leaving it in, this should not make a difference since the function is supposed to make its own copy of the slice when passed in as an argument.Can someone explain the phenomenon? <code> ",Are slices passed by value?
Are golang slices passed by value?," In Go, I am trying to make a scramble slice function for my traveling salesman problem. While doing this I noticed when I started editing the slice I gave the scramble function was different every time I passed it in.After some debugging I found out it was due to me editing the slice inside the function. But since Go is supposed to be a ""pass by value"" language, how is this possible?https://play.golang.org/p/mMivoH0TuVI have provided a playground link to show what I mean.By removing line 27 you get a different output than leaving it in, this should not make a difference since the function is supposed to make its own copy of the slice when passed in as an argument.Can someone explain the phenomenon? <code> ",Are slices passed by value?
Golang Group by key + merge array values," I'm trying to merge the array values of multiple arrays with same keys (sort of group by + merge). Is there any native way in Go to transform this input: into: <code>  input = [ [ { a: 1, b: [1,2]}, { a: 2, b: [1,2]}, {a: 3, b: [1,2]} ], [ { a: 1, b: [3,4]}, { a: 2, b: [3,4]}, { a: 3, b: [3,4]}, { a: 4, b: [3,4]} ], [ { a:1, b: [5,6]}, { a:2, b: [5,6]}, { a:3, b: [5,6]}, { a:4, b: [5,6]}, { a:5, b: [5,6]} ] ] output = [ { a: 1, b: [1,2,3,4,5,6]}, { a: 2, b: [1,2,3,4,5,6]}, { a: 3, b: [1,2,3,4,5,6]}, { a: 4, b: [3,4, 5,6]}, { a: 5, b: [5,6]},]",Group by key + merge array values
how set GOBIN automatically, working my go project i need toset GOPATH=D:\projects\go\my projectand thenset GOBIN=D:\projects\go\my project\binthat is okey then working on an other project same process a gainso is there is away of setting only GOPATHand automatically GOBIN becomes GOPATH\bin <code> ,How to set GOBIN automatically
Go : difference between *string and sql.NullString," I've been strugguling with SQL NULL values in Golang recently. After trying to unsuccessfully unmarshal JSON objects using Decode() and sql.NullString, I came to this answer on StackOverflow : Assigning null to JSON fields instead of empty strings in GolangThe solution using a string pointer seems to work perfectly with Decode() and nil values. So what is the difference between sql.NullString and *string ?Is it just about nil checking ? <code> ",Difference between *string and sql.NullString
Set status code on http.ResponseWriter, How do I set the HTTP status code on an http.ResponseWriter (e.g. to 500 or 403)?I can see that requests normally have a status code of 200 attached to them. <code> ,How to set HTTP status code on http.ResponseWriter
How do you make a function accept multiple types in go?," I am having a function like this: I am trying to return different types of strings based on the type. I am just stuck at the point of how do I write a function that accepts arguments of different types. <code>  package mainimport ""flag""import ""fmt""func print_out_type(x anything) string { switch v := x.(type) { case string: return ""A string"" case int32: return ""An Integer"" default: return ""A default"" }}func main() { wordPtr := flag.String(""argument1"", ""foo"", ""a String"") numPtr := flag.Int(""argument2"", 42, ""an Integer"") flag.Parse() fmt.Println(""word: "", *wordPtr) fmt.Println(""number: "", *numPtr)}",How do you make a function accept multiple types?
how to include a struct's field in JSON dynamically?," I have a struct Base : And two more structs that embed Base: Now I want to Marshal the structs First and Second but with a little difference. I want to include the Name field in First but I don't want to include it in Second.Or to simplify the question I want to opt in and out a struct's field in its JSON dynamically. Note:The Name value always has value and I don't want to change it. <code>  type Base struct { Name string `json:""name,omitempty""` // ... other fields} type First struct { Base // ... other fields}type Second struct { Base // ... other fields}",How to include / exclude a struct's field in JSON dynamically?
Write to beginning of buffer golang?," I have: Which appends to the buffer, is it possible to write to the beginning of a buffer? <code>  var buffer bytes.Buffers := ""something to do""for i := 0; i < 10; i++ { buffer.WriteString(s)}",Write to beginning of the buffer in Golang?
Exported and Unexported types in Go Language," I have a function in Go, the return value of which I hope to encode using gob. The return value is a struct pointer. However even though I do understand what exported variables are, I am not quite sure how to get it working.Here is what my function is like This is the error I get I know why the error is occurring. But can someone help me solve it? <code>  fun loadXYZ(root *structABC) *structABC{ const once = ""stateData.bin"" rd, errr := ioutil.ReadFile(once) if errr!=nil{ //Do some computation and store in ""root"" buf := &bytes.Buffer{} errr = gob.NewEncoder(buf).Encode(root) if errr != nil { panic(errr) } errr = ioutil.WriteFile(once, buf.Bytes(), 0666) if errr != nil { panic(errr) } return root } var d *structABC errr = gob.NewDecoder(bytes.NewReader(rd)).Decode(&d) if errr != nil { panic(errr) } return d} panic: gob: type main.stateNode has no exported fields",Exported and Unexported fields in Go Language
Golang - Parse an Int to Hex and then Pad it with 0's to get a fixed lenght String [Beginner]," I'm having some issues on trying to convert an int to hex then, padding it with 0s in order to get a 6 Characters String which represents the hex number.So far, I tried the following: And then I found out how to pad it with 0s, using %06d, number/string. It makes all the strings 6 characters long.Here you can Find a Playground which I set up to make some tests.How can I achieve this in a efficient way? For any Clarifications on the question, just leave a comment below.Thanks In advance. <code>  intNumber := 12hexNumber := strconv.FormatInt(intNumber, 16) //not working",Convert an int to hex and then pad it with 0's to get a fixed length String
How do I get bit representation of a byte in golang?," I'm trying to compute the Hamming distance between two byte's, such thatHammingDist(byte(255), byte(0)) == 8 I need the bits in each byte, but I can't find any function in any of the built-in packages for doing so. So, given byte(1) how do I get the bit representation 00000001? <code> ",How do I get the bits from a byte in golang?
Why golang can lower GC pauses to sub 1ms and JVM has not?," So there's that: https://groups.google.com/forum/?fromgroups#!topic/golang-dev/Ab1sFeoZg_8:Today I submitted changes to the garbage collector that make typical worst-case stop-the-world times less than 100 microseconds. This should particularly improve pauses for applications with many active goroutines, which could previously inflate pause times significantly.High GC pauses are one of the things JVM users struggle with for a long time.What are the (architectural?) constraints which prevent JVM from lowering GC pauses to Go levels, but are not affecting Go? <code> ",Why Go can lower GC pauses to sub 1ms and JVM has not?
Golang - How to assign default value if env var is empty?," How do you assign a default value if an environment variable isn't set in Go?In Python I could do mongo_password = os.getenv('MONGO_PASS', 'pass') where pass is the default value if MONGO_PASS env var isn't set.I tried an if statement based on os.Getenv being empty, but that doesn't seem to work due to the scope of variable assignment within an if statement. And I'm checking for multiple env var's, so I can't act on this information within the if statement. <code> ",How to assign default value if env var is empty?
Golang context.WithValue: how to add several key-value pairs," With Go's context package it is possible to pass request-specific data to the stack of request handling functions using This creates a new Context which is a copy of parent and contains the value val which can be accessed with key.How do I proceed if I want to store several key-value pairs in a Context? Shall I call WithValue() several times, each time passing the Context received from my last call to WithValue()? This appears cumbersome.Or shall I use a struct and put all my data there, s.t. I need to pass only one value (which is the struct), from which all others can be accessed?Or is there a way of passing several key-value pairs to WithValue()? <code>  func WithValue(parent Context, key, val interface{}) Context",context.WithValue: how to add several key-value pairs
Converting string to json or struct in GoLang," I want to get a string that represents a json like this one: and include a ""count"" key in it so it ends like this: This is why I planned to convert it to json so I could add the count and thenmake it a string again. The problem is I don't know the structure of thatJSON, so I can't use json.Unmarshal(in, &myStruct) because that structvaries. How can I do this? <code>  { ""votes"": { ""option_A"": ""3"" } } { ""votes"": { ""option_A"": ""3"" }, ""count"": ""1"" }",Decode JSON with unknown structure
Converting string to json or struct," I want to get a string that represents a json like this one: and include a ""count"" key in it so it ends like this: This is why I planned to convert it to json so I could add the count and thenmake it a string again. The problem is I don't know the structure of thatJSON, so I can't use json.Unmarshal(in, &myStruct) because that structvaries. How can I do this? <code>  { ""votes"": { ""option_A"": ""3"" } } { ""votes"": { ""option_A"": ""3"" }, ""count"": ""1"" }",Decode JSON with unknown structure
How to send an interrupt signal in golang?," I'm trying to implement a function that would call an interrupt signal in Go. I know how to intercept interrupt signals from the console, by using signal.Notify(interruptChannel, os.Interrupt), however, I can't find a way to actually send the interrupt signals around. I've found that you can send a signal to a process, but I'm not sure if this can be used to send a top-level interrupt signal.Is there a way to send an interrupt signal from within a Go function that could be captured by anything that is listening for system interrupt signals, or is that something that's not supported in Go? <code> ",How to send an interrupt signal
Golang Inject to html," I know there is struct in Go, but for all I know, you have to define struct I am wondering how you can declare a new variable that doesn't exist in the struct <code>  type Circle struct{ x,y,r float64} circle := new(Circle)circle.color = ""black""",Golang dynamically creating member of struct
Golang gin-gonic render template," I know there is struct in Go, but for all I know, you have to define struct I am wondering how you can declare a new variable that doesn't exist in the struct <code>  type Circle struct{ x,y,r float64} circle := new(Circle)circle.color = ""black""",Golang dynamically creating member of struct
Golang dynamic Struct," I know there is struct in Go, but for all I know, you have to define struct I am wondering how you can declare a new variable that doesn't exist in the struct <code>  type Circle struct{ x,y,r float64} circle := new(Circle)circle.color = ""black""",Golang dynamically creating member of struct
Golang dynamic creating member of Struct," I know there is struct in Go, but for all I know, you have to define struct I am wondering how you can declare a new variable that doesn't exist in the struct <code>  type Circle struct{ x,y,r float64} circle := new(Circle)circle.color = ""black""",Golang dynamically creating member of struct
golang type assertions and type switches," when I run the code snippet bellow, it raise a error a.test undefined (type interface {} is interface with no methods)It seem the type switch does not take effect. If I change it to it's ok now. <code>  package mainimport ( ""fmt"")type A struct { a int}func(this *A) test(){ fmt.Println(this)}type B struct { A}func main() { var foo interface{} foo = A{} switch a := foo.(type){ case B, A: a.test() }} switch a := foo.(type){ case A: a.test() }",golang multiple case in type switch
"Golang time, add hours, minutes and seconds"," How do I add hours, minutes, and seconds (defined as ints) to the current time, similar to AddDate? but with hours, minutes, and seconds. <code>  timein := time.Now().Local().AddDate(Hours, Mins, Sec)","Adding hours, minutes, seconds to current time"
"Golang: Adding hours, minutes, seconds to current time"," How do I add hours, minutes, and seconds (defined as ints) to the current time, similar to AddDate? but with hours, minutes, and seconds. <code>  timein := time.Now().Local().AddDate(Hours, Mins, Sec)","Adding hours, minutes, seconds to current time"
golang http handle request time taken, I am trying to set a timer to count how much time is needed for my server to finish a request and I want the timer to stop after the last byte of the response is sent. I found that the http server will only send the response after the handler function returns. Is there any way to add a callback after the response is sent ? Or is there a better way to count the time taken from the first byte of the request coming in till the last byte byte of the response is sent ? <code> ,Golang http handler - time taken for request
how to send fcm push notification using goalng fcmm server," I'm doing Ionic apps, using Cordova fcm plugin I get the device token. Now I want to send the push notification from go server. How to use go as the fcm server? I need some implementation example. <code> ",how to send fcm push notification using golang fcm server
how to send fcm push notification using goalng fcm server," I'm doing Ionic apps, using Cordova fcm plugin I get the device token. Now I want to send the push notification from go server. How to use go as the fcm server? I need some implementation example. <code> ",how to send fcm push notification using golang fcm server
Convert yaml to json without struct (Golang)," I want to convert this yaml string to json, cause the source data is dynamic, so I can't map it to a struct: Then I want to convert that interface to json string again: But an error occur: <code>  Services: - Orders: - ID: $save ID1 SupplierOrderCode: $SupplierOrderCode - ID: $save ID2 SupplierOrderCode: 111111 var body interface{}err := yaml.Unmarshal([]byte(s), &body) b, _ := json.Marshal(body) panic: json: unsupported type: map[interface {}]interface {}",Convert yaml to json without struct
"How to Trim ""["" char from a string in Golnag"," Probably a silly thing but got stuck on it for a bit...Can't trim a ""["" char from a string, things I tried with outputs: go playgroundAlso tried all of those, with no success: None worked. What am I missing here? <code>  package mainimport ( ""fmt"" ""strings"")func main() { s := ""this[things]I would like to remove"" t := strings.Trim(s, ""["") fmt.Printf(""%s\n"", t) }// output: this[things]I would like to remove s := ""this [ things]I would like to remove""t := strings.Trim(s, "" [ "")// output: this [ things]I would like to removes := ""this [ things]I would like to remove""t := strings.Trim(s, ""["")// output: this [ things]I would like to remove","How to Trim ""["" char from a string in Golang"
idiomatic goroutine termination and error handling," I have a simple concurrency use case in go, and I cannot figure out an elegant solution to my problem.I want to write a method fetchAll that queries an unspecified number of resources from remote servers in parallel. If any of the fetches fails, I want to return that first error immediately.My initial implementation leaks goroutines: Playground: https://play.golang.org/p/Be93J514R5I know from reading https://blog.golang.org/pipelines that I can create a signal channel to cleanup the other threads. Alternatively, I could probably use context to accomplish it. But it seems like such a simple use case should have a simpler solution that I'm missing. <code>  package main import ( ""fmt"" ""math/rand"" ""sync"" ""time"" ) func fetchAll() error { wg := sync.WaitGroup{} errs := make(chan error) leaks := make(map[int]struct{}) defer fmt.Println(""these goroutines leaked:"", leaks) // run all the http requests in parallel for i := 0; i < 4; i++ { leaks[i] = struct{}{} wg.Add(1) go func(i int) { defer wg.Done() defer delete(leaks, i) // pretend this does an http request and returns an error time.Sleep(time.Duration(rand.Intn(100)) * time.Millisecond) errs <- fmt.Errorf(""goroutine %d's error returned"", i) }(i) } // wait until all the fetches are done and close the error // channel so the loop below terminates go func() { wg.Wait() close(errs) }() // return the first error for err := range errs { if err != nil { return err } } return nil } func main() { fmt.Println(fetchAll()) }",Idiomatic goroutine termination and error handling
"Go, X does not implement Y (... method has a pointer receiver)"," There are already several Q&As on this ""X does not implement Y (... method has a pointer receiver)"" thing, but to me, they seems to be talking about different things, and not applying to my specific case.So, instead of making the question very specific, I'm making it broad and abstract -- Seems like there are several different cases that can make this error happen, can someone summary it up please?I.e., how to avoid the problem, and if it occurs, what are the possibilities? Thx. <code> ",X does not implement Y (... method has a pointer receiver)
Golang reflect: Get Type representation from name?," Is there a way to use the reflection libraries in Go to go from the name of a type to its Type representation?I've got a library where the user needs to provide Type representations for some code generation. I know it must be possible (in a sense) because they can just create a variable of that type and call the TypeOf function, but is there a way to circumvent this and just get representation from the name? <code> ",How to get Type representation from name via reflection?
How can I init a golang map in one instruction?," This is my code: Can I do the same thing in one statement and/or in one line? <code>  var keys map[int]stringkeys = make(map[int]string)keys[1] = ""aa""keys[2] = ""ab""keys[3] = ""ac""keys[4] = ""ba""keys[5] = ""bb""keys[6] = ""bc""keys[7] = ""ca""keys[8] = ""cb""keys[9] = ""cc""",Initializing a Go map in a single statement
why not use %v to print int and string," I know to print int we can use %d, and string we can use %sbut we can still use %v to print them. So what if I always use %v to print them? What issue will happen if I do this? <code> ",Why not use %v to print int and string
format float in golang html/template," I want to format float64 value to 2 decimal places in golang html/template say in index.html file. In .go file I can format like: But I don't know how to format it in template. I am using gin-gonic/gin framework for backend. Any help will be appreciated. Thanks. <code>  strconv.FormatFloat(value, 'f', 2, 32)",Format float in golang html/template
why passing pointer to channel is slower," I'm a newbie to golang, trying to rewrite my java server project in golang.I found, passing pointers into channel cause almost 30% performance drop compared to passing values.Here is a sample snippet: package main import ( ""time"" ""fmt"" ) update. fix the package missing <code>  var c = make(chan t, 1024)// var c = make(chan *t, 1024)type t struct { a uint b uint}func main() { start := time.Now() for i := 0; i < 1000; i++ { b := t{a:3, b:5} // c <- &b c <- b } elapsed := time.Since(start) fmt.Println(t2)}",Why passing pointers to channel is slower
difference between encoding/gob and encoding/json in golang," I am writing an application in Go which uses encoding/gob to send structures and slices over UDP between nodes. It works fine but I notice that encoding/json also has the similar API. Searched and found this information(https://golang.org/pkg/encoding/): gob Package gob manages streams of gobs - binary values exchanged between an Encoder (transmitter) and a Decoder (receiver). json Package json implements encoding and decoding of JSON as defined in RFC 4627.Can someone explain to me whether one is more efficient than the other and in general compare when to choose what? Also if I need to interface with a non-Go application, I guess json would be preferred? <code> ",difference between encoding/gob and encoding/json
Go - Check if IP address is in private network space," I have a program in go which accepts URLs from clients and gets them using the net/http package. Before doing further processing, I would like to check if the URL maps to private (non-routable / RFC1918 networks) address space.The straight-forward way would be to perform an explicit DNS request and check the address for the known private ranges. After that, perform the HTTP GET request for the URL.Is there a better way to accomplish this? Preferably integrating with http.Client so it can be performed as a part of the GET request. <code> ",Check if IP address is in private network space
How to create singleton DB class in GoLang," I referred a few code samples of how to create go singleton but I wish to have methods in those and call them on their singleton reference. My Code is as follows With a new answer I have updated this question including answer. But I have a few queries. How to cathc and return exception from gorm.Create(..) <code>  package dbproviderimport ( ""github.com/jinzhu/gorm"" _""github.com/jinzhu/gorm/dialects/sqlite"" ""rest/article"" ""log"")type DBOperations interface { AddArticle(article *article.Article)}type DBManager struct { db *gorm.DB isInitialized bool}var dbManagerInstance = new()func GetDBManager() DBManager { return dbManagerInstance}func new() DBManager { localDbRef, err := gorm.Open(""sqlite3"", ""../articles.db"") if (err != nil) { panic(""Error initializing db"") } else { log.Print(""DB Initialized successfully"") } return DBManager{db:localDbRef, isInitialized:true}}func (dbManager DBManager) AddArticle(article article.Article) (err error) { if (dbManager.isInitialized) { tx := dbManager.db.Begin() //dbManager.db.NewRecord(article) //dbManager.db.Commit() tx.NewRecord(article) tx.Commit() errs := dbManager.db.GetErrors() if (len(errs) > 0) { err = errs[0] } else { log.Print(""No error in this transactions"") } } return}",How to create singleton DB instance
Golang Templates - If not true (!true)," In golang's template/html package, I can use {{ if .loggedIn }} to check if logged in is true.How do I check if .loggedIn is false without using ne or eq?For example, I am looking for something like <code>  {{ if !.loggedIn }}<h1>Not logged in</h1>{{ end }}",If not true (!true)
scape string special characters for use in golang regexp," I have an array of characters like this : When I join them in regular way (strings.Join(chars, """")) and pass it to regexp.MustCompile, Its panic : How can I scape string special characters for use in golang regexp as a character not regexp operator? <code>  chars := []string{""."", ""-"", ""("", "")""} panic: regexp: Compile(`[.-()]`): error parsing regexp: invalid character class range: `.-(`",Escape string special characters for use in golang regexp
How to run application in Gogland?," I have a small project with several .go files. When I run main.go only this compiles but nothing else, so my application crushes. I understand that I have to change settings in Run -> Edit Configurations, but don't know what to do exactly. IDE also doesnt see terminal pre-compiled package, so ""Package"" option instead of ""File"" doesn't work. <code> ",How to run the whole project in GoLand?
How to run the whole project in Gogland?," I have a small project with several .go files. When I run main.go only this compiles but nothing else, so my application crushes. I understand that I have to change settings in Run -> Edit Configurations, but don't know what to do exactly. IDE also doesnt see terminal pre-compiled package, so ""Package"" option instead of ""File"" doesn't work. <code> ",How to run the whole project in GoLand?
When to use log over fmt," I know that we can print variable or error using log and fmt. for example if I want to print variable I can do this : the output would be : and usually in the error handling I found log like this but from above case I could also use fmt to print the error like this Is it a good practice to use fmt instead of log for printing the error?And then I always use fmt instead of log for printing the variable when debugging. <code>  h := ""world""fmt.Printf(""hello = %v\n"", h)log.Printf(""halo = %v\n"", h) hello = world2016/12/30 09:13:12 halo = world if err != nil { log.Println(""Error : something terrible happen -> "", err) return err} fmt.Printf(""Error : something terrible happen -> %v\n"",err.Error())",When to use log over fmt for debugging and printing error?
When to use log over fmt?," I know that we can print variable or error using log and fmt. for example if I want to print variable I can do this : the output would be : and usually in the error handling I found log like this but from above case I could also use fmt to print the error like this Is it a good practice to use fmt instead of log for printing the error?And then I always use fmt instead of log for printing the variable when debugging. <code>  h := ""world""fmt.Printf(""hello = %v\n"", h)log.Printf(""halo = %v\n"", h) hello = world2016/12/30 09:13:12 halo = world if err != nil { log.Println(""Error : something terrible happen -> "", err) return err} fmt.Printf(""Error : something terrible happen -> %v\n"",err.Error())",When to use log over fmt for debugging and printing error?
String format golang from slice values," Here I am trying to create a query string for my API from a slice containing strings. ie. where={""node_name"":""node1"",""node_name"":""node_2""} Here is goplayground link.What is the best way to get the result? <code>  import ( ""fmt"" ""strings"")func main() { nodes := []string{""node1"", ""node2""} var query string for _, n := range nodes { query += fmt.Sprintf(""\""node_name\"":\""%s\"","", n) } query = strings.TrimRight(query, "","") final := fmt.Sprintf(""where={%s}"", query) fmt.Println(final)}",Golang string format using slice values
time.Duration type conversion to other type in golang," I am using go-ping ( https://github.com/sparrc/go-ping )library of golang for unprivileged ICMP ping. From running this, I am getting latency in milliseconds and jitter in microseconds. I want same unit for both let's say millisecond so when I am doing jitter = stats.StdDevRtt/1000 or jitter = jitter/1000 (to convert microseconds to milliseconds), what I am getting is jitter in nanoseconds :(. Is there any way to get same unit milliseconds for both latency and jitter. <code>  timeout := time.Second*1000interval := time.Secondcount := 5host := p.ipAddrpinger, cmdErr := ping.NewPinger(host)pinger.Count = countpinger.Interval = intervalpinger.Timeout = timeoutpinger.SetPrivileged(false)pinger.Run()stats := pinger.Statistics()latency = stats.AvgRtt // stats.AvgRtt is time.Duration typejitter = stats.StdDevRtt// stats.StdDevRtt is time.Duration type",Conversion of time.Duration type microseconds value to milliseconds
conversion of time.Duration type microseconds value to milliseconds in golang," I am using go-ping ( https://github.com/sparrc/go-ping )library of golang for unprivileged ICMP ping. From running this, I am getting latency in milliseconds and jitter in microseconds. I want same unit for both let's say millisecond so when I am doing jitter = stats.StdDevRtt/1000 or jitter = jitter/1000 (to convert microseconds to milliseconds), what I am getting is jitter in nanoseconds :(. Is there any way to get same unit milliseconds for both latency and jitter. <code>  timeout := time.Second*1000interval := time.Secondcount := 5host := p.ipAddrpinger, cmdErr := ping.NewPinger(host)pinger.Count = countpinger.Interval = intervalpinger.Timeout = timeoutpinger.SetPrivileged(false)pinger.Run()stats := pinger.Statistics()latency = stats.AvgRtt // stats.AvgRtt is time.Duration typejitter = stats.StdDevRtt// stats.StdDevRtt is time.Duration type",Conversion of time.Duration type microseconds value to milliseconds
is it possible to run golang code as a `script`?," As Go is becoming the language of the ""system"". I wonder if it's possible to run Go code as a script, without compiling it, is there any possibility to do that?The motivation (as there were questions as for motivation), taken from How to use Scala as a scripting language Problem You want to use Scala as a scripting language on Unix systems, replacing other scripts youve written in a Unix shell (Bourne Shell, Bash), Perl, PHP, Ruby, etc.UPDATE:I wonder how much I can ""abuse"" go run to be able to have much Go code running as scripts though compiled (which I like that its compiled) but it looks like go run can give me the opportunity to replace scripting, that is have source files on servers and run them as source while getting compiled by the go run but I still manage sources and not executables.UPDATE:in addition saw gorun gorun - Script-like runner for Go source files.Though there is a motivation and tools which tried to workaround not being able to run as script, I will not go for it, +I've been told it's not production ready and was advised not to use it in production because it's not production ready, it's out of it's purpose and would need dump the scripting convenience in favour of Go. (I don't have anything against compiling, static typing, I'm a big fan of it, but wanted something similar to scripting convenience). <code> ",Is it possible to run Go code as a script?
"In golang packages, why is fasthttp is faster than net/http?"," A fasthttp based server is up to 10 times faster than net/http.Which implementation details make fasthttp so much faster? Moreover, how does it manage incoming requests better than net/http? <code> ",Why is fasthttp faster than net/http?
"In golang packages, why is fasthttp faster than net/http?"," A fasthttp based server is up to 10 times faster than net/http.Which implementation details make fasthttp so much faster? Moreover, how does it manage incoming requests better than net/http? <code> ",Why is fasthttp faster than net/http?
How to get the keys as string array from map in go lang?," I need to use strings.Join(invoicesBatch, "","") to join a string array. But the array I got from the map using reflect.ValueOf(invoiceList).MapKeys() is reflect.Value array. Is there a easy way to convert them into a string array. The map was initialized with string key. <code> ",How to get the keys as string array from map?
Golang: Why does the memory address of a struct reference change?," I have a struct and a method that's working on the structs reference. The pointer address is changing every time I call the method. Why is it like that? Code Output: <code>  package mainimport ""k8s.io/contrib/compare/Godeps/_workspace/src/github.com/emicklei/go-restful/log""type Whatever struct{ Name string}func (whatever *Whatever) GetNameByReference() (string) {log.Printf(""Whatever.GetNameByReference() memory address: %v"", &whatever) return whatever.Name}func evaluateMemoryAddressWhenNotWritingAnything() { whatever := Whatever{} whatever.GetNameByReference() whatever.GetNameByReference() whatever.GetNameByReference()}func main() { evaluateMemoryAddressWhenNotWritingAnything()} log.go:30: Whatever.GetNameByReference() memory address: 0xc420034020log.go:30: Whatever.GetNameByReference() memory address: 0xc420034030log.go:30: Whatever.GetNameByReference() memory address: 0xc420034038",Why does the memory address of a struct reference change?
Does golang depend on c runtime?, I can't find info does golang depend on c runtime? If it's depend on it is it's statically compiled in go-binary to make Go-app work everywhere without dependences? Here is topic about what C-runtime is  <code> ,Does Go depend on C runtime?
How do I use reflect.Deepequal() to compare a pointer's value against the zero value of its type?," I need a generic function to check whether something is equal to its zero-value or not.From this question, I was able to find a function that worked with value types. I modified it to support pointers: Unfotunately, this didn't work for me when doing something like this: This is because &myStruct{} is a pointer and there is no way to dereference an interface{} inside the function. How do I compare the value of that pointer against the zero-value of its type? <code>  func isZeroOfUnderlyingType(x interface{}) bool { rawType := reflect.TypeOf(x) //source is a pointer, convert to its value if rawType.Kind() == reflect.Ptr { rawType = rawType.Elem() } return reflect.DeepEqual(x, reflect.Zero(rawType).Interface())} type myStruct struct{}isZeroOfUnderlyingType(myStruct{}) //Returns true (works)isZeroOfUnderlyingType(&myStruct{}) //Returns false (doesn't) work",How do I use reflect.DeepEqual() to compare a pointer's value against the zero value of its type?
Convert uint64 to string in golang," I am trying to print a string with a uint64 but no combination of strconv methods that I use is working. Gives me:cannot use charge.Amount (type uint64) as type int in argument to strconv.ItoaHow can I print this string? <code>  log.Println(""The amount is: "" + strconv.Itoa((charge.Amount)))",How to convert uint64 to string
GO - Why implcit non-pointer methods do not satisfy interface?," Assuming we have an understanding that, For explicit method definition for type X, GO compiler implicitly defines the same method for type *X and vice versa, if I declare, and declare, then GO compiler gives error, which indicates that, pointer method is implicitly defined and vice versaIn the below code, GO compiler gives error, at x = c, because, implicit pointer methods satisfy interfaces, but implicit non-pointer methods do not.Question:Why implicit non-pointer methods do not satisfy interfaces? <code>  func (c Cat) foo(){ //do stuff_} func (c *Cat) foo(){ // do stuff_} Compile error: method re-declared package maintype X interface{ foo(); bar();}type Cat struct{}func (c Cat) foo(){ // do stuff_}func (c *Cat) bar(){ // do stuff_}func main() { var c Cat var p *Cat var x X x = p // OK; *Cat has explicit method bar() and implicit method foo() x = c //compile error: Cat has explicit method foo() and implicit method bar()} cannot use c (type Cat) as type X in assignment: Cat does not implement X (bar method has pointer receiver)",Why implicit non-pointer methods not satisfy interface?
GO - Why implicit non-pointer methods do not satisfy interface?," Assuming we have an understanding that, For explicit method definition for type X, GO compiler implicitly defines the same method for type *X and vice versa, if I declare, and declare, then GO compiler gives error, which indicates that, pointer method is implicitly defined and vice versaIn the below code, GO compiler gives error, at x = c, because, implicit pointer methods satisfy interfaces, but implicit non-pointer methods do not.Question:Why implicit non-pointer methods do not satisfy interfaces? <code>  func (c Cat) foo(){ //do stuff_} func (c *Cat) foo(){ // do stuff_} Compile error: method re-declared package maintype X interface{ foo(); bar();}type Cat struct{}func (c Cat) foo(){ // do stuff_}func (c *Cat) bar(){ // do stuff_}func main() { var c Cat var p *Cat var x X x = p // OK; *Cat has explicit method bar() and implicit method foo() x = c //compile error: Cat has explicit method foo() and implicit method bar()} cannot use c (type Cat) as type X in assignment: Cat does not implement X (bar method has pointer receiver)",Why implicit non-pointer methods not satisfy interface?
GO - Why implicit non-pointer methods not satisfy interface?," Assuming we have an understanding that, For explicit method definition for type X, GO compiler implicitly defines the same method for type *X and vice versa, if I declare, and declare, then GO compiler gives error, which indicates that, pointer method is implicitly defined and vice versaIn the below code, GO compiler gives error, at x = c, because, implicit pointer methods satisfy interfaces, but implicit non-pointer methods do not.Question:Why implicit non-pointer methods do not satisfy interfaces? <code>  func (c Cat) foo(){ //do stuff_} func (c *Cat) foo(){ // do stuff_} Compile error: method re-declared package maintype X interface{ foo(); bar();}type Cat struct{}func (c Cat) foo(){ // do stuff_}func (c *Cat) bar(){ // do stuff_}func main() { var c Cat var p *Cat var x X x = p // OK; *Cat has explicit method bar() and implicit method foo() x = c //compile error: Cat has explicit method foo() and implicit method bar()} cannot use c (type Cat) as type X in assignment: Cat does not implement X (bar method has pointer receiver)",Why implicit non-pointer methods not satisfy interface?
Go 1.7 Cross Compilation from Windows to Linux/Ubunty," I have GO 1.7 installed on my Windows 10. I created test program and it works perfectly in Windows. Next step is to try to run it on my docker virtual machine with Ubuntu. I found here some info about the way to do it I run line 1 and 2 in cmd and there is no problem. At line 3 I have an error I check manually this folder and there is a runtime only for windowsThe question is where and how can I download it for linux? Or maybe thats I'm doing is completely wrong way...UPDATE 09/02/2017I ran like it was suggested After I copied this file to shared folder, copied form there to another not shared folder (to avoid an issue described here) and executed After I downloaded file package checked my file It seems that during build not linux executable was created. <code>  set GOARCH=amd64set GOOS=linuxgo tool dist install -v pkg/runtimego install -v -a std go tool dist: open C:\Go\src\pkg\runtime: The system cannot find the path specified. set GOARCH=amd64set GOOS=linuxgo build -o ""myapp"" root@7dd1655ae5db:/__notshared# ./myappbash: ./myapp: cannot execute binary file: Exec format error root@7dd1655ae5db:/__notshared# file myappmyapp: PE32+ executable (console) x86-64 (stripped to external PDB), for MS Windows",Go 1.7 Cross Compilation from Windows to Linux/Ubuntu
Why does 0.1 + 0.2 get 0.3 in google go?," As long as floating point is used, 0.1 can not be represented exactly in memory, so we know that this value usually comes out to 0.10000000000000004.But when using go to add 0.1 and 0.2.I'm getting 0.3. Why is 0.3 coming out instead of 0.30000000000000004 ? <code>  fmt.Println(0.1 + 0.2)// Output : 0.3",Why does 0.1 + 0.2 get 0.3 in Google Go?
How to uninstall Golang?," I tried the answer here Removed golang but go command still works?, but it didn't work (I can still run go)Currently, when I run which go I see this output I think I had two installations of go as my GOPATH was pointing to another folder named gocode. I've now removed that folder, and the usr/local/go/bin/go folder.I've also removed my GOPATH. However, I can still run go.How do I uninstall go? <code>  /usr/local/go/bin/go",How to uninstall Go?
Using custom url for httptest.NewServer Go lang," I am running UT on some rest calls by creating a http test server in the Go language. My code is as follows. In the file being tested, This init is called from my test.This creates a new test server and runs the calls on a random port. Is it possible for me to run this server on a port I specify? <code>  type student struct{FirstName stringLastName string}func testGetStudentName() { testServer := httptest.NewServer(http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) { response = new(student) response.FirstName = ""Some"" response.LastName = ""Name"" b, err := json.Marshal(response) if err == nil { fmt.Fprintln(w, string(b[:])) } })) defer ts.Close() student1 := base.getStudent(""123"") log.Print(""testServerUrl"",testServer.URL) //prints out http://127.0.0.1:49931 ( port changes every time this is run) ts.URL = ""http://127.0.0.1:8099"" //this assignment does not quite change the URL of the created test server.} var baseURL = ""http://originalUrl.com""var mockUrl = ""http://127.0.0.1:49855""func Init(mockServer bool){ if mockServer { baseURL = mockUrl }}func getStudent(id String){ url := baseUrl + ""/student/"" + id req, err := http.NewRequest(""GET"", url, nil)}",Using custom URL for httptest.NewServer in Go
how does go plugin dependencies work?," Go 1.8 supports Go plugins.I have created two plugins as follows.As I understand, the plugin exposes only the functions and variables in the main package. i.e. plugin.Lookup() will fail for non-main variable/function.But I wanted to test if a plugin can internally invoke a method from another plugin, similar to how a C++ library can invoke another library.So I tested as follows:plugin1 github.com/vimal/testplugin plugin2 github.com/vimal/testplugin1 Idea here is that plugin1 invokes an internal, non-main function of plugin2.main programMain program loads a number of plugins given as arguments, and invokes TestPlugin() from the last plugin.test 1:Build both plugins, and load both plugins, and invoke TestPlugin(), the output contains ""help234"", i.e. the inner function is invoked. This can be understood, since both plugins are loaded, one plugin can invoke another plugin's inner code.test 2:Load only plugin1, and invoke TestPlugin(), the output contains ""help234"", i.e. the inner function is invoked. The same output is observed as in test1. Perhaps this time the method is found from GOPATH.test 3:Rename the folder ""github.com/vimal/testplugin1"" to ""github.com/vimal/junk1"", delete the plugin2, and load only plugin1, and invoke TestPlugin(). the output still contains ""help234"", i.e. the inner function is invoked. I am not able to understand how test3 produces the same output. Does plugin1 contain plugin2 code also? How can I understand the Go plugin dependency on other Go plugins?Go version : go version go1.8rc3 linux/amd64 <code>  $ cat myplugin.gopackage mainimport ""C""import ""fmt""import help ""github.com/vimal/testplugin1/plug""func init() { fmt.Printf(""main.init invoked\n"")}// TestPlugin func TestPlugin() string { return help.Help()} $ cat myplugin.gopackage mainimport ""C""func HelperFunc() string { return ""help""}$ cat plug/helper.gopackage helpfunc Help() string { return ""help234""}",How do Go plugin dependencies work?
Test setup and teardown for each test in go," I am using go ""testing"" package. Running my tests like below. This will run a setup before any test is run, and a teardown after all tests are complete. And I do need this, as the setup sets the DB up. But also, I need, and yet to find out a way to run a per-test setup/teardown. For the unit tests I am running, I would like to clear the DB before every test, so that there are no issues with the content of the DB causing unexpected behavior. <code>  func TestMain(m *testing.M) { ... // Setup os.Exit(m.Run()) // Teardown}",setup and teardown for each test using std testing package
"Golang: package ""main"" and func ""main"""," The intro/sample go progs I've seen and experimented with start with and have Is there any relationship between the ""main"" in the package line and the ""main"" in the func line? I'm guessing not. C/C++ uses the same ""main"" entry point. Just want to make sure though. I haven't seen any docs that say the use of ""main"" is just a coincidence. <code>  package main func main()","Package ""main"" and func ""main"""
how to hide command prompt window when using Exec in Golang?," say i have the following code, using syscall to hide command line window but when i compiled it and tried to run it in Windows, command line window showed up againwhat can i do to prevent command line window from appearing?PS i already know how to compile golang source into a Windows GUI executable using go build -ldflags -H=windowsgui, but doing so only ensures the program itself doesn't bring up a command line window, Exec will show those windows anyway <code>  process := exec.Command(name, args...)process.SysProcAttr = &syscall.SysProcAttr{HideWindow: true}err := process.Start()if err != nil { log.Print(err)}",How to hide command prompt window when using Exec in Golang?
Check golang format for Continous integration," I am trying to write a Makefile command that will output an error if the Go code is not correctly formatted. This is for a CI step. I am struggling with how to get it working in the make file. This solution works on the bash command line: But copying this into the Makefile: I get the following error: <code>  ! gofmt -l . 2>&1 | read ci-format: @echo ""$(OK_COLOR)==> Checking formatting$(NO_COLOR)"" @go fmt ./... @! gofmt -l . 2>&1 | read /bin/sh: 1: read: arg count",Check format for Continous integration
Is returning a slice of a local array in a Go function safe ?, What happens if I return a slice of an array that is a local variable of a function or method? Does Go copy the array data into a slice create with make()? Will the capacity match the slice size or the array size? <code>  func foo() []uint64 { var tmp [100]uint64 end := 0 ... for ... { ... tmp[end] = uint64(...) end++ ... } ... return tmp[:end]} ,Is returning a slice of a local array in a Go function safe?
(cgo) How to pass pointer to slice to C function," Background: using cgo to call C functions from Golang.I want to use a C function which has this signature: int f(int *count, char ***strs).It will modify the data of count and strs, which is the reason why it uses pointer to them.The value of count is the length of strs; strs is an array of string; the return value is simply an (boolean) indicator which states whether there is an error or not.In golang, I can successfully pass and modify count by using C.f((*C.int)(&count)); pass []string by using []*C.char. Sample code is like this: As you can see, the C function is currently int f(int *c, char **str), but what I'd like is int f(int *c, char ***str).This is to say: what I actually want is to enable the modification to the string array (e.g. resize) in C and turn it back to a Go string slice so I can still use it in Go.How to do this? I've searched and experimented for a while but with no luck. <code>  /*#include <stdio.h>int f(int *c, char **str) { int i; printf(""%d\n"", *c); for (i = 0; i < *c; i++) { printf(""%s\n"", str[i]); } *c = (*c) + 1; return 1;}*/import ""C""func go_f(strs []string) int { count := len(strs) c_count := C.int(count) c_strs := make([]*C.char, count) for index, value := range strs { c_strs[index] = C.CString(value) defer C.free(unsafe.Pointer(c_strs[index])) } err := C.f(&c_argc, (**C.char)(&c_argv[0])) return int(err)}",How to pass pointer to slice to C function in go
How to pass pointer to slice to C function," Background: using cgo to call C functions from Golang.I want to use a C function which has this signature: int f(int *count, char ***strs).It will modify the data of count and strs, which is the reason why it uses pointer to them.The value of count is the length of strs; strs is an array of string; the return value is simply an (boolean) indicator which states whether there is an error or not.In golang, I can successfully pass and modify count by using C.f((*C.int)(&count)); pass []string by using []*C.char. Sample code is like this: As you can see, the C function is currently int f(int *c, char **str), but what I'd like is int f(int *c, char ***str).This is to say: what I actually want is to enable the modification to the string array (e.g. resize) in C and turn it back to a Go string slice so I can still use it in Go.How to do this? I've searched and experimented for a while but with no luck. <code>  /*#include <stdio.h>int f(int *c, char **str) { int i; printf(""%d\n"", *c); for (i = 0; i < *c; i++) { printf(""%s\n"", str[i]); } *c = (*c) + 1; return 1;}*/import ""C""func go_f(strs []string) int { count := len(strs) c_count := C.int(count) c_strs := make([]*C.char, count) for index, value := range strs { c_strs[index] = C.CString(value) defer C.free(unsafe.Pointer(c_strs[index])) } err := C.f(&c_argc, (**C.char)(&c_argv[0])) return int(err)}",How to pass pointer to slice to C function in go
"Mongodb in Go(golang) with mgo, operators with bson.M / bson.D always got syntax error"," It is kind of stupid syntax error, tried tons of ways, just couldn't get it work, someone please help.MongoDB in Go with mgo, I just tried to simplify use the $ne operator, code like below, but kept getting compile syntax error: Tried to add comma , remove comma everywhere, just couldn't get it work, always got such compile syntax error like below: <code>  line 15: convIter := Session.Copy().DB("""").C(""convs"").Find(bson.M {line 16: ""conversationStatus"": interface{} {line 17: bson.M {line 18: ""$ne"": ""DESTROYED""line 19: },line 20: },line 21: }).Iter() mongodb/query.go:16: syntax error: unexpected {, expecting comma or }mongodb/query.go:20: syntax error: unexpected }, expecting expressionmongodb/query.go:21: syntax error: unexpected }, expecting expression","MongoDB in Go with mgo, operators with bson.M / bson.D always got syntax error"
Golang - Signing certificate request with certificate authority," I want to use TLS mutual authentication to authenticate a client on a API made in go. I've created a certificate authority, and let's say Bob has a key pair he wants to use with the client. Bob created a certificate request and want me to validate his certificate in order to be authorized and authenticated on the API.I've used this to create my Certificate Authority : Bob used this to create his certificate and certificate request : I want to achive this, but in go : For now, with theses commands, Bob can create a TLS connection to my API which use this tls.Config : But what if Julia now want to login ? She will have to create a CSR, send it to me and I would have to manually validate her CSR to a CRT too. To avoid this manual operation, the idea is to have a register endpoint where Julia can submit her CSR and get back a valid CRT. The endpoint will basically look like this : I spend some time to understand how openssl use the CA to create the CRT from the CRS, without success.Golang has a CertificateRequest object from the crypto/x509 package that I can create with the ParseCertificateRequest but I can't find the function that take this object and my CA and return a certificate.Thank you for your help! <code>  openssl genrsa -aes256 -out ca.key 4096openssl req -new -x509 -sha256 -days 730 -key ca.key -out ca.crt openssl genrsa -out bob.key 4096openssl req -new -key bob.key -out bob.csr openssl x509 -req -days 365 -sha256 -in bob.csr -CA ca.crt -CAkey ca.key -set_serial 3 -out bob.crt func createTLSConfig(certFile string, keyFile string, clientCAFilepath string) (config *tls.Config, err error) { cer, err := tls.LoadX509KeyPair(certFile, keyFile) if err != nil { return nil, err } clientCAFile, err := ioutil.ReadFile(clientCAFilepath) if err != nil { return nil, err } clientCAPool := x509.NewCertPool() clientCAPool.AppendCertsFromPEM(clientCAFile) config = &tls.Config{ Certificates: []tls.Certificate{cer}, ClientAuth: tls.RequireAndVerifyClientCert, ClientCAs: clientCAPool, CipherSuites: []uint16{ tls.TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384, tls.TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384, }, PreferServerCipherSuites: true, SessionTicketsDisabled: false, MinVersion: tls.VersionTLS12, CurvePreferences: []tls.CurveID{tls.CurveP521, tls.CurveP384}, } return config, nil} func Register(c echo.Context) (err error) { // get Julia's csr from POST body csr := certificateFromBody(c.Body) // valid csr with ca to generate the crt crt := signCSR(csr, config.ClientCAPath) // return the crt to julia return c.JSON(http.StatusCreated, base64.StdEncoding.EncodeToString(crt))}",Signing certificate request with certificate authority
Difference in json.Unmarshal when using bytes.Buffer vs using *bytes.NewBuffer," I was looking at the bytes package. If I define a buffer using bytes.Buffer then the code below works and i get an output. However if I try create a buffer with a certain capacity and then try the same code it fails with the error error: invalid character '\x00' looking for beginning of value. Not sure how to fix it. Output for Run with bytes.Buffer Output for Run with bytes.NewBuffer <code>  package mainimport ( ""bytes"" ""encoding/json"" ""fmt"")func main() { var jsonBlob = []byte(`[ {""Name"": ""Platypus"", ""Order"": ""Monotremata""}, {""Name"": ""Quoll"", ""Order"": ""Dasyuromorphia""} ]`) //var b bytes.Buffer b := *bytes.NewBuffer(make([]byte, 20)) b.Write(jsonBlob) fmt.Println(b.String()) var dat interface{} err := json.Unmarshal(b.Bytes(), &dat) if err != nil { fmt.Println(""error:"", err) } fmt.Printf(""%+v"", dat)} [ {""Name"": ""Platypus"", ""Order"": ""Monotremata""}, {""Name"": ""Quoll"", ""Order"": ""Dasyuromorphia""} ][map[Name:Platypus Order:Monotremata] map[Name:Quoll Order:Dasyuromorphia]]Program exited. [ {""Name"": ""Platypus"", ""Order"": ""Monotremata""}, {""Name"": ""Quoll"", ""Order"": ""Dasyuromorphia""} ]error: invalid character '\x00' looking for beginning of value<nil>",Difference in json.Unmarshal when using bytes.Buffer vs using *bytes.NewBuffer
Reading XML from http.Get in Golang," I'm having a tough time reading XML from a GET request in Go. I just started to learn Go and haven't found any resources on this topic. What I tried: _, err := io.Copy(os.Stdout, response.Body) works but I'd like to store the XML for further processing.Any help is greatly appreciated. <code>  response, err := http.Get(url)if err != nil { log.Fatal(err)} else { defer response.Body.Close() xml, _ := ioutil.ReadAll(response.Body) if err != nil { log.Fatal(err) }}",Reading content from http.Get in Golang
Golang: Counting the occurrence of one or more substrings in a string in Go?," I know that for counting the occurrence of one substring I can use ""strings.Count(, )"". What if I want to count the number of occurrences of substring1 OR substring2? Is there a more elegant way than writing another new line with strings.count()? <code> ",Counting the occurrence of one or more substrings in a string
slice shift function in go lang," how array shift function works with slices? I found an example from slice tricks but can't get it right.https://github.com/golang/go/wiki/SliceTricks Edit can you please explain why x is undefined here?Building upon the answer and merging with SliceTricks <code>  package mainimport ""fmt""func main() { s := []int{2, 3, 5, 7, 11, 13} for k, v := range s { x, a := s[0], s[1:] // get and remove the 0 index element from slice fmt.Println(a) // print 0 index element }} x, a := a[0], a[1:] import ""fmt""func main() { s := []int{2, 3, 5, 7, 11, 13} fmt.Println(len(s), s) for len(s) > 0 { x, s = s[0], s[1:] // undefined: x fmt.Println(x) // undefined: x } fmt.Println(len(s), s)}",slice shift like function in go lang
Getter and Setter conventions in go lang," Case A Not following the Getter & Setter conventionhuman/human.go main/main.go Case B Following getter and setter convention main/main.go The problem with following convention is that I can't instantiate the struct while providing its field names. I'd like to use the convention but I am stuck with the private access. <code>  package humantype Human interface { GetName() string SetName(name string)}type Person struct { Name string}func (p Person) GetName() string { return p.Name}func (p *Person) SetName(name string) { p.Name = name} package mainfunc main() { john := Person{Name:""john""} // Uppercase Fields are visible fmt.Println(john)} package humantype Human interface { Name() string SetName(name string)}type Person struct { name string}func (p Person) Name() string { return p.name}func (p *Person) SetName(name string) { p.name = name} package mainfunc main() { john := Person(name: ""John"") // lowercase name is not visible outside the package}",Getter and Setter conventions in Go
Structuring local imports without github in golang," I'm building a simple app and after reading the doc on structuring go applications, I'm still confused.I want this structure:practicemodels (packaged as models)abrouters (packaged as routers)abapp.goInside of app.go, I have the following: The A and B models look like this: Two questions:What in the world is the right way to import these files? Do I really have to push them to github in order to be able to reference them? I understand the $GOPATH is the namespace for the entire go workspace on a local machine. My $GOPATH is set to include this directory.Do I need to define a main method inside of these files? Can I just export a single function and have that be the handling function?I have consulted the docs <code>  package mainimport ( ""net/http"" // I have tried the following: ""practice/models/a"" ""practice/models/b"" ""practice/models"" ""$GOPATH/practice/models/a"" ""$GOPATH/practice/models/b"" ""$GOPATH/practice/models"" ...)func main() { http.HandleFunc(""/a"", AHandler) http.HandleFunc(""/b"", BHandler) http.ListenAndServe("":8080"", nil)} package modelsimport ""net/http""func AHandler(w http.ResponseWriter, r *http.Request) { // code}",Structuring local imports without GitHub in Golang
What's the point in wrapping a function in a function type in golang?," I am new to golang and I've seen occasionally some code that wraps a function inside a function type. In http package we have this as well: I'm curious to know the reason behind. If we want to have a type that exposes a method why don't we create a struct type and add the method to it?  <code>  type HandlerFunc func(ResponseWriter, *Request)func (f HandlerFunc) ServeHTTP(w ResponseWriter, r *Request) { f(w, r)}",What's the point in wrapping a function in a function type?
Go: How to remove unused code at compile time?," We've built a Go package that is used by many of us.It's imported using the standard import (""package-name"") method.At compile time though, all of our utilities, including the very small ones, end up as very large binaries.We've extracted all the strings in the utilities and discovered that the entire package is being compiled into each and every utility. Including functions that are not being used by those utilities.EDIT 1:Thank you to the people who are responding to this question.Here's what we are seeing:main.go play/subplay.go Function B() is never called. Yet, after building the binary, we find the string ""secret string"" into main.exe.How can we remove unused code from Go programs at compile time? <code>  package mainimport ""play/subplay""func main() { subplay.A()} package subplayfunc A() { fmt.Printf(""this is function A()"")}func B() { fmt.Printf(""secret string"")}",How to remove unused code at compile time?
Difference between golang.org packages and built-in packages," I've been using go for a short time now, and I've been noticing that there are duplicate packages between Go (standard library) and golang.org/x/.My questions are: Why are they released twice? And of the two, which one should I use (more up-to-date, canonical, etc)?Some sample packages that are released twice that I've noticed so far:golang.org/x/net/html vs net/htmlgolang.org/x/crypto vs cryptoand maybe more that I can't remember right now... <code> ",Difference between golang.org packages and the standard library
How can I combine Go middleware pattern with error returning request handles?," I am familiar with the Go middleware pattern like this: So for example if I had a loggingHandler: And a simple handleFunc: I could combine them like this: That is all fine.But I like the idea of Handlers being able to return errors like normal functions do. This makes error handling much easier as I can just return an error if there is an error, or just return nil at the end of the function.I have done it like this: And then use it by wrapping it like this: I can make these two patterns work separately, but I don't know how I could combine them. I like that I am able to chain middlewares with a library like Alice. But it would be nice if they could return errors too. Is there a way for me to achieve this? <code>  // Pattern for writing HTTP middleware.func middlewareHandler(next http.Handler) http.Handler { return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) { // Our middleware logic goes here before executing application handler. next.ServeHTTP(w, r) // Our middleware logic goes here after executing application handler. })} func loggingHandler(next http.Handler) http.Handler { return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) { // Before executing the handler. start := time.Now() log.Printf(""Strated %s %s"", r.Method, r.URL.Path) next.ServeHTTP(w, r) // After executing the handler. log.Printf(""Completed %s in %v"", r.URL.Path, time.Since(start)) })} func handleFunc(w http.ResponseWriter, r *http.Request) { w.Write([]byte(`Hello World!`))} http.Handle(""/"", loggingHandler(http.HandlerFunc(handleFunc)))log.Fatal(http.ListenAndServe("":8080"", nil)) type errorHandler func(http.ResponseWriter, *http.Request) errorfunc (f errorHandler) ServeHTTP(w http.ResponseWriter, r *http.Request) { err := f(w, r) if err != nil { // log.Println(err) fmt.Println(err) os.Exit(1) }}func errorHandle(w http.ResponseWriter, r *http.Request) error { w.Write([]byte(`Hello World from errorHandle!`)) return nil} http.Handle(""/"", errorHandler(errorHandle))",How can I combine Go middleware pattern with error returning request handlers?
Golang: Get equivalent time in another timezone," I'm trying to compare two times from different timezones, and see whether one is before the other. How would I do this in Go?Note: Basically I would like sfTime.Before(nyTime) == true, but my example below would have sfTime.Before(nyTime) == false. Suggestions on how to make this happen would be great.For example, in this code... This prints:Are these times equal? truePlayground link here.Unintuitively, even if you set them to be the same timezone, this only changes the timezone, but not the HH:mm value. PrintsAre these times still equal? trueThe New York Time: 2017-03-01 12:00:00 +0000 UTCPlayground link. <code>  layout := ""2006-01-02 15:04 MST""sfTime, _ := time.Parse(layout, ""2017-03-01 12:00 PDT"")nyTime, _ := time.Parse(layout, ""2017-03-01 12:00 EDT"")fmt.Printf(""Are these times equal? %v\n"", sfTime.Equal(nyTime)) layout := ""2006-01-02 15:04 MST""sfTime, _ := time.Parse(layout, ""2017-03-01 12:00 PDT"")nyTime, _ := time.Parse(layout, ""2017-03-01 12:00 EDT"")// Set timezone to UTCutcLocation, _ := time.LoadLocation(""UTC"")sfTime = sfTime.In(utcLocation)nyTime = nyTime.In(utcLocation)// Timezones should not be equal, but they arefmt.Printf(""Are these times still equal? %v\n"", sfTime.Equal(nyTime))fmt.Printf(""The New York Time: %v\n"", nyTime)",How to get equivalent time in another timezone
Iterate go map get index, In order to use revel's even keyword in templates I would like to get the index of a map entry when iterating with range. Is there any way to do so? My map has the structure: <code>  map[string][]string,Iterate Go map get index
How to create and export svg to png/jpeg in golang," I have following code snippet for e.g. I want to export svg created by this code to jpeg or png or svg let's say. How to do that I am not getting idea. I can use imagemagick or something but for that I need SVG thing. please someone help me with this. <code>  package mainimport ( ""github.com/ajstarks/svgo"" ""os"" _ ""image"" _ ""fmt"")func main(){ width := 512 height := 512 canvas := svg.New(os.Stdout) canvas.Start(width,height) canvas.Image(0,0,512,512,""src.jpg"",""0.50"") canvas.End()}",How to create and export svg to png/jpeg
Golang GCloud SDK - gcloud app deploy cannot find import package," according to the official documentation for Google App Engine Standard environment (Go API) the ""preferred tooling to deploy a project"" is now the Cloud SDK and so we moved to gcloud from goapp.We are unable to deploy Go projects to GAE because all the sub-packages of every given project can't be found at ""deploy time"".The typical folder structure that we have been using for every GAE project was as follows: When global libraries were put in the system GOPATH everything worked smoothly.Running gcloud app deploy we now get this: while dev_appserver.py works perfectly keeping the same folder structure.Did we miss something? How can we deploy to Google App Engine Standard environment using gcloud?If the project structure needs to be changed: how? Is there official documentation about it?Thanks in advance,Edit -- Further infos: <code>  -project-name--app.yaml--main.go--assets---package1---package2 You are about to deploy the following services: - yourproject/default/123456789 (from [/Path/to/app.yaml]) Deploying to URL: [https://yourproject.appspot.com]Do you want to continue (Y/n)? YBeginning deployment of service [default]...ERROR: (gcloud.app.deploy) Staging command [/path/to/yourproject/app.yaml /var/folders/b6/5ydn0wdn64jd32sxzzz48b7c0000gn/T/tmpbd4oiG] failed with return code [1].------------------------------------ STDOUT ------------------------------------------------------------------------ STDERR ------------------------------------2017/03/24 10:25:58 failed analyzing /path/to/yourproject: cannot find package ""yourpackage"" in any of: ($GOROOT not set) /path/to/gopath/src/yourpackage (from $GOPATH)GOPATH: /path/to/gopath-------------------------------------------------------------------------------- Luigi-Mac-Pro:path/to/yourproject distudio$ gcloud versionGoogle Cloud SDK 148.0.0app-engine-go app-engine-go-darwin-x86_64 1.9.50app-engine-python 1.9.50bq 2.0.24bq-nix 2.0.24core 2017.03.17core-nix 2016.11.07gcloud gcloud-deps 2017.03.17gcloud-deps-darwin-x86_64 2017.02.21gsutil 4.23gsutil-nix 4.22",Golang Cloud SDK - gcloud app deploy cannot find import package
Go lang access denied," I'm new to the GO programming language, what I'm trying to do is to put some items into the map and then remove one of them, when I'm trying to remove one of the items from array I'm getting the error message: the code: <code>  C:/Go\bin\go.exe run C:/Users/Computer/IdeaProjects/untitled1/simple.gofork/exec C:\Users\Computer\AppData\Local\Temp\go-build143466426\command-line-arguments\_obj\exe\simple.exe: Access is denied. package mainimport ""fmt"" func main(){ presAge := make(map[string] int) presAge[""test""] = 42 presAge[""boom""] = 421 delete(presAge,""boom"") fmt.Println(len(presAge)) }","Try ""go run"" a code then get ""Access is denied"" in Windows"
Golang read request body," I am writing my own logginMiddleware. Basically, I need to log body of the request and the response. The problem that I faced is that when I read body, it becomes empty and I cannot read it twice. I understand that it happens because it is of type ReadCloser. Is there a way to rewind body to the beginning?  <code> ",Golang read request body multiple times
Golang QueryRow().Scan() returns error if row doesn't exist," I want to fetch one row from an sql database. I use the following code: For example: if a user with id=2 doesn't exist, then the method Scan returns an error. Question:Is there a way to avoid this error when a row doesn't exist? Because it's absolutely normal and I don't want to log such errors.The only way I found is to use Query instead of QueryRow, but it is not convenient because I have to add for rows.Next() { .. every time when I want to fetch single row. <code>  var name stringrow := db.Con().QueryRow(""SELECT name FROM users WHERE id = 2;"")err := row.Scan(&name)if err != nil { // log the error}",QueryRow().Scan() returns error if row doesn't exist
Debugger of golang tests in visual studio code," On my Windows machine, I have Visual Studio Code installed. To run tests manually, I go in console to projects folder and enter It works perfectly.But I have a situation in which I need to debug my test to understand what's going on.For this I open launch.json and add a configuration After I press F5 I have Any ideas why this error occurs and what executable it's looking for?  <code>  go test main_test.go { ""name"": ""Tests"", ""type"": ""go"", ""request"": ""launch"", ""mode"": ""test"", ""remotePath"": """", ""port"": 2346, ""host"": ""127.0.0.1"", ""program"": ""${workspaceRoot}"", ""env"": {}, ""args"": [ ""main_test.go"" ], ""showLog"": true } 2017/03/29 13:28:11 server.go:73: Using API v12017/03/29 13:28:11 debugger.go:68: launching process with args: [./debug.test main_test.go main_go]not an executable fileProcess exiting with code: 1",Debugging Go tests in Visual Studio Code
How to run a shell command in a specific folder with Golang?," I can use this out, err := exec.Command(""git"", ""log"").Output() to get an output of the command which will run in the same path as the executable location.How do I specify in which folder I want to run the command? <code> ",How to run a shell command in a specific folder
Atom Editor 1.15.0 with Go-Plus has red background in function source code., I have updated Atom to latest (1.15.0) and updated all plugin.I have go-plus and go-debug plugins.I get randomly red background for large number of methods in Go files. If I save file it disappears for few seconds.I thought it is some warning but I do not see warning in go-plus.Any ideas.. What does red bg means and how to disable it? <code> ,Atom Editor 1.15.0 with Go-Plus has red background in function source code
Golang -- how to create an os.exec Command struct from a string with spaces," I want my method to receive a command to exec as a string. If the input string has spaces, how do I split it into cmd, args for os.exec?The documentation says to create my Exec.Cmd struct like This works fine: This fails: I tried strings.Split(a), but receive an error message: cannot use (type []string) as type string in argument to exec.Command <code>  cmd := exec.Command(""tr"", ""a-z"", ""A-Z"") a := string(""ifconfig"")cmd := exec.Command(a)output, err := cmd.CombinedOutput()fmt.Println(output) // prints ifconfig output a := string(""ifconfig -a"")cmd := exec.Command(a)output, err := cmd.CombinedOutput()fmt.Println(output) // 'ifconfig -a' not found",How to create an os.exec Command struct from a string with spaces
Golang - check if IPv4 address belongs to a network, Given:a network address A: (172.17.0.0/16)and an IP address from a host B: (172.17.0.2/16)how can we say if B is in A?All addresses are string variables in the following form: [IP address in dot-decimal notation]/[subnet mask]. Should I try to do it by manipulating strings (initial thoughts). Is there a different path?Here is the same question for Python:How can I check if an ip is in a network in pythonand another approach with Go:Go/GoLang check IP address in range <code> ,Go - check if IP address is in a network
Golang - check if IP address belongs to a network, Given:a network address A: (172.17.0.0/16)and an IP address from a host B: (172.17.0.2/16)how can we say if B is in A?All addresses are string variables in the following form: [IP address in dot-decimal notation]/[subnet mask]. Should I try to do it by manipulating strings (initial thoughts). Is there a different path?Here is the same question for Python:How can I check if an ip is in a network in pythonand another approach with Go:Go/GoLang check IP address in range <code> ,Go - check if IP address is in a network
Golang - check if IP address is in a network, Given:a network address A: (172.17.0.0/16)and an IP address from a host B: (172.17.0.2/16)how can we say if B is in A?All addresses are string variables in the following form: [IP address in dot-decimal notation]/[subnet mask]. Should I try to do it by manipulating strings (initial thoughts). Is there a different path?Here is the same question for Python:How can I check if an ip is in a network in pythonand another approach with Go:Go/GoLang check IP address in range <code> ,Go - check if IP address is in a network
Golang: Sorting by Slice Fields," I have the following Structs: I have made a slice of Parents with the following values: I am trying to sort the ""parents"" slice in the following order: The expected result is something like: Is there a way to do this in Go? <code>  type Parent struct { id string children []Child}type Child struct { id string} parents := make([]Parent, 0)p1 := Parent { ""3"", []Child { {""2""}, {""3""}, {""1""}, },}p2 := Parent { ""1"", []Child { {""8""}, {""9""}, {""7""}, },}p3 := Parent { ""2"", []Child { {""5""}, {""6""}, {""4""}, },} parents = append(parents, p1, p2, p3) 1) First, sort all Parents by Parent.id2) Next, sort each Parent's ""children"" slice by Child.id [{1 [{7} {8} {9}]} {2 [{4} {5} {6}]} {3 [{1} {2} {3}]}]",Sorting by slice fields
Contant struct in Go," Why can't I create constant struct? .\rss_test.go:32: const initializer quzx.RssFeed literal is not a constant <code>  const FEED_TO_INSERT = quzx.RssFeed{ 0, """", ""desc"", ""www.some-site.com"", ""upd_url"", ""img_title"", ""img_url"", 0, 0, 0, 0, 0, 100, ""alt_name"", 1, 1, 1, ""test"", 100, 100, 0 }",Constant struct in Go
Golang pass data between templates," I have simple case, where a templates (text/templates) includes another like this Now I want to reuse the image row template. Let's say I would like to pass a simple number, so that the image_row template builds up rows according to this numberI'd like to have something like that (where 5 is the additional argument)index.html How could I achieve that in this case? <code>  `index.html`{{ template ""image_row"" . }}`image_row.html`{{ define ""image_row"" }} To stuff here{{ end }} {{ template ""image_row"" . | 5 }}",Pass data between templates
Go: How to write test with httprouter," I am writing tests for a simple REST service in GoLang. But, because I am using julienschmidt/httprouter as the routing library. I am struggling on how to write test.main.go controllers My question is: How can test this while GetBook is neither HttpHandler nor HttpHandleIf I use a traditional handler, the test will be easy like this The problem is, httprouter is not handler, or handlefunc. So I am stuck now <code>  package mainfunc main() { router := httprouter.New() bookController := controllers.NewBookController() router.GET(""/book/:id"", bookController.GetBook) http.ListenAndServe("":8080"", router)} package controllerstype BookController struct {}func NewBookController *BookController { return &BookController()}func (bc BookController) GetBook(w http.ResponseWriter, r *http.Request, p httprouter.Params) { fmt.Fprintf(w,""%s"", p)} func TestGetBook(t *testing.T) { req, _ := http.NewRequest(""GET"", ""/book/sampleid"", nil) rr := httptest.NewRecorder() handler := controllers.NewBookController().GetBook handler.ServeHTTP(rr,req) if status := rr.code; status != http.StatusOK { t.Errorf(""Wrong status"") }}",How to write test with httprouter
How to run go test on all test files test files in my project except for vendor packages," My project folder contains: I'd like to run go test on all test files, e.g. foobar_test.go files except for the test files in the vendor package. The closest I've come to success was with go test ./... but that included vendor test files.I saw in the documentation you can pass a regex to -run option but I'm having trouble getting this working. For example I tried go test ./*, but I get a bunch of can't load package errors.What's the best way to do this? <code>  Makefile README.md component/ driver/ service/ vendor/ worker/",How to run go test on all test files in my project except for vendor packages
How do i update golang from command prompt?," I have 1.7 version of golang and I want to update golang to 1.8 from command prompt. Uninstalling and Installing it again is always an option, but can I update it using commands on Windows 8.1? <code> ",How do I update golang from command prompt on Windows?
How do I update golang from command prompt?," I have 1.7 version of golang and I want to update golang to 1.8 from command prompt. Uninstalling and Installing it again is always an option, but can I update it using commands on Windows 8.1? <code> ",How do I update golang from command prompt on Windows?
How to save data streams ins S3? aws-sdk-go example not working?," I am trying to persist a given stream of data to an S3 compatible storage.The size is not known before the stream ends and can vary from 5MB to ~500GB.I tried different possibilities but did not find a better solution than to implement sharding myself. My best guess is to make a buffer of a fixed size fill it with my stream and write it to the S3.Is there a better solution? Maybe a way where this is transparent to me, without writing the whole stream to memory?The aws-sdk-go readme has an example programm that takes data from stdin and writes it to S3: https://github.com/aws/aws-sdk-go#using-the-go-sdkWhen I try to pipe data in with a pipe | I get the following error:failed to upload object, SerializationError: failed to compute request body sizecaused by: seek /dev/stdin: illegal seekAm I doing something wrong or is the example not working as I expect it to?I although tried minio-go, with PutObject() or client.PutObjectStreaming().This is functional but consumes as much memory as the data to store.Is there a better solution?Is there a small example program that can pipe arbitrary data into S3? <code> ",How to save data streams in S3? aws-sdk-go example not working?
How do I serve CSS and JS in Go Lang," I followed the Go Writing Web Applications tutorial but for whatever reason I am having trouble getting the app to serve CSS and JS. If I run my static page without the Go server the page CSS works fine. When I run the Go server on the other hand the CSS just doesn't work.Here is what my HTML sort of looks like: then under the body tag: My file tree looks like this: How do I get my Go application to serve the CSS and JavaScript I need?EDIT:The problem has since been solved, here is the working main: Here is an example of the handlers I am using: <code>  <link rel=""stylesheet"" href=""../assets/css/bootstrap.min.css""><link rel=""stylesheet"" href=""../assets/css/bootstrap-theme.min.css""><link rel=""stylesheet"" href=""../assets/css/custom.css""> <script src=""../assets/js/jquery.min.js""></script><script src=""../assets/js/bootstrap.min.js""></script> go-affect/ data static css js tmpl edit.html index.html view.html main.go func main() { http.HandleFunc(""/view/"", makeHandler(viewHandler)) http.HandleFunc(""/edit/"", makeHandler(editHandler)) http.HandleFunc(""/save/"", makeHandler(saveHandler)) http.HandleFunc(""/index/"", makeHandler(indexHandler)) http.Handle(""/static/"", http.StripPrefix(""/static/"", http.FileServer(http.Dir(""static"")))) http.ListenAndServe("":8080"", nil)} func indexHandler(w http.ResponseWriter, r *http.Request, title string) { p := &Page{Title: title} err := templates.ExecuteTemplate(w, ""index.html"", p) if err != nil { http.Error(w, err.Error(), http.StatusInternalServerError) }}",How do I serve CSS and JS in Go
Golang - closed channel vs nil channel?," I am working with Go channels, and I was wondering what's the difference between closing a channel and setting it to nil?Edit:In this example, I would like to disconnect the sender and receiver by, whether closing the channel or setting to nil. What's the best practice to do this? <code> ",Closed channel vs nil channel
How to keep my Go Server working, I want to keep my Golang language web server working regardless of an error happens or not.How to keep running it always? <code> ,Keep running Go Server as background process
Running Go Server as background process, I want to keep my Golang language web server working regardless of an error happens or not.How to keep running it always? <code> ,Keep running Go Server as background process
Golang convert float64 to byte array," How can I convert a float64 variable to big endian encoded byte array? For the sake of clarity how should I implement float64ToByte function in the following playground?https://play.golang.org/p/LevxCDd7mK <code>  var f float64 = 12.666512var result []byte = float64ToByte(f);fmt.Printf(""result:%f"",result)",Convert float64 to byte array
In Golang: How to deal with unknown variables or How to deal with multiple databases?," I'm working on a Go RESTful API application with multiple databases. When starting the server, the user supplies which database they would like to use.In the application, I have three functions of which one handles the connection: selectedDb.Get(), selectedDb.Add(), selectedDb.Connect().If somebody selects, Mysql, it handles things for Mysql, if someone selects MongoDB it handles things for Mongo and so on.This is how I try to accomplish this:DbInterface.go MySQL.go Mongo.go main.go Problem statementWhen I return the client for Mysql, it doesn't work for Mongo and visa versa.I want to connect to the database ONLY when starting the server and store the client inside the client variable. The problem, however, is that Mongo returns another client than Mysql does and so forth.What should be in the places where I have HERE_LIES_MY_PROBLEM in the code?Or do I get the Go paradigm wrong for dealing with these things? <code>  package dbinittype Object struct { Uuid string Object string Deleted bool}// The interface that all connectors should havetype Intfc interface { Connect() HERE_LIES_MY_PROBLEM Add(string, string, string) string Get(string) (Object, bool)} package mysqlConnectorimport ( ...)type Mysql struct{}// Connect to mysqlfunc (f Mysql) Connect() HERE_LIES_MY_PROBLEM { client, err = sql.Open(""mysql"", ""yourusername:yourpassword@/yourdatabase"") if err != nil { panic(err.Error()) } return client}// Add item to DBfunc (f Mysql) Add(owner string, refType string, object string) string { // do stuff related to this DB return // a string}func (f Mysql) Get(Uuid string) (dbinit.Object, bool) { // do stuff related to this DB return // an object and a bool} package mongoConnectorimport ( ...)type Mongo struct{}// Connect to mongofunc (f Mongo) Connect() HERE_LIES_MY_PROBLEM { info := &mgo.DialInfo{ Addrs: []string{hosts}, Timeout: 60 * time.Second, Database: database, Username: username, Password: password, } client, err := mgo.DialWithInfo(info) if err != nil { panic(err) } return client}// Add item to DBfunc (f Mongo) Add(owner string, refType string, object string) string { // do stuff related to this DB return // a string}func (f Mongo) Get(Uuid string) (dbinit.Object, bool) { // do stuff related to this DB return // an object and a bool} ...var selectedDb dbinit.IntfccommandLineInput := ""mysql"" // just for the exampleif commandLineInput == ""mysql"" { selectedDb = mysqlConnector.Mysql{}} else if commandLineInput == ""mongo"" { selectedDb = mongoConnector.Mongo{}}client := selectedDb.Connect()// this runs everytime the API is calledapi.HandlerFoobar = foobar.handlerFunction(func(params foobar.Params) middleware.Responder { // Here I want to add something to the selected dbinit selectedDb.Get(client, addStringA, addStringB, addStringC) return // the API response})...",How to deal with unknown variables or How to deal with multiple databases
golang: Get the enum value out from protobuf messages," Here is a protobuf message definition: I would like to populate the name field based on some strings I created. E.g. in golang: How can I populate the ""name"" in the protobuf message? <code>  message People { enum PeopleName { Alice = 100; Bob = 101; Cathy = 102; } optional PeopleName name = 1;} str := ""Cathy""",Get the enum value out from protobuf messages
Unmarshal an JSON in go with different types in an list," I have trouble unmarschaling a JSON contruct: I actually need the second slice item from the result.My current attempt is the output is like: but I also tried to use this: the output is okay: I can also reference the Result[1] index: But I fail to convert the interface type to any other Type which would match. Can anybody tell me how to do interface conversion. And what approach would be the ""best"". <code>  { ""id"": 10, ""result"": [ { ""bundled"": true, ""type"": ""RM-J1100"" }, [ { ""name"": ""PowerOff"", ""value"": ""AAAAAQAAAAEAAAAvAw=="" }, { ""name"": ""Input"", ""value"": ""AAAAAQAAAAEAAAAlAw=="" } ] ]} type Codes struct { Id int32 `json:""id""` Result []interface{} `json:""result""`}type ResultList struct { Info InfoMap Codes []Code}type InfoMap struct { Bundled bool `json:""bundled""` Type string `json:""type""`}type Code struct { Name string `json:""name""` Value string `json:""value""`} {10 {{false } []}} type Codes struct { Id int32 `json:""id""` Result []interface{} `json:""result""`} {10 [map[type:RM-J1100 bundled:true] [map[name:PowerOff value:AAAAAQAAAAEAAAAvAw==] map[name:Input value:AAAAAQAAAAEAAAAlAw==]]]} [map[name:PowerOff value:AAAAAQAAAAEAAAAvAw==] map[name:Input value:AAAAAQAAAAEAAAAlAw==]]",Unmarshal JSON in go with different types in a list
Go Error Handling," I am little confused on how error handling should be done in go. I have read so many posts about it but still am not able to apply them on my structure of code. I am new to go so please help.There is a main function which handles two apis: api1 and api2 In both api1 and api2 , function validateRequestHeader is getting called. If this gets true, then in the api1/api2 further code is getting executed which I do not want. How it should be handled? <code>  func main() { http.HandleFunc(""/offers"", api1) http.HandleFunc(""/getOffersList"", api2) err := http.ListenAndServe("":8080"", nil) if err != nil { log.Fatal(""ListenAndServe: "", err) }}func api1(w http.ResponseWriter, req *http.Request) { validateRequestHeader(w, req, ""GET"") // code here....}func api2(w http.ResponseWriter, req *http.Request) { validateRequestHeader(w, req, ""POST"") //code here....}func validateRequestHeader(w http.ResponseWriter, req *http.Request, allowedMethod string) { // allow cross domain AJAX requests w.Header().Set(""Content-Type"", ""application/json"") if origin := req.Header.Get(""Origin""); origin != """" { w.Header().Set(""Access-Control-Allow-Origin"", origin) w.Header().Set(""Access-Control-Allow-Methods"", ""POST, GET, OPTIONS, PUT, DELETE"") w.Header().Set(""Access-Control-Allow-Headers"", ""Accept, Content-Type, Content-Length, Accept-Encoding, X-CSRF-Token, Authorization"") } // Stop here if its Preflighted OPTIONS request if req.Method == ""OPTIONS"" { return } if req.Method != allowedMethod { response := ""Only "" + allowedMethod + "" requests are allowed"" http.Error(w, response, http.StatusMethodNotAllowed) return }} if req.Method != allowedMethod { response := ""Only "" + allowedMethod + "" requests are allowed"" http.Error(w, response, http.StatusMethodNotAllowed) return }",How to do error http error handling in Go language
Go Http Error Handling," I am little confused on how error handling should be done in go. I have read so many posts about it but still am not able to apply them on my structure of code. I am new to go so please help.There is a main function which handles two apis: api1 and api2 In both api1 and api2 , function validateRequestHeader is getting called. If this gets true, then in the api1/api2 further code is getting executed which I do not want. How it should be handled? <code>  func main() { http.HandleFunc(""/offers"", api1) http.HandleFunc(""/getOffersList"", api2) err := http.ListenAndServe("":8080"", nil) if err != nil { log.Fatal(""ListenAndServe: "", err) }}func api1(w http.ResponseWriter, req *http.Request) { validateRequestHeader(w, req, ""GET"") // code here....}func api2(w http.ResponseWriter, req *http.Request) { validateRequestHeader(w, req, ""POST"") //code here....}func validateRequestHeader(w http.ResponseWriter, req *http.Request, allowedMethod string) { // allow cross domain AJAX requests w.Header().Set(""Content-Type"", ""application/json"") if origin := req.Header.Get(""Origin""); origin != """" { w.Header().Set(""Access-Control-Allow-Origin"", origin) w.Header().Set(""Access-Control-Allow-Methods"", ""POST, GET, OPTIONS, PUT, DELETE"") w.Header().Set(""Access-Control-Allow-Headers"", ""Accept, Content-Type, Content-Length, Accept-Encoding, X-CSRF-Token, Authorization"") } // Stop here if its Preflighted OPTIONS request if req.Method == ""OPTIONS"" { return } if req.Method != allowedMethod { response := ""Only "" + allowedMethod + "" requests are allowed"" http.Error(w, response, http.StatusMethodNotAllowed) return }} if req.Method != allowedMethod { response := ""Only "" + allowedMethod + "" requests are allowed"" http.Error(w, response, http.StatusMethodNotAllowed) return }",How to do error http error handling in Go language
why is cobra not reading my config file," The documentation in Cobra and Viper are confusing me. I did cobra init fooproject and then inside the project dir I did cobra add bar. I have a PersistentFlag that is named foo and here is the init function from the root command. My configuration file looks like this... And when I call go run main.go I see this... When I call go run main.go bar I see this... So it is using the configuration file, but neither one of them seems to be reading it. Maybe I am misunderstanding the way that Cobra and Viper work. Any ideas? <code>  func Execute() { if err := RootCmd.Execute(); err != nil { fmt.Println(err) os.Exit(-1) } fmt.Println(cfgFile) fmt.Println(""fooString is: "", fooString)}func init() { cobra.OnInitialize(initConfig) // Here you will define your flags and configuration settings. // Cobra supports Persistent Flags, which, if defined here, // will be global for your application. RootCmd.PersistentFlags().StringVar(&cfgFile, ""config"", """", ""config file (default is $HOME/.fooproject.yaml)"") RootCmd.PersistentFlags().StringVar(&fooString, ""foo"", """", ""loaded from config"") viper.BindPFlag(""foo"", RootCmd.PersistentFlags().Lookup(""foo"")) // Cobra also supports local flags, which will only run // when this action is called directly. RootCmd.Flags().BoolP(""toggle"", ""t"", false, ""Help message for toggle"")} ---foo: aFooString A longer description that spans multiple lines and likely containsexamples and usage of using your application. For example:Cobra is a CLI library for Go that empowers applications.This application is a tool to generate the needed filesto quickly create a Cobra application.Usage: fooproject [command]Available Commands: bar A brief description of your command help Help about any commandFlags: --config string config file (default is $HOME/.fooproject.yaml) --foo string loaded from config -h, --help help for fooproject -t, --toggle Help message for toggleUse ""fooproject [command] --help"" for more information about a command.fooString is: Using config file: my/gopath/github.com/user/fooproject/.fooproject.yamlbar calledfooString is:",Why is Cobra not reading my configuration file?
Go: use time value of benchmark," I have written a benchmark for my chess engine in Go: I see this output when it runs: I want to use the time per execution (in this case, 108737398 ns/op) to compute another value, and also print it as a result of the benchmark. Specifically, I want to output nodes per second, which is given as the result of the Perft call divided by the time per call.How can I access the time the benchmark took to execute, so I can print my own derived results? <code>  func BenchmarkStartpos(b *testing.B) { board := ParseFen(startpos) for i := 0; i < b.N; i++ { Perft(&board, 5) }} goos: darwingoarch: amd64BenchmarkStartpos-4 10 108737398 ns/opPASSok _/Users/dylhunn/Documents/go-chess 1.215s",How to use time value of benchmark
Should I use %s or %v to format Go error objects?," Here is my program. Here is the output. In this program, it makes no difference whether I use %s or %v to printthe error object.I have two questions.Is there any scenario while printing errors where it would make adifference for %s and %v?What is the correct format specifier to use in this case? <code>  package mainimport ( ""errors"" ""fmt"")func main() { a := -1 err := assertPositive(a) fmt.Printf(""error: %s; int: %d\n"", err, a) fmt.Printf(""error: %v; int: %d\n"", err, a)}func assertPositive(a int) error { if a <= 0 { return errors.New(""Assertion failure"") } return nil} error: Assertion failure; int: -1error: Assertion failure; int: -1",What is the correct format specifier to print error object in Go: %s or %v?
My object is not updated even if I use the pointer to a type to update it (Golang)," I store some Individual objects in a slice. Before appending it to the slice I print the name of the Individual object.After I have stored it in the slice, I then retrieve it as a pointer and want to change the name to ""Peter"", but the change does not work since it still prints ""Steve"". Why?  <code>  type Individual interface { GetName() *string SetName(name string)}type Person struct { name string}// Implement functions of the Individual interfacefunc (p Person) GetName() *string { return &p.name}func (p Person) SetName(newName string) { name := p.GetName(); *name = newName}var individuals []Individualfunc main() { person := Person{name: ""Steve""} fmt.Println(person) individuals = append(individuals, person) // append Person to slice p1 := individuals[0] // Retrieve the only Person from slice p1.SetName(""Peter"") // Change name fmt.Println(p1) // Should print ""Peter"", but prints ""Steve"" fmt.Println(person) // Should print ""Peter"", but prints ""Steve""}",My object is not updated even if I use the pointer to a type to update it
Golang: stop html template from escaping," I have an html template where i want to insert some JavaScript code from outside of template itself. In my template data struct i have created a string field JS string and call it with {{.JS}}. The problem is that everything in browser is escaped:newlines are \n< and > are \u003c and \u003e"" is \""Same symbols inside of a template are fine. If I Print my JS field into console it is also fine. I have seen some similar problems solved by using template.HTML type instead of string. In my case it does not work at all. EDIT 1The actual context is  <code>  <script language=""JavaScript""> var options = { {{.JS}} };</script>",How to stop html template from escaping
How to get ID of the last updated row in MySQL and Go?," How can I use this trick: How to get ID of the last updated row in MySQL? in Go (golang)?I am using the go-sql-driver. It should work with these two queries but how can I do it in Go? <code>  INSERT INTO table (unique_id) VALUES (""test"")ON DUPLICATE KEY UPDATE id=LAST_INSERT_ID(id);SELECT LAST_INSERT_ID();",How to get ID of the last inserted row in MySQL and Go?
Replace second occurrence of string in golang," How do I replace the nth (in this case second) occurrence of a string in golang? The following code replaces the example string optimismo from optimism with o from optimism when I want it to be optimismo from  <code>  package mainimport ( ""fmt"" ""strings"")func main() { mystring := ""optimismo from optimism"" excludingSecond := strings.Replace(mystring, ""optimism"", """", 1) fmt.Println(excludingSecond)}",Replace Nth occurrence of string in golang
Golang: Append not Thread-Safe?," I noticed that if I tried appending to a slice using goroutines inside a for loop, there would be instances where I would get missing/blank data: Sometimes, when I print all AttributeNames from destSlice, some elements are empty strings (""""), and other times, some elements from sourceSlice are not present in destSlice.Does my code have a data race, and does this mean that append is not thread-safe for concurrent use by multiple goroutines? <code>  destSlice := make([]myClass, 0)var wg sync.WaitGroupfor _, myObject := range sourceSlice { wg.Add(1) go func(closureMyObject myClass) { defer wg.Done() var tmpObj myClass tmpObj.AttributeName = closureMyObject.AttributeName destSlice = append(destSlice, tmpObj) }(myObject)}wg.Wait()",Append not thread-safe?
Channel Element type too large Golan," I'm writing a program that works with matrixes in parallel. My matrixes are created using a constant n. The channels are created with the following code: This works fine for anything under a value of around 12 for n however anything greater and the following error is given: Looking at tutorials etc, and it seem buffered channels may be the way to solve this but I tried doing this with the following code and the same error was given: Am I using buffered channels correctly or are they not the way to solve this issue? Any tips on how I can move forward with this greatly appreciated.EDIT: Following on from the answer given and comments I'm now trying to create a global matrix which is blank and go routines can write to. I'm unsure how it could be declared globally and have attempted the above to solve this. Does it need initialising globally? Everything I seem to try gives errors. <code>  const n = 10 a := make(chan [n][n]int) channel element type too large (>64kB) a := make(chan [n][n]int, 1000) const n int = 1024blank [n][n]int",Channel Element type too large Golang
How To Read An RSA Key From File, I need to read in an RSA private key from a file to sign a JWT. I have found some examples on how to save a generated RSA key to disk but nothing showing how to build a key struct based on a pre-generated key from a file.The key is generated like this: Example key: <code>  openssl genrsa 2048 | openssl pkcs8 -topk8 -nocrypt -----BEGIN PRIVATE KEY-----MIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQClHYNDPVSFFmWF oKGTqd/n7Dt2+tGXh97KJjVLAqCBZZHlQJ534v2OzFjTgzuMNehD9Y6HnkYFdkRb QzYi2YDROOzRl1bhyyWPA35OGf50r7LiNvSvNPNtswsCuK7ywOcH0yEMKSiW4q5R GKYi42w961EcTQQPrfihavY+c2FYPv4+pXymzaIz9hGBPLHwaHq/QTAyHxPCfkOo s/x3mxUVd7Ni2bz1VJGlyqcNEeU88wTAYMmv8oQ3y2NfKExtYn+W6TCDiq/+ZkOp wacuAU0J7tCNgcXvkq39KH5uza2uSiTniye6uhlkvYWD3s9riIIiekTEiHk/kkc6 jMg8HN/7AgMBAAECggEBAJ12u8vQHV6esUrymaTdCG+BVmRtZpyA ... -----END RSA PRIVATE KEY-----,How to read an RSA key from file
Concurency file system scanning in Golang," I want to obtain file information (file name & size in bytes) for the files in a directory. But there are a lot of sub-directory (~ 1000) and files (~40 000).Actually my solution is to use filepath.Walk() to obtain file information for each file. But this is quite long. Is it possible to do parallel/concurrent processing using filepath.Walk()? <code>  func visit(path string, f os.FileInfo, err error) error { if f.Mode().IsRegular() { fmt.Printf(""Visited: %s File name: %s Size: %d bytes\n"", path, f.Name(), f.Size()) } return nil}func main() { flag.Parse() root := ""C:/Users/HERNOUX-06523/go/src/boilerpipe"" //flag.Arg(0) filepath.Walk(root, visit)}",Concurrent filesystem scanning
How to get variable memory size of variable in golang?," I am curious about the memory cost of map and slice, so I wrote a program to compare the sizes. I get the memory size by unsafe.Sizeof(s), but obviously it is wrong, because when I change the size, the output is the same. <code>  func getSlice(size int) []int { t := time.Now() s := make([]int, size*2) for i := 0; i < size; i++ { index := i << 1 s[index] = i s[index+1] = i } fmt.Println(""slice time cost: "", time.Since(t)) return s}func getMap(size int) map[int]int { t := time.Now() m := make(map[int]int, size) for i := 0; i < size; i++ { m[i] = i } fmt.Println(""map time cost: "", time.Since(t)) return m}func TestMem(t *testing.T) { size := 1000 s := getSlice(size) m := getMap(size) fmt.Printf(""slice size: %d\n"", unsafe.Sizeof(s)) fmt.Printf(""map size: %d\n"", unsafe.Sizeof(m))}",How to get memory size of variable in Go?
How to get memory size of variable in golang?," I am curious about the memory cost of map and slice, so I wrote a program to compare the sizes. I get the memory size by unsafe.Sizeof(s), but obviously it is wrong, because when I change the size, the output is the same. <code>  func getSlice(size int) []int { t := time.Now() s := make([]int, size*2) for i := 0; i < size; i++ { index := i << 1 s[index] = i s[index+1] = i } fmt.Println(""slice time cost: "", time.Since(t)) return s}func getMap(size int) map[int]int { t := time.Now() m := make(map[int]int, size) for i := 0; i < size; i++ { m[i] = i } fmt.Println(""map time cost: "", time.Since(t)) return m}func TestMem(t *testing.T) { size := 1000 s := getSlice(size) m := getMap(size) fmt.Printf(""slice size: %d\n"", unsafe.Sizeof(s)) fmt.Printf(""map size: %d\n"", unsafe.Sizeof(m))}",How to get memory size of variable in Go?
How to get memory size of variable in Golang?," I am curious about the memory cost of map and slice, so I wrote a program to compare the sizes. I get the memory size by unsafe.Sizeof(s), but obviously it is wrong, because when I change the size, the output is the same. <code>  func getSlice(size int) []int { t := time.Now() s := make([]int, size*2) for i := 0; i < size; i++ { index := i << 1 s[index] = i s[index+1] = i } fmt.Println(""slice time cost: "", time.Since(t)) return s}func getMap(size int) map[int]int { t := time.Now() m := make(map[int]int, size) for i := 0; i < size; i++ { m[i] = i } fmt.Println(""map time cost: "", time.Since(t)) return m}func TestMem(t *testing.T) { size := 1000 s := getSlice(size) m := getMap(size) fmt.Printf(""slice size: %d\n"", unsafe.Sizeof(s)) fmt.Printf(""map size: %d\n"", unsafe.Sizeof(m))}",How to get memory size of variable in Go?
can I post with Content-Type: multipart/form-data in go," How do I POST to an API with Content-Type: multipart/form-data, []byte parameters and string arguments? I have tried, but it is failing.Error message: Go code: <code>  details: ""[301 301 Moved Permanently]<!DOCTYPE HTML PUBLIC \""-//IETF//DTD HTML 2.0//EN\"">\r\n<html>\r\n301 Moved Permanently\r\n<body bgcolor=\""white\"">\r\n301 Moved Permanently\r\n<p>The requested resource has been assigned a new permanent URI.</p >\r\n<hr/>Powered by Tengine/2.1.0</body>\r\n</html>\r\n"" func NewPost2(url string) ([]byte, error) { m := make(map[string]interface{}, 0) m[""fileName""] =""good"" m[""name""] = Base64ToByte(""/9j/4AAQSkZJRgABAQEAeAB4AAD/2wBDAAIBAQIBAQICAgICAgICAwUDAwMDAwYEBAMFBwYHBwcGBwcICQsJCAgKCAcHCg0KCgsMDAwMBwkODw0MDgsMDAz/2wBDAQICAgMDAwYDAwYMCAcIDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAz/wAARCAABAAEDASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwDHooor+wD+Zz//2Q=="")b, _ := json.Marshal(m) httpReq, err := http.NewRequest(""POST"", url, bytes.NewBuffer(b)) httpReq.Header.Set(""Content-Type"", ""multipart/form-data;charset=UTF-8"") client := &http.Client{} resp, err := client.Do(httpReq) if err != nil { return nil, err } defer resp.Body.Close() if resp.StatusCode < 200 || resp.StatusCode >= 300 { b, _ := ioutil.ReadAll(resp.Body) return nil, fmt.Errorf(""[%d %s]%s"", resp.StatusCode, resp.Status, string(b)) } respData, err := ioutil.ReadAll(resp.Body) if err != nil { return nil, err } return respData, nil}",Can I post with Content-Type: multipart/form-data
Can I post with Content-Type: multipart/form-data in Go?," How do I POST to an API with Content-Type: multipart/form-data, []byte parameters and string arguments? I have tried, but it is failing.Error message: Go code: <code>  details: ""[301 301 Moved Permanently]<!DOCTYPE HTML PUBLIC \""-//IETF//DTD HTML 2.0//EN\"">\r\n<html>\r\n301 Moved Permanently\r\n<body bgcolor=\""white\"">\r\n301 Moved Permanently\r\n<p>The requested resource has been assigned a new permanent URI.</p >\r\n<hr/>Powered by Tengine/2.1.0</body>\r\n</html>\r\n"" func NewPost2(url string) ([]byte, error) { m := make(map[string]interface{}, 0) m[""fileName""] =""good"" m[""name""] = Base64ToByte(""/9j/4AAQSkZJRgABAQEAeAB4AAD/2wBDAAIBAQIBAQICAgICAgICAwUDAwMDAwYEBAMFBwYHBwcGBwcICQsJCAgKCAcHCg0KCgsMDAwMBwkODw0MDgsMDAz/2wBDAQICAgMDAwYDAwYMCAcIDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAz/wAARCAABAAEDASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwDHooor+wD+Zz//2Q=="")b, _ := json.Marshal(m) httpReq, err := http.NewRequest(""POST"", url, bytes.NewBuffer(b)) httpReq.Header.Set(""Content-Type"", ""multipart/form-data;charset=UTF-8"") client := &http.Client{} resp, err := client.Do(httpReq) if err != nil { return nil, err } defer resp.Body.Close() if resp.StatusCode < 200 || resp.StatusCode >= 300 { b, _ := ioutil.ReadAll(resp.Body) return nil, fmt.Errorf(""[%d %s]%s"", resp.StatusCode, resp.Status, string(b)) } respData, err := ioutil.ReadAll(resp.Body) if err != nil { return nil, err } return respData, nil}",Can I post with Content-Type: multipart/form-data
Multi-dimensional arrays in Golang," It runs. It also runs. It runs again! But it fails!?Is there a problem with nested maps in Go? Or is there no multiple bracket support for nested maps? <code>  func main() { var data = map[string]string{} data[""a""] = ""x"" data[""b""] = ""x"" data[""c""] = ""x"" fmt.Println(data)} func main() { var data = map[string][]string{} data[""a""] = append(data[""a""], ""x"") data[""b""] = append(data[""b""], ""x"") data[""c""] = append(data[""c""], ""x"") fmt.Println(data)} func main() { var w = map[string]string{} var data = map[string]map[string]string{} w[""w""] = ""x"" data[""a""] = w data[""b""] = w data[""c""] = w fmt.Println(data)} func main() { var data = map[string]map[string]string{} data[""a""][""w""] = ""x"" data[""b""][""w""] = ""x"" data[""c""][""w""] = ""x"" fmt.Println(data)}",Nested maps in Golang
is there a golang terminal shell? is it possible for a compiled language?," Recently I'm interested in Golang. When I was learning Python I kicked off a terminal shell and just practised throwing it different data, files, making many trivial silly operations, it's such a nice way to interact with a new language and it's super helpful for writing new programs. I wonder- I guess because Golang is a compiled language like Java it's not possible to have such a terminal shell. Is that right? If so- what's the real technical reason why it can't work? <code> ",Is there a Golang terminal shell? Is it possible for a compiled language?
Go - Decode JSON as it is still streaming in via net/http," In the past I've used go to decode JSON from an API endpoint in the manner shown below. I am shortly going to be working on an endpoint that could send me several megabytes of JSON data in the following format. The JSON will at some point contain an array of large, arbitrary length, objects. I want to take each one of these objects and place them, separately, into a message queue. I do not need to decode the objects themselves.If I used my normal method, this would load the entire response into memory before decoding it.Is there a good way to split out each of the LARGE OBJECT items as the response is still streaming in and dispatch it off to the queue? I'm doing this to avoid holding as much data in memory. <code>  client := &http.Client{}req, err := http.NewRequest(""GET"", ""https://some/api/endpoint"", nil)res, err := client.Do(req)defer res.Body.Close()buf, _ := ioutil.ReadAll(res.Body)// ... Do some error checking etc ...err = json.Unmarshal(buf, &response) { ""somefield"": ""value"", ""items"": [ { LARGE OBJECT }, { LARGE OBJECT }, { LARGE OBJECT }, { LARGE OBJECT }, ... ]}",Decode JSON as it is still streaming in via net/http
Why golang strcut array cannot be assigned to an interface array," I'm trying to achieve something as below. This gives a compile time error: Why is this not possible?.If not is there any other way to hold generic object arrays in Golang? <code>  package mainimport ( ""fmt"")type MyStruct struct { Value int}func main() { x := []MyStruct{ MyStruct{ Value : 5, }, MyStruct{ Value : 6, }, } var y []interface{} y = x // This throws a compile time error _,_ = x,y} sample.go:21: cannot use x (type []MyStruct) as type []interface {} in assignment",Why golang struct array cannot be assigned to an interface array
Golang: set nil string pointer to empty string," How do I set the referenced value of a string pointer in a type to the empty string?Consider this example: I've tried all combinations of the & and * operators to no avail: Obviously some of those are silly, but I didn't see the harm in trying. I also tried using reflect and SetString: and this gives a compilation error panic: reflect: reflect.Value.SetString using unaddressable valueI'm assuming that's because strings in Go are immutable? <code>  package mainimport ( ""fmt"")type Test struct { value *string}func main() { t := Test{nil} if t.value == nil { // I want to set the pointer's value to the empty string here } fmt.Println(t.value)} t.value = &""""t.value = *""""&t.value = """"*t.value = """" reflect.ValueOf(t.value).SetString("""")",Set nil string pointer to empty string
Golang testify - AssertCalled always fails," I am using testify to test my code and I want to check if a function was called.I am doing the following: The error I am getting: I call function ""Bar"" and immediately ask if it was called but it returns false.What am I doing wrong?What is the proper way to test if a function was called with testify? <code>  type Foo struct { mock.Mock}func (m Foo) Bar() {}func TestFoo(t *testing.T) { m := Foo{} m.Bar() m.AssertCalled(t, ""Bar"")} Error: Should be trueMessages: The ""Bar"" method should have been called with 0 argument(s), but was not.mock.go:419: []",AssertCalled always fails with testify library
"type is pointer to interface, not interface confusion"," I have this problem which seems a bit weird to me. Take a look at this snippet of code: On some other package, I have the following code: The run-time won't accept the line mentioned because""cannot use fieldfilter (type *coreinterfaces.FieldFilter) as type*coreinterfaces.FilterInterface in argument to fieldint.AddFilter:*coreinterfaces.FilterInterface is pointer to interface, not interface""However, when changing the code to: Everything is alright and when debugging the application it really seems to includeI'm a bit confused on this topic. When looking at other blog posts and stack overflow threads discussing this exact same issue (for example - This, orThis) the first snippet which raises this exception should work, because both fieldfilter and fieldmap are initialized as pointers to interfaces, rather than value of interfaces. I haven't been able to wrap my head around what actually happens here that I need to change in order for me not to declare a FieldInterface and assign the implementation for that interface. There must be an elegant way to do this. <code>  package coreinterfacestype FilterInterface interface { Filter(s *string) bool}type FieldFilter struct { Key string Val string}func (ff *FieldFilter) Filter(s *string) bool { // Some code}type FilterMapInterface interface { AddFilter(f *FilterInterface) uuid.UUID RemoveFilter(i uuid.UUID) GetFilterByID(i uuid.UUID) *FilterInterface}type FilterMap struct { mutex sync.Mutex Filters map[uuid.UUID]FilterInterface}func (fp *FilterMap) AddFilter(f *FilterInterface) uuid.UUID { // Some code}func (fp *FilterMap) RemoveFilter(i uuid.UUID) { // Some code}func (fp *FilterMap) GetFilterByID(i uuid.UUID) *FilterInterface { // Some code} func DoFilter() { fieldfilter := &coreinterfaces.FieldFilter{Key: ""app"", Val: ""152511""} filtermap := &coreinterfaces.FilterMap{} _ = filtermap.AddFilter(fieldfilter) // <--- Exception is raised here} func DoBid() error { bs := string(b) var ifilterfield coreinterfaces.FilterInterface fieldfilter := &coreinterfaces.FieldFilter{Key: ""app"", Val: ""152511""} ifilterfield = fieldfilter filtermap := &coreinterfaces.FilterMap{} _ = filtermap.AddFilter(&ifilterfield)}","""<type> is pointer to interface, not interface"" confusion"
Golang: what happens if I don't cancel a Context?," I have the following code: What would happen if I didn't put defer cancel() in there? go vet warned this the cancel function returned by context.WithTimeout should be called, not discarded, to avoid a context leakHow will the context be leaked and what impact will this have? Thanks <code>  func Call(ctx context.Context, payload Payload) (Response, error) { req, err := http.NewRequest(...) // Some code that creates request from payload ctx, cancel = context.withTimeout(ctx, time.Duration(3) * time.Second) defer cancel() return http.DefaultClient.Do(req)}",What happens if I don't cancel a Context?
Go access main package from other package," I want to access the main package from another package, but this is impossible because the main file isn't in a directory. I already tried putting the main file in a directory, but when I try to import it I get this error:import ""../main"" is a program, not an importable packageThe reason that I want this because I have a tcp server and a webserver that work together. The webserver can get the tcp server via the main package and the tcp server can get the webserver via the main package.I already got it working with the webserver and tcpserver reading from each other(without the main package in the middle), but I want to keep some parts of the application at one place.Is the the thing I want possible(Via the main package)? Or is it just stupid. <code> ",Access main package from other package
GOPATH is empty(GOGLAND IDE)," I am pretty new to Go and Gogland. I just downloaded 'go1.8.3.windows-amd64.msi', installed it in C Drive and then started writing my programs in a notepad and then finally running it from a terminal.I am facing some issues with Gogland. I have intelliJ IDEA Ultimate But I have been asked to use Gogland. I do not know whether this is the correct decision.You may want to advise me on the same.I just created a new project, gave it a name and added a go file into it which has simple helloworld code.But it shows me an error ""GOPATH is empty"".As you could see the message at the top, just above the line package myfirstproject.How to resolve it? Do I need to do something with environment variables. The PATH environment variable is already set to 'C:\Go\bin'.When I click on the error message it asks me to configure GOPATH. <code> ",GOPATH is empty (Gogland IDE)
How to view full stack trace for golang build with nested dependency?," I'm trying to debug the following build error in our CI where ""A depends on B which can't build because it depends on C."" I'm building my data service which doesn't directly depend on kafkaAvailMonitor.go which makes this error hard to trace. In other words:data (what I'm building) depends on (?) which depends onkafkaAvailMonitor.goIt may seem trivial to fix for a developer they just do ""go get whatever"" but I can't do that as part of the release process - I have to find the person that added the dependency and ask them to fix it.I'm aware that there are tools to visualize the dependency tree and other more sophisticated build systems, but this seems like a pretty basic issue: is there any way I can view the full dependency tree to see what's causing the build issue? <code>  go build -a -v../../../msgq/kafkaAvailMonitor.go:8:2: cannot find package ""github.com/Shopify/sarama/tz/breaker"" in any of: /usr/lib/go-1.6/src/github.com/Shopify/sarama/tz/breaker (from $GOROOT) /home/jenkins/go/src/github.com/Shopify/sarama/tz/breaker (from $GOPATH) /home/jenkins/vendor-library/src/github.com/Shopify/sarama/tz/breaker /home/jenkins/go/src/github.com/Shopify/sarama/tz/breaker /home/jenkins/vendor-library/src/github.com/Shopify/sarama/tz/breaker",How to view full dependency tree for nested Go dependencies
How to view full trace for golang build with nested dependency?," I'm trying to debug the following build error in our CI where ""A depends on B which can't build because it depends on C."" I'm building my data service which doesn't directly depend on kafkaAvailMonitor.go which makes this error hard to trace. In other words:data (what I'm building) depends on (?) which depends onkafkaAvailMonitor.goIt may seem trivial to fix for a developer they just do ""go get whatever"" but I can't do that as part of the release process - I have to find the person that added the dependency and ask them to fix it.I'm aware that there are tools to visualize the dependency tree and other more sophisticated build systems, but this seems like a pretty basic issue: is there any way I can view the full dependency tree to see what's causing the build issue? <code>  go build -a -v../../../msgq/kafkaAvailMonitor.go:8:2: cannot find package ""github.com/Shopify/sarama/tz/breaker"" in any of: /usr/lib/go-1.6/src/github.com/Shopify/sarama/tz/breaker (from $GOROOT) /home/jenkins/go/src/github.com/Shopify/sarama/tz/breaker (from $GOPATH) /home/jenkins/vendor-library/src/github.com/Shopify/sarama/tz/breaker /home/jenkins/go/src/github.com/Shopify/sarama/tz/breaker /home/jenkins/vendor-library/src/github.com/Shopify/sarama/tz/breaker",How to view full dependency tree for nested Go dependencies
How to view full dependency tree for nested Go dependencyd," I'm trying to debug the following build error in our CI where ""A depends on B which can't build because it depends on C."" I'm building my data service which doesn't directly depend on kafkaAvailMonitor.go which makes this error hard to trace. In other words:data (what I'm building) depends on (?) which depends onkafkaAvailMonitor.goIt may seem trivial to fix for a developer they just do ""go get whatever"" but I can't do that as part of the release process - I have to find the person that added the dependency and ask them to fix it.I'm aware that there are tools to visualize the dependency tree and other more sophisticated build systems, but this seems like a pretty basic issue: is there any way I can view the full dependency tree to see what's causing the build issue? <code>  go build -a -v../../../msgq/kafkaAvailMonitor.go:8:2: cannot find package ""github.com/Shopify/sarama/tz/breaker"" in any of: /usr/lib/go-1.6/src/github.com/Shopify/sarama/tz/breaker (from $GOROOT) /home/jenkins/go/src/github.com/Shopify/sarama/tz/breaker (from $GOPATH) /home/jenkins/vendor-library/src/github.com/Shopify/sarama/tz/breaker /home/jenkins/go/src/github.com/Shopify/sarama/tz/breaker /home/jenkins/vendor-library/src/github.com/Shopify/sarama/tz/breaker",How to view full dependency tree for nested Go dependencies
"go: ""cannot take the address of"" and ""cannot call pointer method on"""," This compiles and works: This does not (yields the errors in the title): Can someone help me understand why? (learning Go)Here are those methods: <code>  diff := projected.Minus(c.Origin)dir := diff.Normalize() dir := projected.Minus(c.Origin).Normalize() // Minus subtracts another vector from this onefunc (a *Vector3) Minus(b Vector3) Vector3 { return Vector3{a.X - b.X, a.Y - b.Y, a.Z - b.Z}}// Normalize makes the vector of length 1func (a *Vector3) Normalize() Vector3 { d := a.Length() return Vector3{a.X / d, a.Y / d, a.Z / d}}","""cannot take the address of"" and ""cannot call pointer method on"""
Why is goapp test is looking for file in /tmp?," I'm trying to get tests working on my local dev machine Cloud SDK version is: 159.0.0Everything I've read says that I should no change GOROOT so I'm not sure how to fix this.$ /Users/bryan/google-cloud-sdk/platform/google_appengine/goroot/bin/goapp test bryan@Bryans-MacBook Thu Jun 15 10:22:37 ~/go/src/skincarereview$ go env bryan@Bryans-MacBook Thu Jun 15 10:22:57 ~/go/src/skincarereview$ ls ~/google-cloud-sdk bryan@Bryans-MacBook Thu Jun 15 10:24:22 ~/go/src/skincarereview $ find / -name goroot 2>/dev/null bryan@Bryans-MacBook Thu Jun 15 10:28:43 ~/go/src/skincarereview $ echo $PATH Looking at main.go line 155, where I think the error is being thrown, I don't see where ""goroot"" is being set . <code>  go: cannot find GOROOT directory: /tmp/go_sdk887571938/appengine/go_appengine/goroot GOARCH=""amd64""GOBIN=""""GOEXE=""""GOHOSTARCH=""amd64""GOHOSTOS=""darwin""GOOS=""darwin""GOPATH=""/Users/bryan/go/""GORACE=""""GOROOT=""/usr/local/go""GOTOOLDIR=""/usr/local/go/pkg/tool/darwin_amd64""GO15VENDOREXPERIMENT=""1""CC=""clang""GOGCCFLAGS=""-fPIC -m64 -pthread -fno-caret-diagnostics -Qunused-arguments -fmessage-length=0 -fno-common""CXX=""clang++""CGO_ENABLED=""1"" total 408drwxr-xr-x 30 bryan staff 1020 Jun 14 20:31 .install-rw-r--r-- 1 bryan staff 980 Jun 14 20:30 LICENSE-rw-r--r-- 1 bryan staff 673 Jun 14 20:30 README-rw-r--r-- 1 bryan staff 162673 Jun 14 20:30 RELEASE_NOTES-rw-r--r-- 1 bryan staff 8 Jun 14 20:30 VERSIONdrwxr-xr-x 10 bryan staff 340 Jun 14 20:30 bin-rw-r--r-- 1 bryan staff 2734 Jun 14 20:30 completion.bash.inc-rw-r--r-- 1 bryan staff 2083 Jun 14 20:30 completion.zsh.incdrwxr-xr-x 3 bryan staff 102 Jun 14 20:30 help-rwxr-xr-x 1 bryan staff 1581 Jun 14 20:30 install.bat-rwxr-xr-x 1 bryan staff 3471 Jun 14 20:30 install.shdrwxr-xr-x 10 bryan staff 340 Jun 14 20:30 lib-rw-r--r-- 1 bryan staff 308 Jun 14 20:30 path.bash.inc-rw-r--r-- 1 bryan staff 1210 Jun 14 20:30 path.fish.inc-rw-r--r-- 1 bryan staff 31 Jun 14 20:30 path.zsh.incdrwxr-xr-x 6 bryan staff 204 Jun 14 20:30 platform-rw-r--r-- 1 bryan staff 40 Jun 14 20:30 properties /Users/bryan/google-cloud-sdk/platform/google_appengine/goroot /Users/bryan/google-cloud-sdk/bin:/Users/bryan/go/src/:/Users/bryan/google-cloud-sdk/platform/google_appengine/goroot/bin/:/Users/bryan/google-cloud-sdk/bin/:/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin:/usr/local/go/bin if fi, err := os.Stat(goroot); err != nil || !fi.IsDir() { fmt.Fprintf(os.Stderr, ""go: cannot find GOROOT directory: %v\n"", goroot) os.Exit(2)}",Why is goapp test is looking for files in /tmp?
Will go test code only referenced in test files be complied into the binary?," I am wondering what code will be compiled into the go binary if you compile a binary using go build ./... . This will compile a binary that has a cli program. For this cli program, I have test code and non test code. I currently have several flavours of test code:foo_test.go in package foo_testfoo_internal_test.go in package footestutil.go in package testutil that provides test utility functionsNo test code is actually referenced in the non test code. The testutil functions are only imported in the test files. If the test code is infact compiled into the binary , how much of a problem is this? <code> ",Will go test code only referenced in test files be compiled into the binary?
How to have zeromq timeout messages that are outbound queued but haven't been sent within a set time," I have an application running on a server which takes requests from a phone app and then load balances the request across worker servers. I'm trying to add a timeout in the case that messages on the main server that have been in the outbound queue for the length of the timeout are removed from the queue. More specifically, the application on the main server is written in golang and implements the Paranoid Pirate Pattern of load balancing. The code I currently have is: If the backend sends a message, but it is not actually sent to a worker in some period of time, I want it to expire and not ever be sent. Is there a socket option that can accomplish this? If not, what would I have to do to accomplish this?Two ways I think I can do this without socket options are:1) Have the backend wrap the message in a wrapper and send to a golang queue and not through zeromq. The wrapper contains the time that the message was ""sent"". The backend concurrently pulls from the front of the golang queue one at a time and checks if the message is expired. If so, don't send, if not, send the message. I could have the backend add the message to the golang queue first and then truly send it out after in the same block of code. That way, I don't need a lock.2) Send the wrapper message through zeromq to a retriever and the retriever checks if its expired and returns early. I don't like this because it seems like its bad for performance. <code>  import ( ""fmt"" zmq ""github.com/pebbe/zmq4"" ""time"")const ( HEARTBEAT_LIVENESS = 3 HEARTBEAT_INTERVAL = 1500 * time.Millisecond MESSAGE_READY = ""\001"" MESSAGE_HEARTBEAT = ""\002"")var ( client *zmq.Socket backend *zmq.Socket frontend *zmq.Socket workerPoller *zmq.Poller brokerPoller *zmq.Poller workerQueue []Worker)type Worker struct { Id string Expire time.Time}type RequestWrapper { RequestToSend Request}func NewWorker(id string) Worker { return Worker{ Id: id, Expire: time.Now().Add(HEARTBEAT_INTERVAL * HEARTBEAT_LIVENESS), }}func AddReadyWorker(workers []Worker, worker Worker) []Worker { fmt.Println(worker.Id, "" joined"") for i, w := range workers { if worker.Id == w.Id { if i == 0 { workers = workers[1:] } else if i == len(workers)-1 { workers = workers[:i] } else { workers = append(workers[:i], workers[i+1:]...) } break } } return append(workers, worker)}func PurgeInactiveWorkers() { now := time.Now() for i, worker := range workerQueue { if now.Before(worker.Expire) { workerQueue = workerQueue[i:] return } } workerQueue = workerQueue[0:0]}func LoadBalance() {// Loop: heartbeat := time.Tick(HEARTBEAT_INTERVAL) for { var sockets []zmq.Polled // If you have available workers, poll on the both front and backend // If not poll on backend with infinite timeout if len(workerQueue) > 0 { sockets, _ = brokerPoller.Poll(HEARTBEAT_INTERVAL) } else { sockets, _ = workerPoller.Poll(HEARTBEAT_INTERVAL) } for _, socket := range sockets { switch socket.Socket { // backend is a router case backend: workerId, _ := backend.Recv(0) workerQueue = AddReadyWorker(workerQueue, NewWorker(workerId)) clientId, _ := backend.Recv(0) if clientId != MESSAGE_READY && clientId != MESSAGE_HEARTBEAT { route, _ := backend.Recv(0) message, _ := backend.RecvBytes(0) fmt.Println(""Received response"") RouteResponse(route, message) // frontend.Send(clientId, zmq.SNDMORE) // frontend.Send("""", zmq.SNDMORE) // frontend.SendBytes(message, 0) } // frontend is a dealer case frontend: clientId, _ := frontend.Recv(0) route, _ := frontend.Recv(0) message, _ := frontend.RecvBytes(0) backend.Send(workerQueue[0].Id, zmq.SNDMORE) backend.Send(clientId, zmq.SNDMORE) backend.Send(route, zmq.SNDMORE) backend.SendBytes(message, 0) workerQueue = workerQueue[1:] } } select { case <-heartbeat: for _, worker := range workerQueue { backend.Send(worker.Id, zmq.SNDMORE) backend.Send(MESSAGE_HEARTBEAT, 0) } break default: } PurgeInactiveWorkers() }}","How to have ZeroMQ to timeout messages that are outbound queued, but haven't been sent within a set time?"
Golangs most efficient number of goroutines on this machine," So I do have a concurrent quicksort implementation written by me. It looks like this: I have a sem buffered channel, which I use to limit the number of goroutines running (if its reaches that number, I dont set up another goroutine, I just do the normal quicksort on the subarray). First I started with 100, then I've changed to 50, 20. The benchmarks would get slightly better. But after switching to 10, it started to go back, times started to get bigger. So there is some arbitrary number, at least for my hardware, that makes the algorithm run most efficient. When I was implementing this, I actually saw some SO question about the number of goroutines that would be the best and now I cannot find it (stupid Chrome history actually saves not all visited sites). Do you know how to calculate such a things? And it would be the best if I didn't have to hardcode it, just let the program do it itself.P.S I have nonconcurrent Quicksort, which runs about 1.7x slower than this. As you can see in my code, I do Quicksort, when the number of running goroutines exceeds the number I've set up earlier. I thought what about using a ConcurrentQuicksort, but not calling it with go keyword, just simply calling it, and maybe if other goroutines finish their job, the ConcurrentQuicksort which I called would start to launch up goroutines, speeding up the process (cuz as you can see Quicksort would only launch recursive quicksorts, without goroutines). I did that, and actually the time was like 10% slower than the regular Quicksort. Do you know why would that happen? <code>  func Partition(A []int, p int, r int) int { index := MedianOf3(A, p, r) swapArray(A, index, r) x := A[r] j := p - 1 i := p for i < r { if A[i] <= x { j++ tmp := A[j] A[j] = A[i] A[i] = tmp } i++ } swapArray(A, j+1, r) return j + 1}func ConcurrentQuicksort(A []int, p int, r int) { wg := sync.WaitGroup{} if p < r { q := Partition(A, p, r) select { case sem <- true: wg.Add(1) go func() { ConcurrentQuicksort(A, p, q-1) <-sem wg.Done() }() default: Quicksort(A, p, q-1) } select { case sem <- true: wg.Add(1) go func() { ConcurrentQuicksort(A, q+1, r) <-sem wg.Done() }() default: Quicksort(A, q+1, r) } } wg.Wait()}func Quicksort(A []int, p int, r int) { if p < r { q := Partition(A, p, r) Quicksort(A, p, q-1) Quicksort(A, q+1, r) }}",Most efficient number of goroutines on this machine
Golang: check if a character is Russian," I would like to know if a string contains Russian/Cyrillic characters.For latin characters, I do something like this (pseudocode): What is the corresponding way to do it for Russian/Cyrillic alphabet? <code>  text := ""test""for _, r := range []rune(text) { if r >= 'a' && r <= 'z' { return True }}return False",Check if a character is Russian
ed2519.Public result is different," Using the package https://github.com/golang/crypto/tree/master/ed25519 i m trying to get a public key for a given private key.Those data are from http://www.bittorrent.org/beps/bep_0044.html: test 2 (mutable with salt) Problem is, ed25519.Public() won t return the same public key when i fed it with the given private key.The golang implementation returns the last 32 bytes of the PVK. But in my test data this is unexpected.The code here https://play.golang.org/p/UJNPCyuGQB How to generate the same public key than the bep using golang ? <code>  package mainimport ( ""encoding/hex"" ""golang.org/x/crypto/ed25519"" ""log"")func main() { priv := ""e06d3183d14159228433ed599221b80bd0a5ce8352e4bdf0262f76786ef1c74db7e7a9fea2c0eb269d61e3b38e450a22e754941ac78479d6c54e1faf6037881d"" pub := ""77ff84905a91936367c01360803104f92432fcd904a43511876df5cdf3e7e548"" sig := ""6834284b6b24c3204eb2fea824d82f88883a3d95e8b4a21b8c0ded553d17d17ddf9a8a7104b1258f30bed3787e6cb896fca78c58f8e03b5f18f14951a87d9a08"" // d := hex.EncodeToString([]byte(priv)) privb, _ := hex.DecodeString(priv) pvk := ed25519.PrivateKey(privb) buffer := []byte(""4:salt6:foobar3:seqi1e1:v12:Hello World!"") sigb := ed25519.Sign(pvk, buffer) pubb, _ := hex.DecodeString(pub) sigb2, _ := hex.DecodeString(sig) log.Println(ed25519.Verify(pubb, buffer, sigb)) log.Printf(""%x\n"", pvk.Public()) log.Printf(""%x\n"", sigb) log.Printf(""%x\n"", sigb2)}",ed25519.Public result is different
Need clarification on understanding what the command line argument does," According to Ethereum Developers' Guide: You can build all code using the go tool, placing the resulting binary in $GOPATH/bin. What does ./... do in the context of: <code>  go install -v ./... go install -v ./...",Building all code with Go and './...'
go - how to get intersection of two slice in golang?," Is there any efficient way to get intersection of two slices in Go?I want to avoid nested for loop like solution order of string does not matter <code>  slice1 := []string{""foo"", ""bar"",""hello""}slice2 := []string{""foo"", ""bar""}intersection(slice1, slice2)=> [""foo"", ""bar""]",How to get intersection of two slice in golang?
Not able to FindId using mgo library of golang?," I am using mgo library for mongo operationg in golang and here is my code : I am getting this output : But I checked, document exists in mongo, but getting here no result, any idea what am i missing ... <code>  session.SetMode(mgo.Monotonic, true)coll := session.DB(""aaaw_web"").C(""cron_emails"")var result Resultfmt.Printf(""%v"", message.ID)err = coll.FindId(bson.ObjectId(message.ID)).One(&result)fmt.Printf(""%v"", result)fmt.Println(err) 595f2c1a6edcba0619073263{ObjectIdHex("""") 0 0 0 0 { 0 false 0 } 0 0 0 0 0 0 0}ObjectIDs must be exactly 12 bytes long (got 24)not found",Why can't I find the ID using the mgo library of golang?
Windows EVT_SUBSCRIBE_CALLBACK function in Golang," I wanna make push subscription to Windows Event Log in GolangHow exactly should I pass a callback function?EVT_SUBSCRIBE_CALLBACK is the pointer of function, like So, my variant looks like this: I get successfully subscribed handler with no errors, but it still doesn't work.Any ideas why? Where should I look first? <code>  typedef DWORD ( WINAPI *EVT_SUBSCRIBE_CALLBACK)( EVT_SUBSCRIBE_NOTIFY_ACTION Action, PVOID UserContext, EVT_HANDLE Event); func logCallback() syscall.Handle { cb := func(_ uintptr, _ uintptr, _ uintptr) uint64 { fmt.Printf(""callback called %v"", data) return 0 } ptr := syscall.NewCallback(cb) return syscall.Handle(ptr) // type syscall.Handle uintptr}",Windows callback function in Golang
Equivalence of static methods in golang," Let's say in Java, I have class CryptoFormat, which has a static method named getLegacyFormat(). When I want to use the method, I just need to call CryptoFormat.getLegacyFormat(). This is clear because I know where the method comes from. In Go, there is no static method. I don't really want to just make a file called crypto_format.go and define the method there. The reason is that whenever I need the method, I just call GetLegacyFormat(), which doesn't contain the context where the method comes from. I could think of two ways to solve the problem:Make a separate package named cryptoformat, and define the method as a global function in the package. This way, I need to make a new package for just few methods. Also, whenever I need static methods like this, I have to define new packages.Define a struct named cryptoFormat containing method GetLegacyFormat(). Also, define a global public variable named CryptoFormat, which points to an instance of struct cryptoFormat. This way, I can call CryptoFormat.GetLegacyFormat() when I need the method.I am not sure which one is better, or whether there is better way. <code> ",Equivalence of static methods in Go
why position of `[0]byte` in the struct matters?," [0]byte in golang should not take any memory space. But these two structs have different sizes. So why the position of [0]byte matters here?By the way, I use unsafe.Sizeof() method to check the struct size. See the full example . <code>  type bar2 struct { A int _ [0]byte}type bar3 struct { _ [0]byte A int }",Why position of `[0]byte` in the struct matters?
How struct{} and struct{}{} work in Go?," I am wondering what does ""struct{}"" and ""struct{}{}"" mean in Go? An example is as follows: or <code>  array[index] = struct{}{} make(map[type]struct{})",How do struct{} and struct{}{} work in Go?
How does golang type cast internally work? What is the memory utilization for the same?," How does Go type conversion internally work?What is the memory utilisation for a type cast? For example: whenever I type convert any variable, will it consume more memory?I am concerned about this because when I try to unmarshall, I get ""fatal error: runtime: out of memory"" str1 value comes from HTTP response, but read using ioutils.ReadAll, hence it contains the complete response. <code>  var str1 stringstr1 = ""26MB string data""byt := []byte(str1)str2 := string(byt) err = json.Unmarshal([]byte(str1), &obj)",How does type conversion internally work? What is the memory utilization for the same?
Golang - global variable private to file," In GOLANG, Is there a way to make a variable's scope local to a file within a package?In my case, there are 2 files ex1.go and ex02.go. ex01.go defines a global variable which is used across functions in that file.In another file ex02.go (which has no relation with ex01.go except that both ex01.go and ex02.go belong to the same class of problems - i.e. concurrency), I can't define a variable for waitGroup as I get an error - ""variable name is re-declared in this block""Is there a way to keep the variable names from spilling over to the other files? <code>  var wg sync.WaitGroup var wg sync.WaitGroup",Global variable private to file
How to parse non standard time format from json in golang?," lets say i have the following json and i want to decode it into the following structure like this which gives me the error parsing time """"1996-10-07"""" as """"2006-01-02T15:04:05Z07:00"""": cannot parse """""" as ""T""if i were to parse it manually i would do it like this but when the time value is from a json string how do i get the decoder to parse it in the above format? <code>  { name: ""John"", birth_date: ""1996-10-07""} type Person struct { Name string `json:""name""` BirthDate time.Time `json:""birth_date""`} person := Person{}decoder := json.NewDecoder(req.Body);if err := decoder.Decode(&person); err != nil { log.Println(err)} t, err := time.Parse(""2006-01-02"", ""1996-10-07"")",How to parse non standard time format from json
Go Assertions package InDelta vs InEpsilon," From documentation:https://godoc.org/github.com/stretchr/testify/assert#InDelta InDelta asserts that the two numerals are within delta of each otherhttps://godoc.org/github.com/stretchr/testify/assert#InEpsilon InEpsilon asserts that expected and actual have a relative error less than epsilonAnd their code seems to be identical in purpose: What is the difference? what are the use cases where one would be used over the other and vice versa? <code>  func InDelta(t TestingT, expected, actual interface{}, delta float64, msgAndArgs ...interface{}) bool { af, aok := toFloat(expected) bf, bok := toFloat(actual) if !aok || !bok { return Fail(t, fmt.Sprintf(""Parameters must be numerical""), msgAndArgs...) } if math.IsNaN(af) { return Fail(t, fmt.Sprintf(""Expected must not be NaN""), msgAndArgs...) } if math.IsNaN(bf) { return Fail(t, fmt.Sprintf(""Expected %v with delta %v, but was NaN"", expected, delta), msgAndArgs...) } dt := af - bf if dt < -delta || dt > delta { return Fail(t, fmt.Sprintf(""Max difference between %v and %v allowed is %v, but difference was %v"", expected, actual, delta, dt), msgAndArgs...) } return true} func calcRelativeError(expected, actual interface{}) (float64, error) { af, aok := toFloat(expected) if !aok { return 0, fmt.Errorf(""expected value %q cannot be converted to float"", expected) } if af == 0 { return 0, fmt.Errorf(""expected value must have a value other than zero to calculate the relative error"") } bf, bok := toFloat(actual) if !bok { return 0, fmt.Errorf(""actual value %q cannot be converted to float"", actual) } return math.Abs(af-bf) / math.Abs(af), nil}// InEpsilon asserts that expected and actual have a relative error less than epsilon//// Returns whether the assertion was successful (true) or not (false).func InEpsilon(t TestingT, expected, actual interface{}, epsilon float64, msgAndArgs ...interface{}) bool { actualEpsilon, err := calcRelativeError(expected, actual) if err != nil { return Fail(t, err.Error(), msgAndArgs...) } if actualEpsilon > epsilon { return Fail(t, fmt.Sprintf(""Relative error is too high: %#v (expected)\n""+ "" < %#v (actual)"", epsilon, actualEpsilon), msgAndArgs...) } return true}",Difference between InDelta and InEpsilon
Go: How to parse only date to time.Time?," I want to parse only date value to time.Time.For example I have date in this format: 2016-03-31, and I want to parse it, like: time.Parse(FORMAT, ""2016-03-31"").But it always fail.What is the correct format string to use to parse only date with this format?I have the code below as example, it is on playground also: https://play.golang.org/p/0MNLr9emZd The output is this: <code>  package mainimport ( ""fmt"" ""time"")var dateToParse = ""2016-03-31""func main() { format := ""2006-12-01"" parseDate(format)}func parseDate(format string) { t, err := time.Parse(format, dateToParse) if err != nil { fmt.Println(""Format:"", format) fmt.Println(err) fmt.Println("""") return } fmt.Println(""Works Format:"", format) fmt.Println(t) fmt.Println("""")} Format: 2006-12-01parsing time ""2016-03-31"" as ""2006-12-01"": cannot parse ""-31"" as ""2""",Go: How to parse only date to time.Time?
How to parse only date to time.Time?," I want to parse only date value to time.Time.For example I have date in this format: 2016-03-31, and I want to parse it, like: time.Parse(FORMAT, ""2016-03-31"").But it always fail.What is the correct format string to use to parse only date with this format?I have the code below as example, it is on playground also: https://play.golang.org/p/0MNLr9emZd The output is this: <code>  package mainimport ( ""fmt"" ""time"")var dateToParse = ""2016-03-31""func main() { format := ""2006-12-01"" parseDate(format)}func parseDate(format string) { t, err := time.Parse(format, dateToParse) if err != nil { fmt.Println(""Format:"", format) fmt.Println(err) fmt.Println("""") return } fmt.Println(""Works Format:"", format) fmt.Println(t) fmt.Println("""")} Format: 2006-12-01parsing time ""2016-03-31"" as ""2006-12-01"": cannot parse ""-31"" as ""2""",Go: How to parse only date to time.Time?
Golang Convert Json string to struct," I have start working in golang, I am trying to parse JSON string to struct but its not working.JSON String: dailies"":[{""userAccessToken"":""acessToken"",""uploadStartTimeInSeconds"":1499744832,""uploadEndTimeInSeconds"":1499744832,""callbackURL"":""callbackurl""}]} Below is code which convert JSON String to structs output is: json object:::: map[dailies:[{ 0 0 }]]Here ""dailies"" dont have data, So do i following right approach to parse and how to get data after parse? <code>  type pingDataFormat struct { userAccessToken string uploadStartTimeInSeconds int uploadEndTimeInSeconds int callbackURL string } pingJSON := make(map[string][]pingDataFormat)err := json.Unmarshal([]byte(pingData), &pingJSON)if err != nil { panic(err)}fmt.Printf(""\n\n json object:::: %v"", pingJSON)",How to convert JSON string to struct
Is there an efficient way to concatenate strings in golang templates," For example, there is a function like that: It runs in the example below: Is there anyway to concatenate strings with operators in template ? or It gives unexpected ""+"" in operand error.I couldnt find it in documentation (https://golang.org/pkg/text/template/)  <code>  func TestFunc(str string) string { return strings.Trim(str,"" "") } {{ $var := printf ""%s%s"" ""x"" ""y"" }} {{ TestFunc $var }} {{ $var := ""y"" }} {{ TestFunc ""x"" + $var }} {{ $var := ""y"" }} {{ TestFunc ""x"" + {$var} }}",Is there an efficient way to concatenate strings
go - how to create a big int with a secure random," I have this code in java and I need to reproduce in Go. Is the only way to generate a nonce for GDS amadeus soap header 4.Thanks <code>  String nonce = new BigInteger(130, new SecureRandom()).toString(32);",How to create a big int with a secure random
Exit on error from goroutines in go," consider this function : In each goroutine, the function work() is called 10 times. If one call to work() returns an error in any of the running goroutines, I want all the goroutines to stop immediately, and the program to exit.Is it ok to use os.Exit() here ? How should I handle this ?Edit: this question is different from how to stop a goroutine as here I need to close all goroutines if an error occurs in one <code>  func doAllWork() error { var wg sync.WaitGroup for i := 0; i < 2; i++ { wg.add(1) go func() { defer wg.Done() for j := 0; j < 10; j++ { result, err := work(j) if err != nil { // can't use `return err` here // what sould I put instead ? os.Exit(0) } } }() } wg.Wait() return nil}",Close multiple goroutine if an error occurs in one in go
"In Go, can I return a struct that meets an interface without access to that interface?"," I think the best way to explain this is by example, so here it is: This prints false. You can run and play with it: https://play.golang.org/p/A_2k_ku_Q2In my real case the struct Hello and the interfaces for Greeter and Greeting are in different packages that do not import each other and I wanted to keep it that way. I'm perhaps missing some understanding of interfaces in Go but after reading so much about it I still can't put my finger on it. Would you guys have any pointers for me? Maybe another approach for the problem? Thanks! <code>  package mainimport ( ""fmt"")// Greeter greets with a Greeting.type Greeter interface { Greet() Greeting}// A Greeting has a string representation.type Greeting interface { String() string}type Hello struct {}// Hello greets by returning itself...func (h *Hello) Greet() *Hello { return h}// ...because Hello also has a string representation.func (h *Hello) String() string { return ""Hello""}// But Go says Hello doesn't implement Greeter.func main() { var g interface{} = &Hello{} g, ok := g.(Greeter) fmt.Println(ok)}",In Go can I return a struct that meets an interface without access to that interface?
Does multiple assignment have order in golang," I know golang supports multiple assignment, for instance, I want to know if the assignment following the left->right order? For instance, if I play with trees: Does it guarantee both parent and child are assigned one level deeper in the tree? <code>  a, b = c, d parent, child = child, child.child",Does multiple assignment have order?
Goglang - Optimize imports," I'm using GoLand IDE to code in Go.When I save a file, I'd like that the unused imports disappear (like VS code)I have enable ""Optimize imports"" in ""Code"" -> ""Show reformat file dialog"". But when I save the file, imports it's still present <code> ",Running 'goimports' on save in GoLand
Running 'goimports' on save in Golangd," I'm using GoLand IDE to code in Go.When I save a file, I'd like that the unused imports disappear (like VS code)I have enable ""Optimize imports"" in ""Code"" -> ""Show reformat file dialog"". But when I save the file, imports it's still present <code> ",Running 'goimports' on save in GoLand
Parse JSON output of curl command using golang," I am trying to get the value of say ""ip"" from my following curl output: I have found many examples in the internet to parse json output of curl requests and I have written the following code, but that doesn't seem to return me the value of say ""ip"" I would appreciate if anyone could provide me hints on what I need to add to my code to get the value of say ""ip"". <code>  { ""type"":""example"", ""data"":{ ""name"":""abc"", ""labels"":{ ""key"":""value"" } }, ""subsets"":[ { ""addresses"":[ { ""ip"":""192.168.103.178"" } ], ""ports"":[ { ""port"":80 } ] } ]} package mainimport (""encoding/json""""fmt""""io/ioutil""""log""""net/http""""time"")type svc struct { Ip string `json:""ip""`}func main() {url := ""http://myurl.com""testClient := http.Client{ Timeout: time.Second * 2, // Maximum of 2 secs}req, err := http.NewRequest(http.MethodGet, url, nil)if err != nil { log.Fatal(err)}res, getErr := testClient.Do(req)if getErr != nil { log.Fatal(getErr)}body, readErr := ioutil.ReadAll(res.Body)if readErr != nil { log.Fatal(readErr)}svc1 := svc{}jsonErr := json.Unmarshal(body, &svc1)if jsonErr != nil { log.Fatal(jsonErr)}fmt.Println(svc1.Ip)}",Parse JSON HTTP response using golang
Is there an efficient way to calculate execution time in golang?," I'm looking for the best way to calculate execution time in go. The code above works fine.But when I use templates, I have to write it again for each template function.Is there an efficient way of calculating execution time, including templates? <code>  func main() { start := time.Now() time.Sleep(time.Second * 2) //something doing here elapsed := time.Since(start) fmt.Printf(""page took %s"", elapsed)}",Is there an efficient way to calculate execution time in Go?
Correctly measure time duration in golang," What is the correct way to precisely measure a time duration in Go?Most application just use the standard time package and the following approach: However, time.Now() returns the current system time, which leads to two flaws:If the system time is changed during the measurement (for example due to a time zone change (DST) or a leap second), the resulting duration is also wrong.The system time can tick deliberately faster or slower than the real time. This always happens when the operating system synchronizes the internal clock with NTP time servers (which might happen several times an hour!)From MSDN: [The time service] adjusts the local clock rate to allow it to converge toward the correct time. If the time difference between the local clock and the [accurate time sample] is too large to correct by adjusting the local clock rate, the time service sets the local clock to the correct time.If the system time changes (either manually or due to DST), it might be possible to detect the invalid duration and discard it. But if the system clock ticks e.g. 10% faster to synchronize with world-time, it is practically impossible to detect. That's intended behaviour and how the system clock is designed.For that reason, most other languages offer a dedicated API for measuring durations:Java has System.nanoTime(), System.currentTimeMillis() would be equivalent to time.Now() and is wrongC# has System.Diagnostics.StopwatchC/C++ on Windows has QueryPerformanceCounter and QueryPerformanceFrequencyC++11 and up have std::chrono::steady_clock, or std::chrono::high_resolution_clock when its is_steady member constant is trueJavaScript has performance.now(), while the use of new Date() is wrongWhat is the correct way to precisely measure execution time in Go? <code>  var startTime = time.Now()doSomeHardWork()var duration = time.Since(startTime) // or: time.Now() - startTime",Correctly measure time duration in Go
How can I customize Golang http 400 responses for parse errors?," I've written a REST API service that requires that all responses be JSON. However, when the Go HTTP request parser encounters an error, it returns 400 as a plain text response without ever calling my handlers. Example: Note the invalid Authorization header. Of course 400 is the proper response, but it's text/plain, of course. Is there some way to configure the Go http parser to use custom error response media types and bodies? <code>  > curl -i -H 'Authorization: Basic hi there' 'http://localhost:8080/test' -v* Trying ::1...* TCP_NODELAY set* Connected to localhost (::1) port 8080 (#0)> GET /test HTTP/1.1> Host: localhost:8080> User-Agent: curl/7.54.0> Accept: */*> Authorization: Basic hi> there> < HTTP/1.1 400 Bad RequestHTTP/1.1 400 Bad Request< Content-Type: text/plain; charset=utf-8Content-Type: text/plain; charset=utf-8< Connection: closeConnection: close< * Closing connection 0",How can I customize HTTP 400 responses for parse errors?
Can I somehow get all the constants in a Go class, Here is an example: The use case for this is to create a Finite State Machine (FSM). Being able to get all constants will help me in writing a test case that will ensure that every new value has a corresponding entry in the FSM map. <code>  package maintype State intconst ( Created State = iota Modified Deleted)func main() { // Some code here where I need the list // of all available constants of this type.},How to get all constants of a type in Go
Golang Converting a custom type to string?," In this bizarre example, someone has created a new type which is really just a string: However, this code fails to compile: cannot use Foobar (type CustomType) as type string in return argumentHow would you fix SomeFunction so that it is able to return the string value of Foobar (""somestring"") ? <code>  type CustomType stringconst ( Foobar CustomType = ""somestring"")func SomeFunction() string { return Foobar}",Converting a custom type to string in Go
Golang 1.8.3: Get full paths of all files in a directory," I am using Go to iterate over all the files in a directory. This is how I am doing it: When I run this code, this is the output I get: I can see a property named path, but I can't access it (due to small case initial, I suppose?). Can anyone please tell me how to get full file path of all the files in a given folder? <code>  package mainimport ( ""fmt"" ""io/ioutil"")func main() { printFiles(""."")}func printFiles(dir string) { fileInfos, err := ioutil.ReadDir(dir) if err != nil { fmt.Println(""Error in accessing directory:"", err) } for _, file := range fileInfos { fmt.Printf(""%T: %+v\n"", file, file) }} *os.fileStat: &{name:main.go sys:{FileAttributes:32 CreationTime:{LowDateTime:2993982878 HighDateTime:30613689} LastAccessTime:{LowDateTime:2993982878 HighDateTime:30613689} LastWriteTime:{LowDateTime:4004986069 HighDateTime:30613714} FileSizeHigh:0 FileSizeLow:320} pipe:false Mutex:{state:0 sema:0} path:C:\Users\Prakhar.Mishra\go\src\mistdatafilter\main.go vol:0 idxhi:0 idxlo:0}",How do you get full paths of all files in a directory in Go?
Golang JSON unmarshal integer field into a string," I am struggling with deserializing a integer into a string struct field.The struct field is a string and is expected to be assignable from users of my library. That's why I want it to be a string, since for the purpose of writing it to the database I actually don't care about the value inside.The users can supply text, but some just assign integers.Consider this struct: Sometimes I end up with a JSON value that is valid but won't deserialize into the struct due to the Foo field being a integer instead of a string: json.Unmarshal will blow up with the following error:json: cannot unmarshal number into Go struct field test.Foo of type string See the reproduction: https://play.golang.org/p/4Qau3umaVmNow in every other JSON library (in other languages) I have worked in so far, if the target field is a string and you get a integer the deserializer will usually just wrap the int in a string and be done with it. Can this be achieved in Go?Since I can't really control how the data comes in I need to make json.Unmarshal unsensitive to this - the other solution would be to define Foo as interface{} which needlessly complicates my code with type assertions etc..Any ideas on how to do this? I basically need the inverse of json:"",string"" <code>  type Test struct { Foo string} { ""foo"": ""1"" } // works{ ""foo"": 1 } // doesn't",JSON unmarshal integer field into a string
Dictionary in golang," I'm just starting out with Go, and coming from Python I'm trying to find the equivalent of a dict in Python. In Python I would do this: I first found the map type, but that only allows for one type of value (it can't handle both ints and strings. Do I really need to create a struct whenever I want to do something like this? Or is there a type I'm missing? <code>  d = { 'name': 'Kramer', # string 'age': 25 # int}",Dictionary in Go
Why do the goroutines not scale?," BackgroundI am currently working on my bachelor thesis and basically my task is to optimise a given code in Go, i.e. make it run as fast as possible. First, I optimised the serial function and then tried to introduce parallelism via goroutines. After researching on the internet I now understand the difference between concurrency and parallelism thanks to the following slides from talks.golang. I visited some parallel programming courses where we parallelised a c/c++ code with help of pthread/openmp, thus I tried to apply these paradigms in Go. That said, in this particular case I am optimising a function which computes the moving average of a slice with length len:=n+(window_size-1) (it equals either 9393 or 10175), hence we have n windows of which we compute the corresponding arithmetic average and save that properly in the output slice.Note that this task is inherently embarrassing parallel.My optimisation attempts and resultsIn moving_avg_concurrent2 I split up the slice into num_goroutines smaller pieces and ran each with one goroutine. This function performed with one goroutine, out of some reason (could not find out why yet, but we are getting tangent here), better than moving_avg_serial4 but with more than one goroutine it started to perform worse than moving_avg_serial4.In moving_avg_concurrent3 I adopted the master/worker paradigm. The performance was worse than moving_avg_serial4 when using one goroutine. Here we at least I got a better performance when increasing num_goroutines but still not better than moving_avg_serial4.To compare the performances of moving_avg_serial4, moving_avg_concurrent2 and moving_avg_concurrent3 I wrote a benchmark and I tabulated the results: QuestionSince as mentioned above this problem is embarrassingly parallel I was expecting to see a tremendous performance increase but that was not the case.Why does moving_avg_concurrent2 not scale at all?And why is moving_avg_concurrent3 that much slower than moving_avg_serial4?I know that goroutines are cheap but still are not free, but is it possible that this generates that much overhead such that we are even slower than moving_avg_serial4?CodeFunctions: Benchmarks: Remarks:This is my very first post, I am still learning, so any constructive criticism is also welcome. <code>  fct & num_goroutines | timing in ns/op | percentage --------------------------------------------------------------------- serial4 | 4357893 | 100.00% concur2_1 | 5174818 | 118.75% concur2_4 | 9986386 | 229.16% concur2_8 | 18973443 | 435.38% concur2_32 | 75602438 | 1734.84% concur3_1 | 32423150 | 744.01% concur3_4 | 21083897 | 483.81% concur3_8 | 16427430 | 376.96% concur3_32 | 15157314 | 347.81% // returns a slice containing the moving average of the input (given, i.e. not optimised)func moving_avg_serial(input []float64, window_size int) []float64 { first_time := true var output = make([]float64, len(input)) if len(input) > 0 { var buffer = make([]float64, window_size) // initialise buffer with NaN for i := range buffer { buffer[i] = math.NaN() } for i, val := range input { old_val := buffer[int((math.Mod(float64(i), float64(window_size))))] buffer[int((math.Mod(float64(i), float64(window_size))))] = val if !NaN_in_slice(buffer) && first_time { sum := 0.0 for _, entry := range buffer { sum += entry } output[i] = sum / float64(window_size) first_time = false } else if i > 0 && !math.IsNaN(output[i-1]) && !NaN_in_slice(buffer) { output[i] = output[i-1] + (val-old_val)/float64(window_size) // solution without loop } else { output[i] = math.NaN() } } } else { // empty input fmt.Println(""moving_avg is panicking!"") panic(fmt.Sprintf(""%v"", input)) } return output}// returns a slice containing the moving average of the input// reordering the control structures to exploid the short-circuit evaluationfunc moving_avg_serial4(input []float64, window_size int) []float64 { first_time := true var output = make([]float64, len(input)) if len(input) > 0 { var buffer = make([]float64, window_size) // initialise buffer with NaN for i := range buffer { buffer[i] = math.NaN() } for i := range input { // fmt.Printf(""in mvg_avg4: i=%v\n"", i) old_val := buffer[int((math.Mod(float64(i), float64(window_size))))] buffer[int((math.Mod(float64(i), float64(window_size))))] = input[i] if first_time && !NaN_in_slice(buffer) { sum := 0.0 for j := range buffer { sum += buffer[j] } output[i] = sum / float64(window_size) first_time = false } else if i > 0 && !math.IsNaN(output[i-1]) /* && !NaN_in_slice(buffer)*/ { output[i] = output[i-1] + (input[i]-old_val)/float64(window_size) // solution without loop } else { output[i] = math.NaN() } } } else { // empty input fmt.Println(""moving_avg is panicking!"") panic(fmt.Sprintf(""%v"", input)) } return output}// returns a slice containing the moving average of the input// splitting up slice into smaller pieces for the goroutines but without using the serial version, i.e. we only have NaN's in the beginning, thus hope to reduce some overhead// still does not scale (decreasing performance with increasing size and num_goroutines)func moving_avg_concurrent2(input []float64, window_size, num_goroutines int) []float64 { var output = make([]float64, window_size-1, len(input)) for i := 0; i < window_size-1; i++ { output[i] = math.NaN() } if len(input) > 0 { num_items := len(input) - (window_size - 1) var barrier_wg sync.WaitGroup n := num_items / num_goroutines go_avg := make([][]float64, num_goroutines) for i := 0; i < num_goroutines; i++ { go_avg[i] = make([]float64, 0, num_goroutines) } for i := 0; i < num_goroutines; i++ { barrier_wg.Add(1) go func(go_id int) { defer barrier_wg.Done() // computing boundaries var start, stop int start = go_id*int(n) + (window_size - 1) // starting index // ending index if go_id != (num_goroutines - 1) { stop = start + n // Ending index } else { stop = num_items + (window_size - 1) // Ending index } loc_avg := moving_avg_serial4(input[start-(window_size-1):stop], window_size) loc_avg = make([]float64, stop-start) current_sum := 0.0 for i := start - (window_size - 1); i < start+1; i++ { current_sum += input[i] } loc_avg[0] = current_sum / float64(window_size) idx := 1 for i := start + 1; i < stop; i++ { loc_avg[idx] = loc_avg[idx-1] + (input[i]-input[i-(window_size)])/float64(window_size) idx++ } go_avg[go_id] = append(go_avg[go_id], loc_avg...) }(i) } barrier_wg.Wait() for i := 0; i < num_goroutines; i++ { output = append(output, go_avg[i]...) } } else { // empty input fmt.Println(""moving_avg is panicking!"") panic(fmt.Sprintf(""%v"", input)) } return output}// returns a slice containing the moving average of the input// change of paradigm, we opt for a master worker pattern and spawn all windows which each will be computed by a goroutinefunc compute_window_avg(input, output []float64, start, end int) { sum := 0.0 size := end - start for _, val := range input[start:end] { sum += val } output[end-1] = sum / float64(size)}func moving_avg_concurrent3(input []float64, window_size, num_goroutines int) []float64 { var output = make([]float64, window_size-1, len(input)) for i := 0; i < window_size-1; i++ { output[i] = math.NaN() } if len(input) > 0 { num_windows := len(input) - (window_size - 1) var output = make([]float64, len(input)) for i := 0; i < window_size-1; i++ { output[i] = math.NaN() } pending := make(chan *Work) done := make(chan *Work) // creating work go func() { for i := 0; i < num_windows; i++ { pending <- NewWork(compute_window_avg, input, output, i, i+window_size) } }() // start goroutines which work through pending till there is nothing left for i := 0; i < num_goroutines; i++ { go func() { Worker(pending, done) }() } // wait till every work is done for i := 0; i < num_windows; i++ { <-done } return output } else { // empty input fmt.Println(""moving_avg is panicking!"") panic(fmt.Sprintf(""%v"", input)) } return output} //############### BENCHMARKS ###############var import_data_res11 []float64func benchmarkMoving_avg_serial(b *testing.B, window int) { var r []float64 for n := 0; n < b.N; n++ { r = moving_avg_serial(BackTest_res.F[""Trading DrawDowns""], window) } import_data_res11 = r}var import_data_res14 []float64func benchmarkMoving_avg_serial4(b *testing.B, window int) { var r []float64 for n := 0; n < b.N; n++ { r = moving_avg_serial4(BackTest_res.F[""Trading DrawDowns""], window) } import_data_res14 = r}var import_data_res16 []float64func benchmarkMoving_avg_concurrent2(b *testing.B, window, num_goroutines int) { var r []float64 for n := 0; n < b.N; n++ { r = moving_avg_concurrent2(BackTest_res.F[""Trading DrawDowns""], window, num_goroutines) } import_data_res16 = r}var import_data_res17 []float64func benchmarkMoving_avg_concurrent3(b *testing.B, window, num_goroutines int) { var r []float64 for n := 0; n < b.N; n++ { r = moving_avg_concurrent3(BackTest_res.F[""Trading DrawDowns""], window, num_goroutines) } import_data_res17 = r}func BenchmarkMoving_avg_serial_261x10(b *testing.B) { benchmarkMoving_avg_serial(b, 261*10)}func BenchmarkMoving_avg_serial4_261x10(b *testing.B) { benchmarkMoving_avg_serial4(b, 261*10)}func BenchmarkMoving_avg_concurrent2_261x10_1(b *testing.B) { benchmarkMoving_avg_concurrent2(b, 261*10, 1)}func BenchmarkMoving_avg_concurrent2_261x10_8(b *testing.B) { benchmarkMoving_avg_concurrent2(b, 261*10, 8)}func BenchmarkMoving_avg_concurrent3_261x10_1(b *testing.B) { benchmarkMoving_avg_concurrent3(b, 261*10, 1)}func BenchmarkMoving_avg_concurrent3_261x10_8(b *testing.B) { benchmarkMoving_avg_concurrent3(b, 261*10, 8)}//############### BENCHMARKS end ###############",Why do these goroutines not scale their performance from more concurrent executions?
force priority of go select statement," I have the following piece of code: This function is executed in a dedicated go-routine and sends a heartbeat-message every second. The whole process should stop immediately when the context is canceled.Now consider the following scenario: This starts the heartbeat-routine with a closed context. In such a case, I don't want any heartbeats to be transmitted. So the first case block in the select should be entered immediately.However, it seems that the order in which case blocks are evaluated is not guaranteed, and that the code sometimes sends a heartbeat message, even though the context is already canceled. What is the correct way to implement such a behaviour? I could add a ""isContextclosed""-check in the second case, but that looks more like an ugly workaround for the problem. <code>  func sendRegularHeartbeats(ctx context.Context) { for { select { case <-ctx.Done(): return case <-time.After(1 * time.Second): sendHeartbeat() } }} ctx, cancel := context.WithCancel(context.Background())cancel()go sendRegularHeartbeats(ctx)",Force priority of go select statement
GO: Get all the headers of http response and send it back in next http request," Go version: go1.8.1 windows/amd64Sample code for HTTP request is: I will call the RoundTripSoap12 function on the corresponding HTTP client.When I send a request for the first time I will be getting some headers in the HTTP response, so these HTTP response headers should be sent as-is in my next HTTP request. <code>  func (c *Client) RoundTripSoap12(action string, in, out Message) error { fmt.Println(""****************************************************************"") headerFunc := func(r *http.Request) { r.Header.Add(""Content-Type"", fmt.Sprintf(""text/xml; charset=utf-8"")) r.Header.Add(""SOAPAction"", fmt.Sprintf(action)) r.Cookies() } return doRoundTrip(c, headerFunc, in, out)}func doRoundTrip(c *Client, setHeaders func(*http.Request), in, out Message) error { req := &Envelope{ EnvelopeAttr: c.Envelope, NSAttr: c.Namespace, Header: c.Header, Body: Body{Message: in}, } if req.EnvelopeAttr == """" { req.EnvelopeAttr = ""http://schemas.xmlsoap.org/soap/envelope/"" } if req.NSAttr == """" { req.NSAttr = c.URL } var b bytes.Buffer err := xml.NewEncoder(&b).Encode(req) if err != nil { return err } cli := c.Config if cli == nil { cli = http.DefaultClient } r, err := http.NewRequest(""POST"", c.URL, &b) if err != nil { return err } setHeaders(r) if c.Pre != nil { c.Pre(r) } fmt.Println(""*************"", r) resp, err := cli.Do(r) if err != nil { fmt.Println(""error occured is as follows "", err) return err } fmt.Println(""response headers are: "", resp.Header.Get(""sprequestguid"")) defer resp.Body.Close() if resp.StatusCode != http.StatusOK { // read only the first Mb of the body in error case limReader := io.LimitReader(resp.Body, 1024*1024) body, _ := ioutil.ReadAll(limReader) return fmt.Errorf(""%q: %q"", resp.Status, body) } return xml.NewDecoder(resp.Body).Decode(out)",Get all the headers of HTTP response and send it back in next HTTP request
Get all the headers of http response and send it back in next http request," Go version: go1.8.1 windows/amd64Sample code for HTTP request is: I will call the RoundTripSoap12 function on the corresponding HTTP client.When I send a request for the first time I will be getting some headers in the HTTP response, so these HTTP response headers should be sent as-is in my next HTTP request. <code>  func (c *Client) RoundTripSoap12(action string, in, out Message) error { fmt.Println(""****************************************************************"") headerFunc := func(r *http.Request) { r.Header.Add(""Content-Type"", fmt.Sprintf(""text/xml; charset=utf-8"")) r.Header.Add(""SOAPAction"", fmt.Sprintf(action)) r.Cookies() } return doRoundTrip(c, headerFunc, in, out)}func doRoundTrip(c *Client, setHeaders func(*http.Request), in, out Message) error { req := &Envelope{ EnvelopeAttr: c.Envelope, NSAttr: c.Namespace, Header: c.Header, Body: Body{Message: in}, } if req.EnvelopeAttr == """" { req.EnvelopeAttr = ""http://schemas.xmlsoap.org/soap/envelope/"" } if req.NSAttr == """" { req.NSAttr = c.URL } var b bytes.Buffer err := xml.NewEncoder(&b).Encode(req) if err != nil { return err } cli := c.Config if cli == nil { cli = http.DefaultClient } r, err := http.NewRequest(""POST"", c.URL, &b) if err != nil { return err } setHeaders(r) if c.Pre != nil { c.Pre(r) } fmt.Println(""*************"", r) resp, err := cli.Do(r) if err != nil { fmt.Println(""error occured is as follows "", err) return err } fmt.Println(""response headers are: "", resp.Header.Get(""sprequestguid"")) defer resp.Body.Close() if resp.StatusCode != http.StatusOK { // read only the first Mb of the body in error case limReader := io.LimitReader(resp.Body, 1024*1024) body, _ := ioutil.ReadAll(limReader) return fmt.Errorf(""%q: %q"", resp.Status, body) } return xml.NewDecoder(resp.Body).Decode(out)",Get all the headers of HTTP response and send it back in next HTTP request
Golang import path best practise," I am currently working on a private project using Golang (and I am new to it).But I have the problem that I don't know what is the proper way to define the import path for local packages.I have the same feeling as the author from this link https://medium.com/@c9s/golang-the-annoying-remote-import-path-c6c7e76517e5 In short, if I host a project foo in Github. I feel strange to use github.com/levin/foo as import path instead of just foo. Wouldn't it cause much rework if I move my codes to Bitbucket or I host my own git server in AWS? And worse, I can rewrite my code to change the import path, but how would people using my code in theirs notify the change of repo? And I feel no sense to ask others to update their codes.I am new to Golang so feel free to say something like ""your question is not even valid"". <code> ",Golang import path best practice
What is the simplest way to expand a slice to its' capacity?," I have a program that uses a buffer pool to reduce allocations in a few performance-sensitive sections of the code.Something like this: play link I always allocate fixed length slices, which are guaranteed to be larger than the maximum size needed. I need to reduce size to the actual data length to use the buffer, but I also need it to be the maximum size again to read into it the next time I need it.The only way I know of to expand a slice is with append, so that is what I am using. The loop feels super dirty though. And potentially inefficient. My benchmarks show it isn't horrible, but I feel like there has to be a better way.I know only a bit about the internal representation of slices, but if I could only somehow override the length value without actually adding data, it would be really nice. I don't really need to zero it out or anything.Is there a better way to accomplish this? <code>  // some file or any data sourcevar r io.Reader = bytes.NewReader([]byte{1,2,3})// initialize slice to max expected capacitydat := make([]byte, 20)// read some data into it. Trim to length.n, err := r.Read(dat)handle(err)dat = dat[:n]// now I want to reuse it: for len(dat) < cap(dat) { dat = append(dat, 0) }log.Println(len(dat))// add it to free list for reuse later// bufferPool.Put(dat)",What is the simplest way to expand a slice to its capacity?
PNG encoding with Go is really slow," I'm acquiring frames from my built in webcam with go-opencv. The time it takes to acquire an image from the camera is ~50ms. The time to encode the PNG is ~300ms. Encoding a JPEG is 3x faster, but still horribly slow.Why is this running so slowly?Note:I've written similar code against NodeJS, executed on the same machine, and have absolutely no problem hitting 30fps w/ additional image processing. For me, this removes hardware issues from the equation.My code looks like this: <code>  import ( ""fmt"" ""image/png"" ""github.com/lazywei/go-opencv/opencv"")camera := opencv.NewCameraCapture(0)if camera == nil { panic(""Unable to open camera."")}defer camera.Release()for { if camera.GrabFrame() { img := camera.RetrieveFrame(1) if img != nil { frame := img.ToImage() buffer := new(bytes.Buffer) png.Encode(buffer, frame) } else { fmt.Println(""Unable to capture frame"") } }}",PNG encoding with Go is slow
How do I fix an infinite loop Golang," I'm making a program in Go for guessing a random number. I'm having issues with a for loop. I can't stop the for loop from continuously iterating.How do i break out of the loop once a condition is satisfied.  <code>  for loop == true {//fmt.Println(""read number"", i, ""/n"")if i == ans { fmt.Println(""well done"")}if i != ans { fmt.Println(""Nope"") fmt.Scan(i)}",How do I break out of an infinite loop in Golang
How do I break out of an infinite loop Golang," I'm making a program in Go for guessing a random number. I'm having issues with a for loop. I can't stop the for loop from continuously iterating.How do i break out of the loop once a condition is satisfied.  <code>  for loop == true {//fmt.Println(""read number"", i, ""/n"")if i == ans { fmt.Println(""well done"")}if i != ans { fmt.Println(""Nope"") fmt.Scan(i)}",How do I break out of an infinite loop in Golang
Is Golang atomic.LoadUint32 necessary?," Go's atomic package provides function func LoadUint32(addr *uint32) (val uint32). I looked into the assembly implementation: which basically load the value from the memory address and return it.I'm wondering if we have a uint32 pointer(addr) x, what is the difference between calling atomic.LoadUint32(x) and directly access it using *x? <code>  TEXT LoadUint32(SB),NOSPLIT,$0-12MOVQ addr+0(FP), AXMOVL 0(AX), AXMOVL AX, val+8(FP)RET",Is atomic.LoadUint32 necessary?
Google Speech - Streaming Request Returns EOF," Using Go, I'm taking a RTMP stream, transcoding it to FLAC (using ffmpeg) and attempting to stream to Google's Speech API to transcribe the audio. However, I keep getting EOF errors when sending the data. I can't find any information on this error in the docs so I'm not exactly sure what's causing it.I'm chunking the received data into 3s clips (length isn't relevant as long as it's less than the maximum length of a streaming recognition request).Here is the core of my code: Running this code gives this output: Notice that not all of the Sends fail. Could anyone point me in the right direction here? Is it something to do with the FLAC headers or something? I also wonder if maybe resetting the buffer causes some of the data to be dropped (i.e. it's a non-trivial operation that actually takes some time to complete) and it doesn't like this missing information?Any help would be really appreciated.  <code>  func main() { done := make(chan os.Signal) received := make(chan []byte) go receive(received) go transcribe(received) signal.Notify(done, os.Interrupt, syscall.SIGTERM) select { case <-done: os.Exit(0) }}func receive(received chan<- []byte) { var b bytes.Buffer stdout := bufio.NewWriter(&b) cmd := exec.Command(""ffmpeg"", ""-i"", ""rtmp://127.0.0.1:1935/live/key"", ""-f"", ""flac"", ""-ar"", ""16000"", ""-"") cmd.Stdout = stdout if err := cmd.Start(); err != nil { log.Fatal(err) } duration, _ := time.ParseDuration(""3s"") ticker := time.NewTicker(duration) for { select { case <-ticker.C: stdout.Flush() log.Printf(""Received %d bytes"", b.Len()) received <- b.Bytes() b.Reset() } }}func transcribe(received <-chan []byte) { ctx := context.TODO() client, err := speech.NewClient(ctx) if err != nil { log.Fatal(err) } stream, err := client.StreamingRecognize(ctx) if err != nil { log.Fatal(err) } // Send the initial configuration message. if err = stream.Send(&speechpb.StreamingRecognizeRequest{ StreamingRequest: &speechpb.StreamingRecognizeRequest_StreamingConfig{ StreamingConfig: &speechpb.StreamingRecognitionConfig{ Config: &speechpb.RecognitionConfig{ Encoding: speechpb.RecognitionConfig_FLAC, LanguageCode: ""en-GB"", SampleRateHertz: 16000, }, }, }, }); err != nil { log.Fatal(err) } for { select { case data := <-received: if len(data) > 0 { log.Printf(""Sending %d bytes"", len(data)) if err := stream.Send(&speechpb.StreamingRecognizeRequest{ StreamingRequest: &speechpb.StreamingRecognizeRequest_AudioContent{ AudioContent: data, }, }); err != nil { log.Printf(""Could not send audio: %v"", err) } } } }} 2017/10/09 16:05:00 Received 191704 bytes2017/10/09 16:05:00 Saving 191704 bytes2017/10/09 16:05:00 Sending 191704 bytes2017/10/09 16:05:00 Could not send audio: EOF2017/10/09 16:05:03 Received 193192 bytes2017/10/09 16:05:03 Saving 193192 bytes2017/10/09 16:05:03 Sending 193192 bytes2017/10/09 16:05:03 Could not send audio: EOF2017/10/09 16:05:06 Received 193188 bytes2017/10/09 16:05:06 Saving 193188 bytes2017/10/09 16:05:06 Sending 193188 bytes // Notice that this doesn't error2017/10/09 16:05:09 Received 191704 bytes2017/10/09 16:05:09 Saving 191704 bytes2017/10/09 16:05:09 Sending 191704 bytes2017/10/09 16:05:09 Could not send audio: EOF",Google Speech - Streaming Request Returns EOF Error
exported field in unexported struct in golang," Example: myType is not exported, but Name field in it is exported.Does this make sense to do this? Is that considered a bad practice?I have something like this, and it compiles fine.I can access the Name field if I create an exported array of myType: <code>  type myType struct { foo []float64 Name string} var MyArray []myType = {... some initialization }fmt.Println(MyArray[0].Name) // Name is visible and it compiles",exported field in unexported struct
Quicker way to deepcopy objects in golang," I am using go 1.9. And I want to deepcopy value of object into another object. I try to do it with encoding/gob and encoding/json. But it takes more time for gob encoding than json encoding. I see some other questions like this and they suggest that gob encoding should be quicker. But I see exact opposite behaviour. Can someone tell me if I am doing something wrong? Or any better and quicker way to deepcopy than these two? My object's struct is complex and nested.The test code: I get following output: <code>  package mainimport ( ""bytes"" ""encoding/gob"" ""encoding/json"" ""log"" ""time"" ""strconv"")// Test ...type Test struct { Prop1 int Prop2 string}// Clone deep-copies a to bfunc Clone(a, b interface{}) { buff := new(bytes.Buffer) enc := gob.NewEncoder(buff) dec := gob.NewDecoder(buff) enc.Encode(a) dec.Decode(b)}// DeepCopy deepcopies a to b using json marshalingfunc DeepCopy(a, b interface{}) { byt, _ := json.Marshal(a) json.Unmarshal(byt, b)}func main() { i := 0 tClone := time.Duration(0) tCopy := time.Duration(0) end := 3000 for { if i == end { break } r := Test{Prop1: i, Prop2: strconv.Itoa(i)} var rNew Test t0 := time.Now() Clone(r, &rNew) t2 := time.Now().Sub(t0) tClone += t2 r2 := Test{Prop1: i, Prop2: strconv.Itoa(i)} var rNew2 Test t0 = time.Now() DeepCopy(&r2, &rNew2) t2 = time.Now().Sub(t0) tCopy += t2 i++ } log.Printf(""Total items %+v, Clone avg. %+v, DeepCopy avg. %+v, Total Difference %+v\n"", i, tClone/3000, tCopy/3000, (tClone - tCopy))} Total items 3000, Clone avg. 30.883s, DeepCopy avg. 6.747s, Total Difference 72.409084ms","Quicker way to deepcopy objects in golang, JSON vs gob"
send smpt email to multiple receivers," I am using this to send smtp. It works for one receiver but I'd like to have multiple receivers. I have tried the following: I have also tried: and: None of them work. Sorry it is so simple, I just begin to work with golang. <code>  func sendemail(body string) { from := ""smtpemail"" pass := ""pass"" to := ""a@gmail.com,b@gmail.com"" ....} to := ""\""a@gmail.com\"",\""b@gmail.com\"""" to := []string{""a@gmail.com"",""b@gmail.com""}",send smtp email to multiple receivers
making dynamic queries in golang and mysql," I've never used golang with mysql before, so I'm reading about these for the first time. I'd like to do something like this: This is far too much typing, especially if I have a dozen more variables I'd like to add to the WHERE condition.If this were PHP, I'd do something like this: By using a foreach loop, I can dynamically generate queries and dynamically bind as many variables as needed. Is something like this an option with golang and mysql? Or are there alternatives to not typing out every single variable combination for a query? <code>  if userId && gender && agedb.QueryRow(""SELECT name FROM users WHERE userId=? AND gender=? AND age=?"", userId,gender,age)else if gender && agedb.QueryRow(""SELECT name FROM users WHERE gender=? AND age=?"", gender, age)else if userId && genderdb.QueryRow(""SELECT name FROM users WHERE userId=? AND gender=?"", userId,gender)else if userId && agedb.QueryRow(""SELECT name FROM users WHERE userId=? AND age=?"", userId, age)else if genderdb.QueryRow(""SELECT name FROM users WHERE gender=?"", gender)else if userIddb.QueryRow(""SELECT name FROM users WHERE userId=?"", userId)else if agedb.QueryRow(""SELECT name FROM users WHERE age=?"", age) $sql = ""SELECT name FROM users "";$where = array();foreach(explode("","",""userId,gender,age,name,height,weight,ethnicity"" as $field){ if(isset($arrayOfValues[$field])) { $where[count($where)] = $field."" = ?"".$field $db->bind(""?"".$field,$arrayOfValues[$field]); }}if(count($where)>0)$sql = $sql . "" WHERE "".implode("" AND "",$where);$db->query($sql);",Making dynamic SQL queries to a MySQL DB
Go : 'use of internal package not allowed ' when running a Go project forked from a github repository," I'm getting used to Go, and trying to understand how it works.So I'm trying to run the test code from my repository zoonoo/go-ethereum, forked from the original repository ethereum/go-ethereum.When I run go test . under the eth directory, I get the following error : 37th line of eth/api.go is as follows : ""github.com/ethereum/go-ethereum/internal/ethapi""Does this mean when you fork a go repository, you have to change the path of all dependencies within the code to run the code?Does Go package system support repository fork at all? <code>  eth/api.go:37:2: use of internal package not allowed",Go : 'use of internal package not allowed ' when running a Go project forked from a GitHub repository
How do I append to a slice field in a struct using reflection?," I have a struct that looks like this: I have an environment variable that looks like the following, and I'm using reflection to fill the struct based on the keys. I'm able to set the string, int64, bool and float32 fields using reflection, but I'm stuck on how to append to the slice field Styles. For example, based on the above jimiEnvvar I would like the field jimi.Styles to have the values [""blues"",""rock"", ""psychedelic""].I have the following (simplified) code: EDIT:A second part (which I solved) was filling a map in the struct. For example: Where jimiEnvvar looks like: I wrote in this manner: If you're interested the full code is at https://github.com/soniah/reflect/blob/master/structs.go. Code is just some notes/exercises I'm writing.EDIT2:Chapter 11 of ""Go in Practice"" (Butcher and Farina) has detailed explanations of reflection, structs and tags. <code>  type guitaristT struct { Surname string `required=true` Year int64 `required=false` American bool // example of missing tag Rating float32 `required=true` Styles []string `required=true,minsize=1`} jimiEnvvar :=""surname=Hendrix|year=1942|american=true|rating=9.99 |styles=blues|styles=rock|styles=psychedelic"" result := guitaristT{}// result.Styles = make([]string, 10) // XXX causes 10 empty strings at startresult.Styles = make([]string, 0) // EDIT: Alessandro's solution...v := reflect.ValueOf(&result).Elem()...field := v.FieldByName(key) // eg key = ""styles""...switch field.Kind() {case reflect.Slice: // this is where I get stuck // // reflect.Append() has signature: // func Append(s Value, x ...Value) Value // so I convert my value to a reflect.Value stringValue := reflect.ValueOf(value) // eg value = ""blues"" // field = reflect.Append(field, stringValue) // XXX doesn't append field.Set(reflect.Append(field, stringValue)) // EDIT: Alessandro's solution type guitaristT struct { ... Styles []string `required=true,minsize=1` Cities map[string]int} jimiEnvvar += ""|cities=New York^17|cities=Los Angeles^14"" case reflect.Map: fmt.Println(""keyAsString"", keyAsString, ""is Map, has value:"", valueAsString) mapKV := strings.Split(valueAsString, ""^"") if len(mapKV) != 2 { log.Fatalln(""malformed map key/value:"", mapKV) } mapK := mapKV[0] mapV := mapKV[1] thisMap := fieldAsValue.Interface().(map[string]int) thisMap[mapK] = atoi(mapV) thisMapAsValue := reflect.ValueOf(thisMap) fieldAsValue.Set(thisMapAsValue) The final result was:main.guitaristT{ Surname: ""Hendrix"", Year: 1942, American: true, Rating: 9.989999771118164, Styles: {""blues"", ""rock"", ""psychedelic""}, Cities: {""London"":11, ""Bay Area"":9, ""New York"":17, ""Los Angeles"":14},}",Append to a slice field in a struct using reflection
Which of coroutines (goroutines and kotlin coroutines) are more faster?," Kotlin corutines is sugar for finite state machine and some task runner (for example, default ForkJoinPool). https://github.com/Kotlin/kotlin-coroutines/blob/master/kotlin-coroutines-informal.md#implementation-details In other words, there is no runtime coroutines in java/kotlin runtime yet (but this can change with http://cr.openjdk.java.net/~rpressler/loom/Loom-Proposal.html ). Kotlin coroutine is just sequential of tasks, which are executed one by one. Each task can be executed in any thread from thread pool.Go runtime supports ""coroutines"". But goroutines is not the real coroutines. Goroutines does not allow to set yield points in program. Also, Go does not allow to set custom thread pool. You can to set only size of threads in default pool. First difference between kotlin coroutines and goroutines is Go runtime manages which coroutine is running at this moment. When goroutine are blocked at some IO operation (or synchronization primitives), Go choices next Job to execute it. In JVM there is no intellectual job switching in such terms. Because of this, Go can cheaply change currently running job. Go has only to change few registries https://groups.google.com/forum/#!msg/golang-nuts/j51G7ieoKh4/wxNaKkFEfvcJ. But some people say, that JVM can use stack of threads instead of using registers. So there is no saving and loading of registers at all.The second difference between kotlin coroutines and goroutines is type of coroutines. Kotlin coroutines is stackless coroutines. Goroutines are stackful coroutines. All state of Kotlin coroutines are stored in Kotlin context, which is stored in heap. Goroutines state is stored in registers and thread stack.I want to know, which coroutines (goroutines and kotlin coroutines) are faster in IO bound tasks? CPU bound tasks? What about memory consumption? <code> ",Which of coroutines (goroutines and kotlin coroutines) are faster?
"What is the difference between backtick (``) & double quote ("""") in golang?"," What is the difference between backticks (``) & double quotes ("""") in golang? <code> ","What is the difference between backticks (``) & double quotes ("""") in golang?"
"What is the difference between backtick (``) & double quote ("""")?"," What is the difference between backticks (``) & double quotes ("""") in golang? <code> ","What is the difference between backticks (``) & double quotes ("""") in golang?"
How to get the mySQL error type in golang?," I'm really confused how to get the error type from a failed query line with the MySQL import. There is no real documentation on it, so it has me real confused.I have: I could print err but its just a string, not liking the idea of peeking at strings to know what went wrong, is there no feedback to get an error code to perform a switch on or something along those lines? How do you do it? <code>  result, err := db.Exec(""INSERT INTO users (username,password,email) VALUES (?,?,?)"", username, hashedPassword, email)if err != nil { // handle different types of errors here return}",How to determine the error type from MySQL
Call Rust Function From Go With Slice as Parameter," I want to call some external functions written in Rust from Go with a reference to a slice.I have the following Rust code: This function is made available for the cgo compiler through this C-style header file: I can now call this function from Go with the Rust crate compiled as a cdylib: The Go code uses the unsafe pointer trick to access the backing array, since a slice is defined as follows When I execute the code above, the length of the passed reference is incredibly large. How do I access the actual data, and what is at this moment being returned? <code>  extern crate libc;#[no_mangle]pub extern ""C"" fn callme(data: &mut [libc::c_double]) -> i32 { data.len() as i32} #IFNDEF BOGUSLIB_H#DEFINE BOGUSLIB_Hextern int callme(double* data); #ENDIF //#cgo CFLAGS: -Ipath/to/libfolder//#cgo LDFLAGS: -Lpath/to/libfolder -lboguslib//#include <boguslib.h>import ""C""import ( ""unsafe"" . ""fmt"" )func CallmeExternal() { data := make([]float64, 1, 1) data[0] = 1.0 ptr := (*C.double)(unsafe.Pointer(&data[0])) size := C.callme(ptr) printf(""size %v"",size)} type Slice struct { data *byte uint32 len uint32 cap}",How can I call a Rust function from Go with a slice as a parameter?
Is it possible to get filename of the executed file in Golang," I was able to get the full path of the current directory, Now I would like to create a function that will read or get the filename where the code is executed. I am able to get the filename but it is return the original filename where the code is written : What I want to do is getting the current fileName where the code is executed like :I created app.go : and then when I call getCurrentFileName() in a different file like hello.go in a different location. it will return hello.go.I have been stuck here for a while and looking for an answer. <code>  func GetFileName() string { _, fpath, _, ok := runtime.Caller(0) if !ok { err := errors.New(""failed to get filename"") panic(err) } filename := filepath.Base(fpath) // remove extension filename = removeExtension(filename) return filename + "".log""} package myfunction getCurrentFileName() string { // some code here that will return the filename where this code is executed.}",Is it possible to get filename where code is called in Golang?
Golang ignore Json fields when marshalling not unmarshalling," Assume I have a password field in a User struct. My clients register their users by posting username and password together. So if I decode JSON to above struct, it ignores password. It's expected. But I wondered is there any way to ignore fields when only marshalling. I checked go official documentation page but couldn't find anything. https://golang.org/pkg/encoding/json/I can add an extra field into the struct but I need to know first is it possible to do that with JSON lib. <code>  type User struct{ UserName string `json:""username""` Password string `json:""-""`}",How to ignore JSON fields when marshalling not unmarshalling
Golang: parse json string to struct," I have struct of Request, value is optional: And function that should parse json string to struct^ For some reason data.Operation is empty. What is wrong here? <code>  type Request struct { Operation string `json:""operation""` Key string `json:""key""` Value string `json:""value""`} go func() { s := string(""{'operation': 'get', 'key': 'example'}"") data := Request{} json.Unmarshal([]byte(s), data) log.Printf(""Operation: %s"", data.Operation)}",How to parse JSON string to struct
Is it best-practise to commit `vendor` directory?, I am using dep to handle my Go dependencies. Is it best practice to also commit the vendor directory into version control? Or is best practice to always execute dep ensure after checking out a repository? <code> ,Is it best-practice to commit the `vendor` directory?
Golang: **Type pointer," In tutorial is written: The type *T is a pointer to a T value. The & operator generates a pointer to its operand.I am just playing around with pointers in Go and have following: So if I got it correctly, &p is a pointer to a pointer to an int value.What is use of **Type in the Go language? <code>  example := 42p:=&examplefmt.Println(reflect.TypeOf(&p)) // **intfmt.Println(reflect.TypeOf(*p)) // int",Go: **Type pointer
Golang: immutable string and pointer address," In Go spec is written: Strings are immutable: once created, it is impossible to change the contents of a string.I have following code: I would have expected &str address was changed after *ptr = ""world"". As it would happen with Java, where we reassign String references. What is 'immutability' here?  <code>  str := ""hello""fmt.Printf(""%p\n"",&str) // 0x1040c128fmt.Printf(""%v\n"",str) // helloptr := &str*ptr = ""world""fmt.Printf(""%p\n"",&str) // 0x1040c128fmt.Printf(""%v\n"",str) // world ",Immutable string and pointer address
"golang: ""merge"" fields two structs of same type"," Looking at this struct: Now I have a DefaultConfig intialized with some values and one loaded from a file, let's say FileConfig.I want both structs to me merged, so that I get a Config with the content of both structs. FileConfig should override anything set in DefaultConfig, while FileConfig may not have all fields set.(Why this? Because a potential user may not know the default value, so removing that entry would be equivalent to setting the default - I think)I thought I'd need reflection for this: Here I am not sure:If reflection is needed at allThere may be easier ways to do thisAnother issue I see here is that checking for zero values may be tricky: what if the overriding struct intends to override with a zero value? Luckily, I don't think it applies to my case - but this becomes a function, it may become a problem later <code>  type Config struct { path string id string key string addr string size uint64} func merge(default *Config, file *Config) (*Config) { b := reflect.ValueOf(default).Elem() o := reflect.ValueOf(file).Elem() for i := 0; i < b.NumField(); i++ { defaultField := b.Field(i) fileField := o.Field(i) if defaultField.Interface() != reflect.Zero(fileField.Type()).Interface() { defaultField.Set(reflect.ValueOf(fileField.Interface())) } } return default }","""Merge"" fields two structs of same type"
"Go: ""merge"" fields two structs of same type"," Looking at this struct: Now I have a DefaultConfig intialized with some values and one loaded from a file, let's say FileConfig.I want both structs to me merged, so that I get a Config with the content of both structs. FileConfig should override anything set in DefaultConfig, while FileConfig may not have all fields set.(Why this? Because a potential user may not know the default value, so removing that entry would be equivalent to setting the default - I think)I thought I'd need reflection for this: Here I am not sure:If reflection is needed at allThere may be easier ways to do thisAnother issue I see here is that checking for zero values may be tricky: what if the overriding struct intends to override with a zero value? Luckily, I don't think it applies to my case - but this becomes a function, it may become a problem later <code>  type Config struct { path string id string key string addr string size uint64} func merge(default *Config, file *Config) (*Config) { b := reflect.ValueOf(default).Elem() o := reflect.ValueOf(file).Elem() for i := 0; i < b.NumField(); i++ { defaultField := b.Field(i) fileField := o.Field(i) if defaultField.Interface() != reflect.Zero(fileField.Type()).Interface() { defaultField.Set(reflect.ValueOf(fileField.Interface())) } } return default }","""Merge"" fields two structs of same type"
golang gorilla mux cors / Angular 5," This is my first post.I've just started learning Go and Angular and I'm attempting to connect the angular app to a go api. I've written both and am stuck identifying the root of the problem. I thought it was a CORS problem, but it works fine if I don't include the headers line of code in my Angular http request. At this point I'm just trying to add the header. The authorization code isn't implemented yet.Both apps are running locally with the Go app on port 5000 and Angular on 4200Angular http request that doesn't work: Angular http request that works: I'm getting this error: Response to preflight request doesn't pass access control check: No 'Access-Control-Allow-Origin' header is present on the requested resource. Origin 'http://localhost:4200' is therefore not allowed access. The response had HTTP status code 403I'm using the gorilla/mux and gorilla/handlers in my go code Headers from Chrome Dev Tools <code>  this.http.get<ProjectedBalance>(requestUrl, {headers: new HttpHeaders().set('Authorization', 'my-auth-token')}) .subscribe(data => { this.projBalance = data.projBalance; } this.http.get<ProjectedBalance>(requestUrl) .subscribe(data => { this.projBalance = data.projBalance; } router := mux.NewRouter()router.HandleFunc(""/home/{endDate}"", GetProjBalance).Methods(""GET"", ""OPTIONS"")headersOk := handlers.AllowedHeaders([]string{""X-Requested-With, Content-Type, Authorization""})originsOk := handlers.AllowedOrigins([]string{""*""})methodsOk := handlers.AllowedMethods([]string{""GET"", ""HEAD"", ""POST"", ""PUT"", ""OPTIONS""})//start server on portlog.Fatal(http.ListenAndServe("":5000"", handlers.CORS(originsOk, headersOk, methodsOk)(router))) Request URL:http://localhost:5000/home/2020-12-21Request Method:OPTIONSStatus Code:403 ForbiddenRemote Address:[::1]:5000Referrer Policy:no-referrer-when-downgradeResponse Headersview sourceContent-Length:0Content-Type:text/plain; charset=utf-8Date:Mon, 20 Nov 2017 21:39:43 GMTRequest Headersview sourceAccept:*/*Accept-Encoding:gzip, deflate, brAccept-Language:en-US,en;q=0.9,uz;q=0.8Access-Control-Request-Headers:authorizationAccess-Control-Request-Method:GETConnection:keep-aliveHost:localhost:5000Origin:http://localhost:4200",How to add Authorization Header to Angular http request?
bufio.Reader and bufio.Scanner funtionality and performance," I had seen several blurbs on the interwebs which had loosely talked about why one should use bufio.Scanner instead of bufio.Reader. I don't know if my test case is relevant, but I decided to test one vs the other when it comes to reading 1,000,000 lines from a text file: A pretty average output I receive on the timings looks like this: I am curious, when is it better to use a reader vs. a scanner, and is it based on performance, or functionality? <code>  package mainimport ( ""fmt"" ""strconv"" ""bufio"" ""time"" ""os"" //""bytes"")func main() { fileName := ""testfile.txt"" // Create 1,000,000 integers as strings numItems := 1000000 startInitStringArray := time.Now() var input [1000000]string //var input []string for i:=0; i < numItems; i++ { input[i] = strconv.Itoa(i) //input = append(input,strconv.Itoa(i)) } elapsedInitStringArray := time.Since(startInitStringArray) fmt.Printf(""Took %s to populate string array.\n"", elapsedInitStringArray) // Write to a file fo, _ := os.Create(fileName) for i:=0; i < numItems; i++ { fo.WriteString(input[i] + ""\n"") } fo.Close() // Use reader openedFile, _ := os.Open(fileName) startReader := time.Now() reader := bufio.NewReader(openedFile) for i:=0; i < numItems; i++ { reader.ReadLine() } elapsedReader := time.Since(startReader) fmt.Printf(""Took %s to read file using reader.\n"", elapsedReader) openedFile.Close() // Use scanner openedFile, _ = os.Open(fileName) startScanner := time.Now() scanner := bufio.NewScanner(openedFile) for i:=0; i < numItems; i++ { scanner.Scan() scanner.Text() } elapsedScanner := time.Since(startScanner) fmt.Printf(""Took %s to read file using scanner.\n"", elapsedScanner) openedFile.Close()} Took 44.1165ms to populate string array.Took 17.0465ms to read file using reader.Took 23.0613ms to read file using scanner.",bufio.Reader and bufio.Scanner functionality and performance
Golang - use same headers for every request," I want to be able to use the same headers for every request made by an HTTP client without having to specify them for every request like so: Is there a way to configure this on the client? <code>  req, err := http.NewRequest(""GET"", fmt.Sprintf(""https://%s"", endpoint), nil)if err != nil { log.Printf(""Error making request to endpoint: %+v"", err) return p, err}req.Header.Add(""Authorization"", ""Bearer"")req.Header.Add(""Version"", ""2017-11-23"") resp, err := client.Do(req)",Use same headers for every request
Use of defer in golang, What is the use of defer in Go? The language documentation says it is executed when the surrounding function returns. Why not just put the code at end of given function? <code> ,Use of defer in Go
golang: How the select worked when multiple channel involved?," I found when using select on multiple non buffered channels like Even when both channels have data, but when processing this select,the call that falls in case chana and case chanb is not balanced. Run this demo, when one of the chana,chanb finished read/write, the other may remain 999-1 left.Is there any method to ensure the balance?found related topicgolang-channels-select-statement <code>  select {case <- chana:case <- chanb:} package mainimport ( ""fmt"" _ ""net/http/pprof"" ""sync"" ""time"")func main() { chana := make(chan int) chanb := make(chan int) go func() { for i := 0; i < 1000; i++ { chana <- 100 * i } }() go func() { for i := 0; i < 1000; i++ { chanb <- i } }() time.Sleep(time.Microsecond * 300) acount := 0 bcount := 0 wg := sync.WaitGroup{} wg.Add(1) go func() { for { select { case <-chana: acount++ case <-chanb: bcount++ } if acount == 1000 || bcount == 1000 { fmt.Println(""finish one acount, bcount"", acount, bcount) break } } wg.Done() }() wg.Wait()}",How does select work when multiple channels are involved?
Iterate only the first n itens of an array at a Go Template," I have a vector with n elements. I'm using it to render items in a template. But I need to render only the 5 first elements. Please note that is possible to have less than 5 elements in vector, in this case will render all elements. Is there is a way to do it in template? <code>  {{range .Categorias}} <li class=""nav-item""> {{.Nome}} </li>{{end}}",Iterate over only the first n items of an array in a Go template
Golang map containing both string and ints," I am trying to create a JSON string from a map using JSON.Marshal() in golang. However, the int values are being displayed as strings surrounded by double quotes.My code is outputting: instead of I am using: My understanding is that JSON.Marshal() will print the integers correctly if they are supplied but my map won't contain integers. I could change my map to map[string]map[string]int{} but then it wouldn't contain the string values for 'name' and 'location'.The ultimate problem is that I need the map to contain both int and string values. Some sort of map[string]map[string]{}.How can I achieve this? Thank you in advance.Harry <code>  { ""age"": { ""$gt"":""22"", ""$lt"":""20"" }, ""location"": { ""$eq"":""london"" }, ""name"":{ ""$eq"":""fred"" }} { ""age"": { ""$gt"":22, ""$lt"":20 }, ""location"": { ""$eq"":""london"" }, ""name"":{ ""$eq"":""fred"" }} var output_map = map[string]map[string]string{}//Populate map hereoutput_json, err := json.Marshal(output_map)if err!= nil { fmt.Println(""Error encoding JSON"")}fmt.Println(output_json)",Golang map containing both string and integer
Golang: How to reuse a single Postgres DB connection for row inserts in Go?," I'm trying to use Go to insert a row of data into a Postgres table for each new message received from rabbitmq, using a single connection to the DB which is opened in the init function of the code below.Rather than opening just one connection, the code opens 497 and maxes out which causes the row inserts to stop...I have tried using the info in these questions opening and closing DB connection in Go app and open database connection inside a function which say I should open one connection and use global db to allow the main function to pass the sql statement to the connection opened in the init function.I thought I had done this, however a new connection is being opened for each new row so the code stops working once the postgres connection limit is reached...I am new to Go and have limited programming experience, I have been trying to understand/resolve this issue for the past two days and I could really do with some help understanding where I am going wrong with this... Full code is shown below: <code>  var db *sql.DBfunc init() { var err error db, err = sql.Open ( ""postgres"", ""postgres://postgres:postgres@SERVER/PORT/DB"") if err != nil { log.Fatal(""Invalid DB config:"", err) } if err = db.Ping(); err != nil { log.Fatal(""DB unreachable:"", err) }}func main() {// RABBITMQ CONNECTION CODE IS HERE// EACH MESSAGE RECEIVED IS SPLIT TO LEGEND, STATUS, TIMESTAMP VARIABLES// VARIABLES ARE PASSED TO sqlSatement sqlStatement := ` INSERT INTO heartbeat (""Legend"", ""Status"", ""TimeStamp"") VALUES ($1, $2, $3)` // sqlStatement IS THEN PASSED TO db.QueryRow db.QueryRow(sqlStatement, Legend, Status, TimeStamp) }}()<-forever} package mainimport ( ""database/sql"" ""log"" _ ""github.com/lib/pq"" ""github.com/streadway/amqp"" ""strings"")var db *sql.DBfunc failOnError(err error, msg string) { if err != nil { log.Fatalf(""%s: %s"", msg, err) }}func init() { var err error db, err = sql.Open ( ""postgres"", ""postgres://postgres:postgres@192.168.1.69:5432/test?sslmode=disable"") if err != nil { log.Fatal(""Invalid DB config:"", err) } if err = db.Ping(); err != nil { log.Fatal(""DB unreachable:"", err) }}func main() { conn, err := amqp.Dial(""amqp://Admin:Admin@192.168.1.69:50003/"") failOnError(err, ""Failed to connect to RabbitMQ"") defer conn.Close() ch, err := conn.Channel() failOnError(err, ""Failed to open a channel"") defer ch.Close() q, err := ch.QueueDeclare( ""HEARTBEAT"", // name false, // durable false, // delete when unused false, // exclusive false, // no-wait nil, // arguments ) failOnError(err, ""Failed to declare a queue"") msgs, err := ch.Consume( q.Name, // queue """", // consumer false, // auto-ack false, // exclusive false, // no-local false, // no-wait nil, // args ) failOnError(err, ""Failed to register a consumer"") forever := make(chan bool) go func() { for d := range msgs { myString := string(d.Body[:]) result := strings.Split(myString, "","") Legend := result[0] Status := result[1] TimeStamp := result[2] sqlStatement := ` INSERT INTO heartbeat (""Legend"", ""Status"", ""TimeStamp"") VALUES ($1, $2, $3) ` // db.QueryRow(sqlStatement, Legend, Status, TimeStamp) } }() <-forever}",How to reuse a single Postgres DB connection for row inserts in Go?
Go project with cmd and pkg layout - build error," I'm trying to build a Go project using the layout as described in Go Project LayoutI'm using go 1.9.2 on Ubuntu. My project layout is as follows The file cmd/cleanprops/main.go is referring to the cleanprops package i.e. The contents of internal/pkg/readprops.go are: However when I build cmd/cleanprops/main.go, from inside directory $GOPATH/src/github.com/ayubmalik/cleanprops, using command: I get the following error: What am I missing? <code>  $GOPATH/src/github.com/ayubmalik/cleanprops /cmd /cleanprops /main.go /internal /pkg /readprops.go package mainimport ( ""fmt"" ""github.com/ayubmalik/cleanprops"")func main() { body := cleanprops.ReadProps(""/tmp/hello.props"") fmt.Println(""%s"", body)} package cleanpropsimport ( ""fmt"" ""io/ioutil"")func check(e error) { if e != nil { panic(e) }}func ReadProps(file string) string { body, err := ioutil.ReadFile(file) check(err) fmt.Println(string(body)) return body} go build cmd/cleanprops/main.go cmd/cleanprops/main.go:5:2: no Go files in /home/xyz/go/src/github.com/ayubmalik/cleanprops",Go build project with cmd and pkg layout - build error
goland how to use gofmt?," I started learning golang and installed GoLand from JetBrains. I am reading the book The Go Programming Language, and in the first chapter author strongly recommends using the gofmt tool before each save. How I can follow this recommendation in GoLand? <code> ",goland how to use gofmt?
golang how to use gofmt?," I started learning golang and installed GoLand from JetBrains. I am reading the book The Go Programming Language, and in the first chapter author strongly recommends using the gofmt tool before each save. How I can follow this recommendation in GoLand? <code> ",goland how to use gofmt?
Go: how to use gofmt?," I started learning golang and installed GoLand from JetBrains. I am reading the book The Go Programming Language, and in the first chapter author strongly recommends using the gofmt tool before each save. How I can follow this recommendation in GoLand? <code> ",goland how to use gofmt?
Go project structure - best practise," I need to create GO project (first time) for production, I searched on web for best practices and found the followinghttps://github.com/golang-standards/project-layoutFor this I've two main questions.I see that most of go projects logic is inside the main function, but in case I need some utils folder with files there, where should I put it ?I don't want that the main function will be mass of 500 or more lines of code In our company the projects should be build like following Our company project build as above structure i.e. the project files is under the src folder, is it right? (can we have issue in the future with this structure type).I was able to compile this project in our landscape but since everything is under src I'm not sure. <code>  myproj |-src |-cmd | |-main.go |-utils |-vendor",Go project structure - Best practice
Go project structure - Best practise," I need to create GO project (first time) for production, I searched on web for best practices and found the followinghttps://github.com/golang-standards/project-layoutFor this I've two main questions.I see that most of go projects logic is inside the main function, but in case I need some utils folder with files there, where should I put it ?I don't want that the main function will be mass of 500 or more lines of code In our company the projects should be build like following Our company project build as above structure i.e. the project files is under the src folder, is it right? (can we have issue in the future with this structure type).I was able to compile this project in our landscape but since everything is under src I'm not sure. <code>  myproj |-src |-cmd | |-main.go |-utils |-vendor",Go project structure - Best practice
Golang equivalent to System.Diagnostics.Debugger.IsAttached, In C# the executing program can detect if it's running in the debugger using: Is there an equivalent in Go? I have some timeouts which I would like to be disabled while I am stepping through the code. Thanks!I am using the GoLand debugger. <code>  System.Diagnostics.Debugger.IsAttached,How can I see if the GoLand debugger is running in the program?
golang: panic: http: multiple registrations for /debug/requests," I vendored two projects in my go project. And I successfully compiled my project. When I ran my project, it reported error ""panic: http: multiple registrations for /debug/requests"". The detailed errors is shown below. Does anyone have any idea on how to fix it? I guess it's because the two projects I imported both listen on /debug/requests? <code>  goroutine 1 [running]:net/http.(*ServeMux).Handle(0x19ae000, 0x126bb20, 0xf, 0x1964540, 0x1297d90)/usr/local/go/src/net/http/server.go:2270 +0x627net/http.(*ServeMux).HandleFunc(0x19ae000, 0x126bb20, 0xf, 0x1297d90)/usr/local/go/src/net/http/server.go:2302 +0x55net/http.HandleFunc(0x126bb20, 0xf, 0x1297d90)/usr/local/go/src/net/http/server.go:2314 +0x4bgithub.own.com/chalex/testfabric/vendor/github.com/hyperledger/fabric-sdk-go/vendor/golang.org/x/net/trace.init.0()/home/chalex/ibm/src/github.own.com/chalex/testfabric/vendor/github.com/hyperledger/fabric-sdk-go/vendor/golang.org/x/net/trace/trace.go:115 +0x42github.own.com/chalex/testfabric/vendor/github.com/hyperledger/fabric-sdk-go/vendor/golang.org/x/net/trace.init()<autogenerated>:1 +0x1cdgithub.own.com/chalex/testfabric/vendor/github.com/hyperledger/fabric-sdk-go/vendor/google.golang.org/grpc.init()<autogenerated>:1 +0x82github.own.com/chalex/testfabric/vendor/github.com/hyperledger/fabric-sdk-go/third_party/github.com/hyperledger/fabric/protos/peer.init()<autogenerated>:1 +0x6fgithub.own.com/chalex/testfabric/vendor/github.com/hyperledger/fabric-sdk-go/api/apitxn.init()<autogenerated>:1 +0x44github.own.com/chalex/testfabric/chaincode/client.init()<autogenerated>:1 +0x49main.init()",panic: http: multiple registrations for /debug/requests
android: get the process id of foreground app," First of all, please note that this question is not same as all the ""android foreground app"" questions I found on SO, please read on :-)I'm trying to write an android app for my own use, using golang, without using android-sdk or ndk (this is the KEY point). It is pretty simple, just use golang to write a http service, compile it for arm CPU and voila my app is running and can be access by simply visit http://localhost.For the purpose of my app, I need to know the currently running foreground application, to define it precisely:Foreground application is the application that occupies the screen, or has an ""activity"" what-so-ever (forgive me I'm not an android developer).Anything that that is depended by the foreground application (e.g. services) is NOT what I am interested in.If the phone is LOCKED/screen turned off, I want the solution to tell me there is NO foreground app.And since I do not use anything android, just treat the phone as a LINUX machine, I want the solution to use native LINUX ways, e.g. by inspect /proc, or by calling any installed android command line tool (including sending messages via these command line tools), but NOT using any SDK/NDK way so that I have to use java or incorporate these thing into my app. <code> ",Android: How to get the process id of the foreground app
get the process id of the foreground app," First of all, please note that this question is not same as all the ""android foreground app"" questions I found on SO, please read on :-)I'm trying to write an android app for my own use, using golang, without using android-sdk or ndk (this is the KEY point). It is pretty simple, just use golang to write a http service, compile it for arm CPU and voila my app is running and can be access by simply visit http://localhost.For the purpose of my app, I need to know the currently running foreground application, to define it precisely:Foreground application is the application that occupies the screen, or has an ""activity"" what-so-ever (forgive me I'm not an android developer).Anything that that is depended by the foreground application (e.g. services) is NOT what I am interested in.If the phone is LOCKED/screen turned off, I want the solution to tell me there is NO foreground app.And since I do not use anything android, just treat the phone as a LINUX machine, I want the solution to use native LINUX ways, e.g. by inspect /proc, or by calling any installed android command line tool (including sending messages via these command line tools), but NOT using any SDK/NDK way so that I have to use java or incorporate these thing into my app. <code> ",Android: How to get the process id of the foreground app
Android : How to get the process id of the foreground app," First of all, please note that this question is not same as all the ""android foreground app"" questions I found on SO, please read on :-)I'm trying to write an android app for my own use, using golang, without using android-sdk or ndk (this is the KEY point). It is pretty simple, just use golang to write a http service, compile it for arm CPU and voila my app is running and can be access by simply visit http://localhost.For the purpose of my app, I need to know the currently running foreground application, to define it precisely:Foreground application is the application that occupies the screen, or has an ""activity"" what-so-ever (forgive me I'm not an android developer).Anything that that is depended by the foreground application (e.g. services) is NOT what I am interested in.If the phone is LOCKED/screen turned off, I want the solution to tell me there is NO foreground app.And since I do not use anything android, just treat the phone as a LINUX machine, I want the solution to use native LINUX ways, e.g. by inspect /proc, or by calling any installed android command line tool (including sending messages via these command line tools), but NOT using any SDK/NDK way so that I have to use java or incorporate these thing into my app. <code> ",Android: How to get the process id of the foreground app
Go & gRPC: Integrating gorm.Model fields into protobuf definitions," I am trying to figure out how to integrate the gorm.Model fields (deleted_at, create_at, id, etc) into my proto3 definitions. However, I can't a datetime type for proto3. I tried looking for documentation on how to serialize the gorm fields to strings (since proto3 handles strings) but I have not found anything. Has anyone been able to successfully use the gorm model fields in their proto definitions? I'm using go-micro's plugin to generate *pb.go files.Here's my current message definition which doesn't work. It seems like empty strings are being stored in the database for deleted_at since when querying for deleted_at is null the postgres database returns nothing. UPDATE: I've updated my proto def to the following but gorm still isn't properly using the Id, CreatedAt, UpdatedAt, and DeletedAt fields <code>  message DatabaseConfig { string address = 1; int32 port = 2; string databaseName = 3; string username = 4; string password = 5; string databaseType = 6; string quertStatement = 7; int32 id = 8; string createdAt = 9; string updatedAt = 10; string deletedAt = 11;} syntax = ""proto3"";package go.micro.srv.importer;import ""google/protobuf/timestamp.proto"";import ""github.com/gogo/protobuf/gogoproto/gogo.proto"";service ImporterService { rpc CreateDatabaseConfig(DatabaseConfig) returns (Response) {} rpc RetrieveDatabaseConfig(GetRequest) returns (Response) {} rpc UpdateDatabaseConfig(DatabaseConfig) returns (Response) {} rpc DeleteDatabaseConfig(DatabaseConfig) returns (Response) {}}message GetRequest {}message DatabaseConfig { string address = 1; int32 port = 2; string databaseName = 3; string username = 4; string password = 5; string databaseType = 6; string quertStatement = 7; int32 id = 8; google.protobuf.Timestamp createdAt = 9 [(gogoproto.stdtime) = true]; google.protobuf.Timestamp updatedAt = 10 [(gogoproto.stdtime) = true]; google.protobuf.Timestamp deletedAt = 11 [(gogoproto.stdtime) = true];}message Response { bool created = 1; DatabaseConfig database_config = 2; repeated DatabaseConfig databaseConfigs = 3;}",Integrating gorm.Model fields into protobuf definitions
Using bitsets in golang," I am new to Golang and would like to model physical devices for measuring quantities such as light intensity, mass, electric current and so forth. So as a starting point I will define a device struct as follows: I am a confused now on how to express the device's capabilities (what it can measure) and the units of measurement. For example I would like to express that a physical device can measure electrical currents in amperes. However, I also want to express that a PhysicalDevice can measure more than one quantity. For example it could measure electrical current and temperature.The PhysicalDevice's capabilities are not known in advance and can contain an arbitrary combination of capabilities.I was thinking of using something equivalent to a C++ bitset for expressing the physical quantities a device can measure (would this be the right approach in the first place?). I did not find the Go bitset type and not sure how to express that. I also need to map the measured physical quantity to a corresponding unit.  <code>  const ( // Light can be measured in the form of luminosity Light = 1<< iota Mass ElectricalCurrent )type PhysicalDevice struct{ Owner string ID string Description string}",Using bitsets in golang to represent capabilities
How to unmarshal into durations?, What is the idiomatic way to unmarshal into time.Duration in Go? How can I make use of time.ParseDuration? <code> ,How to unmarshal JSON into durations?
Golang Address of Slices of Empty Structs," I have a basic question on empty structs and am trying to get my head around the following different outputs I am getting when attempting to get the address of backing arrays' elements for two slices: The above snippet returns: However, considering the following slightly changed snippet: The above snippet returns: Can someone please explain the reason for the above difference? Thank you![Follow Up] Making the following modifications: Still returns the same output: Though, uncommenting the method calls, returns: <code>  a := make([]struct{}, 10)b := make([]struct{}, 20)fmt.Println(""&a == &b"", &a == &b)fmt.Println(""&a[0] == &b[0]"", &a[0] == &b[0]) &a == &b false&a[0] == &b[0] true a := make([]struct{}, 10)b := make([]struct{}, 20)fmt.Println(a[0], &a[0])fmt.Println(""&a == &b"", &a == &b)fmt.Println(""&a[0] == &b[0]"", &a[0] == &b[0]) {} &{}&a == &b false&a[0] == &b[0] false package mainimport ""fmt""type S struct{}func (s *S) addr() { fmt.Printf(""%p\n"", s) }func main() { a := make([]S, 10) b := make([]S, 20) fmt.Println(a[0], &a[0]) fmt.Println(""&a == &b"", &a == &b) fmt.Println(""&a[0] == &b[0]"", &a[0] == &b[0]) //a[0].addr() //b[0].addr()} {} &{}&a == &b false&a[0] == &b[0] false {} &{}&a == &b false&a[0] == &b[0] true0x19583c // ==> [depends upon env]0x19583c // ==> [depends upon env]",Addresses of slices of empty structs
Golang remove files with wildcard," I am trying to delete files with a wildcard like shell scripts like:c:\del 123_*My trial as below was failed. I guess I need to use some library to use a wildcard.What is good practice for deleting files with a wildcard? <code>  os.RemoveAll(""/foo/123_*"")os.Remove(""/foo/123_*"")",Remove files with wildcard
Getting TTFB (time to first byte) value using Curl in golang," I am trying to get value TTFB and Connect value It prints a sting like However, I need only the value of TTFB , Connect, Total time value in golang variable.Also, Is there any way I can get the values without specifically using curl? <code>  c := exec.Command( ""curl"", ""-w"", ""Connect: %{time_connect} TTFB: %{time_starttransfer} Total time: %{time_total}"", ""-o"", ""/dev/null"", ""http://my.domain/favicon.ico"") cID, err := c.Run() fmt.Printf(""%s"", cID) Connect: 0.205 TTFB: 0.353 Total time: 0.354",Getting TTFB (time to first byte) value in golang
Go: testing and mocking a function which does not return any value," I want to test a function, which does not return any value, but instead triggers other functions. While reading about testing, I found information that this is called a behavioral verification and that by mocking I can check what functions and in what order are triggered. However, I have a problem to implement the proper mocking technique for my code. Let's consider a simple example of the following interface and struct (the example is very basic just to make it easier to explain): Now, I want to test function DoSomething. Since it does not return any value what I want to do is to test whether after calling this function with argument 3 the following chain of events happens: function DoEvenMore is called once with argument 6, and next function AndEvenMore is called once with argument 9I wrote the following mocking test: However, when I run this test I get the error: Unexpected call to *mocks.MockExampleInterface.DoSomething(..). How I should properly perform the mocking in such example? <code>  type ExampleInterface interface { DoSomething(arg int) DoEvenMore(arg int) AndEvenMore(arg int)} type ExampleStruct struct { Id string // Other fields}func (e *ExampleStruct) DoSomething(arg int) { arg2 := arg * 2 e.DoEvenMore(arg2) arg3 := arg * 3 e.AndEvenMore(arg3) }func (e *ExampleStruct) DoEvenMore(arg int){ fmt.Println(""I did so many operations here using "", arg)}func (e *ExampleStruct) AndEvenMore(arg int) { // Performing other operations on arg} func TestDoSomething(t *testing.T) { mockCtrl := gomock.NewController(t) defer mockCtrl.Finish() mockClient := mocks.NewMockExampleInterface(mockCtrl) example := ExampleStruct(""ExampleId"") gomock.InOrder( mockClient.EXPECT().DoSomething(3).Return().Times(1) mockClient.EXPECT().DoEvenMore(6).Return().Times(1) mockClient.EXPECT().AndEvenMore(9).Return().Times(1) ) example.DoSomething(3)}",Testing and mocking a function which does not return any value
(Golang) Elegant way to check if multiple strings are empty," How can I check if multiple strings are empty in an elegant way? This is how I currently do it: <code>  //if one required field is empty, close the connection if (registerRequest.Email == """") || (registerRequest.PhoneNumber == """")|| (registerRequest.NachName =="""") || (registerRequest.VorName =="""") || (registerRequest.Password =="""") || (registerRequest.VerificationId ==""""){ //Could not proceed w.WriteHeader(UNABLE_TO_PROCEED) w.Write([]byte(""Unable to register account."")) return }",Elegant way to check if multiple strings are empty
Using inheritance of builders in golang," I need to create builder (base) and specific builders for each build type. .The main functionality will be like following:File:Builder.gointerface File: nodebuilder.go Main assumptions/process:To start build on each module I need to get the path to itI need to copy the module to a temp folderI need to run the build on it (implement the build interface like mvn build npm install etc) After build was finished zip the module with depCopy it to new target folderNote: beside from the build and the path (that should be handled specifically ) all other functionality are identicallike zip copy Where should I put the the zip and copy (in the structure) and for example how should I implement them and path them to the builder ? Should I structure the project differently according the assumptions?  <code>  e.g.builder for html projectbuilder for node.js projectbuilder for python projectbuilder for java project type Builder interface { Build(string) error} //This is the struct ???? not sure what to put here...type Node struct {}func (n Node) Build(path string) error {//e.g. Run npm install which build's nodejs projects command := exec.Command(""npm"", ""install"") command.Dir = ../path2dir/ Combined, err := command.CombinedOutput() if err != nil { log.Println(err) } log.Printf(""%s"", Combined) } ... //return new(error)}",Using inheritance of builders in GO
Why is Golang http.ResposnseWriter execution being delayed?," I am trying to send a page response as soon as request is received, then process something, but I found the response does not get sent out ""first"" even though it is first in code sequence.In real life I have a page for uploading a excel sheet which gets saved into the database which takes time (50,0000+ rows) and would like to update to user progress. Here is a simplified example; (depending how much RAM you have you may need to add a couple zeros to counter to see result) <code>  package mainimport ( ""fmt"" ""net/http"")func writeAndCount(w http.ResponseWriter, r *http.Request) { w.Write([]byte(""Starting to count"")) for i := 0; i < 1000000; i++ { if i%1000 == 0 { fmt.Println(i) } } w.Write([]byte(""Finished counting""))}func main() { http.HandleFunc(""/"", writeAndCount) http.ListenAndServe("":8080"", nil)}",Why is Golang http.ResponseWriter execution being delayed?
"What is a Kubernetes go-client ""clientset""?"," In the kubernetes go client, what is a clientset?It is defined in multiple places. In the client-go package. https://github.com/kubernetes/client-go/blob/62b2cb756b8cea8fba00764ff123993eb44dbd48/kubernetes/clientset.go#L120In the kubernetes package https://github.com/kubernetes/kubernetes/blob/80e344644e2b6222296f2f03551a8d0273c7cbce/pkg/client/clientset_generated/internalclientset/clientset.go#L64The documentation says the same thing for both of them: Clientset contains the clients for groups. Each group has exactly one version included in a Clientset.This is confusing. What is a group? <code> ","What is a Kubernetes client-go ""clientset""?"
golang function definition in another package," I am reading this post about time.startTimer declaration and definition. From the answer, time.startTimer is declared in src/time/sleep.goas follows: And its definition is in src/runtime/time.go as follows: So it seems that you can declare a function in one .go file and implement it in another .go file. I tried the same way, for example, declare a function in a.go and implement it in b.go, but it always failed when go run a.go. Is that the correct way to do so? How can I declare a function that is implemented in another .go file? There is no import in either sleep.go or time.go. How does Go do it?Thanks <code>  func startTimer(*runtimeTimer) func startTimer(t *timer) { if raceenabled { racerelease(unsafe.Pointer(t)) } addtimer(t)}",Go function definition in another package
How to declare multidimensional array of two different datatype," I have List of Tuple in python as you see below: how can i convert data into GO equivalent, I have googled it but everywhere they have specified with the same data-type of multidimensional array like this, help me out..!Updated:for Mixed-type Collections of Array: <code>  data = [ (435347,'cat'), (435347,'feline'), (435347,'lion'), (6765756,'dog'), (6765756,'hound'), (6765756,'puppy'), (435347,'kitten'), (987977,'frog') ] int_list := [4][2]int{{1, 0}, {2, 0}, {3, 0}, {4, 0}}string_list := make([][]string, 0)a := [1][2]string{{""lion"",""dog""}} array := []interface{}{1, ""dog"", ""lion"", 12, 45.09, true, false}",How to declare multidimensional array of two different datatypes
Execute command in background golang," I use the following code which is execute command of ""npm install"" , now while debug I see that the command is taking about 10..15 sec to execute (depend on how much module I've). what I want is that this command will execute in background and the program will continue. In debug I see that to move to next line tass about 10..15 sec...Ive two questions in this:How can I can do it? since I want to do something in parallel...How can I know when it finishes? To provide additional logic which is related to this command i.e. after the npm install is done I need todo other stuff. <code>  cmd := exec.Command(name ,args...)cmd.Dir = entryPath",Execute command in background
Porting Kafka's murmu2 implementation to Go/Golang," JVM clients for Kafka are using custom implementation of murmur2 hash for their default partitioner.None of Kafka clients for Go implement this hashing algorithm, which bring all sorts of problems when you need to keep consistent partitioning between different clients on different platforms.I'm trying to port this code to Go, and it seems to work for some of the values, but not for the others.Here is the Java code (source is here: https://github.com/apache/kafka/blob/1.0.0/clients/src/main/java/org/apache/kafka/common/utils/Utils.java#L353): Here is the Go code (playground link: https://play.golang.org/p/K4VooLZ4Mp7): I generated expected values for Go tests from Java, using mentioned Utils class like so:System.out.println(Utils.murmur2(""a-little-bit-long-string"".getBytes(""UTF-8"")))None of the existing murmur2 implementations for Go I've seen are generating the same results as mentioned Java code.The question is, how can I port mentioned code in Java to Go so that the result will be the same between both? <code>  public static int murmur2(final byte[] data) { int length = data.length; int seed = 0x9747b28c; // 'm' and 'r' are mixing constants generated offline. // They're not really 'magic', they just happen to work well. final int m = 0x5bd1e995; final int r = 24; // Initialize the hash to a random value int h = seed ^ length; int length4 = length / 4; for (int i = 0; i < length4; i++) { final int i4 = i * 4; int k = (data[i4 + 0] & 0xff) + ((data[i4 + 1] & 0xff) << 8) + ((data[i4 + 2] & 0xff) << 16) + ((data[i4 + 3] & 0xff) << 24); k *= m; k ^= k >>> r; k *= m; h *= m; h ^= k; } // Handle the last few bytes of the input array switch (length % 4) { case 3: h ^= (data[(length & ~3) + 2] & 0xff) << 16; case 2: h ^= (data[(length & ~3) + 1] & 0xff) << 8; case 1: h ^= data[length & ~3] & 0xff; h *= m; } h ^= h >>> 13; h *= m; h ^= h >>> 15; return h;} package mainimport ""fmt""func main() { cases := []struct { Input []byte Expected int32 }{ {[]byte(""21""), -973932308}, {[]byte(""foobar""), -790332482}, // outputs: 1518714010 {[]byte(""a-little-bit-long-string""), -985981536}, // outputs 2068422364 {[]byte(""a-little-bit-longer-string""), -1486304829}, // outputs 1797390322 {[]byte(""lkjh234lh9fiuh90y23oiuhsafujhadof229phr9h19h89h8""), -58897971}, // outputs -1332218133 {[]byte{'a', 'b', 'c'}, 479470107}, } for _, c := range cases { if res := murmur2(c.Input); res != c.Expected { fmt.Printf(""input: %q, expected: %d, got: %d\n"", c.Input, c.Expected, res) } }}func murmur2(data []byte) int32 { length := int32(len(data)) seed := uint32(0x9747b28c) m := int32(0x5bd1e995) r := uint32(24) h := int32(seed ^ uint32(length)) length4 := length / 4 for i := int32(0); i < length4; i++ { i4 := i * 4 k := int32(data[i4+0]&0xff) + (int32(data[i4+1]&0xff) << 8) + (int32(data[i4+2]&0xff) << 16) + (int32(data[i4+3]&0xff) << 24) k ^= int32(uint32(k) >> r) k *= m h *= m h ^= k } switch length % 4 { case 3: h ^= int32(data[(length & ^3)+2]&0xff) << 16 fallthrough case 2: h ^= int32(data[(length & ^3)+1]&0xff) << 8 fallthrough case 1: h ^= int32(data[length & ^3] & 0xff) h *= m } h ^= int32(uint32(h) >> 13) h *= m h ^= int32(uint32(h) >> 15) return h}",Porting Kafka's murmur2 implementation to Go
xml namespace prefix issue at go lang," marshalling and unmarshalling are not working properly with xml namespace prefix go version 1.9.2 See below code: Output of above program with proper marshalled Content and empty Marshelled content : but when i change the struct's xml tag from xml:""cwmp:Inform"" to xml:""cwmp Inform"", then Unmarshelling happens properly, but i get below output for Marshelled content : Instead of getting <cwmp:Inform>, I am getting <Inform xmlns=""cwmp"">Is there any work around to correct the marshelled content ? Is it ago language Issue ? <code>  package mainimport ( ""fmt"" ""encoding/xml"")type DeviceId struct { XMLName xml.Name `xml:""DeviceId""` Manufacturer string `xml:""Manufacturer""` OUI string `xml:""OUI""` ProductClass string `xml:""ProductClass""` SerialNumber string `xml:""SerialNumber""`}type CwmpInform struct { XMLName xml.Name `xml:""cwmp:Inform""` DeviceId DeviceId }func main() { rq := new(CwmpInform) data := `<cwmp:Inform> <DeviceId> <Manufacturer></Manufacturer> <OUI>48BF74</OUI> <ProductClass>FAP</ProductClass> <SerialNumber>1202000042177AP0008</SerialNumber> </DeviceId> </cwmp:Inform>` xml.Unmarshal([]byte (data), rq) fmt.Printf(""Unmarshelled Content:%v"", rq) output, err := xml.MarshalIndent(rq,"" "", "" "") if err != nil{ fmt.Printf(""error : %v"", err) } fmt.Printf(""Marshelled Content: %s\n"", string(output))} Unmarshelled Content:&{{ } {{ } }} Marshelled Content: <cwmp:Inform> <DeviceId> <Manufacturer></Manufacturer> <OUI></OUI> <ProductClass></ProductClass> <SerialNumber></SerialNumber> </DeviceId> </cwmp:Inform> <Inform xmlns=""cwmp""> <DeviceId> <Manufacturer></Manufacturer> <OUI>48BF74</OUI> <ProductClass>FAP</ProductClass> <SerialNumber>1202000042177AP0008</SerialNumber> </DeviceId> </Inform>",xml namespace prefix issue at go
Golang - passing data to a nested template not working as expected," I was trying to get a struct passed to a nested template in Go, using html/template and tried to achieve it using both template.ParseFiles and template.ParseGlob, but it is not working as per my expectation because my understanding is not clear.My template code for the file header.html is and for the file admin.html is I am using the Execute method on the type *Template as With the above code, I can pass around the struct data to admin.html, and it shows User is Guest in the browser. But if I try to pass it to any of the nested templates, it wouldn't. The title of the page still shows as SiteAdmin - and not SiteAdmin - Guest. The User data from the struct is visible only if I call it as {{.User}} inside the admin.html file, and any reference to it in the nested templates turns out to be not passed. Is this something achievable? Thank you all. <code>  {{define ""header""}}<!DOCTYPE html><html lang=""en""><head> <link href=""https://use.fontawesome.com/releases/v5.0.6/css/all.css"" rel=""stylesheet""> <meta charset=""UTF-8""> <meta http-equiv=""X-UA-Compatible"" content=""ie=edge""> <title> SiteAdmin - {{.User}}</title></head>{{end}} {{template ""header""}}<body>""User is {{.User}}""</body></html> type Admin struct { User string}data := new(Admin)data.User = ""Guest""tpl, err := template.ParseGlob(""views/templates/admin/*.html"")CheckForErr(err)err = tpl.Execute(w, data)CheckForErr(err)",Passing data to a nested template not working as expected
Why does Go binary built on AWS CodeBuild break string handling?," Using a URL that has worked in the past, I know receive a parsing error from net/url. What's wrong with it? Sample applicationSee https://play.golang.com/p/mQZaN5JN3_q to run. <code>  parse postgres://user:abc{DEf1=ghi@example.com:5432/db?sslmode=require: net/url: invalid userinfo package mainimport ( ""fmt"" ""net/url"")func main() { dsn := ""postgres://user:abc{DEf1=ghi@example.com:5432/db?sslmode=require"" u, err := url.Parse(dsn) fmt.Println(u, err)}",Go url.Parse(string) fails with certain user names or passwords
Why does Go binary built using Docker golang:latest break string handling?," Using a URL that has worked in the past, I know receive a parsing error from net/url. What's wrong with it? Sample applicationSee https://play.golang.com/p/mQZaN5JN3_q to run. <code>  parse postgres://user:abc{DEf1=ghi@example.com:5432/db?sslmode=require: net/url: invalid userinfo package mainimport ( ""fmt"" ""net/url"")func main() { dsn := ""postgres://user:abc{DEf1=ghi@example.com:5432/db?sslmode=require"" u, err := url.Parse(dsn) fmt.Println(u, err)}",Go url.Parse(string) fails with certain user names or passwords
Go url.Parse(string) fails with unencoded strings," Using a URL that has worked in the past, I know receive a parsing error from net/url. What's wrong with it? Sample applicationSee https://play.golang.com/p/mQZaN5JN3_q to run. <code>  parse postgres://user:abc{DEf1=ghi@example.com:5432/db?sslmode=require: net/url: invalid userinfo package mainimport ( ""fmt"" ""net/url"")func main() { dsn := ""postgres://user:abc{DEf1=ghi@example.com:5432/db?sslmode=require"" u, err := url.Parse(dsn) fmt.Println(u, err)}",Go url.Parse(string) fails with certain user names or passwords
How to setup gRPC server correctly," I have a gRPC client and a server, when I run them they seem to be running fine, but when I try to dial a server with a client I get an error: No idea what is it. I tried to find a solution with google, no success there.Any ideas? Here is my server code: btw the server here shows log: 2018/02/08 07:03:37.603287 INFO: [userserver] running at localhost:3001and client: and this is port buff <code>  ""Error"": { ""code"": 14, ""message"": ""all SubConns are in TransientFailure""}, lis, err := net.Listen(""tcp"", fmt.Sprintf(""%s:%d"", cfg.Host, cfg.Port))if err != nil { logger.Critical(ctx, ""failed to listen: %v"", err)} else { logger.Info(ctx, ""[userserver] running at %s:%d"", cfg.Host, cfg.Port)}grpcServer := grpc.NewServer()userServer := userserver.New()pb.RegisterDomainServer(grpcServer, userServer)rpcErr := grpcServer.Serve(lis)if rpcErr != nil { logger.Critical(ctx, ""failed to serve: %v"", rpcErr)} conn, err := grpc.Dial(c.serverAddr, grpc.WithInsecure())if err != nil { return err}defer conn.Close()client := pb.NewDomainClient(conn)_, err = client.Dispatch(ctx, &pb.Command{ Name: command, Payload: payload,}) service Domain { rpc Dispatch(Command) returns (Response);}message Command { string name = 1; bytes payload = 2;}message Response {}",How to set up gRPC client - server correctly
How to setup gRPC client - server correctly," I have a gRPC client and a server, when I run them they seem to be running fine, but when I try to dial a server with a client I get an error: No idea what is it. I tried to find a solution with google, no success there.Any ideas? Here is my server code: btw the server here shows log: 2018/02/08 07:03:37.603287 INFO: [userserver] running at localhost:3001and client: and this is port buff <code>  ""Error"": { ""code"": 14, ""message"": ""all SubConns are in TransientFailure""}, lis, err := net.Listen(""tcp"", fmt.Sprintf(""%s:%d"", cfg.Host, cfg.Port))if err != nil { logger.Critical(ctx, ""failed to listen: %v"", err)} else { logger.Info(ctx, ""[userserver] running at %s:%d"", cfg.Host, cfg.Port)}grpcServer := grpc.NewServer()userServer := userserver.New()pb.RegisterDomainServer(grpcServer, userServer)rpcErr := grpcServer.Serve(lis)if rpcErr != nil { logger.Critical(ctx, ""failed to serve: %v"", rpcErr)} conn, err := grpc.Dial(c.serverAddr, grpc.WithInsecure())if err != nil { return err}defer conn.Close()client := pb.NewDomainClient(conn)_, err = client.Dispatch(ctx, &pb.Command{ Name: command, Payload: payload,}) service Domain { rpc Dispatch(Command) returns (Response);}message Command { string name = 1; bytes payload = 2;}message Response {}",How to set up gRPC client - server correctly
golang the different between named return value and normal return value," My question is about the different named return value vs normal return value.my code the result:the a function return 0the b function reutrn 1Why? <code>  package mainimport ""fmt""func main() { f := fmt.Println f(a()) f(b())}func a() int { i := 0 defer func() { i += 1 fmt.Println(""a defer : "", i) }() return i}func b() (i int) { i = 0 defer func() { i += 1 fmt.Println(""b defer : "", i) }() return i}",What is the difference between named return value and normal return value?
What is the different between named return value and normal return value?," My question is about the different named return value vs normal return value.my code the result:the a function return 0the b function reutrn 1Why? <code>  package mainimport ""fmt""func main() { f := fmt.Println f(a()) f(b())}func a() int { i := 0 defer func() { i += 1 fmt.Println(""a defer : "", i) }() return i}func b() (i int) { i = 0 defer func() { i += 1 fmt.Println(""b defer : "", i) }() return i}",What is the difference between named return value and normal return value?
Golang signing a struct with an already generated RSA private key," I have a struct Transaction with the following fields, I also have a function GetPrivateKey() which returns a *rsa.PrivateKey My plan here is to sign the contents of the struct transaction using a private key already in the system and then store it as a string in the field signature in the struct, For this, I have a function SignPayload() Unfortunately, this is not working,rsa.SignPKCS1v15() throws an error saying: crypto/rsa: input must be hashed messageThe end goal here is to use this signature to verify the authenticity of the struct by comparing it with the public key present in the field sender.I'm an absolute newbie in cryptography, What am I doing wrong here? and more importantly, How can I do this?Thanks in advance! <code>  type Transaction struct { Sender string `json:""sender""` Receiver string `json:""receiver""` Signature string `json:""signature""` Amount int64 `json:""amount""`} func GetPrivateKey() (*rsa.PrivateKey, error) { key, err := ioutil.ReadFile(""/Users/xxx/.ssh/id_rsa"") if err != nil { return nil, err } block, _ := pem.Decode(key) der, err := x509.ParsePKCS1PrivateKey(block.Bytes) if err != nil { return nil, err } return der, err } func SignPayload(txnObj *Transaction) error { privateKey, err := GetPrivateKey() if err != nil { panic(err) } bodyHash, err := rsa.SignPKCS1v15(rand.Reader, privateKey, crypto.SHA256, []byte(fmt.Sprintf(""%v"", *txnObj))) if err != nil { panic(err) } txnObj.Signature = string(bodyHash) log.Println(txnObj.Signature) return err}",Golang signing a struct using rsa
What is the best way to create a json payload in Go Lang POST request?," I am trying to make post request with dynamic 'myJsonPayload', which will be changing for different request. <code>  request, err := http.NewRequest(""POST"", url,bytes.NewBuffer(**myJsonPayload**))",How can I create a json payload for a POST request?
Create a json payload in Go Lang POST request?," I am trying to make post request with dynamic 'myJsonPayload', which will be changing for different request. <code>  request, err := http.NewRequest(""POST"", url,bytes.NewBuffer(**myJsonPayload**))",How can I create a json payload for a POST request?
Create a json payload for a POST request?," I am trying to make post request with dynamic 'myJsonPayload', which will be changing for different request. <code>  request, err := http.NewRequest(""POST"", url,bytes.NewBuffer(**myJsonPayload**))",How can I create a json payload for a POST request?
openapi spec validation in Golang," I want to validate an openapi spec in a similar fashion as its done here : http://bigstickcarpet.com/swagger-parser/www/index.html but the difference is that Ill use GO to code the tool and its only a CLI.I am trying to use this :https://github.com/go-openapi/validateBut the main problem is that the documentation is almost non existent. I came here looking for help of someone that might previously used this library and can give me a MINIMAL example of sending a file containing a spec like such and having this library to throw all the errors or warnings in a similar fashion to the online Swagger validator.I already can read a file and do some manual validation of the fields on it but of course thats not what I need to do and its just a sample.Additionally, as a secondary question, I want to post this same question on their GitHub repo but I get this : and I have no idea how to ""review"" these guidelines so I can post my question.What I have : What I need : <code>  func validate_spec(spec string) []validator_error { // RULES HERE. Now I am hardcoding since this is just a dummy app. On the real app we will need to use goapenapi plus a schema validator var errors []validator_error name_regex, _ := regexp.Compile(""^[a-zA-Z]+[ ][a-zA-Z]+"") // Validate _.name field if ( ! gjson.Get(spec, ""name"").Exists() ) { n := validator_error{Path: ""_.name"", Message: ""Does not exist!""} errors = append(errors,n) } if gjson.Get(spec, ""name"").Exists() { if _, ok := gjson.Get(spec, ""name"").Value().(string); !ok { n := validator_error{Path: ""_.name"", Message: ""should be a string""} errors = append(errors,n) } if ( ! name_regex.MatchString(gjson.Get(spec, ""name"").String() ) ) { n := validator_error{Path: ""_.name"", Message: ""should match "" + name_regex.String()} errors = append(errors,n) } } // *************************** // Validate _.age field if ( ! gjson.Get(spec, ""age"").Exists() ) { n := validator_error{Path: ""_.age"", Message: ""Does not exist!""} errors = append(errors,n) } if gjson.Get(spec, ""age"").Exists() { if _, ok := gjson.Get(spec, ""age"").Value().(float64); !ok { n := validator_error{Path: ""_.age"", Message: ""should be an int""} errors = append(errors,n) } } // *************************** return errors} func validate_spec(spec string) []validator_error { // Something like this is what I am looking for. On the above example I am just hard-coding some dummy rules. I need to use the library here to get the validity of the spec being passed. return goopenapi.validate(spec ) }",OpenAPI spec validation in Golang
Using Pointers in a for Loop - Golang," I'm struggling to understand why I have a bug in my code in one state but not the other. It's been a while since I've covered pointers, so I'm probably rusty!Basically I have a repository structure I'm using to store an object in memory, that has a Store function. So all it does is put a RW mutex lock on and adds the pointer to a map, referenced by an identifier.Then I've got a function that will basically loop through a slice of these objects, storing them all in the repository. The above doesn't work, it looks like everything works fine at first, but on trying to access the data later, the entries in the map all point to the same Chart object, despite having different keys.If I do the following and move the pointer reference to another function, everything works as expected: I'm assuming the issue is that because the loop overwrites the reference to the chart in the for loop, the pointer reference also changes. When the pointer is generated in an independent function, that reference is never overwritten. Is that right?I feel like I'm being stupid, but shouldn't the pointer be generated by &chart and that's independent of the chart reference? I also tried creating a new variable for the pointer p := &chart in the for loop and that didn't work either.Should I just avoid generating pointers in loops? <code>  type chartsRepository struct { mtx sync.RWMutex charts map[ChartName]*Chart}func (r *chartsRepository) Store(c *Chart) error { r.mtx.Lock() defer r.mtx.Unlock() r.charts[c.Name] = c return nil} type service struct { charts Repository}func (svc *service) StoreCharts(arr []Chart) error { hasError := false for _, chart := range arr { err := svc.repo.Store(&chart) // ... error handling } if hasError { // ... Deals with the error object return me } return nil} func (svc *service) StoreCharts(arr []Chart) error { // ... for _, chart := range arr { err := svc.storeChart(chart) } // ...}func (svc *service) storeChart(c Chart) error { return svc.charts.Store(&c)}",Using Pointers in a for loop
How can `&deployment` satisfy type runtime.Object in kubernetes code?," In kubectl/run.go in Kubernetes code, the Generate function has a result list of these two types: The last line of the function is: runtime is imported: I got runtime by running go get on that import statement, and Object is defined in interfaces.go: (And I found the same code on the web here.)The address operator creates a pointer... more specifically, the Go spec states:For an operand x of type T, the address operation &x generates a pointer of type *T to x.and pointers have a type distinct from their base type:A pointer type denotes the set of all pointers to variables of a given type, called the base type of the pointer.How does &deployment satisfy the runtime.Object type?My best guess so far is that deployment implements the runtime.Object interface, and mapping &deployment to runtime.Object satisfies this rule of assignability:T is an interface type and x implements T.and that a return statement mapping to a result list type is equivalent to assignment in this respect. Is this correct? If not, is there another part of the specification or documentation that explains it? <code>  runtime.Object, error return &deployment, nil k8s.io/apimachinery/pkg/runtime type Object interface { GetObjectKind() schema.ObjectKind DeepCopyObject() Object}",How can &deployment satisfy type runtime.Object in kubernetes code?
go test: force retesting OR disable test caching, Problem:When I run the same go test twice the second run is not done at all. The results are the cached ones from the first run. LinksI already checked https://golang.org/cmd/go/#hdr-Testing_flags but there is no cli flag for that purpose.Question:Is there a possibility to force go test to always run test and not to cache test results. <code>  PASS ok tester/apitests (cached),Force retesting or disable test caching
Fetching NULL datetime value in MySQL using GORM golang," I want to fetch the last visit_details row having out_time as NULL using Gorm.NIL is itself a type where VisitDetail OutTime is mysql.NullTime. Code:- Query:- <code>  var visitDetail models.VisitDetaildb.Where(""out_time=? "", nil).Last(&visitDetail)//model VisitDetailstype VisitDetail struct { Id int Visitor Visitor `gorm:""foreignkey:ClientId;association_foreignkey:Id""` VisitorId int `gorm:""not null;""` Location Location `gorm:""foreignkey:LocationId;association_foreignkey:Id""` LocationId int `gorm:""not null;""` Purpose string InTime time.Time `gorm:""not null;""` OutTime mysql.NullTime User User `gorm:""foreignkey:ClientId;association_foreignkey:Id""` UserId int `gorm:""not null;""` Status int `gorm:""not null;""` ApproveByClient int `gorm:""not null;""`} select * from visit_details where out_time is NULL order by id desc limit 1;+----+------------+-------------+---------+---------------------+----------+---------+--------+-------------------+| id | visitor_id | location_id | purpose | in_time | out_time | user_id | status | approve_by_client |+----+------------+-------------+---------+---------------------+----------+---------+--------+-------------------+| 20 | 1 | 8 | | 2018-02-20 17:13:25 | NULL | 1609 | 0 | 0 |+----+------------+-------------+---------+---------------------+----------+---------+--------+-------------------+1 row in set (0.04 sec)",Fetching NULL datetime value in MySQL using GORM
Why this slice changes its capacity?," In this slide of A Tour of Go, there is this snippet: and the result: My confusion is about the cap=4 in the last line - I thought it should remain 6.What is the cause of the capacity changing from 6 to 4 in the last line?Also, why only the last line changes its capacity but the others don't ? <code>  package mainimport ""fmt""func main() { s := []int{2, 3, 5, 7, 11, 13} printSlice(s) // Slice the slice to give it zero length. s = s[:0] printSlice(s) // Extend its length. s = s[:4] printSlice(s) // Drop its first two values. s = s[2:] printSlice(s)}func printSlice(s []int) { fmt.Printf(""len=%d cap=%d %v\n"", len(s), cap(s), s)} len=6 cap=6 [2 3 5 7 11 13]len=0 cap=6 []len=4 cap=6 [2 3 5 7]len=2 cap=4 [5 7]",Go Tour #11 - Why this slice changes its capacity?
"From ""A Tour of Go"" - Why this slice changes its capacity?"," In this slide of A Tour of Go, there is this snippet: and the result: My confusion is about the cap=4 in the last line - I thought it should remain 6.What is the cause of the capacity changing from 6 to 4 in the last line?Also, why only the last line changes its capacity but the others don't ? <code>  package mainimport ""fmt""func main() { s := []int{2, 3, 5, 7, 11, 13} printSlice(s) // Slice the slice to give it zero length. s = s[:0] printSlice(s) // Extend its length. s = s[:4] printSlice(s) // Drop its first two values. s = s[2:] printSlice(s)}func printSlice(s []int) { fmt.Printf(""len=%d cap=%d %v\n"", len(s), cap(s), s)} len=6 cap=6 [2 3 5 7 11 13]len=0 cap=6 []len=4 cap=6 [2 3 5 7]len=2 cap=4 [5 7]",Go Tour #11 - Why this slice changes its capacity?
Golang TypeOf without an instance," Is it possible in go to get a ""Type"" without an instance? I've seen some examples that utilize reflect.TypeOf() but they all deal with an instance. Below is a snippet of what I am attempting to do: An example of my usage would be Note, after writing this out, I realize I could provide a ""RequireUint64"", ""RequireUint32"", etc.. perhaps that would be the Go way? <code>  import ( ""net/http"")type ParamReader struct { // The request from which to extract parameters context *http.Request}// Initialize the ParamReader with a specific http request. This serves// as the 'context' of our param reader. All subsequent calls will validate// the params that are present on this assigned http.Requestfunc (p *ParamReader) Context(r *http.Request) { p.context = r}// Validate that a given param 's' is both present and a valid// value of type 't'. A value is demeed valid if a conversion from // its string representation to 't' is possiblefunc(p *ParamReader) Require(s string, t Type) { // if context not have 's' // addError('s' is not present) // return if( t == typeof(uint64)) { // If not s -> uint64 // addError('s' is not a valid uint64) } else if (t == typeof(uint32)) { // .... } / ....} func (h *Handler) OnRequest(r *http.Request) { h.ParamReader.Context(r) h.ParamReader.Require(""age"", uint16) h.ParamReader.Require(""name"", string) h.ParamReader.Require(""coolfactor"", uint64) h.ParamReader.Optional(""email"", string, ""unspecified"") h.ParamReader.Optional(""money"", uint64, ""0"") if h.ParamReader.HasErrors() { // Iterate or do something about the errors } else { coolness := h.ParamReader.ReadUint64(""coolfactor"") email := h.ParamReader.ReadString(""email"") money := h.ParamReader.ReadUint64(0) }}",TypeOf without an instance and passing result to a func
Golang TypeOf without an instance and passing result to a func," Is it possible in go to get a ""Type"" without an instance? I've seen some examples that utilize reflect.TypeOf() but they all deal with an instance. Below is a snippet of what I am attempting to do: An example of my usage would be Note, after writing this out, I realize I could provide a ""RequireUint64"", ""RequireUint32"", etc.. perhaps that would be the Go way? <code>  import ( ""net/http"")type ParamReader struct { // The request from which to extract parameters context *http.Request}// Initialize the ParamReader with a specific http request. This serves// as the 'context' of our param reader. All subsequent calls will validate// the params that are present on this assigned http.Requestfunc (p *ParamReader) Context(r *http.Request) { p.context = r}// Validate that a given param 's' is both present and a valid// value of type 't'. A value is demeed valid if a conversion from // its string representation to 't' is possiblefunc(p *ParamReader) Require(s string, t Type) { // if context not have 's' // addError('s' is not present) // return if( t == typeof(uint64)) { // If not s -> uint64 // addError('s' is not a valid uint64) } else if (t == typeof(uint32)) { // .... } / ....} func (h *Handler) OnRequest(r *http.Request) { h.ParamReader.Context(r) h.ParamReader.Require(""age"", uint16) h.ParamReader.Require(""name"", string) h.ParamReader.Require(""coolfactor"", uint64) h.ParamReader.Optional(""email"", string, ""unspecified"") h.ParamReader.Optional(""money"", uint64, ""0"") if h.ParamReader.HasErrors() { // Iterate or do something about the errors } else { coolness := h.ParamReader.ReadUint64(""coolfactor"") email := h.ParamReader.ReadString(""email"") money := h.ParamReader.ReadUint64(0) }}",TypeOf without an instance and passing result to a func
Go - change format of log output logrus," I use Go logrus and I need to change the format of the output message. I tried several things without success.What I need is format like this with formatter of logrus[error]: datetime - messageWhat I've tried without success is this This produce the following And I want it to be <code>  logger := &logrus.Logger{ Out: os.Stderr, Level: level, Formatter: &logrus.TextFormatter{ DisableColors: true, TimestampFormat : ""2006-01-02 15:04:05"", FullTimestamp:true, }, } time=""2018-02-25 10:42:20"" level=error msg=""Starting Process"" [INFO]:2018-02-25 10:42:20 - Starting Process",How to change the format of log output in logrus?
Go - Change format of log output logrus," I use Go logrus and I need to change the format of the output message. I tried several things without success.What I need is format like this with formatter of logrus[error]: datetime - messageWhat I've tried without success is this This produce the following And I want it to be <code>  logger := &logrus.Logger{ Out: os.Stderr, Level: level, Formatter: &logrus.TextFormatter{ DisableColors: true, TimestampFormat : ""2006-01-02 15:04:05"", FullTimestamp:true, }, } time=""2018-02-25 10:42:20"" level=error msg=""Starting Process"" [INFO]:2018-02-25 10:42:20 - Starting Process",How to change the format of log output in logrus?
Change format of log output logrus," I use Go logrus and I need to change the format of the output message. I tried several things without success.What I need is format like this with formatter of logrus[error]: datetime - messageWhat I've tried without success is this This produce the following And I want it to be <code>  logger := &logrus.Logger{ Out: os.Stderr, Level: level, Formatter: &logrus.TextFormatter{ DisableColors: true, TimestampFormat : ""2006-01-02 15:04:05"", FullTimestamp:true, }, } time=""2018-02-25 10:42:20"" level=error msg=""Starting Process"" [INFO]:2018-02-25 10:42:20 - Starting Process",How to change the format of log output in logrus?
Go: Difference between map[string]interface{} and interface{}," I want to parse a JSON file to a map[string]interface{}: But I modified my code to point data to interface{}: I don't understand much about difference between map[string]interface{} and interface{} in above case. <code>  var migrations map[string]interface{}json.Unmarshal(raw, &migrations)fmt.Println(migrations[""create_user""]) var migrations interface{}json.Unmarshal(raw, &migrations)// compile wrong herefmt.Println(migrations[""create_user""])",Difference between map[string]interface{} and interface{}
Different packages with different configuration properties," I have an application which needs configuration and Ive created a configuration struct and Im entering the configuration as a parameter to the function. The problem is that the configuration struct becomes bigger (like monolith) and bigger and I move the config to different functions in my app and which doesnt need all the fields, just few of them. My question is if there is better approach to implement it in Go.After struggling to find good way Ive found this article (which a bit old but hopefully still relevant) and I wonder how and if I can use it to solve my problem.Functional options instead of config structhttps://dave.cheney.net/2014/10/17/functional-options-for-friendly-apisI need to inject some configuration properties to my application in For example for function run (which is entry point ) I need to inject the log level and some other env variable like port host For function build I need to inject the build flavor and build type etc.Any example for my content will be very helpfulHow to structure it in the code ?How to implement it? updateI need some E2E example how can I use the functional approach for different configs in the same package and other packages <code> ",Different packages with different config props - Functional option
Go: JSON Unmarshal struct case-sensitively," Is there any way to make json.Unmarshal not accept a case-insensitive match? I receive a JSON with tags such as ""e"" and ""E"" and would like to unmarshal the object with tag ""e"" but ignore the one with ""E"". Right now the only solution I found was to define a struct containing both tags and then to simply ignore tag ""E"", but I'm looking for a cleaner solution.From the official doc: To unmarshal JSON into a struct, Unmarshal matches incoming object keys to the keys used by Marshal (either the struct field name or its tag), preferring an exact match but also accepting a case-insensitive match. <code> ",JSON Unmarshal struct case-sensitively
"Golang templates error: template: ""..."" is an incomplete or empty template"," I'm trying to add a FuncMap to my templates, but I'm receiving the following error: template: ""foo"" is an incomplete or empty templateThe parsing of templates worked just fine before I used the FuncMap, so I'm not sure why it's throwing an error now.Here is my code: t.files() just returns a slice of strings that are file paths.Anyone know what's up? <code>  funcMap := template.FuncMap{ ""IntToUSD"": func(num int) string { return decimal.New(int64(num), 2).String() },}// ...tmpl, err := template.New(t.file).Funcs(funcMap).ParseFiles(t.files()...)if err != nil { // ...}","error: template: ""..."" is an incomplete or empty template"
How to archive proper parallelism in Golang? Are goroutines parallel Go1.5+?," I know the differences between parallelism and concurrency. I'm looking for how to achieve parallelism in Go. I expected goroutines to be parallel, but the documentation I found appears to say otherwise.The setting GOMAXPROCS allows us to configure the number of threads that the application can use to run in parallel. Since version 1.5, GOMAXPROCS has as value the number of cores. As far as I understand, goroutines are inherently parallel since version 1.5. Is this conclusion correct?Every question I find on sites like StackOverflow appears to be outdated and doesn't take into account this change in version 1.5. See: Parallel processing in golangMy confusion arises from trying to test this parallelism in practice. I have tried the following code I in Go 1.10 and it doesn't run in parallel. Setting up GOMAXPROCS to 2 doesn't change the result. I get a concurrent program instead of a parallel one.I'm running all my tests on an 8 core system.Edit: For future reference,I got carried away by this blog: https://www.ardanlabs.com/blog/2014/01/concurrency-goroutines-and-gomaxprocs.html where parallelism is achieved without much hassle in a small for-loop. The answer by @peterSO is completely valid. For some reason, in Go 1.10 I couldn't replicate the results of the blog. <code>  package mainimport ( ""fmt"" ""sync"")var wg sync.WaitGroupfunc main() { wg.Add(2) go count() go count() wg.Wait()}func count() { defer wg.Done() for i := 0; i < 10; i++ { fmt.Println(i) }}",How to achieve proper parallelism in Golang? Are goroutines parallel in versions 1.5+?
How to achieve proper parallelism in Golang? Are goroutines parallel Go1.5+?," I know the differences between parallelism and concurrency. I'm looking for how to achieve parallelism in Go. I expected goroutines to be parallel, but the documentation I found appears to say otherwise.The setting GOMAXPROCS allows us to configure the number of threads that the application can use to run in parallel. Since version 1.5, GOMAXPROCS has as value the number of cores. As far as I understand, goroutines are inherently parallel since version 1.5. Is this conclusion correct?Every question I find on sites like StackOverflow appears to be outdated and doesn't take into account this change in version 1.5. See: Parallel processing in golangMy confusion arises from trying to test this parallelism in practice. I have tried the following code I in Go 1.10 and it doesn't run in parallel. Setting up GOMAXPROCS to 2 doesn't change the result. I get a concurrent program instead of a parallel one.I'm running all my tests on an 8 core system.Edit: For future reference,I got carried away by this blog: https://www.ardanlabs.com/blog/2014/01/concurrency-goroutines-and-gomaxprocs.html where parallelism is achieved without much hassle in a small for-loop. The answer by @peterSO is completely valid. For some reason, in Go 1.10 I couldn't replicate the results of the blog. <code>  package mainimport ( ""fmt"" ""sync"")var wg sync.WaitGroupfunc main() { wg.Add(2) go count() go count() wg.Wait()}func count() { defer wg.Done() for i := 0; i < 10; i++ { fmt.Println(i) }}",How to achieve proper parallelism in Golang? Are goroutines parallel in versions 1.5+?
golang: why converting pointer to interface{} causes struct escaping to heap?," Here is my go environment: Here is my program: I allocate a request instance and convert the pointer of it to interface{}.But when analysing with flag -gcflags ""-m"" , I found out the instance escapes to heap when converting. Why this happens?Here is analysing result: I think this case doesn't match any cases listed on ""Go Escape Analysis Flaws"". <code>  [lorneli@localhost GoTest]$ go versiongo version go1.9 linux/amd64 package maintype request struct { ID string size uint32 off uint64}func main() { r := request{} iter := interface{}(&r) // &r escapes to heap iters := make([]interface{}, 0) iters = append(iters, iter)} [lorneli@localhost GoTest]$ go build -gcflags ""-m""# _/mnt/hgfs/vmfolder/workspace/GoTest./main.go:9:6: can inline main./main.go:11:21: (interface {})(&r) escapes to heap./main.go:11:22: &r escapes to heap./main.go:10:15: moved to heap: r./main.go:12:15: main make([]interface {}, 0) does not escape",Why does a pointer to a local variable escape to the heap?
Why does converting a pointer to interface{} cause struct escaping to heap?," Here is my go environment: Here is my program: I allocate a request instance and convert the pointer of it to interface{}.But when analysing with flag -gcflags ""-m"" , I found out the instance escapes to heap when converting. Why this happens?Here is analysing result: I think this case doesn't match any cases listed on ""Go Escape Analysis Flaws"". <code>  [lorneli@localhost GoTest]$ go versiongo version go1.9 linux/amd64 package maintype request struct { ID string size uint32 off uint64}func main() { r := request{} iter := interface{}(&r) // &r escapes to heap iters := make([]interface{}, 0) iters = append(iters, iter)} [lorneli@localhost GoTest]$ go build -gcflags ""-m""# _/mnt/hgfs/vmfolder/workspace/GoTest./main.go:9:6: can inline main./main.go:11:21: (interface {})(&r) escapes to heap./main.go:11:22: &r escapes to heap./main.go:10:15: moved to heap: r./main.go:12:15: main make([]interface {}, 0) does not escape",Why does a pointer to a local variable escape to the heap?
Golang Cobra Subcommand Invoke Help By Default," I want sub command to print out the Help menu if no argument or flags is passed (The main command does this by default).For example, the main command without any arguments or flags: I want subcommand like ""tk addon"" to also return it's own help menu if no arguments or flags is entered, currently it only gives a blank line.addon code : <code>  chris@pop-os:~$ ./tkCommand line application to deployUsage: tk [command]Available Commands: addon Install packages cluster Used to create cloud infrastructures help Help about any commandFlags: --config string config file (default is $HOME/.tk8.yaml) -h, --help help for tk -t, --toggle Help message for toggleUse ""tk [command] --help"" for more information about a command. var addonCmd = &cobra.Command{ Use: ""addon"",Short: ""Install addon packages"",Long: `Install additional packages`,Run: func(cmd *cobra.Command, args []string) { } },}",Cobra Subcommand Invoke Help By Default
Error while using log4j in java," I want to test parse of yaml and test it via unit testIve create structs that with appropriate types but the assertion is always falid, I try with the following code which failed constantly This is the yaml content which is valid (maybe with the copy it changed but I was able to parse it correctly) This is the test I was created This is the assertion code The error is : How should I overcome it to check the module properties ? The ParseFile method is just err := yaml.Unmarshal([]byte(yamlFile), &yamlconent) <code>  ID: demoversion: 0.0.5dep: - name: db path: mtb requires: - name: vi_db - name: srv path: srv1 properties: LOG_LEVEL: ""info"" parameters: mem: 12G requires: - name: db properties: func Test_parseFile(t *testing.T) { yamlfile, err := ioutil.ReadFile(""./testdata/file.yaml"") type Properties map[string]string type Parameters map[string]interface{} type Modules struct { Name string Path string `yaml:""path,omitempty""` Requires []Requires `yaml:""requires,omitempty""` Properties Properties `yaml:""properties,omitempty""` } type Requires struct { Name string `yaml:""name,omitempty""` Properties Properties `yaml:""properties,omitempty""` } type args struct { contentFile []byte } tests := []struct { name string args args wantOut Properties wantNoTests bool wantErr bool }{ { name: ""test"", args: args{ contentFile: yamlfile, }, wantOut: Modules{ Name: ""srv"", Path: ""srv1"", Properties{ ""LOG_LEVEL"": ""info"", ""DEBUG_LOG_LEVEL"": ""ALL"", }, Parameters:{ ""mem"":""12G"", }, Requires: { name: ""db"", Properties{ ""CONFIG"": '[tomcontext.xml: {""service_nameDB"" : ""~{con-name}""}]' }, }, }, wantNoTests: true, wantErr: true, }, } for _, tt := range tests {t.Run(tt.name, func(t *testing.T) {gotOut := ParseFile(tt.args.contentFile)if !reflect.DeepEqual(gotOut.Modules[1], tt.wantOut) {t.Errorf(""parseFile() = %v, want %v"", gotOut.Modules[2], tt.wantOut)} parseFile() = map[], want map[LOG_LEVEL:info DEBUG_LOG_LEVEL:ALL]",Golang - Unit test for parse yaml file and check objects
"Error while using log4j in java, for debug it's working"," I want to test parse of yaml and test it via unit testIve create structs that with appropriate types but the assertion is always falid, I try with the following code which failed constantly This is the yaml content which is valid (maybe with the copy it changed but I was able to parse it correctly) This is the test I was created This is the assertion code The error is : How should I overcome it to check the module properties ? The ParseFile method is just err := yaml.Unmarshal([]byte(yamlFile), &yamlconent) <code>  ID: demoversion: 0.0.5dep: - name: db path: mtb requires: - name: vi_db - name: srv path: srv1 properties: LOG_LEVEL: ""info"" parameters: mem: 12G requires: - name: db properties: func Test_parseFile(t *testing.T) { yamlfile, err := ioutil.ReadFile(""./testdata/file.yaml"") type Properties map[string]string type Parameters map[string]interface{} type Modules struct { Name string Path string `yaml:""path,omitempty""` Requires []Requires `yaml:""requires,omitempty""` Properties Properties `yaml:""properties,omitempty""` } type Requires struct { Name string `yaml:""name,omitempty""` Properties Properties `yaml:""properties,omitempty""` } type args struct { contentFile []byte } tests := []struct { name string args args wantOut Properties wantNoTests bool wantErr bool }{ { name: ""test"", args: args{ contentFile: yamlfile, }, wantOut: Modules{ Name: ""srv"", Path: ""srv1"", Properties{ ""LOG_LEVEL"": ""info"", ""DEBUG_LOG_LEVEL"": ""ALL"", }, Parameters:{ ""mem"":""12G"", }, Requires: { name: ""db"", Properties{ ""CONFIG"": '[tomcontext.xml: {""service_nameDB"" : ""~{con-name}""}]' }, }, }, wantNoTests: true, wantErr: true, }, } for _, tt := range tests {t.Run(tt.name, func(t *testing.T) {gotOut := ParseFile(tt.args.contentFile)if !reflect.DeepEqual(gotOut.Modules[1], tt.wantOut) {t.Errorf(""parseFile() = %v, want %v"", gotOut.Modules[2], tt.wantOut)} parseFile() = map[], want map[LOG_LEVEL:info DEBUG_LOG_LEVEL:ALL]",Golang - Unit test for parse yaml file and check objects
Go- Unit test for parse yaml and check object," I want to test parse of yaml and test it via unit testIve create structs that with appropriate types but the assertion is always falid, I try with the following code which failed constantly This is the yaml content which is valid (maybe with the copy it changed but I was able to parse it correctly) This is the test I was created This is the assertion code The error is : How should I overcome it to check the module properties ? The ParseFile method is just err := yaml.Unmarshal([]byte(yamlFile), &yamlconent) <code>  ID: demoversion: 0.0.5dep: - name: db path: mtb requires: - name: vi_db - name: srv path: srv1 properties: LOG_LEVEL: ""info"" parameters: mem: 12G requires: - name: db properties: func Test_parseFile(t *testing.T) { yamlfile, err := ioutil.ReadFile(""./testdata/file.yaml"") type Properties map[string]string type Parameters map[string]interface{} type Modules struct { Name string Path string `yaml:""path,omitempty""` Requires []Requires `yaml:""requires,omitempty""` Properties Properties `yaml:""properties,omitempty""` } type Requires struct { Name string `yaml:""name,omitempty""` Properties Properties `yaml:""properties,omitempty""` } type args struct { contentFile []byte } tests := []struct { name string args args wantOut Properties wantNoTests bool wantErr bool }{ { name: ""test"", args: args{ contentFile: yamlfile, }, wantOut: Modules{ Name: ""srv"", Path: ""srv1"", Properties{ ""LOG_LEVEL"": ""info"", ""DEBUG_LOG_LEVEL"": ""ALL"", }, Parameters:{ ""mem"":""12G"", }, Requires: { name: ""db"", Properties{ ""CONFIG"": '[tomcontext.xml: {""service_nameDB"" : ""~{con-name}""}]' }, }, }, wantNoTests: true, wantErr: true, }, } for _, tt := range tests {t.Run(tt.name, func(t *testing.T) {gotOut := ParseFile(tt.args.contentFile)if !reflect.DeepEqual(gotOut.Modules[1], tt.wantOut) {t.Errorf(""parseFile() = %v, want %v"", gotOut.Modules[2], tt.wantOut)} parseFile() = map[], want map[LOG_LEVEL:info DEBUG_LOG_LEVEL:ALL]",Golang - Unit test for parse yaml file and check objects
gRPC (go) private channels," Is it possible to only stream to certain clients from a gRPC server? I believe what I'm looking for is something like Pusher, where you have a channel for a client and you can publish messages that can be seen only by a client that has access to that channel.What I'm struggling with is understanding what are the steps we need to take to do something like this.Thinking about web-sockets I believe we can store each client connection, then we can find that connection and send messages. How can we do a similar thing with gRPC? <code> ",gRPC private channels
Reflect on struct passed into interface{} in function parameter - Golang," I pass struct into a function as interface{}. Then inside I work with it using reflect to get the struct attributes. Here's the code: I got an error on the line for i:=0; i < val.NumField(); i++ { in BindStruct function. The error message is:panic: reflect: call of reflect.Value.NumField on interface ValueIf I remove & from params := BindStruct(&i) becoming params := BindStruct(i) in Migrate function, I get this error:panic: runtime error: invalid memory address or nil pointerdereference[signal SIGSEGV: segmentation violation code=0x1 addr=0x0 pc=0x4ff457]What gives? <code>  func (db *DB) Migrate(domain ...interface{}) { // statement := ""CREATE TABLE IF NOT EXISTS %s (%s, %s, %s, %s, %s)"" for _,i := range domain { params := BindStruct(&i) statement := CreateStatement(""create"", len(params)) _,err := db.Exec(fmt.Sprintf(statement, params...)) if err != nil { log.Fatal(""Error migrating database schema - "", err) break } }} func BindStruct(domain interface{}) (params []interface{}) { tableName := reflect.TypeOf(domain).Elem().Name() params = append(params, tableName) val := reflect.ValueOf(domain).Elem() for i:=0; i < val.NumField(); i++ { field := val.Type().Field(i) tag := field.Tag fieldName := field.Name fieldType := tag.Get(""sql_type"") fieldTags := tag.Get(""sql_tag"") paramstring := fieldName + "" "" + fieldType + "" "" + fieldTags params = append(params, paramstring) } return params}",Reflect on struct passed into interface{} function parameter
How do I parse an RSA public key in Golang?," Why do I get the error ssh: short read from the following code: Is the key string in the wrong format?What is the correct format for the public key? <code>  package mainimport ( ""golang.org/x/crypto/ssh"" ""testing"")func TestPublicKeyParsing(t *testing.T) { key := ""ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDhZgLqiZYDKCWhyi2gUXIRwIPyMSyXZ6yrwsm3PYfIvFB60kVlNgqDpPVhWoH6eRfaQ1y/xbg4nClZmHEDTvLbTQ1ZoQzzjZ7zvM6aQ4nADmKcCYswEuU94axouVjsHNyMLfOkPXuGec0fChwQ2JDh/B9LCiSDxyhCOgHvETXGXsyBMKjn498iPjJ6snzk35dy5wPZRz41g3dLaygF+wYAT791u/JchHQL7OP7RoNgby+RM16SYZs1tgQVkfU//o+AyTarWYLVDpFU6HPPenE4xEXhbgqd7x3wSNPBsMvY8Zjcu3kdHtboJidyMtKeD8ghV/T24kME58TW15T8Eg8R"" _, err := ssh.ParsePublicKey([]byte(key)) if err != nil { t.Errorf(""ERROR! %s"", err) }}",How do I parse an RSA public key in Go?
what dose P mean in go's sync.Pool source code?," Recently, I've been digging into Go's source code. When I looked into the details of sync.Pool, I found a comment I couldn't understand.https://golang.org/src/sync/pool.go?s=1633:1992#L58 Local per-P Pool appendix.What does per-P mean? Can be used only by the respective PWhat does P mean? <code>  // Local per-P Pool appendix.type poolLocalInternal struct { private interface{} // Can be used only by the respective P. shared []interface{} // Can be used by any P. Mutex // Protects shared.}",What does P mean in Go's sync.Pool source code?
golang convert interface to struct," How should I do for converting interface{} to Field(CommandID, Language...) in InitField() function? I try to directly type assert by but it not working.I have tried to use unsafe.Pointer but failed also. <code>  type SipField interface { Info() (id, name, defaultValue string, length int)}type Field stringfunc (f *Field) Get() string { return string(*f)}func (f *Field) Set(s string) { *f = Field(s)}type CommandID Fieldfunc (cid *CommandID) Info() (id, name, defaultValue string, length int) { return """", ""command ID"", """", 2}type Language Fieldfunc (l *Language) Info() (id, name, defaultValue string, length int) { return """", ""language"", ""019"", 3}func InitField(f interface{}, val string) error { sipField, ok := f.(SipField) if !ok { return errors.New(""InitField: require a SipField"") } _, _, defaultValue, length := sipField.Info() field, ok := f.(*Field) if !ok { return errors.New(""InitField: require a *Field"") } return nil} field, ok := f.(*Field)",Convert interface to struct
convert interface to struct," How should I do for converting interface{} to Field(CommandID, Language...) in InitField() function? I try to directly type assert by but it not working.I have tried to use unsafe.Pointer but failed also. <code>  type SipField interface { Info() (id, name, defaultValue string, length int)}type Field stringfunc (f *Field) Get() string { return string(*f)}func (f *Field) Set(s string) { *f = Field(s)}type CommandID Fieldfunc (cid *CommandID) Info() (id, name, defaultValue string, length int) { return """", ""command ID"", """", 2}type Language Fieldfunc (l *Language) Info() (id, name, defaultValue string, length int) { return """", ""language"", ""019"", 3}func InitField(f interface{}, val string) error { sipField, ok := f.(SipField) if !ok { return errors.New(""InitField: require a SipField"") } _, _, defaultValue, length := sipField.Info() field, ok := f.(*Field) if !ok { return errors.New(""InitField: require a *Field"") } return nil} field, ok := f.(*Field)",Convert interface to struct
Go: Idiomatic Replacement for map/reduce/filter/etc," I have a list of things in a go program. I want to loop over them, and perform some operation on/with a subset of those things. Is there more elegant/idiomatic code for doing this than the following? The large context -- I'm coming from languages where map/reduce/filter/etc are popular patterns for this sort of thing, but word on the internet is that those sorts of higher level abstractions aren't really a go-ish thing to do. Is there something more elegant than guard/continue clauses in my range blocks for this sort of code? <code>  for key, value := range listOfThings { if(!value.Enabled) { continue; } doTheThing(key, value)}",Idiomatic Replacement for map/reduce/filter/etc
Golang pass multiple values from template to template?," My City struct is like this: And Region struct is: In main I try to do this: Is it possible to do something like this inside template?  <code>  type City struct { ID int Name string Regions []Region} type Region struct { ID int Name string Shops []Destination Masters []Master EducationCenters []Destination} tpl.ExecuteTemplate(resWriter,""cities.gohtml"",CityWithSomeData) {{range .}} {{$city:=.Name}} {{range .Regions}} {{$region:=.Name}} {{template ""data"" .Shops $city $region}} {{end}}{{end}}",How to pass multiple values from template to template?
I want a confirmation from some golang master about if there is a resource leak here," This function is from the slides of Rob Pike on go concurrency patterns in 2012. I think there is a resource leak in this function. As the function return after the first send & receive pair happens on channel c, the other go routines try to send on channel c. So there is a resource leak here. Anyone knows golang well can confirm this? And how can I detect this leak using what kind of golang tooling? <code>  func First(query string, replicas ...Search) Result { c := make(chan Result) searchReplica := func(i int) { c <- replicas[i](query) } for i := range replicas { go searchReplica(i) } return <-c}",Is there a resource leak here?
Is a resource leak here?," This function is from the slides of Rob Pike on go concurrency patterns in 2012. I think there is a resource leak in this function. As the function return after the first send & receive pair happens on channel c, the other go routines try to send on channel c. So there is a resource leak here. Anyone knows golang well can confirm this? And how can I detect this leak using what kind of golang tooling? <code>  func First(query string, replicas ...Search) Result { c := make(chan Result) searchReplica := func(i int) { c <- replicas[i](query) } for i := range replicas { go searchReplica(i) } return <-c}",Is there a resource leak here?
How to get list off all channels using discordgo?," I would like to send a message on all text channels of my private discord server using a bot.I have connected and can have a Session object but I'm not sure how to get a list of all available channels from the Session. Is this even possible with the discord API? <code>  dg, err := discordgo.New(""Bot "" + Token)if err != nil { fmt.Println(""error creating Discord session,"", err) return}// Open a websocket connection to Discord and begin listening.err = dg.Open()if err != nil { fmt.Println(""error opening connection,"", err) return}// Get all channel ID's from dg here",How to get list of all channels using discordgo?
How to convert a uint64 to big.INT in golang?," I was wondering how can I convert a uint64 to big.Int in golang? the shortest way. I have tried new(big.Int).SetInt64(int64(a uint64 number)). I don't like it cause it's long, too much nested conversions and I'd rather use a built-in function if it exists. <code> ",How to convert a uint64 to big.Int in golang?
How to learn internals of golang? For noob," Recently I've participated several Go job interviews. The first one asked me How is channel implemented?, then the second one asked How is goroutine implemented?. Well as you can guess, the next one asked How is a Go interface implemented?.I've been using Go for six months, but to be honest I never did care or know these Go internals.I tried to learn these by reading the source code of Go, but can't really understand the quintessence.So the question is, for a noob in Go, how do I learn the Go internals? <code> ",How to learn internals of the Go Programming Language? For noob
How to learn internals of of the Go Programming Lanauge? For noob," Recently I've participated several Go job interviews. The first one asked me How is channel implemented?, then the second one asked How is goroutine implemented?. Well as you can guess, the next one asked How is a Go interface implemented?.I've been using Go for six months, but to be honest I never did care or know these Go internals.I tried to learn these by reading the source code of Go, but can't really understand the quintessence.So the question is, for a noob in Go, how do I learn the Go internals? <code> ",How to learn internals of the Go Programming Language? For noob
Handling optional boolean values in Golang," I'm failing to understand how I can work around the problem I'm experiencing in my own application.Imagine this example of a struct that models an incoming request and a function that puts the fields from that request into a database. Now this obviously works fine if I know I will be given a value for all fields of my request model, but that's not a common requirement in reality. How do people generally model ""optional"" semantics for bool values given that bool has a zero value that is valid in essentially all contexts? <code>  type NewBooleanRequest struct { RequiredString string `json:""requiredString""` OptionalBoolean bool `json:""maybeBoolean""`}func LogBooleanRequest(req NewBooleanRequest, db *sql.DB) { db.Exec(""INSERT INTO log (booleanValue, stringValue) VALUES ($1, $2)"", req.OptionalBoolean, req.RequiredString)}",Handling optional boolean values
How to split a long golang template function across multiple lines?," I have a very long printf call in a Go template. Example: How can I split this across multiple lines (like below)? <code>  {{ printf ""mongodb://%s:%s@%s/%s?authSource=admin&replicaSet=%s&readPreference=nearest&w=majority"" .Values.rocketchat.mongo.username .Values.rocketchat.mongo.password .Values.rocketchat.mongo.database .Values.mongodb-replicaset.replicaSetName | b64enc | quote }} {{ printf ""mongodb://%s:%s@%s/%s?authSource=admin&replicaSet=%s&readPreference=nearest&w=majority"" .Values.rocketchat.mongo.username .Values.rocketchat.mongo.password .Values.rocketchat.mongo.database .Values.mongodb-replicaset.replicaSetName | b64enc | quote }}",How to split a long Go template function across multiple lines?
dlv exec <path/to/binary>, I would like to pass arguments to the binary file when executing it with dlv But when I am doing it I get following error: How can I pass arguments to binary when using dlv debugger? <code>  dlv --listen=:5432 exec /mypath/binary --config=config.toml Error: unknown flag: --config,Passing arguments to executable when debugging with Delve
convert 12 hour format to 24 hour format tim ein golang," In golang I have not found any way to convert 12 hour format string time to 24 hour format as below: I have tried below using layout Output is: I have looked for answers similar to this but it is not helping everyone is using whole layout. I found answers in another language but not in go. <code>  07:05:45PM to 19:05:45 layout := ""Mon Jan 2 15:04:05 -0700 MST 2006""/* * Write your code here. *///layout := ""3:04PM""t,_ := time.Parse(layout,s)fmt.Println(t) 07:05:45PM",convert 12 hour format to 24 hour format time in golang
can golang function return interface{}{}," I want return map[string]interface{}{} in my code.but i got compile error syntax error: unexpected [ after top level declarationif i change map[string]interface{}{} to interface{}, there is no compile error any more.Attention i use map[string]interface{}{} because i want return a map list. <code>  func getLatestTxs() map[string]interface{}{} { fmt.Println(""hello"") resp, err := http.Get(""http://api.etherscan.io/api?module=account&action=txlist&address=0x266ac31358d773af8278f625c4d4a35648953341&startblock=0&endblock=99999999&sort=asc&apikey=5UUVIZV5581ENPXKYWAUDGQTHI956A56MU"") defer resp.Body.Close() body, _ := ioutil.ReadAll(resp.Body) if err != nil { fmt.Errorf(""etherscan"") } ret := map[string]interface{}{} json.Unmarshal(body, &ret) if ret[""status""] == 1 { return ret[""result""] }}",can golang function return interface{}{} - how to return a map list
How to ignore Generated files from Go test coverage, I have a generated file in my package with DO NOT EDIT on top. I am running tests for my package with go test -coverprofile=cover.out <package>. This creates coverage profile and shows total coverage percentage. But it also includes generated files while calculating the coverage. Is there a way to ignore generated files in coverage calculation? <code> ,How to ignore generated files from Go test coverage
How to add Clone and Copy functions in mocking mongodb in golang, I read this article and it has good guides for mocking MongoDB in Go. But there are some problems in Clone() and Copy() methods.I create this interfaces and structs: But I got this error cannot use s.dbSession.Clone() (type *mgo.Session) as type ISession in return argument: *mgo.Session does not implement ISession (wrong type for Clone method) have Clone() *mgo.Session want Clone() ISession cannot use s.dbSession.Copy() (type *mgo.Session) as type ISession in return argument: *mgo.Session does not implement ISession (wrong type for Clone method) have Clone() *mgo.Session want Clone() ISessionHow can I add Clone() and Copy() methods to interface? <code>  type ISession interface { DB(name string) IDatabase Close() Clone() ISession Copy() ISession}type IDatabase interface { C(name string) ICollection}type MongoSession struct { dbSession *mgo.Session}func (s MongoSession) DB(name string) IDatabase { return &MongoDatabase{Database: s.dbSession.DB(name)}}func (s MongoSession) Clone() ISession { //return session.clone return s.dbSession.Clone()}func (s MongoSession) Copy() ISession { return s.dbSession.Copy()},How to add Clone and Copy functions in mocking MongoDB in Go?
Go: Cant import module," I am following instructions in https://golang.org/doc/code.html#Workspaces link and I build my first Go program.So, I tried to make library with this instruction = https://golang.org/doc/code.html#Libraryand everything is perfect until building hello.go, its gives me this error. /hello.go:10:13: undefined: stringutil.ReverseI've already rebuild my reverse.go.Thats my code: that's my reverse.go (same as docs) and my gopath variable and my files ar in  <code>  package mainimport ( ""fmt"" ""github.com/d35k/stringutil"")func main() { fmt.Printf(stringutil.Reverse(""!oG ,olleH""))} package stringutilfunc reverse(s string) string { r := []rune(s) for i, j := 0, len(r)-1; i < len(r)/2; i, j = i+1, j-1 { r[i], r[j] = r[j], r[i] } return string(r)} export GOPATH=$HOME/GoLang GoLang/src/github.com/mygithubusername/",Exported functions from another package
undefined: stringutil.Reverse," I am following instructions in https://golang.org/doc/code.html#Workspaces link and I build my first Go program.So, I tried to make library with this instruction = https://golang.org/doc/code.html#Libraryand everything is perfect until building hello.go, its gives me this error. /hello.go:10:13: undefined: stringutil.ReverseI've already rebuild my reverse.go.Thats my code: that's my reverse.go (same as docs) and my gopath variable and my files ar in  <code>  package mainimport ( ""fmt"" ""github.com/d35k/stringutil"")func main() { fmt.Printf(stringutil.Reverse(""!oG ,olleH""))} package stringutilfunc reverse(s string) string { r := []rune(s) for i, j := 0, len(r)-1; i < len(r)/2; i, j = i+1, j-1 { r[i], r[j] = r[j], r[i] } return string(r)} export GOPATH=$HOME/GoLang GoLang/src/github.com/mygithubusername/",Exported functions from another package
Unmarshal inconsistant json," I am having trouble Unmarshalling some Json I don't have control over.There is one field that 99% of the time is a string but occasionally is an array. Json is as follows: error: json: cannot unmarshal array into Go struct field MyListItem.display_name of type string <code>  type MyListItem struct { Date string `json:""date""` DisplayName string `json:""display_name""`}type MyListings struct { CLItems []MyListItem `json:""myitems""`}var mylist MyListingserr = json.Unmarshal(jsn, &mylist)if err != nil { fmt.Print(""JSON:\n%s\n error:%v\n"", string(jsn),err) return} { ""date"": ""30 Apr"", ""display_name"": ""Mr Smith""},{ ""date"": ""30 Apr"", ""display_name"": [""Mr Smith"", ""Mr Jones""],}",How to Unmarshal an inconsistent JSON field that can be a string *or* an array of string?
Go simple string interpolation," Trying to interpolate an int value into a string using %v formatter as follows, yet nothing is printed, How to interpolate an int value ? <code>  package mainimport ""fmt""func inc(i int) int { return i + 1}func main() { fmt.Sprintln(""inc 1 equal %v"", inc(1))}",Go string interpolation
reflect: call of reflect.Value.FieldByName on ptr Value in Golang," I have a data structure like this demo. and the code: when i do not use point for Family , it back ""bari"" and it is ok.But with point , there is this error . reflect: call of reflect.Value.FieldByName on ptr ValueI searched a lot but i can not find answer can help. <code>  type Family struct { first string last string}type Person struct { name string family *Family}func main(){ per1 := Person{name:""niki"",family:&Familys{first:""yam"",last:""bari""}} Check(per1)} var validate *validator.Validatefunc Check(data interface{}) { var v = reflect.ValueOf(data) if v.Kind() == reflect.Struct { fmt.Println(""was a struct"") v = v.FieldByName(""family"").FieldByName(""last"") fmt.Println(v) }}",reflect: call of reflect.Value.FieldByName on ptr Value
grpc: golang: does the server use one new goroutine to process one method call?, How does golang grpc implementation handle the server concurrency?One goroutine per method call? Or sort of goroutine pool?Does it depend on the concurrency model of net/http2? <code> ,Does the grpc server use one new goroutine to process one method call?
Does the server use one new goroutine to process one method call?, How does golang grpc implementation handle the server concurrency?One goroutine per method call? Or sort of goroutine pool?Does it depend on the concurrency model of net/http2? <code> ,Does the grpc server use one new goroutine to process one method call?
"GOlang, function which accepts array of arbitrary size as argument (is it possible?)"," Q: Is there a way, in golang, to define a function which accepts an array of arbitrary length as argument?e.g., I have understood that in golang, array length is part of the variable type, for this reason the following function is not going to accept one arbitrary array as input This function is not going to compile with arrInput [6]int as input--i.e., demoArray(arrInput) will fail to compile. Also the following function, which accepts a slice argument, does not accept arrays as arguments (different types, as expected): i.e., demoSlice(arrInput) does not compile, expects a slice not an array.The question is, is there a way to define a function that takes arrays of arbitrary length (arrays, NOT slice)? It looks quite strange and limiting for a language to impose this constraint.The question makes sense independently from the motivation, but, in my case, the reason behind is the following. I have a set of functions which takes as arguments data structures of type [][]int. I noticed that GOB serialization for them is 10x slower (MB/s) than other data structures I have. I suppose that may be related to the chain of derefencing operations in slices. Moving from slices to array--i.e.,defining objects of type [10000][128]int--may improve situation (I hope). RegardsP.s: I remind now that Go, passes/uses things 'by value', using arrays may be overkill cause golang is going to copy them lot of times. I think I'll stay with slices and I'll try to understand GOB internals a bit. <code>  function demoArrayMagic(arr [magic]int){....} function demoArray(arr [2]int){....} function demoSlice(arr []int){....}",Function which accepts array of arbitrary size as argument (is it possible in Golang?)
Function which accepts array of arbitrary size as argument (is it possible?)," Q: Is there a way, in golang, to define a function which accepts an array of arbitrary length as argument?e.g., I have understood that in golang, array length is part of the variable type, for this reason the following function is not going to accept one arbitrary array as input This function is not going to compile with arrInput [6]int as input--i.e., demoArray(arrInput) will fail to compile. Also the following function, which accepts a slice argument, does not accept arrays as arguments (different types, as expected): i.e., demoSlice(arrInput) does not compile, expects a slice not an array.The question is, is there a way to define a function that takes arrays of arbitrary length (arrays, NOT slice)? It looks quite strange and limiting for a language to impose this constraint.The question makes sense independently from the motivation, but, in my case, the reason behind is the following. I have a set of functions which takes as arguments data structures of type [][]int. I noticed that GOB serialization for them is 10x slower (MB/s) than other data structures I have. I suppose that may be related to the chain of derefencing operations in slices. Moving from slices to array--i.e.,defining objects of type [10000][128]int--may improve situation (I hope). RegardsP.s: I remind now that Go, passes/uses things 'by value', using arrays may be overkill cause golang is going to copy them lot of times. I think I'll stay with slices and I'll try to understand GOB internals a bit. <code>  function demoArrayMagic(arr [magic]int){....} function demoArray(arr [2]int){....} function demoSlice(arr []int){....}",Function which accepts array of arbitrary size as argument (is it possible in Golang?)
mgo: Partial update of embedded document," I have the following model: I am using pointers, in order to be able to distinguish between a missing value (nil) and default value (eg empty strings, false values etc). I also use omitempty to be able to do partial updates.When I create a user I get the following (correct) response back: When I try to update the document though I have an issue.I send the changes as a new UserModel, to only change the FirstName field in the embedded document like this: The code I use to do the update is the following: The response I get back is the following: The createdAt value is not null (as I expected) however the lastName value is null (which is not what I expected)I would have expected to get back the following: What can I do to achieve a partial update in a subdocument using mgo? <code>  type UserModel struct { Id string `bson:""_id,omitempty""` CreatedAt *time.Time `bson:""createdAt,omitempty""` BasicInfo *UserBasicInfoModel `bson:""basicInfo,omitempty""`}// *Embedded document*type UserBasicInfoModel struct { FirstName *string `bson:""firstName,omitempty""` LastName *string `bson:""lastName,omitempty""`} ""id"": ""aba19b45-5e84-55e0-84f8-90fad41712f6"",""createdAt"": ""2018-05-26T15:08:56.764453386+03:00"",""basicInfo"": { ""firstName"": ""Initial first name"", ""lastName"": ""Initial last name""} newFirstName := ""New Value""UserModel{ BasicInfo: &UserBasicInfoModel{ FirstName: &newFirstName, },} UpdateId(id, bson.M{""$set"": changes}) ""id"": ""aba19b45-5e84-55e0-84f8-90fad41712f6"",""createdAt"": ""2018-05-26T12:08:56.764Z"",""basicInfo"": { ""firstName"": ""New Value"", ""lastName"": null} ""id"": ""aba19b45-5e84-55e0-84f8-90fad41712f6"",""createdAt"": ""2018-05-26T12:08:56.764Z"",""basicInfo"": { ""firstName"": ""New Value"", ""lastName"": ""Initial last name""}",Partial update of embedded document in mongoDB using mgo
Partial update of embedded document," I have the following model: I am using pointers, in order to be able to distinguish between a missing value (nil) and default value (eg empty strings, false values etc). I also use omitempty to be able to do partial updates.When I create a user I get the following (correct) response back: When I try to update the document though I have an issue.I send the changes as a new UserModel, to only change the FirstName field in the embedded document like this: The code I use to do the update is the following: The response I get back is the following: The createdAt value is not null (as I expected) however the lastName value is null (which is not what I expected)I would have expected to get back the following: What can I do to achieve a partial update in a subdocument using mgo? <code>  type UserModel struct { Id string `bson:""_id,omitempty""` CreatedAt *time.Time `bson:""createdAt,omitempty""` BasicInfo *UserBasicInfoModel `bson:""basicInfo,omitempty""`}// *Embedded document*type UserBasicInfoModel struct { FirstName *string `bson:""firstName,omitempty""` LastName *string `bson:""lastName,omitempty""`} ""id"": ""aba19b45-5e84-55e0-84f8-90fad41712f6"",""createdAt"": ""2018-05-26T15:08:56.764453386+03:00"",""basicInfo"": { ""firstName"": ""Initial first name"", ""lastName"": ""Initial last name""} newFirstName := ""New Value""UserModel{ BasicInfo: &UserBasicInfoModel{ FirstName: &newFirstName, },} UpdateId(id, bson.M{""$set"": changes}) ""id"": ""aba19b45-5e84-55e0-84f8-90fad41712f6"",""createdAt"": ""2018-05-26T12:08:56.764Z"",""basicInfo"": { ""firstName"": ""New Value"", ""lastName"": null} ""id"": ""aba19b45-5e84-55e0-84f8-90fad41712f6"",""createdAt"": ""2018-05-26T12:08:56.764Z"",""basicInfo"": { ""firstName"": ""New Value"", ""lastName"": ""Initial last name""}",Partial update of embedded document in mongoDB using mgo
Difference between []*Users and *[]Users golang struct," While I had to point some data to a struct, I just got confused on the difference between []*Users and *[]Users in Golang structI have following struct <code>  type Users struct { ID int Name string}",Difference between []*Users and *[]Users in Golang?
Why even use exec() or prepared statements in Golang?," I'm using golang with Postgresql.It says here that for operations that do not return rows (insert, delete, update) we should use exec() If a function name includes Query, it is designed to ask a question of the database, and will return a set of rows, even if its empty. Statements that dont return rows should not use Query functions; they should use Exec().Then it says here: Go creates prepared statements for you under the covers. A simple db.Query(sql, param1, param2), for example, works by preparing the sql, then executing it with the parameters and finally closing the statement.If query() uses under the covers prepared statements why should I even bother using prepared statements? <code> ",Why even use *DB.exec() or prepared statements in Golang?
Golang code organization aka does db.Close() need to be called?," So far the hardest part of Go has been understanding how to organize code. It seems incredibly simple on it's face but every time I've tried to do anything I run into circular imports or things like ""exported func Start returns unexported type models.dbStore, which can be annoying to use"".Using the following code how do I call db.Close() or am I really not understanding how I'm supposed to provide the database to my models. Here's what I've got:App.go Users.go main.go I thought about doing a app.Shutdown() but that wouldn't work for my most normal use case which is CTRL-C. It would seem if I don't close the database the DB connections would just grow... Just trying to understand. <code>  package appimport ( ""database/sql"" // Comment _ ""github.com/mattn/go-sqlite3"")var ( // DB The database connection db *sql.DB)// Setup Sets up the many many app settingsfunc Setup() { d, err := sql.Open(""sqlite3"", ""./foo.db"") if err != nil { panic(err) } // TODO: How does the DB get closed? // defer db.Close() db = d}// GetDB Returns a reference to the databasefunc GetDB() *sql.DB { return db} package modelsimport ( ""github.com/proj/org/app"")// User structtype User struct { ID int}// CreateUser Creates a userfunc (u *User) CreateUser() (int64, error) { // For the sake of brevity just make sure you can // ""connect"" to the database if err := app.GetDB().Ping(); err != nil { panic(err) } return 1234, nil} package mainimport ( ""fmt"" ""net/http"" _ ""github.com/mattn/go-sqlite3"" ""github.com/proj/org/app"" ""github.com/proj/org/models"")func homeHandler(w http.ResponseWriter, r *http.Request) { fmt.Fprintf(w, ""You are home"")}func subscribeHandler(w http.ResponseWriter, r *http.Request) { fmt.Fprintf(w, ""Subscribing..."") u := models.User{} u.CreateUser()}func main() { fmt.Println(""Running"") app.Setup() http.HandleFunc(""/"", homeHandler) http.HandleFunc(""/subscribe"", subscribeHandler) err := http.ListenAndServe("":9090"", nil) if err != nil { panic(err) }}",Does db.Close() need to be called?
How to connect to Bigtable Emulator to GoLang application? How to use it?," I am trying to use BigTable Emulator. I have never used it before. I followed the documentation but not able to understand,How to connect an application to Emulator.How to set BIGTABLE_EMULATOR_HOST environment variable.Please help by explaining it or pointing me to any examples or links.Thank you. <code> ",How to connect to Bigtable Emulator from a GoLang application? How to use it?
Golang (SQLite3) - database is locked (defering rows didn't work)," I have a problem with SQLite3 in my Golang project. I want to insert data into my database but It gives me error database is locked. I know that it was here the same question (Sqlite3 error: database is locked in golang) but answer from there didn't work. I don't know what I'm doing wrong. Here is my code: Thanks in advance for the help! <code>  var ( tpl *template.Template db, _ = sql.Open(""sqlite3"", ""database/pastozbior.db""))func main() { http.HandleFunc(""/"", addCopypasta) http.ListenAndServe("":8000"", nil)} func getCopypasta() []Copypasta { copypastaList := []Copypasta{} var title, body string rows, _ := db.Query(""select title, body from copypasta"") for rows.Next() { rows.Scan(&title, &body) copypastaList = append(copypastaList, Copypasta{title, body}) } defer rows.Close() return copypastaList}func addCopypasta(w http.ResponseWriter, r *http.Request) { tpl.ExecuteTemplate(w, ""main.html"", nil) if r.Method == ""POST"" { r.ParseForm() // add copypasta to database stmt, err := db.Prepare(""INSERT INTO copypasta(title, body, approved) values(?,?,0)"") if err != nil { log.Fatal(err) } res, err := stmt.Exec(""testTitle"", ""TestBody"") if err != nil { log.Fatal(err) } id, err := res.LastInsertId() if err != nil { log.Fatal(err) } fmt.Println(id) }}",Database is locked (defering rows didn't work)
How to CrossCompile Go programms on Windows 10," I want to compile a Go programm for a linux machine. I always used that way which is described here:How to cross compile from Windows to Linux?That worked pretty well until the last big update from Windows 10. Now I am not able to set the GOOS with I also tried to start the PowerShell as administrator, but even that is not working.Are there any tools which can do that? Or is there another way to crosscompile Go program on Windows 10? <code>  set GOOS=linux",How to CrossCompile Go programs on Windows 10
can I pin docker API version : client version 1.38 is too new. Maximum supported API version is 1.37," Is there a way to pin docker API version using the golang client? (short of using dep for vendoring)code below fails with This code ran fine until recently here is : docker version this kicks up the API version mismatch In English, the above error is because the default client version of the github repo client library is newer than version supported by Docker ... so to address the comment - one approach which works is to request a lower version of the repo library to match Docker, not to request a higher versionBelow approach to negotiate also works fine cli, err := client.NewClientWithOpts(client.WithAPIVersionNegotiation()) <code>  client version 1.38 is too new. Maximum supported API version is 1.37 go version go1.9.5 linux/amd64 Client: Version: 18.05.0-ce API version: 1.37 Go version: go1.9.5 Git commit: f150324 Built: Wed May 9 22:16:25 2018 OS/Arch: linux/amd64 Experimental: false Orchestrator: swarmServer: Engine: Version: 18.05.0-ce API version: 1.37 (minimum version 1.12) Go version: go1.9.5 Git commit: f150324 Built: Wed May 9 22:14:32 2018 OS/Arch: linux/amd64 Experimental: false package main// kill off some containersimport ( ""fmt"" ""github.com/docker/docker/api/types"" ""github.com/docker/docker/client"" ""golang.org/x/net/context"" ""strings"")func main() { ctx := context.Background() cli, err := client.NewEnvClient() if err != nil { panic(err) // <--- crashes here due to API mismatch } containers, err := cli.ContainerList(ctx, types.ContainerListOptions{}) if err != nil { panic(err) } for _, container := range containers { if strings.Contains(container.Image, ""enduser"") || strings.Contains(container.Image, ""admin"") { fmt.Println(""\n we found enduser or admin so lets stop it\n"") fmt.Print(""Stopping container "", container.ID[:10], ""... "") if err := cli.ContainerStop(ctx, container.ID, nil); err != nil { panic(err) } fmt.Println(""Success"") } }}",Can I pin docker API version : client version 1.38 is too new. Maximum supported API version is 1.37
versioning - can I pin docker API version : client version 1.38 is too new. Maximum supported API version is 1.37," Is there a way to pin docker API version using the golang client? (short of using dep for vendoring)code below fails with This code ran fine until recently here is : docker version this kicks up the API version mismatch In English, the above error is because the default client version of the github repo client library is newer than version supported by Docker ... so to address the comment - one approach which works is to request a lower version of the repo library to match Docker, not to request a higher versionBelow approach to negotiate also works fine cli, err := client.NewClientWithOpts(client.WithAPIVersionNegotiation()) <code>  client version 1.38 is too new. Maximum supported API version is 1.37 go version go1.9.5 linux/amd64 Client: Version: 18.05.0-ce API version: 1.37 Go version: go1.9.5 Git commit: f150324 Built: Wed May 9 22:16:25 2018 OS/Arch: linux/amd64 Experimental: false Orchestrator: swarmServer: Engine: Version: 18.05.0-ce API version: 1.37 (minimum version 1.12) Go version: go1.9.5 Git commit: f150324 Built: Wed May 9 22:14:32 2018 OS/Arch: linux/amd64 Experimental: false package main// kill off some containersimport ( ""fmt"" ""github.com/docker/docker/api/types"" ""github.com/docker/docker/client"" ""golang.org/x/net/context"" ""strings"")func main() { ctx := context.Background() cli, err := client.NewEnvClient() if err != nil { panic(err) // <--- crashes here due to API mismatch } containers, err := cli.ContainerList(ctx, types.ContainerListOptions{}) if err != nil { panic(err) } for _, container := range containers { if strings.Contains(container.Image, ""enduser"") || strings.Contains(container.Image, ""admin"") { fmt.Println(""\n we found enduser or admin so lets stop it\n"") fmt.Print(""Stopping container "", container.ID[:10], ""... "") if err := cli.ContainerStop(ctx, container.ID, nil); err != nil { panic(err) } fmt.Println(""Success"") } }}",Can I pin docker API version : client version 1.38 is too new. Maximum supported API version is 1.37
golang how to pass type to function argument, ERROR: type CustomStruct is not an expression. How can I pass struct type to function without type instance?This will work But I wonder if there is more simple version.. <code>  type CustomStruct struct {}func getTypeName(t interface{}) string { rt := reflect.TypeOf(t).Elem() return rt.Name()}getTypeName(CustomStruct) getTypeName((*CustomStruct)(nil)),How to pass type to function argument in Go
How to pass type to function argument, ERROR: type CustomStruct is not an expression. How can I pass struct type to function without type instance?This will work But I wonder if there is more simple version.. <code>  type CustomStruct struct {}func getTypeName(t interface{}) string { rt := reflect.TypeOf(t).Elem() return rt.Name()}getTypeName(CustomStruct) getTypeName((*CustomStruct)(nil)),How to pass type to function argument in Go
golang understanding interface inside interface," I was trying to understand the Interface embedding with the following code.I have the following: Now if I have the follwoing: Now, from the MyprojectV1alpha1Interface if I want to call the Create function of SampleInterfacewhat I need to do?Also, please explain me how this interfaces work in Golang. <code>  type MyprojectV1alpha1Interface interface { RESTClient() rest.Interface SamplesGetter}// SamplesGetter has a method to return a SampleInterface.// A group's client should implement this interface.type SamplesGetter interface { Samples(namespace string) SampleInterface}// SampleInterface has methods to work with Sample resources.type SampleInterface interface { Create(*v1alpha1.Sample) (*v1alpha1.Sample, error) Update(*v1alpha1.Sample) (*v1alpha1.Sample, error) Delete(name string, options *v1.DeleteOptions) error DeleteCollection(options *v1.DeleteOptions, listOptions v1.ListOptions) error Get(name string, options v1.GetOptions) (*v1alpha1.Sample, error) List(opts v1.ListOptions) (*v1alpha1.SampleList, error) Watch(opts v1.ListOptions) (watch.Interface, error) Patch(name string, pt types.PatchType, data []byte, subresources ...string) (result *v1alpha1.Sample, err error) SampleExpansion} func returninterface() MyprojectV1alpha1Interface {//does something and returns me MyprojectV1alpha1Interface}temp := returninterface()",Understanding interface inside interface(Embedded Interface)
Understanding interface inside interface," I was trying to understand the Interface embedding with the following code.I have the following: Now if I have the follwoing: Now, from the MyprojectV1alpha1Interface if I want to call the Create function of SampleInterfacewhat I need to do?Also, please explain me how this interfaces work in Golang. <code>  type MyprojectV1alpha1Interface interface { RESTClient() rest.Interface SamplesGetter}// SamplesGetter has a method to return a SampleInterface.// A group's client should implement this interface.type SamplesGetter interface { Samples(namespace string) SampleInterface}// SampleInterface has methods to work with Sample resources.type SampleInterface interface { Create(*v1alpha1.Sample) (*v1alpha1.Sample, error) Update(*v1alpha1.Sample) (*v1alpha1.Sample, error) Delete(name string, options *v1.DeleteOptions) error DeleteCollection(options *v1.DeleteOptions, listOptions v1.ListOptions) error Get(name string, options v1.GetOptions) (*v1alpha1.Sample, error) List(opts v1.ListOptions) (*v1alpha1.SampleList, error) Watch(opts v1.ListOptions) (watch.Interface, error) Patch(name string, pt types.PatchType, data []byte, subresources ...string) (result *v1alpha1.Sample, err error) SampleExpansion} func returninterface() MyprojectV1alpha1Interface {//does something and returns me MyprojectV1alpha1Interface}temp := returninterface()",Understanding interface inside interface(Embedded Interface)
Integer array in params struct to pass in go-pg query 'params'," I'm using Go-pg and when I use the following way to execute sql query: where params is a structure like the following: and sqlQuery is in the actual SQL query I get query like this: Is it possible to have int array placeholder passed properly to have a query: <code>  db.Query(&result, sqlQuery, params) type MyParams struct { Codes []int} SELECT id FROM bar WHERE code_id IN (?codes) SELECT id FROM bar WHERE code_id IN ('[7,45]') SELECT id FROM bar WHERE code_id IN (7,45)",pass array to go-pg query
What are the long text for time.Now() in GO," I just started to learn Go by following a tutorial video on Udemy, and I tried to print the current time as below And I get a very long text as the output as below I was expecting to get only the +0800 followed by a timeZone and that should be the end of it. The expected output is shown below and as it was shown in the tutorial video, too. But for me, the result is in much longer form. The question is, why does the same command date.Now() return different formats between the instructor's program and mine? Why is there no specific format being set, shouldn't a standardize/base format being returned instead? <code>  import ( ""fmt"" ""time"")func main(){ t := time.Now() fmt.Println(t) } 2018-07-04 12:03:07.2911671 +0800 +08 m=+0.002000201 2018-07-04 12:03:07.2911671 +0530 IST",Unexpected output from time.Time
time.Now() in GO," I just started to learn Go by following a tutorial video on Udemy, and I tried to print the current time as below And I get a very long text as the output as below I was expecting to get only the +0800 followed by a timeZone and that should be the end of it. The expected output is shown below and as it was shown in the tutorial video, too. But for me, the result is in much longer form. The question is, why does the same command date.Now() return different formats between the instructor's program and mine? Why is there no specific format being set, shouldn't a standardize/base format being returned instead? <code>  import ( ""fmt"" ""time"")func main(){ t := time.Now() fmt.Println(t) } 2018-07-04 12:03:07.2911671 +0800 +08 m=+0.002000201 2018-07-04 12:03:07.2911671 +0530 IST",Unexpected output from time.Time
time.Now() in Go," I just started to learn Go by following a tutorial video on Udemy, and I tried to print the current time as below And I get a very long text as the output as below I was expecting to get only the +0800 followed by a timeZone and that should be the end of it. The expected output is shown below and as it was shown in the tutorial video, too. But for me, the result is in much longer form. The question is, why does the same command date.Now() return different formats between the instructor's program and mine? Why is there no specific format being set, shouldn't a standardize/base format being returned instead? <code>  import ( ""fmt"" ""time"")func main(){ t := time.Now() fmt.Println(t) } 2018-07-04 12:03:07.2911671 +0800 +08 m=+0.002000201 2018-07-04 12:03:07.2911671 +0530 IST",Unexpected output from time.Time
How to iterate over an []interface{} in Golang?," I'm struggling to get the keys and values of the following interface, which is the result of JSON marshaling the result returned by Execute as demonstrated in this example: A reflect.TypeOf(result) results in: []interface{}.I've used this to loop over the array: But I'm getting stuck with errors like: reflect.Value.Interface: cannot return value obtained from unexported field or method <code>  [ [ { ""id"": 36, ""label"": ""TestThing"", ""properties"": { ""schema__testBoolean"": [ { ""id"": 40, ""value"": true } ], ""schema__testInt"": [ { ""id"": 39, ""value"": 1 } ], ""schema__testNumber"": [ { ""id"": 38, ""value"": 1.0879834 } ], ""schema__testString"": [ { ""id"": 37, ""value"": ""foobar"" } ], ""uuid"": [ { ""id"": 41, ""value"": ""7f14bf92-341f-408b-be00-5a0a430852ee"" } ] }, ""type"": ""vertex"" } ]] s := reflect.ValueOf(result)for i := 0; i < s.Len(); i++ { singleVertex := s.Index(i).Elem() // What to do here?}",How to iterate over an []interface{} in Go
How to create an array or a slice from an array pointer in golang?," A pointer to an array, let's say: I can't access to the variable array, the code above is used to make it more clear.Also, I know the size of the array, but the size is not constant, it changes according to the runtime.Now, I want to initialize a slice or an array with the known pointer, size and of course the data type.I come up with the following code: but this method does memory copy, which might be inefficient, is there anyway without doing the copy?P.S. I also tried the following two methods, but it will fail at runtime and I know its reason now. <code>  p := uintptr(unsafe.Pointer(&array))size := 5 data := make([]byte, size)stepSize := unsafe.Sizeof(data[0])for i := 0; i < size; i++ { data[i] = *(*byte)(unsafe.Pointer(p)) p += stepSize}fmt.println(data) // method 1data := *(*[]byte)(unsafe.Pointer(p))// method 2data := *(*[size]byte)(unsafe.Pointer(p))",How to create an array or a slice from an array unsafe.Pointer in golang?
Golang testing with Gomock returns error: Expected call has already been called the max number of times," I am using Gomock https://godoc.org/github.com/golang/mock and mockgenThe Source code for this test is: The test case for this Source file is here: When I run the tests I am getting the following error: sqs\controller.go:150: Unexpected call to *mocks.MockMessenger.GetMessage([]) at path_to_mocks_package/mocks/mock_messenger.go:38 because: Expected call at path_to_sqs_package/sqs/sqs_test.go:35 has already been called the max number of times. FAILIf I write my own mock as follows the test case executes successfully: <code>  package sqsimport ( ""fmt"" ""log"" ""os"" ""runtime"" ""github.com/aws/aws-sdk-go/aws/session"" ""github.com/aws/aws-sdk-go/aws"" ""github.com/aws/aws-sdk-go/service/sqs"" ""github.com/aws/aws-sdk-go/service/sqs/sqsiface"")var sess *session.Sessionvar svc *sqs.SQSvar queueURL stringfunc init() { // Setting the runtime to run with max CPUs available runtime.GOMAXPROCS(runtime.NumCPU()) sess = session.Must(session.NewSessionWithOptions(session.Options{ SharedConfigState: session.SharedConfigEnable, })) svc = sqs.New(sess) queueURL = os.Getenv(""QUEUE_URL"")}type Poller interface { Poll(chan bool)}// NewPoller is a factory to create a Poller objectfunc NewPoller(msgr Messenger) Poller { p := &poller{ m: msgr, } return p}type poller struct { m Messenger}func (p *poller) Poll(done chan bool) { sqsMsgCh := make(chan *sqs.Message, 100) for { messages, err := p.m.GetMessage() if err != nil { log.Printf(""error when getting message"") if len(messages) == 0 { // Stop the system log.Printf(""I am here"") done <- true } } for _, msg := range messages { sqsMsgCh <- msg } }}type Messenger interface { GetMessage() ([]*sqs.Message, error)}func NewMessenger() Messenger { return &messenger{ s: svc, }}type messenger struct { s sqsiface.SQSAPI}func (m *messenger) GetMessage() ([]*sqs.Message, error) { result, err := m.s.ReceiveMessage(&sqs.ReceiveMessageInput{ AttributeNames: []*string{ aws.String(sqs.MessageSystemAttributeNameSentTimestamp), }, MessageAttributeNames: []*string{ aws.String(sqs.QueueAttributeNameAll), }, QueueUrl: aws.String(queueURL), MaxNumberOfMessages: aws.Int64(10), VisibilityTimeout: aws.Int64(36000), // 10 hours WaitTimeSeconds: aws.Int64(0), }) if err != nil { fmt.Println(""Error"", err) return nil, err } msgs := result.Messages if len(msgs) == 0 { fmt.Println(""Received no messages"") return msgs, err } return msgs, nil} package sqsimport ( ""errors"" ""testing"" ""path_to_the_mocks_package/mocks"" ""github.com/golang/mock/gomock"" ""github.com/aws/aws-sdk-go/service/sqs"")func TestPollWhenNoMessageOnQueue(t *testing.T) { mockCtrl := gomock.NewController(t) defer mockCtrl.Finish() msgr := mocks.NewMockMessenger(mockCtrl) mq := make([]*sqs.Message, 1) err := errors.New(""Mock Error"") // msgr.EXPECT().GetMessage().Return(mq, err) //.Times(1) // msgr.GetMessage().Return(mq, err) //.Times(1) msgr.EXPECT().GetMessage().Return(mq, err) p := NewPoller(msgr) done := make(chan bool) go p.Poll(done) <-done t.Logf(""Successfully done: %v"", done)} type mockMessenger struct { mock.Mock}func (m *mockMessenger) GetMessage() ([]*sqs.Message, error) { msgs := make([]*sqs.Message, 0) err := errors.New(""Error"") return msgs, err}",Testing with Gomock returns error: Expected call has already been called the max number of times
Lambda Golang to DynamoDB," I'm trying to load data from Lambda using Golang into DynamoDB, however the marshalling method is just generating empty items. I have a type struct defined as below... I am then populating a slice as below.....func PutToDynamo(Flights []Flight, kind string) { Which I then try and load into DynamoDB. If I print flight, I can see all the information I expect. However, input.GoString() is just returning the below... and I get an error thrown from DynamoDB in lambda. Any ideas?? I've tried putting json:""id"" etc in the struct, but no difference.Thanks! <code>  type Flight struct { id string destination string airline string time string latest string} Flights := []Flight{}for _, row := range rows { columns := row.FindAll(""td"") f := columns[0].Text() //all these are strings a := columns[1].Text() i := columns[2].Text() t := columns[4].Text() l := columns[5].Text() flight := Flight{ id: i, destination: f, airline: a, time: t, latest: l, } Flights = append(Flights, flight) func PutToDynamo(flights []Flight, kind string) { for _, flight := range flights { av, err := dynamodbattribute.MarshalMap(flight) input := &dynamodb.PutItemInput{ Item: av, TableName: aws.String(""flights""), } _, err = svc.PutItem(input) fmt.Println(""FLIGHT: "", input.GoString()) { Item: { }, TableName: ""flights"" } ValidationException: One or more parameter values were invalid: Missing the key id in the item",Lambda Golang PutItem and MarshalMap to DynamoDB
Go | How to go 1 level back for a directory path stored in a variable," I'm trying to go back 1 level back in a stored variable in Go Lang, how could I do this? There's a function that could do that automatically? or I have to do it manually?Thanks. <code>  Origin:""/root/path""Expected:""/root/""",How to go 1 level back for a directory path stored in a variable
"Does zip.NewReader(bytes.NewReader(), len) need to be closed?"," I'm having an argument with a friend, over possible wasted resources in Go.Does a Reader have to be closed, if it's operating over an in-memory byte array? Whilst originally it was thought to be a source of File Handle Leaks, something else got the blame.Will this leak memory, or does Go have sufficient escape analysis / garbage collection that it will be fine? <code>  func readJar(zipBytes []byte, readMeta bool) (m jar.Manifest, err error) { reader, err := zip.NewReader(bytes.NewReader(zipBytes), int64(len(zipBytes))) if err != nil { return } for _, file := range reader.File { switch file.Name { case jar.ManifestPath: m, err = readManifest(file) if err != nil { return } } } return}func readManifest(file *zip.File) (jar.Manifest, error) { reader, err := file.Open() if err != nil { return nil, err } defer reader.Close() return jar.ReadManifest(reader)}","Does zip.NewReader(bytes.NewReader(), len) need to be closed or garbage collected automatically?"
"Golang split a string of one side letters, one side numbers"," Im having a mind blank on this one. I am receiving strings of the format..AB1234ABC1234ABC123AB12etc etc. Essentially, flight numbersThey could have one or two letters and anything from 1 to 5 numbers. I want to split the string so that I end up with two strings, one with the numbers and one with the letters. Any ideas? Ive looked through these but cant see one that would do the jobhttps://www.dotnetperls.com/split-goUpdate:Just found and will use this unless theres a better option. Delete all letters / numbers to create the strings needed https://golangcode.com/how-to-remove-all-non-alphanumerical-characters-from-a-string/ <code> ","Split a string of one side letters, one side numbers"
protobuf: File does not reside within any path specified using proto_path," I am testing out importing .proto file from another directory.$GOPATH/src/A/A.proto $GOPATH/src/B/B.proto I'm doing this:in folder A: and then in folder B: But I will get this error: B.proto: File does not reside within any path specified using --proto_path (or -I). You must specify a --proto_path which encompasses this file. Note that the proto_path must be an exact prefix of the .proto file names -- protoc is too dumb to figure out when two paths (e.g. absolute and relative) are equivalent (it's harder than you think). <code>  syntax = ""proto3""; package A; message SomeMsg { string msg = 2; int64 id = 3; } syntax = ""proto3""; package B; import ""A/A.proto""; message Msg { SomeMsg s = 1; } protoc A.proto --go_out=. protoc B.proto --go_out=. --proto_path=$GOPATH/",File does not reside within any path specified using proto_path
Any better way to check Endianness in Golang?," I am writing a small program to check the endianness using Go: I import ""unsafe"" package to convert *int to *byte.But as mentioned in https://golang.org/pkg/unsafe/:Package unsafe contains operations that step around the type safety of Go programs.Packages that import unsafe may be non-portable and are not protected by the Go 1 compatibility guidelines.Is there a better way to determine endianness, or do I have to use unsafe package? <code>  var i int = 0x0100ptr := unsafe.Pointer(&i)if 0x01 == *(*byte)(ptr) { fmt.Println(""Big Endian"")} else if 0x00 == *(*byte)(ptr) { fmt.Println(""Little Endian"")} else { // ...}",Any better way to check endianness in Go
how to install GO package manually from source code?," I'm living in China and is not able to download & install GO package through command (event I use the vpn network): but I can access the repo_url and downloand its source code.So my question is can I put the scource code under src folder and run commamd ? : if yes, what's the different betweeen the two way ? <code>  go get -u <repo_url> go install ",How to install Go package manually from source code
Golang: Connect with postgreSQL schema," I am looking to connect and query to a PostgreSQL. But I only want to connect to a particular Schema.As per the doc (JDBC) we can use or update As of 9.4 you can specify the url with the new currentSchema parameter like so: But I am unable to do so with golang SQL driver;As per the documents, we can also use SET search_path TO myschema,public; But I only want to declare it for once during initializing but I think this needs to be executed every time for new connection. Also I am using following code please help me identify the correct parameters to be passed to this in order to only connect with schema Adding currentSchema=myschema or searchpath=myschema is not working!Is there a way I can only connect to a particular database-schema in GO <code>  jdbc:postgresql://localhost:5432/mydatabase?searchpath=myschema jdbc:postgresql://localhost:5432/mydatabase?currentSchema=myschema db, err := sql.Open(""postgres"", `dbname=`+s.settings.Database+` user=`+s.settings.Username+` password=`+s.settings.Password+` host=`+s.settings.Url+` sslmode=disable`) ",Connect with postgreSQL schema
Changing methods of composited type," I want http.Client to add additional header for all requests. func Do never gets called if I call func PostForm that is using Do. If there is no way how to mimic OOP, how to do it least painfully? <code>  type MyClient struct { http.Client}func (c *MyClient) Do(req *http.Request) (*http.Response, error) { req.Header.Add(""User-Agent"", ""go"") return c.Client.Do(req)}",How to add default header fields from http.Client
How do you escape characters in a string using the JSON format in golang," What is the idiomatic way to escape only the characters in a string require to be escaped by the JSON specification.(I am not trying to marshal/unmarshal an object or string, I just want to escape the characters inside a string. This works, but surely there is a more idiomatic way? https://play.golang.org/p/rcHZbrjFyyH <code>  func main() { fmt.Println(jsonEscape(`dog ""fish"" cat`)) //output: dog \""fish\"" cat}func jsonEscape(i string) string { b, err := json.Marshal(i) if err != nil { panic(err) } // Trim the beginning and trailing "" character return string(b[1:len(b)-1])}",How do you escape characters within a string (JSON format)
How do you escape characters within a string (JSON format) in golang," What is the idiomatic way to escape only the characters in a string require to be escaped by the JSON specification.(I am not trying to marshal/unmarshal an object or string, I just want to escape the characters inside a string. This works, but surely there is a more idiomatic way? https://play.golang.org/p/rcHZbrjFyyH <code>  func main() { fmt.Println(jsonEscape(`dog ""fish"" cat`)) //output: dog \""fish\"" cat}func jsonEscape(i string) string { b, err := json.Marshal(i) if err != nil { panic(err) } // Trim the beginning and trailing "" character return string(b[1:len(b)-1])}",How do you escape characters within a string (JSON format)
It it OK to defer an Unlock before a Lock," I'm going over some existing code and see this repeated several times This looks wrong to me, I much prefer the idiomatic way of deferring the Unlock after performing the Lock but the documentation for Mutex.Lock doesn't specify a situation where the Lock will fail. Therefor the behaviour of the early defer pattern should be identical to the idiomatic way.My question is: is there a compelling case to say this pattern is inferior? (e.g. the Lock may fail and then the deferred Unlock will panic) and thus the code should be changed or should I leave it as is? <code>  defer mtx.Unlock()mtx.Lock()",Is it OK to defer an Unlock before a Lock
Golang parse yaml with structs," Ive created the following YAML file to provide some config which users need to provide: https://codebeautify.org/yaml-validator/cbb349ecHere I have:one environment (root)the environment contain 1..n sysEach sys contain 1..n models instance with key app-typeNow I need to parse this YAML file so I try to build a struct type like: Now I try to parse this YAML, and I get an error of index out of range.My questions are: This is the code: data is the yaml.file. <code>  Environments: sys1: models: - app-type: app1 service-type: fds"" - app-type: app2 service-type: era sys2: models: - app-type: app1 service-type: fds"" - app-type: app2 service-type: era"" type Environment struct { Environment [] sys}type sys struct{ Models []Properties}type Models struct{ app-type string `yaml:""app-type""` service-type string `yaml:""service-type""`} 1. Do I model the YAML correctly?2. Do I model the struct correctly? func main() { y := Environments{} err := yaml.Unmarshal([]byte(data), &y) if err != nil { log.Fatalf(""error: %v"", err) } fmt.Printf(""%+v\n"", y)}",Parse YAML with structs
How to update types value in loop inside loop," I have the following code which parses YAML files and needs to match values from one struct external and update the internal struct's type property.For example, this is the yaml file(translated to bin for simplicity) and content which is parsed correctly At the end what I need to do is to get the internal yaml file to be changed to the struct above internal_config_after_changes The changes are when the type=app-type I need to modify the type value in the internal_config, here from app1 to GCP and app2 to amazonThe problem is with the second loop which I should use to iterate on the external_config and the matching values, I'm not sure how to combine them both with efficient way... <code>  package mainimport ( ""fmt"" ""gopkg.in/yaml.v2"" ""log"")//internal config model for parsingtype InternalModel struct { models []Model2 `yaml:""models""`}type Model2 struct { Name string `yaml:""name""` Type string `yaml:""type""` Target string `yaml:""target""`}var internal_config = []byte(` models: - name: myapp type: app1 target: ./ - name: myapp2 type: app2 target: ./`)type ExternalConfig struct { Landscape Zone `yaml:""Landscape""`}type Zone struct { Zone string `yaml:""zone""` Models []Model `yaml:""models""`}type Model struct { AppType string `yaml:""app-type""` ServiceType string `yaml:""service-type""`}var external_config = []byte(`Landscape: zone: zone1 models: - app-type: app1 service-type: GCP - app-type: app2 service-type: AMAZON zone: zone2 models: - app-type: app3 service-type: AZURE - app-type: app4 service-type: HEROKU`)func main() { // This is the internal config which needs updated internalConfiglYaml := InternalModel{} err := yaml.Unmarshal([]byte(internal_config), &internalConfiglYaml) if err != nil { log.Fatalf(""error in model internalConfiglYaml: %v"", err) } //fmt.Printf(""%+v\n"", internalConfiglYaml) //--------------------------Second config file-----------------------// //This is the external config yaml extConfigYaml := ExternalConfig{} err = yaml.Unmarshal([]byte(external_config), &extConfigYaml) if err != nil { log.Fatalf(""error in model extConfigYaml: %v"", err) } fmt.Printf(""%+v\n"", extConfigYaml) landscape := ""zone1"" modifiedConfig := ConvertTypes(internalConfiglYaml, extConfigYaml, landscape) fmt.Printf(""%+v\n"", modifiedConfig)}func ConvertTypes(int_cfg InternalModel, ext_config ExternalConfig, landscape string) (out_cfg InternalModel) { for _, module := range int_cfg.models { switch module.Type { case ""app1"": //here I hard-coded the value ""GCP"" but it should come from the yaml struct after parsing module.Type = ""GCP"" // should be something like ext_config.models.service-type when the key in the struct case ""app2"": //here I hard-coded the value ""AMAZON"" but it should come from the yaml struct after parsing module.Type = ""AMAZON"" } } return int_cfg}//At the end what I need to do is to get the internal yaml file to be changed to the following struct//The changes are when the type=app-type I need to modify the type in the internal config, here its GCP and ruby//internal_config_after_changes := []byte(`//////models:// - name: myapp// type: GCP// target: .///// - name: myapp2// type: AMAZON// target: .///////`)",How to update value of two struct efficiently
Golang: How to update types value in loop inside loop," I have the following code which parses YAML files and needs to match values from one struct external and update the internal struct's type property.For example, this is the yaml file(translated to bin for simplicity) and content which is parsed correctly At the end what I need to do is to get the internal yaml file to be changed to the struct above internal_config_after_changes The changes are when the type=app-type I need to modify the type value in the internal_config, here from app1 to GCP and app2 to amazonThe problem is with the second loop which I should use to iterate on the external_config and the matching values, I'm not sure how to combine them both with efficient way... <code>  package mainimport ( ""fmt"" ""gopkg.in/yaml.v2"" ""log"")//internal config model for parsingtype InternalModel struct { models []Model2 `yaml:""models""`}type Model2 struct { Name string `yaml:""name""` Type string `yaml:""type""` Target string `yaml:""target""`}var internal_config = []byte(` models: - name: myapp type: app1 target: ./ - name: myapp2 type: app2 target: ./`)type ExternalConfig struct { Landscape Zone `yaml:""Landscape""`}type Zone struct { Zone string `yaml:""zone""` Models []Model `yaml:""models""`}type Model struct { AppType string `yaml:""app-type""` ServiceType string `yaml:""service-type""`}var external_config = []byte(`Landscape: zone: zone1 models: - app-type: app1 service-type: GCP - app-type: app2 service-type: AMAZON zone: zone2 models: - app-type: app3 service-type: AZURE - app-type: app4 service-type: HEROKU`)func main() { // This is the internal config which needs updated internalConfiglYaml := InternalModel{} err := yaml.Unmarshal([]byte(internal_config), &internalConfiglYaml) if err != nil { log.Fatalf(""error in model internalConfiglYaml: %v"", err) } //fmt.Printf(""%+v\n"", internalConfiglYaml) //--------------------------Second config file-----------------------// //This is the external config yaml extConfigYaml := ExternalConfig{} err = yaml.Unmarshal([]byte(external_config), &extConfigYaml) if err != nil { log.Fatalf(""error in model extConfigYaml: %v"", err) } fmt.Printf(""%+v\n"", extConfigYaml) landscape := ""zone1"" modifiedConfig := ConvertTypes(internalConfiglYaml, extConfigYaml, landscape) fmt.Printf(""%+v\n"", modifiedConfig)}func ConvertTypes(int_cfg InternalModel, ext_config ExternalConfig, landscape string) (out_cfg InternalModel) { for _, module := range int_cfg.models { switch module.Type { case ""app1"": //here I hard-coded the value ""GCP"" but it should come from the yaml struct after parsing module.Type = ""GCP"" // should be something like ext_config.models.service-type when the key in the struct case ""app2"": //here I hard-coded the value ""AMAZON"" but it should come from the yaml struct after parsing module.Type = ""AMAZON"" } } return int_cfg}//At the end what I need to do is to get the internal yaml file to be changed to the following struct//The changes are when the type=app-type I need to modify the type in the internal config, here its GCP and ruby//internal_config_after_changes := []byte(`//////models:// - name: myapp// type: GCP// target: .///// - name: myapp2// type: AMAZON// target: .///////`)",How to update value of two struct efficiently
Golang: How to update types value inside loops of structs," I have the following code which parses YAML files and needs to match values from one struct external and update the internal struct's type property.For example, this is the yaml file(translated to bin for simplicity) and content which is parsed correctly At the end what I need to do is to get the internal yaml file to be changed to the struct above internal_config_after_changes The changes are when the type=app-type I need to modify the type value in the internal_config, here from app1 to GCP and app2 to amazonThe problem is with the second loop which I should use to iterate on the external_config and the matching values, I'm not sure how to combine them both with efficient way... <code>  package mainimport ( ""fmt"" ""gopkg.in/yaml.v2"" ""log"")//internal config model for parsingtype InternalModel struct { models []Model2 `yaml:""models""`}type Model2 struct { Name string `yaml:""name""` Type string `yaml:""type""` Target string `yaml:""target""`}var internal_config = []byte(` models: - name: myapp type: app1 target: ./ - name: myapp2 type: app2 target: ./`)type ExternalConfig struct { Landscape Zone `yaml:""Landscape""`}type Zone struct { Zone string `yaml:""zone""` Models []Model `yaml:""models""`}type Model struct { AppType string `yaml:""app-type""` ServiceType string `yaml:""service-type""`}var external_config = []byte(`Landscape: zone: zone1 models: - app-type: app1 service-type: GCP - app-type: app2 service-type: AMAZON zone: zone2 models: - app-type: app3 service-type: AZURE - app-type: app4 service-type: HEROKU`)func main() { // This is the internal config which needs updated internalConfiglYaml := InternalModel{} err := yaml.Unmarshal([]byte(internal_config), &internalConfiglYaml) if err != nil { log.Fatalf(""error in model internalConfiglYaml: %v"", err) } //fmt.Printf(""%+v\n"", internalConfiglYaml) //--------------------------Second config file-----------------------// //This is the external config yaml extConfigYaml := ExternalConfig{} err = yaml.Unmarshal([]byte(external_config), &extConfigYaml) if err != nil { log.Fatalf(""error in model extConfigYaml: %v"", err) } fmt.Printf(""%+v\n"", extConfigYaml) landscape := ""zone1"" modifiedConfig := ConvertTypes(internalConfiglYaml, extConfigYaml, landscape) fmt.Printf(""%+v\n"", modifiedConfig)}func ConvertTypes(int_cfg InternalModel, ext_config ExternalConfig, landscape string) (out_cfg InternalModel) { for _, module := range int_cfg.models { switch module.Type { case ""app1"": //here I hard-coded the value ""GCP"" but it should come from the yaml struct after parsing module.Type = ""GCP"" // should be something like ext_config.models.service-type when the key in the struct case ""app2"": //here I hard-coded the value ""AMAZON"" but it should come from the yaml struct after parsing module.Type = ""AMAZON"" } } return int_cfg}//At the end what I need to do is to get the internal yaml file to be changed to the following struct//The changes are when the type=app-type I need to modify the type in the internal config, here its GCP and ruby//internal_config_after_changes := []byte(`//////models:// - name: myapp// type: GCP// target: .///// - name: myapp2// type: AMAZON// target: .///////`)",How to update value of two struct efficiently
How to update types value inside loops of structs," I have the following code which parses YAML files and needs to match values from one struct external and update the internal struct's type property.For example, this is the yaml file(translated to bin for simplicity) and content which is parsed correctly At the end what I need to do is to get the internal yaml file to be changed to the struct above internal_config_after_changes The changes are when the type=app-type I need to modify the type value in the internal_config, here from app1 to GCP and app2 to amazonThe problem is with the second loop which I should use to iterate on the external_config and the matching values, I'm not sure how to combine them both with efficient way... <code>  package mainimport ( ""fmt"" ""gopkg.in/yaml.v2"" ""log"")//internal config model for parsingtype InternalModel struct { models []Model2 `yaml:""models""`}type Model2 struct { Name string `yaml:""name""` Type string `yaml:""type""` Target string `yaml:""target""`}var internal_config = []byte(` models: - name: myapp type: app1 target: ./ - name: myapp2 type: app2 target: ./`)type ExternalConfig struct { Landscape Zone `yaml:""Landscape""`}type Zone struct { Zone string `yaml:""zone""` Models []Model `yaml:""models""`}type Model struct { AppType string `yaml:""app-type""` ServiceType string `yaml:""service-type""`}var external_config = []byte(`Landscape: zone: zone1 models: - app-type: app1 service-type: GCP - app-type: app2 service-type: AMAZON zone: zone2 models: - app-type: app3 service-type: AZURE - app-type: app4 service-type: HEROKU`)func main() { // This is the internal config which needs updated internalConfiglYaml := InternalModel{} err := yaml.Unmarshal([]byte(internal_config), &internalConfiglYaml) if err != nil { log.Fatalf(""error in model internalConfiglYaml: %v"", err) } //fmt.Printf(""%+v\n"", internalConfiglYaml) //--------------------------Second config file-----------------------// //This is the external config yaml extConfigYaml := ExternalConfig{} err = yaml.Unmarshal([]byte(external_config), &extConfigYaml) if err != nil { log.Fatalf(""error in model extConfigYaml: %v"", err) } fmt.Printf(""%+v\n"", extConfigYaml) landscape := ""zone1"" modifiedConfig := ConvertTypes(internalConfiglYaml, extConfigYaml, landscape) fmt.Printf(""%+v\n"", modifiedConfig)}func ConvertTypes(int_cfg InternalModel, ext_config ExternalConfig, landscape string) (out_cfg InternalModel) { for _, module := range int_cfg.models { switch module.Type { case ""app1"": //here I hard-coded the value ""GCP"" but it should come from the yaml struct after parsing module.Type = ""GCP"" // should be something like ext_config.models.service-type when the key in the struct case ""app2"": //here I hard-coded the value ""AMAZON"" but it should come from the yaml struct after parsing module.Type = ""AMAZON"" } } return int_cfg}//At the end what I need to do is to get the internal yaml file to be changed to the following struct//The changes are when the type=app-type I need to modify the type in the internal config, here its GCP and ruby//internal_config_after_changes := []byte(`//////models:// - name: myapp// type: GCP// target: .///// - name: myapp2// type: AMAZON// target: .///////`)",How to update value of two struct efficiently
Go - How to update types value inside loops of structs," I have the following code which parses YAML files and needs to match values from one struct external and update the internal struct's type property.For example, this is the yaml file(translated to bin for simplicity) and content which is parsed correctly At the end what I need to do is to get the internal yaml file to be changed to the struct above internal_config_after_changes The changes are when the type=app-type I need to modify the type value in the internal_config, here from app1 to GCP and app2 to amazonThe problem is with the second loop which I should use to iterate on the external_config and the matching values, I'm not sure how to combine them both with efficient way... <code>  package mainimport ( ""fmt"" ""gopkg.in/yaml.v2"" ""log"")//internal config model for parsingtype InternalModel struct { models []Model2 `yaml:""models""`}type Model2 struct { Name string `yaml:""name""` Type string `yaml:""type""` Target string `yaml:""target""`}var internal_config = []byte(` models: - name: myapp type: app1 target: ./ - name: myapp2 type: app2 target: ./`)type ExternalConfig struct { Landscape Zone `yaml:""Landscape""`}type Zone struct { Zone string `yaml:""zone""` Models []Model `yaml:""models""`}type Model struct { AppType string `yaml:""app-type""` ServiceType string `yaml:""service-type""`}var external_config = []byte(`Landscape: zone: zone1 models: - app-type: app1 service-type: GCP - app-type: app2 service-type: AMAZON zone: zone2 models: - app-type: app3 service-type: AZURE - app-type: app4 service-type: HEROKU`)func main() { // This is the internal config which needs updated internalConfiglYaml := InternalModel{} err := yaml.Unmarshal([]byte(internal_config), &internalConfiglYaml) if err != nil { log.Fatalf(""error in model internalConfiglYaml: %v"", err) } //fmt.Printf(""%+v\n"", internalConfiglYaml) //--------------------------Second config file-----------------------// //This is the external config yaml extConfigYaml := ExternalConfig{} err = yaml.Unmarshal([]byte(external_config), &extConfigYaml) if err != nil { log.Fatalf(""error in model extConfigYaml: %v"", err) } fmt.Printf(""%+v\n"", extConfigYaml) landscape := ""zone1"" modifiedConfig := ConvertTypes(internalConfiglYaml, extConfigYaml, landscape) fmt.Printf(""%+v\n"", modifiedConfig)}func ConvertTypes(int_cfg InternalModel, ext_config ExternalConfig, landscape string) (out_cfg InternalModel) { for _, module := range int_cfg.models { switch module.Type { case ""app1"": //here I hard-coded the value ""GCP"" but it should come from the yaml struct after parsing module.Type = ""GCP"" // should be something like ext_config.models.service-type when the key in the struct case ""app2"": //here I hard-coded the value ""AMAZON"" but it should come from the yaml struct after parsing module.Type = ""AMAZON"" } } return int_cfg}//At the end what I need to do is to get the internal yaml file to be changed to the following struct//The changes are when the type=app-type I need to modify the type in the internal config, here its GCP and ruby//internal_config_after_changes := []byte(`//////models:// - name: myapp// type: GCP// target: .///// - name: myapp2// type: AMAZON// target: .///////`)",How to update value of two struct efficiently
How to update types value inside loops of structs," I have the following code which parses YAML files and needs to match values from one struct external and update the internal struct's type property.For example, this is the yaml file(translated to bin for simplicity) and content which is parsed correctly At the end what I need to do is to get the internal yaml file to be changed to the struct above internal_config_after_changes The changes are when the type=app-type I need to modify the type value in the internal_config, here from app1 to GCP and app2 to amazonThe problem is with the second loop which I should use to iterate on the external_config and the matching values, I'm not sure how to combine them both with efficient way... <code>  package mainimport ( ""fmt"" ""gopkg.in/yaml.v2"" ""log"")//internal config model for parsingtype InternalModel struct { models []Model2 `yaml:""models""`}type Model2 struct { Name string `yaml:""name""` Type string `yaml:""type""` Target string `yaml:""target""`}var internal_config = []byte(` models: - name: myapp type: app1 target: ./ - name: myapp2 type: app2 target: ./`)type ExternalConfig struct { Landscape Zone `yaml:""Landscape""`}type Zone struct { Zone string `yaml:""zone""` Models []Model `yaml:""models""`}type Model struct { AppType string `yaml:""app-type""` ServiceType string `yaml:""service-type""`}var external_config = []byte(`Landscape: zone: zone1 models: - app-type: app1 service-type: GCP - app-type: app2 service-type: AMAZON zone: zone2 models: - app-type: app3 service-type: AZURE - app-type: app4 service-type: HEROKU`)func main() { // This is the internal config which needs updated internalConfiglYaml := InternalModel{} err := yaml.Unmarshal([]byte(internal_config), &internalConfiglYaml) if err != nil { log.Fatalf(""error in model internalConfiglYaml: %v"", err) } //fmt.Printf(""%+v\n"", internalConfiglYaml) //--------------------------Second config file-----------------------// //This is the external config yaml extConfigYaml := ExternalConfig{} err = yaml.Unmarshal([]byte(external_config), &extConfigYaml) if err != nil { log.Fatalf(""error in model extConfigYaml: %v"", err) } fmt.Printf(""%+v\n"", extConfigYaml) landscape := ""zone1"" modifiedConfig := ConvertTypes(internalConfiglYaml, extConfigYaml, landscape) fmt.Printf(""%+v\n"", modifiedConfig)}func ConvertTypes(int_cfg InternalModel, ext_config ExternalConfig, landscape string) (out_cfg InternalModel) { for _, module := range int_cfg.models { switch module.Type { case ""app1"": //here I hard-coded the value ""GCP"" but it should come from the yaml struct after parsing module.Type = ""GCP"" // should be something like ext_config.models.service-type when the key in the struct case ""app2"": //here I hard-coded the value ""AMAZON"" but it should come from the yaml struct after parsing module.Type = ""AMAZON"" } } return int_cfg}//At the end what I need to do is to get the internal yaml file to be changed to the following struct//The changes are when the type=app-type I need to modify the type in the internal config, here its GCP and ruby//internal_config_after_changes := []byte(`//////models:// - name: myapp// type: GCP// target: .///// - name: myapp2// type: AMAZON// target: .///////`)",How to update value of two struct efficiently
How to update value of two struct efficently," I have the following code which parses YAML files and needs to match values from one struct external and update the internal struct's type property.For example, this is the yaml file(translated to bin for simplicity) and content which is parsed correctly At the end what I need to do is to get the internal yaml file to be changed to the struct above internal_config_after_changes The changes are when the type=app-type I need to modify the type value in the internal_config, here from app1 to GCP and app2 to amazonThe problem is with the second loop which I should use to iterate on the external_config and the matching values, I'm not sure how to combine them both with efficient way... <code>  package mainimport ( ""fmt"" ""gopkg.in/yaml.v2"" ""log"")//internal config model for parsingtype InternalModel struct { models []Model2 `yaml:""models""`}type Model2 struct { Name string `yaml:""name""` Type string `yaml:""type""` Target string `yaml:""target""`}var internal_config = []byte(` models: - name: myapp type: app1 target: ./ - name: myapp2 type: app2 target: ./`)type ExternalConfig struct { Landscape Zone `yaml:""Landscape""`}type Zone struct { Zone string `yaml:""zone""` Models []Model `yaml:""models""`}type Model struct { AppType string `yaml:""app-type""` ServiceType string `yaml:""service-type""`}var external_config = []byte(`Landscape: zone: zone1 models: - app-type: app1 service-type: GCP - app-type: app2 service-type: AMAZON zone: zone2 models: - app-type: app3 service-type: AZURE - app-type: app4 service-type: HEROKU`)func main() { // This is the internal config which needs updated internalConfiglYaml := InternalModel{} err := yaml.Unmarshal([]byte(internal_config), &internalConfiglYaml) if err != nil { log.Fatalf(""error in model internalConfiglYaml: %v"", err) } //fmt.Printf(""%+v\n"", internalConfiglYaml) //--------------------------Second config file-----------------------// //This is the external config yaml extConfigYaml := ExternalConfig{} err = yaml.Unmarshal([]byte(external_config), &extConfigYaml) if err != nil { log.Fatalf(""error in model extConfigYaml: %v"", err) } fmt.Printf(""%+v\n"", extConfigYaml) landscape := ""zone1"" modifiedConfig := ConvertTypes(internalConfiglYaml, extConfigYaml, landscape) fmt.Printf(""%+v\n"", modifiedConfig)}func ConvertTypes(int_cfg InternalModel, ext_config ExternalConfig, landscape string) (out_cfg InternalModel) { for _, module := range int_cfg.models { switch module.Type { case ""app1"": //here I hard-coded the value ""GCP"" but it should come from the yaml struct after parsing module.Type = ""GCP"" // should be something like ext_config.models.service-type when the key in the struct case ""app2"": //here I hard-coded the value ""AMAZON"" but it should come from the yaml struct after parsing module.Type = ""AMAZON"" } } return int_cfg}//At the end what I need to do is to get the internal yaml file to be changed to the following struct//The changes are when the type=app-type I need to modify the type in the internal config, here its GCP and ruby//internal_config_after_changes := []byte(`//////models:// - name: myapp// type: GCP// target: .///// - name: myapp2// type: AMAZON// target: .///////`)",How to update value of two struct efficiently
Adding antonymous struct element to slice in GO," let's say I have a slice of anonymous structs Now, I would like to append a new item to this slice. How do I do that? Any ideas?  <code>  data := []struct{a string, b string}{} data = append(data, ???)",Adding anonymous struct element to slice
Adding antonymous struct element to slice," let's say I have a slice of anonymous structs Now, I would like to append a new item to this slice. How do I do that? Any ideas?  <code>  data := []struct{a string, b string}{} data = append(data, ???)",Adding anonymous struct element to slice
Calling a C function with an output double pointer parameter using CGo," I am trying to figure out th right way to call this function: using CGo to get the underlying string and its length as a byte array in Go.Is this the right way to do it? Since the C code overwrites *datap, I am not sure if the garbage collector will still do the right thing.I saw an answer here suggesting something along the lines of which also seems to work, but it's much more convoluted and I'm wondering if it's better / safer than the previous version. <code>  size_tfz_buffer_storage(fz_context *ctx, fz_buffer *buf, unsigned char **datap){ if (datap) *datap = (buf ? buf->data : NULL); return (buf ? buf->len : 0);} var bufferContents *C.ucharlength := C.fz_buffer_storage(ctx, buf, &bufferContents)bytes := C.GoBytes(unsafe.Pointer(bufferContents), C.int(length)) var tempUcharPtr *C.ucharbufferContents := C.malloc(C.size_t(unsafe.Sizeof(tempUcharPtr)))defer C.free(bufferContents)length := C.fz_buffer_storage(ctx, buf, (**C.uchar)(bufferContents))bytes := C.GoBytes(unsafe.Pointer(*(**C.uchar)(bufferContents)), C.int(length))",Calling a C function with a double pointer output parameter using CGo
How to check if an HTTP client has shut down the connection without disturbing the session?," I have a net/http Server serving a GET request (via ServeHTTP()) which can take a very long time to complete. Consequently, no client timeout is configured server side. However, the connected client may have shut down its connection to the server (typically due to a timeout on its side, but of course, other reasons are possible as well). I have no control over the clients.How do I detect such a condition within ServeHTTP() without ""disturbing"" the connection?I cannot send a series of 1xx response headers because it's not supported by ResponseWriter.WriteHeader() (also, it allows only one header to be set and does not return anything).I cannot use ResponseWriter.Write() with zero-sized data, as that would send a header.What other options do I have?Edit: this is not a duplicate of how to close/abort a Golang http.Client POST prematurely because there the question is how to cancel a request from the client side while my question is about detecting such a cancellation from the server side.  <code> ",How to non-destructively check if an HTTP client has shut down the connection?
GoLang - Read and merge two Yaml files," Assuming we have two yaml files master.yaml override.yaml Is it possible to unmarshall, merge, and then write those changes to a file without having to define a struct for every property in the yaml file? The master file has over 500 properties in it that are not at all important to the service at this point of execution, so ideally I'd be able to just unmarshal into a map, do a merge and write out in yaml again but I'm relatively new to go so wanted some opinions.I've got some code to read the yaml into an interface but i'm unsure on the best approach to then merge the two. I've looked into libraries like mergo but i'm not sure if that's the right approach.I'm hoping that after the master I would be able to write out to file with properties <code>  someProperty: ""someVaue""anotherProperty: ""anotherValue"" someProperty: ""overriddenVaue"" var masterYaml interface{}yamlBytes, _ := ioutil.ReadFile(""master.yaml"")yaml.Unmarshal(yamlBytes, &masterYaml)var overrideYaml interface{}yamlBytes, _ = ioutil.ReadFile(""override.yaml"")yaml.Unmarshal(yamlBytes, &overrideYaml) someProperty: ""overriddenVaue""anotherProperty: ""anotherValue""",Read and merge two Yaml files in go language
Read and merge two Yaml files," Assuming we have two yaml files master.yaml override.yaml Is it possible to unmarshall, merge, and then write those changes to a file without having to define a struct for every property in the yaml file? The master file has over 500 properties in it that are not at all important to the service at this point of execution, so ideally I'd be able to just unmarshal into a map, do a merge and write out in yaml again but I'm relatively new to go so wanted some opinions.I've got some code to read the yaml into an interface but i'm unsure on the best approach to then merge the two. I've looked into libraries like mergo but i'm not sure if that's the right approach.I'm hoping that after the master I would be able to write out to file with properties <code>  someProperty: ""someVaue""anotherProperty: ""anotherValue"" someProperty: ""overriddenVaue"" var masterYaml interface{}yamlBytes, _ := ioutil.ReadFile(""master.yaml"")yaml.Unmarshal(yamlBytes, &masterYaml)var overrideYaml interface{}yamlBytes, _ = ioutil.ReadFile(""override.yaml"")yaml.Unmarshal(yamlBytes, &overrideYaml) someProperty: ""overriddenVaue""anotherProperty: ""anotherValue""",Read and merge two Yaml files in go language
"""1 partitions have leader brokers without a matching listener"" error with kafka"," What is the meaning of this kafka error ? [2018-08-22 11:40:49,429] WARN [Consumer clientId=consumer-1, groupId=console-consumer-62114] 1 partitions have leader brokers without a matching listener, including [topicname-0] (org.apache.kafka.clients.NetworkClient)I'm getting it when running: And I'm getting some errors inside a golang program when trying to read this topic: 2018/08/22 11:44:12 ReadOffsetWithRetryOnError conn error: < dial tcp :0: connect: connection refused > kafka0:9094 topic: 0The code snippet: This is quite weird because, when reading on different topic it is working fine at the same time.More error logs: /kafka-topics.sh --describe --zookeeper localhost:2181 --topic topicname Topic:indexBlock PartitionCount:1 ReplicationFactor:1 Configs: Topic: topicname Partition: 0 Leader: -1 Replicas: 1002 Isr: 1002 <code>  ./kafka-console-consumer.sh --topic topicname --bootstrap-server localhost:9094 conn, err := kafka.DialLeader(context.Background(), ""tcp"", ip, getTopic(topic), 0) if err != nil { log.Println(""ReadOffsetWithRetryOnError conn error: <"", err, ""> "", ip, "" topic:"", topic) }",Leader brokers without a matching listener error in kafka
How to break out of nested loops when inner loop condition is satisfied?," I have an outer and inner loop, each iterating over a range. I want to exit the outer loop when a condition is satisfied inside the inner loop.I have a solution which works using two 'break's, one inside the inner loop and one inside the outerloop, just outside the inner loop (a very simplified case for demonstration): Go PlaygroundThere is no problem with this solution, but it just looks patched and ugly to me. Is there a better way to do this?I can try and have another for conditional loop outside the outer loop in the previous solution and have a label and use continue with the label. But as you can see, this approach isn't any more elegant than the solution with break. Go PlaygroundI have seen similar questions here pertaining to other languages (C, C#, Python etc). But what I am really interested to see is whether there is any trick with Go constructs such as 'for select'. <code>  package mainimport ( ""fmt"")func main() { word := """" for _, i := range(""ABCDE"") { for _,j := range(""ABCDE"") { word = string(i) + string(j) fmt.Println(word) if word == ""DC"" { break } } if word == ""DC"" { break } } // More logic here that needs to be executed} package mainimport ( ""fmt"")func main() { word := """"Exit: for word != ""DC"" { for _, i := range ""ABCDE"" { for _, j := range ""ABCDE"" { word = string(i) + string(j) fmt.Println(word) if word == ""DC"" { continue Exit } } } } // More logic here that needs to be executed}",How to break out of nested loops in Go?
How to break out of nested loops in Golang?," I have an outer and inner loop, each iterating over a range. I want to exit the outer loop when a condition is satisfied inside the inner loop.I have a solution which works using two 'break's, one inside the inner loop and one inside the outerloop, just outside the inner loop (a very simplified case for demonstration): Go PlaygroundThere is no problem with this solution, but it just looks patched and ugly to me. Is there a better way to do this?I can try and have another for conditional loop outside the outer loop in the previous solution and have a label and use continue with the label. But as you can see, this approach isn't any more elegant than the solution with break. Go PlaygroundI have seen similar questions here pertaining to other languages (C, C#, Python etc). But what I am really interested to see is whether there is any trick with Go constructs such as 'for select'. <code>  package mainimport ( ""fmt"")func main() { word := """" for _, i := range(""ABCDE"") { for _,j := range(""ABCDE"") { word = string(i) + string(j) fmt.Println(word) if word == ""DC"" { break } } if word == ""DC"" { break } } // More logic here that needs to be executed} package mainimport ( ""fmt"")func main() { word := """"Exit: for word != ""DC"" { for _, i := range ""ABCDE"" { for _, j := range ""ABCDE"" { word = string(i) + string(j) fmt.Println(word) if word == ""DC"" { continue Exit } } } } // More logic here that needs to be executed}",How to break out of nested loops in Go?
How yo get a table name from a model in gorm?, Is it possible to get model's table name? I see that it's possible to get it from ModelStruct but I don't know how to do it correctly. I didn't find any initializations for this structure. <code>  user := User{}tableName := db...,How to get a table name from a model in gorm?
Golang HTTP dial tcp I/O timeout on simultaneous requests," I am building a tool in Go that needs to make a very large number of simultaneous HTTP requests to many different servers. My initial prototype in Python had no problem doing a few hundred simultaneous requests.However, I have found that in Go this almost always results in a Get http://www.google.com: dial tcp 216.58.205.228:80: i/o timeout for some if the number of simultaneous requests exceeds ~30-40.I've tested on macOS, openSUSE, different hardware, in different networks and with different domain lists, and changing the DNS server as described in other Stackoverflow answers does not work either.The interesting thing is that the failed requests do not even produce a packet, as can be seen when checking with Wireshark.Is there anything that I am doing wrong or is that a bug in Go?Minimum reproducible program below: Two particular error messages are happening, a net.DNSError that does not make any sense and a non-descript poll.TimeoutError: Update:Running the requests with a seperate http.Client as well as http.Transport and net.Dialer does not make any difference as can be seen when running code from this playground. <code>  package mainimport ( ""fmt"" ""net/http"" ""sync"")func main() { domains := []string{/* large domain list here, eg from https://moz.com/top500 */} limiter := make(chan string, 50) // Limits simultaneous requests wg := sync.WaitGroup{} // Needed to not prematurely exit before all requests have been finished for i, domain := range domains { wg.Add(1) limiter <- domain go func(i int, domain string) { defer func() { <-limiter }() defer wg.Done() resp, err := http.Get(""http://""+domain) if err != nil { fmt.Printf(""%d %s failed: %s\n"", i, domain, err) return } fmt.Printf(""%d %s: %s\n"", i, domain, resp.Status) }(i, domain) } wg.Wait()} &url.Error{Op:""Get"", URL:""http://harvard.edu"", Err:(*net.OpError)(0xc00022a460)}&net.OpError{Op:""dial"", Net:""tcp"", Source:net.Addr(nil), Addr:net.Addr(nil), Err:(*net.DNSError)(0xc000aca200)}&net.DNSError{Err:""no such host"", Name:""harvard.edu"", Server:"""", IsTimeout:false, IsTemporary:false}&url.Error{Op:""Get"", URL:""http://latimes.com"", Err:(*net.OpError)(0xc000d92730)}&net.OpError{Op:""dial"", Net:""tcp"", Source:net.Addr(nil), Addr:net.Addr(nil), Err:(*poll.TimeoutError)(0x14779a0)}&poll.TimeoutError{}",Dial tcp I/O timeout on simultaneous requests
Using monodb go driver for decoding documents into structs with custom type fields," I'm a beginner in both go and mongodb.I try to decode a DocumentResult into a struct using bson tags, and it does not work for a custom type wrapping a string.Can it be done without changing the field's type to a string? PRINTED RESULT: ""42 The Answer"" //""ABCD"" is missingThanks in advance <code>  import ( ""context"" ""github.com/mongodb/mongo-go-driver/mongo"")type MyDoc struct { SomeInt int `bson:""some_int""` SomeString string `bson:""some_string,omitempty""` CustomType MyType `bson:""custom_type,omitempty""`}type MyType stringconst myType MyType = ""ABCD""func main() { //Connect to db client, _ := mongo.Connect(context.Background(), ""mongodb://localhost:27017"", nil) db := client.Database(""example_db"") collection := db.Collection(""col"") //Insert document docToInsert := MyDoc{42, ""The Answer"", myType} collection.InsertOne(nil, docToInsert) //Retrieve document filterDoc := MyDoc{SomeInt: 42} resultDoc := &MyDoc{} result := collection.FindOne(nil, filterDoc) result.Decode(resultDoc) println(resultDoc.SomeInt, resultDoc.SomeString, resultDoc.CustomType)",Using mongodb go driver for decoding documents into structs with custom type fields
How to install go in alpine linux," I am trying to install Go inside an Alpine Docker image. For that I downloaded tar file from here inside my alpine docker image, untar it using following command: tar -C /usr/local -xzf go1.10.3.linux-amd64.tar.gzexported PATH to have go binary as: export PATH=$PATH:/usr/local/go/bin However, when I say go version then it says that sh: go: not found. I am quite new to alpine. Does anyone know, what I am missing here?Steps to reproduce- <code>  $ docker run -it alpine sh$ wget https://dl.google.com/go/go1.10.3.linux-amd64.tar.gz$ tar -C /usr/local -xzf go1.10.3.linux-amd64.tar.gz$ export PATH=$PATH:/usr/local/go/bin$ go version",How to install Go in alpine linux
"""net/http"" How to receive HTTP Response for streaming. (Golang)"," When throwing an HTTP Request with Go and receiving a Response, I want to receive a response while streaming, considering the case where the ResponseBody is huge (1 GB or more). In this case, if the body is huge, I can not read the Header and I do not know the state of Response.Is there any solution? <code>  resp, err: = http.Client.Do(req)",How to receive HTTP Response for streaming
Go get cannot find local packages when using modules," I'm having issues with go's new module system, as I'd like to define a local module and import it in the main program. The local package resides in a folder of the main package/root folder. Imagine the following project structure outside the $GOPATH.Project structure./main.go ./model/person.go In the root folder I initialized a module by calling In the model/ folder I then initialized the submodule by calling The errorIn the root folder calling the following commands fail. The error message for go get is cut off, I din't parse it wrongly.I do not plan on pushing the module to a server and and just needed a way of referencing the local package model, so I chose example.com/localModule/ and example.com/localModule/model respectively.I'm using go1.11 darwin/amd64 on a Macbook running MacOS 10.13.6. <code>  package mainimport ""fmt""import ""example.com/localModule/model""func main() { var p = model.Person{name: ""Dieter"", age:25} fmt.Printf(""Hello %s\n"", p.name)} package modeltype Person struct { name string age int} go mod init example.com/localModule go mod init example.com/localModule/model $ go getgo build example.com/localModule/model: no Go files in$ go buildmain.go:4:8: unknown import path ""example.com/localModule/model"": cannot find module providing package example.com/localModule/model",Go get cannot find local packages when using multiple modules in a repo
Golang: How to get the stacktrace of a panic (and store as a variable)?," As we all know, panics produce a stacktrace to stdout (Playground link).: And it seems when you recover from a panic, recover() returns only an error which describes what caused the panic (Playground link). My question is, is it possible to store the stacktrace which is written to stdout? This provides much better debugging information than the string runtime error: index out of range because it shows the exact line in a file which caused the panic. <code>  panic: runtime error: index out of rangegoroutine 1 [running]:main.main() /tmp/sandbox579134920/main.go:9 +0x20 runtime error: index out of range",How to get the stacktrace of a panic (and store as a variable)
How to create a local Go 1.11 module (VGO) and import it?," In my Go project, I want to break out some generic functionality into a Go module, separate from the main project. I'm doing this outside of GOPATH in keeping with go's future. I don't want to publish the module on GitHub or anywhere else. All my attempts to import this module into the main project result in: I've run go mod init X in the module's folder. The contents of its go.mod file is: Building or installing this module seems to do nothing. I've found no sign of it in $GOPATH/pgk/mod.I've tried a variety of import statements:import ""X""import ""../x"" (relative path to the module directory)import ""../x/X"" (path to the directory + module name)Help! <code>  cannot find module for path X module X","How do I resolve ""cannot find module for path X"" importing a local Go module?"
How to create a local Go module (VGO) and import it?," In my Go project, I want to break out some generic functionality into a Go module, separate from the main project. I'm doing this outside of GOPATH in keeping with go's future. I don't want to publish the module on GitHub or anywhere else. All my attempts to import this module into the main project result in: I've run go mod init X in the module's folder. The contents of its go.mod file is: Building or installing this module seems to do nothing. I've found no sign of it in $GOPATH/pgk/mod.I've tried a variety of import statements:import ""X""import ""../x"" (relative path to the module directory)import ""../x/X"" (path to the directory + module name)Help! <code>  cannot find module for path X module X","How do I resolve ""cannot find module for path X"" importing a local Go module?"
How to import a local Go module?," In my Go project, I want to break out some generic functionality into a Go module, separate from the main project. I'm doing this outside of GOPATH in keeping with go's future. I don't want to publish the module on GitHub or anywhere else. All my attempts to import this module into the main project result in: I've run go mod init X in the module's folder. The contents of its go.mod file is: Building or installing this module seems to do nothing. I've found no sign of it in $GOPATH/pgk/mod.I've tried a variety of import statements:import ""X""import ""../x"" (relative path to the module directory)import ""../x/X"" (path to the directory + module name)Help! <code>  cannot find module for path X module X","How do I resolve ""cannot find module for path X"" importing a local Go module?"
How to import a local Go module not in GOPATH?," In my Go project, I want to break out some generic functionality into a Go module, separate from the main project. I'm doing this outside of GOPATH in keeping with go's future. I don't want to publish the module on GitHub or anywhere else. All my attempts to import this module into the main project result in: I've run go mod init X in the module's folder. The contents of its go.mod file is: Building or installing this module seems to do nothing. I've found no sign of it in $GOPATH/pgk/mod.I've tried a variety of import statements:import ""X""import ""../x"" (relative path to the module directory)import ""../x/X"" (path to the directory + module name)Help! <code>  cannot find module for path X module X","How do I resolve ""cannot find module for path X"" importing a local Go module?"
How do I import a local Go module not in GOPATH?," In my Go project, I want to break out some generic functionality into a Go module, separate from the main project. I'm doing this outside of GOPATH in keeping with go's future. I don't want to publish the module on GitHub or anywhere else. All my attempts to import this module into the main project result in: I've run go mod init X in the module's folder. The contents of its go.mod file is: Building or installing this module seems to do nothing. I've found no sign of it in $GOPATH/pgk/mod.I've tried a variety of import statements:import ""X""import ""../x"" (relative path to the module directory)import ""../x/X"" (path to the directory + module name)Help! <code>  cannot find module for path X module X","How do I resolve ""cannot find module for path X"" importing a local Go module?"
How do I import a local Go module not in GOPATH?," In my Go project, I want to break out some generic functionality into a Go module, separate from the main project. I'm doing this outside of GOPATH in keeping with go's future. I don't want to publish the module on GitHub or anywhere else. All my attempts to import this module into the main project result in: I've run go mod init X in the module's folder. The contents of its go.mod file is: Building or installing this module seems to do nothing. I've found no sign of it in $GOPATH/pgk/mod.I've tried a variety of import statements:import ""X""import ""../x"" (relative path to the module directory)import ""../x/X"" (path to the directory + module name)Help! <code>  cannot find module for path X module X","How do I resolve ""cannot find module for path X"" importing a local Go module?"
Golang after 1.10 and support of Windows XP," First of all: I know that Windows XP is end of life, insanely insecure, a big risk and that everyone still using it will be doomed for ever.Nonetheless I have to provide an application that can also run on Windows XP and I do so using Go.In 1.10 it was announced that XP will no longer be supported and 1.11 confirms this in the release notes: As announced in the Go 1.10 release notes, Go 1.11 now requires OpenBSD 6.2 or later, macOS 10.10 Yosemite or later, or Windows 7 or later; support for previous versions of these operating systems has been removed.I compiled my application with 1.11 and tried to execute it on a Windows XP SP3 virtual machine. It could be executed successfully !Then I thought that the revoked support for Windows XP only applies to the development toolchain but even that can still be executed on Windows XP:As you can see the main go binary still runs on XP too. Is it already known when it will no longer be possible to run golang compiled exes on Windows XP because of technical limitations or if certain methods will fail because they can no longer work because of missing APIs on XP ?  <code> ",Go after 1.10 and support of Windows XP
"Strange behavior of golang custom json of map, any ideas?"," I can't understand a strange behavior of custom marshal int to string.Here is an example: The output is: https://play.golang.org/p/iiUyL2Hc5h_PWhat am I missing? <code>  package mainimport ( ""encoding/json"" ""fmt"")type Int intfunc (a Int) MarshalJSON() ([]byte, error) { test := a / 10 return json.Marshal(fmt.Sprintf(""%d-%d"", a, test))}func main() { array := []Int{100, 200} arrayJson, _ := json.Marshal(array) fmt.Println(""array"", string(arrayJson)) maps := map[Int]bool{ 100: true, 200: true, } mapsJson, _ := json.Marshal(maps) fmt.Println(""map wtf?"", string(mapsJson)) fmt.Println(""map must be:"", `{""100-10"":true, ""200-20"":true}`)} array [""100-10"",""200-20""]map wtf? {""100"":true,""200"":true}map must be: {""100-10"":true, ""200-20"":true}",How to custom marshal map keys in JSON
Golang: decoding dwarf section info at offset 0x0: too short," I am using JetBrains GoLand and I am trying to debug my go file and I am getting the following error: decoding dwarf section info at offset 0x0: too shortI tried to find an answer here at StackOverflow but unfortunately, I didn't get any solution. <code> ",decoding dwarf section info at offset 0x0: too short
GoLand: decoding dwarf section info at offset 0x0: too short," I am using JetBrains GoLand and I am trying to debug my go file and I am getting the following error: decoding dwarf section info at offset 0x0: too shortI tried to find an answer here at StackOverflow but unfortunately, I didn't get any solution. <code> ",decoding dwarf section info at offset 0x0: too short
Go Modules: Finding out Version of Required Package," I am trying out Go modules. My project requires the libarary golang.org/x/net/html, so I defined this go.mod file: And wrote this demo program to check if the dependency gets loaded upon compilation: When I run go build, I get this error message: Obviously, I missed the version number. But which one to take? I stumbled an article called Takig Go Modules for a Spin, where I found an example of a go.mod file containing references to golang.org/x packages: The author is using version strings like v0.0.0-20170922011244-0744d001aa84, consisting of the semver indication v0.0.0, a timestamp and something that looks like a git commit ID.How do I figure out those version strings? I guess those golang.org/x packages will be versioned according to semantic versioning at some point, but to really trying out go mod, I need to figure out those now. <code>  module github.com/patrickbucher/prettyprintrequire golang.org/x/net/html package mainimport ( ""fmt"" ""log"" ""os"" ""golang.org/x/net/html"")func main() { doc, err := html.Parse(os.Stdin) if err != nil { log.Fatal(err) } fmt.Println(doc)} go: errors parsing go.mod:~/prettyprint/go.mod:3: usage: require module/path v1.2.3 module github.com/davecheney/httpstatrequire ( github.com/fatih/color v1.5.0 github.com/mattn/go-colorable v0.0.9 github.com/mattn/go-isatty v0.0.3 golang.org/x/net v0.0.0-20170922011244-0744d001aa84 golang.org/x/sys v0.0.0-20170922123423-429f518978ab golang.org/x/text v0.0.0-20170915090833-1cbadb444a80)",Go Modules: finding out right pseudo-version (vX.Y.Z-<timestamp>-<commit>) of required package
How can I manually fetch dependencies from go.mod?," I'm using go 1.11 with module support. I understand that the go tool now installs dependencies automatically on build/install. I also understand the reasoning.I'm using docker to build my binaries. In many other ecosystems its common to copy over your dependency manifest (package.json, requirements.txt, etc) and install dependencies as a separate stage from build. This takes advantage of docker's layer caching, and makes rebuilds much faster since generally code changes vastly outnumber dependency changes.I was wondering if vgo has any way to do this? <code> ",Manually fetch dependencies from go.mod?
Golang SQL builder," I'm using golang, go_reform, PostgreSQL. What i want to do is a REST search utility, and all went fine until I faced with conditional search query. ""Conditional"" here means I have 10 columns in a table to search in, and there may be ton of combinations so I can't handle them all separately. What i need is a query builder, but I have no understanding how can I implement this in Go. For now I have an idea like this, but it seems not really efficient That feels really awkward so I'm wondering is there any better way to determine the fields that came to the Find() and build a SQL query based on this. (Actually it's coming in JSON and binding to Query struct, so maybe there is a way without struct). There also may be SQL workarounds, but I think it would be more efficient to build query without all possible columns.EDIT: By the way, making my Google search query more accurate, i found a bunch of things related to my problem, probably i will try to use it now. For those who interested too:old go playground exampleMaking dynamic SQL queries to a MySQL DBgorp package (snippets thing sounds very promising) <code>  type Query struct { Id *int64 FirstName *string MiddleName *string LastName *string AreaId *int64 Birthday *time.Time}func (table *Query) Find() (*User) { if table.Id != nil { idstr := fmt.Sprintf(""WHERE Id = %d AND "", table.Id) } else idstr := ""WHERE "" } if table.FirstName != """" { firststr := fmt.Sprintf(""FirstName = %s AND"", table.FirstName) } else firststr := """"}//and so on",Build dynamic (conditional) WHERE SQL query in Golang
Build dynamic WHERE SQL query in Golang," I'm using golang, go_reform, PostgreSQL. What i want to do is a REST search utility, and all went fine until I faced with conditional search query. ""Conditional"" here means I have 10 columns in a table to search in, and there may be ton of combinations so I can't handle them all separately. What i need is a query builder, but I have no understanding how can I implement this in Go. For now I have an idea like this, but it seems not really efficient That feels really awkward so I'm wondering is there any better way to determine the fields that came to the Find() and build a SQL query based on this. (Actually it's coming in JSON and binding to Query struct, so maybe there is a way without struct). There also may be SQL workarounds, but I think it would be more efficient to build query without all possible columns.EDIT: By the way, making my Google search query more accurate, i found a bunch of things related to my problem, probably i will try to use it now. For those who interested too:old go playground exampleMaking dynamic SQL queries to a MySQL DBgorp package (snippets thing sounds very promising) <code>  type Query struct { Id *int64 FirstName *string MiddleName *string LastName *string AreaId *int64 Birthday *time.Time}func (table *Query) Find() (*User) { if table.Id != nil { idstr := fmt.Sprintf(""WHERE Id = %d AND "", table.Id) } else idstr := ""WHERE "" } if table.FirstName != """" { firststr := fmt.Sprintf(""FirstName = %s AND"", table.FirstName) } else firststr := """"}//and so on",Build dynamic (conditional) WHERE SQL query in Golang
How to make composite key for a hash map in golang," First, my definition of composite key - two ore more values combine to make the key. Not to confuse with composite keys in databases.My goal is to save computed values of pow(x, y) in a hash table, where x and y are integers. This is where I need ideas on how to make a key, so that given x and y, I can look it up in the hash table, to find pow(x,y).For example: What I want to figure out is how to get the map key for the pair (2,3), i.e. the best way to generate a key which is a combination of multiple values, and use it in hash table. <code>  pow(2, 3) => {key(2,3):8}",How to make composite key for a hash map in go
Go - Why is unsafe.Sizeof considered unsafe?," Consider the following: Why is determining the size of a variable considered unsafe, and a part of the unsafe package? I don't understand why obtaining the size of any type is an unsafe operation, or what mechanism go uses to determine its size that necessitates this. I would also love to know if there are any alternatives to the unsafe package for determining size of a known struct. <code>  import ( ""log"" ""unsafe"")type Foo struct { Bar int32}func main() { log.Println(int(unsafe.Sizeof(Foo{})))}",Why is unsafe.Sizeof considered unsafe?
How to access package documentation of other / any platforms?," We can access Go's package documentation online on the official website:https://golang.org/pkg/This only contains the package documentation available on the linux platform (GOOS), amd64 archicture (GOARCH).Or offline via the go doc command, e.g package doc of the syscall package. This shows documentation for the platform of the Go SDK.Some packages have different API based on the platform we target, most famous is the syscall package.How can we access platform specific package documentation online and offline? <code>  go doc syscall",How to access platform specific package documentation?
Understanding scope of variable in Go Lang," I am going through the Go specification to learn the language, and these points are taken from the spec under Declarations and scope.Though I am able to understand points 1-4, I am confused on points 5 and 6: The scope of a constant or variable identifier declared inside a function begins at the end of the ConstSpec or VarSpec (ShortVarDecl for short variable declarations) and ends at the end of the innermost containing block. The scope of a type identifier declared inside a function begins at the identifier in the TypeSpec and ends at the end of the innermost containing block. This is the code which I used to understand scope in Go: From this what I understand is scope of x is within the main function, and the scope of y is inside the opening and closing brackets after fmt.Println(x), and I cannot use y outside of the closing brackets.If I understand it correctly, both points 4 and 5 are saying the same thing. So my questions are:If they are saying the same thing, what is the importance of both thepoints?If they are different, can you please let me know the difference? <code>  package mainimport ""fmt""func main() { x := 42 fmt.Println(x) { fmt.Println(x) y := ""The test message"" fmt.Println(y) } // fmt.Println(y) // outside scope of y}",Understanding variable scope in Go
What's the go idiom for python's list.pop() method?," In Python, I have the following: In converting this to Go, I am looking for a similar way of retrieving an item from a slice by index, doing something with it, then putting the original item at the end of my slice.From here, I have arrived at the following: But this fails at the end of lists: How would I idiomatically translate this slice.pop() into Go? <code>  i = series.index(s) # standard Python list.index() functiontmp = series.pop(i)blah = f(tmp)series.append(tmp) i = Index(series, s) // my custom index function...tmp, series = series[i], series[i+1:]blah := f(tmp)series = append(series, tmp) panic: runtime error: slice bounds out of range",What's the Go idiom for Python's list.pop() method?
Go modules: Using vendored transitive dependencies of primary dependency," I have been converting existing projects from using vendored dependencies via Glide, to using the Go 1.11.x module support. But I am hitting a particular case in one project using modules that I cannot solve.Internal project 'foo' has its dependencies vendored via ""go mod vendor"": This works great when building that project internally since a non-go developer can clone the project to any location and build it, with no external proxy access needed to download dependencies. Now I am trying to allow project 'bar' to build a tool using library 'foo'. The ""go.mod"" file only contains: I would vendor via: And I build via: What I am seeing is that 'foo' will be cloned from the internal git repo, and all of its dependencies will be downloaded from their remote git origins, and my 'go.sum' file is updated with all of the transient dependencies. But what I really want is to only fetch 'foo' from my internal network and to have it flatten the vendored dependencies. Ideally, there should be no external http requests.Is this even possible? The ""-mod=vendor"" flag was very useful when building project ""foo"" directly. But it doesn't seem to apply here because project ""bar"" doesn't want to vendor. It wants to get the one primary dependency and that is it. It would seem that Go module support doesn't care about flattening vendored transient dependencies.Previous when using glide as the package manager, it would fetch 'foo' from the internal git repo and then flatten all of its dependencies into my vendor directory.Originally posted as a question to golang-nuts, without reply. <code>  projects/src/foo/ main.go vendor/ ... package barimport ""internal.com/project/foo"" module internal.com/project/barrequire internal.com/project/foo v0.0.0-... go module vendor go build -mod=vendor",Flatten vendored transitive dependencies of primary dependency
Using vendored transitive dependencies of primary dependency," I have been converting existing projects from using vendored dependencies via Glide, to using the Go 1.11.x module support. But I am hitting a particular case in one project using modules that I cannot solve.Internal project 'foo' has its dependencies vendored via ""go mod vendor"": This works great when building that project internally since a non-go developer can clone the project to any location and build it, with no external proxy access needed to download dependencies. Now I am trying to allow project 'bar' to build a tool using library 'foo'. The ""go.mod"" file only contains: I would vendor via: And I build via: What I am seeing is that 'foo' will be cloned from the internal git repo, and all of its dependencies will be downloaded from their remote git origins, and my 'go.sum' file is updated with all of the transient dependencies. But what I really want is to only fetch 'foo' from my internal network and to have it flatten the vendored dependencies. Ideally, there should be no external http requests.Is this even possible? The ""-mod=vendor"" flag was very useful when building project ""foo"" directly. But it doesn't seem to apply here because project ""bar"" doesn't want to vendor. It wants to get the one primary dependency and that is it. It would seem that Go module support doesn't care about flattening vendored transient dependencies.Previous when using glide as the package manager, it would fetch 'foo' from the internal git repo and then flatten all of its dependencies into my vendor directory.Originally posted as a question to golang-nuts, without reply. <code>  projects/src/foo/ main.go vendor/ ... package barimport ""internal.com/project/foo"" module internal.com/project/barrequire internal.com/project/foo v0.0.0-... go module vendor go build -mod=vendor",Flatten vendored transitive dependencies of primary dependency
how to parse multiple returns in golang," I have a Go function which returns two integer values. Below is the function Is it possible to put temp function directly into a Println and print both the outputs using string formatting as below: In Python, I am able to do the following: Can I do Something similar in Go too? <code>  func temp() (int, int){ return 1,1} fmt.Println(""first= %d and second = %d"", temp() ) // This doesn't work def func(): return 1,1print(""{0}={1}"".format(*func())>> '1=2'",How to pass multiple return values to a variadic function?
Testing zap logging for a Logger built from a custom Config," I have a Zap logger that is generated from a custom Config (i.e. config.Build()). I would like to test the logger by calling, for example, logger.Info() in the test method and assert the result to see if it is according to the config set. How can I achieve this?Code example: <code>  func GetLogger() *zap.Logger{ config := &zap.Config{ Encoding: ""json"", Level: zap.NewAtomicLevelAt(zapcore.InfoLevel), OutputPaths: []string{""stdout""}, ErrorOutputPaths: []string{""stdout""}, EncoderConfig: zapcore.EncoderConfig{ MessageKey: ""@m"", LevelKey: ""@l"", EncodeLevel: zapcore.CapitalLevelEncoder, TimeKey: ""@t"", EncodeTime: zapcore.EpochMillisTimeEncoder, CallerKey: ""@c"", EncodeCaller: zapcore.ShortCallerEncoder, StacktraceKey: ""@x"", }, } return config.Build()}",How to test logging of a zap Logger built from custom Config?
Golang: gob + fasthttp error: ctx.PostBody() (type []byte) as type *bytes.Buffer in assignment, I am trying to decode a gob output that I am sending through another fasthttp endpoint and receiving an errorFasthttp endpoint(encode []string through gob) ----> Fasthttp endpoint( receive and decode) I am getting error: ctx.PostBody() (type []byte) as type *bytes.Buffer in assignmenthow do I convert []byte to *bytes.Buffer.Any help is appreciated. <code>  buffer := &bytes.Buffer{}buffer = ctx.PostBody()backToStringSlice := []string{} gob.NewDecoder(buffer).Decode(&backToStringSlice),How to convert []byte to *bytes.Buffer
"What is ""m=+"" in GO time string"," I'm experimenting with Google OAuth2 and I encountered this in the expiry time of my refresh token. It comes from 2018-10-15 15:42:37.5989253 +1100 AEDT m=+3610.688917401I know it's a time format but I couldn't find any information about m=+ anywhere. Is it used internally by Google? I tried to parse it with time.RFC3339 but as you can guess, it ignores the m=+. It says parsing time ""2018-10-15 15:42:37.5989253 +1100 AEDT m=+3610.688917401"" as ""2006-01-02T15:04:05Z07:00"": cannot parse "" 15:42:37.5989253 +1100 AEDT m=+3610.688917401"" as ""T""So what's this m=+ in the time string? <code> ","What is ""m=+"" in GO time string?"
Go thread-safe variable," I'm relatively new to Go, and I need to make a variable thread-safe. I know in java you can just use the synchronized keyword, but nothing like that seems to exist in go. Is there any way to synchronize variables? <code> ",How to make a variable thread-safe
Why does many golang project directly import from github?," I'm totally new to golang, and am wondering, why many golang projects write in their source code like this way: What if this testify moved to bitbucket?Why not download testify and import testify, like other languages? <code>  import ""github.com/stretchr/testify/assert""",Why does many golang project directly import from GitHub?
Using logger in multi packages best practice GO," I've the following project structure: The log and the template are on the same level (under internal package)In logger.go Im using logrus as logger with some config sand I want to use the logger.go object inside the template package.How should I do that in a clean way ? Currently I use it with import logger inside my template.go file,And under internal package Ive 6 more packages which needs this logger. and each of them is depend on it.(On the log package), is there a nice in go to handle it ?update:in case I've more things that I need to pass (like logger) what will be the approach/ pattern here ? maybe using dependency injection ? interface ? other clean approach...I need some best practice full example how can I use logger inside the hello.go file and also in template.go.this is my project this is how it looks <code>  myGithubProject/ |---- cmd |----- command |----- hello.go |---- internal |----- template |----- template.go |----- log |----- logger.go main.go cliProject/main.gopackage mainimport ( ""cliProject/cmd"" ""cliProject/internal/logs"")func main() { cmd.Execute() logs.Logger.Error(""starting"")}**cliProject/cmd/root.go**package cmdimport ( ""fmt"" ""github.com/spf13/cobra"")var rootCmd = &cobra.Command{ Use: ""cliProject"", Short: ""A brief description of your application"",}func Execute() { if err := rootCmd.Execute(); err != nil { fmt.Println(err) }}**cliProject/cmd/serve.go**package cmdimport ( ""cliProject/internal/logs"" ""fmt"" ""github.com/spf13/cobra"")// serveCmd represents the serve commandvar serveCmd = &cobra.Command{ Use: ""serve"", Short: ""A brief description of your command"", Run: func(cmd *cobra.Command, args []string) { fmt.Println(""serve called"") startServe() stoppingServe() },}func init() { rootCmd.AddCommand(serveCmd) serveCmd.Flags().BoolP(""toggle"", ""t"", false, ""Help message for toggle"")}func startServe() { logs.Logger.Error(""starting from function serve"")}func stoppingServe() { logs.Logger.Error(""stoping from function serve"")}**cliProject/cmd/start.go**package cmdimport ( ""cliProject/internal/logs"" ""github.com/spf13/cobra"")// startCmd represents the start commandvar startCmd = &cobra.Command{ Use: ""start"", Short: ""Start command"", Run: func(cmd *cobra.Command, args []string) { // Print the logs via logger from internal logs.Logger.Println(""start called inline"") // example of many functions which should use the logs... start() stopping() },}func init() { logs.NewLogger() rootCmd.AddCommand(startCmd) startCmd.Flags().BoolP(""toggle"", ""t"", false, ""Help message for toggle"")}func start() { logs.Logger.Error(""starting from function start"")}func stopping() { logs.Logger.Error(""stoping from function start"")}**cliProject/internal/logs/logger.go**package logsimport ( ""github.com/sirupsen/logrus"" ""github.com/x-cray/logrus-prefixed-formatter"" ""os"")var Logger *logrus.Loggerfunc NewLogger() *logrus.Logger { var level logrus.Level level = LogLevel(""info"") logger := &logrus.Logger{ Out: os.Stdout, Level: level, Formatter: &prefixed.TextFormatter{ DisableColors: true, TimestampFormat: ""2009-06-03 11:04:075"", }, } Logger = logger return Logger}func LogLevel(lvl string) logrus.Level { switch lvl { case ""info"": return logrus.InfoLevel case ""error"": return logrus.ErrorLevel default: panic(""Not supported"") }}",Using logger/configs in multi packages best practice for Golang productive
Using logger/configs in multi packages best practice GO," I've the following project structure: The log and the template are on the same level (under internal package)In logger.go Im using logrus as logger with some config sand I want to use the logger.go object inside the template package.How should I do that in a clean way ? Currently I use it with import logger inside my template.go file,And under internal package Ive 6 more packages which needs this logger. and each of them is depend on it.(On the log package), is there a nice in go to handle it ?update:in case I've more things that I need to pass (like logger) what will be the approach/ pattern here ? maybe using dependency injection ? interface ? other clean approach...I need some best practice full example how can I use logger inside the hello.go file and also in template.go.this is my project this is how it looks <code>  myGithubProject/ |---- cmd |----- command |----- hello.go |---- internal |----- template |----- template.go |----- log |----- logger.go main.go cliProject/main.gopackage mainimport ( ""cliProject/cmd"" ""cliProject/internal/logs"")func main() { cmd.Execute() logs.Logger.Error(""starting"")}**cliProject/cmd/root.go**package cmdimport ( ""fmt"" ""github.com/spf13/cobra"")var rootCmd = &cobra.Command{ Use: ""cliProject"", Short: ""A brief description of your application"",}func Execute() { if err := rootCmd.Execute(); err != nil { fmt.Println(err) }}**cliProject/cmd/serve.go**package cmdimport ( ""cliProject/internal/logs"" ""fmt"" ""github.com/spf13/cobra"")// serveCmd represents the serve commandvar serveCmd = &cobra.Command{ Use: ""serve"", Short: ""A brief description of your command"", Run: func(cmd *cobra.Command, args []string) { fmt.Println(""serve called"") startServe() stoppingServe() },}func init() { rootCmd.AddCommand(serveCmd) serveCmd.Flags().BoolP(""toggle"", ""t"", false, ""Help message for toggle"")}func startServe() { logs.Logger.Error(""starting from function serve"")}func stoppingServe() { logs.Logger.Error(""stoping from function serve"")}**cliProject/cmd/start.go**package cmdimport ( ""cliProject/internal/logs"" ""github.com/spf13/cobra"")// startCmd represents the start commandvar startCmd = &cobra.Command{ Use: ""start"", Short: ""Start command"", Run: func(cmd *cobra.Command, args []string) { // Print the logs via logger from internal logs.Logger.Println(""start called inline"") // example of many functions which should use the logs... start() stopping() },}func init() { logs.NewLogger() rootCmd.AddCommand(startCmd) startCmd.Flags().BoolP(""toggle"", ""t"", false, ""Help message for toggle"")}func start() { logs.Logger.Error(""starting from function start"")}func stopping() { logs.Logger.Error(""stoping from function start"")}**cliProject/internal/logs/logger.go**package logsimport ( ""github.com/sirupsen/logrus"" ""github.com/x-cray/logrus-prefixed-formatter"" ""os"")var Logger *logrus.Loggerfunc NewLogger() *logrus.Logger { var level logrus.Level level = LogLevel(""info"") logger := &logrus.Logger{ Out: os.Stdout, Level: level, Formatter: &prefixed.TextFormatter{ DisableColors: true, TimestampFormat: ""2009-06-03 11:04:075"", }, } Logger = logger return Logger}func LogLevel(lvl string) logrus.Level { switch lvl { case ""info"": return logrus.InfoLevel case ""error"": return logrus.ErrorLevel default: panic(""Not supported"") }}",Using logger/configs in multi packages best practice for Golang productive
How to get an exclusive read on a file in go," How can I get an exclusive read access to a file in go? I have tried documentations from docs but I am still able to open the file in notepad and edit it. I want to deny any other process to have access to read and write while the first process has not closed it explicitly. In .NET I could do something as: How do I do it in go?  <code>  File.Open(""a.txt"", FileMode.Open, FileAccess.ReadWrite, FileShare.None);",How to get an exclusive lock on a file in go
exported type Agent should have comment or be unexported golang VSCode, I tried this code in Go: And VS Code reports the following problem: exported type Agent should have comment or be unexportedThe warning is kind of annoying. So I have the following questions:How to get rid of it?What comment should I put?Is there any default comment template for this?It asks me to put a comment but it does not offer me to add one by default. <code>  type Agent struct { name string // Not exported categoryId int // Not exported},"""Exported type should have comment or be unexported"" golang VS Code"
"""exported type Agent should have comment or be unexported"" golang VSCode", I tried this code in Go: And VS Code reports the following problem: exported type Agent should have comment or be unexportedThe warning is kind of annoying. So I have the following questions:How to get rid of it?What comment should I put?Is there any default comment template for this?It asks me to put a comment but it does not offer me to add one by default. <code>  type Agent struct { name string // Not exported categoryId int // Not exported},"""Exported type should have comment or be unexported"" golang VS Code"
"How to remove a golang package downloaded with ""go get"" command?"," I want to know if there is golang way to delete or remove a go package. To be simpler, opposite to go get command. Please NOTE that I am aware that we can remove the downloaded files from src and pkg directory manually by using rm command. But the problem is that system command rm is not aware of your go specific stuffs (etc. to look inside $GOPATH/pkg .. ) and this is an extra step for the user while using rm . I am looking for something which all package managers provides.. as mentioned in one comment.. (npm uninstall, pip uninstall etc..). <code>  e.g. $ go get <PACKAGE_NAME> $ go delete <PACKAGE_NAME> (Looking for similar functionality)","How to remove a Go package downloaded with ""go get"" command?"
Use a gitlab private repo as a golang dependancy in docker," I am mirroring a popular go library in my organizations gitlab's group (for redundancy).In my code I have: import ( ""gitlab.com/org/group/library.git"" )I used this answer for guidance on using go get with a private repository. On my machine go get ./... works because I configured git using the following command: When I try to build a docker container the command RUN go get ./... fails with the following output: It seems the popular answer from a similar thread or this article is to do something like upload your ssh keys to the docker container. I don't really feel comfortable with that because I don't exactly understand what is doing, or the security implications. Any insight on how to properly configure my dockerfile or my golang work flow would be of great assistance.  <code>  $ git config --global url.git@gitlab.com:.insteadOf https://gitlab.com/ package gitlab.com/org/group/library.git: cannot download, git://gitlab.com/org/group/library uses insecure protocol",Using a gitlab private repo as a golang dependancy in docker
Unit testing - force error on reading response body," I've written http client wrapper in go and I need to test it thoroughly.I'm reading the response body with ioutil.ReadAll within the wrapper. I'm having a bit of trouble figuring out how I can force a read from the response body to fail with the help of httptest. I'm assuming I can set up a fake server as such: I'm assuming I need to modify the ResposeWriter. Now, is there any way for me to modify the responseWriter and thereby force the ioutil.ReadAll in the wrapper to fail?I realize that you seem to think it's a duplicate of this post and while you may believe so or it might be, just marking it as a duplicate doesn't really help me. The code provided in the answers in the ""duplicate"" post makes very little sense to me in this context. <code>  package reqfunc GetContent(url string) ([]byte, error) { response, err := httpClient.Get(url) // some header validation goes here body, err := ioutil.ReadAll(response.Body) defer response.Body.Close() if err != nil { errStr := fmt.Sprintf(""Unable to read from body %s"", err) return nil, errors.New(errStr) } return body, nil} package req_testfunc Test_GetContent_RequestBodyReadError(t *testing.T) { handler := func(w http.ResponseWriter, r *http.Request) { w.WriteHeader(http.StatusOK) } ts := httptest.NewServer(http.HandlerFunc(handler)) defer ts.Close() _, err := GetContent(ts.URL) if err != nil { t.Log(""Body read failed as expected."") } else { t.Fatalf(""Method did not fail as expected"") }}",How to force error on reading response body
golang: API to get the module name, Is there an API to get the module name of a project which uses go 1.11 module system?so I need to get abc.com/a/m from the module definition module abc.com/a/m in go.mod file. <code> ,API to get the module name
golang: extracting the public key from the private key," I trying to accomplish step (2) in the following way programmatically: Following is a simple function which reads the private key and tries to extract the public key.But, I am facing difficulty in matching the 2nd step, as the programmatically generated public key is different from the openssl CLI based public key, I am sure there must some mistake, Please, help me.Thanks IN case anyone wants to check the code and play around then here's the link:https://play.golang.org/p/rKerkh-31KI <code>  1. openssl genrsa -out signing.pem 20482. openssl rsa -in signing.pem -outform PEM -pubout -out signing.pub.pem func main() { priv, err := ioutil.ReadFile(""signing.pem"") block, _ := pem.Decode([]byte(priv)) if block == nil || block.Type != ""RSA PRIVATE KEY"" { log.Fatal(""failed to decode PEM block containing public key"") } key, err := x509.ParsePKCS1PrivateKey(block.Bytes) if err != nil { log.Fatal(err) } publicKeyDer := x509.MarshalPKCS1PublicKey(&pub.PublicKey) pubKeyBlock := pem.Block{ Type: ""PUBLIC KEY"", Headers: nil, Bytes: publicKeyDer, } pubKeyPem := string(pem.EncodeToMemory(&pubKeyBlock)) fmt.Println(pubKeyPem)}",Extracting the public key from the private key
Reversing strings in GO," I'm trying to invert a string in go but I'm having trouble handling the characters. Unlike C, GO treats strings as vectors of bytes, rather than characters, which are called runes here. I tried to do some type conversions to do the assignments, but so far I could not.The idea here is to generate 5 strings with random characters of sizes 100, 200, 300, 400 and 500 and then invert their characters. I was able to make C work with ease, but in GO, the language returns an error saying that it is not possible to perform the assignment. <code>  func inverte() { var c = ""A"" var strs, aux string rand.Seed(time.Now().UnixNano()) // Gera 5 vetores de 100, 200, 300, 400, e 500 caracteres for i := 1; i < 6; i++ { strs = randomString(i * 100) fmt.Print(strs) for i2, j := 0, len(strs); i2 < j; i2, j = i+1, j-1 { aux = strs[i2] strs[i2] = strs[j] strs[j] = aux } }}",How to manipulate strings in GO to reverse them?
Golang: how to properly use proxies in my HTTP requests?," I have a proxy IP Address (that also require a username and password). When i try using them to visit webpages, i get ""Proxy Authentication Required"".I'm found this other Stackoverflow post from 2016, and this Github Issue that was closed, but they don't provide anything useful:Proxy golang httpshttps://github.com/golang/go/issues/22288Any suggestions?EDIT:Saw this post: Setting up proxy for HTTP clientIt's kinda close. However, for some urls I'm able to get a successful response using my proxy, but for certain urls, I get a ""Proxy Authorization Required"". <code> ",How to use proxies with authentication in my HTTP requests?
Docker with golang to run tests," I use Docker to add my project to it, now I want to run some test on it and I got errors that the test failedAny idea what I miss here? Now I build the docker which finish successfully and now I want to run tests on it.I did docker run docker run -it goapp which run successfully And now I use command go test -v ./... and I got error Any idea how to resolve this ?I try another step in docker file like following which doesnt helps <code>  # build stageFROM golang:1.11.1-alpine3.8 AS builderRUN apk add --update --no-cache make \ gitADD https://github.com/golang/dep/releases/download/v0.5.0/dep-linux-amd64 /usr/bin/depRUN chmod +x /usr/bin/depRUN mkdir -p $GOPATH/src/github.company/user/go-applicationWORKDIR $GOPATH/src/github.company/user/go-applicationCOPY Gopkg.toml Gopkg.lock ./RUN dep ensure --vendor-onlyCOPY . ./ # runtime/cgoexec: ""gcc"": executable file not found in $PATHFAIL github.company/user/go-application [build failed]FAIL github.company/user/go-application/integration [build failed] RUN CGO_ENABLED=0 GOOS=linux go build -a -installsuffix nocgo -o /go-application .",How to disable CGO for running tests
HTTP JSON body response to map," I am trying to convert HTTP JSON body response to map[string]interface{} in Go.This is the code I wrote: I successfully connect to the server. The response's body contains JSON data. After running the code, data points to nil, why is that? <code>  func fromHTTPResponse(httpResponse *http.Response, errMsg string )(APIResponse, error){ temp, _ := strconv.Atoi(httpResponse.Status) var data map[string]interface{} resp, errResp := json.Marshal(httpResponse.Body) defer httpResponse.Body.Close() if errResp != nil { return APIResponse{}, errResp } err := json.Unmarshal(resp, &data) if err != nil { return APIResponse{}, err } return APIResponse{httpResponse.Status, data, (temp == OK_RESPONE_CODE), errMsg, map[string]interface{}{} }, nil}",Convert HTTP JSON body response to map in Go
How to parse json array struct in golang," I'm using the following code without success to parse json value but its inside array []https://play.golang.org/p/5HdWeyEtvie The idea is to get the value as key and print it , like a function that get string parameter=""created_at"" and prints it. <code>  package mainimport ( ""encoding/json"" ""fmt"")var input = `[{ ""created_at"": ""Thu May 31 00:00:01 +0000 2012""},{ ""created_at"": ""Thu May 31 00:00:01 +0000 2012""}]`func main() { var val map[string]interface{} if err := json.Unmarshal([]byte(input), &val); err != nil { panic(err) } fmt.Println(val)}",How to parse json array struct
GORM Lat Lng around position," I'm trying to make a specific request with GORM.Here are the tables I use: Locations table Location model Shops table Shop model Tag model Handler to return query in JSON So we have Stores, which have Locations, we want to display Stores within 15km of our Location. Only the last location is useful, that's why, we limited the results to 1 in decreasing order.EditThanks to @Rick James for suggesting me to rephrase my question, here is the query in MYSQL, how to adapt it to go-gorm: <code>  +-------------------+| Tables |+-------------------+| locations || shops || shops_tags || tags |+-------------------+ +------------+------------------+------+-----+---------+----------------+| Field | Type | Null | Key | Default | Extra |+------------+------------------+------+-----+---------+----------------+| id | int(10) unsigned | NO | PRI | NULL | auto_increment || shop_id | bigint(20) | YES | | NULL | || lat | decimal(10,8) | YES | | NULL | || lng | decimal(11,8) | YES | | NULL | |+------------+------------------+------+-----+---------+----------------+ type Location struct { gorm.Model ShopID int64 Shop Shop Lat float64 `gorm:""type:decimal(10,8)""` Lng float64 `gorm:""type:decimal(11,8)""`} +-------------+------------------+------+-----+---------+----------------+| Field | Type | Null | Key | Default | Extra |+-------------+------------------+------+-----+---------+----------------+| id | int(10) unsigned | NO | PRI | NULL | auto_increment || name | varchar(180) | YES | UNI | NULL | || active | tinyint(1) | YES | | 1 | |+-------------+------------------+------+-----+---------+----------------+ type Shop struct { gorm.Model Name string `json:""name"" gorm:""type:varchar(180);unique_index""` Active int `json:""active"" gorm:""type:tinyint(1);default:1""` Tags []*Tag `json:""tags"" gorm:""many2many:shops_tags;""` Locations []Location `json:""locations"" gorm:""locations""`} type Tag struct { gorm.Model Name string `json:""name"" gorm:""type:varchar(180)""` Shops []*Shop `json:""shops"" gorm:""many2many:shops_tags;""`} func GetShops(c echo.Context) error { db := db.DbManager() // Get POST data (name lat and lng) type geo struct { Lat string `json:""lat"" form:""lat"" query:""lat""` Lng string `json:""lng"" form:""lng"" query:""lng""` } // Bind request body g := new(geo) if err := c.Bind(g); err != nil { return c.JSON(http.StatusForbidden, err) } shops := []model.Shop{} // Totally disordered attempt of a query with `go-gorm` to display the list of nearby shops, sorted by the distance between us. db.Preload(""Locations"", func(db *gorm.DB) *gorm.DB { // How here use g.Lat and g.Lng for this request return db.Order(""locations.id DESC"").Limit(1) }).Preload(""Tag"").Find(&shops) // Json return c.JSON(http.StatusOK, echo.Map{ ""shops"": &shops, })} SELECTshops.id, shops.name, ( ( 6371.04 * ACOS( ( ( COS( ( ( PI() / 2 ) - RADIANS( (90 - locations.lat) ) ) ) * COS( PI() / 2 - RADIANS(90 - -33.73788500) ) * COS( ( RADIANS(locations.lng) - RADIANS('151.23526000') ) ) ) + ( SIN( ( ( PI() / 2 ) - RADIANS( (90 - locations.lat) ) ) ) * SIN( ( ( PI() / 2 ) - RADIANS(90 - -33.73788500) ) ) ) ) ) ) ) AS 'distance', locations.id AS 'location_id', locations.shop_id, locations.lat, locations.lng, locations.created_atFROMshopsINNER JOIN locations ON( locations.created_at >= '2017-12-13' AND( ( 6371.04 * ACOS( ( ( COS( ( ( PI() / 2 ) - RADIANS( (90 - locations.lat) ) ) ) * COS( PI() / 2 - RADIANS(90 - -33.73788500) ) * COS( ( RADIANS(locations.lng) - RADIANS('151.23526000') ) ) ) + ( SIN( ( ( PI() / 2 ) - RADIANS( (90 - locations.lat) ) ) ) * SIN( ( ( PI() / 2 ) - RADIANS(90 - -33.73788500) ) ) ) ) ) ) ) < '500' AND shops.id = (locations.shop_id))WHERE shops.active = 1GROUP BY shops.idORDER BY distance ASCLIMIT 100",Golang GORM query locations around a position with Lat and Lng
Golang GORM Request Lat Lng around position," I'm trying to make a specific request with GORM.Here are the tables I use: Locations table Location model Shops table Shop model Tag model Handler to return query in JSON So we have Stores, which have Locations, we want to display Stores within 15km of our Location. Only the last location is useful, that's why, we limited the results to 1 in decreasing order.EditThanks to @Rick James for suggesting me to rephrase my question, here is the query in MYSQL, how to adapt it to go-gorm: <code>  +-------------------+| Tables |+-------------------+| locations || shops || shops_tags || tags |+-------------------+ +------------+------------------+------+-----+---------+----------------+| Field | Type | Null | Key | Default | Extra |+------------+------------------+------+-----+---------+----------------+| id | int(10) unsigned | NO | PRI | NULL | auto_increment || shop_id | bigint(20) | YES | | NULL | || lat | decimal(10,8) | YES | | NULL | || lng | decimal(11,8) | YES | | NULL | |+------------+------------------+------+-----+---------+----------------+ type Location struct { gorm.Model ShopID int64 Shop Shop Lat float64 `gorm:""type:decimal(10,8)""` Lng float64 `gorm:""type:decimal(11,8)""`} +-------------+------------------+------+-----+---------+----------------+| Field | Type | Null | Key | Default | Extra |+-------------+------------------+------+-----+---------+----------------+| id | int(10) unsigned | NO | PRI | NULL | auto_increment || name | varchar(180) | YES | UNI | NULL | || active | tinyint(1) | YES | | 1 | |+-------------+------------------+------+-----+---------+----------------+ type Shop struct { gorm.Model Name string `json:""name"" gorm:""type:varchar(180);unique_index""` Active int `json:""active"" gorm:""type:tinyint(1);default:1""` Tags []*Tag `json:""tags"" gorm:""many2many:shops_tags;""` Locations []Location `json:""locations"" gorm:""locations""`} type Tag struct { gorm.Model Name string `json:""name"" gorm:""type:varchar(180)""` Shops []*Shop `json:""shops"" gorm:""many2many:shops_tags;""`} func GetShops(c echo.Context) error { db := db.DbManager() // Get POST data (name lat and lng) type geo struct { Lat string `json:""lat"" form:""lat"" query:""lat""` Lng string `json:""lng"" form:""lng"" query:""lng""` } // Bind request body g := new(geo) if err := c.Bind(g); err != nil { return c.JSON(http.StatusForbidden, err) } shops := []model.Shop{} // Totally disordered attempt of a query with `go-gorm` to display the list of nearby shops, sorted by the distance between us. db.Preload(""Locations"", func(db *gorm.DB) *gorm.DB { // How here use g.Lat and g.Lng for this request return db.Order(""locations.id DESC"").Limit(1) }).Preload(""Tag"").Find(&shops) // Json return c.JSON(http.StatusOK, echo.Map{ ""shops"": &shops, })} SELECTshops.id, shops.name, ( ( 6371.04 * ACOS( ( ( COS( ( ( PI() / 2 ) - RADIANS( (90 - locations.lat) ) ) ) * COS( PI() / 2 - RADIANS(90 - -33.73788500) ) * COS( ( RADIANS(locations.lng) - RADIANS('151.23526000') ) ) ) + ( SIN( ( ( PI() / 2 ) - RADIANS( (90 - locations.lat) ) ) ) * SIN( ( ( PI() / 2 ) - RADIANS(90 - -33.73788500) ) ) ) ) ) ) ) AS 'distance', locations.id AS 'location_id', locations.shop_id, locations.lat, locations.lng, locations.created_atFROMshopsINNER JOIN locations ON( locations.created_at >= '2017-12-13' AND( ( 6371.04 * ACOS( ( ( COS( ( ( PI() / 2 ) - RADIANS( (90 - locations.lat) ) ) ) * COS( PI() / 2 - RADIANS(90 - -33.73788500) ) * COS( ( RADIANS(locations.lng) - RADIANS('151.23526000') ) ) ) + ( SIN( ( ( PI() / 2 ) - RADIANS( (90 - locations.lat) ) ) ) * SIN( ( ( PI() / 2 ) - RADIANS(90 - -33.73788500) ) ) ) ) ) ) ) < '500' AND shops.id = (locations.shop_id))WHERE shops.active = 1GROUP BY shops.idORDER BY distance ASCLIMIT 100",Golang GORM query locations around a position with Lat and Lng
Golang: net/rpc .Call vs .Go, Im just getting started with Golang and the net/rpc package. Im trying to understand when you might use the asynchronous client.Go() call over the client.Call() method most examples online use. Would calling client.Call asynchronously via something like essentially be the same as using the client.Go call? Ive seen this example online too (for example when calling multiple simultaneous RPCs). <code>  go client.Call(...),What is the difference between net/rpc .Call vs .Go?
Sparkle: No popup when running the latest version?," I'm trying to use Sparkle with Qt (binding for Go) app.sparkle.m: sparke.go: And in main.go, I added a menu to call that func: It is working fine when there is an update: download, extract, install, relaunch, ...But when running the latest version, click ""Check for Updates..."" menu and nothing happens. There is no popup said that we are up-to-date, something like this:In Console, I only see this: appcast.xml: Info.plist: Did I miss something? <code>  #import <Headers/SUUpdater.h>static SUUpdater* updater = nil;void sparkle_checkUpdates(){ if (!updater) { updater = [[SUUpdater sharedUpdater] retain]; } [updater setUpdateCheckInterval:3600]; [updater checkForUpdatesInBackground];} // +build darwin windowspackage main/*#cgo CFLAGS: -I ${SRCDIR}/Sparkle.framework#cgo LDFLAGS: -F ${SRCDIR} -framework Sparklevoid sparkle_checkUpdates();*/import ""C""func sparkle_checkUpdates() { C.sparkle_checkUpdates()} package mainimport ( ""github.com/therecipe/qt/widgets"")func main() { action := widgets.NewQMenuBar(nil).AddMenu2("""").AddAction(""Check for Updates..."") // http://doc.qt.io/qt-5/qaction.html#MenuRole-enum action.SetMenuRole(widgets.QAction__ApplicationSpecificRole) action.ConnectTriggered(func(bool) { sparkle_checkUpdates() })} [3 <private> stream, pid: 90977, url: https://example.com/appcast.xml, traffic class: 200, tls] cancelled [3.1 70A1F65B-7E7A-4ED2-AB8B-A21621ED7658 <private>.58040<-><private>] Connected Path: satisfied (Path is satisfied), interface: en0, ipv4, dns Duration: 0.497s, DNS @0.000s took 0.001s, TCP @0.003s took 0.051s, TLS took 0.113s bytes in/out: 4481/675, packets in/out: 6/3, rtt: 0.053s, retransmitted packets: 0, out-of-order packets: 0 <?xml version=""1.0"" standalone=""yes""?><rss xmlns:sparkle=""http://www.andymatuschak.org/xml-namespaces/sparkle"" version=""2.0""> <channel> <title>Premium VPN</title> <item> <title>1.0.0.2905</title> <pubDate>Tue, 11 Dec 2018 11:09:10 +0800</pubDate> <sparkle:minimumSystemVersion>10.7</sparkle:minimumSystemVersion> <enclosure url=""https://example.com/x.zip"" sparkle:version=""1.0.0.2905"" sparkle:shortVersionString=""1.0.0.2905"" sparkle:edSignature=""x"" length=""104408678"" type=""application/octet-stream""/> </item> </channel></rss> <key>SUFeedURL</key> <string>https://example.com/appcast.xml</string> <key>SUPublicEDKey</key> <string>x</string>","No ""up to date"" message when running the latest version?"
"Sparkle: No ""up to date"" message when running the latest version?"," I'm trying to use Sparkle with Qt (binding for Go) app.sparkle.m: sparke.go: And in main.go, I added a menu to call that func: It is working fine when there is an update: download, extract, install, relaunch, ...But when running the latest version, click ""Check for Updates..."" menu and nothing happens. There is no popup said that we are up-to-date, something like this:In Console, I only see this: appcast.xml: Info.plist: Did I miss something? <code>  #import <Headers/SUUpdater.h>static SUUpdater* updater = nil;void sparkle_checkUpdates(){ if (!updater) { updater = [[SUUpdater sharedUpdater] retain]; } [updater setUpdateCheckInterval:3600]; [updater checkForUpdatesInBackground];} // +build darwin windowspackage main/*#cgo CFLAGS: -I ${SRCDIR}/Sparkle.framework#cgo LDFLAGS: -F ${SRCDIR} -framework Sparklevoid sparkle_checkUpdates();*/import ""C""func sparkle_checkUpdates() { C.sparkle_checkUpdates()} package mainimport ( ""github.com/therecipe/qt/widgets"")func main() { action := widgets.NewQMenuBar(nil).AddMenu2("""").AddAction(""Check for Updates..."") // http://doc.qt.io/qt-5/qaction.html#MenuRole-enum action.SetMenuRole(widgets.QAction__ApplicationSpecificRole) action.ConnectTriggered(func(bool) { sparkle_checkUpdates() })} [3 <private> stream, pid: 90977, url: https://example.com/appcast.xml, traffic class: 200, tls] cancelled [3.1 70A1F65B-7E7A-4ED2-AB8B-A21621ED7658 <private>.58040<-><private>] Connected Path: satisfied (Path is satisfied), interface: en0, ipv4, dns Duration: 0.497s, DNS @0.000s took 0.001s, TCP @0.003s took 0.051s, TLS took 0.113s bytes in/out: 4481/675, packets in/out: 6/3, rtt: 0.053s, retransmitted packets: 0, out-of-order packets: 0 <?xml version=""1.0"" standalone=""yes""?><rss xmlns:sparkle=""http://www.andymatuschak.org/xml-namespaces/sparkle"" version=""2.0""> <channel> <title>Premium VPN</title> <item> <title>1.0.0.2905</title> <pubDate>Tue, 11 Dec 2018 11:09:10 +0800</pubDate> <sparkle:minimumSystemVersion>10.7</sparkle:minimumSystemVersion> <enclosure url=""https://example.com/x.zip"" sparkle:version=""1.0.0.2905"" sparkle:shortVersionString=""1.0.0.2905"" sparkle:edSignature=""x"" length=""104408678"" type=""application/octet-stream""/> </item> </channel></rss> <key>SUFeedURL</key> <string>https://example.com/appcast.xml</string> <key>SUPublicEDKey</key> <string>x</string>","No ""up to date"" message when running the latest version?"
"Docker Composer, PG and GoLang Scratch, cannot get connection between containers"," I have included the code here..https://github.com/vinceyoumans/achalPROBLEM: Two containers in a docker compose file. one is standard Postgress container. The second is a goLang Scratch container. The GoLang main.go file panics when the postgres connection fails. you can see the code on github.The error is:dial tcp: lookup postgres on 127.0.0.11:53: no such hostREQUEST:look over the main.go and dockercompose file to see what is wrong with this network.. what I am missing.main.go The docker-compose.yml <code>  db, err := gorm.Open(""postgres"", ""host='postgres' port=5432 user=docker dbname='docker' password='password'"")if err != nil { fmt.Println(""============ exiting =========="") fmt.Println(err) panic(""failed to connect database e"") // the error i get... dial tcp: lookup postgres on 127.0.0.11:53: no such host // panic(""failed to connect database: "" + err)} version: '3.6'services: postgre: image: postgres:11.1-alpine ports: - '5432:5432' #network_mode: bridge #container_name: postgres environment: POSTGRES_USER: 'user' POSTGRES_PASSWORD: 'password' POSTGRESS_DB: 'db_amex01' volumes: - ./init:/docker-entrypoint-initdb.d/ todo: build: ./go_amex/ # ports: # - ""8000:8080""# sudo docker-compose -f docker-compose.yml up# HELP: how would I add the goLang service from this point?",Cannot get connection between containers
golang prepend int to array," I am fairly new to Go and thus my question might seem a bit naive.I have a slice which I created using I want to prepend an integer to this slice, something like but obviously it won't work since append needs a slice as the first argument.I have tried this but it only works for strings and it's not working in my case. <code>  var x []int;for i := 2; i < 10; i += 2 { x = append(x, i);} x = append(2, x)",How to prepend int to slice
How to prepend int to array," I am fairly new to Go and thus my question might seem a bit naive.I have a slice which I created using I want to prepend an integer to this slice, something like but obviously it won't work since append needs a slice as the first argument.I have tried this but it only works for strings and it's not working in my case. <code>  var x []int;for i := 2; i < 10; i += 2 { x = append(x, i);} x = append(2, x)",How to prepend int to slice
how does one support pagination using bigtable Go client ?," I store time series data in bigtable with a rowKey of userId#timestamp. Given query parameters of (userId, startTime, endTime) how can I support pagination i.e return 'limit' records starting from 'offset' ? note that userId#startTime rowKey may not exist in bigtable but there will some datapoints before and after startTime/EndTime. Bigtable Go client seems to support ReadRows with a prefixRange argument. I could use a prefixRange of userId and 'seek' to the startTime as I iterate using ReadRows but this seems very inefficient if starTime/endTime is way in the past. is there a better way ?? <code> ",how does one support pagination using bigtable Go client?
How to create a list of the dictionaries in the Golang?," I'm a newbie in Golang.I'm going to create a list of dictionaries that is resizable (this is not static) with append some dict to the list. Then I want to write it on a file, but I was confused.I want something like this: [UPDATE]:What is the .append() Python equivalent in Go language like the following code snippet? I've found the answer to this section ([UPDATE]) by borrowing from this answer: <code>  [ {""port"": 161, ""timeout"": 1, ""sleep_time"": 5, ""metrics"": [ {""tag_name"": ""output_current"", ""id"": 3}, {""tag_name"": ""input_voltage"", ""id"": 2} ]}, {""port"": 161, ""timeout"": 1, ""sleep_time"": 4, ""metrics"": [ {""tag_name"": ""destructor"", ""id"": 10} ]}] list_ = []dict_ = {""key"": val}list_.append(dict_) type Dictionary map[string]interface{}data := []Dictionary{}dict1 := Dictionary{""key"": 1}dict2 := Dictionary{""key"": 2}data = append(data, dict1, dict2)",How to create a list of the dictionaries in Golang?
How to get logs from kubernetes using golang?," I'm looking for the solution of how to get logs from a pod in Kubernetes cluster using Go. I've looked at ""https://github.com/kubernetes/client-go"" and ""https://godoc.org/sigs.k8s.io/controller-runtime/pkg/client"", but couldn't understand how to use them for this purpose. I have no issues getting information of a pod or any other object in K8S except for logs.For example, I'm using Get() from ""https://godoc.org/sigs.k8s.io/controller-runtime/pkg/client#example-Client--Get"" to get K8S job info: Please share of how you get pod's logs nowadays.Any suggestions would be appreciated!Update:The solution provided in Kubernetes go client api for log of a particular pod is out of date. It have some tips, but it is not up to date with current libraries. <code>  found := &batchv1.Job{}err = r.client.Get(context.TODO(), types.NamespacedName{Name: job.Name, Namespace: job.Namespace}, found)",How to get logs from kubernetes using Go?
Convert unix timetsamp to ISO format in golang," I'm trying to convert the timestamp 2018-12-17T15:03:49.000+0000 to ISO format in golang, but am getting an error cannot parse ""+0000"" as ""Z07:00""This is what I tried Any ideas? <code>  ts, err := time.Parse(time.RFC3339, currentTime)",Convert timestamp to ISO format in golang
How to fix refreshing error with Golang Echo and Angular," I'm setting up a web server with Go (using Echo) as the backend and Angular 6 as the frontend.What I do is make a simple app using Angular-cli 'ng new my-app', add a helloworld component and a '/helloworld' route and then build it into production with 'ng build --prod' which output as 'dist' folder.Folder structure: I then have Go serve the static files in that 'dist' folder with following codemain.go Now when I use the browser and go to 'localhost:3000/' then the page will be serve correctly, I can navigate around using href thanks to Angular routing ,for example to: 'localhost:3000/home' the page will show correctly but if I try refreshing it then Echo will return a page content that shows:{""message"":""Not Found""}I know I can setup the route manually like this: However if I have a lot more routes then its quite a hassle to do all that.What I need is that any route that's not defined for Echo will be map to 'index.html'. I did try with: and but then I get a blank page with error with all 3 files main.js, polyfill.js and runtime.jsI'm new to Echo so I don't know how to do this. <code>  dist assets icons logo.png favicon.ico index.html main.js polyfills.js runtime.js styles.css func main() { e := echo.New() e.Static(""/"", ""dist"") e.File(""/"", ""dist/index.html"") e.Start("":3000"")} e.File(""/home"",""dist/index.html"") e.File(""/*"", ""dist/index.html"") e.GET(""/*"", func(c echo.Context) return c.File(""dist/index.html"")}) ""Uncaught SyntaxError: Unexpected token < "" ",How to fix refreshing error with Echo and Angular
golang: call has possible formatting directive," When I run this code (playground link)I get the following warning: What is a proper way to do this? <code>  package mainimport (""fmt"")func main() { i := 5 fmt.Println(""Hello, playground %d"",i)} prog.go:5: Println call has possible formatting directive %dGo vet exited.",Call has possible formatting directive
"Golang + postgresql (lib/pq): sql: converting argument $1 type: unsupported type []int, a slice of in"," Have this: Got this:sql: converting argument $1 type: unsupported type []int, a slice of intAny way to make a slice of arguments work with lib/pq? <code>  somevars := []int{1, 2, 3, 4}rows, err = db.Query(""SELECT c1,c2 FROM table""+tid+"" WHERE c1 IN($1,$2,$3,$4);"", somevars)","sql: converting argument $1 type: unsupported type []int, a slice of in"
Performance problem with read and parse large XML files with golang," I have a directory which contains several large XML files (total size is about 10 GB). Is there any way to iterate through the directory containing the XML files and read 50 byte by 50 byte and parse the XML files with high performance? <code>  func (mdc *Mdc) Loadxml(path string, wg sync.WaitGroup) { defer wg.Done() //var conf configuration file, err := os.Open(path) if err != nil { log.Fatal(err) } defer file.Close() scanner := bufio.NewScanner(file) buf := make([]byte, 1024*1024) scanner.Buffer(buf, 50) for scanner.Scan() { _, err := file.Read(buf) if err != nil { log.Fatal(err) } } err = xml.Unmarshal(buf, &mdc) if err != nil { log.Fatal(err) } fmt.Println(mdc)}",Performance problem with read and parse large XML files
How do you dockerize a Websocket Server?," I'm having trouble with putting my WebSocket server in a Docker container.This is the server code, which writes to a new connection with ""connected"". Here is the client: Running server.go then client.go prints ""connected"", showing that the code is working. Now I want to put the server in a Docker container. This is dockerfile: I use these commands to build and start the container, exposing 8000/tcp. I can confirm that the server is running because it prints ""server is running"". If I start client.go outside the container, it panics: What I expect is the same outcome as beforeprinting ""connected"" on the client side. The error message means that the server dropped the connection before the handshake. I don't understand the ""60328"" number. As far as I know, WebSocket doesn't change ports on upgrade, so I should be okay with exposing just 8000.I do not know what I must change to be able to connect via WebSocket to my server. <code>  // server.gofunc RootHandler(w http.ResponseWriter, r *http.Request) { upgrader := websocket.Upgrader{ // (Uses gorilla/websocket) ReadBufferSize: 4096, WriteBufferSize: 4096, } conn, err := upgrader.Upgrade(w, r, nil) if err != nil { panic(err) } if err = conn.WriteMessage(websocket.TextMessage, []byte(""connected"")); err != nil { panic(err) }}func main() { fmt.Println(""server is running"") // For graceful shutdown stop := make(chan os.Signal, 1) signal.Notify(stop, os.Interrupt) server := http.Server{Addr: ""localhost:8000""} defer server.Close() http.HandleFunc(""/"", RootHandler) go func() { err := server.ListenAndServe() if err != nil && err != http.ErrServerClosed { panic(err) } }() <-stop} // client.gofunc main() { connection, _, err := websocket.DefaultDialer.Dial(""ws://localhost:8000"", nil) if err != nil { panic(err) } _, b, err := connection.ReadMessage() if err != nil { panic(err) } fmt.Println(string(b)) // ""connected""} FROM golang:1.11.4-alpine3.8COPY . $GOPATH/src/websocket-testWORKDIR $GOPATH/src/websocket-testRUN [""go"", ""build"", ""server.go""]EXPOSE 8000CMD [""./server""] docker build -t websocket-test .docker run -p 8000:8000 websocket-test panic: read tcp [::1]:60328->[::1]:8000: read: connection reset by peer",How do you dockerize a WebSocket Server?
How to read cookies from golang?," I set a cookie from javascript such as: After cookie is set I want to redirect the user to a booking page: The setCookie function: I'd like to retrieve that cookie from my go backend but I can't figure out how to do this. I've read about this question since I've never used cookies before but the answers seems to tell that I don't have to do much aside from setting document.cookie.In my browser storage I can see the cookie is indeed set as expected.In my Go back end I want to print the cookie: What is the specific I am missing ? I think I'm confusing local/http cookie but how to achieve the reading of client set cookies?UPDATE (see answer for more)It has nothing to do with golang. My: What formatted as 2019-01-01 and - is not a valid character that can be send to the backend. It worked into my browser, but it needs to be URI encoded to be passed.So this did the trick: And in go (didn't catch err here to save space): <code>  setCookie(""appointment"", JSON.stringify({ appointmentDate: selectedDay.date, appointmentStartMn: appointment.mnRange[0], appointmentId: appointment.id || 0, appointmentUserId: appointment.user.id || 0 })); window.location.href = ""https://localhost:8080/booking/"" function setCookie(cookieName, cookieValue) { document.cookie = `${cookieName}=${cookieValue};secure;`;} r.HandleFunc(""/booking/"", handler.serveTemplate)func (handler *templateHandler) serveTemplate(w http.ResponseWriter, r *http.Request) { c, err := r.Cookie(""appointment"") if err != nil { fmt.Println(err.Error()) } else { fmt.Println(c.Value) }}//output http: named cookie not present appointmentDate: selectedDay.date `${cookieName}=${encodeURIComponent(cookieValue)};secure;` + ""path=/"";` cookie, _ := r.Cookie(""appointment"")data, _ := url.QueryUnescape(cookie.Value)",How to read cookies?
string.Replace does not remove white spaces," I want to check if string is empty and parse the string in time. Please find the below code How to remove this empty character from string? Or check if string contains this empty character? <code>  valueStr = strings.Replace(string(valueStr), "" "", """", -1)valueStr = strings.Replace(string(valueStr), ""\t"", """", -1)valueStr = strings.Replace(string(valueStr), ""\n"", """", -1)valueStr = strings.Replace(string(valueStr), ""\r"", """", -1)var re = regexp.MustCompile(`\s`)valueStr = re.ReplaceAllString(valueStr, """")if valueStr != """" { fmt.Printf(""-------- valueStr %c: \n"", valueStr) // o/p => -------- valueStr %!c(string= ): fmt.Printf(""-------- valueStr %#v: \n"", valueStr) // o/p => -------- valueStr ""\x00"": fmt.Printf(""-------- valueStr %x: \n"", valueStr) // o/p => -------- valueStr 00: fmt.Println(""-------- valueStr length: "", len(valueStr)) // o/p => -------- valueStr length: 1 // considering valueStr is not empty, parse string to time time, err := time.Parse(TIME_FORMAT, strings.TrimSpace(valueStr)) if err != nil { fmt.Println(""-------- Error converting time: "", err) // o/p => -------- Error converting time: parsing time "" "" as ""15:04:05"": cannot parse "" "" as ""15"" return }} else { // another code}",remove null character from string
How to fix environment variables not working while running from system-d service in GO lang," I am using os.Getenv(""APP_PATH"") to read from the system environment variables and it works fine when running the build of the application normally. But I need to run this Go program as a service which I have done using systemd in which case it cannot read the environment variables. Is there any way of resolving this? <code> ",How to fix environment variables not working while running from system-d service in Go
Go: Efficient way to remove all non-alphanumeric characters from large text," I need to process volumes of text and one of the steps is to remove all non-alphanumeric characters. I'm trying to find an efficient way to do it.So far I have two functions: Here I actually have to feed a string of all non-alpha characters.And plain old regex The regex one seems to be much slower Looking for suggestions. Any other better way to do it? Improve the above? <code>  func stripMap(str, chr string) string { return strings.Map(func(r rune) rune { if strings.IndexRune(chr, r) < 0 { return r } return -1 }, str)} func stripRegex(in string) string { reg, _ := regexp.Compile(""[^a-zA-Z0-9 ]+"") return reg.ReplaceAllString(in, """")} BenchmarkStripMap-8 30000 37907 ns/op 8192 B/op 2 allocs/opBenchmarkStripRegex-8 10000 131449 ns/op 57552 B/op 35 allocs/op",Efficient way to remove all non-alphanumeric characters from large text
Golang composite literal uses unkeyed fields," I am working with new official mongodb driver for golang. I have created one complex query to insert the data into mongo db and then sort it according to an element value. I am using a filter in which I have created the bson type using :- But It is showing a warning saying: primitive.E composite literal uses unkeyed fieldsThe warnings are creating a mess in my code. <code>  filter := bson.D{{""autorefid"", ""100""}}",Composite literal uses unkeyed fields
"Named prepared statement in pxg lib, what's the point?"," Introductiondatabase/sqlIn the Go standard sql library, the *Stmt type has methods defined like: The a new (unnamed) statement is prepared by: Connection pool is abstracted and not directly accessibleA transaction is prepared on a single connectionIf the connection is not available at statment execution time, it will be re-prepared on a new connection.pgxThe PreparedStatement type doesn't have any methods defined. A new named prepared statement is prepared by: Operations are directly on the connection poolThe transaction gets prepared on all connections of the poolThere is no clear way how to execute the prepared statementIn a Github comment, the author explains better the differences of architecture between pgx and database/sql. The documentation on Prepare also states (emphasis mine): Prepare is idempotent; i.e. it is safe to call Prepare multiple times with the same name and sql arguments. This allows a code path to Prepare and Query/Exec/PrepareEx without concern for if the statement has already been prepared. Small example Question(s)The name argument gives me the impression it can be executed by calling it by name, but how?The documentation gives the impression that Query/Exec methods somehow leverage the prepared statements. However, those methods don't take a name argument. How does it match them?Presumably, matching is done by the query content. Then what's the whole point of naming statements?Possible answersThis is how far I got myself:There are no methods that refer to the queries by name (assumption)Matching is done on the query body in conn.ExecEx(). If it is not yet prepared, it will be done: PosgreSQL itself needs it for something (assumption). <code>  func (s *Stmt) Exec(args ...interface{}) (Result, error)func (s *Stmt) Query(args ...interface{}) (*Rows, error) func (db *DB) Prepare(query string) (*Stmt, error) func (p *ConnPool) Prepare(name, sql string) (*PreparedStatement, error) package mainimport ( ""github.com/jackc/pgx"")func main() { conf := pgx.ConnPoolConfig{ ConnConfig: pgx.ConnConfig{ Host: ""/run/postgresql"", User: ""postgres"", Database: ""test"", }, MaxConnections: 5, } db, err := pgx.NewConnPool(conf) if err != nil { panic(err) } _, err = db.Prepare(""my-query"", ""select $1"") if err != nil { panic(err) } // What to do with the prepared statement?} ps, ok := c.preparedStatements[sql] if !ok { var err error ps, err = c.prepareEx("""", sql, nil) if err != nil { return """", err } }","Named prepared statement in pgx lib, how does it work?"
How display result count Query using Gorm to String in golang?," I'm working on a RESTful API project, and I have problem that my code can query with gorm, my query like this countSequenceId := db.Debug().Raw(""SELECT COUNT (*) FROM SMSBlast2"").Scan(&smsblast1). I have the result [1 rows affected or returned], that mean success to count my all row in database , but I want to display the result like result count = 10, but how? <code>  package mainimport ( ""encoding/json"" ""fmt"" ""github.com/gorilla/mux"" ""github.com/jinzhu/gorm"" _ ""github.com/jinzhu/gorm/dialects/mssql"" ""log"" ""net/http"" ""strconv"" ""time"")type SMSBlast struct { SequenceID int `gorm:""primary_key"";column:""SequenceID""` MobilePhone string `gorm:""column:MobilePhone""` Output string `gorm:""column:Output""` WillBeSentDate *time.Time `gorm:""column:WillBeSentDate""` SentDate *time.Time `gorm:""column:SentDate""` Status *string `gorm:""column:Status""` DtmUpd time.Time `gorm:""column:DtmUpd""`}func (SMSBlast) TableName() string { return ""SMSBlast2""}func allSMSBlasts(w http.ResponseWriter, r *http.Request){ db, err := gorm.Open(""mssql"", ""sqlserver://sa:@localhost:1433?database=CONFINS"") if err != nil{ panic(""failed to connect database"") } defer db.Close() var smsblasts []SMSBlast db.Debug().Find(&smsblasts) fmt.Println(""{}"",smsblasts) json.NewEncoder(w).Encode(smsblasts)}func insertSMSBlast(w http.ResponseWriter, r *http.Request){ fmt.Println(""New Insert Created"") db, err := gorm.Open(""mssql"", ""sqlserver://sa:@localhost:1433?database=CONFINS"") if err != nil{ panic(""failed to connect database"") } defer db.Close() vars := mux.Vars(r) mobilephone := vars[""mobilephone""] output := vars[""output""] var( smsblast1 SMSBlast ) countSequenceId := db.Debug().Raw(""SELECT COUNT (*) FROM SMSBlast2"").Scan(&smsblast1) fmt.Println(countSequenceId) msg, err := json.Marshal(countSequenceId) if err != nil{ fmt.Println(err.Error()) } sequenceid1,_ := strconv.Atoi(string(msg)) fmt.Println(""SequenceID : "" , sequenceid1) smsblasts := SMSBlast{SequenceID: sequenceid1,MobilePhone: mobilephone,Output:output, DtmUpd: time.Now()} prindata := db.Create(&smsblasts) fmt.Println(prindata)func handleRequests(){ myRouter := mux.NewRouter().StrictSlash(true) myRouter.HandleFunc(""/smsblaststest"",allSMSBlasts).Methods(""POST"") myRouter.HandleFunc(""/smsblaststestInsert/{mobilephone}/{output}"", insertSMSBlast).Methods(""POST"") log.Fatal(http.ListenAndServe("":8080"",myRouter))}func main(){ fmt.Println(""SMSBLASTS ORM"") handleRequests()}",How display result count from query
Gob decode cannot decode interface after registered type," I have these types defined: When I try to use UnmarshalMessage I got the error gob: OtherMsg is not assignable to type MyMessage. I have no difference with the usage in the go examples for encoding and decoding an interface. What am I doing wrong? <code>  func init() { gob.RegisterName(""MyMessageHeader"", MyMessageHeader{}) gob.RegisterName(""OtherMsg"", OtherMsg{})}//// Messages//type MyMessageHeader struct { MessageId InstanceIdType OtherId uint64}type MyMessage interface { Id() *MyMessageHeader}type otherStruct struct { X uint8 Y uint8}type OtherMsg struct { MyMessageHeader OtherField *otherStruct}func (m *OtherMsg) Id() *MyMessageHeader { return &m.MyMessageHeader}func MarshalMessage(m MyMessage) ([]byte, error) { var buff bytes.Buffer encoder := gob.NewEncoder(&buff) if err := encoder.Encode(&m); err != nil { return nil, errors.Newf(""Could not marshal message: %v"", err) } return buff.Bytes(), nil}func UnmarshalMessage(buf []byte) (MyMessage, error) { var msg MyMessage decoder := gob.NewDecoder(bytes.NewReader(buf)) if err := decoder.Decode(&msg); err != nil { return nil, errors.Newf(""Could not decode my message: %v"", err) } return msg, nil}",Gob decode cannot decode interface after register type
How to store session data in a chi router context," In a Golang app, I'm using gorilla/sessions with the mySQL backend to store data in a session but I'd like to store the data in the chi router context instead. How do I add auth token strings or structs into the context? I see plenty of examples explaining how to read/use them but none I saw explain how to insert the data into the context within a login function.For example, the chi documentation here has the following code to check admin user which will work for me but it offers no clue as to how the auth object got into the context in the first place. There is another middleware function describing how to load an article struct into the context and gets its id parameter from the URL but that wont work for me. I don't really want to use a cookie as that would defeat the whole purpose in using the context. In the example below I want to store the User struct or an auth token in the context. Additionally, how would I handle flashes in the context? Can I do that or should I just stick to the db based sessions for web apps? Ideally, I want to use the same method for both a web app serving templates and a separate API app.Here is my web app login code, simplified a bit to remove the cruft: <code>  // AdminOnly middleware restricts access to just administrators.func AdminOnly(next http.Handler) http.Handler { return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) { isAdmin, ok := r.Context().Value(""acl.admin"").(bool) if !ok || !isAdmin { http.Error(w, http.StatusText(http.StatusForbidden), http.StatusForbidden) return } next.ServeHTTP(w, r) })} func (rs *appResource) login(w http.ResponseWriter, r *http.Request) {// appResource contains db connection, session store and templates var authUser AuthUser //struct session, err := rs.store.Get(r, ""admin-data"") email := r.FormValue(""email"") password := r.FormValue(""password"") sqlStatement := ""SELECT id, venue_id, first_name, last_name, email, password FROM Users WHERE email=?"" row := rs.db.QueryRow(sqlStatement, email) err = row.Scan(&authUser.UserID, &authUser.VenueID, &authUser.FirstName, &authUser.LastName, &authUser.Email, &authUser.Password) if err = bcrypt.CompareHashAndPassword([]byte(authUser.Password), []byte(password)); err != nil { session.AddFlash(""Your password is incorrect"") session.Save(r, w) http.Redirect(w, r, ""/signin"", http.StatusFound) return } authUser.Authenticated = true session.Values[""authUser""] = authUser firstName := authUser.FirstName message := fmt.Sprintf(""Welcome, %s!"", firstName) session.AddFlash(message) session.Save(r, w) http.Redirect(w, r, ""/"", http.StatusFound) }",How to store session data in a chi router context from login
Problem with timestamp in Golang application," In PostgreSQL, I have table called surveys. As you can see only SURVEY_ID and SURVEY_NAME columns are NOT NULL.In Go, I want to create new entry in that table by POST request. I send JSON object like this: Unfortunatly it raise strange ERROR: Where I make mistake and how to fix my problem?models/surveys.go: controllers/surveys.go: <code>  CREATE TABLE SURVEYS( SURVEY_ID UUID PRIMARY KEY NOT NULL DEFAULT uuid_generate_v4(), SURVEY_NAME VARCHAR NOT NULL, SURVEY_DESCRIPTION TEXT, START_PERIOD TIMESTAMP, END_PERIOD TIMESTAMP); { ""survey_name"": ""NAME"", ""survey_description"": ""DESCRIPTION"", ""start_period"": ""2019-01-01 00:00:00"", ""end_period"": ""2019-02-28 23:59:59""} parsing time """"2019-01-01 00:00:00"""" as """"2006-01-02T15:04:05Z07:00"""": cannot parse "" 00:00:00"""" as ""T"" import ( ""database/sql"" ""time"")type NullTime struct { time.Time Valid bool}type Survey struct { ID int `json:""survey_id""` Name string `json:""survey_name""` Description sql.NullString `json:""survey_description""` StartPeriod NullTime `json:""start_period""` EndPeriod NullTime `json:""end_period""`} var CreateSurvey = func(responseWriter http.ResponseWriter, request *http.Request) { // Initialize variables. survey := models.Survey{} var err error // The decoder introduces its own buffering and may read data from argument beyond the JSON values requested. err = json.NewDecoder(request.Body).Decode(&survey) if err != nil { log.Println(err) utils.ResponseWithError(responseWriter, http.StatusInternalServerError, err.Error()) return } defer request.Body.Close() // Execute INSERT SQL statement. _, err = database.DB.Exec(""INSERT INTO surveys (survey_name, survey_description, start_period, end_period) VALUES ($1, $2, $3, $4);"", survey.Name, survey.Description, survey.StartPeriod, survey.EndPeriod) // Shape the response depending on the result of the previous command. if err != nil { log.Println(err) utils.ResponseWithError(responseWriter, http.StatusInternalServerError, err.Error()) return } utils.ResponseWithSuccess(responseWriter, http.StatusCreated, ""The new entry successfully created."")}",Problem parsing values of PostgreSQL TIMESTAMP type
GoLang struct to MySQL, I'm creating a CRUD program using Go and I have quite a big struct with over 70 fields that I want to add to a MySQL database.I was wondering if there's a way to automatically map the struct into my database so I wouldn't have to create the table manually and it would just copy my struct? <code> ,How to generate MySQL table from Go struct
How do I handle hourly Bigtable connexion closes on BigTable," I have golang services with persistant Bigtable client.The services are making hundred of read/write operation on Bigtable per sec.Every hours from the service boot, I experience hundred of errors like this one: The error are followed by an increased processing time I can't allow when thoses errors occur.I was able to figure out that Bigtable client is using a pool of gRPC connections.It seems that Bigtable gRPC server have a connection maxAge of 1 hour which can explain the error above and the processing time increasing during reconnection.A maxAgeGrace configuration is supposed to give additional time to complete current operations and avoid all pool connections to terminate at the same time.I increased connection pool size from default 4 to 12 with no real benefitHow do I prevent processing time to increase during reconnections and these error to happen, given my traffic will keep growing? <code>  Retryable error: rpc error: code = Unavailable desc = the connection is draining, retrying in 74.49241ms",How to handle hourly Bigtable connection closes?
How to handle hourly Bigtable connexion closes?," I have golang services with persistant Bigtable client.The services are making hundred of read/write operation on Bigtable per sec.Every hours from the service boot, I experience hundred of errors like this one: The error are followed by an increased processing time I can't allow when thoses errors occur.I was able to figure out that Bigtable client is using a pool of gRPC connections.It seems that Bigtable gRPC server have a connection maxAge of 1 hour which can explain the error above and the processing time increasing during reconnection.A maxAgeGrace configuration is supposed to give additional time to complete current operations and avoid all pool connections to terminate at the same time.I increased connection pool size from default 4 to 12 with no real benefitHow do I prevent processing time to increase during reconnections and these error to happen, given my traffic will keep growing? <code>  Retryable error: rpc error: code = Unavailable desc = the connection is draining, retrying in 74.49241ms",How to handle hourly Bigtable connection closes?
Check if JSON is Object or Array," Is there a simple way in Go to check whether given JSON is either an Object {} or array []?The first thing that comes to mind is to json.Unmarshal() into an interface, and then see if it becomes a map, or a slice of maps. But that seems quite inefficient.Could I just check if the first byte is a { or a [? Or is there a better way of doing this that already exists. <code> ",Check if JSON is Object or Array
Golang - Check if JSON is Object or Array," Is there a simple way in Go to check whether given JSON is either an Object {} or array []?The first thing that comes to mind is to json.Unmarshal() into an interface, and then see if it becomes a map, or a slice of maps. But that seems quite inefficient.Could I just check if the first byte is a { or a [? Or is there a better way of doing this that already exists. <code> ",Check if JSON is Object or Array
"Checking if current time is in a given intervan, GOLANG"," I am trying to find a way to check if the current time is in a given interval, where start and end are given (eventually) by a user.I have been trying by using the After and Before from the Time package after making sure all times are in UTC, but clearly I am doing something wrong.The code looks similar to this example: Any help is appreciated. <code>  func inTimeSpan(start, end, check time.Time) bool { return check.After(start) && check.Before(end)}func main() { now := time.Now() newLayout := ""15:04"" ns, _ := time.Parse(newLayout, strconv.Itoa(now.Hour())+"":""+strconv.Itoa(now.Minute())) srt, _ := time.Parse(newLayout, ""23:00"") end, _ := time.Parse(newLayout, ""05:00"") fmt.Println(""1 : "", inTimeSpan(srt, end, ns))}","Checking if current time is in a given interval, GOLANG"
Is adding variadic parameters a backwards-compatible change?," Is adding a variadic parameter to an existing Go function a breaking change?For example: Callers of the API can omit the new parameter, so I would think the API is backwards-compatible. Can anyone provide an example where a user of the old API could not use the new API without changing their code? <code>  // Old functionfunc Foo(a int)// Updated to:func Foo(a int, params ...string)",Could adding variadic parameters to a function break existing code?
"golang can a process read its own ""standard out"" stream"," How would a process read its own output stream? I am writing automated tests which start a few application sub-processes (applications) in the same process as the test. Therefore, the standard out is a mix of test output and application output. I want to read the output stream at runtime and fail the test if I see errors from the application. Is this possible/feasible? If so, how do I do it?Note: I know I could start the applications as their own separate processes and then read their output streams. That's a lot of work from where I am now. Also note, this is not a dupe of How to test a function's output (stdout/stderr) in Go unit tests, although that ticket is similar and helpful. The other ticket is about capturing output for a single function call. This ticket is about reading the entire stream, continuously. The correct answer is also a little different - it requires a pipe. <code> ","Can a process read its own ""standard out"" stream?"
Go Test: how to exclude or skip specific directory while running GO test," I am using the above command to test the files but there is 1 folder with the name ""Store"" that I want to exclude from tests. How it can be done?  <code>  go test $(go list ./... | grep -v /vendor/) -coverprofile .testCoverage.txt",How to exclude or skip specific directory while running 'go test'
Attempting to convert some code to Go Cloud when using KMS," I have some code to upload and download files from Google Cloud Storage. Below is an abbreviated example: The tricky part is that I'm using Google KMS to manage the keys I'm using to encrypt files (Google's so-called ""customer-managed encryption key"" scheme). My understanding is that this encryption happens on Google's end.The only solution I found using the Go CDK was to encrypt the files using Google KMS and then upload the encrypted blob. Is there no way to specify the encryption key in the same manner I was doing before with the Go CDK?Thanks <code>  import ( ""context"" ""io"" ""cloud.google.com/go/storage"")func upload(bucket, keyName, path string, reader io.Reader) error { ctx := context.Background() client, err := storage.NewClient(ctx) if err != nil { return err } defer client.Close() obj := client.Bucket(bucket).Object(path) writer := obj.NewWriter(ctx) defer writer.Close() writer.KMSKeyName = keyName if _, err = io.Copy(writer, reader); err != nil { return err } if err = writer.Close(); err != nil { return err } return nil}",Attempting to convert some code to Go CDK when using KMS
in go language and kubernetes how to get namespace from current-context set in .kube/config," I am trying to get programmatically in Go, the namespace of the current-context from ~/.kube/config.So far what I tried is from these modules: But still no clue if clientset can give me the namespace I am looking for. From this thread:How to get current namespace of an in-cluster go Kubernetes clientIt says something of this to be done:kubeconfig.Namespace() <code>  ""k8s.io/client-go/tools/clientcmd"" ""k8s.io/client-go/kubernetes""kubeconfig := filepath.Join( os.Getenv(""HOME""), "".kube"", ""config"",)config, err := clientcmd.BuildConfigFromFlags("""", kubeconfig)if err != nil { log.Fatal(err)}fmt.Printf(""Namespace: %s\n"", config.Namespace())clientset, err := kubernetes.NewForConfig(config)if err != nil { log.Fatal(err)}",How to get namespace from current-context set in .kube/config
How do you convert a time offset to a location/timezone in go," Given an arbitrary time offset, how does one go about creating a usable time.Location object that represents that time offset?The following code parses a time using an offset, but fmt.Println(t.Location()) subsequently returns no information: Playground: https://play.golang.org/p/j_E28qJ8VgyBasically I have some time data with time offsets, but without location data, I want to create a time.Location object to ensure the GMT offset is recorded. And then be able to output the time relative to the end users actual location time offset. <code>  func main() { offset := ""+1100"" t, err := time.Parse(""15:04 GMT-0700"",""15:06 GMT""+offset) if err != nil { fmt.Println(""fail"", err) } fmt.Println(t) fmt.Println(t.UTC()) fmt.Println(t.Location())}",How do you convert a time offset to a location/timezone in Go
Type assertion fails even when it is clearly correct," I have a json response from a api as map[message:Login Success. userid:1]Server: Client: But userID, ok := result[""userid""].(int) always fails. I've even tried using: And it just gave me unknown. Why is the integer not being taken as integer?It looks like its treating the value as float64. <code>  c.JSON(200, gin.H{""message"": ""Login Success."", ""userid"": 1}) var result map[string]interface{}json.NewDecoder(resp.Body).Decode(&result)msg, ok := result[""message""].(string)if !ok { msg = ""Something went wrong.""}userID, ok := result[""userid""].(int)if !ok { userID = 0} switch v := x.(type) {case nil: fmt.Println(""x is nil"") case int: fmt.Println(""x is"", v) case bool, string: fmt.Println(""x is bool or string"")default: fmt.Println(""type unknown"") }",JSON decoded value is treated as float64 instead of int
Go build with another glibc," I have installed another version of GLIBC and want to compile Golang code against this new GLIBC.I have tried the following command for dynamic compilation: But when I run ldd ""go_executable"", it still shows linked to default glibc.Output: Expected Output: What is missing here? <code>  go build --ldflags '-linkmode external -L /path/to/another_glibc/ linux-vdso.so.1 => (0x00007fff29da7000)libc.so.6 => /lib/x86_64-linux-gnu/libc.so.6 (0x00007f128a93c000)/lib64/ld-linux-x86-64.so.2 (0x00007f128ad06000) linux-vdso.so.1 => (0x00007fff45fa7000)libc.so.6 => /another_glibc/lib/libc.so.6 (0x00007f5cd2067000)/another_glibc/ld-2.29.so => /lib64/ld-linux-x86-64.so.2 (0x00007f5cd2420000)",Go build with another glibc
Getting Error on Go build with another glibc," I have installed another version of GLIBC and want to compile Golang code against this new GLIBC.I have tried the following command for dynamic compilation: But when I run ldd ""go_executable"", it still shows linked to default glibc.Output: Expected Output: What is missing here? <code>  go build --ldflags '-linkmode external -L /path/to/another_glibc/ linux-vdso.so.1 => (0x00007fff29da7000)libc.so.6 => /lib/x86_64-linux-gnu/libc.so.6 (0x00007f128a93c000)/lib64/ld-linux-x86-64.so.2 (0x00007f128ad06000) linux-vdso.so.1 => (0x00007fff45fa7000)libc.so.6 => /another_glibc/lib/libc.so.6 (0x00007f5cd2067000)/another_glibc/ld-2.29.so => /lib64/ld-linux-x86-64.so.2 (0x00007f5cd2420000)",Go build with another glibc
golang go build can't find a revision," I developed a repo on computer A and created a go.mod/go.sum that I checked in.I pull that repo with the go.mod/go.sum files on computer B, but when I try to build the program, the module constraints can't be satisfied. The repo that is failing is a private repo, and for some reason it doesn't get downloaded to the module cache. On another computer, the dependencies are downloaded and the build succeeds. I am building another private repo in that same domain, so I know that my github credentials give me access to these repos. But for some reason, the go module system can't get to the dependent repo.I cannot find more information how to debug this. <code>  $ go buildgo: finding github.ibm.com/kms/key-protect-client v0.1.5go: finding golang.org/x/tools v0.0.0-20180221164845-07fd8470d635go: github.ibm.com/kms/key-protect-client@v0.1.5: unknown revision v0.1.5go: error loading module requirements",go build can't find a revision
modify yaml file and add new node with data," I recently saw that the go yaml lib has new version (V3)with the nodes capabilities (which in my opinion is a killer feature :) ) which can helps a lots with modifying yamls without changing the structure of the fileBut since it is fairly new (from last week ) I didn't find some helpful docs and example for the context which I need (add new object/node and to keep the file structure the same without removing the comments etc)what I need is to manipulate yaml file for example lets say Ive this yaml file Now I got an json object (e.g. with app2) which I need to insert to the existing file and I need to add it to the yml file after the first application, (applications is array of application) is it possible to add from the yaml file the new json object ? also remove existingI also found this bloghttps://blog.ubuntu.com/2019/04/05/api-v3-of-the-yaml-package-for-go-is-availableThis is the types which represent the object updateafter testing the solution which is provided by wiil7200 I found 2 issuesI use at the end write it to fileerr = ioutil.WriteFile(""output.yaml"", b, 0644)And the yaml output have 2 issue. The array of the application is starting from the comments, it should start from the name After the name entry the kind property and all others after are not aligned to the name any idea how to solve those issue ? regard the comments issue, lets say I got it from other propertyand not from the json (if it make it more simpler) <code>  version: 1type: verbosekind : bfr# my list of applicationsapplications: - name: app1 kind: nodejs path: app1 exec: platforms: k8s builder: test [ { ""comment: ""Second app"", ""name"": ""app2"", ""kind"": ""golang"", ""path"": ""app2"", ""exec"": { ""platforms"": ""dockerh"", ""builder"": ""test"" } }] version: 1type: verbosekind : bfr# my list of applicationsapplications:# First app - name: app1 kind: nodejs path: app1 exec: platforms: k8s builder: test# Second app - name: app2 kind: golang path: app2 exec: platforms: dockerh builder: test type VTS struct { version string `yaml:""version""` types string `yaml:""type""` kind string `yaml:""kind,omitempty""` apps Applications `yaml:""applications,omitempty""`}type Applications []struct { Name string `yaml:""name,omitempty""` Kind string `yaml:""kind,omitempty""` Path string `yaml:""path,omitempty""` Exec struct { Platforms string `yaml:""platforms,omitempty""` Builder string `yaml:""builder,omitempty""` } `yaml:""exec,omitempty""`} version: 1type: verbosekind: bfr# my list of applicationsapplications:- # First appname: app1 kind: nodejs path: app1 exec: platforms: k8s builder: test- # test 1name: app2 kind: golang path: app2 exec: platform: dockerh builder: test",Modify existing yaml file and add new data and comments
modify yaml file and add new node with data and comments," I recently saw that the go yaml lib has new version (V3)with the nodes capabilities (which in my opinion is a killer feature :) ) which can helps a lots with modifying yamls without changing the structure of the fileBut since it is fairly new (from last week ) I didn't find some helpful docs and example for the context which I need (add new object/node and to keep the file structure the same without removing the comments etc)what I need is to manipulate yaml file for example lets say Ive this yaml file Now I got an json object (e.g. with app2) which I need to insert to the existing file and I need to add it to the yml file after the first application, (applications is array of application) is it possible to add from the yaml file the new json object ? also remove existingI also found this bloghttps://blog.ubuntu.com/2019/04/05/api-v3-of-the-yaml-package-for-go-is-availableThis is the types which represent the object updateafter testing the solution which is provided by wiil7200 I found 2 issuesI use at the end write it to fileerr = ioutil.WriteFile(""output.yaml"", b, 0644)And the yaml output have 2 issue. The array of the application is starting from the comments, it should start from the name After the name entry the kind property and all others after are not aligned to the name any idea how to solve those issue ? regard the comments issue, lets say I got it from other propertyand not from the json (if it make it more simpler) <code>  version: 1type: verbosekind : bfr# my list of applicationsapplications: - name: app1 kind: nodejs path: app1 exec: platforms: k8s builder: test [ { ""comment: ""Second app"", ""name"": ""app2"", ""kind"": ""golang"", ""path"": ""app2"", ""exec"": { ""platforms"": ""dockerh"", ""builder"": ""test"" } }] version: 1type: verbosekind : bfr# my list of applicationsapplications:# First app - name: app1 kind: nodejs path: app1 exec: platforms: k8s builder: test# Second app - name: app2 kind: golang path: app2 exec: platforms: dockerh builder: test type VTS struct { version string `yaml:""version""` types string `yaml:""type""` kind string `yaml:""kind,omitempty""` apps Applications `yaml:""applications,omitempty""`}type Applications []struct { Name string `yaml:""name,omitempty""` Kind string `yaml:""kind,omitempty""` Path string `yaml:""path,omitempty""` Exec struct { Platforms string `yaml:""platforms,omitempty""` Builder string `yaml:""builder,omitempty""` } `yaml:""exec,omitempty""`} version: 1type: verbosekind: bfr# my list of applicationsapplications:- # First appname: app1 kind: nodejs path: app1 exec: platforms: k8s builder: test- # test 1name: app2 kind: golang path: app2 exec: platform: dockerh builder: test",Modify existing yaml file and add new data and comments
modify existing Yaml file and add new node with data and comments," I recently saw that the go yaml lib has new version (V3)with the nodes capabilities (which in my opinion is a killer feature :) ) which can helps a lots with modifying yamls without changing the structure of the fileBut since it is fairly new (from last week ) I didn't find some helpful docs and example for the context which I need (add new object/node and to keep the file structure the same without removing the comments etc)what I need is to manipulate yaml file for example lets say Ive this yaml file Now I got an json object (e.g. with app2) which I need to insert to the existing file and I need to add it to the yml file after the first application, (applications is array of application) is it possible to add from the yaml file the new json object ? also remove existingI also found this bloghttps://blog.ubuntu.com/2019/04/05/api-v3-of-the-yaml-package-for-go-is-availableThis is the types which represent the object updateafter testing the solution which is provided by wiil7200 I found 2 issuesI use at the end write it to fileerr = ioutil.WriteFile(""output.yaml"", b, 0644)And the yaml output have 2 issue. The array of the application is starting from the comments, it should start from the name After the name entry the kind property and all others after are not aligned to the name any idea how to solve those issue ? regard the comments issue, lets say I got it from other propertyand not from the json (if it make it more simpler) <code>  version: 1type: verbosekind : bfr# my list of applicationsapplications: - name: app1 kind: nodejs path: app1 exec: platforms: k8s builder: test [ { ""comment: ""Second app"", ""name"": ""app2"", ""kind"": ""golang"", ""path"": ""app2"", ""exec"": { ""platforms"": ""dockerh"", ""builder"": ""test"" } }] version: 1type: verbosekind : bfr# my list of applicationsapplications:# First app - name: app1 kind: nodejs path: app1 exec: platforms: k8s builder: test# Second app - name: app2 kind: golang path: app2 exec: platforms: dockerh builder: test type VTS struct { version string `yaml:""version""` types string `yaml:""type""` kind string `yaml:""kind,omitempty""` apps Applications `yaml:""applications,omitempty""`}type Applications []struct { Name string `yaml:""name,omitempty""` Kind string `yaml:""kind,omitempty""` Path string `yaml:""path,omitempty""` Exec struct { Platforms string `yaml:""platforms,omitempty""` Builder string `yaml:""builder,omitempty""` } `yaml:""exec,omitempty""`} version: 1type: verbosekind: bfr# my list of applicationsapplications:- # First appname: app1 kind: nodejs path: app1 exec: platforms: k8s builder: test- # test 1name: app2 kind: golang path: app2 exec: platform: dockerh builder: test",Modify existing yaml file and add new data and comments
Modify existing yaml file and add new node with data and comments," I recently saw that the go yaml lib has new version (V3)with the nodes capabilities (which in my opinion is a killer feature :) ) which can helps a lots with modifying yamls without changing the structure of the fileBut since it is fairly new (from last week ) I didn't find some helpful docs and example for the context which I need (add new object/node and to keep the file structure the same without removing the comments etc)what I need is to manipulate yaml file for example lets say Ive this yaml file Now I got an json object (e.g. with app2) which I need to insert to the existing file and I need to add it to the yml file after the first application, (applications is array of application) is it possible to add from the yaml file the new json object ? also remove existingI also found this bloghttps://blog.ubuntu.com/2019/04/05/api-v3-of-the-yaml-package-for-go-is-availableThis is the types which represent the object updateafter testing the solution which is provided by wiil7200 I found 2 issuesI use at the end write it to fileerr = ioutil.WriteFile(""output.yaml"", b, 0644)And the yaml output have 2 issue. The array of the application is starting from the comments, it should start from the name After the name entry the kind property and all others after are not aligned to the name any idea how to solve those issue ? regard the comments issue, lets say I got it from other propertyand not from the json (if it make it more simpler) <code>  version: 1type: verbosekind : bfr# my list of applicationsapplications: - name: app1 kind: nodejs path: app1 exec: platforms: k8s builder: test [ { ""comment: ""Second app"", ""name"": ""app2"", ""kind"": ""golang"", ""path"": ""app2"", ""exec"": { ""platforms"": ""dockerh"", ""builder"": ""test"" } }] version: 1type: verbosekind : bfr# my list of applicationsapplications:# First app - name: app1 kind: nodejs path: app1 exec: platforms: k8s builder: test# Second app - name: app2 kind: golang path: app2 exec: platforms: dockerh builder: test type VTS struct { version string `yaml:""version""` types string `yaml:""type""` kind string `yaml:""kind,omitempty""` apps Applications `yaml:""applications,omitempty""`}type Applications []struct { Name string `yaml:""name,omitempty""` Kind string `yaml:""kind,omitempty""` Path string `yaml:""path,omitempty""` Exec struct { Platforms string `yaml:""platforms,omitempty""` Builder string `yaml:""builder,omitempty""` } `yaml:""exec,omitempty""`} version: 1type: verbosekind: bfr# my list of applicationsapplications:- # First appname: app1 kind: nodejs path: app1 exec: platforms: k8s builder: test- # test 1name: app2 kind: golang path: app2 exec: platform: dockerh builder: test",Modify existing yaml file and add new data and comments
Go can't found file while running as systemctl service," I have a Go app, and I'm trying to run it as a systemctl service (Ubuntu 18.04).I'm using godotenv: I have my .env file in the same directory where my executable is.I've created a service file: After executing sudo systemctl start my-go-app.service, then sudo systemctl status my-go-app.service, I got these in my logs: Starting my-go-app... panic: open .env: no such file or directoryWhat's wrong?While executing main directly, there are no such problems. <code>  func init() { var env map[string]string env, err := godotenv.Read() if err != nil { panic(err) }} [Unit]Description=my go appRequires=local-fs.targetAfter=rsyslog.service[Service]Type=forkingGuessMainPID=noStandardInput=nullExecStart=/var/path/to/my/app/main[Install]WantedBy=default.target",Go can't find file while running as a systemctl service on Ubuntu
Go can't find file while running as a systemctl service," I have a Go app, and I'm trying to run it as a systemctl service (Ubuntu 18.04).I'm using godotenv: I have my .env file in the same directory where my executable is.I've created a service file: After executing sudo systemctl start my-go-app.service, then sudo systemctl status my-go-app.service, I got these in my logs: Starting my-go-app... panic: open .env: no such file or directoryWhat's wrong?While executing main directly, there are no such problems. <code>  func init() { var env map[string]string env, err := godotenv.Read() if err != nil { panic(err) }} [Unit]Description=my go appRequires=local-fs.targetAfter=rsyslog.service[Service]Type=forkingGuessMainPID=noStandardInput=nullExecStart=/var/path/to/my/app/main[Install]WantedBy=default.target",Go can't find file while running as a systemctl service on Ubuntu
Prevent error log print in gorm with mysql," I am using GORM with MySQL, I have encountered and handled the error Error 1062: Duplicate entry. The problem is that it's still printed to the console.Code in gym/models/auth.go:49: I am handling the error in the handler function: When I send a POST request, the error is correctly handled and I get the correct response with {""error"": ""sign in failed""}. But the console still prints this error message: I am confused since I handled the error but it still gets printed. How to prevent this error from getting printed to the error log? Or am I handle the error correct? <code>  func AddAuth(username, password string) error { passwordHash, err := auth.HashPassword(password, argon2Conf) if err != nil { return err } userAuth := Auth{ Username: username, Password: passwordHash, } return db.Create(&userAuth).Error} func SignUpHandler(c *gin.Context) { var form user if err := c.ShouldBind(&form); err != nil { c.JSON(http.StatusBadRequest, gin.H{""error"": err.Error()}) return } if err := models.AddAuth(form.Username, form.Password); err == nil { c.JSON(http.StatusOK, gin.H{""status"": ""you are signed in""}) } else { // I think I have handled the sql error here c.JSON(http.StatusBadRequest, gin.H{""error"": ""sign in failed""}) }} (/...../gym/models/auth.go:49) [2019-04-28 23:37:06] Error 1062: Duplicate entry '123123' for key 'username' [GIN] 2019/04/28 - 23:37:06 | 400 | 136.690908ms | ::1 | POST /signup",How to disable default error logger in Go-Gorm
Import local Go module," What is proper way to import (use) go module internally?For example: creating a new module by: go mod init example.com/my-project (example.com or another domain, which doesn't exist)and using it in the same project: This sample was taken from Let's Go book (but extremely simplified)The problem:I am using Goland, and It doesn't recognize this local module. Goland advice me to use go get -t example.com/my-project/package command. But example.com/... just a name for a module  <code>  import ( ""example.com/my-project/package"")",Import local Go module in Goland IDE
Golang Alloc and HeapAlloc vs memprof large discrepancies," I have a Go program that calculates large correlation matrices in memory. To do this I've set up a pipeline of 3 goroutines where the first reads in files, the second calculates the correlation matrix and the last stores the result to disk. Problem is, when I run the program, the Go runtime allocates ~17GB of memory while a matrix only takes up ~2-3GB. Using runtime.ReadMemStats shows that the program is using ~17GB (and verified by using htop), but pprof only reports about ~2.3GB.If I look at the mem stats after running one file through the pipeline: This shows the total allocation of the program: However, if I run go tool pprof mem.prof I get the following results: So I am wondering how I can go about to find out why the program allocates 17 GB, when it seems that the peak memory usage is only ~2.5GB? Is there a way to trace the memory usage throughout the program using pprof?EDITI ran the program again with GODEBUG=gctrace=1 and got the following trace: So it is quite obvious that the heap grows steadily through the program, but I am not able to pinpoint where. I've profiled memory usage using pprof.WriteHeapProfile after calling the memory intensive functions: <code>  var mem runtime.MemStatsruntime.ReadMemStats(&mem)fmt.Printf(""Total alloc: %d GB\n"", mem.Alloc/1000/1000/1000) Total alloc: 17 GB (pprof) top5Showing nodes accounting for 2.21GB, 100% of 2.21GB totalShowing top 5 nodes out of 9 flat flat% sum% cum cum% 1.20GB 54.07% 54.07% 1.20GB 54.07% dataset.(*Dataset).CalcCorrelationMatrix 1.02GB 45.93% 100% 1.02GB 45.93% bytes.makeSlice 0 0% 100% 1.02GB 45.93% bytes.(*Buffer).WriteByte 0 0% 100% 1.02GB 45.93% bytes.(*Buffer).grow 0 0% 100% 1.02GB 45.93% encoding/json.Indent gc 1 @0.017s 0%: 0.005+0.55+0.003 ms clock, 0.022+0/0.47/0.11+0.012 ms cpu, 1227->1227->1226 MB, 1228 MB goal, 4 Pgc 2 @14.849s 0%: 0.003+1.7+0.004 ms clock, 0.015+0/1.6/0.11+0.018 ms cpu, 1227->1227->1227 MB, 2452 MB goal, 4 Pgc 3 @16.850s 0%: 0.006+60+0.003 ms clock, 0.027+0/0.46/59+0.015 ms cpu, 1876->1876->1712 MB, 2455 MB goal, 4 Pgc 4 @22.861s 0%: 0.005+238+0.003 ms clock, 0.021+0/0.46/237+0.015 ms cpu, 3657->3657->3171 MB, 3658 MB goal, 4 Pgc 5 @30.716s 0%: 0.005+476+0.004 ms clock, 0.022+0/0.44/476+0.017 ms cpu, 5764->5764->5116 MB, 6342 MB goal, 4 Pgc 6 @46.023s 0%: 0.005+949+0.004 ms clock, 0.020+0/0.47/949+0.017 ms cpu, 10302->10302->9005 MB, 10303 MB goal, 4 Pgc 7 @64.878s 0%: 0.006+382+0.004 ms clock, 0.024+0/0.46/382+0.019 ms cpu, 16548->16548->7728 MB, 18011 MB goal, 4 Pgc 8 @89.774s 0%: 0.86+2805+0.006 ms clock, 3.4+0/24/2784+0.025 ms cpu, 20208->20208->17088 MB, 20209 MB goal, 4 P func memoryProfile(profpath string) { if _, err := os.Stat(profpath); os.IsNotExist(err) { os.Mkdir(profpath, os.ModePerm) } f, err := os.Create(path.Join(profpath, ""mem.mprof"")) fmt.Printf(""Creating memory profile in %s"", ""data/profile/mem.mprof\n"") if err != nil { panic(err) } if err := pprof.WriteHeapProfile(f); err != nil { panic(err) } f.Close()}",Golang Alloc and HeapAlloc vs pprof large discrepancies
AWS Lambda function Timedout after 3 sec using AWS SAM - GoLang," I am new to AWS and Go and I am trying to execute my Lambda function via AWS SAM CLI. But every time I try to do so I get the following error: I did not want to copy information I pass in the HTTP request since its sensitive. Any idea how I can modify this 3 second timeout? <code>  I0517 07:51:11.052078 13 main.go:62] Thumbnail Lambda successfully started I0517 07:51:13.696304 13 utils.go:99] Needed directories successfully created2019-05-17 09:51:14 Function 'Thumbnail' timed out after 3 seconds2019-05-17 09:51:14 Function returned an invalid response (must include one of: body, headers or statusCode in the response object). Response received:",AWS Lambda function Timedout after 3 sec using AWS SAM
Java - Verify signature created in Golang," I'm creating a signature in Go, for example: Java program receives the variable signatureString and does: But the signatureIsValid boolean is always false, am I doing something wrong?  <code>  //I'm reading a file with -----BEGIN RSA PRIVATE KEY-----privateKeyPem := strings.Replace(privateKeyString, `\n`, ""\n"", -1) //file has '/n' instead of break lines for dev purposesblock, _ := pem.Decode([]byte(privateKeyPem))key, _ := x509.ParsePKCS1PrivateKey(block.Bytes)hashedString := sha256.Sum256([]byte(stringTosign))signature, err = rsa.SignPKCS1v15(rand.Reader, key, crypto2.SHA256, hashedString[:])signatureString := base64.StdEncoding.EncodeToString(signature) byte[] keyBytes = Files.readAllBytes(Paths.get(""./golangSignerPubKey.der""));X509EncodedKeySpec spec = new X509EncodedKeySpec(keyBytes);KeyFactory kf = KeyFactory.getInstance(""RSA"");PublicKey publicKey = kf.generatePublic(spec);Signature signature = Signature.getInstance(""SHA256withRSA"", ""BC"");signature.initVerify(publicKey);signature.update(stringUnsigned.getBytes());boolean signatureIsValid = signature.verify(Base64.getDecoder().decode(signatureString.getBytes()));",Using Java to verify signature created in Golang
Print unmarshalled struct in Golang," I am unmarshaling a struct and I would like it to print it in a formatted manner.My code (https://play.golang.org/p/D0KwGP6Cxa0) currently produces the following output: I would like it to only have the name and value and have a new line after each item. Such as this: Any ideas how I could do that? <code>  main.ADIStruct{CondensedADI:[]main.CondensedADI{main.CondensedADI{Name:""Type"", Value:""title""}, main.CondensedADI{Name:""Title"", Value:""Ste Life_S01_E10_""}, main.CondensedADI{Name:""Title_Brief"", Value:""Ste Life_S01_E10_HD""}, main.CondensedADI{Name:""Episode_Name"", Value:""Cody Goes to Camp""}, main.CondensedADI{Name:""Episode_ID"", Value:""10""}, main.CondensedADI{Name:""Summary_Short"", Value:""Zack is excited to finally get rid of his brother when Cody leaves for math camp.""}, main.CondensedADI{Name:""Rating"", Value:""TV-G""}, main.CondensedADI{Name:""Run_Time"", Value:""00:22:50""}, main.CondensedADI{Name:""Display_Run_Time"", Value:""00:23""}, main.CondensedADI{Name:""Year"", Value:""2005""}, main.CondensedADI{Name:""Closed_Captioning"", Value:""Y""}, main.CondensedADI{Name:""Genre"", Value:""Family""}, main.CondensedADI{Name:""Billing_ID"", Value:""00000""}, main.CondensedADI{Name:""Actors_Display"", Value:""Ashley Tisdale ( Maddie ), Brenda Song ( London ), Cole Sprouse ( Cody ), Dylan Sprouse ( Zack ), Kim Rhodes ( Carey ), Phill Lewis ( Moseby )""}, main.CondensedADI{Name:""Licensing_Window_Start"", Value:""2019-05-15 00:00:00""}, main.CondensedADI{Name:""Licensing_Window_End"", Value:""2019-10-31 00:00:00""}, main.CondensedADI{Name:""Preview_Period"", Value:""0""}, main.CondensedADI{Name:""Display_As_New"", Value:""7""}, main.CondensedADI{Name:""Display_As_Last_Chance"", Value:""7""}, main.CondensedADI{Name:""Provider_QA_Contact"", Value:""DATG.DL-VOD.Support@disney.com""}, main.CondensedADI{Name:""Suggested_Price"", Value:""0.00""}, main.CondensedADI{Name:""Category"", Value:""Disney Channel HD/Suite Life""}}} Name:""Type"", Value:""title""Name:""Title"", Value:""Ste Life_S01_E10_""",How to pretty print a Golang structure?
Adding clippath information to tiff file," I'm trying to add a clipping path to a TIFF image. I made one TIFF file with GIMP that contains a clipping path and I can clip my image using it by But I would like to append clipping path info as coordinates like GIMP does into the image file itself so later another process can read it...I've tried with ImagickDraw, pathStart... pathFinish but it draws something on image not as a path that I can see in GIMP likeEdit: Solutions in other languages are appreciated. <code>  $img = new Imagick(""./test.tiff"");$img->clipPathImage(""#1"", false);",Adding clippath information to an image
Calling Go From Python: segmentation fault when the C struct becomes big," I tried to run a simple in a go script from python and I got a segmentation fault. Here is my code:main.go main.py With that code, I got Now If I remove e and f from the main.go I got and no more segmentation fault.Why the number of members in the struct does matter here?[EDIT] Both are running at the same place, I run one command clear && go build -o main.so -buildmode=c-shared main.go && python3 main.py <code>  package mainimport ( /*typedef struct foo{int a;int b;int c;int d;int e;int f;} foo;*/ ""C"")func main() {}//export Foofunc Foo(t []int) C.foo { return C.foo{}} # loading shared objectlib = cdll.LoadLibrary(""main.so"")# go typeclass GoSlice(Structure): _fields_ = [(""data"", POINTER(c_void_p)), (""len"", c_longlong), (""cap"", c_longlong)]lib.Foo.argtypes = [GoSlice]lib.Foo.restype = c_void_pt = GoSlice((c_void_p * 5)(1, 2, 3, 4, 5), 5, 5)f = lib.Foo(t)print(f) 140362617287784[1] 23067 segmentation fault python3 main.py None",Calling Go from Python
GORM doesnt updates boolean field to false," On updates gorm doesnt update boolean type to false. By default it updates to true, but when i try to update to false not changes. I dont see any errors also. What can be the issue ? Alternate Solution:This works, but I am updating multiple attributies. So, I cant use this. <code>  type Attendee struct { ID uint `gorm:""primary_key"" gorm:""AUTO_INCREMENT"" json:""id,omitempty"" mapstructure:""id"" csv:""ID""` Email string `json:""email,omitempty"" mapstructure:""email"" csv:""Email,required""` ShowDirectory bool `json:""show_directory,omitempty"" gorm:""default:true"" mapstructure:""show_directory"" csv:""-""`}var attendee Attendee// JSON.unmarshal lines here for the &attendeeif err := service.DB.Model(&attendee).Updates(Attendee{ Email: attendee.Email, ShowDirectory: false}).Error; err != nil { return Attendee{}, err} att := Attendee{ID: 1} service.DB.Model(&att).Update(""ShowDirectory"", false)",GORM doesnt update boolean field to false
Simplest way to return literal JSON using golang gin gonic," I am learning Go by building a simple API interface for a web server. I want to return a simple message in JSON, when a default route is hit.So far, reading online, this is the easiest way to return a literal JSON string, and encode it and send it to the user. Is this the most efficient / fastest way to do it?in node.js and express, I would do something like: Whats the best way to do this in Go + Gin? <code>  func GetDefault(c *gin.Context) { jsonData := []byte(`{""msg"":""this worked""}`) var v interface{} json.Unmarshal(jsonData, &v) data := v.(map[string]interface{}) c.JSON(http.StatusOK,data)} return res.status(200).json({""msg"":""this worked""});",Simplest way to return literal JSON using gin gonic
Golang: how do I debug a dependency package? If I have its source code," Say my Go project depends on package example.com/foo. I am using Go 1.12, so the dependency is automatically pulled in by Go modules. That dependency contains errors that I want to debug by adding logs or with step by step execution.I can find the source code of the dependency on GitHub but I don't know how to fit it into my project, so that it replaces the dependency which was pulled in by Go modules. <code> ",Debugging Go dependency packages?
How do I debug a dependency package? If I have its source code," Say my Go project depends on package example.com/foo. I am using Go 1.12, so the dependency is automatically pulled in by Go modules. That dependency contains errors that I want to debug by adding logs or with step by step execution.I can find the source code of the dependency on GitHub but I don't know how to fit it into my project, so that it replaces the dependency which was pulled in by Go modules. <code> ",Debugging Go dependency packages?
How do I debug a dependency package?," Say my Go project depends on package example.com/foo. I am using Go 1.12, so the dependency is automatically pulled in by Go modules. That dependency contains errors that I want to debug by adding logs or with step by step execution.I can find the source code of the dependency on GitHub but I don't know how to fit it into my project, so that it replaces the dependency which was pulled in by Go modules. <code> ",Debugging Go dependency packages?
how to skip first row for reading a csv file in go-lang?," I have an awkward csv file and I need to skip the first row to read it.I'm doing this easily with python/pandas but I don't know how to do it in Go. Error: PM_IG30014_15_201906290015_01.csv: <code>  df = pd.read_csv(filename, skiprows=1) package mainimport ( ""encoding/csv"" ""fmt"" ""log"" ""os"")type mwericsson struct { id string name string region string}func main() { rows := readSample() fmt.Println(rows) //appendSum(rows) //writeChanges(rows)}func readSample() [][]string { f, err := os.Open(""D:/in/20190629/PM_IG30014_15_201906290015_01.csv"") if err != nil { log.Fatal(err) } rows, err := csv.NewReader(f).ReadAll() f.Close() if err != nil { log.Fatal(err) } return rows} 2019/07/01 12:38:40 record on line 2: wrong number of fields PTN Ethernet-Port RMON Performance,PORT_BW_UTILIZATION,2019-06-29 20:00:00,33366 DeviceID,DeviceName,ResourceName,CollectionTime,GranularityPeriod,PORT_RX_BW_UTILIZATION,PORT_TX_BW_UTILIZATION,RXGOODFULLFRAMESPEED,TXGOODFULLFRAMESPEED,PORT_RX_BW_UTILIZATION_MAX,PORT_TX_BW_UTILIZATION_MAX3174659,H1095,H1095-11-ISM6-1(to ZJBSC-V1),2019-06-29 20:00:00,15,22.08,4.59,,,30.13,6.983174659,H1095,H1095-14-ISM6-1(to T6147-V),2019-06-29 20:00:00,15,2.11,10.92,,,4.43,22.45",How to skip the first row when reading a csv file?
"How to fix go build error ""can't load package"" with go modules?"," I'm setting up a new project using Go modules with this tutorial, and then trying to build it.The module is located in a folder outside of the $GOPATH with the following structure: I've run go mod init example.com/my-project in directory example.com/my-project and created the go.mod file shown above.main.go has basic contents: After attempting to run go build in directory example.com/my-project, I receive the following error message:can't load package: package example.com/my-project: unknown import path ""example.com/my-project"": cannot find module providing package example.com/my-project.I've also attempted to run go build in directory /, outside of example.com/my-project, and I get similar, failing results:can't load package: package .: no Go files in ...I'm probably getting some basic thing wrong, so thanks for your patience and any help you can give. <code>  example.com my-project main main.go go.mod package mainimport (""fmt"")func main(){ fmt.Println(""Hello, world!"")}","How to fix Go build error ""can't load package"" with Go modules?"
How to remove a installed package using vgo, I've installed a package using go modules (go get in Go 1.13) and now I want to remove it. In the documentation there is nothing about this and in go get docu neither.Removing the package from go.mod manually doesn't solve the issue so it remains in go.sum.How should I remove a package in a clean way? <code> ,How to remove an installed package using go modules
How to remove an installed package using vgo, I've installed a package using go modules (go get in Go 1.13) and now I want to remove it. In the documentation there is nothing about this and in go get docu neither.Removing the package from go.mod manually doesn't solve the issue so it remains in go.sum.How should I remove a package in a clean way? <code> ,How to remove an installed package using go modules
How to render static file within gin router?," I want to serve a JSON file with gin server. And set some customize values in the HTML file. Use JavaScript in it to call the JSON file.My application structure: I put these basic source into main.go file: Some code in templates/index.html file: When running the application, I got a fetch error:Not Found ./web.jsonSo how should I serve the web.json file to be accessed in the Gin internal server? <code>  . main.go templates index.html web.json package mainimport ( ""net/http"" ""github.com/gin-gonic/gin"")var router *gin.Enginefunc main() { router = gin.Default() router.LoadHTMLGlob(""templates/*"") router.GET(""/web"", func(c *gin.Context) { c.HTML( http.StatusOK, ""index.html"", gin.H{ ""title"": ""Web"", ""url"": ""./web.json"", }, ) }) router.Run()} <!doctype html><html> <head> <title>{{ .title }}</title> // ... </head>",How to render static files within Gin router?
"What incompatible in go.mod mean, will it make harm?"," I'm using goczmq in my project, something like next:main.go: And more, I'm using golang 1.12 with gomod to manage my project.See next, I use go mod init xxx, and when build, it downloads goczmq automatically for me and add dependency to go.mod, but has incompatible in it. (But for other library I may get something like github.com/kolo/xmlrpc v0.0.0-20190717152603-07c4ee3fd181)go.mod: From some discussion (for other library), e.g. this, it seems the library owner should do something to support golang 1.12? But in my case, all things works fine just a incompatible there make me a little worried (I mean all seems ok now, but some day when I use an api which I never used before, there will be hidden bomb there...?)So my question: Should I worry about this, or this is just as expected? <code>  package mainimport ( _ ""github.com/zeromq/goczmq"")func main() {} module pigeongo 1.12require ( github.com/zeromq/goczmq v4.1.0+incompatible)","What does 'incompatible' in go.mod mean, will it cause harm?"
"""java.lang.IllegalArgumentException: No filesystem found for scheme gs"" when running dataflow in google cloud platform"," I am running my google dataflow job in Google Cloud Platform(GCP). When I run this job locally it worked well, but when running it on GCP, I got this error ""java.lang.IllegalArgumentException: No filesystem found for scheme gs"".I have access to that google cloud URI, I can upload my jar file to that URI and I can see some temporary file for my local job. My Job id in GCP:2019-08-08_21_47_27-162804342585245230 (beam version:2.12.0)2019-08-09_16_41_15-11728697820819900062 (beam version:2.14.0)I have tried beam version of 2.12.0 and 2.14.0, both of them have the same error. <code>  java.lang.IllegalArgumentException: No filesystem found for scheme gs at org.apache.beam.sdk.io.FileSystems.getFileSystemInternal(FileSystems.java:456) at org.apache.beam.sdk.io.FileSystems.matchNewResource(FileSystems.java:526) at org.apache.beam.sdk.io.gcp.bigquery.BigQueryHelpers.resolveTempLocation(BigQueryHelpers.java:689) at org.apache.beam.sdk.io.gcp.bigquery.BigQuerySourceBase.extractFiles(BigQuerySourceBase.java:125) at org.apache.beam.sdk.io.gcp.bigquery.BigQuerySourceBase.split(BigQuerySourceBase.java:148) at org.apache.beam.runners.dataflow.worker.WorkerCustomSources.splitAndValidate(WorkerCustomSources.java:284) at org.apache.beam.runners.dataflow.worker.WorkerCustomSources.performSplitTyped(WorkerCustomSources.java:206) at org.apache.beam.runners.dataflow.worker.WorkerCustomSources.performSplitWithApiLimit(WorkerCustomSources.java:190) at org.apache.beam.runners.dataflow.worker.WorkerCustomSources.performSplit(WorkerCustomSources.java:169) at org.apache.beam.runners.dataflow.worker.WorkerCustomSourceOperationExecutor.execute(WorkerCustomSourceOperationExecutor.java:78) at org.apache.beam.runners.dataflow.worker.BatchDataflowWorker.executeWork(BatchDataflowWorker.java:412) at org.apache.beam.runners.dataflow.worker.BatchDataflowWorker.doWork(BatchDataflowWorker.java:381) at org.apache.beam.runners.dataflow.worker.BatchDataflowWorker.getAndPerformWork(BatchDataflowWorker.java:306) at org.apache.beam.runners.dataflow.worker.DataflowBatchWorkerHarness$WorkerThread.doWork(DataflowBatchWorkerHarness.java:135) at org.apache.beam.runners.dataflow.worker.DataflowBatchWorkerHarness$WorkerThread.call(DataflowBatchWorkerHarness.java:115) at org.apache.beam.runners.dataflow.worker.DataflowBatchWorkerHarness$WorkerThread.call(DataflowBatchWorkerHarness.java:102) at java.util.concurrent.FutureTask.run(FutureTask.java:266) at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) at java.lang.Thread.run(Thread.java:745)","""No filesystem found for scheme gs"" when running dataflow in google cloud platform"
Why sync.Mutex largely drops performance when goroutine contention more than 3400?," I am comparing the performance regarding sync.Mutex and Go channels. Here is my benchmark: The performance comparison visualization is as follows:What are the reasons that sync.Mutex encounters a large performance drop when the number of goroutines goes higher than roughly 3400?Go channels are pretty stable but slower than sync.Mutex before?Raw bench data by benchstat (go test -bench=. -count=5) go version go1.12.4 linux/amd64: Go 1.12.4. Hardware: Update: I tested on different hardware. It seems the problem still exists:bench: https://play.golang.org/p/HnQ44--E4UQUpdate:My full benchmark that tested from 8 goroutines to 15000 goroutines, including a comparison on chan/sync.Mutex/atomic: <code>  // go playground: https://play.golang.org/p/f_u9jHBq_Jcconst ( start = 300 // actual = start * goprocs end = 600 // actual = end * goprocs step = 10)var goprocs = runtime.GOMAXPROCS(0) // 8// https://perf.golang.org/search?q=upload:20190819.3func BenchmarkChanWrite(b *testing.B) { var v int64 ch := make(chan int, 1) ch <- 1 for i := start; i < end; i += step { b.Run(fmt.Sprintf(""goroutines-%d"", i*goprocs), func(b *testing.B) { b.SetParallelism(i) b.RunParallel(func(pb *testing.PB) { for pb.Next() { <-ch v += 1 ch <- 1 } }) }) }}// https://perf.golang.org/search?q=upload:20190819.2func BenchmarkMutexWrite(b *testing.B) { var v int64 mu := sync.Mutex{} for i := start; i < end; i += step { b.Run(fmt.Sprintf(""goroutines-%d"", i*goprocs), func(b *testing.B) { b.SetParallelism(i) b.RunParallel(func(pb *testing.PB) { for pb.Next() { mu.Lock() v += 1 mu.Unlock() } }) }) }} MutexWrite/goroutines-2400-8 48.6ns 1%MutexWrite/goroutines-2480-8 49.1ns 0%MutexWrite/goroutines-2560-8 49.7ns 1%MutexWrite/goroutines-2640-8 50.5ns 3%MutexWrite/goroutines-2720-8 50.9ns 2%MutexWrite/goroutines-2800-8 51.8ns 3%MutexWrite/goroutines-2880-8 52.5ns 2%MutexWrite/goroutines-2960-8 54.1ns 4%MutexWrite/goroutines-3040-8 54.5ns 2%MutexWrite/goroutines-3120-8 56.1ns 3%MutexWrite/goroutines-3200-8 63.2ns 5%MutexWrite/goroutines-3280-8 77.5ns 6%MutexWrite/goroutines-3360-8 141ns 6%MutexWrite/goroutines-3440-8 239ns 8%MutexWrite/goroutines-3520-8 248ns 3%MutexWrite/goroutines-3600-8 254ns 2%MutexWrite/goroutines-3680-8 256ns 1%MutexWrite/goroutines-3760-8 261ns 2%MutexWrite/goroutines-3840-8 266ns 3%MutexWrite/goroutines-3920-8 276ns 3%MutexWrite/goroutines-4000-8 278ns 3%MutexWrite/goroutines-4080-8 286ns 5%MutexWrite/goroutines-4160-8 293ns 4%MutexWrite/goroutines-4240-8 295ns 2%MutexWrite/goroutines-4320-8 280ns 8%MutexWrite/goroutines-4400-8 294ns 9%MutexWrite/goroutines-4480-8 285ns 10%MutexWrite/goroutines-4560-8 290ns 8%MutexWrite/goroutines-4640-8 271ns 3%MutexWrite/goroutines-4720-8 271ns 4%ChanWrite/goroutines-2400-8 158ns 3%ChanWrite/goroutines-2480-8 159ns 2%ChanWrite/goroutines-2560-8 161ns 2%ChanWrite/goroutines-2640-8 161ns 1%ChanWrite/goroutines-2720-8 163ns 1%ChanWrite/goroutines-2800-8 166ns 3%ChanWrite/goroutines-2880-8 168ns 1%ChanWrite/goroutines-2960-8 176ns 4%ChanWrite/goroutines-3040-8 176ns 2%ChanWrite/goroutines-3120-8 180ns 1%ChanWrite/goroutines-3200-8 180ns 1%ChanWrite/goroutines-3280-8 181ns 2%ChanWrite/goroutines-3360-8 183ns 2%ChanWrite/goroutines-3440-8 188ns 3%ChanWrite/goroutines-3520-8 190ns 2%ChanWrite/goroutines-3600-8 193ns 2%ChanWrite/goroutines-3680-8 196ns 3%ChanWrite/goroutines-3760-8 199ns 2%ChanWrite/goroutines-3840-8 206ns 2%ChanWrite/goroutines-3920-8 209ns 2%ChanWrite/goroutines-4000-8 206ns 2%ChanWrite/goroutines-4080-8 209ns 2%ChanWrite/goroutines-4160-8 208ns 2%ChanWrite/goroutines-4240-8 209ns 3%ChanWrite/goroutines-4320-8 213ns 2%ChanWrite/goroutines-4400-8 209ns 2%ChanWrite/goroutines-4480-8 211ns 1%ChanWrite/goroutines-4560-8 213ns 2%ChanWrite/goroutines-4640-8 215ns 1%ChanWrite/goroutines-4720-8 218ns 3% CPU: Quad core Intel Core i7-7700 (-MT-MCP-) cache: 8192 KB clock speeds: max: 4200 MHz 1: 1109 MHz 2: 3641 MHz 3: 3472 MHz 4: 3514 MHz 5: 3873 MHz 6: 3537 MHz 7: 3410 MHz 8: 3016 MHz CPU Flags: 3dnowprefetch abm acpi adx aes aperfmperf apic arat arch_perfmon art avx avx2 bmi1 bmi2 bts clflush clflushopt cmov constant_tsc cpuid cpuid_fault cx16 cx8 de ds_cpl dtes64 dtherm dts epb ept erms est f16c flexpriority flush_l1d fma fpu fsgsbase fxsr hle ht hwp hwp_act_window hwp_epp hwp_notify ibpb ibrs ida intel_pt invpcid invpcid_single lahf_lm lm mca mce md_clear mmx monitor movbe mpx msr mtrr nonstop_tsc nopl nx pae pat pbe pcid pclmulqdq pdcm pdpe1gb pebs pge pln pni popcnt pse pse36 pti pts rdrand rdseed rdtscp rep_good rtm sdbg sep smap smep smx ss ssbd sse sse2 sse4_1 sse4_2 ssse3 stibp syscall tm tm2 tpr_shadow tsc tsc_adjust tsc_deadline_timer tsc_known_freq vme vmx vnmi vpid x2apic xgetbv1 xsave xsavec xsaveopt xsaves xtopology xtpr",Why does sync.Mutex largely drop performance when goroutine contention is more than 3400?
"Behaviour of ""go tidy"" vs ""go build"""," Suppose I have a project with the following structure: I can make sure go.mod does not contain unused dependencies by running go mod tidy: Now, if I run go build, go.mod gets updated: I can't figure out what's going on here. I expected go mod tidy would leave go.mod on a clean state, and that running go build would therefore not change it.Any ideas? <code>  +-- app/+-- otherstuff/+-- test/+-- go.mod+-- go.sum+-- main.go # 1) Verify that no dependency containing the name ""modern-go"" is found on go.mod$ grep 'modern-go' go.mod<-- Empty (nothing found) (OK)# 2) Run ""go mod tidy"", verify that nothing changes (i.e. go.mod is already clean)$ go mod tidy -vunused github.com/modern-go/concurrentunused github.com/modern-go/reflect2<-- messages above are displayed, but go.mod did not change# 3) Verify that go.mod did not change$ grep 'modern-go' go.mod<-- Empty (nothing found) (OK) # 4) Run ""go build""$ go build# 5) go.mod was updated by ""go build"":$ grep 'modern-go' go.mod github.com/modern-go/concurrent v0.0.0-20180306012644-bacd9c7ef1dd // indirect github.com/modern-go/reflect2 v1.0.1 // indirect","Behaviour of ""go mod tidy"" vs ""go build"""
golang modules two version of same dependency - lower version getting ignored," I have a project in which two dependencies uses different version of same library. For instance, my project has dependency A and dependency B. A and B, both uses a common library/dependency X, but of different versions. A has v1 version of X and B has v2 version of X. So now when I add A & B as dependencies in my project, there are 2 versions of X in my project's go.sum. I was expecting, the respective versions will be referred at run time by A and B. But it is not the case. Somehow when I run tests on my project, the A is using v2 of X, ideally it should use v1 (because in go.mod of A, explicitly specified/added v1). So it breaks the execution,because there are lot differences in v1 and v2 of X.So in my project, how can I explicitly specify that to use v1 of X by A and use v2 by B? Is there such provision in go modules? <code> ",Two version of same dependency - lower version getting ignored
Why go does not have function to calculate absolute value for integer datatype?," In Go, why is there no function which directly calculates absolute value for integer datatypes? Currently all integer values have to be typecast to float64 and then passed to math.Abs(), which returns a float64, which again has to be typecast into an integer.This code raises a ./prog.go:12:39: cannot use x (type int64) as type float64 in argument to math.Abs error because Go is a statically typed language, so it does not allow a different datatype: <code>  package mainimport ( ""fmt"" ""math"")func main() { fmt.Println(""Hello, playground"") var x int64 = -10 fmt.Println(""Abolute value "", math.Abs(x)) }",Why doesn't Go have a function to calculate the absolute value of integers?
Golang base64 encoding with limited line length as per RFC2045," RFC2045 section 6.8 states maximum encoded line length of base64 output should be 76 characters or less.The Golang stream writer base64.NewEncoder does not have any option for line splitting, as can be seen here. Output is Is there a stream-based solution to splitting lines?The MIME library offers only string based encoding options. <code>  package mainimport ( ""encoding/base64"" ""io"" ""os"" ""strings"")// See https://www.ietf.org/rfc/rfc2045.txt, section 6.8 for notes on maximum line length of 76 charactersfunc main() { data := ""It is only the hairs on a gooseberry that prevent it from being a grape! This is long enough to need a line split"" rdr := strings.NewReader(data) wrt := base64.NewEncoder(base64.StdEncoding, os.Stdout) io.Copy(wrt, rdr)} SXQgaXMgb25seSB0aGUgaGFpcnMgb24gYSBnb29zZWJlcnJ5IHRoYXQgcHJldmVudCBpdCBmcm9tIGJlaW5nIGEgZ3JhcGUhIEl0IGlzIG9ubHkgdGhlIGhhaXJzIG9uIGEgZ29vc2ViZXJyeSB0aGF0IHByZXZlbnQgaXQgZnJvbSBiZWluZyBhIGdyYXBl",base64 encoding with limited line length as per RFC2045
How to resolve two golang dependencies that require different versions of the same library?," I have two dependencies in my project.go.mod: After running go mod download, those two dependencies result in two different versions of a github.com/shared/dependency to be downloaded. The interesting thing is that the github.com/shared/dependency contains sub-modules, e.g.: Inspecting the downloaded modules shows two versions are downloaded to my local machine:ls ${GOPATH}/pkg/mod/github.com/shared: ls ${GOPATH}/pkg/mod/github.com/shared/dependency: Looking at the contents of these directories:${GOPATH}/pkg/mod/github.com/shared/dependency@v1.1.0:The file contents of the whole repo in v1.1.0, including the api folder with its own go.mod file.${GOPATH}/pkg/mod/github.com/shared/dependency/api@v1.2.0:The file contents of the api folder of the repo in v1.2.0, including the go.mod file.Finally, I have a .go file in my test-repo with the following setup: When I try to run a test of MyFunc (that exists elsewhere), I get an unknown import path...ambiguous import... error message. e.g.go test github.com/test-org/test-repo/test-package -test.run=TestMyFunc -v: The error points to the import line of the .go file importing github.com/shared/dependency/api in the github.com/foo/bar repo. It doesn't know which api to choose in my local ${GOPATH}/pkg/mod folder, given the two versions available:${GOPATH}/pkg/mod/github.com/shared/dependency@v1.1.0/api${GOPATH}/pkg/mod/github.com/shared/dependency/api@v1.2.0Is there any way that I can make that go test call work (solve the dependency conflicts)? Neither of my two dependencies explicitly call out downloading the full shared/dependency@v1.1.0, but for some reason it gets pulled in. If that weren't there, it would seemingly fix the issue. <code>  module github.com/test-org/test-repogo 1.12require ( github.com/foo/bar v1.0.0 github.com/raz/mataz v1.0.0) dependency -- go.mod -- api -- go.mod [dir] dependency [dir] dependency@v1.1.0 [dir] api@v1.2.0 package test-packageimport ( ""github.com/foo/bar"")func MyFunc() {...bar.NewBar()...} unknown import path ""github.com/shared/dependency/api"": ambiguous import: found github.com/shared/dependency/api in multiple modules: github.com/shared/dependency v1.1.0 (${GOPATH}/pkg/mod/github.com/shared/dependency@v1.1.0/api) github.com/shared/dependency v1.2.0 (${GOPATH}/pkg/mod/github.com/shared/dependency/api@v1.2.0)",How to resolve conflicting go module dependencies when a top-level module and one of its sub-modules are separately imported as separate versions?
"How to resolve two golang dependencies that require different minor versions of the same library, with sub-module imports?"," I have two dependencies in my project.go.mod: After running go mod download, those two dependencies result in two different versions of a github.com/shared/dependency to be downloaded. The interesting thing is that the github.com/shared/dependency contains sub-modules, e.g.: Inspecting the downloaded modules shows two versions are downloaded to my local machine:ls ${GOPATH}/pkg/mod/github.com/shared: ls ${GOPATH}/pkg/mod/github.com/shared/dependency: Looking at the contents of these directories:${GOPATH}/pkg/mod/github.com/shared/dependency@v1.1.0:The file contents of the whole repo in v1.1.0, including the api folder with its own go.mod file.${GOPATH}/pkg/mod/github.com/shared/dependency/api@v1.2.0:The file contents of the api folder of the repo in v1.2.0, including the go.mod file.Finally, I have a .go file in my test-repo with the following setup: When I try to run a test of MyFunc (that exists elsewhere), I get an unknown import path...ambiguous import... error message. e.g.go test github.com/test-org/test-repo/test-package -test.run=TestMyFunc -v: The error points to the import line of the .go file importing github.com/shared/dependency/api in the github.com/foo/bar repo. It doesn't know which api to choose in my local ${GOPATH}/pkg/mod folder, given the two versions available:${GOPATH}/pkg/mod/github.com/shared/dependency@v1.1.0/api${GOPATH}/pkg/mod/github.com/shared/dependency/api@v1.2.0Is there any way that I can make that go test call work (solve the dependency conflicts)? Neither of my two dependencies explicitly call out downloading the full shared/dependency@v1.1.0, but for some reason it gets pulled in. If that weren't there, it would seemingly fix the issue. <code>  module github.com/test-org/test-repogo 1.12require ( github.com/foo/bar v1.0.0 github.com/raz/mataz v1.0.0) dependency -- go.mod -- api -- go.mod [dir] dependency [dir] dependency@v1.1.0 [dir] api@v1.2.0 package test-packageimport ( ""github.com/foo/bar"")func MyFunc() {...bar.NewBar()...} unknown import path ""github.com/shared/dependency/api"": ambiguous import: found github.com/shared/dependency/api in multiple modules: github.com/shared/dependency v1.1.0 (${GOPATH}/pkg/mod/github.com/shared/dependency@v1.1.0/api) github.com/shared/dependency v1.2.0 (${GOPATH}/pkg/mod/github.com/shared/dependency/api@v1.2.0)",How to resolve conflicting go module dependencies when a top-level module and one of its sub-modules are separately imported as separate versions?
What's the best way to manage the Go process," Does Go have a process manager similar to PM2 for NodeJS?Basic features of PM2:Run application in background indefinitely, such as a server waiting for a request.Restart application upon reboot.Editor's note: PM2 offers an easy way to run a NodeJS application in the background forever, such as for a production server. Of course you can do this with the Linux operating system, using tools not specific to any particular programming language, and those answers are helpful. As Go can create executables, you don't really need a Go-language specific solution to this question. <code> ",PM2-like process management solution for Golang applications?
Are there PM2-like process management solution for Golang applications?," Does Go have a process manager similar to PM2 for NodeJS?Basic features of PM2:Run application in background indefinitely, such as a server waiting for a request.Restart application upon reboot.Editor's note: PM2 offers an easy way to run a NodeJS application in the background forever, such as for a production server. Of course you can do this with the Linux operating system, using tools not specific to any particular programming language, and those answers are helpful. As Go can create executables, you don't really need a Go-language specific solution to this question. <code> ",PM2-like process management solution for Golang applications?
how to set GOPRIVATE environment variable," I started working on a Go project and it uses some private modules from Github private repos and whenever I try to run go run main.go it gives me a below 410 Gone error: verifying github.com/repoURL/go-proto@v2.86.0+incompatible/go.mod: github.com/repoURL/go-proto@v2.86.0+incompatible/go.mod: reading https://sum.golang.org/lookup/github.com/!repoURL/go-proto@v2.86.0+incompatible: 410 GoneI can easily clone private repo from terminal which means my ssh keys are configured correctly. I read here that I need to set GOPRIVATE environment variable but I am not sure how to do that.Can anyone answer or point to the relevant tutorial?Go: v1.13, OS: macOS Mojave <code> ",How to set GOPRIVATE environment variable
"VSCode import ""C"" fails"," Please see the following screenshot:It says: could not import C (no package data for import path C)I have attached an example project that reproduces the failure, here: https://github.com/microsoft/vscode/files/3783446/example-project.zipI am using Go 1.13 with the latest versions of each extension for Go and C/C++.There is no compiler error, and this is specifically seemingly isolated as a ""vscode problem"".Is there a way to fix this vscode problem?  <code> ","VSCode import ""C"" fails on modules"
Request body validation in Golang," I'm using gin to handle requests, but I'm having trouble validating data in a request body, e.g. How can I handle values with whitespaces like "" username "" or "" John Doe ""? As far as I know it's not possible to use regex in gin's validator. What are the best practices or patterns for request body validation in Golang?  <code>  type User struct { Username string `json:""username"" binding:""required,min=1,max=16""` Name string `json:""name"" binding:""required,min=1,max=16""` Password string `json:""password"" binding:""required,min=1,max=16""`}func loginHandler(ctx *gin.Context) { var user User if err := ctx.ShouldBindJSON(&user); err != nil { ctx.JSON(http.StatusBadRequest, gin.H{ ""error"": err.Error(), })}",Request body validation
Rune and byte in Golang string," According to https://blog.golang.org/strings and my testings, it looks like while we range a string, the characters we get are rune type, but if we get it by str[index], they will be byte type, why is it? <code> ",Rune vs byte ranging over string
Rune and byte in Golang string during range," According to https://blog.golang.org/strings and my testings, it looks like while we range a string, the characters we get are rune type, but if we get it by str[index], they will be byte type, why is it? <code> ",Rune vs byte ranging over string
Using client-go to `kuebctl apply` against the Kubernetes API directly with MULTIPLE Kinds of different type in a single YAML file," I'm using https://github.com/kubernetes/client-go and all works well.I have a manifest (YAML) for the official Kubernetes Dashboard: https://raw.githubusercontent.com/kubernetes/dashboard/v2.0.0-beta4/aio/deploy/recommended.yamlI want to mimic kubectl apply of this manifest in Go code, using client-go.I understand that I need to do some (un)marshalling of the YAML bytes into the correct API types defined in package: https://github.com/kubernetes/apiI have successfully Createed single API types to my cluster, but how do I do this for a manifest that contains a list of types that are not the same? Is there a resource kind: List* that supports these different types?My current workaround is to split the YAML file using csplit with --- as the delimiter Next, I loop over the new (14) parts that were created, read their bytes, switch on the type of the object returned by the UniversalDeserializer's decoder and call the correct API methods using my k8s clientset.I would like to do this to programmatically to make updates to any new versions of the dashboard into my cluster. I will also need to do this for the Metrics Server and many other resources. The alternative (maybe simpler) method is to ship my code with kubectl installed to the container image and directly call kubectl apply -f -; but that means I also need to write the kube config to disk or maybe pass it inline so that kubectl can use it.I found this issue to be helpful: https://github.com/kubernetes/client-go/issues/193The decoder lives here: https://github.com/kubernetes/apimachinery/tree/master/pkg/runtime/serializerIt's exposed in client-go here: https://github.com/kubernetes/client-go/blob/master/kubernetes/scheme/register.go#L69I've also taken a look at the RunConvert method that is used by kubectl: https://github.com/kubernetes/kubernetes/blob/master/pkg/kubectl/cmd/convert/convert.go#L139 and assume that I can provide my own genericclioptions.IOStreams to get the output?It looks like RunConvert is on a deprecation pathI've also looked at other questions tagged [client-go] but most use old examples or use a YAML file with a single kind defined, and the API has changed since.Edit: Because I need to do this for more than one cluster and am creating clusters programmatically (AWS EKS API + CloudFormation/eksctl), I would like to minimize the overhead of creating ServiceAccounts across many cluster contexts, across many AWS accounts. Ideally, the only authentication step involved in creating my clientset is using aws-iam-authenticator to get a token using cluster data (name, region, CA cert, etc). There hasn't been a release of aws-iam-authenticator for a while, but the contents of master allow for the use of a third-party role cross-account role and external ID to be passed. IMO, this is cleaner than using a ServiceAccount (and IRSA) because there are other AWS services the application (the backend API which creates and applies add-ons to these clusters) needs to interact with.Edit: I have recently found https://github.com/ericchiang/k8s. It's definitely simpler to use than client-go, at a high-level, but doesn't support this behavior. <code>  csplit /path/to/recommended.yaml /---/ '{*}' --prefix='dashboard.' --suffix-format='%03d.yaml'",Using client-go to `kubectl apply` against the Kubernetes API directly with multiple types in a single YAML file
Using client-go to `kubectl apply` against the Kubernetes API directly with MULTIPLE Kinds of different type in a single YAML file," I'm using https://github.com/kubernetes/client-go and all works well.I have a manifest (YAML) for the official Kubernetes Dashboard: https://raw.githubusercontent.com/kubernetes/dashboard/v2.0.0-beta4/aio/deploy/recommended.yamlI want to mimic kubectl apply of this manifest in Go code, using client-go.I understand that I need to do some (un)marshalling of the YAML bytes into the correct API types defined in package: https://github.com/kubernetes/apiI have successfully Createed single API types to my cluster, but how do I do this for a manifest that contains a list of types that are not the same? Is there a resource kind: List* that supports these different types?My current workaround is to split the YAML file using csplit with --- as the delimiter Next, I loop over the new (14) parts that were created, read their bytes, switch on the type of the object returned by the UniversalDeserializer's decoder and call the correct API methods using my k8s clientset.I would like to do this to programmatically to make updates to any new versions of the dashboard into my cluster. I will also need to do this for the Metrics Server and many other resources. The alternative (maybe simpler) method is to ship my code with kubectl installed to the container image and directly call kubectl apply -f -; but that means I also need to write the kube config to disk or maybe pass it inline so that kubectl can use it.I found this issue to be helpful: https://github.com/kubernetes/client-go/issues/193The decoder lives here: https://github.com/kubernetes/apimachinery/tree/master/pkg/runtime/serializerIt's exposed in client-go here: https://github.com/kubernetes/client-go/blob/master/kubernetes/scheme/register.go#L69I've also taken a look at the RunConvert method that is used by kubectl: https://github.com/kubernetes/kubernetes/blob/master/pkg/kubectl/cmd/convert/convert.go#L139 and assume that I can provide my own genericclioptions.IOStreams to get the output?It looks like RunConvert is on a deprecation pathI've also looked at other questions tagged [client-go] but most use old examples or use a YAML file with a single kind defined, and the API has changed since.Edit: Because I need to do this for more than one cluster and am creating clusters programmatically (AWS EKS API + CloudFormation/eksctl), I would like to minimize the overhead of creating ServiceAccounts across many cluster contexts, across many AWS accounts. Ideally, the only authentication step involved in creating my clientset is using aws-iam-authenticator to get a token using cluster data (name, region, CA cert, etc). There hasn't been a release of aws-iam-authenticator for a while, but the contents of master allow for the use of a third-party role cross-account role and external ID to be passed. IMO, this is cleaner than using a ServiceAccount (and IRSA) because there are other AWS services the application (the backend API which creates and applies add-ons to these clusters) needs to interact with.Edit: I have recently found https://github.com/ericchiang/k8s. It's definitely simpler to use than client-go, at a high-level, but doesn't support this behavior. <code>  csplit /path/to/recommended.yaml /---/ '{*}' --prefix='dashboard.' --suffix-format='%03d.yaml'",Using client-go to `kubectl apply` against the Kubernetes API directly with multiple types in a single YAML file
Getting Stackdriver logging working on Cloud Run in Golang," I'm trying to get stackdriver logging working for a simple Go app running in Google Cloud Run (fully managed), but don't see stackdriver entries in CloudRun logs.I've created simplest possible demo app based on ""official"" stackdriver golang exampleCloud Run docs states that no additional actions should be performed to write stackdriver logsMy service uses default service accountI'm using Go 1.13 to compile code (Dockerfile is copied from Cloud Run example ""as-is"")I've tried to deploy it to different regions, with no successWhen running container locally, using service account credentials, stackdriver log message does not appear in local terminal or stackdriver consoleNo matter what, on app start I see only ""Before stackdriver logging"" followed by ""After stackdriver logging"" with no other messages\errors in the middleHere's part of logging code (use link above to get full source, Dockerfile and instructions to build and run the app): <code>  import ( ""context"" ""log"" ""os"" ... ""cloud.google.com/go/compute/metadata"" ""cloud.google.com/go/logging"")func main() { loggingClient, err := stackdriverClient() ... log.Println(""Before stackdriver logging"") logger.StandardLogger(logging.Info).Println(""Stackdriver log"") if err = logger.Flush(); err != nil { log.Fatalf(""Failed to flush client: %v"", err) } if err = loggingClient.Close(); err != nil { log.Fatalf(""Failed to close client: %v"", err) } log.Println(""After stackdriver logging"") ...}func stackdriverClient() (client *logging.Client, err error) { var projectID string if projectID, err = metadata.ProjectID(); err == nil { client, err = logging.NewClient(context.Background(), projectID) } return}",How to use Stackdriver logging on Cloud Run
What is the difference between *(*uintptr) and **(**uintptr) in golang?," In Go's runtime/proc.go, there is a piece of code showed below: // funcPC returns the entry PC of the function f. // It assumes that f is a func value. Otherwise the behavior is undefined. // CAREFUL: In programs with plugins, funcPC can return different values // for the same function (because there are actually multiple copies of // the same function in the address space). To be safe, don't use the // results of this function in any == expression. It is only safe to // use the result as an address at which to start executing code. What I don't understand is why not use *(*uintptr) instead of **(**uintptr)?So I write a test program below to figure out. The result that p doesn't equal p1 makes me confused.Why doesn't the value of p equal the value of p1 while their type is the same?  <code>  //go:nosplitfunc funcPC(f interface{}) uintptr { return **(**uintptr)(add(unsafe.Pointer(&f), sys.PtrSize))} package mainimport ( ""fmt"" ""unsafe"")func main(){ fmt.Println() p := funcPC(test) fmt.Println(p) p1 := funcPC1(test) fmt.Println(p1) p2 := funcPC(test) fmt.Println(p2)}func test(){ fmt.Println(""hello"")}func funcPC(f func()) uintptr { return **(**uintptr)(unsafe.Pointer(&f))}func funcPC1(f func()) uintptr { return *(*uintptr)(unsafe.Pointer(&f))}",What is the difference between *(*uintptr) and **(**uintptr)
"What does ""hot path"" mean in golang?"," go version:1.13.4In the source code sync/once.go, the following comments mentioned ""hot path"": My questions are:What does ""hot path"" mean here?Does ""It is first in the struct"" make a ""hot path"" access more efficient? Why? <code>  type Once struct { // done indicates whether the action has been performed. // It is first in the struct because it is used in the hot path. // The hot path is inlined at every call site. // Placing done first allows more compact instructions on some architectures (amd64/x86), // and fewer instructions (to calculate offset) on other architectures. done uint32 m Mutex}","What does ""hot path"" mean in the context of sync.Once?"
Find version of go module," We are working with Go modules. I want in a CLI to get the specific version of a module. Is it possible?If you are curious, the reason is that I want to add the following generate command: So I need to somehow get the version <code>  //go:generate go run github.com/golang/mock/mockgen -source=""$GOPATH/pkg/mod/mymodules.com/mymodule@${VERSION}/module.go"" -destination=module_mock.go",Find version of a module
How to get a byte slice from a string in Golang?," I have read about ""https://github.com/golang/go/issues/25484"" about no-copy conversion from []byte to string.I am wondering if there is a way to convert a string to a byte slice without memory copy?I am writing a program which processes terra-bytes data, if every string is copied twice in memory, it will slow down the progress. And I do not care about mutable/unsafe, only internal usage, I just need the speed as fast as possible.Example: So the question is: is there a way to prevent from the memory copying? I know maybe I need the unsafe package, but I do not know how. I have searched a while, no answer till now, neither the SO showed related answers works. <code>  var s string// some processing on s, for some reasons, I must use string here// ...// then output to a writergzipWriter.Write([]byte(s)) // !!! Here I want to avoid the memory copy, no WriteString",How to use unsafe get a byte slice from a string without memory copy
How to get a byte slice from a string," I have read about ""https://github.com/golang/go/issues/25484"" about no-copy conversion from []byte to string.I am wondering if there is a way to convert a string to a byte slice without memory copy?I am writing a program which processes terra-bytes data, if every string is copied twice in memory, it will slow down the progress. And I do not care about mutable/unsafe, only internal usage, I just need the speed as fast as possible.Example: So the question is: is there a way to prevent from the memory copying? I know maybe I need the unsafe package, but I do not know how. I have searched a while, no answer till now, neither the SO showed related answers works. <code>  var s string// some processing on s, for some reasons, I must use string here// ...// then output to a writergzipWriter.Write([]byte(s)) // !!! Here I want to avoid the memory copy, no WriteString",How to use unsafe get a byte slice from a string without memory copy
How to get a byte slice from a string without memory copy," I have read about ""https://github.com/golang/go/issues/25484"" about no-copy conversion from []byte to string.I am wondering if there is a way to convert a string to a byte slice without memory copy?I am writing a program which processes terra-bytes data, if every string is copied twice in memory, it will slow down the progress. And I do not care about mutable/unsafe, only internal usage, I just need the speed as fast as possible.Example: So the question is: is there a way to prevent from the memory copying? I know maybe I need the unsafe package, but I do not know how. I have searched a while, no answer till now, neither the SO showed related answers works. <code>  var s string// some processing on s, for some reasons, I must use string here// ...// then output to a writergzipWriter.Write([]byte(s)) // !!! Here I want to avoid the memory copy, no WriteString",How to use unsafe get a byte slice from a string without memory copy
How to find Created Date of a file in Windows using Go, I was hoping to find the created date of a file in Windows. How would I be able to accomplish this simply?I have been using os.Stat and os.Chtimes to get other file information but it does not seem to offer information on created date. <code> ,How to find file creation date in Windows using Go
golang: net/http leaks memory in high load," I am developing an API that calls client URL using the net/http package. There are between 1 and 8 URLs called for each request (POST call) in goroutines concurrently based on user country/os. The app works with low qps of around 1000-1500 requests, but scaling the app to 3k requests there is a sudden increase in the memory even if only 1 client URL is called an app stops responding after a few minute(Response time well above 50sec). I am using Go native net/http package along with gorilla/mux router. Other question on this issue says to close the response body but I have done that using I need to reuse connection hence I have made http client and transport global variable initialized in init method like this. I have read that using keep alive causes the memory to leak, I have tried a few combination for disabling keep-alive/close request flag on request. But nothing seems to work. Also If I don't make any http call and use time.Sleep(300 * time.Millisecond) in goroutine calling each url concurrently app does work without any leak. So I am sure It has something to do with client/http package that under high load connection are not released or not used properly.What should be my approach to achieve this?Is creating a custom server and custom handler type to accept request and route requests will worked as mentioned in C10K approach in several article?I can share the sample code with all details if required. Above just added that the part where I feel the issue lies.this is a representative codemain.go vars.go pprof: Profiled app with 4 client url on average of around 2500qps.Top command:After 2minutes:Without calling client url, by keeping isValid = false and time.Sleep(300* time.Millisecond) no leaks happens. <code>  req, err := http.NewRequest(""POST"", ""client_post_url"", bytes.NewBuffer(requestBody)) req.Header.Set(""Content-Type"", ""application/json"") req.Header.Set(""Connection"", ""Keep-Alive"") response, err := common.Client.Do(req) status := 0 if err != nil {//handle and return} defer response.Body.Close() //used with/without io.Copy status = response.StatusCode body, _ := ioutil.ReadAll(response.Body) _, err = io.Copy(ioutil.Discard, response.Body) common.Transport = &http.Transport{ TLSClientConfig: &tls.Config{ InsecureSkipVerify: true, }, DialContext: (&net.Dialer{ //Timeout: time.Duration(300) * time.Millisecond, KeepAlive: 30 * time.Second, }).DialContext, //ForceAttemptHTTP2: true, DisableKeepAlives: false, //MaxIdleConns: 0, //IdleConnTimeout: 0, //TLSHandshakeTimeout: time.Duration(300) * time.Millisecond, //ExpectContinueTimeout: 1 * time.Second, } common.Client = &http.Client{ Timeout: time.Duration(300) * time.Millisecond, Transport: common.Transport, } package mainimport ( ""./common"" ""bytes"" ""crypto/tls"" ""fmt"" ""github.com/gorilla/mux"" ""io"" ""io/ioutil"" ""log"" ""math/rand"" ""net"" ""net/http"" ""net/http/pprof"" ""os"" ""runtime"" ""strconv"" ""sync"" ""time"")func init() { //Get Any command line argument passed args := os.Args[1:] numCPU := runtime.NumCPU() if len(args) > 1 { numCPU, _ = strconv.Atoi(args[0]) } common.Transport = &http.Transport{ TLSClientConfig: &tls.Config{ InsecureSkipVerify: true, }, DialContext: (&net.Dialer{ //Timeout: time.Duration() * time.Millisecond, KeepAlive: 30 * time.Second, }).DialContext, //ForceAttemptHTTP2: true, DisableKeepAlives: false, //MaxIdleConns: 0, //IdleConnTimeout: 0, //TLSHandshakeTimeout: time.Duration(300) * time.Millisecond, //ExpectContinueTimeout: 1 * time.Second, } common.Client = &http.Client{ Timeout: time.Duration(300) * time.Millisecond, Transport: common.Transport, } runtime.GOMAXPROCS(numCPU) rand.Seed(time.Now().UTC().UnixNano())}func main() { router := mux.NewRouter().StrictSlash(true) router.HandleFunc(""/"", func(w http.ResponseWriter, r *http.Request) { _, _ = fmt.Fprintf(w, ""Hello!!!"") }) router.HandleFunc(""/{name}"", func(w http.ResponseWriter, r *http.Request) { vars := mux.Vars(r) prepareRequest(w, r, vars[""name""]) }).Methods(""POST"") // Register pprof handlers router.HandleFunc(""/debug/pprof/"", pprof.Index) router.HandleFunc(""/debug/pprof/cmdline"", pprof.Cmdline) router.HandleFunc(""/debug/pprof/profile"", pprof.Profile) router.HandleFunc(""/debug/pprof/symbol"", pprof.Symbol) router.HandleFunc(""/debug/pprof/trace"", pprof.Trace) routerMiddleWare := http.TimeoutHandler(router, 500*time.Millisecond, ""Timeout"") srv := &http.Server{ Addr: ""0.0.0.0:"" + ""80"", /*ReadTimeout: 500 * time.Millisecond, WriteTimeout: 500 * time.Millisecond, IdleTimeout: 10 * time.Second,*/ Handler: routerMiddleWare, } log.Fatal(srv.ListenAndServe())}func prepareRequest(w http.ResponseWriter, r *http.Request, name string) { //other part of the code and call to goroutine var urls []string results, s, c := callUrls(urls) finalCall(w, results, s, c)}type Response struct { Status int Url string Body string}func callUrls(urls []string) ([]*Response, []string, []string) { var wg sync.WaitGroup wg.Add(len(urls)) ch := make(chan func() (*Response, string, string), len(urls)) for _, url := range urls { go func(url string) { //decide if request is valid for client to make http call using country/os isValid := true //assuming url to be called if isValid { //make post call //request body have many more paramter, just sample included. //instead of creating new request, time.Sleep for 300ms doesn't cause any memory leak. req, err := http.NewRequest(""POST"", url, bytes.NewBuffer([]byte(`{""body"":""param""}`))) req.Header.Set(""Content-Type"", ""application/json"") req.Header.Set(""Connection"", ""Keep-Alive"") //req.Close = true response, err := common.Client.Do(req) if err != nil { wg.Done() ch <- func() (*Response, string, string) { return &Response{Status: 500, Url: url, Body: """"}, ""error"", ""500"" } return } defer response.Body.Close() body, _ := ioutil.ReadAll(response.Body) _, err = io.Copy(ioutil.Discard, response.Body) //Close the body, forced this //Also tried without defer, and only wothout following line response.Body.Close() //do something with response body replace a few string etc. //and return wg.Done() ch <- func() (*Response, string, string) { return &Response{Status: 200, Url: url, Body: string(body)}, ""success"", ""200"" } } else { wg.Done() ch <- func() (*Response, string, string) { return &Response{Status: 500, Url: url, Body: """"}, ""invalid"", ""500"" } } }(url) } wg.Wait() var ( results []*Response msg []string status []string ) for { r, x, y := (<-ch)() if r != nil { results = append(results, r) msg = append(msg, x) status = append(status, y) } if len(results) == len(urls) { return results, msg, status } }}func finalCall(w http.ResponseWriter, results []*Response, msg []string, status []string){ fmt.Println(""response"", ""response body"", results, msg, status)} package commonimport ( ""net/http"")var ( //http client Client *http.Client //http Transport Transport *http.Transport)",Go net/http leaks memory in high load
net/http leaks memory in high load," I am developing an API that calls client URL using the net/http package. There are between 1 and 8 URLs called for each request (POST call) in goroutines concurrently based on user country/os. The app works with low qps of around 1000-1500 requests, but scaling the app to 3k requests there is a sudden increase in the memory even if only 1 client URL is called an app stops responding after a few minute(Response time well above 50sec). I am using Go native net/http package along with gorilla/mux router. Other question on this issue says to close the response body but I have done that using I need to reuse connection hence I have made http client and transport global variable initialized in init method like this. I have read that using keep alive causes the memory to leak, I have tried a few combination for disabling keep-alive/close request flag on request. But nothing seems to work. Also If I don't make any http call and use time.Sleep(300 * time.Millisecond) in goroutine calling each url concurrently app does work without any leak. So I am sure It has something to do with client/http package that under high load connection are not released or not used properly.What should be my approach to achieve this?Is creating a custom server and custom handler type to accept request and route requests will worked as mentioned in C10K approach in several article?I can share the sample code with all details if required. Above just added that the part where I feel the issue lies.this is a representative codemain.go vars.go pprof: Profiled app with 4 client url on average of around 2500qps.Top command:After 2minutes:Without calling client url, by keeping isValid = false and time.Sleep(300* time.Millisecond) no leaks happens. <code>  req, err := http.NewRequest(""POST"", ""client_post_url"", bytes.NewBuffer(requestBody)) req.Header.Set(""Content-Type"", ""application/json"") req.Header.Set(""Connection"", ""Keep-Alive"") response, err := common.Client.Do(req) status := 0 if err != nil {//handle and return} defer response.Body.Close() //used with/without io.Copy status = response.StatusCode body, _ := ioutil.ReadAll(response.Body) _, err = io.Copy(ioutil.Discard, response.Body) common.Transport = &http.Transport{ TLSClientConfig: &tls.Config{ InsecureSkipVerify: true, }, DialContext: (&net.Dialer{ //Timeout: time.Duration(300) * time.Millisecond, KeepAlive: 30 * time.Second, }).DialContext, //ForceAttemptHTTP2: true, DisableKeepAlives: false, //MaxIdleConns: 0, //IdleConnTimeout: 0, //TLSHandshakeTimeout: time.Duration(300) * time.Millisecond, //ExpectContinueTimeout: 1 * time.Second, } common.Client = &http.Client{ Timeout: time.Duration(300) * time.Millisecond, Transport: common.Transport, } package mainimport ( ""./common"" ""bytes"" ""crypto/tls"" ""fmt"" ""github.com/gorilla/mux"" ""io"" ""io/ioutil"" ""log"" ""math/rand"" ""net"" ""net/http"" ""net/http/pprof"" ""os"" ""runtime"" ""strconv"" ""sync"" ""time"")func init() { //Get Any command line argument passed args := os.Args[1:] numCPU := runtime.NumCPU() if len(args) > 1 { numCPU, _ = strconv.Atoi(args[0]) } common.Transport = &http.Transport{ TLSClientConfig: &tls.Config{ InsecureSkipVerify: true, }, DialContext: (&net.Dialer{ //Timeout: time.Duration() * time.Millisecond, KeepAlive: 30 * time.Second, }).DialContext, //ForceAttemptHTTP2: true, DisableKeepAlives: false, //MaxIdleConns: 0, //IdleConnTimeout: 0, //TLSHandshakeTimeout: time.Duration(300) * time.Millisecond, //ExpectContinueTimeout: 1 * time.Second, } common.Client = &http.Client{ Timeout: time.Duration(300) * time.Millisecond, Transport: common.Transport, } runtime.GOMAXPROCS(numCPU) rand.Seed(time.Now().UTC().UnixNano())}func main() { router := mux.NewRouter().StrictSlash(true) router.HandleFunc(""/"", func(w http.ResponseWriter, r *http.Request) { _, _ = fmt.Fprintf(w, ""Hello!!!"") }) router.HandleFunc(""/{name}"", func(w http.ResponseWriter, r *http.Request) { vars := mux.Vars(r) prepareRequest(w, r, vars[""name""]) }).Methods(""POST"") // Register pprof handlers router.HandleFunc(""/debug/pprof/"", pprof.Index) router.HandleFunc(""/debug/pprof/cmdline"", pprof.Cmdline) router.HandleFunc(""/debug/pprof/profile"", pprof.Profile) router.HandleFunc(""/debug/pprof/symbol"", pprof.Symbol) router.HandleFunc(""/debug/pprof/trace"", pprof.Trace) routerMiddleWare := http.TimeoutHandler(router, 500*time.Millisecond, ""Timeout"") srv := &http.Server{ Addr: ""0.0.0.0:"" + ""80"", /*ReadTimeout: 500 * time.Millisecond, WriteTimeout: 500 * time.Millisecond, IdleTimeout: 10 * time.Second,*/ Handler: routerMiddleWare, } log.Fatal(srv.ListenAndServe())}func prepareRequest(w http.ResponseWriter, r *http.Request, name string) { //other part of the code and call to goroutine var urls []string results, s, c := callUrls(urls) finalCall(w, results, s, c)}type Response struct { Status int Url string Body string}func callUrls(urls []string) ([]*Response, []string, []string) { var wg sync.WaitGroup wg.Add(len(urls)) ch := make(chan func() (*Response, string, string), len(urls)) for _, url := range urls { go func(url string) { //decide if request is valid for client to make http call using country/os isValid := true //assuming url to be called if isValid { //make post call //request body have many more paramter, just sample included. //instead of creating new request, time.Sleep for 300ms doesn't cause any memory leak. req, err := http.NewRequest(""POST"", url, bytes.NewBuffer([]byte(`{""body"":""param""}`))) req.Header.Set(""Content-Type"", ""application/json"") req.Header.Set(""Connection"", ""Keep-Alive"") //req.Close = true response, err := common.Client.Do(req) if err != nil { wg.Done() ch <- func() (*Response, string, string) { return &Response{Status: 500, Url: url, Body: """"}, ""error"", ""500"" } return } defer response.Body.Close() body, _ := ioutil.ReadAll(response.Body) _, err = io.Copy(ioutil.Discard, response.Body) //Close the body, forced this //Also tried without defer, and only wothout following line response.Body.Close() //do something with response body replace a few string etc. //and return wg.Done() ch <- func() (*Response, string, string) { return &Response{Status: 200, Url: url, Body: string(body)}, ""success"", ""200"" } } else { wg.Done() ch <- func() (*Response, string, string) { return &Response{Status: 500, Url: url, Body: """"}, ""invalid"", ""500"" } } }(url) } wg.Wait() var ( results []*Response msg []string status []string ) for { r, x, y := (<-ch)() if r != nil { results = append(results, r) msg = append(msg, x) status = append(status, y) } if len(results) == len(urls) { return results, msg, status } }}func finalCall(w http.ResponseWriter, results []*Response, msg []string, status []string){ fmt.Println(""response"", ""response body"", results, msg, status)} package commonimport ( ""net/http"")var ( //http client Client *http.Client //http Transport Transport *http.Transport)",Go net/http leaks memory in high load
What does Preload function do in golang ORM gorm?," The link http://gorm.io/docs/preload.html talks about preloading in GORM, but I am unable to understand what this function does. Can someone explain what will these 2 statements do? What will be the output ?Is it that preload is used to cache the results? <code>  type User struct { gorm.Model Username string Orders Order}type Order struct { gorm.Model UserID uint Price float64}db.Preload(""Username"")db.Preload(""Orders"").Find(&users)",What does Preload function do in gorm?
How to test cobra cli commands," I'm starting a new OSS CLI tool that utilizes spf13/cobra. Being new to golang, I'm having a hard time figuring out the best way to test commands in isolation. Can anybody give me an example of how to test a command? Couple of caveats:you can't return a cobra.Command from your init functionyou can't have get_test.go in the cmd directory...which I was under the impression was the golang best practice.I'm new to golang, go easy on me :sweat_smile:Please correct me if I'm wrong.Here's the cmd I'm trying to test: https://github.com/sahellebusch/raider/blob/3-add-get-alerts/cmd/get.go. Open to ideas, suggestions, criticisms, whatever. <code> ",How to implement unit tests for CLI commands in go
generate random 128 bit decimal in given range in go," Let's say that we have a random number generator that can generate random 32 or 64 bit integers (like rand.Rand in the standard library)Generating a random int64 in a given range [a,b] is fairly easy: Is it possible to generate random 128 bit decimal (as defined in specification IEEE 754-2008) in a given range from a combination of 32 or 64 bit random integers? <code>  rand.Seed(time.Now().UnixNano())n := rand.Int63n(b-a) + a",Generate random 128 bit decimal in given range in go
"Go: nested ServeMux always returns ""301 Moved Permanently"""," When using a nested http.ServeMux to define my server's endpoints, I encountered this problem: the handler would always respond with a ""301 Moved Permanently"" to any request, even when the URL path should match.Example: When trying to access /api/ping, the server redirects to /ping (which returns 404, of course).The same thing happens with any route under /api/ - /api/foo redirects to /foo.I am using Go 1.13 and curl 7.58. <code>  package mainimport ""net/http""func main() { api := http.NewServeMux() api.HandleFunc(""ping"", func(w http.ResponseWriter, r *http.Request) { w.Write([]byte(""pong\n"")) }) root := http.NewServeMux() root.Handle(""/api/"", http.StripPrefix(""/api/"", api)) http.ListenAndServe("":8080"", root)}","Nested ServeMux always returns ""301 Moved Permanently"""
"go : unknown subcommand ""mod"" error while running go mod init command GO lang"," I have installed the go language in my ubuntu using sudo apt install golang-go. It was successfully installed. When i run go version I am getting go version go1.10.4 linux/amd64 but when i tried running go mod init projectName I am getting the following error go: unknown subcommand ""mod""Do I need to install mod package or am i missing something? I have implemented the solution given by christophe in this forum but it didn't work for me. <code> ","Unknown subcommand ""mod"" error while running go mod init"
"unknown subcommand ""mod"" error while running go mod init"," I have installed the go language in my ubuntu using sudo apt install golang-go. It was successfully installed. When i run go version I am getting go version go1.10.4 linux/amd64 but when i tried running go mod init projectName I am getting the following error go: unknown subcommand ""mod""Do I need to install mod package or am i missing something? I have implemented the solution given by christophe in this forum but it didn't work for me. <code> ","Unknown subcommand ""mod"" error while running go mod init"
Goland does not recognise my vendor directory," When I open my Goland project, the following command is run: Its output is the following error: Goland cannot resolve the packages I'm importing.When I build and run the project from the command line, it works fine.My project is structured as follows: My GOROOT is /usr/local/Cellar/go/1.14/libexec and my GOPATH is app/.In Goland settings, under Go/GOPATH have checked the boxes for ""Use GOPATH that's defined in system environment"" and ""Index entire GOPATH"".Under Go/Go Modules (vgo), I have checked ""Enable Go Modules (vgo) integration"" and ""Vendoring mode""I have just noticed when I change the GOPATH to /Users/myname/sdk/go1.13.4, the problem is solved. Could this be an issue with Homebrew or a change introduced with go 1.14 that I am not aware of?I'm being exhaustive when describing the issue because I'm unfamiliar with Go and might be missing something obvious.Thanks! <code>  /usr/local/Cellar/go/1.14/libexec/bin/go list -m -json all #gosetup go list -m: can't compute 'all' using the vendor directory (Use -mod=mod or -mod=readonly to bypass.) app/ bin/ pkg/ src/ app/ cmd/ vendor/ go.mod",Goland does not recognise my vendor directory with Go 1.14
Golang error: cannot use promoted field in struct literal of type," I have two packages where Package B imports Package A, like this:Package A Package B However, this gives me the error: cannot use promoted field Car.Color in struct literal of type car inside NewCar function, how do I fix this? Everything I have read online just makes me more confused.  <code>  package Atype Car struct { Color string Make string Model string} package Btype car struct { *A.Car}func NewCar() car { return &car{ Color: ""red"", Make: ""toyota"", Model: ""prius""}}",error: cannot use promoted field in struct literal of type
"GoLang: how to fix ""invalid version"" and ""could not read Username"" in ""go get"" of a private repository?"," I want to use private repositories that are hosted at GitHub in another GoLang-project.What I did:I created a private access token at my GitHub account settingsdid then:git config --global url.""https://xxxxxx:ACCESS_TOKEN@github.com"".insteadOf ""https://github.com""with ""xxxxxx"" as my real GitHub username and then the proper ACCESS_TOKEN.go get github.com/private/repo However, I get always the following error: I have also tried the following:GONOSUMDB=github.com/myusername go get github.com/xxxxxx/yyy...And according to some answers at StackOverflow for similar issues I tried to add "".git"" after the repo-url. But this won't work at all.What could this be and how can I fix this?Versions: go version 1.14 <code>  go: downloading github.com/xxxxxxxx/yyyyyyyyy-go-sdk v0.0.0-20200307154628-cbcb73911013go get github.com/xxxxxxxx/yyyyyyyyy-go-sdk: github.com/xxxxxxxx/yyyyyyyyy-go-sdk@v0.0.0-20200307154628-cbcb73911013: verifying module: github.com/xxxxxxxx/yyyyyyyyy-go-sdk@v0.0.0-20200307154628-cbcb73911013: reading https://sum.golang.org/lookup/github.com/xxxxxxxx/yyyyyyyyy-go-sdk@v0.0.0-20200307154628-cbcb73911013: 410 Gone server response: not found: github.com/xxxxxxxx/yyyyyyyyy-go-sdk@v0.0.0-20200307154628-cbcb73911013: invalid version: git fetch -f origin refs/heads/*:refs/heads/* refs/tags/*:refs/tags/* in /tmp/gopath/pkg/mod/cache/vcs/5eca4f397ed3a418f58ee864965ed24936e21268780304d6941f5b3983d31ad1: exit status 128: fatal: could not read Username for 'https://github.com': terminal prompts disabled git --versiongit version 2.25.0hub version 2.14.2","How to fix ""invalid version"" and ""could not read Username"" in ""go get"" of a private repository?"
Golang - primitive.ObjectID to string," I am trying to convert type primitive.ObjectID to string type in Go. I am using mongo-driver from go.mongodb.org/mongo-driver.I tried using type assertion like Which VSCode accepts. Code gets compiled and when it reaches this specific line of code, it throws this error <code>  mongoId := mongoDoc[""_id""];stringObjectID := mongoId.(string) panic: interface conversion: interface {} is primitive.ObjectID, not string",Primitive.ObjectID to string in Golang
Primitive.ObjectID to string," I am trying to convert type primitive.ObjectID to string type in Go. I am using mongo-driver from go.mongodb.org/mongo-driver.I tried using type assertion like Which VSCode accepts. Code gets compiled and when it reaches this specific line of code, it throws this error <code>  mongoId := mongoDoc[""_id""];stringObjectID := mongoId.(string) panic: interface conversion: interface {} is primitive.ObjectID, not string",Primitive.ObjectID to string in Golang
GO LANG: Indirect dependencies in go.mod file. How to avoid?," I am running go build to get my go.mod file updated with library I am using ""github.com/gocolly/colly v1.2.0"" But I see all other dependencies saying ""// indirect"" at end. How to avoid getting this?Here is my go.mod file  <code>  module prodenvgo 1.13require ( github.com/PuerkitoBio/goquery v1.5.1 // indirect github.com/antchfx/htmlquery v1.2.2 // indirect github.com/antchfx/xmlquery v1.2.3 // indirect github.com/antchfx/xpath v1.1.5 // indirect github.com/gobwas/glob v0.2.3 // indirect github.com/gocolly/colly v1.2.0 github.com/golang/groupcache v0.0.0-20200121045136-8c9f03a8e57e // indirect github.com/kennygrant/sanitize v1.2.4 // indirect github.com/saintfish/chardet v0.0.0-20120816061221-3af4cd4741ca // indirect github.com/temoto/robotstxt v1.1.1 // indirect golang.org/x/net v0.0.0-20200324143707-d3edc9973b7e // indirect google.golang.org/appengine v1.6.5 // indirect)",How to avoid indirect dependencies in go.mod file
COPY failed: Forbidden path outside the build context dockerfile golang monorepo," I have a monorepo that has holds various Go services and libraries. It has a structure of My go.mod resides in the root of the monorepo and the services use the dependencies stated in the go.mod file.I build the Docker image with docker build -t some:tag ./services/service-a/When I try to build my Docker image from the root of the monorepo with the above docker command I get the following error. COPY failed: Forbidden path outside the build context: ../../go.mod ()Below is my Dockerfile Is there something I have to do to be able to add files into my Docker image that aren't in the current directory without having to have a separate go.mod and go.sum in each service within the monorepo? <code>  monorepo services service-a - Dockerfilego.modgo.sum FROM golang:1.14.1-alpine3.11RUN apk add --no-cache ca-certificates git# Enable Go ModulesENV GO111MODULE=on# Set the Current Working Directory inside the containerWORKDIR /app# Copy go mod and sum filesCOPY ../../go.mod go.sum ./RUN go mod downloadCOPY . .RUN CGO_ENABLED=0 go build -o service-aENTRYPOINT [""/app/service-a""]",COPY failed: Forbidden path outside the build context
What is useful for `t.Cleanup`?," QuestionsI would like to know the use case of t.Cleanup introduced in Go1.14. What is the convenience of t.Cleanup as compared to using defer?https://golang.org/pkg/testing/#T.Cleanup.SampleFor example, let's say we create a temporary directory, and when we test it, we want to delete the temporary directory we created.t.Cleanup can be used to write a test as follows, but it also works as defer os.RemoveAll(tempDir). <code>  package mypkgimport ( ""io/ioutil"" ""os"" ""testing"")func TestDirwalk(t *testing.T) { tempDir, err := ioutil.TempDir(""."", ""temp"") if err != nil { t.Errorf(""create tempDir: %v"", err) } t.Cleanup(func() { os.RemoveAll(tempDir) }) // something...}",What is useful for t.Cleanup?
"""package XXX is not in GOROOT"" when building Golang project"," I have a weird issue that arose when I took a break from this project. Upon starting up Goland, I'm riddled with errors when trying to run my project. The specific error, when building one of my packages, is: start.go: package project/game is not in GOROOT (C:\Go\src\project\game)I have a folder structure as such under C:\Users\username and my env vars are as such: for each of the modules (project/game/entity, project/game, project/server), I did a git mod init. When building, Goland will try to run this: and return the error.Can anyone help me with this issue? Kind of lost since Goland was working fine the last time I opened it. Also not even sure what direction to look at - I'm pretty new to Go and I'm not really sure what documentation to look at :\ Thank you everyone!  <code>  go|-src |-project |-game |-entity |-whatever.go |-game_stuff.go |-server GOROOT=C:\Go GOPATH=C:\Users\ketchup\go C:\Go\bin\go.exe build -o C:\Users\ketchup\AppData\Local\Temp\___go_build_project_server.exe project/server","""package XXX is not in GOROOT"" when building a Go project"
how to install a specific vresion of grpcurl?," I tried to use to install grpcurl on my ubuntu box, but after that when I do grpcurl --version I still gotgrpcurl dev build I expect to see <code>  go get github.com/fullstorydev/grpcurl@2108c8fgo install github.com/fullstorydev/grpcurl/cmd/grpcurlexport PATH=$GOPATH/bin:$PATH grpcurl 1.16.0",how to install a specific version of grpcurl?
How to overwirte file content in golang," I have a empty file called a.txt, I want to output a value(int) to it in a loop, and overwrite last content in file a.txt. For example,  <code>  // open a file f, err := os.Open(""test.txt"") if err != nil { log.Fatal(err) } defer f.Close() // another file af, err := os.OpenFile(""a.txt"", os.O_WRONLY|os.O_CREATE|os.O_TRUNC, 0644) if err != nil { log.Fatal(err) } defer af.Close() b := []byte{} scanner := bufio.NewScanner(f) for scanner.Scan() { b = append(b, scanner.Bytes()...) // how to output len(b) into a.txt? }",How to overwrite file content in golang
(Golang) How to listen at the data link layer (ethernet) and respond at the transport layer (udp6)," What I am trying to do is listen to ethernet frames for IPv6 and respond to UDP calls on a specific port.I am able to capture the ethernet frames I care about and parse out the UDP payload, but when I attempt to echo that payload back is where I have a problem. Here is my ""server"" code: And then my client code which is running on the same machine: The problem from the client side is a connection refused read udp6 [::1]:56346->[::1]:8080: recvfrom: connection refused which my guess would be coming from the linux kernel since I have not bound anything to 8080 strictly speaking.There is data I need from the IPv6 header (not seen above) which is why I need to listen on the data link layer, but since I also need to respond to UDP requests things get a little tricky.An option I have but don't like would be to in a separate goroutine do a standard net.ListenUDP and then block after reading data until the IPv6 header is read from the syscall socket listener, then from there responding on the udp connection. If this is my only option I will take it but I would interested to see if there is something better I could do. <code>  func main() { fd, err := syscall.Socket(syscall.AF_PACKET, syscall.SOCK_RAW, int(htons(syscall.ETH_P_IPV6))) iface, err := net.InterfaceByName(""lo"") if err != nil { log.Fatal(err) } err = syscall.BindToDevice(fd, iface.Name) if err != nil { log.Fatal(err) } for { buf := make([]byte, iface.MTU) n, callerAddr, err := syscall.Recvfrom(fd, buf, 0) if err != nil { log.Fatal(err) } data := buf[:n] packet := gopacket.NewPacket(data, layers.LayerTypeEthernet, gopacket.Default) udpPacket := packet.Layer(layers.LayerTypeUDP) if udpPacket != nil { udpPck, _ := udpPacket.(*layers.UDP) // I only care about calls to 8080 for this example if udpPck.DstPort != 8080 { continue } err = udpPck.SetNetworkLayerForChecksum(packet.NetworkLayer()); if err != nil { log.Fatal(err) } log.Print(packet) log.Printf(""UDP Port from %v --> %v"", udpPck.SrcPort, udpPck.DstPort) log.Printf(""Payload '%v'"", string(udpPck.Payload)) // Flip the source and destination so it can go back to the caller ogDst := udpPck.DstPort udpPck.DstPort = udpPck.SrcPort udpPck.SrcPort = ogDst buffer := gopacket.NewSerializeBuffer() options := gopacket.SerializeOptions{ComputeChecksums: true} // Rebuild the packet with the new source and destination port err := gopacket.SerializePacket(buffer, options, packet) if err != nil { log.Fatal(err) } log.Printf(""Writing the payload back to the caller: %v"", callerAddr) log.Print(packet) err = syscall.Sendto(fd, buffer.Bytes(), 0, callerAddr) if err != nil { log.Fatal(err) } }} func main() { conn, err := net.DialUDP(""udp6"", &net.UDPAddr{ IP: net.IPv6loopback, Port: 0, }, &net.UDPAddr{ IP: net.IPv6loopback, Port: 8080, }) if err != nil { log.Fatal(err) } _, _ = conn.Write([]byte(""Hello World"")) log.Print(""Waiting for response"") buf := make([]byte, 65535) n, _, err := conn.ReadFrom(buf) if err != nil { log.Fatal(err) } log.Printf(""Response message '%v'"", string(buf[:n]))}",How to listen at the data link layer (ethernet) and respond at the transport layer
Why are null bytes appearing?," I've been tying to figure why null bytes are appearing in certain strings. Example below. I essentially I wrap an io.Reader from an HTTP request and decode into a struct. See below I've tried numerous ways to try and remove the null bytes, I assume they are coming in the request from Android clients. From help on an earlier stack thread, I was able to deploy the below implementation into production in an attempt too remove the null bytes. I even went as far to attempt to remove the string literal of \u0000 as seen here (also tested in production for a bit) unfortunately both versions do not stop the issue. I can see in production logs \u0000 appearing in a percentage of logs. I thought that by wrapping the io.Reader responses in the Sanitizers above that the issue would stop. I can see from tests that null bytes 0 and \u0000 get removed... but the issues persists in production. I suspect that the issue is with the request from the clients still. This is because the issue only appears with a particular client version. Other app versions and platforms aren't triggering null bytes to appear in the strings and all clients communicate to the same centralized servers. I'm out of ideas. I have no idea why the sanitizers above don't remove the null bytes before the JSON decoder loads the data into the strut. Does anyone have any insights? <code>  {""gender"":""fema\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000le""} func bodyToStruct(res *http.Request, v gojay.UnmarshalerJSONObject) error { var reader io.ReadCloser var err error switch res.Header.Get(""Content-Encoding"") { case ""gzip"": reader, err = pool.Gzip.GetReader(res.Body) if err != nil { return err } defer pool.Gzip.PutReader(reader) case ""deflate"": reader = flate.NewReader(res.Body) defer reader.Close() default: reader = res.Body } decoder := gojay.BorrowDecoder(streams.NewNullByteRemoverStream(reader)) //wrapped in NewNullByteRemoverStream defer decoder.Release() return decoder.DecodeObject(v)} package streamsimport ( ""io"")// NullByte is a stream wrapper that should remove null bytes from the byte stream as well as reject any and all control bytestype NullByte struct { Reader io.Reader}// NewNullByteRemoverStream creates a new NullByte reader which passes passes the parent stream through and remove null bytesfunc NewNullByteRemoverStream(reader io.ReadCloser) *NullByte { return &NullByte{ Reader: reader, }}func (s *NullByte) Read(p []byte) (n int, err error) { n, err = s.Reader.Read(p) var nn int for i := 0; i < n; i++ { if p[i] >= 32 && p[i] <= 126 { p[nn] = p[i] nn++ } } return nn, err} package streamsimport ( ""io"")const _unicodeCodePointLength = 6var ( _sControlByte = byte(92) _sNullByteBlock = []byte{92, 117, 48, 48, 48, 48})// NullByte is a stream wrapper that should remove null bytes from the byte stream as well as reject any and all control bytestype NullByte struct { Reader io.Reader state int}// NewNullByteRemoverStream creates a new NullByte reader which passes passes the parent stream through and remove null bytes// as well as \u0000 as a string representationfunc NewNullByteRemoverStream(reader io.ReadCloser) *NullByte { return &NullByte{ Reader: reader, }}func (s *NullByte) Read(p []byte) (n int, err error) { n, err = s.Reader.Read(p) var nn, i int for i < n { if p[i] == _sControlByte { s.state = 0 } if p[i] == _sControlByte || s.state > 0 { var broke bool if p[i] == _sControlByte { stop := 0 for j := i; j < n; j++ { if stop == _unicodeCodePointLength { break } if p[j] != _sNullByteBlock[stop] { broke = true break } stop++ } if broke { p[nn] = p[i] i++ nn++ s.state = 0 continue } } if s.state < _unicodeCodePointLength { i++ s.state++ continue } } if p[i] != 0 { p[nn] = p[i] nn++ } i++ } return nn, err}","Why are null bytes appearing? Even after ""sanitizing"" the stream"
Golang assembly implement for inplace updating [8]uint32 with another one," This post is related to Golang assembly implement of _mm_add_epi32 , where it adds paired elements in two [8]int32 list, and returns the updated first one.According to pprof profile, I found passing [8]int32 is expensive, so I think passing pointer of the list is much cheaper and the bech result verified this. Here's the go version: This function is called in two levels of loop.The algorithm computes a position population count over an array of bytes.Thanks advice from @fuz , I know that writing whole algorithm in assembly is the best choice and makes sense, but it's beyond my ability since I never learn programming in assembly.However, it should be easy to optimize the inner loop with assembly: Can you help to write an assembly version of __mm_add_epi32_inplace_purego (this is enough for me), or even the whole loop? Thank you in advance. <code>  func __mm_add_epi32_inplace_purego(x, y *[8]int32) { (*x)[0] += (*y)[0] (*x)[1] += (*y)[1] (*x)[2] += (*y)[2] (*x)[3] += (*y)[3] (*x)[4] += (*y)[4] (*x)[5] += (*y)[5] (*x)[6] += (*y)[6] (*x)[7] += (*y)[7]} counts := make([][8]int32, numRowBytes)for i, b = range byteSlice { if b == 0 { // more than half of elements in byteSlice is 0. continue } expand = _expand_byte[b] __mm_add_epi32_inplace_purego(&counts[i], expand)}// expands a byte into its bitsvar _expand_byte = [256]*[8]int32{ &[8]int32{0, 0, 0, 0, 0, 0, 0, 0}, &[8]int32{0, 0, 0, 0, 0, 0, 0, 1}, &[8]int32{0, 0, 0, 0, 0, 0, 1, 0}, &[8]int32{0, 0, 0, 0, 0, 0, 1, 1}, &[8]int32{0, 0, 0, 0, 0, 1, 0, 0}, ...}",How to optimise this 8-bit positional popcount using assembly?
"What is the differenc between StringVar vs StringVarP or String vs StringP when using Go (golang), cobra and viper?"," I'm maintaining some code written using Go (golang), Viper and Cobra.On one line, it has: And then on the following line it has What is the difference between String and StringP in this context?Looking at example usages in various tutorials, there seem to be P and non-P versions of various methods, such as StringVarP and StringVar.What is the difference between these versions? What is the significance of the P?Is there a way I can tell whether a given method has a P or non-P counterpart?Search engines tend to take me to cobra or viper tutorial pages, which make use of these methods without explaining the P or non-P counterpart.I found some material on pflags which suggested it might be to do with whether the parameter has a short (one-letter) form. Could this be it?Post-edit note: Having received answers to this question, it seems spf13/pflag is indeed used under the hood by the above mentioned golang frameworks. However, it's not immediately clear that one should go looking through the pflags documentation when using cobra or viper.As this is a Q&A site, I've reverted an edit that removed many of the keywords I would have entered when looking for this answer, as I feel others looking for the same information will be better served that way. <code>  rootCmd.PersistentFlags().String(""cfg"", """", ""A description"") rootCmd.PersistentFlags().StringP(""output"", ""o"", ""."", ""Another description"")","What is the difference between StringVar vs StringVarP or String vs StringP when using Go (golang), cobra and viper?"
What is the differenc between StringVar vs StringVarP or String vs StringP?," I'm maintaining some code written using Go (golang), Viper and Cobra.On one line, it has: And then on the following line it has What is the difference between String and StringP in this context?Looking at example usages in various tutorials, there seem to be P and non-P versions of various methods, such as StringVarP and StringVar.What is the difference between these versions? What is the significance of the P?Is there a way I can tell whether a given method has a P or non-P counterpart?Search engines tend to take me to cobra or viper tutorial pages, which make use of these methods without explaining the P or non-P counterpart.I found some material on pflags which suggested it might be to do with whether the parameter has a short (one-letter) form. Could this be it?Post-edit note: Having received answers to this question, it seems spf13/pflag is indeed used under the hood by the above mentioned golang frameworks. However, it's not immediately clear that one should go looking through the pflags documentation when using cobra or viper.As this is a Q&A site, I've reverted an edit that removed many of the keywords I would have entered when looking for this answer, as I feel others looking for the same information will be better served that way. <code>  rootCmd.PersistentFlags().String(""cfg"", """", ""A description"") rootCmd.PersistentFlags().StringP(""output"", ""o"", ""."", ""Another description"")","What is the difference between StringVar vs StringVarP or String vs StringP when using Go (golang), cobra and viper?"
What is the difference between StringVar vs StringVarP or String vs StringP?," I'm maintaining some code written using Go (golang), Viper and Cobra.On one line, it has: And then on the following line it has What is the difference between String and StringP in this context?Looking at example usages in various tutorials, there seem to be P and non-P versions of various methods, such as StringVarP and StringVar.What is the difference between these versions? What is the significance of the P?Is there a way I can tell whether a given method has a P or non-P counterpart?Search engines tend to take me to cobra or viper tutorial pages, which make use of these methods without explaining the P or non-P counterpart.I found some material on pflags which suggested it might be to do with whether the parameter has a short (one-letter) form. Could this be it?Post-edit note: Having received answers to this question, it seems spf13/pflag is indeed used under the hood by the above mentioned golang frameworks. However, it's not immediately clear that one should go looking through the pflags documentation when using cobra or viper.As this is a Q&A site, I've reverted an edit that removed many of the keywords I would have entered when looking for this answer, as I feel others looking for the same information will be better served that way. <code>  rootCmd.PersistentFlags().String(""cfg"", """", ""A description"") rootCmd.PersistentFlags().StringP(""output"", ""o"", ""."", ""Another description"")","What is the difference between StringVar vs StringVarP or String vs StringP when using Go (golang), cobra and viper?"
Create custom kubernetes resource with golang," I want to create a custom kubernetes resource with go. The application is deployed in the kubernetes cluster. I want to create e.g. the followng resource: So far I always created the 'standard' resources e.g. a secret with the following code: In addition I tried to get a resource with the following code: I get the following err: If I make a request at the command line k get KongPlugin I can see all the resources. So how can view the custom resoources? <code>  apiVersion: configuration.konghq.com/v1 kind: KongPlugin metadata: name: add-response-header config: add: headers: - ""demo: injected-by-kong"" plugin: response-transformer CreateSecret(name string, data map[string]string) error { confs, err := rest.InClusterConfig() if err != nil { panic(err) } clientset, err = kubernetes.NewForConfig(confs) i := clientset.CoreV1() if _, err := i.Secrets(namespace).Create(&v1.Secret{ TypeMeta: metav1.TypeMeta{ Kind: ""Secret"", APIVersion: ""v1"", }, ObjectMeta: metav1.ObjectMeta{ Name: name, }, StringData: data, Type: ""Opaque"", }); err != nil { return err }} b, err := clientset.RESTClient().Get().Namespace(namespace).Resource(""KongPlugin"").DoRaw() the server could not find the requested resource (get KongPlugin) NAME PLUGIN-TYPE AGEadd-proxy-headers request-transformer 3h34m",Create/Get a custom kubernetes resource
Create a custom kubernetes resource with golang," I want to create a custom kubernetes resource with go. The application is deployed in the kubernetes cluster. I want to create e.g. the followng resource: So far I always created the 'standard' resources e.g. a secret with the following code: In addition I tried to get a resource with the following code: I get the following err: If I make a request at the command line k get KongPlugin I can see all the resources. So how can view the custom resoources? <code>  apiVersion: configuration.konghq.com/v1 kind: KongPlugin metadata: name: add-response-header config: add: headers: - ""demo: injected-by-kong"" plugin: response-transformer CreateSecret(name string, data map[string]string) error { confs, err := rest.InClusterConfig() if err != nil { panic(err) } clientset, err = kubernetes.NewForConfig(confs) i := clientset.CoreV1() if _, err := i.Secrets(namespace).Create(&v1.Secret{ TypeMeta: metav1.TypeMeta{ Kind: ""Secret"", APIVersion: ""v1"", }, ObjectMeta: metav1.ObjectMeta{ Name: name, }, StringData: data, Type: ""Opaque"", }); err != nil { return err }} b, err := clientset.RESTClient().Get().Namespace(namespace).Resource(""KongPlugin"").DoRaw() the server could not find the requested resource (get KongPlugin) NAME PLUGIN-TYPE AGEadd-proxy-headers request-transformer 3h34m",Create/Get a custom kubernetes resource
Create/Get a custom kubernetes resource with golang," I want to create a custom kubernetes resource with go. The application is deployed in the kubernetes cluster. I want to create e.g. the followng resource: So far I always created the 'standard' resources e.g. a secret with the following code: In addition I tried to get a resource with the following code: I get the following err: If I make a request at the command line k get KongPlugin I can see all the resources. So how can view the custom resoources? <code>  apiVersion: configuration.konghq.com/v1 kind: KongPlugin metadata: name: add-response-header config: add: headers: - ""demo: injected-by-kong"" plugin: response-transformer CreateSecret(name string, data map[string]string) error { confs, err := rest.InClusterConfig() if err != nil { panic(err) } clientset, err = kubernetes.NewForConfig(confs) i := clientset.CoreV1() if _, err := i.Secrets(namespace).Create(&v1.Secret{ TypeMeta: metav1.TypeMeta{ Kind: ""Secret"", APIVersion: ""v1"", }, ObjectMeta: metav1.ObjectMeta{ Name: name, }, StringData: data, Type: ""Opaque"", }); err != nil { return err }} b, err := clientset.RESTClient().Get().Namespace(namespace).Resource(""KongPlugin"").DoRaw() the server could not find the requested resource (get KongPlugin) NAME PLUGIN-TYPE AGEadd-proxy-headers request-transformer 3h34m",Create/Get a custom kubernetes resource
Golang OIDC ask for certificate on K8S," I use the following code with this lib While running it locally with same providerURI it works,I was able to get the provider successfully!I deployed it to K8S with the exact same provider url (as env variable ) and debug it using port-forwarding ,However, in k8S I got error and dont get the provider.The error is: I've added the certificate to the image and verify it, I exec into k8s container after deploy and I see the server.crt file under /usr/local/share/ca-certificates/ path.And still got the same error, any idea if I miss here something else ...Not sure if it really related to the OIDC lib or something more general.. I got replay from the author of the GO-OIDC repository to try to usehttps://godoc.org/github.com/coreos/go-oidc#ClientContextNot sure how, any idea? <code>  provider, err := oidc.NewProvider(ctx, providerURI)if err != nil { log.Println(err)} 2020/08/14 16:42:22 Get ""https://ace.svar.com/.well-known/openid-configuration"": x509: certificate signed by unknown authority FROM golang:1.14.7 AS builderRUN go get github.com/go-delve/delve/cmd/dlvADD server.crt /usr/local/share/ca-certificates/server.crtRUN chmod 644 /usr/local/share/ca-certificates/server.crt && update-ca-certificatesRUN mkdir /appADD . /appWORKDIR /appRUN CGO_ENABLED=0 GOOS=linux go build -gcflags=""all=-N -l"" -o main ./...FROM debian:buster AS productionCOPY --from=builder /app .COPY --from=builder /go/bin/dlv /COPY --from=builder /usr/local/share/ca-certificates/ /usr/local/share/ca-certificates/EXPOSE 8000 40000ENV SSL_CERT_DIR=/usr/local/share/ca-certificates/ENV PORT=8000CMD [""/dlv"", ""--listen=:40000"", ""--headless=true"", ""--api-version=2"", ""--accept-multiclient"", ""exec"", ""./main""]",GO - Docker ask certificate on K8S container
OIDC ask for certificate on K8S," I use the following code with this lib While running it locally with same providerURI it works,I was able to get the provider successfully!I deployed it to K8S with the exact same provider url (as env variable ) and debug it using port-forwarding ,However, in k8S I got error and dont get the provider.The error is: I've added the certificate to the image and verify it, I exec into k8s container after deploy and I see the server.crt file under /usr/local/share/ca-certificates/ path.And still got the same error, any idea if I miss here something else ...Not sure if it really related to the OIDC lib or something more general.. I got replay from the author of the GO-OIDC repository to try to usehttps://godoc.org/github.com/coreos/go-oidc#ClientContextNot sure how, any idea? <code>  provider, err := oidc.NewProvider(ctx, providerURI)if err != nil { log.Println(err)} 2020/08/14 16:42:22 Get ""https://ace.svar.com/.well-known/openid-configuration"": x509: certificate signed by unknown authority FROM golang:1.14.7 AS builderRUN go get github.com/go-delve/delve/cmd/dlvADD server.crt /usr/local/share/ca-certificates/server.crtRUN chmod 644 /usr/local/share/ca-certificates/server.crt && update-ca-certificatesRUN mkdir /appADD . /appWORKDIR /appRUN CGO_ENABLED=0 GOOS=linux go build -gcflags=""all=-N -l"" -o main ./...FROM debian:buster AS productionCOPY --from=builder /app .COPY --from=builder /go/bin/dlv /COPY --from=builder /usr/local/share/ca-certificates/ /usr/local/share/ca-certificates/EXPOSE 8000 40000ENV SSL_CERT_DIR=/usr/local/share/ca-certificates/ENV PORT=8000CMD [""/dlv"", ""--listen=:40000"", ""--headless=true"", ""--api-version=2"", ""--accept-multiclient"", ""exec"", ""./main""]",GO - Docker ask certificate on K8S container
GO - OIDC ask for certificate on K8S container," I use the following code with this lib While running it locally with same providerURI it works,I was able to get the provider successfully!I deployed it to K8S with the exact same provider url (as env variable ) and debug it using port-forwarding ,However, in k8S I got error and dont get the provider.The error is: I've added the certificate to the image and verify it, I exec into k8s container after deploy and I see the server.crt file under /usr/local/share/ca-certificates/ path.And still got the same error, any idea if I miss here something else ...Not sure if it really related to the OIDC lib or something more general.. I got replay from the author of the GO-OIDC repository to try to usehttps://godoc.org/github.com/coreos/go-oidc#ClientContextNot sure how, any idea? <code>  provider, err := oidc.NewProvider(ctx, providerURI)if err != nil { log.Println(err)} 2020/08/14 16:42:22 Get ""https://ace.svar.com/.well-known/openid-configuration"": x509: certificate signed by unknown authority FROM golang:1.14.7 AS builderRUN go get github.com/go-delve/delve/cmd/dlvADD server.crt /usr/local/share/ca-certificates/server.crtRUN chmod 644 /usr/local/share/ca-certificates/server.crt && update-ca-certificatesRUN mkdir /appADD . /appWORKDIR /appRUN CGO_ENABLED=0 GOOS=linux go build -gcflags=""all=-N -l"" -o main ./...FROM debian:buster AS productionCOPY --from=builder /app .COPY --from=builder /go/bin/dlv /COPY --from=builder /usr/local/share/ca-certificates/ /usr/local/share/ca-certificates/EXPOSE 8000 40000ENV SSL_CERT_DIR=/usr/local/share/ca-certificates/ENV PORT=8000CMD [""/dlv"", ""--listen=:40000"", ""--headless=true"", ""--api-version=2"", ""--accept-multiclient"", ""exec"", ""./main""]",GO - Docker ask certificate on K8S container
"Using Kafka-Go, why am I seeing what appears to be buffering? Is there a config I am missing? Should I try a different package?"," I'm going to be switching from RabbitMQ to Kafka. This is just a simple spike to see how Kafka operates. I'm not sure if there are settings that I am missing, if it is my code, if it is Kafka-Go, or if this is expected Kafka behavior.I've tried adjusting the BatchSize as well as the BatchTimeout but neither have had an impact.The code below creates a topic with 6 partitions and a replication factor of 3. It then produces an incrementing message every 100ms. It launches 6 consumers, one for each partition. Both reading and writing are performed in go routines.In the log below, it goes 7 seconds without receiving a message and then receives bursts. I'm using Confluent's platform so I recognize that there will be some network latency but not to the degree that I'm seeing. Which is logging the below. Any advice would be greatly appreciated. Thanks!Edit:The buffering is definitely just happening with Kafka-Go. Sarama does not encounter the same behavior: In fact, in some cases it actually receives before the sent is confirmed which makes me wonder if there is internal messaging occurring and if so, if I should care... <code>  package mainimport ( ""context"" ""crypto/tls"" ""crypto/x509"" ""fmt"" ""log"" ""net"" ""strconv"" ""time"" kafka ""github.com/segmentio/kafka-go"" ""github.com/segmentio/kafka-go/sasl/plain"")func newDialer(clientID, username, password string) *kafka.Dialer { mechanism := plain.Mechanism{ Username: username, Password: password, } rootCAs, _ := x509.SystemCertPool() if rootCAs == nil { rootCAs = x509.NewCertPool() } return &kafka.Dialer{ Timeout: 10 * time.Second, DualStack: true, ClientID: clientID, SASLMechanism: mechanism, TLS: &tls.Config{ InsecureSkipVerify: false, RootCAs: rootCAs, }, }}func createTopic(url string, topic string, dialer *kafka.Dialer) { conn, err := dialer.Dial(""tcp"", url) if err != nil { panic(err.Error()) } defer conn.Close() controller, err := conn.Controller() if err != nil { panic(err.Error()) } var controllerConn *kafka.Conn controllerConn, err = dialer.Dial(""tcp"", net.JoinHostPort(controller.Host, strconv.Itoa(controller.Port))) if err != nil { panic(err.Error()) } defer controllerConn.Close() topicConfigs := []kafka.TopicConfig{ { Topic: topic, NumPartitions: 6, ReplicationFactor: 3, }, } err = controllerConn.CreateTopics(topicConfigs...) if err != nil { panic(err.Error()) }}func newWriter(url string, topic string, dialer *kafka.Dialer) *kafka.Writer { return kafka.NewWriter(kafka.WriterConfig{ Brokers: []string{url}, Topic: topic, Balancer: &kafka.CRC32Balancer{}, Dialer: dialer, BatchSize: 10, BatchTimeout: 1 * time.Millisecond, })}func newReader(url string, topic string, partition int, dialer *kafka.Dialer) *kafka.Reader { return kafka.NewReader(kafka.ReaderConfig{ Brokers: []string{url}, Topic: topic, Dialer: dialer, Partition: partition, })}func read(url string, topic string, dialer *kafka.Dialer, partition int) { reader := newReader(url, topic, partition, dialer) defer reader.Close() for { msg, err := reader.ReadMessage(context.Background()) if err != nil { panic(err) } log.Printf(""rec%d:\t%s\n"", partition, msg.Value) }}func write(url string, topic string, dialer *kafka.Dialer) { writer := newWriter(url, topic, dialer) defer writer.Close() for i := 0; ; i++ { v := []byte(""V"" + strconv.Itoa(i)) log.Printf(""send:\t%s\n"", v) msg := kafka.Message{ Key: v, Value: v } err := writer.WriteMessages(context.Background(), msg) if err != nil { fmt.Println(err) } time.Sleep(100 * time.Millisecond) }}func main() { url := ""_______.______.___.confluent.cloud:9092"" topic := ""test"" username := ""________________"" password := ""________________"" clientID := ""________________"" dialer := newDialer(clientID, username, password) ctx := context.Background() createTopic(url, topic, dialer) for i := 0; i < 6; i++ { go read(url, topic, dialer, i) } go write(url, topic, dialer) <-ctx.Done()} 2020/11/02 23:19:22 send: V02020/11/02 23:19:23 send: V12020/11/02 23:19:23 send: V22020/11/02 23:19:23 send: V32020/11/02 23:19:24 send: V42020/11/02 23:19:24 send: V52020/11/02 23:19:24 send: V62020/11/02 23:19:25 send: V72020/11/02 23:19:25 send: V82020/11/02 23:19:25 send: V92020/11/02 23:19:25 send: V102020/11/02 23:19:26 send: V112020/11/02 23:19:26 send: V122020/11/02 23:19:26 send: V132020/11/02 23:19:26 send: V142020/11/02 23:19:26 send: V152020/11/02 23:19:27 send: V162020/11/02 23:19:27 send: V172020/11/02 23:19:27 send: V182020/11/02 23:19:27 send: V192020/11/02 23:19:28 send: V202020/11/02 23:19:29 send: V212020/11/02 23:19:29 send: V222020/11/02 23:19:29 send: V232020/11/02 23:19:29 send: V242020/11/02 23:19:29 send: V252020/11/02 23:19:30 send: V262020/11/02 23:19:30 send: V272020/11/02 23:19:30 send: V282020/11/02 23:19:30 send: V292020/11/02 23:19:31 send: V302020/11/02 23:19:31 send: V312020/11/02 23:19:31 send: V322020/11/02 23:19:32 send: V332020/11/02 23:19:32 send: V342020/11/02 23:19:32 rec3: V82020/11/02 23:19:32 rec3: V142020/11/02 23:19:32 rec3: V152020/11/02 23:19:32 rec3: V162020/11/02 23:19:32 rec3: V172020/11/02 23:19:32 rec3: V202020/11/02 23:19:32 rec3: V212020/11/02 23:19:32 rec3: V232020/11/02 23:19:32 rec3: V292020/11/02 23:19:32 rec1: V02020/11/02 23:19:32 rec1: V92020/11/02 23:19:32 rec1: V222020/11/02 23:19:32 rec1: V282020/11/02 23:19:32 rec4: V42020/11/02 23:19:32 rec4: V52020/11/02 23:19:32 rec4: V72020/11/02 23:19:32 rec4: V102020/11/02 23:19:32 rec4: V112020/11/02 23:19:32 rec4: V122020/11/02 23:19:32 rec4: V182020/11/02 23:19:32 rec4: V242020/11/02 23:19:32 rec4: V252020/11/02 23:19:32 rec4: V302020/11/02 23:19:32 rec4: V312020/11/02 23:19:32 send: V352020/11/02 23:19:32 rec5: V12020/11/02 23:19:32 rec5: V22020/11/02 23:19:32 rec5: V32020/11/02 23:19:32 rec5: V342020/11/02 23:19:32 rec2: V62020/11/02 23:19:32 rec2: V132020/11/02 23:19:32 rec2: V262020/11/02 23:19:32 rec2: V332020/11/02 23:19:32 send: V362020/11/02 23:19:33 send: V372020/11/02 23:19:33 send: V382020/11/02 23:19:33 send: V392020/11/02 23:19:33 send: V402020/11/02 23:19:33 send: V412020/11/02 23:19:33 rec0: V192020/11/02 23:19:33 rec0: V272020/11/02 23:19:33 rec0: V322020/11/02 23:19:34 send: V422020/11/02 23:19:34 send: V432020/11/02 23:19:34 send: V442020/11/02 23:19:34 send: V452020/11/02 23:19:34 send: V462020/11/02 23:19:35 send: V472020/11/02 23:19:35 send: V482020/11/02 23:19:35 send: V492020/11/02 23:19:35 send: V502020/11/02 23:19:35 send: V512020/11/02 23:19:35 send: V522020/11/02 23:19:36 send: V532020/11/02 23:19:36 send: V542020/11/02 23:19:36 send: V552020/11/02 23:19:36 send: V562020/11/02 23:19:36 send: V572020/11/02 23:19:37 send: V582020/11/02 23:19:37 send: V592020/11/02 23:19:37 send: V602020/11/02 23:19:38 send: V612020/11/02 23:19:38 send: V622020/11/02 23:19:38 send: V632020/11/02 23:19:38 send: V642020/11/02 23:19:38 send: V652020/11/02 23:19:39 send: V662020/11/02 23:19:39 send: V672020/11/02 23:19:39 send: V682020/11/02 23:19:40 send: V692020/11/02 23:19:40 send: V702020/11/02 23:19:40 send: V712020/11/02 23:19:40 send: V722020/11/02 23:19:40 send: V732020/11/02 23:19:40 send: V742020/11/02 23:19:41 send: V752020/11/02 23:19:41 send: V762020/11/02 23:19:41 rec1: V412020/11/02 23:19:41 rec1: V562020/11/02 23:19:41 rec1: V682020/11/02 23:19:41 rec1: V742020/11/02 23:19:41 rec1: V752020/11/02 23:19:41 rec1: V762020/11/02 23:19:41 rec3: V372020/11/02 23:19:41 rec3: V402020/11/02 23:19:41 rec3: V422020/11/02 23:19:41 rec3: V482020/11/02 23:19:41 rec3: V552020/11/02 23:19:41 rec3: V572020/11/02 23:19:41 rec3: V602020/11/02 23:19:41 rec3: V612020/11/02 23:19:41 rec3: V622020/11/02 23:19:41 send: V772020/11/02 23:19:41 rec4: V382020/11/02 23:19:41 rec4: V392020/11/02 23:19:41 rec4: V452020/11/02 23:19:41 rec4: V462020/11/02 23:19:41 rec4: V472020/11/02 23:19:41 rec4: V532020/11/02 23:19:41 rec4: V592020/11/02 23:19:41 rec4: V702020/11/02 23:19:41 rec4: V712020/11/02 23:19:41 rec4: V732020/11/02 23:19:41 rec5: V352020/11/02 23:19:41 rec5: V362020/11/02 23:19:41 rec5: V432020/11/02 23:19:41 rec5: V492020/11/02 23:19:41 rec5: V542020/11/02 23:19:41 rec5: V632020/11/02 23:19:41 rec5: V692020/11/02 23:19:41 rec5: V772020/11/02 23:19:41 send: V782020/11/02 23:19:41 rec2: V442020/11/02 23:19:41 rec2: V502020/11/02 23:19:41 rec2: V512020/11/02 23:19:41 rec2: V642020/11/02 23:19:41 rec2: V652020/11/02 23:19:41 rec2: V662020/11/02 23:19:41 rec2: V722020/11/02 23:19:41 send: V792020/11/02 23:19:42 send: V802020/11/02 23:19:42 send: V812020/11/02 23:19:42 send: V822020/11/02 23:19:42 send: V832020/11/02 23:19:42 send: V842020/11/02 23:19:43 send: V852020/11/02 23:19:43 rec0: V522020/11/02 23:19:43 rec0: V582020/11/02 23:19:43 rec0: V672020/11/02 23:19:43 send: V86 package mainimport ( ""context"" ""fmt"" ""github.com/Shopify/sarama"" ""crypto/tls"" ""crypto/x509"" ""log"" ""strings"" ""time"")var ( broker = ""___-_____.us-east1.gcp.confluent.cloud:9092"" brokers = []string{broker} clientID = ""___________"" username = ""___________"" password = ""___________"" topic = ""sarama"")func main() { log.Printf(""Kafka brokers: %s"", strings.Join(brokers, "", "")) ctx := context.Background() sync := newSyncProducer() // accessLog := newAsyncProducer() createTopic(topic) go func() { for i := 0; ; i++ { v := sarama.StringEncoder(fmt.Sprintf(""V%d"", i)) p, o, err := sync.SendMessage(&sarama.ProducerMessage{ Topic: topic, Value: v, }) if err != nil { panic(err) } fmt.Printf(""sent\t\t%v\tp: %d\toffset: %d\t\n"", v, p, o) time.Sleep(100 * time.Millisecond) } }() ps := []sarama.PartitionConsumer{} offset := int64(0) loop := func(msgs <-chan *sarama.ConsumerMessage) { for msg := range msgs { fmt.Printf(""recv:\t\t%s\tp: %d\toffset: %d\n"", msg.Value, msg.Partition, msg.Offset) } } for i := 0; i < 6; i++ { ps = append(ps, createPartitionConsumer(topic, int32(i), offset)) } for _, p := range ps { go loop(p.Messages()) } <-ctx.Done()}func createPartitionConsumer(topic string, partition int32, offset int64) sarama.PartitionConsumer { config := baseConfig() c, err := sarama.NewConsumer(brokers, config) if err != nil { panic(err) } p, err := c.ConsumePartition(topic, partition, offset) if err != nil { panic(err) } return p}func createTopic(topic string) { config := baseConfig() admin, err := sarama.NewClusterAdmin(brokers, config) if err != nil { log.Fatal(""Error while creating cluster admin: "", err.Error()) } defer func() { _ = admin.Close() }() err = admin.CreateTopic(topic, &sarama.TopicDetail{ NumPartitions: 6, ReplicationFactor: 3, }, false) if err != nil { log.Println(""Error while creating topic: "", err.Error()) }}func baseConfig() *sarama.Config { rootCAs, _ := x509.SystemCertPool() if rootCAs == nil { rootCAs = x509.NewCertPool() } config := sarama.NewConfig() config.Version = sarama.MaxVersion config.Net.TLS.Enable = true config.Net.TLS.Config = &tls.Config{ RootCAs: rootCAs, InsecureSkipVerify: false, } config.ClientID = clientID config.Net.SASL.Enable = true config.Net.SASL.Password = password config.Net.SASL.User = username return config}func newSyncProducer() sarama.SyncProducer { config := baseConfig() config.Producer.RequiredAcks = sarama.WaitForAll config.Producer.Retry.Max = 10 config.Producer.Return.Successes = true producer, err := sarama.NewSyncProducer(brokers, config) if err != nil { log.Fatalln(""Failed to start Sarama producer:"", err) } return producer} recv: V1176 p: 1 offset: 355recv: V1177 p: 2 offset: 363send: V1177 p: 2 offset: 363send: V1178 p: 5 offset: 377recv: V1178 p: 5 offset: 377recv: V1179 p: 1 offset: 356send: V1179 p: 1 offset: 356send: V1180 p: 1 offset: 357recv: V1180 p: 1 offset: 357recv: V1181 p: 1 offset: 358send: V1181 p: 1 offset: 358send: V1182 p: 4 offset: 393recv: V1182 p: 4 offset: 393send: V1183 p: 4 offset: 394recv: V1183 p: 4 offset: 394send: V1184 p: 3 offset: 358recv: V1184 p: 3 offset: 358send: V1185 p: 2 offset: 364recv: V1185 p: 2 offset: 364send: V1186 p: 3 offset: 359recv: V1186 p: 3 offset: 359recv: V1187 p: 3 offset: 360send: V1187 p: 3 offset: 360send: V1188 p: 5 offset: 378recv: V1188 p: 5 offset: 378send: V1189 p: 2 offset: 365recv: V1189 p: 2 offset: 365recv: V1190 p: 4 offset: 395send: V1190 p: 4 offset: 395send: V1191 p: 1 offset: 359recv: V1191 p: 1 offset: 359send: V1192 p: 4 offset: 396recv: V1192 p: 4 offset: 396send: V1193 p: 0 offset: 431recv: V1193 p: 0 offset: 431send: V1194 p: 4 offset: 397recv: V1194 p: 4 offset: 397recv: V1195 p: 2 offset: 366send: V1195 p: 2 offset: 366send: V1196 p: 3 offset: 361recv: V1196 p: 3 offset: 361","Using Kafka-Go, why am I seeing what appears to be batching reads/writes? Is there a config I am missing?"
"Using Kafka-Go, why am I seeing what appears to be buffering? Is there a config I am missing?"," I'm going to be switching from RabbitMQ to Kafka. This is just a simple spike to see how Kafka operates. I'm not sure if there are settings that I am missing, if it is my code, if it is Kafka-Go, or if this is expected Kafka behavior.I've tried adjusting the BatchSize as well as the BatchTimeout but neither have had an impact.The code below creates a topic with 6 partitions and a replication factor of 3. It then produces an incrementing message every 100ms. It launches 6 consumers, one for each partition. Both reading and writing are performed in go routines.In the log below, it goes 7 seconds without receiving a message and then receives bursts. I'm using Confluent's platform so I recognize that there will be some network latency but not to the degree that I'm seeing. Which is logging the below. Any advice would be greatly appreciated. Thanks!Edit:The buffering is definitely just happening with Kafka-Go. Sarama does not encounter the same behavior: In fact, in some cases it actually receives before the sent is confirmed which makes me wonder if there is internal messaging occurring and if so, if I should care... <code>  package mainimport ( ""context"" ""crypto/tls"" ""crypto/x509"" ""fmt"" ""log"" ""net"" ""strconv"" ""time"" kafka ""github.com/segmentio/kafka-go"" ""github.com/segmentio/kafka-go/sasl/plain"")func newDialer(clientID, username, password string) *kafka.Dialer { mechanism := plain.Mechanism{ Username: username, Password: password, } rootCAs, _ := x509.SystemCertPool() if rootCAs == nil { rootCAs = x509.NewCertPool() } return &kafka.Dialer{ Timeout: 10 * time.Second, DualStack: true, ClientID: clientID, SASLMechanism: mechanism, TLS: &tls.Config{ InsecureSkipVerify: false, RootCAs: rootCAs, }, }}func createTopic(url string, topic string, dialer *kafka.Dialer) { conn, err := dialer.Dial(""tcp"", url) if err != nil { panic(err.Error()) } defer conn.Close() controller, err := conn.Controller() if err != nil { panic(err.Error()) } var controllerConn *kafka.Conn controllerConn, err = dialer.Dial(""tcp"", net.JoinHostPort(controller.Host, strconv.Itoa(controller.Port))) if err != nil { panic(err.Error()) } defer controllerConn.Close() topicConfigs := []kafka.TopicConfig{ { Topic: topic, NumPartitions: 6, ReplicationFactor: 3, }, } err = controllerConn.CreateTopics(topicConfigs...) if err != nil { panic(err.Error()) }}func newWriter(url string, topic string, dialer *kafka.Dialer) *kafka.Writer { return kafka.NewWriter(kafka.WriterConfig{ Brokers: []string{url}, Topic: topic, Balancer: &kafka.CRC32Balancer{}, Dialer: dialer, BatchSize: 10, BatchTimeout: 1 * time.Millisecond, })}func newReader(url string, topic string, partition int, dialer *kafka.Dialer) *kafka.Reader { return kafka.NewReader(kafka.ReaderConfig{ Brokers: []string{url}, Topic: topic, Dialer: dialer, Partition: partition, })}func read(url string, topic string, dialer *kafka.Dialer, partition int) { reader := newReader(url, topic, partition, dialer) defer reader.Close() for { msg, err := reader.ReadMessage(context.Background()) if err != nil { panic(err) } log.Printf(""rec%d:\t%s\n"", partition, msg.Value) }}func write(url string, topic string, dialer *kafka.Dialer) { writer := newWriter(url, topic, dialer) defer writer.Close() for i := 0; ; i++ { v := []byte(""V"" + strconv.Itoa(i)) log.Printf(""send:\t%s\n"", v) msg := kafka.Message{ Key: v, Value: v } err := writer.WriteMessages(context.Background(), msg) if err != nil { fmt.Println(err) } time.Sleep(100 * time.Millisecond) }}func main() { url := ""_______.______.___.confluent.cloud:9092"" topic := ""test"" username := ""________________"" password := ""________________"" clientID := ""________________"" dialer := newDialer(clientID, username, password) ctx := context.Background() createTopic(url, topic, dialer) for i := 0; i < 6; i++ { go read(url, topic, dialer, i) } go write(url, topic, dialer) <-ctx.Done()} 2020/11/02 23:19:22 send: V02020/11/02 23:19:23 send: V12020/11/02 23:19:23 send: V22020/11/02 23:19:23 send: V32020/11/02 23:19:24 send: V42020/11/02 23:19:24 send: V52020/11/02 23:19:24 send: V62020/11/02 23:19:25 send: V72020/11/02 23:19:25 send: V82020/11/02 23:19:25 send: V92020/11/02 23:19:25 send: V102020/11/02 23:19:26 send: V112020/11/02 23:19:26 send: V122020/11/02 23:19:26 send: V132020/11/02 23:19:26 send: V142020/11/02 23:19:26 send: V152020/11/02 23:19:27 send: V162020/11/02 23:19:27 send: V172020/11/02 23:19:27 send: V182020/11/02 23:19:27 send: V192020/11/02 23:19:28 send: V202020/11/02 23:19:29 send: V212020/11/02 23:19:29 send: V222020/11/02 23:19:29 send: V232020/11/02 23:19:29 send: V242020/11/02 23:19:29 send: V252020/11/02 23:19:30 send: V262020/11/02 23:19:30 send: V272020/11/02 23:19:30 send: V282020/11/02 23:19:30 send: V292020/11/02 23:19:31 send: V302020/11/02 23:19:31 send: V312020/11/02 23:19:31 send: V322020/11/02 23:19:32 send: V332020/11/02 23:19:32 send: V342020/11/02 23:19:32 rec3: V82020/11/02 23:19:32 rec3: V142020/11/02 23:19:32 rec3: V152020/11/02 23:19:32 rec3: V162020/11/02 23:19:32 rec3: V172020/11/02 23:19:32 rec3: V202020/11/02 23:19:32 rec3: V212020/11/02 23:19:32 rec3: V232020/11/02 23:19:32 rec3: V292020/11/02 23:19:32 rec1: V02020/11/02 23:19:32 rec1: V92020/11/02 23:19:32 rec1: V222020/11/02 23:19:32 rec1: V282020/11/02 23:19:32 rec4: V42020/11/02 23:19:32 rec4: V52020/11/02 23:19:32 rec4: V72020/11/02 23:19:32 rec4: V102020/11/02 23:19:32 rec4: V112020/11/02 23:19:32 rec4: V122020/11/02 23:19:32 rec4: V182020/11/02 23:19:32 rec4: V242020/11/02 23:19:32 rec4: V252020/11/02 23:19:32 rec4: V302020/11/02 23:19:32 rec4: V312020/11/02 23:19:32 send: V352020/11/02 23:19:32 rec5: V12020/11/02 23:19:32 rec5: V22020/11/02 23:19:32 rec5: V32020/11/02 23:19:32 rec5: V342020/11/02 23:19:32 rec2: V62020/11/02 23:19:32 rec2: V132020/11/02 23:19:32 rec2: V262020/11/02 23:19:32 rec2: V332020/11/02 23:19:32 send: V362020/11/02 23:19:33 send: V372020/11/02 23:19:33 send: V382020/11/02 23:19:33 send: V392020/11/02 23:19:33 send: V402020/11/02 23:19:33 send: V412020/11/02 23:19:33 rec0: V192020/11/02 23:19:33 rec0: V272020/11/02 23:19:33 rec0: V322020/11/02 23:19:34 send: V422020/11/02 23:19:34 send: V432020/11/02 23:19:34 send: V442020/11/02 23:19:34 send: V452020/11/02 23:19:34 send: V462020/11/02 23:19:35 send: V472020/11/02 23:19:35 send: V482020/11/02 23:19:35 send: V492020/11/02 23:19:35 send: V502020/11/02 23:19:35 send: V512020/11/02 23:19:35 send: V522020/11/02 23:19:36 send: V532020/11/02 23:19:36 send: V542020/11/02 23:19:36 send: V552020/11/02 23:19:36 send: V562020/11/02 23:19:36 send: V572020/11/02 23:19:37 send: V582020/11/02 23:19:37 send: V592020/11/02 23:19:37 send: V602020/11/02 23:19:38 send: V612020/11/02 23:19:38 send: V622020/11/02 23:19:38 send: V632020/11/02 23:19:38 send: V642020/11/02 23:19:38 send: V652020/11/02 23:19:39 send: V662020/11/02 23:19:39 send: V672020/11/02 23:19:39 send: V682020/11/02 23:19:40 send: V692020/11/02 23:19:40 send: V702020/11/02 23:19:40 send: V712020/11/02 23:19:40 send: V722020/11/02 23:19:40 send: V732020/11/02 23:19:40 send: V742020/11/02 23:19:41 send: V752020/11/02 23:19:41 send: V762020/11/02 23:19:41 rec1: V412020/11/02 23:19:41 rec1: V562020/11/02 23:19:41 rec1: V682020/11/02 23:19:41 rec1: V742020/11/02 23:19:41 rec1: V752020/11/02 23:19:41 rec1: V762020/11/02 23:19:41 rec3: V372020/11/02 23:19:41 rec3: V402020/11/02 23:19:41 rec3: V422020/11/02 23:19:41 rec3: V482020/11/02 23:19:41 rec3: V552020/11/02 23:19:41 rec3: V572020/11/02 23:19:41 rec3: V602020/11/02 23:19:41 rec3: V612020/11/02 23:19:41 rec3: V622020/11/02 23:19:41 send: V772020/11/02 23:19:41 rec4: V382020/11/02 23:19:41 rec4: V392020/11/02 23:19:41 rec4: V452020/11/02 23:19:41 rec4: V462020/11/02 23:19:41 rec4: V472020/11/02 23:19:41 rec4: V532020/11/02 23:19:41 rec4: V592020/11/02 23:19:41 rec4: V702020/11/02 23:19:41 rec4: V712020/11/02 23:19:41 rec4: V732020/11/02 23:19:41 rec5: V352020/11/02 23:19:41 rec5: V362020/11/02 23:19:41 rec5: V432020/11/02 23:19:41 rec5: V492020/11/02 23:19:41 rec5: V542020/11/02 23:19:41 rec5: V632020/11/02 23:19:41 rec5: V692020/11/02 23:19:41 rec5: V772020/11/02 23:19:41 send: V782020/11/02 23:19:41 rec2: V442020/11/02 23:19:41 rec2: V502020/11/02 23:19:41 rec2: V512020/11/02 23:19:41 rec2: V642020/11/02 23:19:41 rec2: V652020/11/02 23:19:41 rec2: V662020/11/02 23:19:41 rec2: V722020/11/02 23:19:41 send: V792020/11/02 23:19:42 send: V802020/11/02 23:19:42 send: V812020/11/02 23:19:42 send: V822020/11/02 23:19:42 send: V832020/11/02 23:19:42 send: V842020/11/02 23:19:43 send: V852020/11/02 23:19:43 rec0: V522020/11/02 23:19:43 rec0: V582020/11/02 23:19:43 rec0: V672020/11/02 23:19:43 send: V86 package mainimport ( ""context"" ""fmt"" ""github.com/Shopify/sarama"" ""crypto/tls"" ""crypto/x509"" ""log"" ""strings"" ""time"")var ( broker = ""___-_____.us-east1.gcp.confluent.cloud:9092"" brokers = []string{broker} clientID = ""___________"" username = ""___________"" password = ""___________"" topic = ""sarama"")func main() { log.Printf(""Kafka brokers: %s"", strings.Join(brokers, "", "")) ctx := context.Background() sync := newSyncProducer() // accessLog := newAsyncProducer() createTopic(topic) go func() { for i := 0; ; i++ { v := sarama.StringEncoder(fmt.Sprintf(""V%d"", i)) p, o, err := sync.SendMessage(&sarama.ProducerMessage{ Topic: topic, Value: v, }) if err != nil { panic(err) } fmt.Printf(""sent\t\t%v\tp: %d\toffset: %d\t\n"", v, p, o) time.Sleep(100 * time.Millisecond) } }() ps := []sarama.PartitionConsumer{} offset := int64(0) loop := func(msgs <-chan *sarama.ConsumerMessage) { for msg := range msgs { fmt.Printf(""recv:\t\t%s\tp: %d\toffset: %d\n"", msg.Value, msg.Partition, msg.Offset) } } for i := 0; i < 6; i++ { ps = append(ps, createPartitionConsumer(topic, int32(i), offset)) } for _, p := range ps { go loop(p.Messages()) } <-ctx.Done()}func createPartitionConsumer(topic string, partition int32, offset int64) sarama.PartitionConsumer { config := baseConfig() c, err := sarama.NewConsumer(brokers, config) if err != nil { panic(err) } p, err := c.ConsumePartition(topic, partition, offset) if err != nil { panic(err) } return p}func createTopic(topic string) { config := baseConfig() admin, err := sarama.NewClusterAdmin(brokers, config) if err != nil { log.Fatal(""Error while creating cluster admin: "", err.Error()) } defer func() { _ = admin.Close() }() err = admin.CreateTopic(topic, &sarama.TopicDetail{ NumPartitions: 6, ReplicationFactor: 3, }, false) if err != nil { log.Println(""Error while creating topic: "", err.Error()) }}func baseConfig() *sarama.Config { rootCAs, _ := x509.SystemCertPool() if rootCAs == nil { rootCAs = x509.NewCertPool() } config := sarama.NewConfig() config.Version = sarama.MaxVersion config.Net.TLS.Enable = true config.Net.TLS.Config = &tls.Config{ RootCAs: rootCAs, InsecureSkipVerify: false, } config.ClientID = clientID config.Net.SASL.Enable = true config.Net.SASL.Password = password config.Net.SASL.User = username return config}func newSyncProducer() sarama.SyncProducer { config := baseConfig() config.Producer.RequiredAcks = sarama.WaitForAll config.Producer.Retry.Max = 10 config.Producer.Return.Successes = true producer, err := sarama.NewSyncProducer(brokers, config) if err != nil { log.Fatalln(""Failed to start Sarama producer:"", err) } return producer} recv: V1176 p: 1 offset: 355recv: V1177 p: 2 offset: 363send: V1177 p: 2 offset: 363send: V1178 p: 5 offset: 377recv: V1178 p: 5 offset: 377recv: V1179 p: 1 offset: 356send: V1179 p: 1 offset: 356send: V1180 p: 1 offset: 357recv: V1180 p: 1 offset: 357recv: V1181 p: 1 offset: 358send: V1181 p: 1 offset: 358send: V1182 p: 4 offset: 393recv: V1182 p: 4 offset: 393send: V1183 p: 4 offset: 394recv: V1183 p: 4 offset: 394send: V1184 p: 3 offset: 358recv: V1184 p: 3 offset: 358send: V1185 p: 2 offset: 364recv: V1185 p: 2 offset: 364send: V1186 p: 3 offset: 359recv: V1186 p: 3 offset: 359recv: V1187 p: 3 offset: 360send: V1187 p: 3 offset: 360send: V1188 p: 5 offset: 378recv: V1188 p: 5 offset: 378send: V1189 p: 2 offset: 365recv: V1189 p: 2 offset: 365recv: V1190 p: 4 offset: 395send: V1190 p: 4 offset: 395send: V1191 p: 1 offset: 359recv: V1191 p: 1 offset: 359send: V1192 p: 4 offset: 396recv: V1192 p: 4 offset: 396send: V1193 p: 0 offset: 431recv: V1193 p: 0 offset: 431send: V1194 p: 4 offset: 397recv: V1194 p: 4 offset: 397recv: V1195 p: 2 offset: 366send: V1195 p: 2 offset: 366send: V1196 p: 3 offset: 361recv: V1196 p: 3 offset: 361","Using Kafka-Go, why am I seeing what appears to be batching reads/writes? Is there a config I am missing?"
Golang - parse Iso8601 time duration (for instance PT90M)," Is there any easy way to convert an ISO 8601 string time duration (P(n)Y(n)M(n)DT(n)H(n)M(n)S) to time.Duration?From Wikipedia on ISO 8601 durations:For example, ""P3Y6M4DT12H30M5S"" represents a duration of ""three years, six months, four days, twelve hours, thirty minutes, and five seconds"". <code> ",Parse ISO 8601 time duration using Go (for instance PT90M)
Parse Iso8601 time duration (for instance PT90M)," Is there any easy way to convert an ISO 8601 string time duration (P(n)Y(n)M(n)DT(n)H(n)M(n)S) to time.Duration?From Wikipedia on ISO 8601 durations:For example, ""P3Y6M4DT12H30M5S"" represents a duration of ""three years, six months, four days, twelve hours, thirty minutes, and five seconds"". <code> ",Parse ISO 8601 time duration using Go (for instance PT90M)
Go plugin - Failed in error plugin was built with a different version of package while debug in Goland," I built my .so file: and run debug with Goland, then I get the error: But I can build my main program in my terminal and it will work well. <code>  go build -buildmode=plugin -o test.so Error running agent: could not initialize input inputs.plugin_input: plugin.Open(""./plugins_lib/test1""): plugin was built with a different version of package runtime/internal/sys",Failed in error plugin was built with a different version of package while debugging
Memory allocation of on map[int]interface{} vs map[int]struct{}," With a coworker we were discussing the performance of using a map as a list and comparing the use of interface as a value(map[int]interface{}) vs the empty struct(map[int]struct{}) and we got some weird values on the benchmark tests.Code Tests Resultsgo version go1.15.5 darwin/amd64go test -bench=. -benchmem QuestionSo, it appears that the empty struct version run faster and use less memory, but does more allocations and can't figure it out why. Does anyone know why this happens? <code>  package mainfunc main() {}func MapWithInterface() { m := map[int]interface{}{} for i := 1; i <= 100; i++ { m[i] = nil }}func MapWithEmptyStruct() { m := map[int]struct{}{} for i := 1; i <= 100; i++ { m[i] = struct{}{} }} package mainimport ""testing""func Benchmark_Interface(b *testing.B) { for i := 0; i < b.N; i++ { MapWithInterface() }}func Benchmark_EmptyStruct(b *testing.B) { for i := 0; i < b.N; i++ { MapWithEmptyStruct() }} goos: darwingoarch: amd64pkg: awesomeProject1Benchmark_Interface-8 130419 8949 ns/op 7824 B/op 7 allocs/opBenchmark_EmptyStruct-8 165147 6964 ns/op 3070 B/op 17 allocs/opPASSok awesomeProject1 3.122s",Memory allocation of map[int]interface{} vs map[int]struct{}
"Mocking os.GetEnv(""ENV_VAR"") - Golang"," I am trying to mock the Go function os.GetEnv() in my test files so that I can get the desired value for a particular environment variable.For example I have defined.abc := os.GetEnv(""XYZ_URL"")Here I should be able to get the needed value for the variable abc. Also I have several places with the GetEnv functions.It will be really helpful if someone can give me a workaround without the help of any Go framework. <code> ","Mocking os.GetEnv(""ENV_VAR"")"
"Protobuf: Import ""google/api/annotations.proto"" was not found or had errors. How do I add it as a dependency?"," Following the docs on how to set up a gRPC gateway, I find myself stuck at step four of generating the grpc gateway.Namely, things fall apart when the following line is added: The documentation says You will need to provide the required third party protobuf files to the protoc compiler - but not actually how do do so.How do I add google/api/annotations.proto as a dependency? <code>  import ""google/api/annotations.proto"";","Import ""google/api/annotations.proto"" was not found or had errors. How do I add it as a dependency?"
Golang error: no required module provides package SDL2," I am trying to import sdl2 package from https://github.com/veandco/go-sdl2. I followed all the steps that appear on readme.md for Windows. Installing mingw64 and do on cmd: It works okay, but when I tried to do: I got this error: In my other computer works perfect but when I clone this repository and install the package on the other laptop I had a lot of issues. To get more info about the case I put my test source here to brig more information: <code>  go get -v github.com/veandco/go-sdl2/sdl go run .\sdl2.go sdl2.go:4:2: no required module provides package github.com/veandco/go-sdl2/sdl: working directory is not part of a module package mainimport ( ""github.com/veandco/go-sdl2/sdl"" ""fmt"")const winWidth, winHeight int = 800, 600type color struct { r, g, b byte}func setPixel(x, y int, c color, pixels []byte) { index := (y * winWidth + x) * 4 if index < len(pixels)-4 && index >= 0 { pixels[index] = c.r pixels[index+1] = c.g pixels[index+2] = c.b }}func main() { winWidth := 800 winHeight := 600 window,err := sdl.CreateWindow(""Testing SDL2"", sdl.WINDOWPOS_UNDEFINED, sdl.WINDOWPOS_UNDEFINED, int32(winWidth) ,int32(winHeight), sdl.WINDOW_SHOWN) if err != nil { fmt.Println(err) return } defer window.Destroy() renderer, err := sdl.CreateRenderer(window, -1, sdl.RENDERER_ACCELERATED) if err != nil { fmt.Println(err) return } defer renderer.Destroy() tex, err := renderer.CreateTexture(sdl.PIXELFORMAT_ABGR8888, sdl.TEXTUREACCESS_STREAMING, int32(winWidth), int32(winHeight)) if err != nil { fmt.Println(err) return } defer tex.Destroy() pixels := make([]byte, winWidth*winHeight*4) for y := 0; y < winHeight; y++ { for x := 0; x < winWidth; x++ { setPixel(x,y, color{byte(x % 255),byte(y % 255), 0}, pixels) } } tex.Update(nil,pixels,winWidth*4) renderer.Copy(tex,nil,nil) renderer.Present() sdl.Delay(2000)} ",no required module provides package SDL2
ENV variables not coming through godotenv Golang Docker," I have a web app written in Go, dockerised and using gomod.I cannot get it to read environment variables.Upon running docker-compose up always returns ""Error getting env, not comming through""I'm using godotenv to try do this. Below is my implementation. I cannot for the life of me figure out what's going wrong. If anyone can see something I'm missing you'll be saving a life.The main.go, .env, docker-compose.yml and Dockerfile are all in the root of the projectmain.go .env docker-compose.yml Dockerfile <code>  func main() { router := mux.NewRouter() err := godotenv.Load() if err != nil { log.Fatalf(""Error getting env, not comming through %v"", err) } else { fmt.Println(""We are getting the env values"") } fmt.Println(os.Getenv(""MY_ENV""))} MY_ENV=thisismyenvvariableDB_HOST=testdata123DB_DRIVER=testdata123DB_USER=""testdata123""DB_PASSWORD=testdata123DB_NAME=testdata123DB_PORT=5432 version: '3'services: app: container_name: template_123 build: . ports: - 8080:8080 restart: on-failure volumes: - api:/usr/src/app/ env_file: - .env depends_on: - template-postgres networks: - template template-postgres: image: postgres:latest container_name: startup_template_golang_db_postgres environment: - POSTGRES_USER=${DB_USER} - POSTGRES_PASSWORD=${DB_PASSWORD} - POSTGRES_DB=${DB_NAME} - DATABASE_HOST=${DB_HOST} ports: - '5432:5432' volumes: - database_postgres:/var/lib/postgresql/data env_file: - .env networks: - template pgadmin: image: dpage/pgadmin4 container_name: pgadmin_container environment: PGADMIN_DEFAULT_EMAIL: ${PGADMIN_DEFAULT_EMAIL} PGADMIN_DEFAULT_PASSWORD: ${PGADMIN_DEFAULT_PASSWORD} depends_on: - template-postgres ports: - ""5050:80"" networks: - template restart: unless-stoppedvolumes: api: database_postgres: # Networks to be created to facilitate communication between containersnetworks: startup_template: driver: bridge # Start from golang base imageFROM golang:alpine as builder# ENV GO111MODULE=on# Add Maintainer infoLABEL maintainer=""satoshi123""# Install git.# Git is required for fetching the dependencies.RUN apk update && apk add --no-cache git# Set the current working directory inside the container WORKDIR /app# Copy go mod and sum files COPY go.mod go.sum ./# Download all dependencies. Dependencies will be cached if the go.mod and the go.sum files are not changed RUN go mod download # Copy the source from the current directory to the working Directory inside the container COPY . .# Build the Go appRUN CGO_ENABLED=0 GOOS=linux go build -a -installsuffix cgo -o main .# Start a new stage from scratchFROM alpine:latestRUN apk --no-cache add ca-certificatesWORKDIR /root/# Copy the Pre-built binary file from the previous stage. Observe we also copied the .env fileCOPY --from=builder /app/main .# COPY --from=builder /app/.env . # Expose port 8080 to the outside worldEXPOSE 8080#Command to run the executableCMD [""./main""]",ENV variables not coming through godotenv Docker
Correct way to perform a reconnect with gRPC client using Go?," I have a Go gRPC client connected to a gRPC server running in a different pod in my k8s cluster.It's working well, receiving and processing requests.I am now wondering how best to implement resiliency in the event that the gRPC server pod gets recycled.As far as I can ascertain, the clientconn.go code should handle the reconnection automatically, but I just cannot get it to work and I fear my implementation is incorrect in the first instance.Calling code from main: My code in the gRPCClient wrapper module: EDIT:Emin Laletovic answered my question elegantly below and gets it most of the way there.I had to make a few changes to the waitUntilReady function: <code>  go func() { if err := gRPCClient.ProcessRequests(); err != nil { log.Error(""Error while processing Requests"") //do something here?? } }() func (grpcclient *gRPCClient) ProcessRequests() error { defer grpcclient.Close() for { request, err := reqclient.stream.Recv() log.Info(""Request received"") if err == io.EOF { break } if err != nil { //when pod is recycled, this is what's hit with err: //rpc error: code = Unavailable desc = transport is closing"" //what is the correct pattern for recovery here so that we can await connection //and continue processing requests once more? //should I return err here and somehow restart the ProcessRequests() go routine in the //main funcition? break } else { //the happy path //code block to process any requests that are received } } return nil}func (reqclient *RequestClient) Close() {//this is called soon after the conneciton drops reqclient.conn.Close()} func (grpcclient *gRPCClient) waitUntilReady() bool {ctx, cancel := context.WithTimeout(context.Background(), 300*time.Second) //define how long you want to wait for connection to be restored before giving updefer cancel()currentState := grpcclient.conn.GetState()stillConnecting := truefor currentState != connectivity.Ready && stillConnecting { //will return true when state has changed from thisState, false if timeout stillConnecting = grpcclient.conn.WaitForStateChange(ctx, currentState) currentState = grpcclient.conn.GetState() log.WithFields(log.Fields{""state: "": currentState, ""timeout"": timeoutDuration}).Info(""Attempting reconnection. State has changed to:"")}if stillConnecting == false { log.Error(""Connection attempt has timed out."") return false}return true}",Correct way to perform a reconnect with gRPC client
go: go.mod file not found in current directory or any parent directory; see 'go help modules'," I just updated to the new version of Go - Go version 1.16.2 Linux/amd64 and am getting an error when I build a Hello, World! example:go: go.mod file not found in current directory or any parent directory; see 'go help modules'Even when I follow the fix from that post it isn't working. I set these variables and then build again: And the same problem unfortunately. <code>  GO111MODULE=onGOPROXY=https://proxy.golang.org,direct","Error message ""go: go.mod file not found in current directory or any parent directory; see 'go help modules'"""
Go: go.mod file not found in current directory or any parent directory; see 'go help modules'," I just updated to the new version of Go - Go version 1.16.2 Linux/amd64 and am getting an error when I build a Hello, World! example:go: go.mod file not found in current directory or any parent directory; see 'go help modules'Even when I follow the fix from that post it isn't working. I set these variables and then build again: And the same problem unfortunately. <code>  GO111MODULE=onGOPROXY=https://proxy.golang.org,direct","Error message ""go: go.mod file not found in current directory or any parent directory; see 'go help modules'"""
GKE container killed by 'Memory cgroup out of memory' but monitoring and local testing shows usage far below limit," I recently pushed a new container image to one of my GKE deployments and noticed that API latency went up and requests started returning 502's.Looking at the logs I found that the container started crashing because of OOM: Looking at the memory usage graph it didn't look like the pods were using more than 50MB of memory combined. My original resource requests were: Then I tried bumping the request for API server to 1GB but it did not help. In the end, what helped was reverting the container image to the previous version:Looking through the changes in the golang binary there are no obvious memory leaks. When I run it locally it uses at most 80MB of memory, even under load from the same requests as in production.And the above graph which I got from the GKE console also shows the pod using far less than the 1GB memory limit.So my question is: What could cause GKE to kill my process for OOM when both GKE monitoring and running it locally only uses 80MB out of the 1GB limit?=== EDIT ===Adding another graph of the same outage. This time splitting the two containers in the pod. If I understand correctly, the metric here is non-evictable container/memory/used_bytes: Edit Apr 26 2021I tried updating the resources field in the deployment yaml to 1GB RAM requested and 1GB RAM limit like suggested by Paul and Ryan: Unfortunately it had the same result after updating with kubectl apply -f api_server_deployment.yaml: Kubernetes seems to have almost immediately killed the container for using 1GB of memory. But again, the metrics show that container using only 2MB of memory:And again I am stumped because even under load this binary does not use more than 80MB when I run it locally.I also tried running go tool pprof <url>/debug/pprof/heap. It showed several different values as Kubernetes kept thrashing the container. But none higher than ~20MB and not memory usage out of the ordinaryEdit 04/27I tried setting request=limit for both containers in the pod: But it didn't work either: And the memory metrics still show usage in the single digit MBs.Update 04/30I pinpointed the change that seemed to cause this issue by painstakingly checking out my latest commits one by one.In the offending commit I had a couple of lines like Where picture.Resize eventually calls resize.Resize.I changed it to: This solves my immediate problem and the container runs fine now. But it does not answer my original question:Why did these lines cause GKE to OOM my container?And why did the GKE memory metrics show that everything was fine? <code>  Memory cgroup out of memory: Killed process 2774370 (main) total-vm:1801348kB, anon-rss:1043688kB, file-rss:12884kB, shmem-rss:0kB, UID:0 pgtables:2236kB oom_score_adj:980 ...spec:... template:... spec:... containers: - name: api-server... resources: # You must specify requests for CPU to autoscale # based on CPU utilization requests: cpu: ""150m"" memory: ""80Mi"" limits: cpu: ""1"" memory: ""1024Mi"" - name: cloud-sql-proxy # It is recommended to use the latest version of the Cloud SQL proxy # Make sure to update on a regular schedule! image: gcr.io/cloudsql-docker/gce-proxy:1.17 resources: # You must specify requests for CPU to autoscale # based on CPU utilization requests: cpu: ""100m""... container/memory/used_bytes GAMemory usageGAUGE, INT64, Byk8s_container Memory usage in bytes. Sampled every 60 seconds.memory_type: Either `evictable` or `non-evictable`. Evictable memory is memory that can be easily reclaimed by the kernel, while non-evictable memory cannot. resources: # You must specify requests for CPU to autoscale # based on CPU utilization requests: cpu: ""150m"" memory: ""1024Mi"" limits: cpu: ""1"" memory: ""1024Mi"" { insertId: ""yyq7u3g2sy7f00"" jsonPayload: { apiVersion: ""v1"" eventTime: null involvedObject: { kind: ""Node"" name: ""gke-api-us-central-1-e2-highcpu-4-nod-dfe5c3a6-c0jy"" uid: ""gke-api-us-central-1-e2-highcpu-4-nod-dfe5c3a6-c0jy"" } kind: ""Event"" message: ""Memory cgroup out of memory: Killed process 1707107 (main) total-vm:1801412kB, anon-rss:1043284kB, file-rss:9732kB, shmem-rss:0kB, UID:0 pgtables:2224kB oom_score_adj:741"" metadata: { creationTimestamp: ""2021-04-26T23:13:13Z"" managedFields: [ 0: { apiVersion: ""v1"" fieldsType: ""FieldsV1"" fieldsV1: { f:count: { } f:firstTimestamp: { } f:involvedObject: { f:kind: { } f:name: { } f:uid: { } } f:lastTimestamp: { } f:message: { } f:reason: { } f:source: { f:component: { } f:host: { } } f:type: { } } manager: ""node-problem-detector"" operation: ""Update"" time: ""2021-04-26T23:13:13Z"" } ] name: ""gke-api-us-central-1-e2-highcpu-4-nod-dfe5c3a6-c0jy.16798b61e3b76ec7"" namespace: ""default"" resourceVersion: ""156359"" selfLink: ""/api/v1/namespaces/default/events/gke-api-us-central-1-e2-highcpu-4-nod-dfe5c3a6-c0jy.16798b61e3b76ec7"" uid: ""da2ad319-3f86-4ec7-8467-e7523c9eff1c"" } reason: ""OOMKilling"" reportingComponent: """" reportingInstance: """" source: { component: ""kernel-monitor"" host: ""gke-api-us-central-1-e2-highcpu-4-nod-dfe5c3a6-c0jy"" } type: ""Warning"" } logName: ""projects/questions-279902/logs/events"" receiveTimestamp: ""2021-04-26T23:13:16.918764734Z"" resource: { labels: { cluster_name: ""api-us-central-1"" location: ""us-central1-a"" node_name: ""gke-api-us-central-1-e2-highcpu-4-nod-dfe5c3a6-c0jy"" project_id: ""questions-279902"" } type: ""k8s_node"" } severity: ""WARNING"" timestamp: ""2021-04-26T23:13:13Z"" } requests: cpu: ""1"" memory: ""1024Mi"" limits: cpu: ""1"" memory: ""1024Mi""...requests: cpu: ""100m"" memory: ""200Mi""limits: cpu: ""100m"" memory: ""200Mi"" Memory cgroup out of memory: Killed process 2662217 (main) total-vm:1800900kB, anon-rss:1042888kB, file-rss:10384kB, shmem-rss:0kB, UID:0 pgtables:2224kB oom_score_adj:-998 type Pic struct { image.Image Proto *pb.Image}...pic.Image = picture.Resize(pic, sz.Height, sz.Width)... type Pic struct { Img image.Image Proto *pb.Image }...pic.Img = picture.Resize(pic.Img, sz.Height, sz.Width)","GKE container killed by 'Memory cgroup out of memory' but monitoring, local testing and pprof shows usage far below limit"
Use kubeconfig for helm client," Im using the helm SDK and it works great, for my testing using the fake option which works(for kubeconfig),Now when I update the kubeconfig to my cluster I notice that during installation the chart is stuck on status pending,and it stuck forever in this state until I'm deleting & installing it again,(manually)My question is how to solve this issue with theHelm SDK (via code only) https://pkg.go.dev/helm.sh/helm/v3,I mean wait for a while and if the status is pending after 3 min delete and reinstall it again... or try upgrade beforeThis is the code <code>  kubeConfigPath, err := findKubeConfig() if err != nil { fmt.Println() } actionConfig := &action.Configuration{ } cfg := cli.New() clientGetter := genericclioptions.NewConfigFlags(false) clientGetter.KubeConfig = &kubeConfigPath actionConfig.Init(clientGetter, ""def"", ""memory"", log.Printf) if err != nil { fmt.Println(err) } chart, err := installation.InstallChart(cfg, ""test"", ""chart1"", ""./charts/dns"", nil, actionConfig) if err != nil { fmt.Println(err) } fmt.Println(chart)}func findKubeConfig() (string, error) { env := os.Getenv(""KUBECONFIG"") if env != """" { return env, nil } path, err := homedir.Expand(""~/.kube/config"") if err != nil { return """", err } return path, nil}",Use kubeconfig for helm client install panding
What's the difference between `//go:build xxx` and `// +build xxx`?," for example, https://github.com/golang/sys/blob/master/cpu/cpu_gccgo_x86.go#L5 : In my eyes, as a build tag, // +build ... can work well.Why is //go:build still explicitly specified?Btw, it is hard to find the mannual of //go:build, but // +build is easy(https://pkg.go.dev/cmd/go#hdr-Build_constraints) <code>  //go:build (386 || amd64 || amd64p32) && gccgo// +build 386 amd64 amd64p32// +build gccgopackage cpu",What's the difference between `//go:build` and `// +build` directives?
How do I list packages for which go install was executed?," If I understand correctly, go install puts binaries in $GOBIN directory.I tend to forget which packages provide which binaries in $GOBIN and which packages I go install-ed.Is there a way to list packages that are currently go install-ed?I could, obviously, do ls $GOBIN and that'll give me names of binaries. However, I'm looking for a way to get a list of packages with their long names, e.g. github.com/operator-framework/operator-sdk.Update: go list ... (suggested here) does not seem to apply to my case because this command expects me to be in a directory containing go.mod file. I understand that go list is designated for listing packages of a project. In my case, I need to find out all packages that are installed into $GOBIN of my system/user. <code> ",How do I list packages whose binaries are installed in $GOBIN?
How do I list packages which binaries are installed in $GOBIN?," If I understand correctly, go install puts binaries in $GOBIN directory.I tend to forget which packages provide which binaries in $GOBIN and which packages I go install-ed.Is there a way to list packages that are currently go install-ed?I could, obviously, do ls $GOBIN and that'll give me names of binaries. However, I'm looking for a way to get a list of packages with their long names, e.g. github.com/operator-framework/operator-sdk.Update: go list ... (suggested here) does not seem to apply to my case because this command expects me to be in a directory containing go.mod file. I understand that go list is designated for listing packages of a project. In my case, I need to find out all packages that are installed into $GOBIN of my system/user. <code> ",How do I list packages whose binaries are installed in $GOBIN?
go test: Print the names of packages as they are compiled," Running go build or go install with -v will ""print the names of packages as they are compiled"". How do I get the same when I run go test? -v there means to output test information. When running tests on some packages, they can unexpectedly take a long time, due to long compiles for some dependencies. I'd like some visibility in to that process.The best option I can think of is to try something like go build -v ./..., but I don't know if that will include building the dependencies of tests, and it's a separate step. <code> ",Print the names of test packages as they are compiled
Why error content shouldn't end with a punctuation mark in Go," I have a problem with error text.If I use the error message shown below, the editor's linter gives a warning like this: ""error strings should not end with punctuation or a newline"": The question is: why shouldn't I use punctuation? What is the real reason behind it? <code>  return errors.New(""Test!"") ^",Why error messages shouldn't end with a punctuation mark in Go?
Is it possible to make go binary smaller (tinygo)?," The TinyGo Homepage says that it is designed for micro controllers (or MCU). I wonder if it is possible to use TinyGo to compile go into small binary for ARM/Linux system?Currently with UPX --best --lzma, my go code compiles to arm binary about 1MB, I hope to make it even smaller, because the system has limited storage. <code> ",Is it possible to make a Go binary smaller by compiling it with TinyGo?
"Why there are two ""require"" blocks in go.mod?", I've created small go application. Few days back I upgraded from go 1.15 to 1.17 and I also upgraded packages with go get -u. After the changes I have 2 require blocks in my go.mod file. Why is it? What does it mean? Is it ok or something is broken?Application still builds correctly.go.mod file: <code>  module github.com/jozo/simple-pomodorogo 1.17require ( fyne.io/fyne/v2 v2.1.0 github.com/dsnet/golib/memfile v1.0.0 github.com/faiface/beep v1.1.0 github.com/fsnotify/fsnotify v1.5.1 // indirect github.com/go-gl/gl v0.0.0-20210905235341-f7a045908259 // indirect github.com/go-gl/glfw/v3.3/glfw v0.0.0-20210727001814-0db043d8d5be // indirect github.com/godbus/dbus/v5 v5.0.5 // indirect github.com/hajimehoshi/oto v1.0.1 // indirect github.com/srwiley/oksvg v0.0.0-20210519022825-9fc0c575d5fe // indirect github.com/srwiley/rasterx v0.0.0-20210519020934-456a8d69b780 // indirect github.com/yuin/goldmark v1.4.1 // indirect golang.org/x/exp v0.0.0-20210916165020-5cb4fee858ee // indirect golang.org/x/image v0.0.0-20210628002857-a66eb6448b8d // indirect golang.org/x/mobile v0.0.0-20210924032853-1c027f395ef7 // indirect golang.org/x/net v0.0.0-20210929193557-e81a3d93ecf6 // indirect golang.org/x/sys v0.0.0-20210927094055-39ccf1dd6fa6 // indirect golang.org/x/text v0.3.7 // indirect gopkg.in/yaml.v3 v3.0.0-20210107192922-496545a6307b // indirect)require ( github.com/davecgh/go-spew v1.1.1 // indirect github.com/fredbi/uri v0.0.0-20181227131451-3dcfdacbaaf3 // indirect github.com/goki/freetype v0.0.0-20181231101311-fa8a33aabaff // indirect github.com/pkg/errors v0.9.1 // indirect github.com/pmezard/go-difflib v1.0.0 // indirect github.com/stretchr/testify v1.7.0 // indirect),"Why there are two ""require"" blocks in go.mod since Go 1.17?"
Go get a private repository from AWS codecommit using HTTP GRC," I'm trying to import a module located in AWS codecommit. To clone the repository I'm using HTTPS GRC (Git Remote Codecommit) method, which uses Google Suite credentials to access AWS console.The command I use to clone the repository is: The remote module's go.mod file contains this: I tried to achieve my goal configuring Git like this: Setted GOPRIVATE: And then getting the repository: but I get this output (and the execution gets stuck): I would like to mention that when I execute the git ls-remote https://git-codecommit.us-west-2.amazonaws.com/my-module command manually I get the information of the branches and tags without problems.I checked this topic but in that case SSH protocol is used instead of HTTP GRC. Maybe the only way to import a module from a private repository is via SSH? <code>  git clone codecommit::us-west-2://my-module module git-codecommit.us-west-2.amazonaws.com/my-module.git git config --global url.""codecommit::us-west-2://"".insteadOf ""https://git-codecommit.us-west-2.amazonaws.com/"" go env -w GOPRIVATE=git-codecommit.us-west-2.amazonaws.com/my-module.git go get -x git-codecommit.us-west-2.amazonaws.com/my-module.git cd.git ls-remote https://git-codecommit.us-west-2.amazonaws.com/my-module",Get a private repository from AWS codecommit using HTTPS GRC
Get a private repository from AWS codecommit using HTTP GRC," I'm trying to import a module located in AWS codecommit. To clone the repository I'm using HTTPS GRC (Git Remote Codecommit) method, which uses Google Suite credentials to access AWS console.The command I use to clone the repository is: The remote module's go.mod file contains this: I tried to achieve my goal configuring Git like this: Setted GOPRIVATE: And then getting the repository: but I get this output (and the execution gets stuck): I would like to mention that when I execute the git ls-remote https://git-codecommit.us-west-2.amazonaws.com/my-module command manually I get the information of the branches and tags without problems.I checked this topic but in that case SSH protocol is used instead of HTTP GRC. Maybe the only way to import a module from a private repository is via SSH? <code>  git clone codecommit::us-west-2://my-module module git-codecommit.us-west-2.amazonaws.com/my-module.git git config --global url.""codecommit::us-west-2://"".insteadOf ""https://git-codecommit.us-west-2.amazonaws.com/"" go env -w GOPRIVATE=git-codecommit.us-west-2.amazonaws.com/my-module.git go get -x git-codecommit.us-west-2.amazonaws.com/my-module.git cd.git ls-remote https://git-codecommit.us-west-2.amazonaws.com/my-module",Get a private repository from AWS codecommit using HTTPS GRC
Get a private repository from AWS codecommit using HTTP GRC," I'm trying to import a module located in AWS codecommit. To clone the repository I'm using HTTPS GRC (Git Remote Codecommit) method, which uses Google Suite credentials to access AWS console.The command I use to clone the repository is: The remote module's go.mod file contains this: I tried to achieve my goal configuring Git like this: Setted GOPRIVATE: And then getting the repository: but I get this output (and the execution gets stuck): I would like to mention that when I execute the git ls-remote https://git-codecommit.us-west-2.amazonaws.com/my-module command manually I get the information of the branches and tags without problems.I checked this topic but in that case SSH protocol is used instead of HTTP GRC. Maybe the only way to import a module from a private repository is via SSH? <code>  git clone codecommit::us-west-2://my-module module git-codecommit.us-west-2.amazonaws.com/my-module.git git config --global url.""codecommit::us-west-2://"".insteadOf ""https://git-codecommit.us-west-2.amazonaws.com/"" go env -w GOPRIVATE=git-codecommit.us-west-2.amazonaws.com/my-module.git go get -x git-codecommit.us-west-2.amazonaws.com/my-module.git cd.git ls-remote https://git-codecommit.us-west-2.amazonaws.com/my-module",Get a private repository from AWS codecommit using HTTPS GRC
Why dereference of null pointer in unsafe.Sizeof() won't cause panic," https://go.dev/play/p/X_BH4qGgXHJ Why doesn't this code cause a runtime panic? <code>  package mainimport ( ""fmt"" ""unsafe"")func main() { var i *int fmt.Println(unsafe.Sizeof(*i)) // dereference of null pointer i} unsafe.Sizeof(*i)",Why doesn't dereferencing a nil pointer in unsafe.Sizeof() cause a panic?
Why dereferencing a nil pointer in unsafe.Sizeof() doesn't cause a panic?," https://go.dev/play/p/X_BH4qGgXHJ Why doesn't this code cause a runtime panic? <code>  package mainimport ( ""fmt"" ""unsafe"")func main() { var i *int fmt.Println(unsafe.Sizeof(*i)) // dereference of null pointer i} unsafe.Sizeof(*i)",Why doesn't dereferencing a nil pointer in unsafe.Sizeof() cause a panic?
golang error: cannot use generic type without instantiation," Studying Go generics, I'm running into an error I can't seem to untangle. I've boiled it down to the simplest code: In playground, this bonks at the make() call (and similarly on the new call that's commented out) with the following error message:cannot use generic type opStack[T any] without instantiationBut make() is an instantiating function. So, I expect I'm missing some syntactical subtlety. What is Go complaining about and what's the needed correction? <code>  type opStack[T any] []Tfunc main() { t := make(opStack) // t := new(opStack) t = append(t, 0) fmt.Println(t[0])}",Go error: cannot use generic type without instantiation
